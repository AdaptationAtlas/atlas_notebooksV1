<!doctype html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta charset="utf-8"><meta name="generator" content="quarto-1.8.26"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"><title>notebook</title><style>code{white-space:pre-wrap}span.smallcaps{font-variant:small-caps}div.columns{display:flex;gap:min(4vw,1.5em)}div.column{flex:auto;overflow-x:auto}div.hanging-indent{margin-left:1.5em;text-indent:-1.5em}ul.task-list{list-style:none}ul.task-list li input[type=checkbox]{width:.8em;margin:0 .8em .2em -1em;vertical-align:middle}html{-webkit-text-size-adjust:100%}pre>code.sourceCode{white-space:pre;position:relative}pre>code.sourceCode>span{display:inline-block;line-height:1.25}pre>code.sourceCode>span:empty{height:1.2em}.sourceCode{overflow:visible}code.sourceCode>span{color:inherit;text-decoration:inherit}div.sourceCode{margin:1em 0}pre.sourceCode{margin:0}@media screen{div.sourceCode{overflow:auto}}@media print{pre>code.sourceCode{white-space:pre-wrap}pre>code.sourceCode>span{text-indent:-5em;padding-left:5em}}pre.numberSource code{counter-reset:source-line 0}pre.numberSource code>span{position:relative;left:-4em;counter-increment:source-line}pre.numberSource code>span>a:first-child::before{content:counter(source-line);position:relative;left:-1em;text-align:right;vertical-align:baseline;border:none;display:inline-block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:0 4px;width:4em}pre.numberSource{margin-left:3em;padding-left:4px}@media screen{pre>code.sourceCode>span>a:first-child::before{text-decoration:underline}}</style><script src="../../site_libs/quarto-nav/quarto-nav.js"></script><script src="../../site_libs/quarto-nav/headroom.min.js"></script><link href="../../images/atlas-icon.svg" rel="icon" type="image/svg+xml"><script src="../../site_libs/clipboard/clipboard.min.js"></script><script src="../../site_libs/quarto-html/quarto.js" type="module"></script><script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script><script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script><script src="../../site_libs/quarto-html/popper.min.js"></script><script src="../../site_libs/quarto-html/tippy.umd.min.js"></script><link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet"><link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><script src="../../site_libs/bootstrap/bootstrap.min.js"></script><link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet"><link href="../../site_libs/bootstrap/bootstrap-24171a1204817fc0b5d15ed74f465fc7.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&amp;display=swap" rel="stylesheet"><script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet"><link rel="stylesheet" href="../../styles.css"></head><body class="nav-fixed fullcontent quarto-light"><div id="quarto-search-results"></div><header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg" data-bs-theme="dark"><div class="navbar-container container-fluid"><div class="navbar-brand-container mx-auto"><a href="https://adaptationatlas.cgiar.org" class="navbar-brand navbar-brand-logo"><img src="../../images/atlas-logo.svg" alt="The Africa Agriculture Adaptation Atlas" class="navbar-logo light-content"> <img src="../../images/atlas-logo.svg" alt="The Africa Agriculture Adaptation Atlas" class="navbar-logo dark-content"></a></div><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="window.quartoToggleHeadroom&&window.quartoToggleHeadroom()"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav navbar-nav-scroll ms-auto"><li class="nav-item"><a class="nav-link" href="../../docs/doc_index.html"><i class="bi bi-info-circle" role="img" aria-label="More Information"></i> <span class="menu-text">Documentation</span></a></li><li class="nav-item"><a class="nav-link" href="https://github.com/AdaptationAtlas/atlas_notebooks/issues/new"><span class="menu-text">Report an Issue</span></a></li><li class="nav-item compact"><a class="nav-link" href="https://github.com/AdaptationAtlas/atlas_notebooks"><i class="bi bi-github" role="img" aria-label="GitHub"></i> <span class="menu-text"></span></a></li></ul></div><div class="quarto-navbar-tools"></div></div></nav></header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"><main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="8" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 7"><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { heroImage } <span class="im">from</span> <span class="st">"/helpers/hero.js"</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>hero_url <span class="op">=</span> <span class="st">"./../../images/hsh.webp"</span><span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>hero <span class="op">=</span> <span class="fu">heroImage</span>(notebookTitle<span class="op">,</span> hero_url)<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span><span class="sc">${</span>hero<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-4" data-nodetype="expression"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="16" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 15"><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { atlasTOC } <span class="im">from</span> <span class="st">'/helpers/toc.ojs'</span> </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> nbText <span class="co">// force wait/reload with nbText to load so headings have correct labels/languages</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">atlasTOC</span>({</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">heading</span><span class="op">:</span> <span class="vs">`&lt;b&gt;</span><span class="sc">${</span><span class="fu">_lang</span>({<span class="dt">en</span><span class="op">:</span><span class="st">"In this notebook"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span><span class="st">"Dans ce notebook"</span>})<span class="sc">}</span><span class="vs">&lt;/b&gt;`</span><span class="op">,</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">skip</span><span class="op">:</span> [notebookTitle<span class="op">,</span> <span class="st">"notebook-title"</span><span class="op">,</span> <span class="st">"Appendix"</span><span class="op">,</span> <span class="st">"source-code"</span>]</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-2" data-nodetype="expression"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="26" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 25"><span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co">// pretty view of language toggle</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>viewof prettyLanguageView <span class="op">=</span> {</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">radio</span>(languages<span class="op">,</span> {</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">language</span>)<span class="op">,</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    viewof language</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-3" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="39" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 38"><span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">intro</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-4" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="45" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 44"><span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">intro</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-5" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="51" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 50"><span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a><span class="co">// format admin selections</span></span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a><span class="co">// bind to appendix inputs, add template to format</span></span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a>geoImpactAdminSelectors <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>  [</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin0<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin0</span>
<span id="cb6-58"><a href="#cb6-58" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb6-59"><a href="#cb6-59" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb6-60"><a href="#cb6-60" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin1<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb6-61"><a href="#cb6-61" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin1</span>
<span id="cb6-62"><a href="#cb6-62" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb6-63"><a href="#cb6-63" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb6-64"><a href="#cb6-64" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin2<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb6-65"><a href="#cb6-65" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin2</span>
<span id="cb6-66"><a href="#cb6-66" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-67"><a href="#cb6-67" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb6-68"><a href="#cb6-68" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb6-69"><a href="#cb6-69" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> adminFormTemplate</span>
<span id="cb6-70"><a href="#cb6-70" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb6-71"><a href="#cb6-71" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-6" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="75" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 74"><span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a><span class="co">// define choices for the data value</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>viewof selectGeoDataType <span class="op">=</span> {</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> options <span class="op">=</span> [</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ag_workforce_data_2"</span><span class="op">,</span> <span class="co">// lookup id for data option</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataColumn</span><span class="op">:</span> <span class="st">"corrected_ag_pop"</span><span class="op">,</span> <span class="co">// data column</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_2</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span> <span class="co">// label</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelTip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_2</span><span class="op">.</span><span class="at">labelTip</span>)<span class="op">,</span> <span class="co">// label for tooltip</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLegend</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_2</span><span class="op">.</span><span class="at">labelLegend</span>)<span class="op">,</span> <span class="co">// label for legend</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>      <span class="dt">formatFunc</span><span class="op">:</span> <span class="fu">formatNumCompactShort</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})<span class="op">,</span> <span class="co">// formatting function for raw data value</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorRange</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">range</span><span class="op">.</span><span class="at">yellowGreen</span><span class="op">,</span> <span class="co">// color range</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorUnknown</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">unknown</span><span class="op">,</span> <span class="co">// unknown fill color </span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ag_workforce_data_1"</span><span class="op">,</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataColumn</span><span class="op">:</span> <span class="st">"agw_total_mid"</span><span class="op">,</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_1</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span> </span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelTip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_1</span><span class="op">.</span><span class="at">labelTip</span>)<span class="op">,</span> </span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLegend</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_1</span><span class="op">.</span><span class="at">labelLegend</span>)<span class="op">,</span> </span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>      <span class="dt">formatFunc</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">formatNumCompactShort</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(d)<span class="sc">}</span><span class="vs">%`</span><span class="op">,</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorRange</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">range</span><span class="op">.</span><span class="at">redYellowGreen</span><span class="op">,</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorUnknown</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">unknown</span><span class="op">,</span></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ag_workforce_data"</span><span class="op">,</span></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataColumn</span><span class="op">:</span> <span class="st">"agw_total"</span><span class="op">,</span></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span> </span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelTip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data</span><span class="op">.</span><span class="at">labelTip</span>)<span class="op">,</span> </span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLegend</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data</span><span class="op">.</span><span class="at">labelLegend</span>)<span class="op">,</span> </span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>      <span class="dt">formatFunc</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">formatNumCompactShort</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(d)<span class="sc">}</span><span class="vs">%`</span><span class="op">,</span></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorRange</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">range</span><span class="op">.</span><span class="at">redYellowGreen</span><span class="op">,</span></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorUnknown</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">unknown</span><span class="op">,</span></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ag_workforce_data_15"</span><span class="op">,</span></span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataColumn</span><span class="op">:</span> <span class="st">"agw_total_mid_abs"</span><span class="op">,</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_15</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span> </span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelTip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_15</span><span class="op">.</span><span class="at">labelTip</span>)<span class="op">,</span> </span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLegend</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_15</span><span class="op">.</span><span class="at">labelLegend</span>)<span class="op">,</span> </span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>      <span class="dt">formatFunc</span><span class="op">:</span> <span class="fu">formatNumCompactShort</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})<span class="op">,</span></span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorRange</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">range</span><span class="op">.</span><span class="at">yellowGreen</span><span class="op">,</span></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorUnknown</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">unknown</span><span class="op">,</span></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"ag_workforce_data_10"</span><span class="op">,</span></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataColumn</span><span class="op">:</span> <span class="st">"agw_total_abs"</span><span class="op">,</span></span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_10</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span> </span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelTip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_10</span><span class="op">.</span><span class="at">labelTip</span>)<span class="op">,</span> </span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLegend</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">ag_workforce_data_10</span><span class="op">.</span><span class="at">labelLegend</span>)<span class="op">,</span> </span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>      <span class="dt">formatFunc</span><span class="op">:</span> <span class="fu">formatNumCompactShort</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})<span class="op">,</span></span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorRange</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">range</span><span class="op">.</span><span class="at">yellowGreen</span><span class="op">,</span></span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorUnknown</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">unknown</span><span class="op">,</span></span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">radio</span>(options<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span>b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">key</span><span class="op">.</span><span class="fu">localeCompare</span>(a<span class="op">.</span><span class="at">key</span>))<span class="op">,</span> {</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">title</span>)<span class="op">,</span></span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> options<span class="op">.</span><span class="fu">find</span>((t) <span class="kw">=&gt;</span> t<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"ag_workforce_data_2"</span>)</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-7" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="139" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 138"><span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>plotChoroplethGeoImpact <span class="op">=</span> {</span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> mapDataGeoImpact<span class="op">;</span></span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selector <span class="op">=</span> selectGeoDataType<span class="op">;</span></span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allValues <span class="op">=</span> data<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">flatMap</span>((d) <span class="kw">=&gt;</span></span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>    d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[selector<span class="op">.</span><span class="at">dataColumn</span>] <span class="op">!==</span> <span class="kw">undefined</span></span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> [<span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[selector<span class="op">.</span><span class="at">dataColumn</span>])]</span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> []</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> caption <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">map</span><span class="op">.</span><span class="at">caption</span>)<span class="op">,</span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a>    [{ <span class="dt">name</span><span class="op">:</span> <span class="st">"selector"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> selector<span class="op">.</span><span class="at">label</span> }]</span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return plot</span></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> mapWidth<span class="op">,</span></span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>    caption<span class="op">,</span></span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> {</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"azimuthal-equal-area"</span><span class="op">,</span></span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> data</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">labelLegend</span><span class="op">,</span></span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> selector<span class="op">.</span><span class="at">colorRange</span><span class="op">,</span></span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>      <span class="dt">unknown</span><span class="op">:</span> selector<span class="op">.</span><span class="at">colorUnknown</span><span class="op">,</span></span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Check if dataColumn is one of the specified types</span></span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (</span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>          selector<span class="op">.</span><span class="at">dataColumn</span> <span class="op">===</span> <span class="st">"corrected_ag_pop"</span> <span class="op">||</span></span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>          selector<span class="op">.</span><span class="at">dataColumn</span> <span class="op">===</span> <span class="st">"agw_total_mid_abs"</span> <span class="op">||</span></span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>          selector<span class="op">.</span><span class="at">dataColumn</span> <span class="op">===</span> <span class="st">"agw_total_abs"</span></span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>        ) {</span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>          <span class="co">// Use the provided formatFunc and append a "%" symbol for these types</span></span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> selector<span class="op">.</span><span class="fu">formatFunc</span>(d)<span class="op">;</span></span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>          <span class="co">// For other types, just use the formatFunc without appending a "%" symbol</span></span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>selector<span class="op">.</span><span class="fu">formatFunc</span>(d)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span></span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a>        selector<span class="op">.</span><span class="at">dataColumn</span> <span class="op">===</span> <span class="st">"corrected_ag_pop"</span> <span class="op">||</span></span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>        selector<span class="op">.</span><span class="at">dataColumn</span> <span class="op">===</span> <span class="st">"agw_total_mid_abs"</span> <span class="op">||</span></span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>        selector<span class="op">.</span><span class="at">dataColumn</span> <span class="op">===</span> <span class="st">"agw_total_abs"</span></span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a>          <span class="op">?</span> [<span class="dv">0</span><span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>allValues)]</span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a>          <span class="op">:</span> [<span class="op">-</span><span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>allValues)<span class="op">,</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>allValues)]</span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a>      <span class="co">// geo data</span></span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">geo</span>(data<span class="op">.</span><span class="at">features</span><span class="op">,</span> {</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> dataColumn <span class="op">=</span> selector<span class="op">.</span><span class="at">dataColumn</span><span class="op">;</span></span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> fillValue <span class="op">=</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span></span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a>            <span class="op">?</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[dataColumn]</span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// handle missing data</span></span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> fillValue<span class="op">;</span></span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>      <span class="co">// admin2 highlight</span></span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a>      <span class="co">// if Admin selection includes admin2, highlight section</span></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">geo</span>(</span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>        adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>          <span class="op">?</span> data<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a>              (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin2_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a>          <span class="op">:</span> []<span class="op">,</span></span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#333"</span><span class="op">,</span></span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">1.5</span></span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a>      <span class="co">// geo pointer</span></span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">geo</span>(</span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a>        data<span class="op">,</span></span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointer</span>(</span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">centroid</span>({</span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a>            <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#333"</span><span class="op">,</span></span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a>            <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">1.5</span></span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a>      <span class="co">// tooltip</span></span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">tip</span>(</span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="at">features</span><span class="op">,</span></span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointer</span>(</span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">centroid</span>({</span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a>            <span class="dt">channels</span><span class="op">:</span> {</span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a>              <span class="dt">name</span><span class="op">:</span> {</span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a>                <span class="co">// region label, based on selection</span></span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toTitleCase</span>(<span class="fu">getLowerLevelAdminLabel</span>())<span class="op">,</span> <span class="co">// plot-level so inputs don't reload</span></span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">_lang</span>(td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin_name</span>]) <span class="op">??</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin_name</span></span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a>              <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">labelTip</span><span class="op">,</span></span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> dataColumn <span class="op">=</span> selector<span class="op">.</span><span class="at">dataColumn</span><span class="op">;</span></span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> data <span class="op">=</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span></span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a>                    <span class="op">?</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[dataColumn]</span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a>                    <span class="op">:</span> <span class="kw">undefined</span><span class="op">;</span></span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a>            <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a>              <span class="dt">name</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>              <span class="dt">data</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="vs">`</span><span class="sc">${</span>selector<span class="op">.</span><span class="fu">formatFunc</span>(d)<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-8" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="261" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 260"><span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a><span class="fu">buildInlineDownloadButton</span>(</span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a>  dataGeoImpact<span class="op">,</span></span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a>  <span class="fu">_lang</span>(download_translation)<span class="op">,</span></span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`agWorkforce_</span><span class="sc">${</span>selectAdmin0<span class="op">.</span><span class="at">label</span><span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">\s</span><span class="ss">/g</span><span class="op">,</span> <span class="st">""</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-9" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="269" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 268"><span id="cb10-269"><a href="#cb10-269" aria-hidden="true" tabindex="-1"></a>headerQuickInsightsGeoImpact <span class="op">=</span> {</span>
<span id="cb10-270"><a href="#cb10-270" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminArticle <span class="op">=</span> <span class="fu">_lang</span>(<span class="fu">getAdminSelection</span>()<span class="op">?.</span><span class="at">data</span><span class="op">?.</span><span class="at">article1</span>)<span class="op">;</span></span>
<span id="cb10-271"><a href="#cb10-271" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminSelection <span class="op">=</span> adminArticle <span class="op">??</span> <span class="fu">getAdminSelection</span>()<span class="op">.</span><span class="at">label</span><span class="op">;</span></span>
<span id="cb10-272"><a href="#cb10-272" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb10-273"><a href="#cb10-273" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">quickInsightsGeneral</span><span class="op">.</span><span class="at">header</span>)<span class="op">,</span></span>
<span id="cb10-274"><a href="#cb10-274" aria-hidden="true" tabindex="-1"></a>    [{ <span class="dt">name</span><span class="op">:</span> <span class="st">"selection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> adminSelection }]</span>
<span id="cb10-275"><a href="#cb10-275" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb10-276"><a href="#cb10-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-277"><a href="#cb10-277" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`### </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb10-278"><a href="#cb10-278" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-10" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb11" data-startfrom="282" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 281"><span id="cb11-282"><a href="#cb11-282" aria-hidden="true" tabindex="-1"></a><span class="co">// text insights for geo impact</span></span>
<span id="cb11-283"><a href="#cb11-283" aria-hidden="true" tabindex="-1"></a>textDynamicInsights_geoImpact <span class="op">=</span> {</span>
<span id="cb11-284"><a href="#cb11-284" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminSelection <span class="op">=</span> <span class="fu">getAdmin0WithAdminSubParens</span>({<span class="dt">articleField</span><span class="op">:</span> <span class="st">"article2"</span>})<span class="op">;</span></span>
<span id="cb11-285"><a href="#cb11-285" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> i <span class="op">=</span> dynamicInsights_geoImpact<span class="op">.</span><span class="at">insight</span><span class="op">;</span></span>
<span id="cb11-286"><a href="#cb11-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-287"><a href="#cb11-287" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentAgPop <span class="op">=</span> i<span class="op">.</span><span class="at">totalAgPop_noformat</span><span class="op">;</span></span>
<span id="cb11-288"><a href="#cb11-288" aria-hidden="true" tabindex="-1"></a>  <span class="co">// totalVop is the projected change in agricultural population by 2050</span></span>
<span id="cb11-289"><a href="#cb11-289" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projectedChange2050 <span class="op">=</span> i<span class="op">.</span><span class="at">totalAgPop_2_50_noformat</span><span class="op">;</span></span>
<span id="cb11-290"><a href="#cb11-290" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projectedChange2030 <span class="op">=</span> i<span class="op">.</span><span class="at">totalAgPop_2_30_noformat</span><span class="op">;</span></span>
<span id="cb11-291"><a href="#cb11-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-292"><a href="#cb11-292" aria-hidden="true" tabindex="-1"></a>  <span class="co">// string for percent change</span></span>
<span id="cb11-293"><a href="#cb11-293" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> percChangeType <span class="op">=</span> (d) <span class="kw">=&gt;</span></span>
<span id="cb11-294"><a href="#cb11-294" aria-hidden="true" tabindex="-1"></a>    d <span class="op">&gt;=</span> <span class="dv">0</span></span>
<span id="cb11-295"><a href="#cb11-295" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">quickInsights</span><span class="op">.</span><span class="at">direction</span><span class="op">.</span><span class="at">inc</span>)</span>
<span id="cb11-296"><a href="#cb11-296" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">quickInsights</span><span class="op">.</span><span class="at">direction</span><span class="op">.</span><span class="at">dec</span>)<span class="op">;</span></span>
<span id="cb11-297"><a href="#cb11-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-298"><a href="#cb11-298" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate the new total agricultural population for 2050</span></span>
<span id="cb11-299"><a href="#cb11-299" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> newTotalAgPop2050 <span class="op">=</span> currentAgPop <span class="op">+</span> projectedChange2050<span class="op">;</span></span>
<span id="cb11-300"><a href="#cb11-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-301"><a href="#cb11-301" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate the percentage change</span></span>
<span id="cb11-302"><a href="#cb11-302" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> percentChange50 <span class="op">=</span></span>
<span id="cb11-303"><a href="#cb11-303" aria-hidden="true" tabindex="-1"></a>    ((projectedChange2050 <span class="op">-</span> currentAgPop) <span class="op">/</span> currentAgPop) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb11-304"><a href="#cb11-304" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> changeType50 <span class="op">=</span> <span class="fu">percChangeType</span>(percentChange50)<span class="op">;</span></span>
<span id="cb11-305"><a href="#cb11-305" aria-hidden="true" tabindex="-1"></a>  percentChange50 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(percentChange50)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span> <span class="co">// Keeping two decimals for readability</span></span>
<span id="cb11-306"><a href="#cb11-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-307"><a href="#cb11-307" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> percentChange30 <span class="op">=</span></span>
<span id="cb11-308"><a href="#cb11-308" aria-hidden="true" tabindex="-1"></a>    ((projectedChange2030 <span class="op">-</span> currentAgPop) <span class="op">/</span> currentAgPop) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb11-309"><a href="#cb11-309" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> changeType30 <span class="op">=</span> <span class="fu">percChangeType</span>(percentChange30)<span class="op">;</span></span>
<span id="cb11-310"><a href="#cb11-310" aria-hidden="true" tabindex="-1"></a>  percentChange30 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(percentChange30)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span> <span class="co">// Keeping two decimals for readability</span></span>
<span id="cb11-311"><a href="#cb11-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-312"><a href="#cb11-312" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> percentChange_5 <span class="op">=</span></span>
<span id="cb11-313"><a href="#cb11-313" aria-hidden="true" tabindex="-1"></a>    ((i<span class="op">.</span><span class="at">totalAgPop_5_50_noformat</span> <span class="op">-</span> currentAgPop) <span class="op">/</span> currentAgPop) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb11-314"><a href="#cb11-314" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> changeType_5 <span class="op">=</span> <span class="fu">percChangeType</span>(percentChange_5)<span class="op">;</span></span>
<span id="cb11-315"><a href="#cb11-315" aria-hidden="true" tabindex="-1"></a>  percentChange_5 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(percentChange_5)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span> <span class="co">// Keeping two decimals for readability</span></span>
<span id="cb11-316"><a href="#cb11-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-317"><a href="#cb11-317" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> percentChange30_5 <span class="op">=</span></span>
<span id="cb11-318"><a href="#cb11-318" aria-hidden="true" tabindex="-1"></a>    ((i<span class="op">.</span><span class="at">totalAgPop_5_30_noformat</span> <span class="op">-</span> currentAgPop) <span class="op">/</span> currentAgPop) <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb11-319"><a href="#cb11-319" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> changeType30_5 <span class="op">=</span> <span class="fu">percChangeType</span>(percentChange30_5)<span class="op">;</span></span>
<span id="cb11-320"><a href="#cb11-320" aria-hidden="true" tabindex="-1"></a>  percentChange30_5 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(percentChange30_5)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span> <span class="co">// Keeping two decimals for readability</span></span>
<span id="cb11-321"><a href="#cb11-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-322"><a href="#cb11-322" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedCountry <span class="op">=</span> <span class="fu">getAdminSelection0</span>()<span class="op">.</span><span class="at">value</span><span class="op">;</span> <span class="co">// Function to get the selected country</span></span>
<span id="cb11-323"><a href="#cb11-323" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> countriesWithoutData <span class="op">=</span> [</span>
<span id="cb11-324"><a href="#cb11-324" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Burundi"</span><span class="op">,</span></span>
<span id="cb11-325"><a href="#cb11-325" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rwanda"</span><span class="op">,</span></span>
<span id="cb11-326"><a href="#cb11-326" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lesotho"</span><span class="op">,</span></span>
<span id="cb11-327"><a href="#cb11-327" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gabon"</span><span class="op">,</span></span>
<span id="cb11-328"><a href="#cb11-328" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Eswatini"</span><span class="op">,</span></span>
<span id="cb11-329"><a href="#cb11-329" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Equatorial Guinea"</span></span>
<span id="cb11-330"><a href="#cb11-330" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb11-331"><a href="#cb11-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-332"><a href="#cb11-332" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insightBase <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb11-333"><a href="#cb11-333" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">quickInsights</span><span class="op">.</span><span class="at">basePop</span>)<span class="op">,</span></span>
<span id="cb11-334"><a href="#cb11-334" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb11-335"><a href="#cb11-335" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"geo"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> adminSelection }<span class="op">,</span></span>
<span id="cb11-336"><a href="#cb11-336" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"total"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i<span class="op">.</span><span class="at">totalAgPop</span> }</span>
<span id="cb11-337"><a href="#cb11-337" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb11-338"><a href="#cb11-338" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb11-339"><a href="#cb11-339" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insightPopChange <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb11-340"><a href="#cb11-340" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">quickInsights</span><span class="op">.</span><span class="at">popChange</span>)<span class="op">,</span></span>
<span id="cb11-341"><a href="#cb11-341" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb11-342"><a href="#cb11-342" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"change2030"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i<span class="op">.</span><span class="at">totalAgPop_2_30</span> }<span class="op">,</span></span>
<span id="cb11-343"><a href="#cb11-343" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"change2050"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i<span class="op">.</span><span class="at">totalAgPop_2_50</span> }<span class="op">,</span></span>
<span id="cb11-344"><a href="#cb11-344" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"direction2030"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> changeType30 }<span class="op">,</span></span>
<span id="cb11-345"><a href="#cb11-345" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"direction2050"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> changeType50 }<span class="op">,</span></span>
<span id="cb11-346"><a href="#cb11-346" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"perc2030"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> percentChange30 }<span class="op">,</span></span>
<span id="cb11-347"><a href="#cb11-347" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"perc2050"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> percentChange50 }</span>
<span id="cb11-348"><a href="#cb11-348" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb11-349"><a href="#cb11-349" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb11-350"><a href="#cb11-350" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insightPopScenario <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb11-351"><a href="#cb11-351" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">futureWorkforce</span><span class="op">.</span><span class="at">quickInsights</span><span class="op">.</span><span class="at">popScenario</span>)<span class="op">,</span></span>
<span id="cb11-352"><a href="#cb11-352" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb11-353"><a href="#cb11-353" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"pop2030"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i<span class="op">.</span><span class="at">totalAgPop_5_30</span> }<span class="op">,</span></span>
<span id="cb11-354"><a href="#cb11-354" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"pop2050"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i<span class="op">.</span><span class="at">totalAgPop_5_50</span> }<span class="op">,</span></span>
<span id="cb11-355"><a href="#cb11-355" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"direction"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> changeType30_5 }<span class="op">,</span></span>
<span id="cb11-356"><a href="#cb11-356" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"perc2030"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> percentChange30_5 }<span class="op">,</span></span>
<span id="cb11-357"><a href="#cb11-357" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"perc2050"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> percentChange_5 }</span>
<span id="cb11-358"><a href="#cb11-358" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb11-359"><a href="#cb11-359" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-360"><a href="#cb11-360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-361"><a href="#cb11-361" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check if the selected country is in the list of countries without data</span></span>
<span id="cb11-362"><a href="#cb11-362" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (countriesWithoutData<span class="op">.</span><span class="fu">includes</span>(selectedCountry)) {</span>
<span id="cb11-363"><a href="#cb11-363" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">quickInsightsGeneral</span><span class="op">.</span><span class="at">noDataBlurb</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb11-364"><a href="#cb11-364" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb11-365"><a href="#cb11-365" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>styling<span class="sc">}${</span>insightBase<span class="sc">}</span></span>
<span id="cb11-366"><a href="#cb11-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-367"><a href="#cb11-367" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>insightPopChange<span class="sc">}</span></span>
<span id="cb11-368"><a href="#cb11-368" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-369"><a href="#cb11-369" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>insightPopScenario<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb11-370"><a href="#cb11-370" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb11-371"><a href="#cb11-371" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-11" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb12" data-startfrom="375" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 374"><span id="cb12-375"><a href="#cb12-375" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-12" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb13" data-startfrom="379" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 378"><span id="cb13-379"><a href="#cb13-379" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">intro</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-13" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb14" data-startfrom="383" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 382"><span id="cb14-383"><a href="#cb14-383" aria-hidden="true" tabindex="-1"></a><span class="co">// format admin selections</span></span>
<span id="cb14-384"><a href="#cb14-384" aria-hidden="true" tabindex="-1"></a><span class="co">// bind to appendix inputs, add template to format</span></span>
<span id="cb14-385"><a href="#cb14-385" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb14-386"><a href="#cb14-386" aria-hidden="true" tabindex="-1"></a>  [</span>
<span id="cb14-387"><a href="#cb14-387" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb14-388"><a href="#cb14-388" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin0<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb14-389"><a href="#cb14-389" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin0</span>
<span id="cb14-390"><a href="#cb14-390" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb14-391"><a href="#cb14-391" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb14-392"><a href="#cb14-392" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin1<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb14-393"><a href="#cb14-393" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin1</span>
<span id="cb14-394"><a href="#cb14-394" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb14-395"><a href="#cb14-395" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb14-396"><a href="#cb14-396" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin2<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb14-397"><a href="#cb14-397" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin2</span>
<span id="cb14-398"><a href="#cb14-398" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb14-399"><a href="#cb14-399" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb14-400"><a href="#cb14-400" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb14-401"><a href="#cb14-401" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> adminFormTemplate</span>
<span id="cb14-402"><a href="#cb14-402" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-403"><a href="#cb14-403" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-14" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb15" data-startfrom="407" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 406"><span id="cb15-407"><a href="#cb15-407" aria-hidden="true" tabindex="-1"></a>viewof selectScenarioAndTimeframe <span class="op">=</span> {</span>
<span id="cb15-408"><a href="#cb15-408" aria-hidden="true" tabindex="-1"></a>  <span class="co">// scenario and timeframe</span></span>
<span id="cb15-409"><a href="#cb15-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-410"><a href="#cb15-410" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> [</span>
<span id="cb15-411"><a href="#cb15-411" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'SSP245: 2030'</span><span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'SSP2'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'2030'</span>}<span class="op">,</span></span>
<span id="cb15-412"><a href="#cb15-412" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'SSP245: 2050'</span><span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'SSP2'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'2050'</span>}<span class="op">,</span></span>
<span id="cb15-413"><a href="#cb15-413" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'SSP585: 2030'</span><span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'SSP5'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'2030'</span>}<span class="op">,</span></span>
<span id="cb15-414"><a href="#cb15-414" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'SSP585: 2050'</span><span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'SSP5'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'2050'</span>}<span class="op">,</span></span>
<span id="cb15-415"><a href="#cb15-415" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb15-416"><a href="#cb15-416" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-417"><a href="#cb15-417" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(data<span class="op">,</span> {</span>
<span id="cb15-418"><a href="#cb15-418" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">scenario</span>)<span class="op">,</span></span>
<span id="cb15-419"><a href="#cb15-419" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb15-420"><a href="#cb15-420" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> data<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span> <span class="op">===</span> <span class="st">'SSP245: 2050'</span>)</span>
<span id="cb15-421"><a href="#cb15-421" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb15-422"><a href="#cb15-422" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-15" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb16" data-startfrom="426" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 425"><span id="cb16-426"><a href="#cb16-426" aria-hidden="true" tabindex="-1"></a>viewof selectThreshold <span class="op">=</span> {</span>
<span id="cb16-427"><a href="#cb16-427" aria-hidden="true" tabindex="-1"></a>  <span class="co">// scenario and timeframe</span></span>
<span id="cb16-428"><a href="#cb16-428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-429"><a href="#cb16-429" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> [</span>
<span id="cb16-430"><a href="#cb16-430" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'28C'</span><span class="op">,</span> <span class="dt">threshold</span><span class="op">:</span> <span class="st">'28'</span>}<span class="op">,</span></span>
<span id="cb16-431"><a href="#cb16-431" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'30C'</span><span class="op">,</span> <span class="dt">threshold</span><span class="op">:</span> <span class="st">'30'</span>}<span class="op">,</span></span>
<span id="cb16-432"><a href="#cb16-432" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb16-433"><a href="#cb16-433" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-434"><a href="#cb16-434" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(data<span class="op">,</span> {</span>
<span id="cb16-435"><a href="#cb16-435" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">threshold</span>)<span class="op">,</span></span>
<span id="cb16-436"><a href="#cb16-436" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb16-437"><a href="#cb16-437" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> data<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span> <span class="op">===</span> <span class="st">'28'</span>)</span>
<span id="cb16-438"><a href="#cb16-438" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb16-439"><a href="#cb16-439" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-16" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb17" data-startfrom="443" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 442"><span id="cb17-443"><a href="#cb17-443" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-444"><a href="#cb17-444" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _anyData <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb17-445"><a href="#cb17-445" aria-hidden="true" tabindex="-1"></a>    data_hazardVoP<span class="op">,</span></span>
<span id="cb17-446"><a href="#cb17-446" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb17-447"><a href="#cb17-447" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb17-448"><a href="#cb17-448" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb17-449"><a href="#cb17-449" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb17-450"><a href="#cb17-450" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb17-451"><a href="#cb17-451" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb17-452"><a href="#cb17-452" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb17-453"><a href="#cb17-453" aria-hidden="true" tabindex="-1"></a>        <span class="st">"threshold"</span><span class="op">,</span></span>
<span id="cb17-454"><a href="#cb17-454" aria-hidden="true" tabindex="-1"></a>        <span class="st">"crop"</span></span>
<span id="cb17-455"><a href="#cb17-455" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb17-456"><a href="#cb17-456" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb17-457"><a href="#cb17-457" aria-hidden="true" tabindex="-1"></a>        T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb17-458"><a href="#cb17-458" aria-hidden="true" tabindex="-1"></a>          <span class="dt">vop_any</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"vop"</span>)</span>
<span id="cb17-459"><a href="#cb17-459" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb17-460"><a href="#cb17-460" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb17-461"><a href="#cb17-461" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb17-462"><a href="#cb17-462" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb17-463"><a href="#cb17-463" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-464"><a href="#cb17-464" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _dataWithAnyColumn <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb17-465"><a href="#cb17-465" aria-hidden="true" tabindex="-1"></a>    data_hazardVoP<span class="op">,</span></span>
<span id="cb17-466"><a href="#cb17-466" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">leftJoin</span>(_anyData<span class="op">,</span> {</span>
<span id="cb17-467"><a href="#cb17-467" aria-hidden="true" tabindex="-1"></a>      <span class="dt">by</span><span class="op">:</span> [</span>
<span id="cb17-468"><a href="#cb17-468" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb17-469"><a href="#cb17-469" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb17-470"><a href="#cb17-470" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb17-471"><a href="#cb17-471" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb17-472"><a href="#cb17-472" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb17-473"><a href="#cb17-473" aria-hidden="true" tabindex="-1"></a>        <span class="st">"crop"</span><span class="op">,</span></span>
<span id="cb17-474"><a href="#cb17-474" aria-hidden="true" tabindex="-1"></a>        <span class="st">"threshold"</span></span>
<span id="cb17-475"><a href="#cb17-475" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb17-476"><a href="#cb17-476" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb17-477"><a href="#cb17-477" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb17-478"><a href="#cb17-478" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-479"><a href="#cb17-479" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> _dataWithAnyColumn<span class="op">;</span></span>
<span id="cb17-480"><a href="#cb17-480" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataAny <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> <span class="st">"any"</span>)<span class="op">;</span> <span class="co">// combined</span></span>
<span id="cb17-481"><a href="#cb17-481" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataBars <span class="op">=</span> [</span>
<span id="cb17-482"><a href="#cb17-482" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">!==</span> <span class="st">"any"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">vop</span> <span class="op">!==</span> <span class="dv">0</span>) <span class="co">// remove the combined hazard</span></span>
<span id="cb17-483"><a href="#cb17-483" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb17-484"><a href="#cb17-484" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _formatNumber <span class="op">=</span> <span class="fu">formatNumCompactShort</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})<span class="op">;</span></span>
<span id="cb17-485"><a href="#cb17-485" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xDomain <span class="op">=</span> cropNames</span>
<span id="cb17-486"><a href="#cb17-486" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb17-487"><a href="#cb17-487" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> availableCrops <span class="op">=</span> _<span class="op">.</span><span class="fu">uniq</span>(dataBars<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">crop</span>))<span class="op">;</span></span>
<span id="cb17-488"><a href="#cb17-488" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> availableCrops<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">crop</span>)<span class="op">;</span></span>
<span id="cb17-489"><a href="#cb17-489" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb17-490"><a href="#cb17-490" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb17-491"><a href="#cb17-491" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> upperBound <span class="op">=</span> <span class="pp">parseInt</span>(d<span class="op">.</span><span class="at">cropName</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span> <span class="co">// Assuming cropName is the upper bound</span></span>
<span id="cb17-492"><a href="#cb17-492" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lowerBound <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> upperBound <span class="op">-</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb17-493"><a href="#cb17-493" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>lowerBound<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>upperBound<span class="sc">}</span><span class="vs">%`</span><span class="op">;</span></span>
<span id="cb17-494"><a href="#cb17-494" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb17-495"><a href="#cb17-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-496"><a href="#cb17-496" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> maxValue <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(dataBars<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">vop</span>) <span class="op">*</span> <span class="fl">1.5</span><span class="op">;</span> <span class="co">// adding 10% buffer</span></span>
<span id="cb17-497"><a href="#cb17-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-498"><a href="#cb17-498" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb17-499"><a href="#cb17-499" aria-hidden="true" tabindex="-1"></a>    <span class="co">// caption: `To ensure that the details across all bins are visible without being dominated by the initial range, the 0-5% bin has been intentionally excluded from this visualization.`,</span></span>
<span id="cb17-500"><a href="#cb17-500" aria-hidden="true" tabindex="-1"></a>    <span class="dt">caption</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">caption</span>)<span class="op">,</span></span>
<span id="cb17-501"><a href="#cb17-501" aria-hidden="true" tabindex="-1"></a>    width<span class="op">,</span></span>
<span id="cb17-502"><a href="#cb17-502" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">600</span><span class="op">,</span></span>
<span id="cb17-503"><a href="#cb17-503" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb17-504"><a href="#cb17-504" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb17-505"><a href="#cb17-505" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb17-506"><a href="#cb17-506" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb17-507"><a href="#cb17-507" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span><span class="op">,</span></span>
<span id="cb17-508"><a href="#cb17-508" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">range</span><span class="op">,</span></span>
<span id="cb17-509"><a href="#cb17-509" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb17-510"><a href="#cb17-510" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb17-511"><a href="#cb17-511" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb17-512"><a href="#cb17-512" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> xDomain<span class="op">,</span></span>
<span id="cb17-513"><a href="#cb17-513" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">xLabel</span>)<span class="op">,</span></span>
<span id="cb17-514"><a href="#cb17-514" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelStyle</span><span class="op">:</span> { <span class="dt">fontSize</span><span class="op">:</span> <span class="st">'36px'</span> }<span class="op">,</span> <span class="co">// Hypothetical API</span></span>
<span id="cb17-515"><a href="#cb17-515" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb17-516"><a href="#cb17-516" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb17-517"><a href="#cb17-517" aria-hidden="true" tabindex="-1"></a>      <span class="dt">nice</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb17-518"><a href="#cb17-518" aria-hidden="true" tabindex="-1"></a>      <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb17-519"><a href="#cb17-519" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">yLabel</span>)<span class="op">,</span></span>
<span id="cb17-520"><a href="#cb17-520" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> d <span class="kw">=&gt;</span> <span class="fu">_formatNumber</span>(d)<span class="op">,</span></span>
<span id="cb17-521"><a href="#cb17-521" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb17-522"><a href="#cb17-522" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb17-523"><a href="#cb17-523" aria-hidden="true" tabindex="-1"></a>      <span class="co">// main x-axis</span></span>
<span id="cb17-524"><a href="#cb17-524" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisX</span>({</span>
<span id="cb17-525"><a href="#cb17-525" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb17-526"><a href="#cb17-526" aria-hidden="true" tabindex="-1"></a>        <span class="co">// lineWidth: 3,</span></span>
<span id="cb17-527"><a href="#cb17-527" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb17-528"><a href="#cb17-528" aria-hidden="true" tabindex="-1"></a>      <span class="co">// pointer white-out</span></span>
<span id="cb17-529"><a href="#cb17-529" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisX</span>(</span>
<span id="cb17-530"><a href="#cb17-530" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerX</span>({</span>
<span id="cb17-531"><a href="#cb17-531" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb17-532"><a href="#cb17-532" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb17-533"><a href="#cb17-533" aria-hidden="true" tabindex="-1"></a>          <span class="dt">textStroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb17-534"><a href="#cb17-534" aria-hidden="true" tabindex="-1"></a>          <span class="dt">textStrokeWidth</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb17-535"><a href="#cb17-535" aria-hidden="true" tabindex="-1"></a>          <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb17-536"><a href="#cb17-536" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb17-537"><a href="#cb17-537" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb17-538"><a href="#cb17-538" aria-hidden="true" tabindex="-1"></a>      <span class="co">// bold pointer</span></span>
<span id="cb17-539"><a href="#cb17-539" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisX</span>(</span>
<span id="cb17-540"><a href="#cb17-540" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerX</span>({</span>
<span id="cb17-541"><a href="#cb17-541" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb17-542"><a href="#cb17-542" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb17-543"><a href="#cb17-543" aria-hidden="true" tabindex="-1"></a>          <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb17-544"><a href="#cb17-544" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb17-545"><a href="#cb17-545" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb17-546"><a href="#cb17-546" aria-hidden="true" tabindex="-1"></a>      <span class="co">// hazard component bars</span></span>
<span id="cb17-547"><a href="#cb17-547" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barY</span>(</span>
<span id="cb17-548"><a href="#cb17-548" aria-hidden="true" tabindex="-1"></a>        dataBars<span class="op">,</span></span>
<span id="cb17-549"><a href="#cb17-549" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">stackY</span>(</span>
<span id="cb17-550"><a href="#cb17-550" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">order</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span> }<span class="op">,</span></span>
<span id="cb17-551"><a href="#cb17-551" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb17-552"><a href="#cb17-552" aria-hidden="true" tabindex="-1"></a>            <span class="dt">y</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">vop</span><span class="op">,</span></span>
<span id="cb17-553"><a href="#cb17-553" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb17-554"><a href="#cb17-554" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> upperBound <span class="op">=</span> <span class="pp">parseInt</span>(hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[d<span class="op">.</span><span class="at">crop</span>]<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span> <span class="co">// Assuming this gives the upper bound as before</span></span>
<span id="cb17-555"><a href="#cb17-555" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> lowerBound <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> upperBound <span class="op">-</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb17-556"><a href="#cb17-556" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>lowerBound<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>upperBound<span class="sc">}</span><span class="vs">%`</span><span class="op">;</span></span>
<span id="cb17-557"><a href="#cb17-557" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb17-558"><a href="#cb17-558" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]<span class="op">,</span></span>
<span id="cb17-559"><a href="#cb17-559" aria-hidden="true" tabindex="-1"></a>            <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb17-560"><a href="#cb17-560" aria-hidden="true" tabindex="-1"></a>            <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.25</span></span>
<span id="cb17-561"><a href="#cb17-561" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb17-562"><a href="#cb17-562" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-563"><a href="#cb17-563" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb17-564"><a href="#cb17-564" aria-hidden="true" tabindex="-1"></a>      <span class="co">// tooltip</span></span>
<span id="cb17-565"><a href="#cb17-565" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">tip</span>(</span>
<span id="cb17-566"><a href="#cb17-566" aria-hidden="true" tabindex="-1"></a>        dataBars<span class="op">,</span></span>
<span id="cb17-567"><a href="#cb17-567" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerX</span>(</span>
<span id="cb17-568"><a href="#cb17-568" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">stackY</span>(</span>
<span id="cb17-569"><a href="#cb17-569" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">order</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span> }<span class="op">,</span></span>
<span id="cb17-570"><a href="#cb17-570" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb17-571"><a href="#cb17-571" aria-hidden="true" tabindex="-1"></a>              <span class="dt">y</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">vop</span><span class="op">,</span></span>
<span id="cb17-572"><a href="#cb17-572" aria-hidden="true" tabindex="-1"></a>              <span class="dt">x</span><span class="op">:</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb17-573"><a href="#cb17-573" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> upperBound <span class="op">=</span> <span class="pp">parseInt</span>(hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[d<span class="op">.</span><span class="at">crop</span>]<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span> <span class="co">// Assuming this gives the upper bound as before</span></span>
<span id="cb17-574"><a href="#cb17-574" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> lowerBound <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> upperBound <span class="op">-</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb17-575"><a href="#cb17-575" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>lowerBound<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>upperBound<span class="sc">}</span><span class="vs">%`</span><span class="op">;</span></span>
<span id="cb17-576"><a href="#cb17-576" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb17-577"><a href="#cb17-577" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]<span class="op">,</span></span>
<span id="cb17-578"><a href="#cb17-578" aria-hidden="true" tabindex="-1"></a>              <span class="dt">channels</span><span class="op">:</span> {</span>
<span id="cb17-579"><a href="#cb17-579" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hazard</span><span class="op">:</span> {</span>
<span id="cb17-580"><a href="#cb17-580" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">tooltip</span><span class="op">.</span><span class="at">period</span>)<span class="op">,</span></span>
<span id="cb17-581"><a href="#cb17-581" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]</span>
<span id="cb17-582"><a href="#cb17-582" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb17-583"><a href="#cb17-583" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vop</span><span class="op">:</span> {</span>
<span id="cb17-584"><a href="#cb17-584" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">tooltip</span><span class="op">.</span><span class="at">exposed</span>)<span class="op">,</span></span>
<span id="cb17-585"><a href="#cb17-585" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb17-586"><a href="#cb17-586" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">const</span> vop <span class="op">=</span> d<span class="op">.</span><span class="at">vop</span><span class="op">;</span></span>
<span id="cb17-587"><a href="#cb17-587" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="vs">`(</span><span class="sc">${</span>vop<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb17-588"><a href="#cb17-588" aria-hidden="true" tabindex="-1"></a>                  }<span class="op">,</span></span>
<span id="cb17-589"><a href="#cb17-589" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span>  (d) <span class="kw">=&gt;</span>  <span class="fu">_formatNumber</span>(d<span class="op">.</span><span class="at">vop</span>)</span>
<span id="cb17-590"><a href="#cb17-590" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb17-591"><a href="#cb17-591" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb17-592"><a href="#cb17-592" aria-hidden="true" tabindex="-1"></a>              <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb17-593"><a href="#cb17-593" aria-hidden="true" tabindex="-1"></a>                <span class="dt">x</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb17-594"><a href="#cb17-594" aria-hidden="true" tabindex="-1"></a>                <span class="dt">y</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb17-595"><a href="#cb17-595" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fill</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb17-596"><a href="#cb17-596" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vop</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb17-597"><a href="#cb17-597" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hazard</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb17-598"><a href="#cb17-598" aria-hidden="true" tabindex="-1"></a>                <span class="dt">perc</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb17-599"><a href="#cb17-599" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb17-600"><a href="#cb17-600" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb17-601"><a href="#cb17-601" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb17-602"><a href="#cb17-602" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb17-603"><a href="#cb17-603" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb17-604"><a href="#cb17-604" aria-hidden="true" tabindex="-1"></a>      <span class="co">// total VoP, sidebar highlight</span></span>
<span id="cb17-605"><a href="#cb17-605" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">textY</span>(</span>
<span id="cb17-606"><a href="#cb17-606" aria-hidden="true" tabindex="-1"></a>        dataAny<span class="op">,</span></span>
<span id="cb17-607"><a href="#cb17-607" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointer</span>({</span>
<span id="cb17-608"><a href="#cb17-608" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> maxValue<span class="op">,</span></span>
<span id="cb17-609"><a href="#cb17-609" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> d <span class="kw">=&gt;</span> {</span>
<span id="cb17-610"><a href="#cb17-610" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> upperBound <span class="op">=</span> <span class="pp">parseInt</span>(hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[d<span class="op">.</span><span class="at">crop</span>]<span class="op">,</span> <span class="dv">10</span>)<span class="op">;</span> <span class="co">// Assuming this gives the upper bound as before</span></span>
<span id="cb17-611"><a href="#cb17-611" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> lowerBound <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="dv">0</span><span class="op">,</span> upperBound <span class="op">-</span> <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb17-612"><a href="#cb17-612" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>lowerBound<span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>upperBound<span class="sc">}</span><span class="vs">%`</span><span class="op">;</span></span>
<span id="cb17-613"><a href="#cb17-613" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb17-614"><a href="#cb17-614" aria-hidden="true" tabindex="-1"></a>          <span class="dt">text</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb17-615"><a href="#cb17-615" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> value <span class="op">=</span> d<span class="op">.</span><span class="at">vop_total</span><span class="op">;</span></span>
<span id="cb17-616"><a href="#cb17-616" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>value<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb17-617"><a href="#cb17-617" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb17-618"><a href="#cb17-618" aria-hidden="true" tabindex="-1"></a>          <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span></span>
<span id="cb17-619"><a href="#cb17-619" aria-hidden="true" tabindex="-1"></a>          <span class="dt">dx</span><span class="op">:</span> <span class="dv">6</span></span>
<span id="cb17-620"><a href="#cb17-620" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb17-621"><a href="#cb17-621" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb17-622"><a href="#cb17-622" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb17-623"><a href="#cb17-623" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb17-624"><a href="#cb17-624" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-17" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb18" data-startfrom="628" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 627"><span id="cb18-628"><a href="#cb18-628" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb18-629"><a href="#cb18-629" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _anyData <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb18-630"><a href="#cb18-630" aria-hidden="true" tabindex="-1"></a>    data_hazardVoP<span class="op">,</span></span>
<span id="cb18-631"><a href="#cb18-631" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb18-632"><a href="#cb18-632" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb18-633"><a href="#cb18-633" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb18-634"><a href="#cb18-634" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb18-635"><a href="#cb18-635" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb18-636"><a href="#cb18-636" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb18-637"><a href="#cb18-637" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb18-638"><a href="#cb18-638" aria-hidden="true" tabindex="-1"></a>        <span class="st">"threshold"</span><span class="op">,</span></span>
<span id="cb18-639"><a href="#cb18-639" aria-hidden="true" tabindex="-1"></a>        <span class="st">"crop"</span></span>
<span id="cb18-640"><a href="#cb18-640" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb18-641"><a href="#cb18-641" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb18-642"><a href="#cb18-642" aria-hidden="true" tabindex="-1"></a>        T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb18-643"><a href="#cb18-643" aria-hidden="true" tabindex="-1"></a>          <span class="dt">vop_any</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"vop"</span>)</span>
<span id="cb18-644"><a href="#cb18-644" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb18-645"><a href="#cb18-645" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb18-646"><a href="#cb18-646" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-647"><a href="#cb18-647" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb18-648"><a href="#cb18-648" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-649"><a href="#cb18-649" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _dataWithAnyColumn <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb18-650"><a href="#cb18-650" aria-hidden="true" tabindex="-1"></a>    data_hazardVoP<span class="op">,</span></span>
<span id="cb18-651"><a href="#cb18-651" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">leftJoin</span>(_anyData<span class="op">,</span> {</span>
<span id="cb18-652"><a href="#cb18-652" aria-hidden="true" tabindex="-1"></a>      <span class="dt">by</span><span class="op">:</span> [</span>
<span id="cb18-653"><a href="#cb18-653" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb18-654"><a href="#cb18-654" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb18-655"><a href="#cb18-655" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb18-656"><a href="#cb18-656" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb18-657"><a href="#cb18-657" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb18-658"><a href="#cb18-658" aria-hidden="true" tabindex="-1"></a>        <span class="st">"crop"</span><span class="op">,</span></span>
<span id="cb18-659"><a href="#cb18-659" aria-hidden="true" tabindex="-1"></a>        <span class="st">"threshold"</span></span>
<span id="cb18-660"><a href="#cb18-660" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb18-661"><a href="#cb18-661" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb18-662"><a href="#cb18-662" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb18-663"><a href="#cb18-663" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-664"><a href="#cb18-664" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> _dataWithAnyColumn<span class="op">;</span></span>
<span id="cb18-665"><a href="#cb18-665" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">buildInlineDownloadButton</span>(data<span class="op">,</span> <span class="fu">_lang</span>(download_translation)<span class="op">,</span> <span class="vs">`daysUnsafeHeatStress_</span><span class="sc">${</span>selectAdmin0<span class="op">.</span><span class="at">label</span><span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">\s</span><span class="ss">/g</span><span class="op">,</span> <span class="st">""</span>)<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb18-666"><a href="#cb18-666" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-18" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb19" data-startfrom="670" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 669"><span id="cb19-670"><a href="#cb19-670" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">figureBody</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-19" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb20" data-startfrom="674" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 673"><span id="cb20-674"><a href="#cb20-674" aria-hidden="true" tabindex="-1"></a>headerQuickInsightsBars <span class="op">=</span> {</span>
<span id="cb20-675"><a href="#cb20-675" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminArticle <span class="op">=</span> <span class="fu">_lang</span>(<span class="fu">getAdminSelection</span>()<span class="op">?.</span><span class="at">data</span><span class="op">?.</span><span class="at">article1</span>)<span class="op">;</span></span>
<span id="cb20-676"><a href="#cb20-676" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminSelection <span class="op">=</span> adminArticle <span class="op">??</span> <span class="fu">getAdminSelection</span>()<span class="op">.</span><span class="at">label</span><span class="op">;</span></span>
<span id="cb20-677"><a href="#cb20-677" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb20-678"><a href="#cb20-678" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">quickInsightsGeneral</span><span class="op">.</span><span class="at">header</span>)<span class="op">,</span></span>
<span id="cb20-679"><a href="#cb20-679" aria-hidden="true" tabindex="-1"></a>    [{ <span class="dt">name</span><span class="op">:</span> <span class="st">"selection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> adminSelection }]</span>
<span id="cb20-680"><a href="#cb20-680" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb20-681"><a href="#cb20-681" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-682"><a href="#cb20-682" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`### </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb20-683"><a href="#cb20-683" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-20" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb21" data-startfrom="687" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 686"><span id="cb21-687"><a href="#cb21-687" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb21-688"><a href="#cb21-688" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> crop <span class="op">=</span> insight_totalExposedVop<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb21-689"><a href="#cb21-689" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">totalExposedVop</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">==</span> <span class="st">"crop"</span></span>
<span id="cb21-690"><a href="#cb21-690" aria-hidden="true" tabindex="-1"></a>  )<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span>[<span class="st">"totalExposedVop"</span>]<span class="op">;</span></span>
<span id="cb21-691"><a href="#cb21-691" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-692"><a href="#cb21-692" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalExposedVopBaseline <span class="op">=</span></span>
<span id="cb21-693"><a href="#cb21-693" aria-hidden="true" tabindex="-1"></a>    insight_totalExposedVop<span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb21-694"><a href="#cb21-694" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">===</span> <span class="st">"crop"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"baseline"</span></span>
<span id="cb21-695"><a href="#cb21-695" aria-hidden="true" tabindex="-1"></a>    )<span class="op">?.</span><span class="at">totalExposedVop</span> <span class="op">||</span> <span class="st">"no data"</span><span class="op">;</span></span>
<span id="cb21-696"><a href="#cb21-696" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalExposedVopProjection <span class="op">=</span></span>
<span id="cb21-697"><a href="#cb21-697" aria-hidden="true" tabindex="-1"></a>    insight_totalExposedVop<span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb21-698"><a href="#cb21-698" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">===</span> <span class="st">"crop"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"projection"</span></span>
<span id="cb21-699"><a href="#cb21-699" aria-hidden="true" tabindex="-1"></a>    )<span class="op">?.</span><span class="at">totalExposedVop</span> <span class="op">||</span> <span class="st">"no data"</span><span class="op">;</span></span>
<span id="cb21-700"><a href="#cb21-700" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalExposedVopOver30 <span class="op">=</span></span>
<span id="cb21-701"><a href="#cb21-701" aria-hidden="true" tabindex="-1"></a>    insight_totalExposedVop<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"projection"</span>)</span>
<span id="cb21-702"><a href="#cb21-702" aria-hidden="true" tabindex="-1"></a>      <span class="op">?.</span><span class="at">totalExposedVopOver30</span> <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-703"><a href="#cb21-703" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalExposedVopOver50 <span class="op">=</span></span>
<span id="cb21-704"><a href="#cb21-704" aria-hidden="true" tabindex="-1"></a>    insight_totalExposedVop<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"projection"</span>)</span>
<span id="cb21-705"><a href="#cb21-705" aria-hidden="true" tabindex="-1"></a>      <span class="op">?.</span><span class="at">totalExposedVopOver50</span> <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-706"><a href="#cb21-706" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalExposedVopOver30_b <span class="op">=</span></span>
<span id="cb21-707"><a href="#cb21-707" aria-hidden="true" tabindex="-1"></a>    insight_totalExposedVop<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"baseline"</span>)</span>
<span id="cb21-708"><a href="#cb21-708" aria-hidden="true" tabindex="-1"></a>      <span class="op">?.</span><span class="at">totalExposedVopOver30</span> <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-709"><a href="#cb21-709" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalExposedVopOver50_b <span class="op">=</span></span>
<span id="cb21-710"><a href="#cb21-710" aria-hidden="true" tabindex="-1"></a>    insight_totalExposedVop<span class="op">.</span><span class="fu">find</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"baseline"</span>)</span>
<span id="cb21-711"><a href="#cb21-711" aria-hidden="true" tabindex="-1"></a>      <span class="op">?.</span><span class="at">totalExposedVopOver50</span> <span class="op">||</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-712"><a href="#cb21-712" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-713"><a href="#cb21-713" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatVop <span class="op">=</span> (vop) <span class="kw">=&gt;</span></span>
<span id="cb21-714"><a href="#cb21-714" aria-hidden="true" tabindex="-1"></a>    vop <span class="op">===</span> <span class="st">"no data"</span></span>
<span id="cb21-715"><a href="#cb21-715" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> vop</span>
<span id="cb21-716"><a href="#cb21-716" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">formatNumCompactShort</span>({ <span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span> })(vop)<span class="op">;</span></span>
<span id="cb21-717"><a href="#cb21-717" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-718"><a href="#cb21-718" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">findTopCropByHazard</span>(hazardType) {</span>
<span id="cb21-719"><a href="#cb21-719" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> filteredCrops <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb21-720"><a href="#cb21-720" aria-hidden="true" tabindex="-1"></a>      data_selectedHazardCropType<span class="op">,</span></span>
<span id="cb21-721"><a href="#cb21-721" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">select</span>([<span class="st">"cropType"</span><span class="op">,</span> <span class="st">"crop"</span><span class="op">,</span> <span class="st">"vop"</span><span class="op">,</span> <span class="st">"hazard"</span>])<span class="op">,</span></span>
<span id="cb21-722"><a href="#cb21-722" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">==</span> <span class="st">"crop"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> hazardType)<span class="op">,</span></span>
<span id="cb21-723"><a href="#cb21-723" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">sliceMax</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">"vop"</span>)</span>
<span id="cb21-724"><a href="#cb21-724" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb21-725"><a href="#cb21-725" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-726"><a href="#cb21-726" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> filteredCrops[<span class="dv">0</span>]<span class="op">;</span> <span class="co">// Assuming there's at least one entry after filtering</span></span>
<span id="cb21-727"><a href="#cb21-727" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-728"><a href="#cb21-728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-729"><a href="#cb21-729" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate topCrop_b and topCrop_p using the adjusted function</span></span>
<span id="cb21-730"><a href="#cb21-730" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topCrop_b <span class="op">=</span> <span class="fu">findTopCropByHazard</span>(<span class="st">"baseline"</span>)<span class="op">;</span></span>
<span id="cb21-731"><a href="#cb21-731" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topCrop_p <span class="op">=</span> <span class="fu">findTopCropByHazard</span>(<span class="st">"projection"</span>)<span class="op">;</span></span>
<span id="cb21-732"><a href="#cb21-732" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-733"><a href="#cb21-733" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lowerBound_b <span class="op">=</span> hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[topCrop_b<span class="op">?.</span>[<span class="st">"crop"</span>]] <span class="op">-</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb21-734"><a href="#cb21-734" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> upperBound_b <span class="op">=</span> hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[topCrop_b<span class="op">?.</span>[<span class="st">"crop"</span>]]<span class="op">;</span></span>
<span id="cb21-735"><a href="#cb21-735" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-736"><a href="#cb21-736" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> lowerBound_p <span class="op">=</span> hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[topCrop_p<span class="op">?.</span>[<span class="st">"crop"</span>]] <span class="op">-</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb21-737"><a href="#cb21-737" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> upperBound_p <span class="op">=</span> hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[topCrop_p<span class="op">?.</span>[<span class="st">"crop"</span>]]<span class="op">;</span></span>
<span id="cb21-738"><a href="#cb21-738" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-739"><a href="#cb21-739" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> missingValue <span class="op">=</span> <span class="st">"--- no data for that bin ---"</span><span class="op">;</span></span>
<span id="cb21-740"><a href="#cb21-740" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-741"><a href="#cb21-741" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">showResult</span>(value<span class="op">,</span> format) {</span>
<span id="cb21-742"><a href="#cb21-742" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (value <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> value <span class="op">===</span> <span class="kw">undefined</span>) <span class="cf">return</span> missingValue<span class="op">;</span></span>
<span id="cb21-743"><a href="#cb21-743" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">format</span>(value)<span class="op">;</span></span>
<span id="cb21-744"><a href="#cb21-744" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-745"><a href="#cb21-745" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-746"><a href="#cb21-746" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">findMedianCropWithVop</span>(data) {</span>
<span id="cb21-747"><a href="#cb21-747" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sortedData <span class="op">=</span> [<span class="op">...</span>data]</span>
<span id="cb21-748"><a href="#cb21-748" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> <span class="op">!</span><span class="pp">isNaN</span>(d<span class="op">.</span><span class="at">vop</span>))</span>
<span id="cb21-749"><a href="#cb21-749" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> a<span class="op">.</span><span class="at">vop</span> <span class="op">-</span> b<span class="op">.</span><span class="at">vop</span>)<span class="op">;</span></span>
<span id="cb21-750"><a href="#cb21-750" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> medianIndex <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">floor</span>(sortedData<span class="op">.</span><span class="at">length</span> <span class="op">/</span> <span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb21-751"><a href="#cb21-751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-752"><a href="#cb21-752" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (sortedData<span class="op">.</span><span class="at">length</span> <span class="op">===</span> <span class="dv">0</span>) <span class="cf">return</span> { <span class="dt">crop</span><span class="op">:</span> <span class="kw">undefined</span><span class="op">,</span> <span class="dt">vop</span><span class="op">:</span> <span class="kw">undefined</span> }<span class="op">;</span></span>
<span id="cb21-753"><a href="#cb21-753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-754"><a href="#cb21-754" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> sortedData<span class="op">.</span><span class="at">length</span> <span class="op">%</span> <span class="dv">2</span> <span class="op">!==</span> <span class="dv">0</span></span>
<span id="cb21-755"><a href="#cb21-755" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> sortedData[medianIndex]</span>
<span id="cb21-756"><a href="#cb21-756" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> sortedData[medianIndex]<span class="op">;</span></span>
<span id="cb21-757"><a href="#cb21-757" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-758"><a href="#cb21-758" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> baselineData <span class="op">=</span> data_selectedHazardCropType<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb21-759"><a href="#cb21-759" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"baseline"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">==</span> <span class="st">"crop"</span></span>
<span id="cb21-760"><a href="#cb21-760" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb21-761"><a href="#cb21-761" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projectionData <span class="op">=</span> data_selectedHazardCropType<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb21-762"><a href="#cb21-762" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"projection"</span></span>
<span id="cb21-763"><a href="#cb21-763" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb21-764"><a href="#cb21-764" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-765"><a href="#cb21-765" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> medianCropInfoBaseline <span class="op">=</span> <span class="fu">findMedianCropWithVop</span>(baselineData)<span class="op">;</span></span>
<span id="cb21-766"><a href="#cb21-766" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> medianCropInfoProjection <span class="op">=</span> <span class="fu">findMedianCropWithVop</span>(projectionData)<span class="op">;</span></span>
<span id="cb21-767"><a href="#cb21-767" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-768"><a href="#cb21-768" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> getBinBounds <span class="op">=</span> (cropValue) <span class="kw">=&gt;</span> {</span>
<span id="cb21-769"><a href="#cb21-769" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Assuming cropValue directly relates to the bin, adjust as necessary for your logic</span></span>
<span id="cb21-770"><a href="#cb21-770" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lowerBound <span class="op">=</span> cropValue <span class="op">-</span> (cropValue <span class="op">%</span> <span class="dv">5</span>)<span class="op">;</span> <span class="co">// Adjust based on how bins are defined</span></span>
<span id="cb21-771"><a href="#cb21-771" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> upperBound <span class="op">=</span> lowerBound <span class="op">+</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb21-772"><a href="#cb21-772" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> { lowerBound<span class="op">,</span> upperBound }<span class="op">;</span></span>
<span id="cb21-773"><a href="#cb21-773" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb21-774"><a href="#cb21-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-775"><a href="#cb21-775" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> medianCropBaselineBounds <span class="op">=</span> <span class="fu">getBinBounds</span>(medianCropInfoBaseline<span class="op">.</span><span class="at">crop</span>)<span class="op">;</span></span>
<span id="cb21-776"><a href="#cb21-776" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> medianCropProjectionBounds <span class="op">=</span> <span class="fu">getBinBounds</span>(</span>
<span id="cb21-777"><a href="#cb21-777" aria-hidden="true" tabindex="-1"></a>    medianCropInfoProjection<span class="op">.</span><span class="at">crop</span></span>
<span id="cb21-778"><a href="#cb21-778" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb21-779"><a href="#cb21-779" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-780"><a href="#cb21-780" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Example function to convert percentages to months</span></span>
<span id="cb21-781"><a href="#cb21-781" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">percentToMonths</span>(percent) {</span>
<span id="cb21-782"><a href="#cb21-782" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (percent <span class="op">*</span> <span class="dv">12</span>) <span class="op">/</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb21-783"><a href="#cb21-783" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-784"><a href="#cb21-784" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-785"><a href="#cb21-785" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Calculate months for baseline and projection median bins</span></span>
<span id="cb21-786"><a href="#cb21-786" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> baselineMonthsLower <span class="op">=</span> <span class="fu">percentToMonths</span>(</span>
<span id="cb21-787"><a href="#cb21-787" aria-hidden="true" tabindex="-1"></a>    medianCropBaselineBounds<span class="op">.</span><span class="at">lowerBound</span></span>
<span id="cb21-788"><a href="#cb21-788" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb21-789"><a href="#cb21-789" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> baselineMonthsUpper <span class="op">=</span> <span class="fu">percentToMonths</span>(</span>
<span id="cb21-790"><a href="#cb21-790" aria-hidden="true" tabindex="-1"></a>    medianCropBaselineBounds<span class="op">.</span><span class="at">upperBound</span></span>
<span id="cb21-791"><a href="#cb21-791" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb21-792"><a href="#cb21-792" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projectionMonthsLower <span class="op">=</span> <span class="fu">percentToMonths</span>(</span>
<span id="cb21-793"><a href="#cb21-793" aria-hidden="true" tabindex="-1"></a>    medianCropProjectionBounds<span class="op">.</span><span class="at">lowerBound</span></span>
<span id="cb21-794"><a href="#cb21-794" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb21-795"><a href="#cb21-795" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projectionMonthsUpper <span class="op">=</span> <span class="fu">percentToMonths</span>(</span>
<span id="cb21-796"><a href="#cb21-796" aria-hidden="true" tabindex="-1"></a>    medianCropProjectionBounds<span class="op">.</span><span class="at">upperBound</span></span>
<span id="cb21-797"><a href="#cb21-797" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb21-798"><a href="#cb21-798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-799"><a href="#cb21-799" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> percentChange <span class="op">=</span></span>
<span id="cb21-800"><a href="#cb21-800" aria-hidden="true" tabindex="-1"></a>    ((totalExposedVopOver50 <span class="op">-</span> totalExposedVopOver50_b) <span class="op">/</span></span>
<span id="cb21-801"><a href="#cb21-801" aria-hidden="true" tabindex="-1"></a>      totalExposedVopOver50_b) <span class="op">*</span></span>
<span id="cb21-802"><a href="#cb21-802" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span><span class="op">;</span></span>
<span id="cb21-803"><a href="#cb21-803" aria-hidden="true" tabindex="-1"></a>  percentChange <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(percentChange)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb21-804"><a href="#cb21-804" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> changeType <span class="op">=</span> percentChange <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"an increase"</span> <span class="op">:</span> <span class="st">"a decrease"</span><span class="op">;</span></span>
<span id="cb21-805"><a href="#cb21-805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-806"><a href="#cb21-806" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> percentChange2 <span class="op">=</span></span>
<span id="cb21-807"><a href="#cb21-807" aria-hidden="true" tabindex="-1"></a>    ((totalExposedVopOver30 <span class="op">-</span> totalExposedVopOver30_b) <span class="op">/</span></span>
<span id="cb21-808"><a href="#cb21-808" aria-hidden="true" tabindex="-1"></a>      totalExposedVopOver30_b) <span class="op">*</span></span>
<span id="cb21-809"><a href="#cb21-809" aria-hidden="true" tabindex="-1"></a>    <span class="dv">100</span><span class="op">;</span></span>
<span id="cb21-810"><a href="#cb21-810" aria-hidden="true" tabindex="-1"></a>  percentChange2 <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">abs</span>(percentChange2)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb21-811"><a href="#cb21-811" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> changeType2 <span class="op">=</span> percentChange <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="st">"an increase"</span> <span class="op">:</span> <span class="st">"a decrease"</span><span class="op">;</span></span>
<span id="cb21-812"><a href="#cb21-812" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-813"><a href="#cb21-813" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> scenarioLabel <span class="op">=</span></span>
<span id="cb21-814"><a href="#cb21-814" aria-hidden="true" tabindex="-1"></a>    selectScenarioAndTimeframe<span class="op">.</span><span class="at">scenario</span> <span class="op">===</span> <span class="st">"SSP2"</span> <span class="op">?</span> <span class="st">"SSP2 4.5"</span> <span class="op">:</span> <span class="st">"SSP5 8.5"</span><span class="op">;</span></span>
<span id="cb21-815"><a href="#cb21-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-816"><a href="#cb21-816" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const over30Insight = `For the baseline period, **${formatVop(</span></span>
<span id="cb21-817"><a href="#cb21-817" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   totalExposedVopOver50_b</span></span>
<span id="cb21-818"><a href="#cb21-818" aria-hidden="true" tabindex="-1"></a>  <span class="co">// )}** people experienced unsafe working conditions for at least **half of the days** in the year. Under the scenario **${scenarioLabel}** and year **${</span></span>
<span id="cb21-819"><a href="#cb21-819" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   selectScenarioAndTimeframe.timeframe</span></span>
<span id="cb21-820"><a href="#cb21-820" aria-hidden="true" tabindex="-1"></a>  <span class="co">// }**, it's expected to rise to **${formatVop(</span></span>
<span id="cb21-821"><a href="#cb21-821" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   totalExposedVopOver50</span></span>
<span id="cb21-822"><a href="#cb21-822" aria-hidden="true" tabindex="-1"></a>  <span class="co">// )}** people.`;</span></span>
<span id="cb21-823"><a href="#cb21-823" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-824"><a href="#cb21-824" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insightOver30 <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb21-825"><a href="#cb21-825" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">quickInsights</span><span class="op">.</span><span class="at">overview</span>)<span class="op">,</span></span>
<span id="cb21-826"><a href="#cb21-826" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb21-827"><a href="#cb21-827" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"baseRisk"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">formatVop</span>(totalExposedVopOver30_b) }<span class="op">,</span></span>
<span id="cb21-828"><a href="#cb21-828" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"scenario"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> scenarioLabel }<span class="op">,</span></span>
<span id="cb21-829"><a href="#cb21-829" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span> }<span class="op">,</span></span>
<span id="cb21-830"><a href="#cb21-830" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"projectionRisk"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">formatVop</span>(totalExposedVopOver30) }</span>
<span id="cb21-831"><a href="#cb21-831" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb21-832"><a href="#cb21-832" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb21-833"><a href="#cb21-833" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-834"><a href="#cb21-834" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insightOver50 <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb21-835"><a href="#cb21-835" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">quickInsights</span><span class="op">.</span><span class="at">half</span>)<span class="op">,</span></span>
<span id="cb21-836"><a href="#cb21-836" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb21-837"><a href="#cb21-837" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"baseline"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">formatVop</span>(totalExposedVopOver50_b) }<span class="op">,</span></span>
<span id="cb21-838"><a href="#cb21-838" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"scenario"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> scenarioLabel }<span class="op">,</span></span>
<span id="cb21-839"><a href="#cb21-839" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span> }<span class="op">,</span></span>
<span id="cb21-840"><a href="#cb21-840" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"projection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">formatVop</span>(totalExposedVopOver50) }</span>
<span id="cb21-841"><a href="#cb21-841" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb21-842"><a href="#cb21-842" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb21-843"><a href="#cb21-843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-844"><a href="#cb21-844" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const over50Insight = `For over **100 days** in a year, the people at risk for the baseline were **${formatVop(</span></span>
<span id="cb21-845"><a href="#cb21-845" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   totalExposedVopOver30_b</span></span>
<span id="cb21-846"><a href="#cb21-846" aria-hidden="true" tabindex="-1"></a>  <span class="co">// )}**; under the scenario **${scenarioLabel}** and year **${</span></span>
<span id="cb21-847"><a href="#cb21-847" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   selectScenarioAndTimeframe.timeframe</span></span>
<span id="cb21-848"><a href="#cb21-848" aria-hidden="true" tabindex="-1"></a>  <span class="co">// }**, it ascends to **${formatVop(totalExposedVopOver30)}**.`;</span></span>
<span id="cb21-849"><a href="#cb21-849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-850"><a href="#cb21-850" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> medianExplanation <span class="op">=</span> <span class="vs">`When we say we're 'looking at the median', we mean focusing on the group in the exact middle when arranging everyone from the least to the most exposed to heat stress over the year. It's like finding the middle point in a line of people sorted by how long they're exposed to high heat.`</span><span class="op">;</span></span>
<span id="cb21-851"><a href="#cb21-851" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-852"><a href="#cb21-852" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedCountry <span class="op">=</span> <span class="fu">getAdminSelection0</span>()<span class="op">.</span><span class="at">value</span><span class="op">;</span> <span class="co">// Function to get the selected country</span></span>
<span id="cb21-853"><a href="#cb21-853" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> countriesWithoutData <span class="op">=</span> [</span>
<span id="cb21-854"><a href="#cb21-854" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Burundi"</span><span class="op">,</span></span>
<span id="cb21-855"><a href="#cb21-855" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rwanda"</span><span class="op">,</span></span>
<span id="cb21-856"><a href="#cb21-856" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lesotho"</span><span class="op">,</span></span>
<span id="cb21-857"><a href="#cb21-857" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gabon"</span><span class="op">,</span></span>
<span id="cb21-858"><a href="#cb21-858" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Eswatini"</span><span class="op">,</span></span>
<span id="cb21-859"><a href="#cb21-859" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Equatorial Guinea"</span></span>
<span id="cb21-860"><a href="#cb21-860" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb21-861"><a href="#cb21-861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-862"><a href="#cb21-862" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check if the selected country is in the list of countries without data</span></span>
<span id="cb21-863"><a href="#cb21-863" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (countriesWithoutData<span class="op">.</span><span class="fu">includes</span>(selectedCountry)) {</span>
<span id="cb21-864"><a href="#cb21-864" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">quickInsightsGeneral</span><span class="op">.</span><span class="at">noDataBlurb</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb21-865"><a href="#cb21-865" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb21-866"><a href="#cb21-866" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>insightOver30<span class="sc">}</span></span>
<span id="cb21-867"><a href="#cb21-867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-868"><a href="#cb21-868" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>insightOver50<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb21-869"><a href="#cb21-869" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-870"><a href="#cb21-870" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-21" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb22" data-startfrom="874" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 873"><span id="cb22-874"><a href="#cb22-874" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">workingHours</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span></span>
<span id="cb22-875"><a href="#cb22-875" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-876"><a href="#cb22-876" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">workingHours</span><span class="op">.</span><span class="at">intro</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-22" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb23" data-startfrom="880" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 879"><span id="cb23-880"><a href="#cb23-880" aria-hidden="true" tabindex="-1"></a>viewBindAdminSelectors <span class="op">=</span> <span class="co">// format admin selections</span></span>
<span id="cb23-881"><a href="#cb23-881" aria-hidden="true" tabindex="-1"></a><span class="co">// bind to appendix inputs, add template to format</span></span>
<span id="cb23-882"><a href="#cb23-882" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb23-883"><a href="#cb23-883" aria-hidden="true" tabindex="-1"></a>  [</span>
<span id="cb23-884"><a href="#cb23-884" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb23-885"><a href="#cb23-885" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin0<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb23-886"><a href="#cb23-886" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin0</span>
<span id="cb23-887"><a href="#cb23-887" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb23-888"><a href="#cb23-888" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb23-889"><a href="#cb23-889" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin1<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb23-890"><a href="#cb23-890" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin1</span>
<span id="cb23-891"><a href="#cb23-891" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb23-892"><a href="#cb23-892" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb23-893"><a href="#cb23-893" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin2<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb23-894"><a href="#cb23-894" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin2</span>
<span id="cb23-895"><a href="#cb23-895" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb23-896"><a href="#cb23-896" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb23-897"><a href="#cb23-897" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb23-898"><a href="#cb23-898" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> adminFormTemplate</span>
<span id="cb23-899"><a href="#cb23-899" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb23-900"><a href="#cb23-900" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-23" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb24" data-startfrom="904" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 903"><span id="cb24-904"><a href="#cb24-904" aria-hidden="true" tabindex="-1"></a>viewof selectScenarioAndTimeframe2 <span class="op">=</span> {</span>
<span id="cb24-905"><a href="#cb24-905" aria-hidden="true" tabindex="-1"></a>  <span class="co">// scenario and timeframe</span></span>
<span id="cb24-906"><a href="#cb24-906" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-907"><a href="#cb24-907" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> [</span>
<span id="cb24-908"><a href="#cb24-908" aria-hidden="true" tabindex="-1"></a>    <span class="co">// {label: 'SSP245: 2030', scenario: 'SSP2', timeframe: '2030'},</span></span>
<span id="cb24-909"><a href="#cb24-909" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'SSP245: 2050'</span><span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'SSP245'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'2050'</span>}<span class="op">,</span></span>
<span id="cb24-910"><a href="#cb24-910" aria-hidden="true" tabindex="-1"></a>    <span class="co">// {label: 'SSP585: 2030', scenario: 'SSP5', timeframe: '2030'},</span></span>
<span id="cb24-911"><a href="#cb24-911" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'SSP585: 2050'</span><span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'SSP585'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'2050'</span>}<span class="op">,</span></span>
<span id="cb24-912"><a href="#cb24-912" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb24-913"><a href="#cb24-913" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb24-914"><a href="#cb24-914" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(data<span class="op">,</span> {</span>
<span id="cb24-915"><a href="#cb24-915" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">scenario</span>)<span class="op">,</span></span>
<span id="cb24-916"><a href="#cb24-916" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb24-917"><a href="#cb24-917" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> data<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span> <span class="op">===</span> <span class="st">'SSP245: 2050'</span>)</span>
<span id="cb24-918"><a href="#cb24-918" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb24-919"><a href="#cb24-919" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-24" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb25" data-startfrom="923" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 922"><span id="cb25-923"><a href="#cb25-923" aria-hidden="true" tabindex="-1"></a>viewof selectThreshold2 <span class="op">=</span> {</span>
<span id="cb25-924"><a href="#cb25-924" aria-hidden="true" tabindex="-1"></a>  <span class="co">// threshold</span></span>
<span id="cb25-925"><a href="#cb25-925" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-926"><a href="#cb25-926" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> [</span>
<span id="cb25-927"><a href="#cb25-927" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'28C'</span><span class="op">,</span> <span class="dt">threshold</span><span class="op">:</span> <span class="st">'28'</span>}<span class="op">,</span></span>
<span id="cb25-928"><a href="#cb25-928" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'30C'</span><span class="op">,</span> <span class="dt">threshold</span><span class="op">:</span> <span class="st">'30'</span>}<span class="op">,</span></span>
<span id="cb25-929"><a href="#cb25-929" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'32C'</span><span class="op">,</span> <span class="dt">threshold</span><span class="op">:</span> <span class="st">'32'</span>}<span class="op">,</span></span>
<span id="cb25-930"><a href="#cb25-930" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb25-931"><a href="#cb25-931" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb25-932"><a href="#cb25-932" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(data<span class="op">,</span> {</span>
<span id="cb25-933"><a href="#cb25-933" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">threshold</span>)<span class="op">,</span></span>
<span id="cb25-934"><a href="#cb25-934" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb25-935"><a href="#cb25-935" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> data<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span> <span class="op">===</span> <span class="st">'30'</span>)</span>
<span id="cb25-936"><a href="#cb25-936" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb25-937"><a href="#cb25-937" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-25" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb26" data-startfrom="941" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 940"><span id="cb26-941"><a href="#cb26-941" aria-hidden="true" tabindex="-1"></a>viewof radios <span class="op">=</span> {</span>
<span id="cb26-942"><a href="#cb26-942" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> [</span>
<span id="cb26-943"><a href="#cb26-943" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb26-944"><a href="#cb26-944" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toTitleCase</span>(<span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">seasonTypes</span><span class="op">.</span><span class="at">planting</span>))<span class="op">,</span></span>
<span id="cb26-945"><a href="#cb26-945" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="st">"planting"</span></span>
<span id="cb26-946"><a href="#cb26-946" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb26-947"><a href="#cb26-947" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb26-948"><a href="#cb26-948" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toTitleCase</span>(<span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">seasonTypes</span><span class="op">.</span><span class="at">harvesting</span>))<span class="op">,</span></span>
<span id="cb26-949"><a href="#cb26-949" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="st">"harvesting"</span></span>
<span id="cb26-950"><a href="#cb26-950" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-951"><a href="#cb26-951" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb26-952"><a href="#cb26-952" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">radio</span>(data<span class="op">,</span> {</span>
<span id="cb26-953"><a href="#cb26-953" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">season</span>)<span class="op">,</span></span>
<span id="cb26-954"><a href="#cb26-954" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb26-955"><a href="#cb26-955" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> data<span class="op">.</span><span class="fu">find</span>((x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="st">"planting"</span>)</span>
<span id="cb26-956"><a href="#cb26-956" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb26-957"><a href="#cb26-957" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-26" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb27" data-startfrom="961" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 960"><span id="cb27-961"><a href="#cb27-961" aria-hidden="true" tabindex="-1"></a>plotHourSeasonLoss <span class="op">=</span> {</span>
<span id="cb27-962"><a href="#cb27-962" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _anyData <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb27-963"><a href="#cb27-963" aria-hidden="true" tabindex="-1"></a>    data_hourlyStress<span class="op">,</span></span>
<span id="cb27-964"><a href="#cb27-964" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb27-965"><a href="#cb27-965" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb27-966"><a href="#cb27-966" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb27-967"><a href="#cb27-967" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb27-968"><a href="#cb27-968" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb27-969"><a href="#cb27-969" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb27-970"><a href="#cb27-970" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb27-971"><a href="#cb27-971" aria-hidden="true" tabindex="-1"></a>        <span class="st">"threshold"</span><span class="op">,</span></span>
<span id="cb27-972"><a href="#cb27-972" aria-hidden="true" tabindex="-1"></a>        <span class="st">"hour_day"</span></span>
<span id="cb27-973"><a href="#cb27-973" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb27-974"><a href="#cb27-974" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb27-975"><a href="#cb27-975" aria-hidden="true" tabindex="-1"></a>        T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb27-976"><a href="#cb27-976" aria-hidden="true" tabindex="-1"></a>          <span class="dt">vop_any</span><span class="op">:</span> T<span class="op">.</span><span class="fu">mean</span>(<span class="st">"delta"</span>)</span>
<span id="cb27-977"><a href="#cb27-977" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb27-978"><a href="#cb27-978" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb27-979"><a href="#cb27-979" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-980"><a href="#cb27-980" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb27-981"><a href="#cb27-981" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-982"><a href="#cb27-982" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _dataWithAnyColumn <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb27-983"><a href="#cb27-983" aria-hidden="true" tabindex="-1"></a>    data_hourlyStress<span class="op">,</span></span>
<span id="cb27-984"><a href="#cb27-984" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">leftJoin</span>(_anyData<span class="op">,</span> {</span>
<span id="cb27-985"><a href="#cb27-985" aria-hidden="true" tabindex="-1"></a>      <span class="dt">by</span><span class="op">:</span> [</span>
<span id="cb27-986"><a href="#cb27-986" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb27-987"><a href="#cb27-987" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb27-988"><a href="#cb27-988" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb27-989"><a href="#cb27-989" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb27-990"><a href="#cb27-990" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb27-991"><a href="#cb27-991" aria-hidden="true" tabindex="-1"></a>        <span class="st">"hour_day"</span><span class="op">,</span></span>
<span id="cb27-992"><a href="#cb27-992" aria-hidden="true" tabindex="-1"></a>        <span class="st">"threshold"</span></span>
<span id="cb27-993"><a href="#cb27-993" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb27-994"><a href="#cb27-994" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb27-995"><a href="#cb27-995" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb27-996"><a href="#cb27-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-997"><a href="#cb27-997" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> _dataWithAnyColumn<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> radios<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb27-998"><a href="#cb27-998" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataAny <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> <span class="st">"any"</span>)<span class="op">;</span> <span class="co">// combined</span></span>
<span id="cb27-999"><a href="#cb27-999" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataBars <span class="op">=</span> [</span>
<span id="cb27-1000"><a href="#cb27-1000" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">!==</span> <span class="st">"any"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">delta</span> <span class="op">!==</span> <span class="dv">0</span>) <span class="co">// remove the combined hazard</span></span>
<span id="cb27-1001"><a href="#cb27-1001" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb27-1002"><a href="#cb27-1002" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1003"><a href="#cb27-1003" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _formatPercent <span class="op">=</span> (num) <span class="kw">=&gt;</span> {</span>
<span id="cb27-1004"><a href="#cb27-1004" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>num<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)<span class="sc">}</span><span class="vs">%`</span><span class="op">;</span></span>
<span id="cb27-1005"><a href="#cb27-1005" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb27-1006"><a href="#cb27-1006" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xDomain <span class="op">=</span> hourlyNames<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hourlyName</span>)<span class="op">;</span></span>
<span id="cb27-1007"><a href="#cb27-1007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1008"><a href="#cb27-1008" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> maxValue <span class="op">=</span> d3<span class="op">.</span><span class="fu">max</span>(dataBars<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">delta</span>) <span class="op">*</span> <span class="fl">1.75</span><span class="op">;</span> <span class="co">// adding 10% buffer</span></span>
<span id="cb27-1009"><a href="#cb27-1009" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-1010"><a href="#cb27-1010" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb27-1011"><a href="#cb27-1011" aria-hidden="true" tabindex="-1"></a>    <span class="co">// caption: `The data on the plot above is stacked for visualization purposes, but percentages are based on different parts of the year, depending on the season.`,</span></span>
<span id="cb27-1012"><a href="#cb27-1012" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">800</span><span class="op">,</span></span>
<span id="cb27-1013"><a href="#cb27-1013" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">500</span><span class="op">,</span></span>
<span id="cb27-1014"><a href="#cb27-1014" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">40</span><span class="op">,</span></span>
<span id="cb27-1015"><a href="#cb27-1015" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">5</span><span class="op">,</span></span>
<span id="cb27-1016"><a href="#cb27-1016" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">35</span><span class="op">,</span></span>
<span id="cb27-1017"><a href="#cb27-1017" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb27-1018"><a href="#cb27-1018" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> hourlyPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span><span class="op">,</span></span>
<span id="cb27-1019"><a href="#cb27-1019" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> hourlyPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">range</span><span class="op">,</span></span>
<span id="cb27-1020"><a href="#cb27-1020" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">false</span></span>
<span id="cb27-1021"><a href="#cb27-1021" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb27-1022"><a href="#cb27-1022" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb27-1023"><a href="#cb27-1023" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> xDomain<span class="op">,</span></span>
<span id="cb27-1024"><a href="#cb27-1024" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">workingHours</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">xLabel</span>)</span>
<span id="cb27-1025"><a href="#cb27-1025" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb27-1026"><a href="#cb27-1026" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb27-1027"><a href="#cb27-1027" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> maxValue]<span class="op">,</span></span>
<span id="cb27-1028"><a href="#cb27-1028" aria-hidden="true" tabindex="-1"></a>      <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb27-1029"><a href="#cb27-1029" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">workingHours</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">yLabel</span>)<span class="op">,</span></span>
<span id="cb27-1030"><a href="#cb27-1030" aria-hidden="true" tabindex="-1"></a>      <span class="co">// tickSize: 0, // Set tick size to 0 to hide the ticks</span></span>
<span id="cb27-1031"><a href="#cb27-1031" aria-hidden="true" tabindex="-1"></a>      <span class="co">// tickFormat: () =&gt; "", // Return an empty string to hide tick labels</span></span>
<span id="cb27-1032"><a href="#cb27-1032" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb27-1033"><a href="#cb27-1033" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb27-1034"><a href="#cb27-1034" aria-hidden="true" tabindex="-1"></a>      <span class="co">// main y-axis</span></span>
<span id="cb27-1035"><a href="#cb27-1035" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisX</span>({</span>
<span id="cb27-1036"><a href="#cb27-1036" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb27-1037"><a href="#cb27-1037" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb27-1038"><a href="#cb27-1038" aria-hidden="true" tabindex="-1"></a>      <span class="co">// pointer white-out</span></span>
<span id="cb27-1039"><a href="#cb27-1039" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisX</span>(</span>
<span id="cb27-1040"><a href="#cb27-1040" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerX</span>({</span>
<span id="cb27-1041"><a href="#cb27-1041" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb27-1042"><a href="#cb27-1042" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb27-1043"><a href="#cb27-1043" aria-hidden="true" tabindex="-1"></a>          <span class="dt">textStroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb27-1044"><a href="#cb27-1044" aria-hidden="true" tabindex="-1"></a>          <span class="dt">textStrokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb27-1045"><a href="#cb27-1045" aria-hidden="true" tabindex="-1"></a>          <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb27-1046"><a href="#cb27-1046" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb27-1047"><a href="#cb27-1047" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb27-1048"><a href="#cb27-1048" aria-hidden="true" tabindex="-1"></a>      <span class="co">// bold pointer</span></span>
<span id="cb27-1049"><a href="#cb27-1049" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisX</span>(</span>
<span id="cb27-1050"><a href="#cb27-1050" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerX</span>({</span>
<span id="cb27-1051"><a href="#cb27-1051" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb27-1052"><a href="#cb27-1052" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb27-1053"><a href="#cb27-1053" aria-hidden="true" tabindex="-1"></a>          <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb27-1054"><a href="#cb27-1054" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb27-1055"><a href="#cb27-1055" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb27-1056"><a href="#cb27-1056" aria-hidden="true" tabindex="-1"></a>      <span class="co">// hazard component bars</span></span>
<span id="cb27-1057"><a href="#cb27-1057" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barY</span>(</span>
<span id="cb27-1058"><a href="#cb27-1058" aria-hidden="true" tabindex="-1"></a>        dataBars<span class="op">,</span></span>
<span id="cb27-1059"><a href="#cb27-1059" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">stackY</span>(</span>
<span id="cb27-1060"><a href="#cb27-1060" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">order</span><span class="op">:</span> hourlyPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span> }<span class="op">,</span></span>
<span id="cb27-1061"><a href="#cb27-1061" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb27-1062"><a href="#cb27-1062" aria-hidden="true" tabindex="-1"></a>            <span class="dt">y</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">delta</span><span class="op">,</span></span>
<span id="cb27-1063"><a href="#cb27-1063" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hourlyPlotLookup<span class="op">.</span><span class="at">hours</span>[d<span class="op">.</span><span class="at">hour_day</span>]<span class="op">,</span></span>
<span id="cb27-1064"><a href="#cb27-1064" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hourlyPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]<span class="op">,</span></span>
<span id="cb27-1065"><a href="#cb27-1065" aria-hidden="true" tabindex="-1"></a>            <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb27-1066"><a href="#cb27-1066" aria-hidden="true" tabindex="-1"></a>            <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.1</span><span class="op">,</span></span>
<span id="cb27-1067"><a href="#cb27-1067" aria-hidden="true" tabindex="-1"></a>            <span class="dt">width</span><span class="op">:</span> <span class="dv">1</span> <span class="co">// Adjust this value to control the thickness of the bars</span></span>
<span id="cb27-1068"><a href="#cb27-1068" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb27-1069"><a href="#cb27-1069" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-1070"><a href="#cb27-1070" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb27-1071"><a href="#cb27-1071" aria-hidden="true" tabindex="-1"></a>      <span class="co">// tooltip</span></span>
<span id="cb27-1072"><a href="#cb27-1072" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">tip</span>(</span>
<span id="cb27-1073"><a href="#cb27-1073" aria-hidden="true" tabindex="-1"></a>        dataBars<span class="op">,</span></span>
<span id="cb27-1074"><a href="#cb27-1074" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerX</span>(</span>
<span id="cb27-1075"><a href="#cb27-1075" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">stackY</span>(</span>
<span id="cb27-1076"><a href="#cb27-1076" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">order</span><span class="op">:</span> hourlyPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span> }<span class="op">,</span></span>
<span id="cb27-1077"><a href="#cb27-1077" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb27-1078"><a href="#cb27-1078" aria-hidden="true" tabindex="-1"></a>              <span class="dt">y</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">delta</span><span class="op">,</span></span>
<span id="cb27-1079"><a href="#cb27-1079" aria-hidden="true" tabindex="-1"></a>              <span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hourlyPlotLookup<span class="op">.</span><span class="at">hours</span>[d<span class="op">.</span><span class="at">hour_day</span>]<span class="op">,</span></span>
<span id="cb27-1080"><a href="#cb27-1080" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hourlyPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]<span class="op">,</span></span>
<span id="cb27-1081"><a href="#cb27-1081" aria-hidden="true" tabindex="-1"></a>              <span class="dt">channels</span><span class="op">:</span> {</span>
<span id="cb27-1082"><a href="#cb27-1082" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hazard</span><span class="op">:</span> {</span>
<span id="cb27-1083"><a href="#cb27-1083" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">workingHours</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">tooltip</span><span class="op">.</span><span class="at">period</span>)<span class="op">,</span></span>
<span id="cb27-1084"><a href="#cb27-1084" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hourlyPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]</span>
<span id="cb27-1085"><a href="#cb27-1085" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb27-1086"><a href="#cb27-1086" aria-hidden="true" tabindex="-1"></a>                <span class="dt">delta</span><span class="op">:</span> {</span>
<span id="cb27-1087"><a href="#cb27-1087" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">workingHours</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">tooltip</span><span class="op">.</span><span class="at">perc</span>)<span class="op">,</span></span>
<span id="cb27-1088"><a href="#cb27-1088" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb27-1089"><a href="#cb27-1089" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">const</span> delta_num <span class="op">=</span> d<span class="op">.</span><span class="at">delta</span><span class="op">;</span></span>
<span id="cb27-1090"><a href="#cb27-1090" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="vs">`(</span><span class="sc">${</span>delta_num<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb27-1091"><a href="#cb27-1091" aria-hidden="true" tabindex="-1"></a>                  }<span class="op">,</span></span>
<span id="cb27-1092"><a href="#cb27-1092" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span>  (d) <span class="kw">=&gt;</span>  <span class="fu">_formatPercent</span>(d<span class="op">.</span><span class="at">delta</span>)</span>
<span id="cb27-1093"><a href="#cb27-1093" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb27-1094"><a href="#cb27-1094" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb27-1095"><a href="#cb27-1095" aria-hidden="true" tabindex="-1"></a>              <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb27-1096"><a href="#cb27-1096" aria-hidden="true" tabindex="-1"></a>                <span class="dt">x</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb27-1097"><a href="#cb27-1097" aria-hidden="true" tabindex="-1"></a>                <span class="dt">y</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb27-1098"><a href="#cb27-1098" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fill</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb27-1099"><a href="#cb27-1099" aria-hidden="true" tabindex="-1"></a>                <span class="dt">delta</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb27-1100"><a href="#cb27-1100" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hazard</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb27-1101"><a href="#cb27-1101" aria-hidden="true" tabindex="-1"></a>                <span class="dt">perc</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb27-1102"><a href="#cb27-1102" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb27-1103"><a href="#cb27-1103" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb27-1104"><a href="#cb27-1104" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb27-1105"><a href="#cb27-1105" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb27-1106"><a href="#cb27-1106" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb27-1107"><a href="#cb27-1107" aria-hidden="true" tabindex="-1"></a>      <span class="co">// total VoP, sidebar highlight</span></span>
<span id="cb27-1108"><a href="#cb27-1108" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">textY</span>(</span>
<span id="cb27-1109"><a href="#cb27-1109" aria-hidden="true" tabindex="-1"></a>        dataAny<span class="op">,</span></span>
<span id="cb27-1110"><a href="#cb27-1110" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerX</span>({</span>
<span id="cb27-1111"><a href="#cb27-1111" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> maxValue<span class="op">,</span></span>
<span id="cb27-1112"><a href="#cb27-1112" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hourlyPlotLookup<span class="op">.</span><span class="at">hours</span>[d<span class="op">.</span><span class="at">hour_day</span>]<span class="op">,</span></span>
<span id="cb27-1113"><a href="#cb27-1113" aria-hidden="true" tabindex="-1"></a>          <span class="dt">text</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb27-1114"><a href="#cb27-1114" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> value <span class="op">=</span> d<span class="op">.</span><span class="at">delta_total</span><span class="op">;</span></span>
<span id="cb27-1115"><a href="#cb27-1115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>value<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb27-1116"><a href="#cb27-1116" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb27-1117"><a href="#cb27-1117" aria-hidden="true" tabindex="-1"></a>          <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span></span>
<span id="cb27-1118"><a href="#cb27-1118" aria-hidden="true" tabindex="-1"></a>          <span class="dt">dx</span><span class="op">:</span> <span class="dv">5</span></span>
<span id="cb27-1119"><a href="#cb27-1119" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb27-1120"><a href="#cb27-1120" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb27-1121"><a href="#cb27-1121" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb27-1122"><a href="#cb27-1122" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb27-1123"><a href="#cb27-1123" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-27" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb28" data-startfrom="1127" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1126"><span id="cb28-1127"><a href="#cb28-1127" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb28-1128"><a href="#cb28-1128" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> data <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb28-1129"><a href="#cb28-1129" aria-hidden="true" tabindex="-1"></a>    data_hourlyStress<span class="op">,</span></span>
<span id="cb28-1130"><a href="#cb28-1130" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb28-1131"><a href="#cb28-1131" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb28-1132"><a href="#cb28-1132" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb28-1133"><a href="#cb28-1133" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb28-1134"><a href="#cb28-1134" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb28-1135"><a href="#cb28-1135" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb28-1136"><a href="#cb28-1136" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb28-1137"><a href="#cb28-1137" aria-hidden="true" tabindex="-1"></a>        <span class="st">"threshold"</span><span class="op">,</span></span>
<span id="cb28-1138"><a href="#cb28-1138" aria-hidden="true" tabindex="-1"></a>        <span class="st">"hour_day"</span></span>
<span id="cb28-1139"><a href="#cb28-1139" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb28-1140"><a href="#cb28-1140" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb28-1141"><a href="#cb28-1141" aria-hidden="true" tabindex="-1"></a>        T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb28-1142"><a href="#cb28-1142" aria-hidden="true" tabindex="-1"></a>          <span class="dt">vop_any</span><span class="op">:</span> T<span class="op">.</span><span class="fu">mean</span>(<span class="st">"delta"</span>)</span>
<span id="cb28-1143"><a href="#cb28-1143" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb28-1144"><a href="#cb28-1144" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb28-1145"><a href="#cb28-1145" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb28-1146"><a href="#cb28-1146" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb28-1147"><a href="#cb28-1147" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">buildInlineDownloadButton</span>(data<span class="op">,</span> <span class="fu">_lang</span>(download_translation)<span class="op">,</span> <span class="vs">`hourlyHumanHeatStress_</span><span class="sc">${</span>selectAdmin0<span class="op">.</span><span class="at">label</span><span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">\s</span><span class="ss">/g</span><span class="op">,</span> <span class="st">""</span>)<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb28-1148"><a href="#cb28-1148" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-28" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb29" data-startfrom="1152" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1151"><span id="cb29-1152"><a href="#cb29-1152" aria-hidden="true" tabindex="-1"></a>headerQuickInsightsHourly <span class="op">=</span> {</span>
<span id="cb29-1153"><a href="#cb29-1153" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminArticle <span class="op">=</span> <span class="fu">_lang</span>(<span class="fu">getAdminSelection</span>()<span class="op">?.</span><span class="at">data</span><span class="op">?.</span><span class="at">article1</span>)<span class="op">;</span></span>
<span id="cb29-1154"><a href="#cb29-1154" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminSelection <span class="op">=</span> adminArticle <span class="op">??</span> <span class="fu">getAdminSelection</span>()<span class="op">.</span><span class="at">label</span><span class="op">;</span></span>
<span id="cb29-1155"><a href="#cb29-1155" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb29-1156"><a href="#cb29-1156" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">quickInsightsGeneral</span><span class="op">.</span><span class="at">header</span>)<span class="op">,</span></span>
<span id="cb29-1157"><a href="#cb29-1157" aria-hidden="true" tabindex="-1"></a>    [{ <span class="dt">name</span><span class="op">:</span> <span class="st">"selection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> adminSelection }]</span>
<span id="cb29-1158"><a href="#cb29-1158" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb29-1159"><a href="#cb29-1159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-1160"><a href="#cb29-1160" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`### </span><span class="sc">${</span>text<span class="sc">}</span></span>
<span id="cb29-1161"><a href="#cb29-1161" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>styling<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb29-1162"><a href="#cb29-1162" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-29" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb30" data-startfrom="1166" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1165"><span id="cb30-1166"><a href="#cb30-1166" aria-hidden="true" tabindex="-1"></a>insightsHourSeasonLoss <span class="op">=</span> {</span>
<span id="cb30-1167"><a href="#cb30-1167" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> i <span class="op">=</span> dynamicInsights_geoImpact<span class="op">.</span><span class="at">insight</span><span class="op">;</span></span>
<span id="cb30-1168"><a href="#cb30-1168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1169"><a href="#cb30-1169" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> currentAgPop <span class="op">=</span> i<span class="op">.</span><span class="at">totalAgPop_noformat</span><span class="op">;</span></span>
<span id="cb30-1170"><a href="#cb30-1170" aria-hidden="true" tabindex="-1"></a>  <span class="co">// totalVop is the projected change in agricultural population by 2050</span></span>
<span id="cb30-1171"><a href="#cb30-1171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1172"><a href="#cb30-1172" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projectedChange2050 <span class="op">=</span> i<span class="op">.</span><span class="at">totalAgPop_5_50_noformat</span><span class="op">;</span></span>
<span id="cb30-1173"><a href="#cb30-1173" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> projectedChange2030 <span class="op">=</span> i<span class="op">.</span><span class="at">totalVopMid_noformat</span><span class="op">;</span></span>
<span id="cb30-1174"><a href="#cb30-1174" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pop_2050 <span class="op">=</span> currentAgPop <span class="op">+</span> projectedChange2050<span class="op">;</span></span>
<span id="cb30-1175"><a href="#cb30-1175" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> crop <span class="op">=</span> insight_totalExposedHourly<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb30-1176"><a href="#cb30-1176" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">totalExposedHourly</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">hour_dayType</span> <span class="op">==</span> <span class="st">"hour_day"</span></span>
<span id="cb30-1177"><a href="#cb30-1177" aria-hidden="true" tabindex="-1"></a>  )<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span>[<span class="st">"totalExposedHourly"</span>]<span class="op">;</span></span>
<span id="cb30-1178"><a href="#cb30-1178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1179"><a href="#cb30-1179" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pop_sum2 <span class="op">=</span> insight_totalExposedHourly<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb30-1180"><a href="#cb30-1180" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">corrected_pop_sum</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">hour_dayType</span> <span class="op">==</span> <span class="st">"hour_day"</span></span>
<span id="cb30-1181"><a href="#cb30-1181" aria-hidden="true" tabindex="-1"></a>  )<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span>[<span class="st">"corrected_pop_sum"</span>]<span class="op">;</span></span>
<span id="cb30-1182"><a href="#cb30-1182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1183"><a href="#cb30-1183" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalPercentHarvesting <span class="op">=</span></span>
<span id="cb30-1184"><a href="#cb30-1184" aria-hidden="true" tabindex="-1"></a>    insight_totalExposedHourly<span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb30-1185"><a href="#cb30-1185" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hour_dayType</span> <span class="op">===</span> <span class="st">"hour_day"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"harvesting"</span></span>
<span id="cb30-1186"><a href="#cb30-1186" aria-hidden="true" tabindex="-1"></a>    )<span class="op">?.</span><span class="at">totalExposedHourly</span> <span class="op">||</span> <span class="st">"no data"</span><span class="op">;</span></span>
<span id="cb30-1187"><a href="#cb30-1187" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalPercentPlanting <span class="op">=</span></span>
<span id="cb30-1188"><a href="#cb30-1188" aria-hidden="true" tabindex="-1"></a>    insight_totalExposedHourly<span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb30-1189"><a href="#cb30-1189" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hour_dayType</span> <span class="op">===</span> <span class="st">"hour_day"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"planting"</span></span>
<span id="cb30-1190"><a href="#cb30-1190" aria-hidden="true" tabindex="-1"></a>    )<span class="op">?.</span><span class="at">totalExposedHourly</span> <span class="op">||</span> <span class="st">"no data"</span><span class="op">;</span></span>
<span id="cb30-1191"><a href="#cb30-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1192"><a href="#cb30-1192" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatVop <span class="op">=</span> (vop) <span class="kw">=&gt;</span></span>
<span id="cb30-1193"><a href="#cb30-1193" aria-hidden="true" tabindex="-1"></a>    vop <span class="op">===</span> <span class="st">"no data"</span></span>
<span id="cb30-1194"><a href="#cb30-1194" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> vop</span>
<span id="cb30-1195"><a href="#cb30-1195" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">formatNumCompactShort</span>({ <span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span> })(vop)<span class="op">;</span></span>
<span id="cb30-1196"><a href="#cb30-1196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1197"><a href="#cb30-1197" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topHour_day <span class="op">=</span> insight_topHourly<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb30-1198"><a href="#cb30-1198" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">delta</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">hour_dayType</span> <span class="op">==</span> <span class="st">"hour_day"</span></span>
<span id="cb30-1199"><a href="#cb30-1199" aria-hidden="true" tabindex="-1"></a>  )<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb30-1200"><a href="#cb30-1200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1201"><a href="#cb30-1201" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> missingValue <span class="op">=</span> <span class="st">"--- no data for that bin ---"</span><span class="op">;</span></span>
<span id="cb30-1202"><a href="#cb30-1202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1203"><a href="#cb30-1203" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">showResult</span>(value<span class="op">,</span> format) {</span>
<span id="cb30-1204"><a href="#cb30-1204" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (value <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> value <span class="op">===</span> <span class="kw">undefined</span>) <span class="cf">return</span> missingValue<span class="op">;</span></span>
<span id="cb30-1205"><a href="#cb30-1205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">format</span>(value)<span class="op">;</span></span>
<span id="cb30-1206"><a href="#cb30-1206" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-1207"><a href="#cb30-1207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1208"><a href="#cb30-1208" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Find a row for each hazard type to get period and total_days</span></span>
<span id="cb30-1209"><a href="#cb30-1209" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> harvestingInsight <span class="op">=</span> insight_totalExposedHourly<span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb30-1210"><a href="#cb30-1210" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"harvesting"</span></span>
<span id="cb30-1211"><a href="#cb30-1211" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb30-1212"><a href="#cb30-1212" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plantingInsight <span class="op">=</span> insight_totalExposedHourly<span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb30-1213"><a href="#cb30-1213" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"planting"</span></span>
<span id="cb30-1214"><a href="#cb30-1214" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb30-1215"><a href="#cb30-1215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1216"><a href="#cb30-1216" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> periodHarvesting <span class="op">=</span></span>
<span id="cb30-1217"><a href="#cb30-1217" aria-hidden="true" tabindex="-1"></a>    insight_totalExposedHourly<span class="op">.</span><span class="fu">find</span>(</span>
<span id="cb30-1218"><a href="#cb30-1218" aria-hidden="true" tabindex="-1"></a>      (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hour_dayType</span> <span class="op">===</span> <span class="st">"hour_day"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">===</span> <span class="st">"harvesting"</span></span>
<span id="cb30-1219"><a href="#cb30-1219" aria-hidden="true" tabindex="-1"></a>    )<span class="op">?.</span><span class="at">period</span> <span class="op">||</span> <span class="st">"no data"</span><span class="op">;</span></span>
<span id="cb30-1220"><a href="#cb30-1220" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalDaysHarvesting <span class="op">=</span> harvestingInsight</span>
<span id="cb30-1221"><a href="#cb30-1221" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> harvestingInsight<span class="op">.</span><span class="at">days_period</span></span>
<span id="cb30-1222"><a href="#cb30-1222" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="st">"no data"</span><span class="op">;</span></span>
<span id="cb30-1223"><a href="#cb30-1223" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> periodPlanting <span class="op">=</span> plantingInsight <span class="op">?</span> plantingInsight<span class="op">.</span><span class="at">period</span> <span class="op">:</span> <span class="st">"no data"</span><span class="op">;</span></span>
<span id="cb30-1224"><a href="#cb30-1224" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalDaysPlanting <span class="op">=</span> plantingInsight</span>
<span id="cb30-1225"><a href="#cb30-1225" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> plantingInsight<span class="op">.</span><span class="at">days_period</span></span>
<span id="cb30-1226"><a href="#cb30-1226" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="st">"no data"</span><span class="op">;</span></span>
<span id="cb30-1227"><a href="#cb30-1227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1228"><a href="#cb30-1228" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pop_sum <span class="op">=</span> harvestingInsight</span>
<span id="cb30-1229"><a href="#cb30-1229" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> harvestingInsight<span class="op">.</span><span class="at">corrected_pop_sum</span></span>
<span id="cb30-1230"><a href="#cb30-1230" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="st">"no data"</span><span class="op">;</span></span>
<span id="cb30-1231"><a href="#cb30-1231" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> delta_mean <span class="op">=</span> harvestingInsight</span>
<span id="cb30-1232"><a href="#cb30-1232" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> harvestingInsight<span class="op">.</span><span class="at">delta_pop_mean</span></span>
<span id="cb30-1233"><a href="#cb30-1233" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="st">"no data"</span><span class="op">;</span></span>
<span id="cb30-1234"><a href="#cb30-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1235"><a href="#cb30-1235" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalPercentHarvestingNumeric <span class="op">=</span></span>
<span id="cb30-1236"><a href="#cb30-1236" aria-hidden="true" tabindex="-1"></a>    totalPercentHarvesting <span class="op">!==</span> <span class="st">"no data"</span></span>
<span id="cb30-1237"><a href="#cb30-1237" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="pp">parseFloat</span>(totalPercentHarvesting)</span>
<span id="cb30-1238"><a href="#cb30-1238" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb30-1239"><a href="#cb30-1239" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalDaysHarvestingNumeric <span class="op">=</span></span>
<span id="cb30-1240"><a href="#cb30-1240" aria-hidden="true" tabindex="-1"></a>    totalDaysHarvesting <span class="op">!==</span> <span class="st">"no data"</span> <span class="op">?</span> <span class="pp">parseFloat</span>(totalDaysHarvesting) <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb30-1241"><a href="#cb30-1241" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalPercentPlantingNumeric <span class="op">=</span></span>
<span id="cb30-1242"><a href="#cb30-1242" aria-hidden="true" tabindex="-1"></a>    totalPercentPlanting <span class="op">!==</span> <span class="st">"no data"</span> <span class="op">?</span> <span class="pp">parseFloat</span>(totalPercentPlanting) <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb30-1243"><a href="#cb30-1243" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalDaysPlantingNumeric <span class="op">=</span></span>
<span id="cb30-1244"><a href="#cb30-1244" aria-hidden="true" tabindex="-1"></a>    totalDaysPlanting <span class="op">!==</span> <span class="st">"no data"</span> <span class="op">?</span> <span class="pp">parseFloat</span>(totalDaysPlanting) <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb30-1245"><a href="#cb30-1245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1246"><a href="#cb30-1246" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> pop_sumNumeric <span class="op">=</span> pop_2050 <span class="op">!==</span> <span class="st">"no data"</span> <span class="op">?</span> <span class="pp">parseFloat</span>(pop_2050) <span class="op">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb30-1247"><a href="#cb30-1247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1248"><a href="#cb30-1248" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalHoursLostHarvest <span class="op">=</span></span>
<span id="cb30-1249"><a href="#cb30-1249" aria-hidden="true" tabindex="-1"></a>    (totalPercentHarvestingNumeric <span class="op">/</span> <span class="dv">100</span>) <span class="op">*</span></span>
<span id="cb30-1250"><a href="#cb30-1250" aria-hidden="true" tabindex="-1"></a>    totalDaysHarvestingNumeric <span class="op">*</span></span>
<span id="cb30-1251"><a href="#cb30-1251" aria-hidden="true" tabindex="-1"></a>    pop_sumNumeric<span class="op">;</span></span>
<span id="cb30-1252"><a href="#cb30-1252" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalHoursLostPlanting <span class="op">=</span></span>
<span id="cb30-1253"><a href="#cb30-1253" aria-hidden="true" tabindex="-1"></a>    (totalPercentPlantingNumeric <span class="op">/</span> <span class="dv">100</span>) <span class="op">*</span></span>
<span id="cb30-1254"><a href="#cb30-1254" aria-hidden="true" tabindex="-1"></a>    totalDaysPlantingNumeric <span class="op">*</span></span>
<span id="cb30-1255"><a href="#cb30-1255" aria-hidden="true" tabindex="-1"></a>    pop_sumNumeric<span class="op">;</span></span>
<span id="cb30-1256"><a href="#cb30-1256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1257"><a href="#cb30-1257" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalWorkingDaysLostHarvest <span class="op">=</span> totalHoursLostHarvest <span class="op">/</span> <span class="dv">8</span><span class="op">;</span> <span class="co">// assuming 8h working day</span></span>
<span id="cb30-1258"><a href="#cb30-1258" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalWorkingDaysLostPlanting <span class="op">=</span> totalHoursLostPlanting <span class="op">/</span> <span class="dv">8</span><span class="op">;</span> <span class="co">// assuming 8h working day</span></span>
<span id="cb30-1259"><a href="#cb30-1259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1260"><a href="#cb30-1260" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalWorkingDaysLostHarvestFormatted <span class="op">=</span> <span class="fu">formatVop</span>(</span>
<span id="cb30-1261"><a href="#cb30-1261" aria-hidden="true" tabindex="-1"></a>    totalWorkingDaysLostHarvest<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)</span>
<span id="cb30-1262"><a href="#cb30-1262" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span> <span class="co">// formatting</span></span>
<span id="cb30-1263"><a href="#cb30-1263" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalWorkingDaysLostPlantingFormatted <span class="op">=</span> <span class="fu">formatVop</span>(</span>
<span id="cb30-1264"><a href="#cb30-1264" aria-hidden="true" tabindex="-1"></a>    totalWorkingDaysLostPlanting<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">1</span>)</span>
<span id="cb30-1265"><a href="#cb30-1265" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span> <span class="co">// formatting</span></span>
<span id="cb30-1266"><a href="#cb30-1266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1267"><a href="#cb30-1267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1268"><a href="#cb30-1268" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insightIntro <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">workingHours</span><span class="op">.</span><span class="at">quickInsights</span><span class="op">.</span><span class="at">intro</span>)<span class="op">;</span></span>
<span id="cb30-1269"><a href="#cb30-1269" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insightBody <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb30-1270"><a href="#cb30-1270" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">workingHours</span><span class="op">.</span><span class="at">quickInsights</span><span class="op">.</span><span class="at">body</span>)<span class="op">,</span></span>
<span id="cb30-1271"><a href="#cb30-1271" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb30-1272"><a href="#cb30-1272" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"scenario"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> selectScenarioAndTimeframe2<span class="op">.</span><span class="at">scenario</span> }<span class="op">,</span></span>
<span id="cb30-1273"><a href="#cb30-1273" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"year"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> selectScenarioAndTimeframe2<span class="op">.</span><span class="at">timeframe</span> }<span class="op">,</span></span>
<span id="cb30-1274"><a href="#cb30-1274" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"totalHours"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">formatVop</span>(totalHoursLostHarvest) }<span class="op">,</span></span>
<span id="cb30-1275"><a href="#cb30-1275" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"daysHarvest"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">formatVop</span>(totalDaysHarvesting) }<span class="op">,</span></span>
<span id="cb30-1276"><a href="#cb30-1276" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"wholeWorkingDays"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> totalWorkingDaysLostHarvestFormatted }</span>
<span id="cb30-1277"><a href="#cb30-1277" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb30-1278"><a href="#cb30-1278" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb30-1279"><a href="#cb30-1279" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insightLostDays <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb30-1280"><a href="#cb30-1280" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">workingHours</span><span class="op">.</span><span class="at">quickInsights</span><span class="op">.</span><span class="at">lostDays</span>)<span class="op">,</span></span>
<span id="cb30-1281"><a href="#cb30-1281" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb30-1282"><a href="#cb30-1282" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"period"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">formatVop</span>(totalDaysPlanting) }<span class="op">,</span></span>
<span id="cb30-1283"><a href="#cb30-1283" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"geo"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">getAdmin0WithAdminSubParens</span>({<span class="dt">articleField</span><span class="op">:</span> <span class="st">"article1"</span>}) }<span class="op">,</span></span>
<span id="cb30-1284"><a href="#cb30-1284" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"lostDays"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> totalWorkingDaysLostPlantingFormatted }</span>
<span id="cb30-1285"><a href="#cb30-1285" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb30-1286"><a href="#cb30-1286" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb30-1287"><a href="#cb30-1287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1288"><a href="#cb30-1288" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedCountry <span class="op">=</span> <span class="fu">getAdminSelection0</span>()<span class="op">.</span><span class="at">value</span><span class="op">;</span> <span class="co">// Function to get the selected country</span></span>
<span id="cb30-1289"><a href="#cb30-1289" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> countriesWithoutData <span class="op">=</span> [</span>
<span id="cb30-1290"><a href="#cb30-1290" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Burundi"</span><span class="op">,</span></span>
<span id="cb30-1291"><a href="#cb30-1291" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Rwanda"</span><span class="op">,</span></span>
<span id="cb30-1292"><a href="#cb30-1292" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Lesotho"</span><span class="op">,</span></span>
<span id="cb30-1293"><a href="#cb30-1293" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Gabon"</span><span class="op">,</span></span>
<span id="cb30-1294"><a href="#cb30-1294" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Eswatini"</span><span class="op">,</span></span>
<span id="cb30-1295"><a href="#cb30-1295" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Equatorial Guinea"</span></span>
<span id="cb30-1296"><a href="#cb30-1296" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb30-1297"><a href="#cb30-1297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1298"><a href="#cb30-1298" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Check if the selected country is in the list of countries without data</span></span>
<span id="cb30-1299"><a href="#cb30-1299" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (countriesWithoutData<span class="op">.</span><span class="fu">includes</span>(selectedCountry)) {</span>
<span id="cb30-1300"><a href="#cb30-1300" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">quickInsightsGeneral</span><span class="op">.</span><span class="at">noDataBlurb</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb30-1301"><a href="#cb30-1301" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb30-1302"><a href="#cb30-1302" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">` </span><span class="sc">${</span>insightIntro<span class="sc">}</span><span class="vs"> </span></span>
<span id="cb30-1303"><a href="#cb30-1303" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1304"><a href="#cb30-1304" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>insightBody<span class="sc">}</span></span>
<span id="cb30-1305"><a href="#cb30-1305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1306"><a href="#cb30-1306" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>insightLostDays<span class="sc">}</span></span>
<span id="cb30-1307"><a href="#cb30-1307" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-1308"><a href="#cb30-1308" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">;</span></span>
<span id="cb30-1309"><a href="#cb30-1309" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-1310"><a href="#cb30-1310" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-30" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb31" data-startfrom="1314" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1313"><span id="cb31-1314"><a href="#cb31-1314" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">summary</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span></span>
<span id="cb31-1315"><a href="#cb31-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-1316"><a href="#cb31-1316" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">summary</span><span class="op">.</span><span class="at">intro</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-31" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb32" data-startfrom="1320" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1319"><span id="cb32-1320"><a href="#cb32-1320" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span></span>
<span id="cb32-1321"><a href="#cb32-1321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1322"><a href="#cb32-1322" aria-hidden="true" tabindex="-1"></a><span class="vs">## </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">agWorkforce</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span></span>
<span id="cb32-1323"><a href="#cb32-1323" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">agWorkforce</span><span class="op">.</span><span class="at">body</span>)<span class="sc">}</span></span>
<span id="cb32-1324"><a href="#cb32-1324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1325"><a href="#cb32-1325" aria-hidden="true" tabindex="-1"></a><span class="vs">## </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span></span>
<span id="cb32-1326"><a href="#cb32-1326" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">body</span>)<span class="sc">}</span></span>
<span id="cb32-1327"><a href="#cb32-1327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1328"><a href="#cb32-1328" aria-hidden="true" tabindex="-1"></a><span class="vs">## </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">hourlyExposure</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span></span>
<span id="cb32-1329"><a href="#cb32-1329" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">hourlyExposure</span><span class="op">.</span><span class="at">body</span>)<span class="sc">}</span></span>
<span id="cb32-1330"><a href="#cb32-1330" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1331"><a href="#cb32-1331" aria-hidden="true" tabindex="-1"></a><span class="vs"># </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">additionalMethods</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span></span>
<span id="cb32-1332"><a href="#cb32-1332" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">additionalMethods</span><span class="op">.</span><span class="at">body</span>)<span class="sc">}</span></span>
<span id="cb32-1333"><a href="#cb32-1333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1334"><a href="#cb32-1334" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">additionalMethods</span><span class="op">.</span><span class="at">linkNote</span>)<span class="sc">}</span></span>
<span id="cb32-1335"><a href="#cb32-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-1336"><a href="#cb32-1336" aria-hidden="true" tabindex="-1"></a><span class="vs">## </span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">citation</span><span class="op">.</span><span class="at">title</span>)<span class="sc">}</span></span>
<span id="cb32-1337"><a href="#cb32-1337" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">citation</span><span class="op">.</span><span class="at">body</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-32" data-nodetype="expression"></div></div></div><section id="appendix" class="level1 hidden"><h1 class="hidden">Appendix</h1><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb33" data-startfrom="1343" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1342"><span id="cb33-1343"><a href="#cb33-1343" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb33-1344"><a href="#cb33-1344" aria-hidden="true" tabindex="-1"></a><span class="vs">### Support notebook</span></span>
<span id="cb33-1345"><a href="#cb33-1345" aria-hidden="true" tabindex="-1"></a><span class="vs">[Support Notebook](https://observablehq.com/@periscopic/ab-atlas-spotlight-support): used for imports across spotlights.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-33" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb34" data-startfrom="1349" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1348"><span id="cb34-1349"><a href="#cb34-1349" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb34-1350"><a href="#cb34-1350" aria-hidden="true" tabindex="-1"></a><span class="vs">### Translation</span></span>
<span id="cb34-1351"><a href="#cb34-1351" aria-hidden="true" tabindex="-1"></a><span class="vs">_Notebook language handling and main text_`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-34" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="1355" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1354"><span id="cb35-1355"><a href="#cb35-1355" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Lang } <span class="im">from</span> <span class="st">"7d46679f7d0d917e"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-35" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="1359" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1358"><span id="cb36-1359"><a href="#cb36-1359" aria-hidden="true" tabindex="-1"></a>languages <span class="op">=</span> [</span>
<span id="cb36-1360"><a href="#cb36-1360" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">"en"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"English"</span><span class="op">,</span> <span class="dt">locale</span><span class="op">:</span> <span class="st">"en-US"</span> }<span class="op">,</span></span>
<span id="cb36-1361"><a href="#cb36-1361" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">"fr"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Franais"</span><span class="op">,</span> <span class="dt">locale</span><span class="op">:</span> <span class="st">"fr-FR"</span> }<span class="op">,</span></span>
<span id="cb36-1362"><a href="#cb36-1362" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-36" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="1366" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1365"><span id="cb37-1366"><a href="#cb37-1366" aria-hidden="true" tabindex="-1"></a><span class="co">// get the default language key from parameter, or use default</span></span>
<span id="cb37-1367"><a href="#cb37-1367" aria-hidden="true" tabindex="-1"></a>defaultLangKey <span class="op">=</span> {</span>
<span id="cb37-1368"><a href="#cb37-1368" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> name <span class="op">=</span> <span class="st">"lang"</span><span class="op">;</span></span>
<span id="cb37-1369"><a href="#cb37-1369" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> list <span class="op">=</span> languages<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span>
<span id="cb37-1370"><a href="#cb37-1370" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> defaultKey <span class="op">=</span> <span class="st">"en"</span><span class="op">;</span></span>
<span id="cb37-1371"><a href="#cb37-1371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1372"><a href="#cb37-1372" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> queryParam <span class="op">=</span> <span class="cf">await</span> Lang<span class="op">.</span><span class="fu">getParamFromList</span>({ name<span class="op">,</span> list })<span class="op">;</span></span>
<span id="cb37-1373"><a href="#cb37-1373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-1374"><a href="#cb37-1374" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> queryParam <span class="op">??</span> defaultKey<span class="op">;</span></span>
<span id="cb37-1375"><a href="#cb37-1375" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-37" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="1379" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1378"><span id="cb38-1379"><a href="#cb38-1379" aria-hidden="true" tabindex="-1"></a><span class="co">// helper shorthand for Lang text-getting</span></span>
<span id="cb38-1380"><a href="#cb38-1380" aria-hidden="true" tabindex="-1"></a>_lang <span class="op">=</span> Lang<span class="op">.</span><span class="fu">lg</span>(language<span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-38" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="1384" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1383"><span id="cb39-1384"><a href="#cb39-1384" aria-hidden="true" tabindex="-1"></a><span class="co">// main toggle of language key</span></span>
<span id="cb39-1385"><a href="#cb39-1385" aria-hidden="true" tabindex="-1"></a>viewof language <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>(languages<span class="op">,</span> {</span>
<span id="cb39-1386"><a href="#cb39-1386" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Main language toggle"</span><span class="op">,</span></span>
<span id="cb39-1387"><a href="#cb39-1387" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb39-1388"><a href="#cb39-1388" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> languages<span class="op">.</span><span class="fu">find</span>((x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">key</span> <span class="op">===</span> defaultLangKey)<span class="op">,</span></span>
<span id="cb39-1389"><a href="#cb39-1389" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-39" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="1393" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1392"><span id="cb40-1393"><a href="#cb40-1393" aria-hidden="true" tabindex="-1"></a>nbText <span class="op">=</span> {</span>
<span id="cb40-1394"><a href="#cb40-1394" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb40-1395"><a href="#cb40-1395" aria-hidden="true" tabindex="-1"></a>    <span class="dt">legends</span><span class="op">:</span> {</span>
<span id="cb40-1396"><a href="#cb40-1396" aria-hidden="true" tabindex="-1"></a>      <span class="dt">language</span><span class="op">:</span> {</span>
<span id="cb40-1397"><a href="#cb40-1397" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"language"</span><span class="op">,</span></span>
<span id="cb40-1398"><a href="#cb40-1398" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"langue"</span></span>
<span id="cb40-1399"><a href="#cb40-1399" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1400"><a href="#cb40-1400" aria-hidden="true" tabindex="-1"></a>      <span class="dt">toc</span><span class="op">:</span> {</span>
<span id="cb40-1401"><a href="#cb40-1401" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"in this notebook"</span><span class="op">,</span></span>
<span id="cb40-1402"><a href="#cb40-1402" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"dans ce notebook"</span></span>
<span id="cb40-1403"><a href="#cb40-1403" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1404"><a href="#cb40-1404" aria-hidden="true" tabindex="-1"></a>      <span class="dt">adminSelections</span><span class="op">:</span> {</span>
<span id="cb40-1405"><a href="#cb40-1405" aria-hidden="true" tabindex="-1"></a>        <span class="dt">country</span><span class="op">:</span> {</span>
<span id="cb40-1406"><a href="#cb40-1406" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"country"</span><span class="op">,</span></span>
<span id="cb40-1407"><a href="#cb40-1407" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"pays"</span></span>
<span id="cb40-1408"><a href="#cb40-1408" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1409"><a href="#cb40-1409" aria-hidden="true" tabindex="-1"></a>        <span class="dt">region</span><span class="op">:</span> {</span>
<span id="cb40-1410"><a href="#cb40-1410" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"region"</span><span class="op">,</span></span>
<span id="cb40-1411"><a href="#cb40-1411" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"rgion"</span></span>
<span id="cb40-1412"><a href="#cb40-1412" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1413"><a href="#cb40-1413" aria-hidden="true" tabindex="-1"></a>        <span class="dt">subregion</span><span class="op">:</span> {</span>
<span id="cb40-1414"><a href="#cb40-1414" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"subregion"</span><span class="op">,</span></span>
<span id="cb40-1415"><a href="#cb40-1415" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"sous-rgion"</span></span>
<span id="cb40-1416"><a href="#cb40-1416" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-1417"><a href="#cb40-1417" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1418"><a href="#cb40-1418" aria-hidden="true" tabindex="-1"></a>      <span class="dt">scenario</span><span class="op">:</span> {</span>
<span id="cb40-1419"><a href="#cb40-1419" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb40-1420"><a href="#cb40-1420" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"scnario"</span></span>
<span id="cb40-1421"><a href="#cb40-1421" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1422"><a href="#cb40-1422" aria-hidden="true" tabindex="-1"></a>      <span class="dt">threshold</span><span class="op">:</span> {</span>
<span id="cb40-1423"><a href="#cb40-1423" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"threshold"</span><span class="op">,</span></span>
<span id="cb40-1424"><a href="#cb40-1424" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"seuil"</span></span>
<span id="cb40-1425"><a href="#cb40-1425" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1426"><a href="#cb40-1426" aria-hidden="true" tabindex="-1"></a>      <span class="dt">season</span><span class="op">:</span> {</span>
<span id="cb40-1427"><a href="#cb40-1427" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"season"</span><span class="op">,</span></span>
<span id="cb40-1428"><a href="#cb40-1428" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"saison"</span></span>
<span id="cb40-1429"><a href="#cb40-1429" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1430"><a href="#cb40-1430" aria-hidden="true" tabindex="-1"></a>      <span class="dt">seasonTypes</span><span class="op">:</span> {</span>
<span id="cb40-1431"><a href="#cb40-1431" aria-hidden="true" tabindex="-1"></a>        <span class="dt">planting</span><span class="op">:</span> {</span>
<span id="cb40-1432"><a href="#cb40-1432" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"planting"</span><span class="op">,</span></span>
<span id="cb40-1433"><a href="#cb40-1433" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"plantation"</span></span>
<span id="cb40-1434"><a href="#cb40-1434" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1435"><a href="#cb40-1435" aria-hidden="true" tabindex="-1"></a>        <span class="dt">harvesting</span><span class="op">:</span> {</span>
<span id="cb40-1436"><a href="#cb40-1436" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"harvesting"</span><span class="op">,</span></span>
<span id="cb40-1437"><a href="#cb40-1437" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"rcolte"</span></span>
<span id="cb40-1438"><a href="#cb40-1438" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-1439"><a href="#cb40-1439" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-1440"><a href="#cb40-1440" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb40-1441"><a href="#cb40-1441" aria-hidden="true" tabindex="-1"></a>    <span class="dt">sections</span><span class="op">:</span> {</span>
<span id="cb40-1442"><a href="#cb40-1442" aria-hidden="true" tabindex="-1"></a>      <span class="dt">quickInsightsGeneral</span><span class="op">:</span> {</span>
<span id="cb40-1443"><a href="#cb40-1443" aria-hidden="true" tabindex="-1"></a>        <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb40-1444"><a href="#cb40-1444" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Quick Insights for :::selection:::"</span><span class="op">,</span></span>
<span id="cb40-1445"><a href="#cb40-1445" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Aperu Rapide pour :::selection:::"</span></span>
<span id="cb40-1446"><a href="#cb40-1446" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1447"><a href="#cb40-1447" aria-hidden="true" tabindex="-1"></a>        <span class="dt">noDataBlurb</span><span class="op">:</span> {</span>
<span id="cb40-1448"><a href="#cb40-1448" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Currently, there is no available data for this country. Please, select another country."</span><span class="op">,</span></span>
<span id="cb40-1449"><a href="#cb40-1449" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Actuellement, aucune donne nest disponible pour ce pays. Veuillez slectionner un autre pays."</span></span>
<span id="cb40-1450"><a href="#cb40-1450" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-1451"><a href="#cb40-1451" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1452"><a href="#cb40-1452" aria-hidden="true" tabindex="-1"></a>      <span class="dt">overview</span><span class="op">:</span> {</span>
<span id="cb40-1453"><a href="#cb40-1453" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1454"><a href="#cb40-1454" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Overview"</span><span class="op">,</span></span>
<span id="cb40-1455"><a href="#cb40-1455" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Vue dEnsemble"</span></span>
<span id="cb40-1456"><a href="#cb40-1456" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1457"><a href="#cb40-1457" aria-hidden="true" tabindex="-1"></a>        <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb40-1458"><a href="#cb40-1458" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"African food systems depend on manual labour for production, distribution, and processing. Economic development is leading to changes in the structure and size of the labour force. This change, in the number and size of the agricultural workforce, is happening in parallel to climate change. The intersection of these two drivers together pose a range of risks to the African continent's food systems. This notebook aims to communicate the size of the agricultural workforce at risk to extreme heat today, and in the future. It presents a new insight into this risk leveraging a range of new datasets and highlights how the workday for different labourers will be disrupted by climate change in the future. You can follow the narrative for the continent as a whole, or select individual countries for geography-specific statistics."</span><span class="op">,</span></span>
<span id="cb40-1459"><a href="#cb40-1459" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Les systmes alimentaires africains dpendent du travail manuel pour la production, la distribution et la transformation. Le dveloppement conomique entrane des changements dans la structure et la taille de la population active. Ce changement, dans le nombre et la taille de la main-duvre agricole, se produit paralllement au changement climatique. Lintersection de ces deux facteurs prsente une srie de risques pour les systmes alimentaires du continent africain. Ce carnet vise  communiquer la taille de la main duvre agricole expose aujourdhui et  lavenir  la chaleur extrme. Il prsente un nouvel aperu de ce risque en exploitant une srie de nouveaux ensembles de donnes et souligne comment la journe de travail des diffrents travailleurs sera perturbe par le changement climatique  l'avenir. Vous pouvez suivre le rcit du continent dans son ensemble ou slectionner des pays individuels pour obtenir des statistiques spcifiques  la gographie."</span></span>
<span id="cb40-1460"><a href="#cb40-1460" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-1461"><a href="#cb40-1461" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1462"><a href="#cb40-1462" aria-hidden="true" tabindex="-1"></a>      <span class="dt">futureWorkforce</span><span class="op">:</span> {</span>
<span id="cb40-1463"><a href="#cb40-1463" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1464"><a href="#cb40-1464" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"The Future of the Agricultural Workforce"</span><span class="op">,</span></span>
<span id="cb40-1465"><a href="#cb40-1465" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Lavenir de la Main-duvre Agricole"</span></span>
<span id="cb40-1466"><a href="#cb40-1466" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1467"><a href="#cb40-1467" aria-hidden="true" tabindex="-1"></a>        <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb40-1468"><a href="#cb40-1468" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"The agricultural workforce covers the entire employed portion of the employable population involved in the agriculture sector. In the African continent, the vast majority of these are farmers. However, the number of farmers and the size of the workforce is not static, and depends on structural factors which drive rural population growth, push or pull the rural population towards urban areas over time.  Here, you can explore how the size of the agricultural workforce today and how it will change as a result of these factors in the future."</span><span class="op">,</span></span>
<span id="cb40-1469"><a href="#cb40-1469" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"La main duvre agricole couvre lensemble de la part occupe de la population employable implique dans le secteur agricole. Sur le continent africain, la grande majorit dentre eux sont des agriculteurs. Cependant, le nombre dagriculteurs et la taille de la main duvre ne sont pas statiques et dpendent de facteurs structurels qui stimulent la croissance de la population rurale, poussent ou attirent la population rurale vers les zones urbaines au fil du temps. Ici, vous pouvez dcouvrir comment la taille de la main-duvre agricole aujourdhui et comment elle voluera en raison de ces facteurs  lavenir."</span></span>
<span id="cb40-1470"><a href="#cb40-1470" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1471"><a href="#cb40-1471" aria-hidden="true" tabindex="-1"></a>        <span class="dt">map</span><span class="op">:</span> {</span>
<span id="cb40-1472"><a href="#cb40-1472" aria-hidden="true" tabindex="-1"></a>          <span class="dt">caption</span><span class="op">:</span> {</span>
<span id="cb40-1473"><a href="#cb40-1473" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`Grey regions signal lack of :::selector::: data`</span><span class="op">,</span></span>
<span id="cb40-1474"><a href="#cb40-1474" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Les rgions grises signalent un manque de donnes sur la :::selector:::`</span></span>
<span id="cb40-1475"><a href="#cb40-1475" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1476"><a href="#cb40-1476" aria-hidden="true" tabindex="-1"></a>          <span class="dt">mapLayer</span><span class="op">:</span> {</span>
<span id="cb40-1477"><a href="#cb40-1477" aria-hidden="true" tabindex="-1"></a>            <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1478"><a href="#cb40-1478" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Map Layer"</span><span class="op">,</span></span>
<span id="cb40-1479"><a href="#cb40-1479" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Couche de Carte"</span></span>
<span id="cb40-1480"><a href="#cb40-1480" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb40-1481"><a href="#cb40-1481" aria-hidden="true" tabindex="-1"></a>            <span class="dt">values</span><span class="op">:</span> {</span>
<span id="cb40-1482"><a href="#cb40-1482" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ag_workforce_data_2</span><span class="op">:</span> {</span>
<span id="cb40-1483"><a href="#cb40-1483" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb40-1484"><a href="#cb40-1484" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Ag population baseline (circa 2005)"</span><span class="op">,</span></span>
<span id="cb40-1485"><a href="#cb40-1485" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Rfrence de la population agricole (vers 2005)"</span></span>
<span id="cb40-1486"><a href="#cb40-1486" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb40-1487"><a href="#cb40-1487" aria-hidden="true" tabindex="-1"></a>                <span class="dt">labelTip</span><span class="op">:</span> {</span>
<span id="cb40-1488"><a href="#cb40-1488" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Ag population"</span><span class="op">,</span></span>
<span id="cb40-1489"><a href="#cb40-1489" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population agricole"</span></span>
<span id="cb40-1490"><a href="#cb40-1490" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb40-1491"><a href="#cb40-1491" aria-hidden="true" tabindex="-1"></a>                <span class="dt">labelLegend</span><span class="op">:</span> {</span>
<span id="cb40-1492"><a href="#cb40-1492" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Ag population"</span><span class="op">,</span></span>
<span id="cb40-1493"><a href="#cb40-1493" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population agricole"</span></span>
<span id="cb40-1494"><a href="#cb40-1494" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb40-1495"><a href="#cb40-1495" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb40-1496"><a href="#cb40-1496" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ag_workforce_data_1</span><span class="op">:</span> {</span>
<span id="cb40-1497"><a href="#cb40-1497" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb40-1498"><a href="#cb40-1498" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Percentage change by 2030"</span><span class="op">,</span></span>
<span id="cb40-1499"><a href="#cb40-1499" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Pourcentage de changement dici 2030"</span></span>
<span id="cb40-1500"><a href="#cb40-1500" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb40-1501"><a href="#cb40-1501" aria-hidden="true" tabindex="-1"></a>                <span class="dt">labelTip</span><span class="op">:</span> {</span>
<span id="cb40-1502"><a href="#cb40-1502" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Population change by 2030"</span><span class="op">,</span></span>
<span id="cb40-1503"><a href="#cb40-1503" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Changement en population dici 2030"</span></span>
<span id="cb40-1504"><a href="#cb40-1504" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb40-1505"><a href="#cb40-1505" aria-hidden="true" tabindex="-1"></a>                <span class="dt">labelLegend</span><span class="op">:</span> {</span>
<span id="cb40-1506"><a href="#cb40-1506" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Population change by 2030 (%)"</span><span class="op">,</span></span>
<span id="cb40-1507"><a href="#cb40-1507" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Changement en population dici 2030 (%)"</span></span>
<span id="cb40-1508"><a href="#cb40-1508" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb40-1509"><a href="#cb40-1509" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb40-1510"><a href="#cb40-1510" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ag_workforce_data</span><span class="op">:</span> {</span>
<span id="cb40-1511"><a href="#cb40-1511" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb40-1512"><a href="#cb40-1512" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Percentage change by 2050"</span><span class="op">,</span></span>
<span id="cb40-1513"><a href="#cb40-1513" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Pourcentage de changement dici 2050"</span></span>
<span id="cb40-1514"><a href="#cb40-1514" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb40-1515"><a href="#cb40-1515" aria-hidden="true" tabindex="-1"></a>                <span class="dt">labelTip</span><span class="op">:</span> {</span>
<span id="cb40-1516"><a href="#cb40-1516" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Population change by 2050"</span><span class="op">,</span></span>
<span id="cb40-1517"><a href="#cb40-1517" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Changement en population dici 2050"</span></span>
<span id="cb40-1518"><a href="#cb40-1518" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb40-1519"><a href="#cb40-1519" aria-hidden="true" tabindex="-1"></a>                <span class="dt">labelLegend</span><span class="op">:</span> {</span>
<span id="cb40-1520"><a href="#cb40-1520" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Population change by 2050 (%)"</span><span class="op">,</span></span>
<span id="cb40-1521"><a href="#cb40-1521" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Changement en population dici 2050 (%)"</span></span>
<span id="cb40-1522"><a href="#cb40-1522" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb40-1523"><a href="#cb40-1523" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb40-1524"><a href="#cb40-1524" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ag_workforce_data_15</span><span class="op">:</span> {</span>
<span id="cb40-1525"><a href="#cb40-1525" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb40-1526"><a href="#cb40-1526" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Ag population in 2030"</span><span class="op">,</span></span>
<span id="cb40-1527"><a href="#cb40-1527" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population agricole en 2030"</span></span>
<span id="cb40-1528"><a href="#cb40-1528" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb40-1529"><a href="#cb40-1529" aria-hidden="true" tabindex="-1"></a>                <span class="dt">labelTip</span><span class="op">:</span> {</span>
<span id="cb40-1530"><a href="#cb40-1530" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Ag population in 2030"</span><span class="op">,</span></span>
<span id="cb40-1531"><a href="#cb40-1531" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population agricole en 2030"</span></span>
<span id="cb40-1532"><a href="#cb40-1532" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb40-1533"><a href="#cb40-1533" aria-hidden="true" tabindex="-1"></a>                <span class="dt">labelLegend</span><span class="op">:</span> {</span>
<span id="cb40-1534"><a href="#cb40-1534" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Ag population in 2030"</span><span class="op">,</span></span>
<span id="cb40-1535"><a href="#cb40-1535" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population agricole en 2030"</span></span>
<span id="cb40-1536"><a href="#cb40-1536" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb40-1537"><a href="#cb40-1537" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb40-1538"><a href="#cb40-1538" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ag_workforce_data_10</span><span class="op">:</span> {</span>
<span id="cb40-1539"><a href="#cb40-1539" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb40-1540"><a href="#cb40-1540" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Ag population in 2050"</span><span class="op">,</span></span>
<span id="cb40-1541"><a href="#cb40-1541" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population agricole en 2050"</span></span>
<span id="cb40-1542"><a href="#cb40-1542" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb40-1543"><a href="#cb40-1543" aria-hidden="true" tabindex="-1"></a>                <span class="dt">labelTip</span><span class="op">:</span> {</span>
<span id="cb40-1544"><a href="#cb40-1544" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Ag population in 2050"</span><span class="op">,</span></span>
<span id="cb40-1545"><a href="#cb40-1545" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population agricole en 2050"</span></span>
<span id="cb40-1546"><a href="#cb40-1546" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb40-1547"><a href="#cb40-1547" aria-hidden="true" tabindex="-1"></a>                <span class="dt">labelLegend</span><span class="op">:</span> {</span>
<span id="cb40-1548"><a href="#cb40-1548" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Ag population in 2050"</span><span class="op">,</span></span>
<span id="cb40-1549"><a href="#cb40-1549" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population agricole en 2050"</span></span>
<span id="cb40-1550"><a href="#cb40-1550" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb40-1551"><a href="#cb40-1551" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb40-1552"><a href="#cb40-1552" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb40-1553"><a href="#cb40-1553" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1554"><a href="#cb40-1554" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1555"><a href="#cb40-1555" aria-hidden="true" tabindex="-1"></a>        <span class="dt">quickInsights</span><span class="op">:</span> {</span>
<span id="cb40-1556"><a href="#cb40-1556" aria-hidden="true" tabindex="-1"></a>          <span class="dt">direction</span><span class="op">:</span> {</span>
<span id="cb40-1557"><a href="#cb40-1557" aria-hidden="true" tabindex="-1"></a>            <span class="dt">inc</span><span class="op">:</span> {</span>
<span id="cb40-1558"><a href="#cb40-1558" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"an increase"</span><span class="op">,</span></span>
<span id="cb40-1559"><a href="#cb40-1559" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"une augmentation"</span></span>
<span id="cb40-1560"><a href="#cb40-1560" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb40-1561"><a href="#cb40-1561" aria-hidden="true" tabindex="-1"></a>            <span class="dt">dec</span><span class="op">:</span> {</span>
<span id="cb40-1562"><a href="#cb40-1562" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"a decrease"</span><span class="op">,</span></span>
<span id="cb40-1563"><a href="#cb40-1563" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"une diminution"</span></span>
<span id="cb40-1564"><a href="#cb40-1564" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb40-1565"><a href="#cb40-1565" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1566"><a href="#cb40-1566" aria-hidden="true" tabindex="-1"></a>          <span class="dt">basePop</span><span class="op">:</span> {</span>
<span id="cb40-1567"><a href="#cb40-1567" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`**:::geo:::**s total agricultural population is **:::total:::** for the baseline year, circa 2005.`</span><span class="op">,</span></span>
<span id="cb40-1568"><a href="#cb40-1568" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`La population agricole totale **:::geo:::** est de **:::total:::** pour lanne de rfrence, vers 2005.`</span></span>
<span id="cb40-1569"><a href="#cb40-1569" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span> </span>
<span id="cb40-1570"><a href="#cb40-1570" aria-hidden="true" tabindex="-1"></a>          <span class="dt">popChange</span><span class="op">:</span> {</span>
<span id="cb40-1571"><a href="#cb40-1571" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`The total agricultural population is expected to change to **:::change2030:::** by 2030, and to **:::change2050:::** by 2050, under SSP245. These represent **:::direction2030:::** of **:::perc2030:::%** and **:::direction2050:::** of **:::perc2050:::%**, respectively.`</span><span class="op">,</span></span>
<span id="cb40-1572"><a href="#cb40-1572" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`La population agricole totale devrait passer  **:::change2030:::** dici 2030 et  **:::change2050:::** dici 2050, dans le cadre du SSP245. Cela reprsente **:::direction2030:::** de **:::perc2030:::%** et **:::direction2050:::** de **:::perc2050:::%**, respectivement.`</span></span>
<span id="cb40-1573"><a href="#cb40-1573" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1574"><a href="#cb40-1574" aria-hidden="true" tabindex="-1"></a>          <span class="dt">popScenario</span><span class="op">:</span> {</span>
<span id="cb40-1575"><a href="#cb40-1575" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`Under SSP585, the total agricultural population will be **:::pop2030:::** by 2030 and **:::pop2050:::** by 2050. These represent **:::direction:::** of **:::perc2030:::%** and **:::perc2050:::%**, respectively.`</span><span class="op">,</span></span>
<span id="cb40-1576"><a href="#cb40-1576" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Dans le cadre du SSP585, la population agricole totale sera de **:::pop2030:::** d'ici 2030 et de **:::pop2050:::** d'ici 2050. Cela reprsente **:::direction:::** de **:::perc2030:::%** et **:::perc2050:::%**, respectivement.`</span></span>
<span id="cb40-1577"><a href="#cb40-1577" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1578"><a href="#cb40-1578" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-1579"><a href="#cb40-1579" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1580"><a href="#cb40-1580" aria-hidden="true" tabindex="-1"></a>      <span class="dt">heatStress</span><span class="op">:</span> {</span>
<span id="cb40-1581"><a href="#cb40-1581" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1582"><a href="#cb40-1582" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Heat Stress in Numbers"</span><span class="op">,</span></span>
<span id="cb40-1583"><a href="#cb40-1583" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Le Stress Thermique en Chiffres"</span></span>
<span id="cb40-1584"><a href="#cb40-1584" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1585"><a href="#cb40-1585" aria-hidden="true" tabindex="-1"></a>        <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb40-1586"><a href="#cb40-1586" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"An important question is how the increases in agricultural workforce on the African continent will be affected by climate change. A key indicator of climate change impacts on human well being is heat stress. The level of heat stress experienced by a person depends not only on temperature but also on humidity, which are together often represented in terms of Wet Bulb Globe Temperature, where thresholds exceeding 28C are considered harmful, and those exceeding 32C extremely harmful. Use the dropdowns below to explore how many days in the year the agricultural workforce will be exposed to harmful heat stress for specific geographies, temperature thresholds and climate change scenarios."</span><span class="op">,</span></span>
<span id="cb40-1587"><a href="#cb40-1587" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Une question importante est de savoir comment les augmentations de la main-d'uvre agricole sur le continent africain seront affectes par le changement climatique. Un indicateur cl des impacts du changement climatique sur le bien-tre humain est le stress thermique. Le niveau de stress thermique ressenti par une personne dpend non seulement de la temprature mais aussi de l'humidit, qui sont souvent reprsents conjointement en termes de temprature du globe humide, o des seuils dpassant 28C sont considrs comme nuisibles, et ceux dpassant 32C extrmement nuisibles. Utilisez les menus droulants ci-dessous pour explorer combien de jours dans l'anne la main-d'uvre agricole sera expose  un stress thermique nuisible pour des gographies spcifiques, des seuils de temprature et des scnarios de changement climatique."</span></span>
<span id="cb40-1588"><a href="#cb40-1588" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1589"><a href="#cb40-1589" aria-hidden="true" tabindex="-1"></a>        <span class="dt">barChart</span><span class="op">:</span> {</span>
<span id="cb40-1590"><a href="#cb40-1590" aria-hidden="true" tabindex="-1"></a>          <span class="dt">caption</span><span class="op">:</span> {</span>
<span id="cb40-1591"><a href="#cb40-1591" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"To ensure that the details across all bins are visible without being dominated by the initial range, the 0-5% bin has been intentionally excluded from this visualization."</span><span class="op">,</span></span>
<span id="cb40-1592"><a href="#cb40-1592" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Pour garantir que les dtails dans tous les groupes sont visibles sans tre domins par la plage initiale, le groupe 0-5 % a t intentionnellement exclu de cette visualisation."</span></span>
<span id="cb40-1593"><a href="#cb40-1593" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1594"><a href="#cb40-1594" aria-hidden="true" tabindex="-1"></a>          <span class="dt">group</span><span class="op">:</span> {</span>
<span id="cb40-1595"><a href="#cb40-1595" aria-hidden="true" tabindex="-1"></a>            <span class="dt">baseline</span><span class="op">:</span> {</span>
<span id="cb40-1596"><a href="#cb40-1596" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Baseline"</span><span class="op">,</span></span>
<span id="cb40-1597"><a href="#cb40-1597" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Rfrence"</span></span>
<span id="cb40-1598"><a href="#cb40-1598" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb40-1599"><a href="#cb40-1599" aria-hidden="true" tabindex="-1"></a>            <span class="dt">projection</span><span class="op">:</span> {</span>
<span id="cb40-1600"><a href="#cb40-1600" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Projection"</span><span class="op">,</span></span>
<span id="cb40-1601"><a href="#cb40-1601" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Projection"</span></span>
<span id="cb40-1602"><a href="#cb40-1602" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb40-1603"><a href="#cb40-1603" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1604"><a href="#cb40-1604" aria-hidden="true" tabindex="-1"></a>          <span class="dt">xLabel</span><span class="op">:</span> {</span>
<span id="cb40-1605"><a href="#cb40-1605" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Percent of Year Exceeding Safe Working Conditions"</span><span class="op">,</span></span>
<span id="cb40-1606"><a href="#cb40-1606" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Pourcentage de l'anne dpassant les conditions de travail scuritaires"</span></span>
<span id="cb40-1607"><a href="#cb40-1607" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1608"><a href="#cb40-1608" aria-hidden="true" tabindex="-1"></a>          <span class="dt">yLabel</span><span class="op">:</span> {</span>
<span id="cb40-1609"><a href="#cb40-1609" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"People Exposed"</span><span class="op">,</span></span>
<span id="cb40-1610"><a href="#cb40-1610" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Personnes Exposes"</span></span>
<span id="cb40-1611"><a href="#cb40-1611" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1612"><a href="#cb40-1612" aria-hidden="true" tabindex="-1"></a>          <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb40-1613"><a href="#cb40-1613" aria-hidden="true" tabindex="-1"></a>            <span class="dt">exposed</span><span class="op">:</span> {</span>
<span id="cb40-1614"><a href="#cb40-1614" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Ag pop exposed"</span><span class="op">,</span></span>
<span id="cb40-1615"><a href="#cb40-1615" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population agricole expose"</span></span>
<span id="cb40-1616"><a href="#cb40-1616" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb40-1617"><a href="#cb40-1617" aria-hidden="true" tabindex="-1"></a>            <span class="dt">period</span><span class="op">:</span> {</span>
<span id="cb40-1618"><a href="#cb40-1618" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Period"</span><span class="op">,</span></span>
<span id="cb40-1619"><a href="#cb40-1619" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Priode"</span></span>
<span id="cb40-1620"><a href="#cb40-1620" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb40-1621"><a href="#cb40-1621" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1622"><a href="#cb40-1622" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1623"><a href="#cb40-1623" aria-hidden="true" tabindex="-1"></a>        <span class="dt">figureBody</span><span class="op">:</span> {</span>
<span id="cb40-1624"><a href="#cb40-1624" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"The figure presents the count of agricultural workers subject to unsafe Wet Bulb Globe Temperature (WBGT) levels across the year, based on both baseline data and projections. For instance, if a projection displays 16 million people within the 45%-50% bin, it means that these individuals are exposed to unsafe working conditions for a portion of their day, 45% to 50% of the days in the year."</span><span class="op">,</span></span>
<span id="cb40-1625"><a href="#cb40-1625" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"La figure prsente le nombre de travailleurs agricoles soumis  des niveaux dangereux de temprature du globe humide (WBGT) tout au long de lanne, sur la base  la fois de donnes de base et de projections. Par exemple, si une projection affiche 16 millions de personnes dans la tranche 45  50 %, cela signifie que ces personnes sont exposes  des conditions de travail dangereuses pendant une partie de leur journe, soit 45  50 % des jours de lanne."</span></span>
<span id="cb40-1626"><a href="#cb40-1626" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1627"><a href="#cb40-1627" aria-hidden="true" tabindex="-1"></a>        <span class="dt">quickInsights</span><span class="op">:</span> {</span>
<span id="cb40-1628"><a href="#cb40-1628" aria-hidden="true" tabindex="-1"></a>          <span class="dt">overview</span><span class="op">:</span> {</span>
<span id="cb40-1629"><a href="#cb40-1629" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`For over **100 days** in a year, the people at risk for the baseline were **:::baseRisk:::**; under the scenario **:::scenario:::** and year **:::year:::**, it ascends to **:::projectionRisk:::**.`</span><span class="op">,</span></span>
<span id="cb40-1630"><a href="#cb40-1630" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Pendant plus de **100 jours** par an, les personnes  risque taient de **:::baseRisk:::**; dans le scnario **:::scenario:::** et l'anne **:::year:::**, il monte  **:::projectionRisk::: de personnes**.`</span></span>
<span id="cb40-1631"><a href="#cb40-1631" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1632"><a href="#cb40-1632" aria-hidden="true" tabindex="-1"></a>          <span class="dt">half</span><span class="op">:</span> {</span>
<span id="cb40-1633"><a href="#cb40-1633" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`For the baseline period, **:::baseline:::** people experienced unsafe working conditions for at least **half of the days** in the year. Under the scenario **:::scenario:::** and year **:::year:::**, it's expected to rise to **:::projection:::** people.`</span><span class="op">,</span></span>
<span id="cb40-1634"><a href="#cb40-1634" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Pour la priode de rfrence, **:::baseline:::** personnes ont connu des conditions de travail dangereuses pendant au moins la **moiti des jours** de l'anne. Dans le scnario **:::scenario:::** et l'anne **:::year:::**, on s'attend  ce qu'il s'lve  **:::projection:::** personnes.`</span></span>
<span id="cb40-1635"><a href="#cb40-1635" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1636"><a href="#cb40-1636" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-1637"><a href="#cb40-1637" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1638"><a href="#cb40-1638" aria-hidden="true" tabindex="-1"></a>      <span class="dt">workingHours</span><span class="op">:</span> {</span>
<span id="cb40-1639"><a href="#cb40-1639" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1640"><a href="#cb40-1640" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Loss of Safe Working Hours"</span><span class="op">,</span></span>
<span id="cb40-1641"><a href="#cb40-1641" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Perte d'Heures de Travail Scurises"</span></span>
<span id="cb40-1642"><a href="#cb40-1642" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1643"><a href="#cb40-1643" aria-hidden="true" tabindex="-1"></a>        <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb40-1644"><a href="#cb40-1644" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Importantly, it is not just the days of climate disruptions to the agricultural workforce that matter. The hours during the day and the time in the growing season, whether planting, or harvesting, all influence  how these disruptions will take place and impact on the sector. Use the figure below to explore how these safe working hours will be disrupted for different populations under different climate scenarios, temperature thresholds, and different geographies on the African continent."</span><span class="op">,</span></span>
<span id="cb40-1645"><a href="#cb40-1645" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Il est important de noter que ce ne sont pas seulement les jours de perturbations climatiques qui affectent la main-d'uvre agricole qui comptent. Les heures pendant la journe et le moment dans la saison de croissance, que ce soit lors de la plantation ou de la rcolte, influencent toutes la manire dont ces perturbations se produiront et auront un impact sur le secteur. Utilisez la figure ci-dessous pour explorer comment ces heures de travail scurises seront perturbes pour diffrentes populations sous diffrents scnarios climatiques, seuils de temprature et diffrentes gographies sur le continent africain."</span></span>
<span id="cb40-1646"><a href="#cb40-1646" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1647"><a href="#cb40-1647" aria-hidden="true" tabindex="-1"></a>        <span class="dt">barChart</span><span class="op">:</span> {</span>
<span id="cb40-1648"><a href="#cb40-1648" aria-hidden="true" tabindex="-1"></a>          <span class="dt">xLabel</span><span class="op">:</span> {</span>
<span id="cb40-1649"><a href="#cb40-1649" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Hour of Day"</span><span class="op">,</span></span>
<span id="cb40-1650"><a href="#cb40-1650" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Heure de la Journe"</span></span>
<span id="cb40-1651"><a href="#cb40-1651" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1652"><a href="#cb40-1652" aria-hidden="true" tabindex="-1"></a>          <span class="dt">yLabel</span><span class="op">:</span> {</span>
<span id="cb40-1653"><a href="#cb40-1653" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Percent Loss of Season due to Extreme Heat"</span><span class="op">,</span></span>
<span id="cb40-1654"><a href="#cb40-1654" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Pourcentage de Perte de Saison due  une Chaleur Extrme"</span></span>
<span id="cb40-1655"><a href="#cb40-1655" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1656"><a href="#cb40-1656" aria-hidden="true" tabindex="-1"></a>          <span class="dt">tooltip</span><span class="op">:</span> {</span>
<span id="cb40-1657"><a href="#cb40-1657" aria-hidden="true" tabindex="-1"></a>            <span class="dt">perc</span><span class="op">:</span> {</span>
<span id="cb40-1658"><a href="#cb40-1658" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Percent loss"</span><span class="op">,</span></span>
<span id="cb40-1659"><a href="#cb40-1659" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Pourcentage de perte"</span></span>
<span id="cb40-1660"><a href="#cb40-1660" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb40-1661"><a href="#cb40-1661" aria-hidden="true" tabindex="-1"></a>            <span class="dt">period</span><span class="op">:</span> {</span>
<span id="cb40-1662"><a href="#cb40-1662" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Period"</span><span class="op">,</span></span>
<span id="cb40-1663"><a href="#cb40-1663" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Priode"</span></span>
<span id="cb40-1664"><a href="#cb40-1664" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb40-1665"><a href="#cb40-1665" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1666"><a href="#cb40-1666" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1667"><a href="#cb40-1667" aria-hidden="true" tabindex="-1"></a>        <span class="dt">quickInsights</span><span class="op">:</span> {</span>
<span id="cb40-1668"><a href="#cb40-1668" aria-hidden="true" tabindex="-1"></a>          <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb40-1669"><a href="#cb40-1669" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`The figure illustrates the percentage of the harvesting and planting seasons during which the Wet Bulb Globe Temperature (WBGT) surpasses safe working limits, as per the selected threshold, relative to the baseline. This highlights the projected changes for the future. For example, a **15%** figure for the harvesting season at 11am indicates that, under the specified scenario and year, there will be **15% fewer days** out of the total season where the population can work safely at that time.`</span><span class="op">,</span></span>
<span id="cb40-1670"><a href="#cb40-1670" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`La figure illustre le pourcentage des saisons de rcolte et de plantation au cours desquelles la temprature du globe humide (WBGT) dpasse les limites de travail scuritaire, selon le seuil slectionn, par rapport  la rfrence. Cela met en vidence les changements projets pour lavenir. Par exemple, un chiffre de **15%** pour la saison de rcolte  11 heures du matin indique que, selon le scnario et l'anne spcifis, il y aura **15% de jours en moins** sur la saison totale o la population pourra travailler en toute scurit  ce moment-l.`</span></span>
<span id="cb40-1671"><a href="#cb40-1671" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1672"><a href="#cb40-1672" aria-hidden="true" tabindex="-1"></a>          <span class="dt">body</span><span class="op">:</span> {</span>
<span id="cb40-1673"><a href="#cb40-1673" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`Under scenario **:::scenario:::** and year **:::year:::**, a policy of avoiding unsafe working hours would translate into **:::totalHours:::** working hours lost during the harvesting season, spanning **:::daysHarvest:::** days; if we consider a common working day to have 8 hours, this translates into **:::wholeWorkingDays:::** total working days lost in harvesting in a year.`</span><span class="op">,</span></span>
<span id="cb40-1674"><a href="#cb40-1674" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Dans le scnario **:::scenario:::** et lanne **:::year:::**, une politique visant  viter les heures de travail dangereuses se traduirait par **:::totalHours:::** heures de travail perdues pendant la saison des rcoltes, stalant sur **:::daysHarvest:::** jours; si lon considre quune journe de travail commune compte 8 heures, cela se traduit par **:::wholeWorkingDays:::** jours de travail perdus au total pour la rcolte au cours dune anne.`</span></span>
<span id="cb40-1675"><a href="#cb40-1675" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1676"><a href="#cb40-1676" aria-hidden="true" tabindex="-1"></a>          <span class="dt">lostDays</span><span class="op">:</span> {</span>
<span id="cb40-1677"><a href="#cb40-1677" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`For the planting period, spanning **:::period:::** days, **:::geo:::** would lose **:::lostDays:::** whole working days.`</span><span class="op">,</span></span>
<span id="cb40-1678"><a href="#cb40-1678" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Pour la priode de plantation, qui s'tend sur **:::period:::** jours, **:::geo:::** perdrait **:::lostDays:::** jours de travail entiers.`</span></span>
<span id="cb40-1679"><a href="#cb40-1679" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1680"><a href="#cb40-1680" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-1681"><a href="#cb40-1681" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1682"><a href="#cb40-1682" aria-hidden="true" tabindex="-1"></a>      <span class="dt">summary</span><span class="op">:</span> {</span>
<span id="cb40-1683"><a href="#cb40-1683" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1684"><a href="#cb40-1684" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Summary"</span><span class="op">,</span></span>
<span id="cb40-1685"><a href="#cb40-1685" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Rsum"</span></span>
<span id="cb40-1686"><a href="#cb40-1686" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1687"><a href="#cb40-1687" aria-hidden="true" tabindex="-1"></a>        <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb40-1688"><a href="#cb40-1688" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Climate change will drive disruptions to the African agricultural labour force. This has important implications for economic development, human health, gender equity, as well as food security. The size of the expected disruptions depend not only on climate stressors, such as increasing heat stress, but also on the expected change in the size of the agricultural workforce. There are a number of locations where these two factors will collide, driving increased risks, loss of safe working hours, agricultural productivity, and ultimately the right to work in a safe climate for millions. A number of solutions have been proposed to deal with this stress, including shifting working hours shifting in working hours, increased shade on farms, increased mechanisation, improved worker safety protocols, improved hydration and other heat stress coping mechanisms. Ultimately however, solutions on the scale of adaptation required have yet to be developed, and based on the size of this risk need to be addressed urgently to maintain human health and environmental rights, agricultural productivity, and food security, now and in the future."</span><span class="op">,</span></span>
<span id="cb40-1689"><a href="#cb40-1689" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Le changement climatique entranera des perturbations dans la main-duvre agricole africaine. Cela a des implications importantes pour le dveloppement conomique, la sant humaine, lquit entre les sexes ainsi que la scurit alimentaire. Lampleur des perturbations attendues dpend non seulement des facteurs de stress climatiques, tels que laugmentation du stress thermique, mais galement de lvolution attendue de la taille de la main duvre agricole. Il existe un certain nombre dendroits o ces deux facteurs entreront en collision, entranant une augmentation des risques, une perte dheures de travail sres, une perte de productivit agricole et, en fin de compte, le droit de travailler dans un climat sr pour des millions de personnes. Un certain nombre de solutions ont t proposes pour faire face  ce stress, notamment le dcalage des horaires de travail, l'augmentation de l'ombre dans les fermes, l'augmentation de la mcanisation, l'amlioration des protocoles de scurit des travailleurs, l'amlioration de l'hydratation et d'autres mcanismes d'adaptation au stress thermique. Toutefois, en fin de compte, les solutions  lchelle dadaptation requise doivent encore tre dveloppes et, compte tenu de lampleur de ce risque, il convient dy remdier de toute urgence afin de prserver la sant humaine et les droits environnementaux, la productivit agricole et la scurit alimentaire, aujourdhui et  lavenir."</span></span>
<span id="cb40-1690"><a href="#cb40-1690" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-1691"><a href="#cb40-1691" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb40-1692"><a href="#cb40-1692" aria-hidden="true" tabindex="-1"></a>      <span class="dt">methods</span><span class="op">:</span> {</span>
<span id="cb40-1693"><a href="#cb40-1693" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1694"><a href="#cb40-1694" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Methods"</span><span class="op">,</span></span>
<span id="cb40-1695"><a href="#cb40-1695" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Mthodologie"</span></span>
<span id="cb40-1696"><a href="#cb40-1696" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1697"><a href="#cb40-1697" aria-hidden="true" tabindex="-1"></a>        <span class="dt">agWorkforce</span><span class="op">:</span> {</span>
<span id="cb40-1698"><a href="#cb40-1698" aria-hidden="true" tabindex="-1"></a>          <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1699"><a href="#cb40-1699" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Agricultural workforce"</span><span class="op">,</span></span>
<span id="cb40-1700"><a href="#cb40-1700" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Main d'uvre agricole"</span></span>
<span id="cb40-1701"><a href="#cb40-1701" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1702"><a href="#cb40-1702" aria-hidden="true" tabindex="-1"></a>          <span class="dt">body</span><span class="op">:</span> {</span>
<span id="cb40-1703"><a href="#cb40-1703" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`We generated gridded predictions for the agricultural workforce by first harmonising subnational data from census statistics from a range of government sources, with national data from the [International Labour Organisation (ILO)](https://rshiny.ilo.org/dataexplorer36/?lang=en&amp;segment=indicator&amp;id=EAP_2WAP_SEX_AGE_RT_A) on the proportion of the population employed in agriculture. Then, using a geospatial version of the predictive framework introduced by [Mehrabi, Z (2023) Nat Sust](https://doi.org/10.1038/s41893-023-01110-y), we fit functions relating workforce size to [population statistics from Jones and ONeill (2016)](https://www.cgd.ucar.edu/sections/iam/modeling/spatial-population), [gridded gdp from Wang and Sun (2022)](https://www.nature.com/articles/s41597-022-01300-x), and [agricultural land area by Ramankutty et al. (2008)](https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2007GB002952). We employed stacked machine learning models (boosted regression trees, random forests) for the fitting process. Using these models and current and future gridded data we generated baseline-period (circa 2005) and future (2030, 2050) estimates of the agricultural workforce at 0.083 degrees resolution for the African continent.`</span><span class="op">,</span></span>
<span id="cb40-1704"><a href="#cb40-1704" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Nous avons gnr des prvisions en grille pour la main-d'uvre agricole en harmonisant d'abord les donnes subnationales issues des statistiques de recensement provenant de diverses sources gouvernementales, avec les donnes nationales de [l'Organisation internationale du travail](https://rshiny.ilo.org/dataexplorer36/?lang=en&amp;segment=indicator&amp;id=EAP_2WAP_SEX_AGE_RT_A) (OIT) sur la proportion de la population employe dans l'agriculture. Ensuite, en utilisant une version gospatiale du cadre prdictif introduit par [Mehrabi, Z (2023) Nat Sust](https://doi.org/10.1038/s41893-023-01110-y), nous ajustons les fonctions reliant la taille de la main-d'uvre aux [statistiques dmographiques de Jones et O'Neill (2016)](https://www.cgd.ucar.edu/sections/iam/modeling/spatial-population), [le PIB maill de Wang et Sun (2022)](https://www.nature.com/articles/s41597-022-01300-x), et la [superficie des terres agricoles par Ramankutty et al. (2008)](https://agupubs.onlinelibrary.wiley.com/doi/10.1029/2007GB002952). Nous avons utilis des modles d'apprentissage automatique empils (arbres de rgression amliors, random forests) pour le processus d'ajustement.  laide de ces modles et des donnes en grille actuelles et futures, nous avons gnr des estimations pour la priode de rfrence (vers 2005) et future (2030, 2050) de la main-duvre agricole avec une rsolution de 0,083 degrs pour le continent africain.`</span></span>
<span id="cb40-1705"><a href="#cb40-1705" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1706"><a href="#cb40-1706" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1707"><a href="#cb40-1707" aria-hidden="true" tabindex="-1"></a>        <span class="dt">heatStress</span><span class="op">:</span> {</span>
<span id="cb40-1708"><a href="#cb40-1708" aria-hidden="true" tabindex="-1"></a>          <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1709"><a href="#cb40-1709" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Heat stress"</span><span class="op">,</span></span>
<span id="cb40-1710"><a href="#cb40-1710" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Stress thermique"</span></span>
<span id="cb40-1711"><a href="#cb40-1711" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1712"><a href="#cb40-1712" aria-hidden="true" tabindex="-1"></a>          <span class="dt">body</span><span class="op">:</span> {</span>
<span id="cb40-1713"><a href="#cb40-1713" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`We use high-resolution, daily gridded data from the Climate Hazards Center Coupled Model Intercomparison Project Phase 6 (CHC-CMIP6) dataset [Williams et al. (2024)](https://www.nature.com/articles/s41597-024-03074-w). The CHC-CMIP6 dataset provides future estimates for 2030 and 2050, whose delta fields are based on the CMIP6 multi-model ensemble forecasts for the SSP 245 and SSP 585 scenarios. As inputs to compute WBGT values, we take from the dataset three main variables: the daily maximum and minimum temperatures (Tmax and Tmin), as well as the maximum daily relative humidity (RHx) that occurs at the time of Tmax, for both, the observation period (circa 2005, average taken across 10 years), and the future projections under SSP 2.45 and 5.85 (years 2030 and 2050, average taken across 10 years).`</span><span class="op">,</span></span>
<span id="cb40-1714"><a href="#cb40-1714" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Nous utilisons des donnes en grille quotidiennes  haute rsolution provenant de l'ensemble de donnes de la phase 6 du projet de comparaison de modles coupls du Climate Hazards Center (CHC-CMIP6) [Williams et al. (2024)](https://www.nature.com/articles/s41597-024-03074-w). L'ensemble de donnes CHC-CMIP6 fournit des estimations futures pour 2030 et 2050, dont les champs delta sont bass sur les prvisions d'ensemble multimodles CMIP6 pour les scnarios SSP 245 et SSP 585. Comme entres pour calculer les valeurs WBGT, nous prenons  partir de l'ensemble de donnes trois variables principales : les tempratures quotidiennes maximales et minimales (Tmax et Tmin), ainsi que l'humidit relative quotidienne maximale (RHx) qui se produit au moment de Tmax, pour les deux, la priode dobservation (vers 2005, moyenne sur 10 ans) et les projections futures dans le cadre des PAS 2,45 et 5,85 (annes 2030 et 2050, moyenne sur 10 ans).`</span></span>
<span id="cb40-1715"><a href="#cb40-1715" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1716"><a href="#cb40-1716" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1717"><a href="#cb40-1717" aria-hidden="true" tabindex="-1"></a>        <span class="dt">hourlyExposure</span><span class="op">:</span> {</span>
<span id="cb40-1718"><a href="#cb40-1718" aria-hidden="true" tabindex="-1"></a>          <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1719"><a href="#cb40-1719" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Hourly exposure"</span><span class="op">,</span></span>
<span id="cb40-1720"><a href="#cb40-1720" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Exposition horaire"</span></span>
<span id="cb40-1721"><a href="#cb40-1721" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1722"><a href="#cb40-1722" aria-hidden="true" tabindex="-1"></a>          <span class="dt">body</span><span class="op">:</span> {</span>
<span id="cb40-1723"><a href="#cb40-1723" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`We examine agricultural workers' hourly exposure to heat stress during the harvesting and planting seasons, crucial periods in the agricultural calendar, where agricultural labourers are exposed to prolonged labour-intense outdoor activity, making them more susceptible to the impacts of heat stress. We use the crop calendars from [GGCMI Phase 3](https://zenodo.org/records/5062513), which provide the planting and harvesting dates for eighteen distinct crops and show exposure histograms during these periods. The histograms quantify the percentage of days within the harvesting or planting periods that surpass WBGT safety standards for each hour of the day. Here we compute and rely on hourly WBGT exceedances in present and future, for different SSPs and years. The calculations for the hourly temperature rely on Linvills (1990) method for predicting hourly temperatures from daily minimum and maximum measurements. To compute such temperature profiles, we rely on daylength values, mainly taken from [Spencer (1971)](https://www.mail-archive.com/sundial@uni-koeln.de/msg01050.html). This approach was used to create hourly temperature profiles; then, hourly heat index values relying on relative humidity values and following the [NOAA guidelines](https://www.wpc.ncep.noaa.gov/html/heatindex_equation.shtml); and, finally, hourly WBGT, which was evaluated at three different thresholds  28, 30 and 32 degrees Celsius.`</span><span class="op">,</span></span>
<span id="cb40-1724"><a href="#cb40-1724" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Nous examinons l'exposition horaire des travailleurs agricoles au stress thermique pendant les saisons de rcolte et de plantation, priodes cruciales du calendrier agricole, o les travailleurs agricoles sont exposs  une activit extrieure prolonge et intense, les rendant plus sensibles aux impacts du stress thermique. Nous utilisons les calendriers de cultures de la [phase 3 du GGCMI](https://zenodo.org/records/5062513), qui fournissent les dates de plantation et de rcolte de dix-huit cultures distinctes et affichent des histogrammes d'exposition pendant ces priodes. Les histogrammes quantifient le pourcentage de jours au cours des priodes de rcolte ou de plantation qui dpassent les normes de scurit du WBGT pour chaque heure de la journe. Ici, nous calculons et nous appuyons sur les dpassements horaires du WBGT dans le prsent et le futur, pour diffrents SSP et annes. Les calculs de temprature horaire sappuient sur la mthode de Linvill (1990) pour prdire les tempratures horaires  partir de mesures quotidiennes minimales et maximales. Pour calculer de tels profils de temprature, nous nous appuyons sur les valeurs de longueur du jour, principalement tires de [Spencer (1971)](https://www.mail-archive.com/sundial@uni-koeln.de/msg01050.html). Cette approche a t utilise pour crer des profils de temprature horaires ; puis, les valeurs horaires de l'indice de chaleur bases sur les valeurs d'humidit relative et suivant les [directives de la NOAA](https://www.wpc.ncep.noaa.gov/html/heatindex_equation.shtml); et enfin le WBGT horaire, qui a t valu  trois seuils diffrents  28, 30 et 32 degrs Celsius.`</span></span>
<span id="cb40-1725"><a href="#cb40-1725" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1726"><a href="#cb40-1726" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1727"><a href="#cb40-1727" aria-hidden="true" tabindex="-1"></a>        <span class="dt">additionalMethods</span><span class="op">:</span> {</span>
<span id="cb40-1728"><a href="#cb40-1728" aria-hidden="true" tabindex="-1"></a>          <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1729"><a href="#cb40-1729" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Additional methods"</span><span class="op">,</span></span>
<span id="cb40-1730"><a href="#cb40-1730" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Mthodologie supplmentaire"</span></span>
<span id="cb40-1731"><a href="#cb40-1731" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1732"><a href="#cb40-1732" aria-hidden="true" tabindex="-1"></a>          <span class="dt">body</span><span class="op">:</span> {</span>
<span id="cb40-1733"><a href="#cb40-1733" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`Full methodological details are contained in two forthcoming background papers:</span></span>
<span id="cb40-1734"><a href="#cb40-1734" aria-hidden="true" tabindex="-1"></a><span class="vs">- Ormaza-Zulueta, N and Mehrabi, Z. *Mapping global agricultural workforce*</span></span>
<span id="cb40-1735"><a href="#cb40-1735" aria-hidden="true" tabindex="-1"></a><span class="vs">- Ormaza-Zulueta, N and Mehrabi, Z. *Reductions in the agricultural workday in future due to climate change*`</span><span class="op">,</span></span>
<span id="cb40-1736"><a href="#cb40-1736" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Les dtails mthodologiques complets sont contenus dans deux documents de rfrence  venir:</span></span>
<span id="cb40-1737"><a href="#cb40-1737" aria-hidden="true" tabindex="-1"></a><span class="vs">- Ormaza-Zulueta, N et Mehrabi, Z. *Cartographie de la main-d'uvre agricole mondiale*</span></span>
<span id="cb40-1738"><a href="#cb40-1738" aria-hidden="true" tabindex="-1"></a><span class="vs">- Ormaza-Zulueta, N et Mehrabi, Z. *Rductions de la journe de travail agricole  l'avenir en raison du changement climatique*`</span></span>
<span id="cb40-1739"><a href="#cb40-1739" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1740"><a href="#cb40-1740" aria-hidden="true" tabindex="-1"></a>          <span class="dt">linkNote</span><span class="op">:</span> {</span>
<span id="cb40-1741"><a href="#cb40-1741" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Links will be updated when published."</span><span class="op">,</span></span>
<span id="cb40-1742"><a href="#cb40-1742" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Les liens seront mis  jour une fois publis."</span></span>
<span id="cb40-1743"><a href="#cb40-1743" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1744"><a href="#cb40-1744" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb40-1745"><a href="#cb40-1745" aria-hidden="true" tabindex="-1"></a>        <span class="dt">citation</span><span class="op">:</span> {</span>
<span id="cb40-1746"><a href="#cb40-1746" aria-hidden="true" tabindex="-1"></a>          <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb40-1747"><a href="#cb40-1747" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Citation"</span><span class="op">,</span></span>
<span id="cb40-1748"><a href="#cb40-1748" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Citation"</span></span>
<span id="cb40-1749"><a href="#cb40-1749" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb40-1750"><a href="#cb40-1750" aria-hidden="true" tabindex="-1"></a>          <span class="dt">body</span><span class="op">:</span> {</span>
<span id="cb40-1751"><a href="#cb40-1751" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"If the above links to background papers are not live, please use the following citation for this analysis: Ormaza-Zulueta, N and Mehrabi, Z. 2024. Widespread Workforce Disruptions. Africa Agriculture Adaptation Atlas. CGIAR."</span><span class="op">,</span></span>
<span id="cb40-1752"><a href="#cb40-1752" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Si les liens ci-dessus vers les documents de rfrence ne sont pas actifs, veuillez utiliser la citation suivante pour cette analyse: Ormaza-Zulueta, N et Mehrabi, Z. 2024. Disruptions gnralises de la main-d'uvre. Atlas de ladaptation de lagriculture en Afrique. GCRAI."</span></span>
<span id="cb40-1753"><a href="#cb40-1753" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb40-1754"><a href="#cb40-1754" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb40-1755"><a href="#cb40-1755" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb40-1756"><a href="#cb40-1756" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-1757"><a href="#cb40-1757" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb40-1758"><a href="#cb40-1758" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-40" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="1762" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1761"><span id="cb41-1762"><a href="#cb41-1762" aria-hidden="true" tabindex="-1"></a><span class="co">// data translation values</span></span>
<span id="cb41-1763"><a href="#cb41-1763" aria-hidden="true" tabindex="-1"></a>td <span class="op">=</span> {</span>
<span id="cb41-1764"><a href="#cb41-1764" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"abAtlas-td-translation-data-v1.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb41-1765"><a href="#cb41-1765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1766"><a href="#cb41-1766" aria-hidden="true" tabindex="-1"></a>  <span class="co">// update SSA default</span></span>
<span id="cb41-1767"><a href="#cb41-1767" aria-hidden="true" tabindex="-1"></a>  data<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">SSA</span><span class="op">.</span><span class="at">en</span> <span class="op">=</span> <span class="st">"Sub-Saharan Africa"</span></span>
<span id="cb41-1768"><a href="#cb41-1768" aria-hidden="true" tabindex="-1"></a>  <span class="co">// cote d'ivoire, comma version duplicate</span></span>
<span id="cb41-1769"><a href="#cb41-1769" aria-hidden="true" tabindex="-1"></a>  data<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span>[<span class="st">"Cte dIvoire"</span>] <span class="op">=</span> data<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span>[<span class="st">"Cte d'Ivoire"</span>]</span>
<span id="cb41-1770"><a href="#cb41-1770" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb41-1771"><a href="#cb41-1771" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data</span>
<span id="cb41-1772"><a href="#cb41-1772" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-41" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1776" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1775"><span id="cb42-1776"><a href="#cb42-1776" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb42-1777"><a href="#cb42-1777" aria-hidden="true" tabindex="-1"></a><span class="vs">### Notebook Variables</span></span>
<span id="cb42-1778"><a href="#cb42-1778" aria-hidden="true" tabindex="-1"></a><span class="vs">_Main variables across notebook_`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-42" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1782" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1781"><span id="cb43-1782"><a href="#cb43-1782" aria-hidden="true" tabindex="-1"></a><span class="co">// main title of the notebook</span></span>
<span id="cb43-1783"><a href="#cb43-1783" aria-hidden="true" tabindex="-1"></a>notebookTitle <span class="op">=</span> <span class="fu">_lang</span>({</span>
<span id="cb43-1784"><a href="#cb43-1784" aria-hidden="true" tabindex="-1"></a>  <span class="dt">en</span><span class="op">:</span> <span class="st">"Understand Heat Stress on Producers"</span><span class="op">,</span></span>
<span id="cb43-1785"><a href="#cb43-1785" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Comprendre le stress thermique sur les producteurs"</span><span class="op">,</span></span>
<span id="cb43-1786"><a href="#cb43-1786" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-43" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1790" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1789"><span id="cb44-1790"><a href="#cb44-1790" aria-hidden="true" tabindex="-1"></a><span class="co">// info for the admin selectors</span></span>
<span id="cb44-1791"><a href="#cb44-1791" aria-hidden="true" tabindex="-1"></a>adminRegions <span class="op">=</span> {</span>
<span id="cb44-1792"><a href="#cb44-1792" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb44-1793"><a href="#cb44-1793" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labels</span><span class="op">:</span> {</span>
<span id="cb44-1794"><a href="#cb44-1794" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin0</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">adminSelections</span><span class="op">.</span><span class="at">country</span>)<span class="op">,</span></span>
<span id="cb44-1795"><a href="#cb44-1795" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin1</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">adminSelections</span><span class="op">.</span><span class="at">region</span>)<span class="op">,</span></span>
<span id="cb44-1796"><a href="#cb44-1796" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin2</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">adminSelections</span><span class="op">.</span><span class="at">subregion</span>)</span>
<span id="cb44-1797"><a href="#cb44-1797" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb44-1798"><a href="#cb44-1798" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb44-1799"><a href="#cb44-1799" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-44" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1803" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1802"><span id="cb45-1803"><a href="#cb45-1803" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getLowerLevelAdminLabel</span>(selections <span class="op">=</span> adminSelections) {</span>
<span id="cb45-1804"><a href="#cb45-1804" aria-hidden="true" tabindex="-1"></a>  <span class="co">// based on admin selection, get the lower level label</span></span>
<span id="cb45-1805"><a href="#cb45-1805" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">;</span></span>
<span id="cb45-1806"><a href="#cb45-1806" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">;</span></span>
<span id="cb45-1807"><a href="#cb45-1807" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin1</span><span class="op">;</span></span>
<span id="cb45-1808"><a href="#cb45-1808" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">;</span></span>
<span id="cb45-1809"><a href="#cb45-1809" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-45" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb46" data-startfrom="1813" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1812"><span id="cb46-1813"><a href="#cb46-1813" aria-hidden="true" tabindex="-1"></a>monetaryVoPNote <span class="op">=</span> <span class="vs">`Monetary VoP values are represented in 2005 international dollars.`</span><span class="op">;</span> <span class="co">// note about VoP source</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-46" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb47" data-startfrom="1817" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1816"><span id="cb47-1817"><a href="#cb47-1817" aria-hidden="true" tabindex="-1"></a><span class="co">// width of the maps</span></span>
<span id="cb47-1818"><a href="#cb47-1818" aria-hidden="true" tabindex="-1"></a>mapWidth <span class="op">=</span> <span class="dv">625</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-47" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb48" data-startfrom="1822" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1821"><span id="cb48-1822"><a href="#cb48-1822" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb48-1823"><a href="#cb48-1823" aria-hidden="true" tabindex="-1"></a><span class="vs">### Notebook Styling</span></span>
<span id="cb48-1824"><a href="#cb48-1824" aria-hidden="true" tabindex="-1"></a><span class="vs">*styling helpers*</span></span>
<span id="cb48-1825"><a href="#cb48-1825" aria-hidden="true" tabindex="-1"></a><span class="vs">Stylesheet is a named cell, which is necessary to include for embeds.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-48" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb49" data-startfrom="1829" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1828"><span id="cb49-1829"><a href="#cb49-1829" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`**CSS styling**`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-49" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb50" data-startfrom="1833" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1832"><span id="cb50-1833"><a href="#cb50-1833" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`**Color Scales**`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-50" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb51" data-startfrom="1837" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1836"><span id="cb51-1837"><a href="#cb51-1837" aria-hidden="true" tabindex="-1"></a><span class="co">// color scale info</span></span>
<span id="cb51-1838"><a href="#cb51-1838" aria-hidden="true" tabindex="-1"></a>colorScales <span class="op">=</span> {</span>
<span id="cb51-1839"><a href="#cb51-1839" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb51-1840"><a href="#cb51-1840" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> {</span>
<span id="cb51-1841"><a href="#cb51-1841" aria-hidden="true" tabindex="-1"></a>      <span class="dt">green</span><span class="op">:</span> [<span class="st">'#E4F5D0'</span><span class="op">,</span> <span class="st">'#015023'</span>]<span class="op">,</span></span>
<span id="cb51-1842"><a href="#cb51-1842" aria-hidden="true" tabindex="-1"></a>      <span class="dt">blue</span><span class="op">:</span> [<span class="st">'#E8F2FF'</span><span class="op">,</span> <span class="st">'#003E6B'</span>]<span class="op">,</span></span>
<span id="cb51-1843"><a href="#cb51-1843" aria-hidden="true" tabindex="-1"></a>      <span class="dt">brown</span><span class="op">:</span> [<span class="st">'#FFFDE5'</span><span class="op">,</span> <span class="st">'#A87B00'</span>]<span class="op">,</span></span>
<span id="cb51-1844"><a href="#cb51-1844" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yellowGreen</span><span class="op">:</span> [<span class="st">'#F7D732'</span><span class="op">,</span> <span class="st">'#216729'</span>]<span class="op">,</span></span>
<span id="cb51-1845"><a href="#cb51-1845" aria-hidden="true" tabindex="-1"></a>      <span class="dt">orangeRed</span><span class="op">:</span> [<span class="st">'#F4BB21'</span><span class="op">,</span> <span class="st">'#EC5A47'</span>]<span class="op">,</span></span>
<span id="cb51-1846"><a href="#cb51-1846" aria-hidden="true" tabindex="-1"></a>      <span class="dt">blueWhiteRed</span><span class="op">:</span> [<span class="st">'#003E6B'</span><span class="op">,</span> <span class="st">'#FFFFFF'</span><span class="op">,</span> <span class="st">'#EC5A47'</span>]<span class="op">,</span></span>
<span id="cb51-1847"><a href="#cb51-1847" aria-hidden="true" tabindex="-1"></a>      <span class="dt">redYellowGreen</span><span class="op">:</span> [<span class="st">"#EC5A47"</span><span class="op">,</span> <span class="st">"#F4BB21"</span><span class="op">,</span> <span class="st">'#216729'</span>]</span>
<span id="cb51-1848"><a href="#cb51-1848" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb51-1849"><a href="#cb51-1849" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unknown</span><span class="op">:</span> <span class="st">"#ccc"</span></span>
<span id="cb51-1850"><a href="#cb51-1850" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb51-1851"><a href="#cb51-1851" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-51" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb52" data-startfrom="1855" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1854"><span id="cb52-1855"><a href="#cb52-1855" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb52-1856"><a href="#cb52-1856" aria-hidden="true" tabindex="-1"></a>  buildInlineDownloadButton<span class="op">,</span></span>
<span id="cb52-1857"><a href="#cb52-1857" aria-hidden="true" tabindex="-1"></a>  downloadButtonCSS<span class="op">,</span></span>
<span id="cb52-1858"><a href="#cb52-1858" aria-hidden="true" tabindex="-1"></a>  download_translation<span class="op">,</span></span>
<span id="cb52-1859"><a href="#cb52-1859" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">"1bda5f9b60c64223"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-52" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb53" data-startfrom="1863" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1862"><span id="cb53-1863"><a href="#cb53-1863" aria-hidden="true" tabindex="-1"></a>downloadButtonCSS<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-53" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb54" data-startfrom="1867" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1866"><span id="cb54-1867"><a href="#cb54-1867" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb54-1868"><a href="#cb54-1868" aria-hidden="true" tabindex="-1"></a><span class="vs">### Admin Selection</span></span>
<span id="cb54-1869"><a href="#cb54-1869" aria-hidden="true" tabindex="-1"></a><span class="vs">*Global admin selector using dropdowns*</span></span>
<span id="cb54-1870"><a href="#cb54-1870" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-1871"><a href="#cb54-1871" aria-hidden="true" tabindex="-1"></a><span class="vs">This is the global selector for the selected region</span></span>
<span id="cb54-1872"><a href="#cb54-1872" aria-hidden="true" tabindex="-1"></a><span class="vs">- The completed data is contained within adminSelections to be used in queries</span></span>
<span id="cb54-1873"><a href="#cb54-1873" aria-hidden="true" tabindex="-1"></a><span class="vs">- Dropdowns are defined below then bound for each section</span></span>
<span id="cb54-1874"><a href="#cb54-1874" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Defined as separate cells since they dynamically respond to different values</span></span>
<span id="cb54-1875"><a href="#cb54-1875" aria-hidden="true" tabindex="-1"></a><span class="vs">    - In narrative, they are simply views of the data  </span></span>
<span id="cb54-1876"><a href="#cb54-1876" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Dropdowns are dynamic based on higher-level choices</span></span>
<span id="cb54-1877"><a href="#cb54-1877" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Options are defined from the geographic data</span></span>
<span id="cb54-1878"><a href="#cb54-1878" aria-hidden="true" tabindex="-1"></a><span class="vs">  - null value means unselected region</span></span>
<span id="cb54-1879"><a href="#cb54-1879" aria-hidden="true" tabindex="-1"></a><span class="vs">- Dropdowns are added to each section, using Inputs.bind to create synchronized inputs (see viewof for input definitions). A form input is used to consolidate and apply a template to format.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-54" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb55" data-startfrom="1883" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1882"><span id="cb55-1883"><a href="#cb55-1883" aria-hidden="true" tabindex="-1"></a><span class="co">// get admin0 options from geo</span></span>
<span id="cb55-1884"><a href="#cb55-1884" aria-hidden="true" tabindex="-1"></a>dataAdmin0 <span class="op">=</span> {</span>
<span id="cb55-1885"><a href="#cb55-1885" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> boundaries<span class="op">.</span><span class="at">admin0</span><span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>)<span class="op">;</span></span>
<span id="cb55-1886"><a href="#cb55-1886" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add a blank value</span></span>
<span id="cb55-1887"><a href="#cb55-1887" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="kw">null</span><span class="op">,</span> <span class="op">...</span>data<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin_name</span>)]<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb55-1888"><a href="#cb55-1888" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb55-1889"><a href="#cb55-1889" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span></span>
<span id="cb55-1890"><a href="#cb55-1890" aria-hidden="true" tabindex="-1"></a>        d <span class="op">==</span> <span class="kw">null</span></span>
<span id="cb55-1891"><a href="#cb55-1891" aria-hidden="true" tabindex="-1"></a>          <span class="op">?</span> globalSelection<span class="op">.</span><span class="at">label</span></span>
<span id="cb55-1892"><a href="#cb55-1892" aria-hidden="true" tabindex="-1"></a>          <span class="op">:</span> <span class="fu">_lang</span>(td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[d]<span class="op">.</span><span class="at">general</span>)<span class="op">,</span></span>
<span id="cb55-1893"><a href="#cb55-1893" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> d<span class="op">,</span></span>
<span id="cb55-1894"><a href="#cb55-1894" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> d <span class="op">==</span> <span class="kw">null</span> <span class="op">?</span> globalSelection<span class="op">.</span><span class="at">data</span> <span class="op">:</span> td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[d]<span class="op">,</span></span>
<span id="cb55-1895"><a href="#cb55-1895" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb55-1896"><a href="#cb55-1896" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb55-1897"><a href="#cb55-1897" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-55" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb56" data-startfrom="1901" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1900"><span id="cb56-1901"><a href="#cb56-1901" aria-hidden="true" tabindex="-1"></a><span class="co">// get admin1 options based on admin0 selection</span></span>
<span id="cb56-1902"><a href="#cb56-1902" aria-hidden="true" tabindex="-1"></a><span class="co">// (the admin1 regions within selected admin0)</span></span>
<span id="cb56-1903"><a href="#cb56-1903" aria-hidden="true" tabindex="-1"></a>dataAdmin1 <span class="op">=</span> {</span>
<span id="cb56-1904"><a href="#cb56-1904" aria-hidden="true" tabindex="-1"></a>  <span class="co">// admin 1, filter by 0 </span></span>
<span id="cb56-1905"><a href="#cb56-1905" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> boundaries<span class="op">.</span><span class="at">admin1</span><span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>)</span>
<span id="cb56-1906"><a href="#cb56-1906" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> selectAdmin0<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb56-1907"><a href="#cb56-1907" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add blank value</span></span>
<span id="cb56-1908"><a href="#cb56-1908" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="kw">null</span><span class="op">,</span> <span class="op">...</span>data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin1_name</span>)]<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb56-1909"><a href="#cb56-1909" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="dt">label</span><span class="op">:</span> d<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d}</span>
<span id="cb56-1910"><a href="#cb56-1910" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb56-1911"><a href="#cb56-1911" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-56" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb57" data-startfrom="1915" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1914"><span id="cb57-1915"><a href="#cb57-1915" aria-hidden="true" tabindex="-1"></a><span class="co">// get admin2 options based on admin1 selection</span></span>
<span id="cb57-1916"><a href="#cb57-1916" aria-hidden="true" tabindex="-1"></a><span class="co">// (the admin2 regions within selected admin1)</span></span>
<span id="cb57-1917"><a href="#cb57-1917" aria-hidden="true" tabindex="-1"></a>dataAdmin2 <span class="op">=</span> {</span>
<span id="cb57-1918"><a href="#cb57-1918" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> boundaries<span class="op">.</span><span class="at">admin2</span><span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>)</span>
<span id="cb57-1919"><a href="#cb57-1919" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> selectAdmin0<span class="op">.</span><span class="at">value</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">admin1_name</span> <span class="op">==</span> selectAdmin1<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb57-1920"><a href="#cb57-1920" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add blank value</span></span>
<span id="cb57-1921"><a href="#cb57-1921" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="kw">null</span><span class="op">,</span> <span class="op">...</span>data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin2_name</span>)]<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb57-1922"><a href="#cb57-1922" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="dt">label</span><span class="op">:</span> d<span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d}</span>
<span id="cb57-1923"><a href="#cb57-1923" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb57-1924"><a href="#cb57-1924" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-57" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb58" data-startfrom="1928" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1927"><span id="cb58-1928"><a href="#cb58-1928" aria-hidden="true" tabindex="-1"></a>viewof selectAdmin0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin0<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-58" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb59" data-startfrom="1932" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1931"><span id="cb59-1932"><a href="#cb59-1932" aria-hidden="true" tabindex="-1"></a>viewof selectAdmin1 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin1<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-59" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb60" data-startfrom="1936" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1935"><span id="cb60-1936"><a href="#cb60-1936" aria-hidden="true" tabindex="-1"></a>viewof selectAdmin2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin2<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-60" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb61" data-startfrom="1940" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1939"><span id="cb61-1940"><a href="#cb61-1940" aria-hidden="true" tabindex="-1"></a><span class="co">// selected admin regions from dropdowns</span></span>
<span id="cb61-1941"><a href="#cb61-1941" aria-hidden="true" tabindex="-1"></a>adminSelections <span class="op">=</span> <span class="kw">new</span> <span class="bu">Object</span>({</span>
<span id="cb61-1942"><a href="#cb61-1942" aria-hidden="true" tabindex="-1"></a>  <span class="dt">selectAdmin0</span><span class="op">:</span> selectAdmin0<span class="op">,</span></span>
<span id="cb61-1943"><a href="#cb61-1943" aria-hidden="true" tabindex="-1"></a>  <span class="dt">selectAdmin1</span><span class="op">:</span> selectAdmin1<span class="op">,</span></span>
<span id="cb61-1944"><a href="#cb61-1944" aria-hidden="true" tabindex="-1"></a>  <span class="dt">selectAdmin2</span><span class="op">:</span> selectAdmin2<span class="op">,</span></span>
<span id="cb61-1945"><a href="#cb61-1945" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-61" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb62" data-startfrom="1949" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1948"><span id="cb62-1949"><a href="#cb62-1949" aria-hidden="true" tabindex="-1"></a><span class="co">// template to format admin selection form</span></span>
<span id="cb62-1950"><a href="#cb62-1950" aria-hidden="true" tabindex="-1"></a>adminFormTemplate <span class="op">=</span> (inputs) <span class="kw">=&gt;</span></span>
<span id="cb62-1951"><a href="#cb62-1951" aria-hidden="true" tabindex="-1"></a>  htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div style="display: flex; gap: 3em"&gt;</span><span class="sc">${</span>inputs<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-62" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb63" data-startfrom="1955" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1954"><span id="cb63-1955"><a href="#cb63-1955" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb63-1956"><a href="#cb63-1956" aria-hidden="true" tabindex="-1"></a><span class="vs">### Admin Selection - Display</span></span>
<span id="cb63-1957"><a href="#cb63-1957" aria-hidden="true" tabindex="-1"></a><span class="vs">*Showing admin selections*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-63" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb64" data-startfrom="1961" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1960"><span id="cb64-1961"><a href="#cb64-1961" aria-hidden="true" tabindex="-1"></a><span class="co">// options for the global admin selection</span></span>
<span id="cb64-1962"><a href="#cb64-1962" aria-hidden="true" tabindex="-1"></a><span class="co">// used when no admin selection is made</span></span>
<span id="cb64-1963"><a href="#cb64-1963" aria-hidden="true" tabindex="-1"></a>globalSelection <span class="op">=</span> {</span>
<span id="cb64-1964"><a href="#cb64-1964" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb64-1965"><a href="#cb64-1965" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">SSA</span><span class="op">.</span><span class="at">general</span>)<span class="op">,</span></span>
<span id="cb64-1966"><a href="#cb64-1966" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb64-1967"><a href="#cb64-1967" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">SSA</span></span>
<span id="cb64-1968"><a href="#cb64-1968" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb64-1969"><a href="#cb64-1969" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-64" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb65" data-startfrom="1973" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1972"><span id="cb65-1973"><a href="#cb65-1973" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getAdminSelection</span>(selections <span class="op">=</span> adminSelections) {</span>
<span id="cb65-1974"><a href="#cb65-1974" aria-hidden="true" tabindex="-1"></a>  <span class="co">// get the most granular admin selection made</span></span>
<span id="cb65-1975"><a href="#cb65-1975" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a0 <span class="op">=</span> selections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">;</span></span>
<span id="cb65-1976"><a href="#cb65-1976" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a1 <span class="op">=</span> selections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">;</span></span>
<span id="cb65-1977"><a href="#cb65-1977" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a2 <span class="op">=</span> selections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">;</span></span>
<span id="cb65-1978"><a href="#cb65-1978" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> <span class="bu">global</span> <span class="op">=</span> globalSelection<span class="op">;</span></span>
<span id="cb65-1979"><a href="#cb65-1979" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-1980"><a href="#cb65-1980" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a2<span class="op">.</span><span class="at">value</span> <span class="op">?</span> a2 <span class="op">:</span> a1<span class="op">.</span><span class="at">value</span> <span class="op">?</span> a1 <span class="op">:</span> a0<span class="op">.</span><span class="at">value</span> <span class="op">?</span> a0 <span class="op">:</span> <span class="bu">global</span><span class="op">;</span></span>
<span id="cb65-1981"><a href="#cb65-1981" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-65" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb66" data-startfrom="1985" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1984"><span id="cb66-1985"><a href="#cb66-1985" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getAdminSelection0</span>(selections <span class="op">=</span> adminSelections) {</span>
<span id="cb66-1986"><a href="#cb66-1986" aria-hidden="true" tabindex="-1"></a>  <span class="co">// get the most granular admin selection made</span></span>
<span id="cb66-1987"><a href="#cb66-1987" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a0 <span class="op">=</span> selections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">;</span></span>
<span id="cb66-1988"><a href="#cb66-1988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-1989"><a href="#cb66-1989" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a0<span class="op">;</span></span>
<span id="cb66-1990"><a href="#cb66-1990" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-66" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb67" data-startfrom="1994" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1993"><span id="cb67-1994"><a href="#cb67-1994" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getAdminSelectionAdmin0</span>(selections <span class="op">=</span> adminSelections) {</span>
<span id="cb67-1995"><a href="#cb67-1995" aria-hidden="true" tabindex="-1"></a>  <span class="co">// get the selected admin0 or global value</span></span>
<span id="cb67-1996"><a href="#cb67-1996" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a0 <span class="op">=</span> selections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">;</span></span>
<span id="cb67-1997"><a href="#cb67-1997" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> <span class="bu">global</span> <span class="op">=</span> globalSelection<span class="op">;</span></span>
<span id="cb67-1998"><a href="#cb67-1998" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-1999"><a href="#cb67-1999" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a0<span class="op">.</span><span class="at">value</span> <span class="op">?</span> a0 <span class="op">:</span> <span class="bu">global</span><span class="op">;</span></span>
<span id="cb67-2000"><a href="#cb67-2000" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-67" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb68" data-startfrom="2004" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2003"><span id="cb68-2004"><a href="#cb68-2004" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getAdminSelectionMarkdownPath</span>(selections <span class="op">=</span> adminSelections) {</span>
<span id="cb68-2005"><a href="#cb68-2005" aria-hidden="true" tabindex="-1"></a>  <span class="co">// function to show selected admin region</span></span>
<span id="cb68-2006"><a href="#cb68-2006" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return path showing nested admin selection</span></span>
<span id="cb68-2007"><a href="#cb68-2007" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2008"><a href="#cb68-2008" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> delim <span class="op">=</span> <span class="st">"  "</span><span class="op">;</span></span>
<span id="cb68-2009"><a href="#cb68-2009" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> [</span>
<span id="cb68-2010"><a href="#cb68-2010" aria-hidden="true" tabindex="-1"></a>    selections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb68-2011"><a href="#cb68-2011" aria-hidden="true" tabindex="-1"></a>    selections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb68-2012"><a href="#cb68-2012" aria-hidden="true" tabindex="-1"></a>    selections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb68-2013"><a href="#cb68-2013" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb68-2014"><a href="#cb68-2014" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2015"><a href="#cb68-2015" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> path</span>
<span id="cb68-2016"><a href="#cb68-2016" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d)</span>
<span id="cb68-2017"><a href="#cb68-2017" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb68-2018"><a href="#cb68-2018" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> i <span class="op">==</span> path<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span> <span class="op">?</span> <span class="vs">`**</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs">**`</span> <span class="op">:</span> <span class="vs">`*</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs">*`</span><span class="op">;</span></span>
<span id="cb68-2019"><a href="#cb68-2019" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb68-2020"><a href="#cb68-2020" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-2021"><a href="#cb68-2021" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> formatted<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb68-2022"><a href="#cb68-2022" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="vs">`**</span><span class="sc">${</span>globalSelection<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">**`</span> <span class="co">// no selection, all of Africa</span></span>
<span id="cb68-2023"><a href="#cb68-2023" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>formatted<span class="op">.</span><span class="fu">join</span>(delim)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb68-2024"><a href="#cb68-2024" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-68" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb69" data-startfrom="2028" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2027"><span id="cb69-2028"><a href="#cb69-2028" aria-hidden="true" tabindex="-1"></a>getAdmin0WithAdminSubParens <span class="op">=</span> ({</span>
<span id="cb69-2029"><a href="#cb69-2029" aria-hidden="true" tabindex="-1"></a>  articleField <span class="op">=</span> <span class="st">"general"</span><span class="op">,</span></span>
<span id="cb69-2030"><a href="#cb69-2030" aria-hidden="true" tabindex="-1"></a>  showParens <span class="op">=</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb69-2031"><a href="#cb69-2031" aria-hidden="true" tabindex="-1"></a>} <span class="op">=</span> {}) <span class="kw">=&gt;</span> {</span>
<span id="cb69-2032"><a href="#cb69-2032" aria-hidden="true" tabindex="-1"></a>  <span class="co">// getting admin0, with admin1 in parens</span></span>
<span id="cb69-2033"><a href="#cb69-2033" aria-hidden="true" tabindex="-1"></a>  <span class="co">// can specify admin0article lookup</span></span>
<span id="cb69-2034"><a href="#cb69-2034" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a0 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">;</span></span>
<span id="cb69-2035"><a href="#cb69-2035" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a1 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">;</span></span>
<span id="cb69-2036"><a href="#cb69-2036" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a2 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">;</span></span>
<span id="cb69-2037"><a href="#cb69-2037" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2038"><a href="#cb69-2038" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a0WithArticle <span class="op">=</span></span>
<span id="cb69-2039"><a href="#cb69-2039" aria-hidden="true" tabindex="-1"></a>    a0<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="kw">null</span></span>
<span id="cb69-2040"><a href="#cb69-2040" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="fu">_lang</span>(td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[<span class="st">"SSA"</span>]<span class="op">?.</span>[articleField])</span>
<span id="cb69-2041"><a href="#cb69-2041" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="fu">_lang</span>(td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[a0<span class="op">.</span><span class="at">value</span>]<span class="op">?.</span>[articleField])<span class="op">;</span></span>
<span id="cb69-2042"><a href="#cb69-2042" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (a1<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="kw">null</span>) <span class="cf">return</span> a0WithArticle<span class="op">;</span></span>
<span id="cb69-2043"><a href="#cb69-2043" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>showParens) <span class="cf">return</span> a0WithArticle<span class="op">;</span></span>
<span id="cb69-2044"><a href="#cb69-2044" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> subLabel <span class="op">=</span> a2<span class="op">.</span><span class="at">value</span> <span class="op">==</span> <span class="kw">null</span> <span class="op">?</span> a1<span class="op">.</span><span class="at">label</span> <span class="op">:</span> a2<span class="op">.</span><span class="at">label</span><span class="op">;</span></span>
<span id="cb69-2045"><a href="#cb69-2045" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>a0WithArticle<span class="sc">}</span><span class="vs"> (</span><span class="sc">${</span>subLabel<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb69-2046"><a href="#cb69-2046" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-69" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb70" data-startfrom="2050" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2049"><span id="cb70-2050"><a href="#cb70-2050" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb70-2051"><a href="#cb70-2051" aria-hidden="true" tabindex="-1"></a><span class="vs">### Choropleth map - Geographic Impact</span></span>
<span id="cb70-2052"><a href="#cb70-2052" aria-hidden="true" tabindex="-1"></a><span class="vs">*Showing context for admin selection*</span></span>
<span id="cb70-2053"><a href="#cb70-2053" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-2054"><a href="#cb70-2054" aria-hidden="true" tabindex="-1"></a><span class="vs">There is some hoop-jumping to get the right data based on the Admin Selection. The tabular data is then bound to the applicable geojson, and visualized with Plot.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-70" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb71" data-startfrom="2058" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2057"><span id="cb71-2058"><a href="#cb71-2058" aria-hidden="true" tabindex="-1"></a><span class="co">// population data</span></span>
<span id="cb71-2059"><a href="#cb71-2059" aria-hidden="true" tabindex="-1"></a>dataPopulation <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb71-2060"><a href="#cb71-2060" aria-hidden="true" tabindex="-1"></a><span class="vs">select * </span></span>
<span id="cb71-2061"><a href="#cb71-2061" aria-hidden="true" tabindex="-1"></a><span class="vs">from ag_workforce_data</span></span>
<span id="cb71-2062"><a href="#cb71-2062" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-71" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb72" data-startfrom="2066" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2065"><span id="cb72-2066"><a href="#cb72-2066" aria-hidden="true" tabindex="-1"></a><span class="co">// total VoP data</span></span>
<span id="cb72-2067"><a href="#cb72-2067" aria-hidden="true" tabindex="-1"></a>dataTotalAgW <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb72-2068"><a href="#cb72-2068" aria-hidden="true" tabindex="-1"></a><span class="vs">select admin0_name</span></span>
<span id="cb72-2069"><a href="#cb72-2069" aria-hidden="true" tabindex="-1"></a><span class="vs">  , admin1_name</span></span>
<span id="cb72-2070"><a href="#cb72-2070" aria-hidden="true" tabindex="-1"></a><span class="vs">  , admin2_name</span></span>
<span id="cb72-2071"><a href="#cb72-2071" aria-hidden="true" tabindex="-1"></a><span class="vs">  , MEAN(percentage_change_SSP2_2050_ag) as agw_total</span></span>
<span id="cb72-2072"><a href="#cb72-2072" aria-hidden="true" tabindex="-1"></a><span class="vs">  from ag_workforce_data</span></span>
<span id="cb72-2073"><a href="#cb72-2073" aria-hidden="true" tabindex="-1"></a><span class="vs">  group by 1, 2, 3</span></span>
<span id="cb72-2074"><a href="#cb72-2074" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb72-2075"><a href="#cb72-2075" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-72" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb73" data-startfrom="2079" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2078"><span id="cb73-2079"><a href="#cb73-2079" aria-hidden="true" tabindex="-1"></a><span class="co">// total VoP data</span></span>
<span id="cb73-2080"><a href="#cb73-2080" aria-hidden="true" tabindex="-1"></a>dataTotalAgW_abs <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb73-2081"><a href="#cb73-2081" aria-hidden="true" tabindex="-1"></a><span class="vs">select admin0_name</span></span>
<span id="cb73-2082"><a href="#cb73-2082" aria-hidden="true" tabindex="-1"></a><span class="vs">  , admin1_name</span></span>
<span id="cb73-2083"><a href="#cb73-2083" aria-hidden="true" tabindex="-1"></a><span class="vs">  , admin2_name</span></span>
<span id="cb73-2084"><a href="#cb73-2084" aria-hidden="true" tabindex="-1"></a><span class="vs">  , SUM(corrected_index_ag_pop_SSP2_2050) as agw_total_abs</span></span>
<span id="cb73-2085"><a href="#cb73-2085" aria-hidden="true" tabindex="-1"></a><span class="vs">  from ag_workforce_data</span></span>
<span id="cb73-2086"><a href="#cb73-2086" aria-hidden="true" tabindex="-1"></a><span class="vs">  group by 1, 2, 3</span></span>
<span id="cb73-2087"><a href="#cb73-2087" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb73-2088"><a href="#cb73-2088" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-73" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb74" data-startfrom="2092" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2091"><span id="cb74-2092"><a href="#cb74-2092" aria-hidden="true" tabindex="-1"></a><span class="co">// total Ag_SSP2_2030 data</span></span>
<span id="cb74-2093"><a href="#cb74-2093" aria-hidden="true" tabindex="-1"></a>dataTotalAgWMid <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb74-2094"><a href="#cb74-2094" aria-hidden="true" tabindex="-1"></a><span class="vs">select admin0_name</span></span>
<span id="cb74-2095"><a href="#cb74-2095" aria-hidden="true" tabindex="-1"></a><span class="vs">  , admin1_name</span></span>
<span id="cb74-2096"><a href="#cb74-2096" aria-hidden="true" tabindex="-1"></a><span class="vs">  , admin2_name</span></span>
<span id="cb74-2097"><a href="#cb74-2097" aria-hidden="true" tabindex="-1"></a><span class="vs">  , MEAN(percentage_change_SSP2_2030_ag) as agw_total_mid</span></span>
<span id="cb74-2098"><a href="#cb74-2098" aria-hidden="true" tabindex="-1"></a><span class="vs">  from ag_workforce_data</span></span>
<span id="cb74-2099"><a href="#cb74-2099" aria-hidden="true" tabindex="-1"></a><span class="vs">  group by 1, 2, 3</span></span>
<span id="cb74-2100"><a href="#cb74-2100" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb74-2101"><a href="#cb74-2101" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-74" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb75" data-startfrom="2105" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2104"><span id="cb75-2105"><a href="#cb75-2105" aria-hidden="true" tabindex="-1"></a><span class="co">// total VoP data</span></span>
<span id="cb75-2106"><a href="#cb75-2106" aria-hidden="true" tabindex="-1"></a>dataTotalAgWMid_abs <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb75-2107"><a href="#cb75-2107" aria-hidden="true" tabindex="-1"></a><span class="vs">select admin0_name</span></span>
<span id="cb75-2108"><a href="#cb75-2108" aria-hidden="true" tabindex="-1"></a><span class="vs">  , admin1_name</span></span>
<span id="cb75-2109"><a href="#cb75-2109" aria-hidden="true" tabindex="-1"></a><span class="vs">  , admin2_name</span></span>
<span id="cb75-2110"><a href="#cb75-2110" aria-hidden="true" tabindex="-1"></a><span class="vs">  , SUM(corrected_index_ag_pop_SSP2_2030) as agw_total_mid_abs</span></span>
<span id="cb75-2111"><a href="#cb75-2111" aria-hidden="true" tabindex="-1"></a><span class="vs">  from ag_workforce_data</span></span>
<span id="cb75-2112"><a href="#cb75-2112" aria-hidden="true" tabindex="-1"></a><span class="vs">  group by 1, 2, 3</span></span>
<span id="cb75-2113"><a href="#cb75-2113" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb75-2114"><a href="#cb75-2114" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-75" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb76" data-startfrom="2118" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2117"><span id="cb76-2118"><a href="#cb76-2118" aria-hidden="true" tabindex="-1"></a><span class="co">// grab tabular data for choropleth</span></span>
<span id="cb76-2119"><a href="#cb76-2119" aria-hidden="true" tabindex="-1"></a>dataGeoImpact <span class="op">=</span> {</span>
<span id="cb76-2120"><a href="#cb76-2120" aria-hidden="true" tabindex="-1"></a>  <span class="co">// get data for choropleth map based on choice</span></span>
<span id="cb76-2121"><a href="#cb76-2121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dataSource<span class="op">;</span></span>
<span id="cb76-2122"><a href="#cb76-2122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-2123"><a href="#cb76-2123" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selectGeoDataType<span class="op">.</span><span class="at">key</span> <span class="op">==</span> <span class="st">"ag_workforce_data_2"</span>) {</span>
<span id="cb76-2124"><a href="#cb76-2124" aria-hidden="true" tabindex="-1"></a>    dataSource <span class="op">=</span> dataPopulation<span class="op">;</span></span>
<span id="cb76-2125"><a href="#cb76-2125" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (selectGeoDataType<span class="op">.</span><span class="at">key</span> <span class="op">==</span> <span class="st">"ag_workforce_data"</span>) {</span>
<span id="cb76-2126"><a href="#cb76-2126" aria-hidden="true" tabindex="-1"></a>    dataSource <span class="op">=</span> dataTotalAgW<span class="op">;</span></span>
<span id="cb76-2127"><a href="#cb76-2127" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>  <span class="cf">if</span> (selectGeoDataType<span class="op">.</span><span class="at">key</span> <span class="op">==</span> <span class="st">"ag_workforce_data_15"</span>) {</span>
<span id="cb76-2128"><a href="#cb76-2128" aria-hidden="true" tabindex="-1"></a>    dataSource <span class="op">=</span> dataTotalAgWMid_abs<span class="op">;</span></span>
<span id="cb76-2129"><a href="#cb76-2129" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>  <span class="cf">if</span> (selectGeoDataType<span class="op">.</span><span class="at">key</span> <span class="op">==</span> <span class="st">"ag_workforce_data_10"</span>) {</span>
<span id="cb76-2130"><a href="#cb76-2130" aria-hidden="true" tabindex="-1"></a>    dataSource <span class="op">=</span> dataTotalAgW_abs<span class="op">;</span></span>
<span id="cb76-2131"><a href="#cb76-2131" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb76-2132"><a href="#cb76-2132" aria-hidden="true" tabindex="-1"></a>    dataSource <span class="op">=</span> dataTotalAgWMid<span class="op">;</span></span>
<span id="cb76-2133"><a href="#cb76-2133" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-2134"><a href="#cb76-2134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-2135"><a href="#cb76-2135" aria-hidden="true" tabindex="-1"></a>  <span class="co">// select different data based on admin selections</span></span>
<span id="cb76-2136"><a href="#cb76-2136" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>) {</span>
<span id="cb76-2137"><a href="#cb76-2137" aria-hidden="true" tabindex="-1"></a>    <span class="co">// admin1 or 2 is selected, show all admin2's for selected admin1</span></span>
<span id="cb76-2138"><a href="#cb76-2138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb76-2139"><a href="#cb76-2139" aria-hidden="true" tabindex="-1"></a>      dataSource<span class="op">,</span></span>
<span id="cb76-2140"><a href="#cb76-2140" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb76-2141"><a href="#cb76-2141" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span> <span class="op">&amp;&amp;</span></span>
<span id="cb76-2142"><a href="#cb76-2142" aria-hidden="true" tabindex="-1"></a>          d<span class="op">.</span><span class="at">admin1_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb76-2143"><a href="#cb76-2143" aria-hidden="true" tabindex="-1"></a>          <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">admin2_name</span> <span class="co">// always non-null</span></span>
<span id="cb76-2144"><a href="#cb76-2144" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb76-2145"><a href="#cb76-2145" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb76-2146"><a href="#cb76-2146" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) {</span>
<span id="cb76-2147"><a href="#cb76-2147" aria-hidden="true" tabindex="-1"></a>    <span class="co">// admin0 is selected, with no admin1</span></span>
<span id="cb76-2148"><a href="#cb76-2148" aria-hidden="true" tabindex="-1"></a>    <span class="co">// get all admin1 data for selected admin0</span></span>
<span id="cb76-2149"><a href="#cb76-2149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb76-2150"><a href="#cb76-2150" aria-hidden="true" tabindex="-1"></a>      dataSource<span class="op">,</span></span>
<span id="cb76-2151"><a href="#cb76-2151" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb76-2152"><a href="#cb76-2152" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb76-2153"><a href="#cb76-2153" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">admin1_name</span> <span class="co">// always non-null </span></span>
<span id="cb76-2154"><a href="#cb76-2154" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;&amp;</span> <span class="op">!</span>d<span class="op">.</span><span class="at">admin2_name</span> <span class="co">// always null</span></span>
<span id="cb76-2155"><a href="#cb76-2155" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb76-2156"><a href="#cb76-2156" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb76-2157"><a href="#cb76-2157" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb76-2158"><a href="#cb76-2158" aria-hidden="true" tabindex="-1"></a>    <span class="co">// end case: admin0 is not selected</span></span>
<span id="cb76-2159"><a href="#cb76-2159" aria-hidden="true" tabindex="-1"></a>    <span class="co">// get all admin0 data</span></span>
<span id="cb76-2160"><a href="#cb76-2160" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb76-2161"><a href="#cb76-2161" aria-hidden="true" tabindex="-1"></a>      dataSource<span class="op">,</span></span>
<span id="cb76-2162"><a href="#cb76-2162" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb76-2163"><a href="#cb76-2163" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="op">!</span>d<span class="op">.</span><span class="at">admin1_name</span> <span class="co">// always null </span></span>
<span id="cb76-2164"><a href="#cb76-2164" aria-hidden="true" tabindex="-1"></a>        <span class="op">&amp;&amp;</span> <span class="op">!</span>d<span class="op">.</span><span class="at">admin2_name</span> <span class="co">// always null</span></span>
<span id="cb76-2165"><a href="#cb76-2165" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb76-2166"><a href="#cb76-2166" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb76-2167"><a href="#cb76-2167" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-2168"><a href="#cb76-2168" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-76" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb77" data-startfrom="2172" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2171"><span id="cb77-2172"><a href="#cb77-2172" aria-hidden="true" tabindex="-1"></a><span class="co">// bind geojson to tabular data</span></span>
<span id="cb77-2173"><a href="#cb77-2173" aria-hidden="true" tabindex="-1"></a>mapDataGeoImpact <span class="op">=</span> {</span>
<span id="cb77-2174"><a href="#cb77-2174" aria-hidden="true" tabindex="-1"></a>  <span class="co">// no selections</span></span>
<span id="cb77-2175"><a href="#cb77-2175" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) {</span>
<span id="cb77-2176"><a href="#cb77-2176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">bindTabularToGeo</span>({</span>
<span id="cb77-2177"><a href="#cb77-2177" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> dataGeoImpact<span class="op">,</span></span>
<span id="cb77-2178"><a href="#cb77-2178" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataBindColumn</span><span class="op">:</span> <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb77-2179"><a href="#cb77-2179" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoData</span><span class="op">:</span> boundaries<span class="op">.</span><span class="at">admin0</span><span class="op">,</span></span>
<span id="cb77-2180"><a href="#cb77-2180" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoDataBindColumn</span><span class="op">:</span> <span class="st">"admin0_name"</span></span>
<span id="cb77-2181"><a href="#cb77-2181" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb77-2182"><a href="#cb77-2182" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-2183"><a href="#cb77-2183" aria-hidden="true" tabindex="-1"></a>  <span class="co">// admin0 selected only</span></span>
<span id="cb77-2184"><a href="#cb77-2184" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="op">!</span>adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>) {</span>
<span id="cb77-2185"><a href="#cb77-2185" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb77-2186"><a href="#cb77-2186" aria-hidden="true" tabindex="-1"></a>      dataGeoImpact<span class="op">,</span></span>
<span id="cb77-2187"><a href="#cb77-2187" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">mutate</span>({ <span class="dt">a1_a0</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">admin1_name</span><span class="op">,</span> d<span class="op">.</span><span class="at">admin0_name</span>]<span class="op">.</span><span class="fu">join</span>(<span class="st">"_"</span>) })</span>
<span id="cb77-2188"><a href="#cb77-2188" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb77-2189"><a href="#cb77-2189" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> geoData <span class="op">=</span> {</span>
<span id="cb77-2190"><a href="#cb77-2190" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>boundaries<span class="op">.</span><span class="at">admin1</span><span class="op">,</span></span>
<span id="cb77-2191"><a href="#cb77-2191" aria-hidden="true" tabindex="-1"></a>      <span class="dt">features</span><span class="op">:</span> boundaries<span class="op">.</span><span class="at">admin1</span><span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb77-2192"><a href="#cb77-2192" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb77-2193"><a href="#cb77-2193" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb77-2194"><a href="#cb77-2194" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb77-2195"><a href="#cb77-2195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2196"><a href="#cb77-2196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">bindTabularToGeo</span>({</span>
<span id="cb77-2197"><a href="#cb77-2197" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb77-2198"><a href="#cb77-2198" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataBindColumn</span><span class="op">:</span> <span class="st">"a1_a0"</span><span class="op">,</span></span>
<span id="cb77-2199"><a href="#cb77-2199" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoData</span><span class="op">:</span> geoData<span class="op">,</span></span>
<span id="cb77-2200"><a href="#cb77-2200" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoDataBindColumn</span><span class="op">:</span> <span class="st">"a1_a0"</span></span>
<span id="cb77-2201"><a href="#cb77-2201" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb77-2202"><a href="#cb77-2202" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-2203"><a href="#cb77-2203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2204"><a href="#cb77-2204" aria-hidden="true" tabindex="-1"></a>  <span class="co">// admin1 is selected</span></span>
<span id="cb77-2205"><a href="#cb77-2205" aria-hidden="true" tabindex="-1"></a>  <span class="co">// show all admin2 regions within admin1</span></span>
<span id="cb77-2206"><a href="#cb77-2206" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb77-2207"><a href="#cb77-2207" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb77-2208"><a href="#cb77-2208" aria-hidden="true" tabindex="-1"></a>      dataGeoImpact<span class="op">,</span></span>
<span id="cb77-2209"><a href="#cb77-2209" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb77-2210"><a href="#cb77-2210" aria-hidden="true" tabindex="-1"></a>        <span class="dt">a2_a1_a0</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">admin2_name</span><span class="op">,</span> d<span class="op">.</span><span class="at">admin1_name</span><span class="op">,</span> d<span class="op">.</span><span class="at">admin0_name</span>]<span class="op">.</span><span class="fu">join</span>(<span class="st">"_"</span>)</span>
<span id="cb77-2211"><a href="#cb77-2211" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb77-2212"><a href="#cb77-2212" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb77-2213"><a href="#cb77-2213" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> geoData <span class="op">=</span> {</span>
<span id="cb77-2214"><a href="#cb77-2214" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>boundaries<span class="op">.</span><span class="at">admin2</span><span class="op">,</span></span>
<span id="cb77-2215"><a href="#cb77-2215" aria-hidden="true" tabindex="-1"></a>      <span class="dt">features</span><span class="op">:</span> boundaries<span class="op">.</span><span class="at">admin2</span><span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb77-2216"><a href="#cb77-2216" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin1_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb77-2217"><a href="#cb77-2217" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb77-2218"><a href="#cb77-2218" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb77-2219"><a href="#cb77-2219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-2220"><a href="#cb77-2220" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">bindTabularToGeo</span>({</span>
<span id="cb77-2221"><a href="#cb77-2221" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb77-2222"><a href="#cb77-2222" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataBindColumn</span><span class="op">:</span> <span class="st">"a2_a1_a0"</span><span class="op">,</span></span>
<span id="cb77-2223"><a href="#cb77-2223" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoData</span><span class="op">:</span> geoData<span class="op">,</span></span>
<span id="cb77-2224"><a href="#cb77-2224" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoDataBindColumn</span><span class="op">:</span> <span class="st">"a2_a1_a0"</span></span>
<span id="cb77-2225"><a href="#cb77-2225" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb77-2226"><a href="#cb77-2226" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-2227"><a href="#cb77-2227" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-77" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb78" data-startfrom="2231" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2230"><span id="cb78-2231"><a href="#cb78-2231" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb78-2232"><a href="#cb78-2232" aria-hidden="true" tabindex="-1"></a><span class="vs">### Dynamic Insights - Geographic Impact</span></span>
<span id="cb78-2233"><a href="#cb78-2233" aria-hidden="true" tabindex="-1"></a><span class="vs">*quick insights for given admin selection*</span></span>
<span id="cb78-2234"><a href="#cb78-2234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-2235"><a href="#cb78-2235" aria-hidden="true" tabindex="-1"></a><span class="vs">- Sql cells add a row that is the combined value for all admin regions, where all admin names are null.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-78" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb79" data-startfrom="2239" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2238"><span id="cb79-2239"><a href="#cb79-2239" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`Here are the combined data and insights for creating the dynamic narrative. Data tables are below.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-79" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb80" data-startfrom="2243" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2242"><span id="cb80-2243"><a href="#cb80-2243" aria-hidden="true" tabindex="-1"></a><span class="co">// dynamic insights for an Admin Selection</span></span>
<span id="cb80-2244"><a href="#cb80-2244" aria-hidden="true" tabindex="-1"></a>dynamicInsights_geoImpact <span class="op">=</span> {</span>
<span id="cb80-2245"><a href="#cb80-2245" aria-hidden="true" tabindex="-1"></a>  <span class="co">// define data</span></span>
<span id="cb80-2246"><a href="#cb80-2246" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalVop <span class="op">=</span> <span class="fu">filterByAdminNames</span>(dynInsightGeo_vopTotals)<span class="op">;</span></span>
<span id="cb80-2247"><a href="#cb80-2247" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> population <span class="op">=</span> <span class="fu">filterByAdminNames</span>(dynInsightGeo_population)<span class="op">;</span></span>
<span id="cb80-2248"><a href="#cb80-2248" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> perc30 <span class="op">=</span> <span class="fu">filterByAdminNames</span>(dynInsightGeo_percentTotals_mid)<span class="op">;</span></span>
<span id="cb80-2249"><a href="#cb80-2249" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> perc50 <span class="op">=</span> <span class="fu">filterByAdminNames</span>(dynInsightGeo_percentTotals)<span class="op">;</span></span>
<span id="cb80-2250"><a href="#cb80-2250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-2251"><a href="#cb80-2251" aria-hidden="true" tabindex="-1"></a>  <span class="co">// format functions</span></span>
<span id="cb80-2252"><a href="#cb80-2252" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _formatTopNVop <span class="op">=</span> formatUSD<span class="op">;</span></span>
<span id="cb80-2253"><a href="#cb80-2253" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _formatNumber <span class="op">=</span> <span class="fu">formatNumCompactLong</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})<span class="op">;</span></span>
<span id="cb80-2254"><a href="#cb80-2254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-2255"><a href="#cb80-2255" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">getTopValue</span>({ d<span class="op">,</span> i } <span class="op">=</span> {}) {</span>
<span id="cb80-2256"><a href="#cb80-2256" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb80-2257"><a href="#cb80-2257" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> d<span class="op">?.</span>[i]<span class="op">?.</span><span class="at">agw_total</span><span class="op">,</span></span>
<span id="cb80-2258"><a href="#cb80-2258" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2259"><a href="#cb80-2259" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> d<span class="op">?.</span>[i]<span class="op">?.</span><span class="at">agw_total</span><span class="op">,</span></span>
<span id="cb80-2260"><a href="#cb80-2260" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb80-2261"><a href="#cb80-2261" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2262"><a href="#cb80-2262" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2263"><a href="#cb80-2263" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> d<span class="op">?.</span>[i]<span class="op">?.</span><span class="at">crop</span></span>
<span id="cb80-2264"><a href="#cb80-2264" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb80-2265"><a href="#cb80-2265" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb80-2266"><a href="#cb80-2266" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb80-2267"><a href="#cb80-2267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-2268"><a href="#cb80-2268" aria-hidden="true" tabindex="-1"></a>  <span class="co">// make insights ------------------------------------</span></span>
<span id="cb80-2269"><a href="#cb80-2269" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb80-2270"><a href="#cb80-2270" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb80-2271"><a href="#cb80-2271" aria-hidden="true" tabindex="-1"></a>      totalVop<span class="op">,</span></span>
<span id="cb80-2272"><a href="#cb80-2272" aria-hidden="true" tabindex="-1"></a>      population</span>
<span id="cb80-2273"><a href="#cb80-2273" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb80-2274"><a href="#cb80-2274" aria-hidden="true" tabindex="-1"></a>    <span class="dt">insight</span><span class="op">:</span> {</span>
<span id="cb80-2275"><a href="#cb80-2275" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalVop</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2276"><a href="#cb80-2276" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> totalVop<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">agw_total</span><span class="op">,</span></span>
<span id="cb80-2277"><a href="#cb80-2277" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb80-2278"><a href="#cb80-2278" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2279"><a href="#cb80-2279" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalPop</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2280"><a href="#cb80-2280" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">total_pop</span><span class="op">,</span></span>
<span id="cb80-2281"><a href="#cb80-2281" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb80-2282"><a href="#cb80-2282" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2283"><a href="#cb80-2283" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalRuralPop</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2284"><a href="#cb80-2284" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">rural_pop</span><span class="op">,</span></span>
<span id="cb80-2285"><a href="#cb80-2285" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb80-2286"><a href="#cb80-2286" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2287"><a href="#cb80-2287" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalAgPop</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2288"><a href="#cb80-2288" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ag_pop</span><span class="op">,</span></span>
<span id="cb80-2289"><a href="#cb80-2289" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb80-2290"><a href="#cb80-2290" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2291"><a href="#cb80-2291" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalAgPop_noformat</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2292"><a href="#cb80-2292" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ag_pop</span></span>
<span id="cb80-2293"><a href="#cb80-2293" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2294"><a href="#cb80-2294" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalAgPop_2_30</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2295"><a href="#cb80-2295" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ag_pop_2_30</span><span class="op">,</span></span>
<span id="cb80-2296"><a href="#cb80-2296" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb80-2297"><a href="#cb80-2297" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2298"><a href="#cb80-2298" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalAgPop_2_30_noformat</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2299"><a href="#cb80-2299" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ag_pop_2_30</span></span>
<span id="cb80-2300"><a href="#cb80-2300" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2301"><a href="#cb80-2301" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalAgPop_2_50</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2302"><a href="#cb80-2302" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ag_pop_2_50</span><span class="op">,</span></span>
<span id="cb80-2303"><a href="#cb80-2303" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb80-2304"><a href="#cb80-2304" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2305"><a href="#cb80-2305" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalAgPop_2_50_noformat</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2306"><a href="#cb80-2306" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ag_pop_2_50</span></span>
<span id="cb80-2307"><a href="#cb80-2307" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2308"><a href="#cb80-2308" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalAgPop_5_30</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2309"><a href="#cb80-2309" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ag_pop_5_30</span><span class="op">,</span></span>
<span id="cb80-2310"><a href="#cb80-2310" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb80-2311"><a href="#cb80-2311" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2312"><a href="#cb80-2312" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalAgPop_5_30_noformat</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2313"><a href="#cb80-2313" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ag_pop_5_30</span></span>
<span id="cb80-2314"><a href="#cb80-2314" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2315"><a href="#cb80-2315" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalAgPop_5_50</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2316"><a href="#cb80-2316" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ag_pop_5_50</span><span class="op">,</span></span>
<span id="cb80-2317"><a href="#cb80-2317" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb80-2318"><a href="#cb80-2318" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2319"><a href="#cb80-2319" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalAgPop_5_50_noformat</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb80-2320"><a href="#cb80-2320" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ag_pop_5_50</span></span>
<span id="cb80-2321"><a href="#cb80-2321" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb80-2322"><a href="#cb80-2322" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb80-2323"><a href="#cb80-2323" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb80-2324"><a href="#cb80-2324" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-80" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb81" data-startfrom="2328" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2327"><span id="cb81-2328"><a href="#cb81-2328" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb81-2329"><a href="#cb81-2329" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Data cells for insights`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-81" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb82" data-startfrom="2333" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2332"><span id="cb82-2333"><a href="#cb82-2333" aria-hidden="true" tabindex="-1"></a><span class="co">// total harvested area</span></span>
<span id="cb82-2334"><a href="#cb82-2334" aria-hidden="true" tabindex="-1"></a>dynInsightGeo_percentTotals_mid <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb82-2335"><a href="#cb82-2335" aria-hidden="true" tabindex="-1"></a><span class="vs">with tbl as (</span></span>
<span id="cb82-2336"><a href="#cb82-2336" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total percentages</span></span>
<span id="cb82-2337"><a href="#cb82-2337" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT admin0_name, admin1_name, admin2_name, MEAN(percentage_change_SSP2_2030_ag) AS percent_change_30</span></span>
<span id="cb82-2338"><a href="#cb82-2338" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM ag_workforce_data</span></span>
<span id="cb82-2339"><a href="#cb82-2339" aria-hidden="true" tabindex="-1"></a><span class="vs">    GROUP BY 1, 2, 3</span></span>
<span id="cb82-2340"><a href="#cb82-2340" aria-hidden="true" tabindex="-1"></a><span class="vs">    ORDER BY 1, 2, 3</span></span>
<span id="cb82-2341"><a href="#cb82-2341" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb82-2342"><a href="#cb82-2342" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-2343"><a href="#cb82-2343" aria-hidden="true" tabindex="-1"></a><span class="vs">-- QUERY ------------------------------------------</span></span>
<span id="cb82-2344"><a href="#cb82-2344" aria-hidden="true" tabindex="-1"></a><span class="vs">(</span></span>
<span id="cb82-2345"><a href="#cb82-2345" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total for all regions</span></span>
<span id="cb82-2346"><a href="#cb82-2346" aria-hidden="true" tabindex="-1"></a><span class="vs">  select null as admin0_name</span></span>
<span id="cb82-2347"><a href="#cb82-2347" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin1_name</span></span>
<span id="cb82-2348"><a href="#cb82-2348" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin2_name</span></span>
<span id="cb82-2349"><a href="#cb82-2349" aria-hidden="true" tabindex="-1"></a><span class="vs">    , percent_change_30</span></span>
<span id="cb82-2350"><a href="#cb82-2350" aria-hidden="true" tabindex="-1"></a><span class="vs">    from (</span></span>
<span id="cb82-2351"><a href="#cb82-2351" aria-hidden="true" tabindex="-1"></a><span class="vs">      select mean(percent_change_30) as percent_change_30</span></span>
<span id="cb82-2352"><a href="#cb82-2352" aria-hidden="true" tabindex="-1"></a><span class="vs">        from tbl</span></span>
<span id="cb82-2353"><a href="#cb82-2353" aria-hidden="true" tabindex="-1"></a><span class="vs">        where admin1_name is null</span></span>
<span id="cb82-2354"><a href="#cb82-2354" aria-hidden="true" tabindex="-1"></a><span class="vs">    )</span></span>
<span id="cb82-2355"><a href="#cb82-2355" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb82-2356"><a href="#cb82-2356" aria-hidden="true" tabindex="-1"></a><span class="vs">  union</span></span>
<span id="cb82-2357"><a href="#cb82-2357" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb82-2358"><a href="#cb82-2358" aria-hidden="true" tabindex="-1"></a><span class="vs">  select * </span></span>
<span id="cb82-2359"><a href="#cb82-2359" aria-hidden="true" tabindex="-1"></a><span class="vs">    from tbl</span></span>
<span id="cb82-2360"><a href="#cb82-2360" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb82-2361"><a href="#cb82-2361" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb82-2362"><a href="#cb82-2362" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb82-2363"><a href="#cb82-2363" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-82" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb83" data-startfrom="2367" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2366"><span id="cb83-2367"><a href="#cb83-2367" aria-hidden="true" tabindex="-1"></a><span class="co">// total harvested area</span></span>
<span id="cb83-2368"><a href="#cb83-2368" aria-hidden="true" tabindex="-1"></a>dynInsightGeo_percentTotals <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb83-2369"><a href="#cb83-2369" aria-hidden="true" tabindex="-1"></a><span class="vs">with tbl as (</span></span>
<span id="cb83-2370"><a href="#cb83-2370" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total percentages</span></span>
<span id="cb83-2371"><a href="#cb83-2371" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT admin0_name, admin1_name, admin2_name, MEAN(percentage_change_SSP2_2050_ag) AS percent_change_50</span></span>
<span id="cb83-2372"><a href="#cb83-2372" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM ag_workforce_data</span></span>
<span id="cb83-2373"><a href="#cb83-2373" aria-hidden="true" tabindex="-1"></a><span class="vs">    GROUP BY 1, 2, 3</span></span>
<span id="cb83-2374"><a href="#cb83-2374" aria-hidden="true" tabindex="-1"></a><span class="vs">    ORDER BY 1, 2, 3</span></span>
<span id="cb83-2375"><a href="#cb83-2375" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb83-2376"><a href="#cb83-2376" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-2377"><a href="#cb83-2377" aria-hidden="true" tabindex="-1"></a><span class="vs">-- QUERY ------------------------------------------</span></span>
<span id="cb83-2378"><a href="#cb83-2378" aria-hidden="true" tabindex="-1"></a><span class="vs">(</span></span>
<span id="cb83-2379"><a href="#cb83-2379" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total for all regions</span></span>
<span id="cb83-2380"><a href="#cb83-2380" aria-hidden="true" tabindex="-1"></a><span class="vs">  select null as admin0_name</span></span>
<span id="cb83-2381"><a href="#cb83-2381" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin1_name</span></span>
<span id="cb83-2382"><a href="#cb83-2382" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin2_name</span></span>
<span id="cb83-2383"><a href="#cb83-2383" aria-hidden="true" tabindex="-1"></a><span class="vs">    , percent_change_50</span></span>
<span id="cb83-2384"><a href="#cb83-2384" aria-hidden="true" tabindex="-1"></a><span class="vs">    from (</span></span>
<span id="cb83-2385"><a href="#cb83-2385" aria-hidden="true" tabindex="-1"></a><span class="vs">      select mean(percent_change_50) as percent_change_50</span></span>
<span id="cb83-2386"><a href="#cb83-2386" aria-hidden="true" tabindex="-1"></a><span class="vs">        from tbl</span></span>
<span id="cb83-2387"><a href="#cb83-2387" aria-hidden="true" tabindex="-1"></a><span class="vs">        where admin1_name is null</span></span>
<span id="cb83-2388"><a href="#cb83-2388" aria-hidden="true" tabindex="-1"></a><span class="vs">    )</span></span>
<span id="cb83-2389"><a href="#cb83-2389" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb83-2390"><a href="#cb83-2390" aria-hidden="true" tabindex="-1"></a><span class="vs">  union</span></span>
<span id="cb83-2391"><a href="#cb83-2391" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb83-2392"><a href="#cb83-2392" aria-hidden="true" tabindex="-1"></a><span class="vs">  select * </span></span>
<span id="cb83-2393"><a href="#cb83-2393" aria-hidden="true" tabindex="-1"></a><span class="vs">    from tbl</span></span>
<span id="cb83-2394"><a href="#cb83-2394" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb83-2395"><a href="#cb83-2395" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb83-2396"><a href="#cb83-2396" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb83-2397"><a href="#cb83-2397" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-83" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb84" data-startfrom="2401" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2400"><span id="cb84-2401"><a href="#cb84-2401" aria-hidden="true" tabindex="-1"></a>dynInsightGeo_vopTotals <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb84-2402"><a href="#cb84-2402" aria-hidden="true" tabindex="-1"></a><span class="vs">-- total ag workforce</span></span>
<span id="cb84-2403"><a href="#cb84-2403" aria-hidden="true" tabindex="-1"></a><span class="vs">with tbl as (</span></span>
<span id="cb84-2404"><a href="#cb84-2404" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total VoP and harvested area</span></span>
<span id="cb84-2405"><a href="#cb84-2405" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT admin0_name, admin1_name, admin2_name, sum(corrected_index_ag_pop_SSP2_2050) AS agw_total</span></span>
<span id="cb84-2406"><a href="#cb84-2406" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM ag_workforce_data</span></span>
<span id="cb84-2407"><a href="#cb84-2407" aria-hidden="true" tabindex="-1"></a><span class="vs">    GROUP BY 1, 2, 3</span></span>
<span id="cb84-2408"><a href="#cb84-2408" aria-hidden="true" tabindex="-1"></a><span class="vs">    ORDER BY 1, 2, 3</span></span>
<span id="cb84-2409"><a href="#cb84-2409" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb84-2410"><a href="#cb84-2410" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-2411"><a href="#cb84-2411" aria-hidden="true" tabindex="-1"></a><span class="vs">-- QUERY ------------------------------------------</span></span>
<span id="cb84-2412"><a href="#cb84-2412" aria-hidden="true" tabindex="-1"></a><span class="vs">(</span></span>
<span id="cb84-2413"><a href="#cb84-2413" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total for all regions</span></span>
<span id="cb84-2414"><a href="#cb84-2414" aria-hidden="true" tabindex="-1"></a><span class="vs">  select null as admin0_name</span></span>
<span id="cb84-2415"><a href="#cb84-2415" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin1_name</span></span>
<span id="cb84-2416"><a href="#cb84-2416" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin2_name</span></span>
<span id="cb84-2417"><a href="#cb84-2417" aria-hidden="true" tabindex="-1"></a><span class="vs">    , agw_total</span></span>
<span id="cb84-2418"><a href="#cb84-2418" aria-hidden="true" tabindex="-1"></a><span class="vs">    from (</span></span>
<span id="cb84-2419"><a href="#cb84-2419" aria-hidden="true" tabindex="-1"></a><span class="vs">      select mean(agw_total) as agw_total</span></span>
<span id="cb84-2420"><a href="#cb84-2420" aria-hidden="true" tabindex="-1"></a><span class="vs">        from tbl</span></span>
<span id="cb84-2421"><a href="#cb84-2421" aria-hidden="true" tabindex="-1"></a><span class="vs">        where admin1_name is null</span></span>
<span id="cb84-2422"><a href="#cb84-2422" aria-hidden="true" tabindex="-1"></a><span class="vs">    )</span></span>
<span id="cb84-2423"><a href="#cb84-2423" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb84-2424"><a href="#cb84-2424" aria-hidden="true" tabindex="-1"></a><span class="vs">  union</span></span>
<span id="cb84-2425"><a href="#cb84-2425" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb84-2426"><a href="#cb84-2426" aria-hidden="true" tabindex="-1"></a><span class="vs">  select * </span></span>
<span id="cb84-2427"><a href="#cb84-2427" aria-hidden="true" tabindex="-1"></a><span class="vs">    from tbl</span></span>
<span id="cb84-2428"><a href="#cb84-2428" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb84-2429"><a href="#cb84-2429" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb84-2430"><a href="#cb84-2430" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb84-2431"><a href="#cb84-2431" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-84" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb85" data-startfrom="2435" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2434"><span id="cb85-2435"><a href="#cb85-2435" aria-hidden="true" tabindex="-1"></a>dynInsightGeo_population <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb85-2436"><a href="#cb85-2436" aria-hidden="true" tabindex="-1"></a><span class="vs">with tbl as (</span></span>
<span id="cb85-2437"><a href="#cb85-2437" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- ag workforce population data</span></span>
<span id="cb85-2438"><a href="#cb85-2438" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb85-2439"><a href="#cb85-2439" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb85-2440"><a href="#cb85-2440" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb85-2441"><a href="#cb85-2441" aria-hidden="true" tabindex="-1"></a><span class="vs">    , total</span></span>
<span id="cb85-2442"><a href="#cb85-2442" aria-hidden="true" tabindex="-1"></a><span class="vs">    , rural</span></span>
<span id="cb85-2443"><a href="#cb85-2443" aria-hidden="true" tabindex="-1"></a><span class="vs">    , corrected_ag_pop</span></span>
<span id="cb85-2444"><a href="#cb85-2444" aria-hidden="true" tabindex="-1"></a><span class="vs">    , corrected_index_ag_pop_SSP2_2050</span></span>
<span id="cb85-2445"><a href="#cb85-2445" aria-hidden="true" tabindex="-1"></a><span class="vs">    , corrected_index_ag_pop_SSP2_2030</span></span>
<span id="cb85-2446"><a href="#cb85-2446" aria-hidden="true" tabindex="-1"></a><span class="vs">    , corrected_index_ag_pop_SSP5_2050</span></span>
<span id="cb85-2447"><a href="#cb85-2447" aria-hidden="true" tabindex="-1"></a><span class="vs">    , corrected_index_ag_pop_SSP5_2030</span></span>
<span id="cb85-2448"><a href="#cb85-2448" aria-hidden="true" tabindex="-1"></a><span class="vs">    from ag_workforce_data</span></span>
<span id="cb85-2449"><a href="#cb85-2449" aria-hidden="true" tabindex="-1"></a><span class="vs">    order by admin0_name</span></span>
<span id="cb85-2450"><a href="#cb85-2450" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb85-2451"><a href="#cb85-2451" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb85-2452"><a href="#cb85-2452" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb85-2453"><a href="#cb85-2453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-2454"><a href="#cb85-2454" aria-hidden="true" tabindex="-1"></a><span class="vs">-- QUERY ------------------------------------------</span></span>
<span id="cb85-2455"><a href="#cb85-2455" aria-hidden="true" tabindex="-1"></a><span class="vs">(</span></span>
<span id="cb85-2456"><a href="#cb85-2456" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total for all regions</span></span>
<span id="cb85-2457"><a href="#cb85-2457" aria-hidden="true" tabindex="-1"></a><span class="vs">  select null as admin0_name</span></span>
<span id="cb85-2458"><a href="#cb85-2458" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin1_name</span></span>
<span id="cb85-2459"><a href="#cb85-2459" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin2_name</span></span>
<span id="cb85-2460"><a href="#cb85-2460" aria-hidden="true" tabindex="-1"></a><span class="vs">    , *</span></span>
<span id="cb85-2461"><a href="#cb85-2461" aria-hidden="true" tabindex="-1"></a><span class="vs">    from (</span></span>
<span id="cb85-2462"><a href="#cb85-2462" aria-hidden="true" tabindex="-1"></a><span class="vs">      select sum(total) as total_pop</span></span>
<span id="cb85-2463"><a href="#cb85-2463" aria-hidden="true" tabindex="-1"></a><span class="vs">        , sum(rural) as rural_pop</span></span>
<span id="cb85-2464"><a href="#cb85-2464" aria-hidden="true" tabindex="-1"></a><span class="vs">        , sum(corrected_ag_pop) as ag_pop</span></span>
<span id="cb85-2465"><a href="#cb85-2465" aria-hidden="true" tabindex="-1"></a><span class="vs">        , sum(corrected_index_ag_pop_SSP2_2030) as ag_pop_2_30</span></span>
<span id="cb85-2466"><a href="#cb85-2466" aria-hidden="true" tabindex="-1"></a><span class="vs">        , sum(corrected_index_ag_pop_SSP2_2050) as ag_pop_2_50</span></span>
<span id="cb85-2467"><a href="#cb85-2467" aria-hidden="true" tabindex="-1"></a><span class="vs">        , sum(corrected_index_ag_pop_SSP5_2050) as ag_pop_5_50</span></span>
<span id="cb85-2468"><a href="#cb85-2468" aria-hidden="true" tabindex="-1"></a><span class="vs">        , sum(corrected_index_ag_pop_SSP5_2030) as ag_pop_5_30</span></span>
<span id="cb85-2469"><a href="#cb85-2469" aria-hidden="true" tabindex="-1"></a><span class="vs">        from tbl</span></span>
<span id="cb85-2470"><a href="#cb85-2470" aria-hidden="true" tabindex="-1"></a><span class="vs">        where admin1_name is null</span></span>
<span id="cb85-2471"><a href="#cb85-2471" aria-hidden="true" tabindex="-1"></a><span class="vs">    )</span></span>
<span id="cb85-2472"><a href="#cb85-2472" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb85-2473"><a href="#cb85-2473" aria-hidden="true" tabindex="-1"></a><span class="vs">  union</span></span>
<span id="cb85-2474"><a href="#cb85-2474" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb85-2475"><a href="#cb85-2475" aria-hidden="true" tabindex="-1"></a><span class="vs">  select *</span></span>
<span id="cb85-2476"><a href="#cb85-2476" aria-hidden="true" tabindex="-1"></a><span class="vs">    from tbl</span></span>
<span id="cb85-2477"><a href="#cb85-2477" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb85-2478"><a href="#cb85-2478" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb85-2479"><a href="#cb85-2479" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb85-2480"><a href="#cb85-2480" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-85" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb86" data-startfrom="2484" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2483"><span id="cb86-2484"><a href="#cb86-2484" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb86-2485"><a href="#cb86-2485" aria-hidden="true" tabindex="-1"></a><span class="vs">### Bar Charts - Hazards and Exposures</span></span>
<span id="cb86-2486"><a href="#cb86-2486" aria-hidden="true" tabindex="-1"></a><span class="vs">*getting data based on admin selection and hazard options*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-86" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb87" data-startfrom="2490" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2489"><span id="cb87-2490"><a href="#cb87-2490" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`#### Plot Function</span></span>
<span id="cb87-2491"><a href="#cb87-2491" aria-hidden="true" tabindex="-1"></a><span class="vs">Making the top VoP bar charts`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-87" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb88" data-startfrom="2495" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2494"><span id="cb88-2495"><a href="#cb88-2495" aria-hidden="true" tabindex="-1"></a><span class="co">// make the bar chart for top crops</span></span>
<span id="cb88-2496"><a href="#cb88-2496" aria-hidden="true" tabindex="-1"></a><span class="co">// approach is passing in data for selected hazard and crop type</span></span>
<span id="cb88-2497"><a href="#cb88-2497" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">makeTopCropBarChart</span>(data) {</span>
<span id="cb88-2498"><a href="#cb88-2498" aria-hidden="true" tabindex="-1"></a>  <span class="co">// if no data is available for selected hazard, show a message</span></span>
<span id="cb88-2499"><a href="#cb88-2499" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (data<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb88-2500"><a href="#cb88-2500" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`*No VoP exposure*`</span><span class="op">;</span></span>
<span id="cb88-2501"><a href="#cb88-2501" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb88-2502"><a href="#cb88-2502" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topN <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb88-2503"><a href="#cb88-2503" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-2504"><a href="#cb88-2504" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb88-2505"><a href="#cb88-2505" aria-hidden="true" tabindex="-1"></a>    width<span class="op">,</span></span>
<span id="cb88-2506"><a href="#cb88-2506" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb88-2507"><a href="#cb88-2507" aria-hidden="true" tabindex="-1"></a>    <span class="dt">caption</span><span class="op">:</span> monetaryVoPNote<span class="op">,</span></span>
<span id="cb88-2508"><a href="#cb88-2508" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb88-2509"><a href="#cb88-2509" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> formatUSD<span class="op">,</span></span>
<span id="cb88-2510"><a href="#cb88-2510" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"VoP at risk ($)"</span><span class="op">,</span></span>
<span id="cb88-2511"><a href="#cb88-2511" aria-hidden="true" tabindex="-1"></a>      <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb88-2512"><a href="#cb88-2512" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb88-2513"><a href="#cb88-2513" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb88-2514"><a href="#cb88-2514" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb88-2515"><a href="#cb88-2515" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb88-2516"><a href="#cb88-2516" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb88-2517"><a href="#cb88-2517" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb88-2518"><a href="#cb88-2518" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span><span class="op">,</span></span>
<span id="cb88-2519"><a href="#cb88-2519" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">range</span><span class="op">,</span></span>
<span id="cb88-2520"><a href="#cb88-2520" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb88-2521"><a href="#cb88-2521" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb88-2522"><a href="#cb88-2522" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barX</span>(data<span class="op">,</span> {</span>
<span id="cb88-2523"><a href="#cb88-2523" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"vop"</span><span class="op">,</span></span>
<span id="cb88-2524"><a href="#cb88-2524" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[d<span class="op">.</span><span class="at">crop</span>]<span class="op">,</span></span>
<span id="cb88-2525"><a href="#cb88-2525" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]<span class="op">,</span></span>
<span id="cb88-2526"><a href="#cb88-2526" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sort</span><span class="op">:</span> { <span class="dt">y</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">limit</span><span class="op">:</span> <span class="dv">10</span> }<span class="op">,</span></span>
<span id="cb88-2527"><a href="#cb88-2527" aria-hidden="true" tabindex="-1"></a>        <span class="dt">channels</span><span class="op">:</span> {</span>
<span id="cb88-2528"><a href="#cb88-2528" aria-hidden="true" tabindex="-1"></a>          <span class="dt">vop</span><span class="op">:</span> {</span>
<span id="cb88-2529"><a href="#cb88-2529" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span><span class="op">:</span> <span class="st">"VoP at risk"</span><span class="op">,</span></span>
<span id="cb88-2530"><a href="#cb88-2530" aria-hidden="true" tabindex="-1"></a>            <span class="dt">value</span><span class="op">:</span> <span class="st">"vop"</span><span class="op">,</span></span>
<span id="cb88-2531"><a href="#cb88-2531" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb88-2532"><a href="#cb88-2532" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb88-2533"><a href="#cb88-2533" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> {</span>
<span id="cb88-2534"><a href="#cb88-2534" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb88-2535"><a href="#cb88-2535" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb88-2536"><a href="#cb88-2536" aria-hidden="true" tabindex="-1"></a>            <span class="dt">y</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb88-2537"><a href="#cb88-2537" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb88-2538"><a href="#cb88-2538" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vop</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">formatUSD</span>(d)<span class="op">,</span></span>
<span id="cb88-2539"><a href="#cb88-2539" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb88-2540"><a href="#cb88-2540" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb88-2541"><a href="#cb88-2541" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb88-2542"><a href="#cb88-2542" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb88-2543"><a href="#cb88-2543" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb88-2544"><a href="#cb88-2544" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-88" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb89" data-startfrom="2548" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2547"><span id="cb89-2548"><a href="#cb89-2548" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`#### Hazard Data`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-89" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb90" data-startfrom="2552" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2551"><span id="cb90-2552"><a href="#cb90-2552" aria-hidden="true" tabindex="-1"></a>data_hazardVoP <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb90-2553"><a href="#cb90-2553" aria-hidden="true" tabindex="-1"></a>  <span class="co">// data for selected hazard scenario, with total vop</span></span>
<span id="cb90-2554"><a href="#cb90-2554" aria-hidden="true" tabindex="-1"></a>  dataHazardSelected<span class="op">,</span></span>
<span id="cb90-2555"><a href="#cb90-2555" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">leftJoin</span>(dataHazardVoPTotalSelected<span class="op">,</span> {</span>
<span id="cb90-2556"><a href="#cb90-2556" aria-hidden="true" tabindex="-1"></a>    <span class="dt">by</span><span class="op">:</span> [<span class="st">"admin0_name"</span><span class="op">,</span> <span class="st">"admin1_name"</span><span class="op">,</span> <span class="st">"admin2_name"</span><span class="op">,</span> <span class="st">"crop"</span>]<span class="op">,</span></span>
<span id="cb90-2557"><a href="#cb90-2557" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb90-2558"><a href="#cb90-2558" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-90" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb91" data-startfrom="2562" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2561"><span id="cb91-2562"><a href="#cb91-2562" aria-hidden="true" tabindex="-1"></a>dataHazardVoPTotalSelected <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb91-2563"><a href="#cb91-2563" aria-hidden="true" tabindex="-1"></a>  dataHazardSelected<span class="op">,</span></span>
<span id="cb91-2564"><a href="#cb91-2564" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb91-2565"><a href="#cb91-2565" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb91-2566"><a href="#cb91-2566" aria-hidden="true" tabindex="-1"></a>      <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb91-2567"><a href="#cb91-2567" aria-hidden="true" tabindex="-1"></a>      <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb91-2568"><a href="#cb91-2568" aria-hidden="true" tabindex="-1"></a>      <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb91-2569"><a href="#cb91-2569" aria-hidden="true" tabindex="-1"></a>      <span class="st">"threshold"</span><span class="op">,</span></span>
<span id="cb91-2570"><a href="#cb91-2570" aria-hidden="true" tabindex="-1"></a>      <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb91-2571"><a href="#cb91-2571" aria-hidden="true" tabindex="-1"></a>      <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb91-2572"><a href="#cb91-2572" aria-hidden="true" tabindex="-1"></a>      <span class="st">"crop"</span><span class="op">,</span></span>
<span id="cb91-2573"><a href="#cb91-2573" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb91-2574"><a href="#cb91-2574" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb91-2575"><a href="#cb91-2575" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb91-2576"><a href="#cb91-2576" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vop_total</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"vop"</span>)<span class="op">,</span></span>
<span id="cb91-2577"><a href="#cb91-2577" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb91-2578"><a href="#cb91-2578" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb91-2579"><a href="#cb91-2579" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb91-2580"><a href="#cb91-2580" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-91" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb92" data-startfrom="2584" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2583"><span id="cb92-2584"><a href="#cb92-2584" aria-hidden="true" tabindex="-1"></a><span class="co">// unique crops in the hazard data</span></span>
<span id="cb92-2585"><a href="#cb92-2585" aria-hidden="true" tabindex="-1"></a>hazardCrops <span class="op">=</span> {</span>
<span id="cb92-2586"><a href="#cb92-2586" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> query <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`select crop</span></span>
<span id="cb92-2587"><a href="#cb92-2587" aria-hidden="true" tabindex="-1"></a><span class="vs">  , count(*) as count</span></span>
<span id="cb92-2588"><a href="#cb92-2588" aria-hidden="true" tabindex="-1"></a><span class="vs">  from heat_stress_data</span></span>
<span id="cb92-2589"><a href="#cb92-2589" aria-hidden="true" tabindex="-1"></a><span class="vs">  group by 1</span></span>
<span id="cb92-2590"><a href="#cb92-2590" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1`</span>)<span class="op">;</span></span>
<span id="cb92-2591"><a href="#cb92-2591" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-2592"><a href="#cb92-2592" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> query</span>
<span id="cb92-2593"><a href="#cb92-2593" aria-hidden="true" tabindex="-1"></a> }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-92" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb93" data-startfrom="2597" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2596"><span id="cb93-2597"><a href="#cb93-2597" aria-hidden="true" tabindex="-1"></a><span class="co">// formatting crop names</span></span>
<span id="cb93-2598"><a href="#cb93-2598" aria-hidden="true" tabindex="-1"></a>cropNames <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb93-2599"><a href="#cb93-2599" aria-hidden="true" tabindex="-1"></a>  hazardCrops<span class="op">,</span></span>
<span id="cb93-2600"><a href="#cb93-2600" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">distinct</span>(<span class="st">"crop"</span>)<span class="op">,</span></span>
<span id="cb93-2601"><a href="#cb93-2601" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">select</span>(<span class="st">"crop"</span>)<span class="op">,</span></span>
<span id="cb93-2602"><a href="#cb93-2602" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb93-2603"><a href="#cb93-2603" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert crop to number for sorting</span></span>
<span id="cb93-2604"><a href="#cb93-2604" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cropNum</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="pp">parseInt</span>(d<span class="op">.</span><span class="at">crop</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">,</span></span>
<span id="cb93-2605"><a href="#cb93-2605" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Determine the type based on the original string format (adjust as needed)</span></span>
<span id="cb93-2606"><a href="#cb93-2606" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (<span class="ss">/_/</span><span class="op">.</span><span class="fu">test</span>(d<span class="op">.</span><span class="at">crop</span>) <span class="op">?</span> <span class="st">"livestock"</span> <span class="op">:</span> <span class="st">"crop"</span>)<span class="op">,</span></span>
<span id="cb93-2607"><a href="#cb93-2607" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Format the crop name</span></span>
<span id="cb93-2608"><a href="#cb93-2608" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cropName</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb93-2609"><a href="#cb93-2609" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> cropName <span class="op">=</span> d<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="fu">charAt</span>(<span class="dv">0</span>)<span class="op">.</span><span class="fu">toUpperCase</span>() <span class="op">+</span> d<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb93-2610"><a href="#cb93-2610" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="ss">/_/</span><span class="op">.</span><span class="fu">test</span>(d<span class="op">.</span><span class="at">crop</span>)) cropName <span class="op">=</span> cropName<span class="op">.</span><span class="fu">replace</span>(<span class="st">"_"</span><span class="op">,</span> <span class="st">" ("</span>) <span class="op">+</span> <span class="st">")"</span><span class="op">;</span></span>
<span id="cb93-2611"><a href="#cb93-2611" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> cropName<span class="op">;</span></span>
<span id="cb93-2612"><a href="#cb93-2612" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb93-2613"><a href="#cb93-2613" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb93-2614"><a href="#cb93-2614" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Use the numeric version of crop for sorting, then remove it from the final result as it's no longer needed</span></span>
<span id="cb93-2615"><a href="#cb93-2615" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">arrange</span>([<span class="st">"type"</span><span class="op">,</span> <span class="st">"cropNum"</span>])<span class="op">,</span></span>
<span id="cb93-2616"><a href="#cb93-2616" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">select</span>([<span class="st">"type"</span><span class="op">,</span> <span class="st">"crop"</span><span class="op">,</span> <span class="st">"cropName"</span>])<span class="op">,</span> <span class="co">// Assuming you want to keep these fields in the final output</span></span>
<span id="cb93-2617"><a href="#cb93-2617" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-93" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb94" data-startfrom="2621" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2620"><span id="cb94-2621"><a href="#cb94-2621" aria-hidden="true" tabindex="-1"></a><span class="co">// lookups for hazard plot</span></span>
<span id="cb94-2622"><a href="#cb94-2622" aria-hidden="true" tabindex="-1"></a>hazardPlotLookup <span class="op">=</span> {</span>
<span id="cb94-2623"><a href="#cb94-2623" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb94-2624"><a href="#cb94-2624" aria-hidden="true" tabindex="-1"></a>    <span class="dt">names</span><span class="op">:</span> {</span>
<span id="cb94-2625"><a href="#cb94-2625" aria-hidden="true" tabindex="-1"></a>      <span class="dt">baseline</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">group</span><span class="op">.</span><span class="at">baseline</span>)<span class="op">,</span></span>
<span id="cb94-2626"><a href="#cb94-2626" aria-hidden="true" tabindex="-1"></a>      <span class="dt">projection</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">group</span><span class="op">.</span><span class="at">projection</span>)</span>
<span id="cb94-2627"><a href="#cb94-2627" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb94-2628"><a href="#cb94-2628" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb94-2629"><a href="#cb94-2629" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb94-2630"><a href="#cb94-2630" aria-hidden="true" tabindex="-1"></a>        <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">group</span><span class="op">.</span><span class="at">baseline</span>)<span class="op">,</span></span>
<span id="cb94-2631"><a href="#cb94-2631" aria-hidden="true" tabindex="-1"></a>        <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">sections</span><span class="op">.</span><span class="at">heatStress</span><span class="op">.</span><span class="at">barChart</span><span class="op">.</span><span class="at">group</span><span class="op">.</span><span class="at">projection</span>)</span>
<span id="cb94-2632"><a href="#cb94-2632" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb94-2633"><a href="#cb94-2633" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> [<span class="st">"#B1B1B1"</span><span class="op">,</span> <span class="st">"#EC5A47"</span>]</span>
<span id="cb94-2634"><a href="#cb94-2634" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb94-2635"><a href="#cb94-2635" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crops</span><span class="op">:</span> cropNames<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> obj) <span class="kw">=&gt;</span> {</span>
<span id="cb94-2636"><a href="#cb94-2636" aria-hidden="true" tabindex="-1"></a>      acc[obj<span class="op">.</span><span class="at">crop</span>] <span class="op">=</span> obj<span class="op">.</span><span class="at">cropName</span><span class="op">;</span></span>
<span id="cb94-2637"><a href="#cb94-2637" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> acc<span class="op">;</span></span>
<span id="cb94-2638"><a href="#cb94-2638" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {})</span>
<span id="cb94-2639"><a href="#cb94-2639" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb94-2640"><a href="#cb94-2640" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-94" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb95" data-startfrom="2644" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2643"><span id="cb95-2644"><a href="#cb95-2644" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`#### Selecting Heat Stress data by scenario</span></span>
<span id="cb95-2645"><a href="#cb95-2645" aria-hidden="true" tabindex="-1"></a><span class="vs">- The data is queried as separate components for each admin region to reduce query size and allow for dynamic null handling. A table is chosen based on the selected admin region.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-95" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb96" data-startfrom="2649" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2648"><span id="cb96-2649"><a href="#cb96-2649" aria-hidden="true" tabindex="-1"></a><span class="co">// pick the admin dataset based on admin selection</span></span>
<span id="cb96-2650"><a href="#cb96-2650" aria-hidden="true" tabindex="-1"></a>dataHazardSelected <span class="op">=</span> {</span>
<span id="cb96-2651"><a href="#cb96-2651" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> dataHazardAdmin2</span>
<span id="cb96-2652"><a href="#cb96-2652" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> dataHazardAdmin1</span>
<span id="cb96-2653"><a href="#cb96-2653" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> dataHazardAdmin0</span>
<span id="cb96-2654"><a href="#cb96-2654" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> dataHazardAdminAll</span>
<span id="cb96-2655"><a href="#cb96-2655" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-96" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb97" data-startfrom="2659" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2658"><span id="cb97-2659"><a href="#cb97-2659" aria-hidden="true" tabindex="-1"></a>dataHazardAdminAll <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb97-2660"><a href="#cb97-2660" aria-hidden="true" tabindex="-1"></a><span class="vs">-- admin0, combine for Sub-Saharan Africa</span></span>
<span id="cb97-2661"><a href="#cb97-2661" aria-hidden="true" tabindex="-1"></a><span class="vs">with data_tbl as (</span></span>
<span id="cb97-2662"><a href="#cb97-2662" aria-hidden="true" tabindex="-1"></a><span class="vs">  with tbl as (</span></span>
<span id="cb97-2663"><a href="#cb97-2663" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- total for all admin0 regions</span></span>
<span id="cb97-2664"><a href="#cb97-2664" aria-hidden="true" tabindex="-1"></a><span class="vs">    with base as (</span></span>
<span id="cb97-2665"><a href="#cb97-2665" aria-hidden="true" tabindex="-1"></a><span class="vs">      -- chosen scenario and timeframe, VoP</span></span>
<span id="cb97-2666"><a href="#cb97-2666" aria-hidden="true" tabindex="-1"></a><span class="vs">      select admin0_name</span></span>
<span id="cb97-2667"><a href="#cb97-2667" aria-hidden="true" tabindex="-1"></a><span class="vs">        , admin1_name</span></span>
<span id="cb97-2668"><a href="#cb97-2668" aria-hidden="true" tabindex="-1"></a><span class="vs">        , admin2_name</span></span>
<span id="cb97-2669"><a href="#cb97-2669" aria-hidden="true" tabindex="-1"></a><span class="vs">        , scenario</span></span>
<span id="cb97-2670"><a href="#cb97-2670" aria-hidden="true" tabindex="-1"></a><span class="vs">        , timeframe</span></span>
<span id="cb97-2671"><a href="#cb97-2671" aria-hidden="true" tabindex="-1"></a><span class="vs">        , crop</span></span>
<span id="cb97-2672"><a href="#cb97-2672" aria-hidden="true" tabindex="-1"></a><span class="vs">        , threshold</span></span>
<span id="cb97-2673"><a href="#cb97-2673" aria-hidden="true" tabindex="-1"></a><span class="vs">        , hazard</span></span>
<span id="cb97-2674"><a href="#cb97-2674" aria-hidden="true" tabindex="-1"></a><span class="vs">        , value as vop</span></span>
<span id="cb97-2675"><a href="#cb97-2675" aria-hidden="true" tabindex="-1"></a><span class="vs">        from heat_stress_data</span></span>
<span id="cb97-2676"><a href="#cb97-2676" aria-hidden="true" tabindex="-1"></a><span class="vs">        where timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb97-2677"><a href="#cb97-2677" aria-hidden="true" tabindex="-1"></a><span class="vs">        and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb97-2678"><a href="#cb97-2678" aria-hidden="true" tabindex="-1"></a><span class="vs">        and threshold = '</span><span class="sc">${</span>selectThreshold<span class="op">.</span><span class="at">threshold</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb97-2679"><a href="#cb97-2679" aria-hidden="true" tabindex="-1"></a><span class="vs">    )</span></span>
<span id="cb97-2680"><a href="#cb97-2680" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb97-2681"><a href="#cb97-2681" aria-hidden="true" tabindex="-1"></a><span class="vs">    select *</span></span>
<span id="cb97-2682"><a href="#cb97-2682" aria-hidden="true" tabindex="-1"></a><span class="vs">      from base</span></span>
<span id="cb97-2683"><a href="#cb97-2683" aria-hidden="true" tabindex="-1"></a><span class="vs">      where admin1_name is null</span></span>
<span id="cb97-2684"><a href="#cb97-2684" aria-hidden="true" tabindex="-1"></a><span class="vs">  )</span></span>
<span id="cb97-2685"><a href="#cb97-2685" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-2686"><a href="#cb97-2686" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total VoP for each crop</span></span>
<span id="cb97-2687"><a href="#cb97-2687" aria-hidden="true" tabindex="-1"></a><span class="vs">  select threshold</span></span>
<span id="cb97-2688"><a href="#cb97-2688" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb97-2689"><a href="#cb97-2689" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb97-2690"><a href="#cb97-2690" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb97-2691"><a href="#cb97-2691" aria-hidden="true" tabindex="-1"></a><span class="vs">    , crop</span></span>
<span id="cb97-2692"><a href="#cb97-2692" aria-hidden="true" tabindex="-1"></a><span class="vs">    , SUM(vop) as vop</span></span>
<span id="cb97-2693"><a href="#cb97-2693" aria-hidden="true" tabindex="-1"></a><span class="vs">    from tbl</span></span>
<span id="cb97-2694"><a href="#cb97-2694" aria-hidden="true" tabindex="-1"></a><span class="vs">    group by threshold</span></span>
<span id="cb97-2695"><a href="#cb97-2695" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb97-2696"><a href="#cb97-2696" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb97-2697"><a href="#cb97-2697" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb97-2698"><a href="#cb97-2698" aria-hidden="true" tabindex="-1"></a><span class="vs">    , crop</span></span>
<span id="cb97-2699"><a href="#cb97-2699" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb97-2700"><a href="#cb97-2700" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-2701"><a href="#cb97-2701" aria-hidden="true" tabindex="-1"></a><span class="vs">select null as admin0_name -- add admin values as nulls</span></span>
<span id="cb97-2702"><a href="#cb97-2702" aria-hidden="true" tabindex="-1"></a><span class="vs">  , null as admin1_name</span></span>
<span id="cb97-2703"><a href="#cb97-2703" aria-hidden="true" tabindex="-1"></a><span class="vs">  , null as admin2_name</span></span>
<span id="cb97-2704"><a href="#cb97-2704" aria-hidden="true" tabindex="-1"></a><span class="vs">  , *</span></span>
<span id="cb97-2705"><a href="#cb97-2705" aria-hidden="true" tabindex="-1"></a><span class="vs">  from data_tbl</span></span>
<span id="cb97-2706"><a href="#cb97-2706" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-97" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb98" data-startfrom="2710" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2709"><span id="cb98-2710"><a href="#cb98-2710" aria-hidden="true" tabindex="-1"></a>dataHazardAdmin0 <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb98-2711"><a href="#cb98-2711" aria-hidden="true" tabindex="-1"></a><span class="vs">-- admin0 level hazard data</span></span>
<span id="cb98-2712"><a href="#cb98-2712" aria-hidden="true" tabindex="-1"></a><span class="vs">with base as (</span></span>
<span id="cb98-2713"><a href="#cb98-2713" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- chosen scenario and timeframe VoP</span></span>
<span id="cb98-2714"><a href="#cb98-2714" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb98-2715"><a href="#cb98-2715" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb98-2716"><a href="#cb98-2716" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb98-2717"><a href="#cb98-2717" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb98-2718"><a href="#cb98-2718" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb98-2719"><a href="#cb98-2719" aria-hidden="true" tabindex="-1"></a><span class="vs">    , crop</span></span>
<span id="cb98-2720"><a href="#cb98-2720" aria-hidden="true" tabindex="-1"></a><span class="vs">    , threshold</span></span>
<span id="cb98-2721"><a href="#cb98-2721" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb98-2722"><a href="#cb98-2722" aria-hidden="true" tabindex="-1"></a><span class="vs">    , value as vop</span></span>
<span id="cb98-2723"><a href="#cb98-2723" aria-hidden="true" tabindex="-1"></a><span class="vs">    from heat_stress_data</span></span>
<span id="cb98-2724"><a href="#cb98-2724" aria-hidden="true" tabindex="-1"></a><span class="vs">    where timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb98-2725"><a href="#cb98-2725" aria-hidden="true" tabindex="-1"></a><span class="vs">    and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb98-2726"><a href="#cb98-2726" aria-hidden="true" tabindex="-1"></a><span class="vs">    and threshold = '</span><span class="sc">${</span>selectThreshold<span class="op">.</span><span class="at">threshold</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb98-2727"><a href="#cb98-2727" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb98-2728"><a href="#cb98-2728" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-2729"><a href="#cb98-2729" aria-hidden="true" tabindex="-1"></a><span class="vs">select *</span></span>
<span id="cb98-2730"><a href="#cb98-2730" aria-hidden="true" tabindex="-1"></a><span class="vs">  from base</span></span>
<span id="cb98-2731"><a href="#cb98-2731" aria-hidden="true" tabindex="-1"></a><span class="vs">  where admin1_name is null</span></span>
<span id="cb98-2732"><a href="#cb98-2732" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb98-2733"><a href="#cb98-2733" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-98" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb99" data-startfrom="2737" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2736"><span id="cb99-2737"><a href="#cb99-2737" aria-hidden="true" tabindex="-1"></a>dataHazardAdmin1 <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb99-2738"><a href="#cb99-2738" aria-hidden="true" tabindex="-1"></a><span class="vs">-- admin1 level hazard data</span></span>
<span id="cb99-2739"><a href="#cb99-2739" aria-hidden="true" tabindex="-1"></a><span class="vs">with base as (</span></span>
<span id="cb99-2740"><a href="#cb99-2740" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- chosen scenario and timeframe VoP</span></span>
<span id="cb99-2741"><a href="#cb99-2741" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb99-2742"><a href="#cb99-2742" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb99-2743"><a href="#cb99-2743" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb99-2744"><a href="#cb99-2744" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb99-2745"><a href="#cb99-2745" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb99-2746"><a href="#cb99-2746" aria-hidden="true" tabindex="-1"></a><span class="vs">    , crop</span></span>
<span id="cb99-2747"><a href="#cb99-2747" aria-hidden="true" tabindex="-1"></a><span class="vs">    , threshold</span></span>
<span id="cb99-2748"><a href="#cb99-2748" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb99-2749"><a href="#cb99-2749" aria-hidden="true" tabindex="-1"></a><span class="vs">    , value as vop</span></span>
<span id="cb99-2750"><a href="#cb99-2750" aria-hidden="true" tabindex="-1"></a><span class="vs">    from heat_stress_data</span></span>
<span id="cb99-2751"><a href="#cb99-2751" aria-hidden="true" tabindex="-1"></a><span class="vs">    where timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb99-2752"><a href="#cb99-2752" aria-hidden="true" tabindex="-1"></a><span class="vs">    and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb99-2753"><a href="#cb99-2753" aria-hidden="true" tabindex="-1"></a><span class="vs">    and threshold = '</span><span class="sc">${</span>selectThreshold<span class="op">.</span><span class="at">threshold</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb99-2754"><a href="#cb99-2754" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb99-2755"><a href="#cb99-2755" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-2756"><a href="#cb99-2756" aria-hidden="true" tabindex="-1"></a><span class="vs">select *</span></span>
<span id="cb99-2757"><a href="#cb99-2757" aria-hidden="true" tabindex="-1"></a><span class="vs">  from base</span></span>
<span id="cb99-2758"><a href="#cb99-2758" aria-hidden="true" tabindex="-1"></a><span class="vs">  where admin0_name =' </span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb99-2759"><a href="#cb99-2759" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin1_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb99-2760"><a href="#cb99-2760" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin2_name is null</span></span>
<span id="cb99-2761"><a href="#cb99-2761" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-99" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb100" data-startfrom="2765" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2764"><span id="cb100-2765"><a href="#cb100-2765" aria-hidden="true" tabindex="-1"></a>dataHazardAdmin2 <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb100-2766"><a href="#cb100-2766" aria-hidden="true" tabindex="-1"></a><span class="vs">-- admin2 level hazard data</span></span>
<span id="cb100-2767"><a href="#cb100-2767" aria-hidden="true" tabindex="-1"></a><span class="vs">with base as (</span></span>
<span id="cb100-2768"><a href="#cb100-2768" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- chosen scenario and timeframe VoP</span></span>
<span id="cb100-2769"><a href="#cb100-2769" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb100-2770"><a href="#cb100-2770" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb100-2771"><a href="#cb100-2771" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb100-2772"><a href="#cb100-2772" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb100-2773"><a href="#cb100-2773" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb100-2774"><a href="#cb100-2774" aria-hidden="true" tabindex="-1"></a><span class="vs">    , crop</span></span>
<span id="cb100-2775"><a href="#cb100-2775" aria-hidden="true" tabindex="-1"></a><span class="vs">    , threshold</span></span>
<span id="cb100-2776"><a href="#cb100-2776" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb100-2777"><a href="#cb100-2777" aria-hidden="true" tabindex="-1"></a><span class="vs">    , value as vop</span></span>
<span id="cb100-2778"><a href="#cb100-2778" aria-hidden="true" tabindex="-1"></a><span class="vs">    from heat_stress_data</span></span>
<span id="cb100-2779"><a href="#cb100-2779" aria-hidden="true" tabindex="-1"></a><span class="vs">    where timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb100-2780"><a href="#cb100-2780" aria-hidden="true" tabindex="-1"></a><span class="vs">    and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb100-2781"><a href="#cb100-2781" aria-hidden="true" tabindex="-1"></a><span class="vs">    and threshold = '</span><span class="sc">${</span>selectThreshold<span class="op">.</span><span class="at">threshold</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb100-2782"><a href="#cb100-2782" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb100-2783"><a href="#cb100-2783" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-2784"><a href="#cb100-2784" aria-hidden="true" tabindex="-1"></a><span class="vs">select *</span></span>
<span id="cb100-2785"><a href="#cb100-2785" aria-hidden="true" tabindex="-1"></a><span class="vs">  from base</span></span>
<span id="cb100-2786"><a href="#cb100-2786" aria-hidden="true" tabindex="-1"></a><span class="vs">  where admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb100-2787"><a href="#cb100-2787" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin1_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb100-2788"><a href="#cb100-2788" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin2_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb100-2789"><a href="#cb100-2789" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-100" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb101" data-startfrom="2793" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2792"><span id="cb101-2793"><a href="#cb101-2793" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb101-2794"><a href="#cb101-2794" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Helpers`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-101" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb102" data-startfrom="2798" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2797"><span id="cb102-2798"><a href="#cb102-2798" aria-hidden="true" tabindex="-1"></a>helpersHazard <span class="op">=</span> {</span>
<span id="cb102-2799"><a href="#cb102-2799" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb102-2800"><a href="#cb102-2800" aria-hidden="true" tabindex="-1"></a>    <span class="dt">colorDomain</span><span class="op">:</span> [<span class="st">'crop'</span><span class="op">,</span> <span class="st">'livestock'</span>]<span class="op">,</span></span>
<span id="cb102-2801"><a href="#cb102-2801" aria-hidden="true" tabindex="-1"></a>    <span class="dt">colorRange</span><span class="op">:</span> [<span class="st">'seagreen'</span><span class="op">,</span> <span class="st">'sienna'</span>]</span>
<span id="cb102-2802"><a href="#cb102-2802" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-2803"><a href="#cb102-2803" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-102" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb103" data-startfrom="2807" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2806"><span id="cb103-2807"><a href="#cb103-2807" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb103-2808"><a href="#cb103-2808" aria-hidden="true" tabindex="-1"></a><span class="vs">### Dynamic Insights - Heat Stress in Numbers`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-103" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb104" data-startfrom="2812" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2811"><span id="cb104-2812"><a href="#cb104-2812" aria-hidden="true" tabindex="-1"></a>data_selectedHazardCropType <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb104-2813"><a href="#cb104-2813" aria-hidden="true" tabindex="-1"></a>  data_hazardVoP<span class="op">,</span></span>
<span id="cb104-2814"><a href="#cb104-2814" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb104-2815"><a href="#cb104-2815" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span></span>
<span id="cb104-2816"><a href="#cb104-2816" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">scenario</span> <span class="op">===</span> selectScenarioAndTimeframe<span class="op">.</span><span class="at">scenario</span> <span class="op">&amp;&amp;</span></span>
<span id="cb104-2817"><a href="#cb104-2817" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">timeframe</span> <span class="op">===</span> selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span> <span class="op">&amp;&amp;</span></span>
<span id="cb104-2818"><a href="#cb104-2818" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">threshold</span> <span class="op">==</span> selectThreshold<span class="op">.</span><span class="at">threshold</span><span class="op">,</span></span>
<span id="cb104-2819"><a href="#cb104-2819" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb104-2820"><a href="#cb104-2820" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb104-2821"><a href="#cb104-2821" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cropType</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb104-2822"><a href="#cb104-2822" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (riskDataTypes<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">crop</span>)) <span class="cf">return</span> <span class="st">"crop"</span><span class="op">;</span></span>
<span id="cb104-2823"><a href="#cb104-2823" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="st">"other"</span><span class="op">;</span></span>
<span id="cb104-2824"><a href="#cb104-2824" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb104-2825"><a href="#cb104-2825" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cropValue</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="pp">parseFloat</span>(d<span class="op">.</span><span class="at">crop</span>)<span class="op">,</span> <span class="co">// Ensure cropValue is numeric</span></span>
<span id="cb104-2826"><a href="#cb104-2826" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb104-2827"><a href="#cb104-2827" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">arrange</span>([<span class="st">"cropType"</span><span class="op">,</span> T<span class="op">.</span><span class="fu">desc</span>(<span class="st">"vop"</span>)])<span class="op">,</span></span>
<span id="cb104-2828"><a href="#cb104-2828" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-104" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb105" data-startfrom="2832" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2831"><span id="cb105-2832"><a href="#cb105-2832" aria-hidden="true" tabindex="-1"></a><span class="co">// combined crop and livestock exposed for selection</span></span>
<span id="cb105-2833"><a href="#cb105-2833" aria-hidden="true" tabindex="-1"></a>insight_totalExposedVop <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb105-2834"><a href="#cb105-2834" aria-hidden="true" tabindex="-1"></a>  data_selectedHazardCropType<span class="op">,</span></span>
<span id="cb105-2835"><a href="#cb105-2835" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">===</span> <span class="st">"crop"</span>)<span class="op">,</span></span>
<span id="cb105-2836"><a href="#cb105-2836" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb105-2837"><a href="#cb105-2837" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"cropType"</span><span class="op">,</span> <span class="st">"hazard"</span>]<span class="op">,</span></span>
<span id="cb105-2838"><a href="#cb105-2838" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb105-2839"><a href="#cb105-2839" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb105-2840"><a href="#cb105-2840" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalExposedVop</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"vop"</span>)<span class="op">,</span></span>
<span id="cb105-2841"><a href="#cb105-2841" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalExposedVopOver30</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>((d) <span class="kw">=&gt;</span> (d<span class="op">.</span><span class="at">cropValue</span> <span class="op">&gt;=</span> <span class="dv">30</span> <span class="op">?</span> d<span class="op">.</span><span class="at">vop</span> <span class="op">:</span> <span class="dv">0</span>))<span class="op">,</span> <span class="co">// Sum for crops over 30%</span></span>
<span id="cb105-2842"><a href="#cb105-2842" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalExposedVopOver50</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>((d) <span class="kw">=&gt;</span> (d<span class="op">.</span><span class="at">cropValue</span> <span class="op">&gt;=</span> <span class="dv">55</span> <span class="op">?</span> d<span class="op">.</span><span class="at">vop</span> <span class="op">:</span> <span class="dv">0</span>))<span class="op">,</span> <span class="co">// Sum for crops over 50%</span></span>
<span id="cb105-2843"><a href="#cb105-2843" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb105-2844"><a href="#cb105-2844" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb105-2845"><a href="#cb105-2845" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb105-2846"><a href="#cb105-2846" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-105" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb106" data-startfrom="2850" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2849"><span id="cb106-2850"><a href="#cb106-2850" aria-hidden="true" tabindex="-1"></a>insight_topExp <span class="op">=</span> {</span>
<span id="cb106-2851"><a href="#cb106-2851" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> cropsByVop <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb106-2852"><a href="#cb106-2852" aria-hidden="true" tabindex="-1"></a>    data_selectedHazardCropType<span class="op">,</span></span>
<span id="cb106-2853"><a href="#cb106-2853" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">select</span>([<span class="st">"cropType"</span><span class="op">,</span> <span class="st">"crop"</span><span class="op">,</span> <span class="st">"vop"</span><span class="op">,</span> <span class="st">"hazard"</span>])<span class="op">,</span></span>
<span id="cb106-2854"><a href="#cb106-2854" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">==</span> <span class="st">"crop"</span>)</span>
<span id="cb106-2855"><a href="#cb106-2855" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb106-2856"><a href="#cb106-2856" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-2857"><a href="#cb106-2857" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Find the top crop by vop</span></span>
<span id="cb106-2858"><a href="#cb106-2858" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topCrop <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb106-2859"><a href="#cb106-2859" aria-hidden="true" tabindex="-1"></a>    cropsByVop<span class="op">,</span></span>
<span id="cb106-2860"><a href="#cb106-2860" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">sliceMax</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">"vop"</span>)</span>
<span id="cb106-2861"><a href="#cb106-2861" aria-hidden="true" tabindex="-1"></a>  )[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb106-2862"><a href="#cb106-2862" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb106-2863"><a href="#cb106-2863" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the combination, including topCrop only if it's not '30' or '50'</span></span>
<span id="cb106-2864"><a href="#cb106-2864" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [topCrop]<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d <span class="op">!==</span> <span class="kw">undefined</span>)<span class="op">;</span></span>
<span id="cb106-2865"><a href="#cb106-2865" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-106" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb107" data-startfrom="2869" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2868"><span id="cb107-2869"><a href="#cb107-2869" aria-hidden="true" tabindex="-1"></a><span class="co">// total vop exposed by each hazard</span></span>
<span id="cb107-2870"><a href="#cb107-2870" aria-hidden="true" tabindex="-1"></a>insight_rankedHazardVopTotals <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb107-2871"><a href="#cb107-2871" aria-hidden="true" tabindex="-1"></a>  data_hazardVoP<span class="op">,</span></span>
<span id="cb107-2872"><a href="#cb107-2872" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb107-2873"><a href="#cb107-2873" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"hazard"</span>]<span class="op">,</span></span>
<span id="cb107-2874"><a href="#cb107-2874" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb107-2875"><a href="#cb107-2875" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb107-2876"><a href="#cb107-2876" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalVop</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"vop"</span>)<span class="op">,</span></span>
<span id="cb107-2877"><a href="#cb107-2877" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb107-2878"><a href="#cb107-2878" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb107-2879"><a href="#cb107-2879" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb107-2880"><a href="#cb107-2880" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">!==</span> <span class="st">"any"</span>)<span class="op">,</span> <span class="co">// remove combined hazard</span></span>
<span id="cb107-2881"><a href="#cb107-2881" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">arrange</span>(T<span class="op">.</span><span class="fu">desc</span>(<span class="st">"totalVop"</span>))<span class="op">,</span></span>
<span id="cb107-2882"><a href="#cb107-2882" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-107" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb108" data-startfrom="2886" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2885"><span id="cb108-2886"><a href="#cb108-2886" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb108-2887"><a href="#cb108-2887" aria-hidden="true" tabindex="-1"></a><span class="vs">## BarChart - Loss of Safe Working Hours`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-108" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb109" data-startfrom="2891" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2890"><span id="cb109-2891"><a href="#cb109-2891" aria-hidden="true" tabindex="-1"></a><span class="co">// make the bar chart for top crops</span></span>
<span id="cb109-2892"><a href="#cb109-2892" aria-hidden="true" tabindex="-1"></a><span class="co">// approach is passing in data for selected hazard and crop type</span></span>
<span id="cb109-2893"><a href="#cb109-2893" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">makeHourlyBarChart</span>(data) {</span>
<span id="cb109-2894"><a href="#cb109-2894" aria-hidden="true" tabindex="-1"></a>  <span class="co">// if no data is available for selected hazard, show a message</span></span>
<span id="cb109-2895"><a href="#cb109-2895" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (data<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb109-2896"><a href="#cb109-2896" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`*No VoP exposure*`</span><span class="op">;</span></span>
<span id="cb109-2897"><a href="#cb109-2897" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb109-2898"><a href="#cb109-2898" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topN <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb109-2899"><a href="#cb109-2899" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-2900"><a href="#cb109-2900" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb109-2901"><a href="#cb109-2901" aria-hidden="true" tabindex="-1"></a>    width<span class="op">,</span></span>
<span id="cb109-2902"><a href="#cb109-2902" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginLeft</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb109-2903"><a href="#cb109-2903" aria-hidden="true" tabindex="-1"></a>    <span class="dt">caption</span><span class="op">:</span> monetaryVoPNote<span class="op">,</span></span>
<span id="cb109-2904"><a href="#cb109-2904" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb109-2905"><a href="#cb109-2905" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> formatUSD<span class="op">,</span></span>
<span id="cb109-2906"><a href="#cb109-2906" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="st">"VoP at risk ($)"</span><span class="op">,</span></span>
<span id="cb109-2907"><a href="#cb109-2907" aria-hidden="true" tabindex="-1"></a>      <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb109-2908"><a href="#cb109-2908" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb109-2909"><a href="#cb109-2909" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb109-2910"><a href="#cb109-2910" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb109-2911"><a href="#cb109-2911" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb109-2912"><a href="#cb109-2912" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb109-2913"><a href="#cb109-2913" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb109-2914"><a href="#cb109-2914" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> hourlyPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span><span class="op">,</span></span>
<span id="cb109-2915"><a href="#cb109-2915" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> hourlyPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">range</span><span class="op">,</span></span>
<span id="cb109-2916"><a href="#cb109-2916" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb109-2917"><a href="#cb109-2917" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb109-2918"><a href="#cb109-2918" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barX</span>(data<span class="op">,</span> {</span>
<span id="cb109-2919"><a href="#cb109-2919" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"delta"</span><span class="op">,</span></span>
<span id="cb109-2920"><a href="#cb109-2920" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hourlyPlotLookup<span class="op">.</span><span class="at">hours</span>[d<span class="op">.</span><span class="at">hour_day</span>]<span class="op">,</span></span>
<span id="cb109-2921"><a href="#cb109-2921" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hourlyPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]<span class="op">,</span></span>
<span id="cb109-2922"><a href="#cb109-2922" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sort</span><span class="op">:</span> { <span class="dt">y</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">limit</span><span class="op">:</span> <span class="dv">10</span> }<span class="op">,</span></span>
<span id="cb109-2923"><a href="#cb109-2923" aria-hidden="true" tabindex="-1"></a>        <span class="dt">channels</span><span class="op">:</span> {</span>
<span id="cb109-2924"><a href="#cb109-2924" aria-hidden="true" tabindex="-1"></a>          <span class="dt">delta</span><span class="op">:</span> {</span>
<span id="cb109-2925"><a href="#cb109-2925" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span><span class="op">:</span> <span class="st">"VoP at risk"</span><span class="op">,</span></span>
<span id="cb109-2926"><a href="#cb109-2926" aria-hidden="true" tabindex="-1"></a>            <span class="dt">value</span><span class="op">:</span> <span class="st">"delta"</span><span class="op">,</span></span>
<span id="cb109-2927"><a href="#cb109-2927" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb109-2928"><a href="#cb109-2928" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb109-2929"><a href="#cb109-2929" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> {</span>
<span id="cb109-2930"><a href="#cb109-2930" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb109-2931"><a href="#cb109-2931" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb109-2932"><a href="#cb109-2932" aria-hidden="true" tabindex="-1"></a>            <span class="dt">y</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb109-2933"><a href="#cb109-2933" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb109-2934"><a href="#cb109-2934" aria-hidden="true" tabindex="-1"></a>            <span class="dt">delta</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">formatUSD</span>(d)<span class="op">,</span></span>
<span id="cb109-2935"><a href="#cb109-2935" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb109-2936"><a href="#cb109-2936" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb109-2937"><a href="#cb109-2937" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb109-2938"><a href="#cb109-2938" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb109-2939"><a href="#cb109-2939" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb109-2940"><a href="#cb109-2940" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-109" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb110" data-startfrom="2944" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2943"><span id="cb110-2944"><a href="#cb110-2944" aria-hidden="true" tabindex="-1"></a><span class="co">// data for selected hazard scenario, with total vop</span></span>
<span id="cb110-2945"><a href="#cb110-2945" aria-hidden="true" tabindex="-1"></a>data_hourlyStress <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb110-2946"><a href="#cb110-2946" aria-hidden="true" tabindex="-1"></a>  dataHourlySelected<span class="op">,</span></span>
<span id="cb110-2947"><a href="#cb110-2947" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">leftJoin</span>(dataHazardHourlyTotalSelected<span class="op">,</span> {</span>
<span id="cb110-2948"><a href="#cb110-2948" aria-hidden="true" tabindex="-1"></a>    <span class="dt">by</span><span class="op">:</span> [<span class="st">"admin0_name"</span><span class="op">,</span> <span class="st">"admin1_name"</span><span class="op">,</span> <span class="st">"admin2_name"</span><span class="op">,</span> <span class="st">"hour_day"</span>]<span class="op">,</span></span>
<span id="cb110-2949"><a href="#cb110-2949" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb110-2950"><a href="#cb110-2950" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-110" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb111" data-startfrom="2954" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2953"><span id="cb111-2954"><a href="#cb111-2954" aria-hidden="true" tabindex="-1"></a>dataHazardHourlyTotalSelected <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb111-2955"><a href="#cb111-2955" aria-hidden="true" tabindex="-1"></a>  dataHourlySelected<span class="op">,</span></span>
<span id="cb111-2956"><a href="#cb111-2956" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb111-2957"><a href="#cb111-2957" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb111-2958"><a href="#cb111-2958" aria-hidden="true" tabindex="-1"></a>      <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb111-2959"><a href="#cb111-2959" aria-hidden="true" tabindex="-1"></a>      <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb111-2960"><a href="#cb111-2960" aria-hidden="true" tabindex="-1"></a>      <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb111-2961"><a href="#cb111-2961" aria-hidden="true" tabindex="-1"></a>      <span class="st">"threshold"</span><span class="op">,</span></span>
<span id="cb111-2962"><a href="#cb111-2962" aria-hidden="true" tabindex="-1"></a>      <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb111-2963"><a href="#cb111-2963" aria-hidden="true" tabindex="-1"></a>      <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb111-2964"><a href="#cb111-2964" aria-hidden="true" tabindex="-1"></a>      <span class="st">"hour_day"</span><span class="op">,</span></span>
<span id="cb111-2965"><a href="#cb111-2965" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb111-2966"><a href="#cb111-2966" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb111-2967"><a href="#cb111-2967" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb111-2968"><a href="#cb111-2968" aria-hidden="true" tabindex="-1"></a>        <span class="dt">delta_total</span><span class="op">:</span> T<span class="op">.</span><span class="fu">mean</span>(<span class="st">"delta"</span>)<span class="op">,</span></span>
<span id="cb111-2969"><a href="#cb111-2969" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb111-2970"><a href="#cb111-2970" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb111-2971"><a href="#cb111-2971" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb111-2972"><a href="#cb111-2972" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-111" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb112" data-startfrom="2976" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2975"><span id="cb112-2976"><a href="#cb112-2976" aria-hidden="true" tabindex="-1"></a><span class="co">// pick the admin dataset based on admin selection</span></span>
<span id="cb112-2977"><a href="#cb112-2977" aria-hidden="true" tabindex="-1"></a>dataHourlySelected <span class="op">=</span> {</span>
<span id="cb112-2978"><a href="#cb112-2978" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> dataHourlyAdmin2</span>
<span id="cb112-2979"><a href="#cb112-2979" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> dataHourlyAdmin1</span>
<span id="cb112-2980"><a href="#cb112-2980" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> dataHourlyAdmin0</span>
<span id="cb112-2981"><a href="#cb112-2981" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> dataHourlyAdminAll</span>
<span id="cb112-2982"><a href="#cb112-2982" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-112" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb113" data-startfrom="2986" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2985"><span id="cb113-2986"><a href="#cb113-2986" aria-hidden="true" tabindex="-1"></a>dataHourlyAdmin0 <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb113-2987"><a href="#cb113-2987" aria-hidden="true" tabindex="-1"></a><span class="vs">-- admin0 level hazard data</span></span>
<span id="cb113-2988"><a href="#cb113-2988" aria-hidden="true" tabindex="-1"></a><span class="vs">with base as (</span></span>
<span id="cb113-2989"><a href="#cb113-2989" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- chosen scenario and timeframe VoP</span></span>
<span id="cb113-2990"><a href="#cb113-2990" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb113-2991"><a href="#cb113-2991" aria-hidden="true" tabindex="-1"></a><span class="vs">        , admin1_name</span></span>
<span id="cb113-2992"><a href="#cb113-2992" aria-hidden="true" tabindex="-1"></a><span class="vs">        , admin2_name</span></span>
<span id="cb113-2993"><a href="#cb113-2993" aria-hidden="true" tabindex="-1"></a><span class="vs">        , scenario</span></span>
<span id="cb113-2994"><a href="#cb113-2994" aria-hidden="true" tabindex="-1"></a><span class="vs">        , timeframe</span></span>
<span id="cb113-2995"><a href="#cb113-2995" aria-hidden="true" tabindex="-1"></a><span class="vs">        , hour_day</span></span>
<span id="cb113-2996"><a href="#cb113-2996" aria-hidden="true" tabindex="-1"></a><span class="vs">        , threshold</span></span>
<span id="cb113-2997"><a href="#cb113-2997" aria-hidden="true" tabindex="-1"></a><span class="vs">        , hazard</span></span>
<span id="cb113-2998"><a href="#cb113-2998" aria-hidden="true" tabindex="-1"></a><span class="vs">        , period</span></span>
<span id="cb113-2999"><a href="#cb113-2999" aria-hidden="true" tabindex="-1"></a><span class="vs">        , corrected_pop as corrected_pop_sum</span></span>
<span id="cb113-3000"><a href="#cb113-3000" aria-hidden="true" tabindex="-1"></a><span class="vs">        , delta_pop as delta_pop_mean</span></span>
<span id="cb113-3001"><a href="#cb113-3001" aria-hidden="true" tabindex="-1"></a><span class="vs">        , total_days as days_period</span></span>
<span id="cb113-3002"><a href="#cb113-3002" aria-hidden="true" tabindex="-1"></a><span class="vs">        , avg_count as delta</span></span>
<span id="cb113-3003"><a href="#cb113-3003" aria-hidden="true" tabindex="-1"></a><span class="vs">        from hourly_data</span></span>
<span id="cb113-3004"><a href="#cb113-3004" aria-hidden="true" tabindex="-1"></a><span class="vs">        where timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe2<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb113-3005"><a href="#cb113-3005" aria-hidden="true" tabindex="-1"></a><span class="vs">        and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe2<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb113-3006"><a href="#cb113-3006" aria-hidden="true" tabindex="-1"></a><span class="vs">        and threshold = '</span><span class="sc">${</span>selectThreshold2<span class="op">.</span><span class="at">threshold</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb113-3007"><a href="#cb113-3007" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb113-3008"><a href="#cb113-3008" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3009"><a href="#cb113-3009" aria-hidden="true" tabindex="-1"></a><span class="vs">select *</span></span>
<span id="cb113-3010"><a href="#cb113-3010" aria-hidden="true" tabindex="-1"></a><span class="vs">  from base</span></span>
<span id="cb113-3011"><a href="#cb113-3011" aria-hidden="true" tabindex="-1"></a><span class="vs">  where admin1_name is null</span></span>
<span id="cb113-3012"><a href="#cb113-3012" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb113-3013"><a href="#cb113-3013" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-113" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb114" data-startfrom="3017" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3016"><span id="cb114-3017"><a href="#cb114-3017" aria-hidden="true" tabindex="-1"></a>dataHourlyAdmin1 <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb114-3018"><a href="#cb114-3018" aria-hidden="true" tabindex="-1"></a><span class="vs">-- admin1 level hazard data</span></span>
<span id="cb114-3019"><a href="#cb114-3019" aria-hidden="true" tabindex="-1"></a><span class="vs">with base as (</span></span>
<span id="cb114-3020"><a href="#cb114-3020" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- chosen scenario and timeframe VoP</span></span>
<span id="cb114-3021"><a href="#cb114-3021" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb114-3022"><a href="#cb114-3022" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb114-3023"><a href="#cb114-3023" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb114-3024"><a href="#cb114-3024" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb114-3025"><a href="#cb114-3025" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb114-3026"><a href="#cb114-3026" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hour_day</span></span>
<span id="cb114-3027"><a href="#cb114-3027" aria-hidden="true" tabindex="-1"></a><span class="vs">    , threshold</span></span>
<span id="cb114-3028"><a href="#cb114-3028" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb114-3029"><a href="#cb114-3029" aria-hidden="true" tabindex="-1"></a><span class="vs">    , period</span></span>
<span id="cb114-3030"><a href="#cb114-3030" aria-hidden="true" tabindex="-1"></a><span class="vs">    , corrected_pop as corrected_pop_sum</span></span>
<span id="cb114-3031"><a href="#cb114-3031" aria-hidden="true" tabindex="-1"></a><span class="vs">    , delta_pop as delta_pop_mean</span></span>
<span id="cb114-3032"><a href="#cb114-3032" aria-hidden="true" tabindex="-1"></a><span class="vs">    , total_days as days_period</span></span>
<span id="cb114-3033"><a href="#cb114-3033" aria-hidden="true" tabindex="-1"></a><span class="vs">    , avg_count as delta</span></span>
<span id="cb114-3034"><a href="#cb114-3034" aria-hidden="true" tabindex="-1"></a><span class="vs">    from hourly_data</span></span>
<span id="cb114-3035"><a href="#cb114-3035" aria-hidden="true" tabindex="-1"></a><span class="vs">    where timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe2<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb114-3036"><a href="#cb114-3036" aria-hidden="true" tabindex="-1"></a><span class="vs">    and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe2<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb114-3037"><a href="#cb114-3037" aria-hidden="true" tabindex="-1"></a><span class="vs">    and threshold = '</span><span class="sc">${</span>selectThreshold2<span class="op">.</span><span class="at">threshold</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb114-3038"><a href="#cb114-3038" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb114-3039"><a href="#cb114-3039" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3040"><a href="#cb114-3040" aria-hidden="true" tabindex="-1"></a><span class="vs">select *</span></span>
<span id="cb114-3041"><a href="#cb114-3041" aria-hidden="true" tabindex="-1"></a><span class="vs">  from base</span></span>
<span id="cb114-3042"><a href="#cb114-3042" aria-hidden="true" tabindex="-1"></a><span class="vs">  where admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb114-3043"><a href="#cb114-3043" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin1_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb114-3044"><a href="#cb114-3044" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin2_name is null</span></span>
<span id="cb114-3045"><a href="#cb114-3045" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-114" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb115" data-startfrom="3049" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3048"><span id="cb115-3049"><a href="#cb115-3049" aria-hidden="true" tabindex="-1"></a>dataHourlyAdmin2 <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb115-3050"><a href="#cb115-3050" aria-hidden="true" tabindex="-1"></a><span class="vs">-- admin2 level hazard data</span></span>
<span id="cb115-3051"><a href="#cb115-3051" aria-hidden="true" tabindex="-1"></a><span class="vs">with base as (</span></span>
<span id="cb115-3052"><a href="#cb115-3052" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- chosen scenario and timeframe VoP</span></span>
<span id="cb115-3053"><a href="#cb115-3053" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb115-3054"><a href="#cb115-3054" aria-hidden="true" tabindex="-1"></a><span class="vs">        , admin1_name</span></span>
<span id="cb115-3055"><a href="#cb115-3055" aria-hidden="true" tabindex="-1"></a><span class="vs">        , admin2_name</span></span>
<span id="cb115-3056"><a href="#cb115-3056" aria-hidden="true" tabindex="-1"></a><span class="vs">        , scenario</span></span>
<span id="cb115-3057"><a href="#cb115-3057" aria-hidden="true" tabindex="-1"></a><span class="vs">        , timeframe</span></span>
<span id="cb115-3058"><a href="#cb115-3058" aria-hidden="true" tabindex="-1"></a><span class="vs">        , hour_day</span></span>
<span id="cb115-3059"><a href="#cb115-3059" aria-hidden="true" tabindex="-1"></a><span class="vs">        , threshold</span></span>
<span id="cb115-3060"><a href="#cb115-3060" aria-hidden="true" tabindex="-1"></a><span class="vs">        , hazard</span></span>
<span id="cb115-3061"><a href="#cb115-3061" aria-hidden="true" tabindex="-1"></a><span class="vs">        , period</span></span>
<span id="cb115-3062"><a href="#cb115-3062" aria-hidden="true" tabindex="-1"></a><span class="vs">        , corrected_pop as corrected_pop_sum</span></span>
<span id="cb115-3063"><a href="#cb115-3063" aria-hidden="true" tabindex="-1"></a><span class="vs">        , delta_pop as delta_pop_mean</span></span>
<span id="cb115-3064"><a href="#cb115-3064" aria-hidden="true" tabindex="-1"></a><span class="vs">        , total_days as days_period</span></span>
<span id="cb115-3065"><a href="#cb115-3065" aria-hidden="true" tabindex="-1"></a><span class="vs">        , avg_count as delta</span></span>
<span id="cb115-3066"><a href="#cb115-3066" aria-hidden="true" tabindex="-1"></a><span class="vs">    from hourly_data</span></span>
<span id="cb115-3067"><a href="#cb115-3067" aria-hidden="true" tabindex="-1"></a><span class="vs">        where timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe2<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb115-3068"><a href="#cb115-3068" aria-hidden="true" tabindex="-1"></a><span class="vs">        and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe2<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb115-3069"><a href="#cb115-3069" aria-hidden="true" tabindex="-1"></a><span class="vs">        and threshold = '</span><span class="sc">${</span>selectThreshold2<span class="op">.</span><span class="at">threshold</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb115-3070"><a href="#cb115-3070" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb115-3071"><a href="#cb115-3071" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-3072"><a href="#cb115-3072" aria-hidden="true" tabindex="-1"></a><span class="vs">select *</span></span>
<span id="cb115-3073"><a href="#cb115-3073" aria-hidden="true" tabindex="-1"></a><span class="vs">  from base</span></span>
<span id="cb115-3074"><a href="#cb115-3074" aria-hidden="true" tabindex="-1"></a><span class="vs">  where admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb115-3075"><a href="#cb115-3075" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin1_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb115-3076"><a href="#cb115-3076" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin2_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb115-3077"><a href="#cb115-3077" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-115" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb116" data-startfrom="3081" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3080"><span id="cb116-3081"><a href="#cb116-3081" aria-hidden="true" tabindex="-1"></a>dataHourlyAdminAll <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb116-3082"><a href="#cb116-3082" aria-hidden="true" tabindex="-1"></a><span class="vs">-- admin0, combine for Sub-Saharan Africa</span></span>
<span id="cb116-3083"><a href="#cb116-3083" aria-hidden="true" tabindex="-1"></a><span class="vs">with data_tbl as (</span></span>
<span id="cb116-3084"><a href="#cb116-3084" aria-hidden="true" tabindex="-1"></a><span class="vs">  with tbl as (</span></span>
<span id="cb116-3085"><a href="#cb116-3085" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- total for all admin0 regions</span></span>
<span id="cb116-3086"><a href="#cb116-3086" aria-hidden="true" tabindex="-1"></a><span class="vs">    with base as (</span></span>
<span id="cb116-3087"><a href="#cb116-3087" aria-hidden="true" tabindex="-1"></a><span class="vs">      -- chosen scenario and timeframe, VoP</span></span>
<span id="cb116-3088"><a href="#cb116-3088" aria-hidden="true" tabindex="-1"></a><span class="vs">      select admin0_name</span></span>
<span id="cb116-3089"><a href="#cb116-3089" aria-hidden="true" tabindex="-1"></a><span class="vs">        , admin1_name</span></span>
<span id="cb116-3090"><a href="#cb116-3090" aria-hidden="true" tabindex="-1"></a><span class="vs">        , admin2_name</span></span>
<span id="cb116-3091"><a href="#cb116-3091" aria-hidden="true" tabindex="-1"></a><span class="vs">        , scenario</span></span>
<span id="cb116-3092"><a href="#cb116-3092" aria-hidden="true" tabindex="-1"></a><span class="vs">        , timeframe</span></span>
<span id="cb116-3093"><a href="#cb116-3093" aria-hidden="true" tabindex="-1"></a><span class="vs">        , hour_day</span></span>
<span id="cb116-3094"><a href="#cb116-3094" aria-hidden="true" tabindex="-1"></a><span class="vs">        , threshold</span></span>
<span id="cb116-3095"><a href="#cb116-3095" aria-hidden="true" tabindex="-1"></a><span class="vs">        , hazard</span></span>
<span id="cb116-3096"><a href="#cb116-3096" aria-hidden="true" tabindex="-1"></a><span class="vs">        , corrected_pop as corrected_pop_sum</span></span>
<span id="cb116-3097"><a href="#cb116-3097" aria-hidden="true" tabindex="-1"></a><span class="vs">        , delta_pop as delta_pop_mean</span></span>
<span id="cb116-3098"><a href="#cb116-3098" aria-hidden="true" tabindex="-1"></a><span class="vs">        , total_days as days_period</span></span>
<span id="cb116-3099"><a href="#cb116-3099" aria-hidden="true" tabindex="-1"></a><span class="vs">        , avg_count as delta</span></span>
<span id="cb116-3100"><a href="#cb116-3100" aria-hidden="true" tabindex="-1"></a><span class="vs">        from hourly_data</span></span>
<span id="cb116-3101"><a href="#cb116-3101" aria-hidden="true" tabindex="-1"></a><span class="vs">        where timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe2<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb116-3102"><a href="#cb116-3102" aria-hidden="true" tabindex="-1"></a><span class="vs">        and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe2<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb116-3103"><a href="#cb116-3103" aria-hidden="true" tabindex="-1"></a><span class="vs">        and threshold = '</span><span class="sc">${</span>selectThreshold2<span class="op">.</span><span class="at">threshold</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb116-3104"><a href="#cb116-3104" aria-hidden="true" tabindex="-1"></a><span class="vs">    )</span></span>
<span id="cb116-3105"><a href="#cb116-3105" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb116-3106"><a href="#cb116-3106" aria-hidden="true" tabindex="-1"></a><span class="vs">    select *</span></span>
<span id="cb116-3107"><a href="#cb116-3107" aria-hidden="true" tabindex="-1"></a><span class="vs">      from base</span></span>
<span id="cb116-3108"><a href="#cb116-3108" aria-hidden="true" tabindex="-1"></a><span class="vs">      where admin1_name is null</span></span>
<span id="cb116-3109"><a href="#cb116-3109" aria-hidden="true" tabindex="-1"></a><span class="vs">  )</span></span>
<span id="cb116-3110"><a href="#cb116-3110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3111"><a href="#cb116-3111" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total VoP for each crop</span></span>
<span id="cb116-3112"><a href="#cb116-3112" aria-hidden="true" tabindex="-1"></a><span class="vs">  select threshold</span></span>
<span id="cb116-3113"><a href="#cb116-3113" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb116-3114"><a href="#cb116-3114" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb116-3115"><a href="#cb116-3115" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hour_day</span></span>
<span id="cb116-3116"><a href="#cb116-3116" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb116-3117"><a href="#cb116-3117" aria-hidden="true" tabindex="-1"></a><span class="vs">    , SUM(corrected_pop_sum) as corrected_pop_sum</span></span>
<span id="cb116-3118"><a href="#cb116-3118" aria-hidden="true" tabindex="-1"></a><span class="vs">    , MEAN(delta_pop_mean) as delta_pop_mean</span></span>
<span id="cb116-3119"><a href="#cb116-3119" aria-hidden="true" tabindex="-1"></a><span class="vs">    , MEAN(delta) as delta</span></span>
<span id="cb116-3120"><a href="#cb116-3120" aria-hidden="true" tabindex="-1"></a><span class="vs">    , MEAN(days_period) as days_period</span></span>
<span id="cb116-3121"><a href="#cb116-3121" aria-hidden="true" tabindex="-1"></a><span class="vs">    from tbl</span></span>
<span id="cb116-3122"><a href="#cb116-3122" aria-hidden="true" tabindex="-1"></a><span class="vs">    group by scenario</span></span>
<span id="cb116-3123"><a href="#cb116-3123" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb116-3124"><a href="#cb116-3124" aria-hidden="true" tabindex="-1"></a><span class="vs">    , threshold</span></span>
<span id="cb116-3125"><a href="#cb116-3125" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb116-3126"><a href="#cb116-3126" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hour_day</span></span>
<span id="cb116-3127"><a href="#cb116-3127" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb116-3128"><a href="#cb116-3128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-3129"><a href="#cb116-3129" aria-hidden="true" tabindex="-1"></a><span class="vs">select null as admin0_name -- add admin values as nulls</span></span>
<span id="cb116-3130"><a href="#cb116-3130" aria-hidden="true" tabindex="-1"></a><span class="vs">  , null as admin1_name</span></span>
<span id="cb116-3131"><a href="#cb116-3131" aria-hidden="true" tabindex="-1"></a><span class="vs">  , null as admin2_name</span></span>
<span id="cb116-3132"><a href="#cb116-3132" aria-hidden="true" tabindex="-1"></a><span class="vs">  , *</span></span>
<span id="cb116-3133"><a href="#cb116-3133" aria-hidden="true" tabindex="-1"></a><span class="vs">  from data_tbl</span></span>
<span id="cb116-3134"><a href="#cb116-3134" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-116" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb117" data-startfrom="3138" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3137"><span id="cb117-3138"><a href="#cb117-3138" aria-hidden="true" tabindex="-1"></a><span class="co">// lookups for hazard plot</span></span>
<span id="cb117-3139"><a href="#cb117-3139" aria-hidden="true" tabindex="-1"></a>hourlyPlotLookup <span class="op">=</span> {</span>
<span id="cb117-3140"><a href="#cb117-3140" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb117-3141"><a href="#cb117-3141" aria-hidden="true" tabindex="-1"></a>    <span class="dt">names</span><span class="op">:</span> {</span>
<span id="cb117-3142"><a href="#cb117-3142" aria-hidden="true" tabindex="-1"></a>      <span class="dt">planting</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toTitleCase</span>(<span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">seasonTypes</span><span class="op">.</span><span class="at">planting</span>))<span class="op">,</span></span>
<span id="cb117-3143"><a href="#cb117-3143" aria-hidden="true" tabindex="-1"></a>      <span class="dt">harvesting</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toTitleCase</span>(<span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">seasonTypes</span><span class="op">.</span><span class="at">harvesting</span>))</span>
<span id="cb117-3144"><a href="#cb117-3144" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb117-3145"><a href="#cb117-3145" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb117-3146"><a href="#cb117-3146" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb117-3147"><a href="#cb117-3147" aria-hidden="true" tabindex="-1"></a>        Lang<span class="op">.</span><span class="fu">toTitleCase</span>(<span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">seasonTypes</span><span class="op">.</span><span class="at">planting</span>))<span class="op">,</span></span>
<span id="cb117-3148"><a href="#cb117-3148" aria-hidden="true" tabindex="-1"></a>        Lang<span class="op">.</span><span class="fu">toTitleCase</span>(<span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">legends</span><span class="op">.</span><span class="at">seasonTypes</span><span class="op">.</span><span class="at">harvesting</span>))<span class="op">,</span></span>
<span id="cb117-3149"><a href="#cb117-3149" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb117-3150"><a href="#cb117-3150" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> [</span>
<span id="cb117-3151"><a href="#cb117-3151" aria-hidden="true" tabindex="-1"></a>        <span class="co">// red for both</span></span>
<span id="cb117-3152"><a href="#cb117-3152" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#4FB5B7"</span><span class="op">,</span> </span>
<span id="cb117-3153"><a href="#cb117-3153" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#FCC42C"</span><span class="op">,</span></span>
<span id="cb117-3154"><a href="#cb117-3154" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb117-3155"><a href="#cb117-3155" aria-hidden="true" tabindex="-1"></a>      <span class="co">// range: [</span></span>
<span id="cb117-3156"><a href="#cb117-3156" aria-hidden="true" tabindex="-1"></a>      <span class="co">//   "#808000", // Olive Green</span></span>
<span id="cb117-3157"><a href="#cb117-3157" aria-hidden="true" tabindex="-1"></a>      <span class="co">//   "#B5651D", // Light Brown</span></span>
<span id="cb117-3158"><a href="#cb117-3158" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ],</span></span>
<span id="cb117-3159"><a href="#cb117-3159" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb117-3160"><a href="#cb117-3160" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hours</span><span class="op">:</span> hourlyNames<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> obj) <span class="kw">=&gt;</span> {</span>
<span id="cb117-3161"><a href="#cb117-3161" aria-hidden="true" tabindex="-1"></a>      acc[obj<span class="op">.</span><span class="at">hour_day</span>] <span class="op">=</span> obj<span class="op">.</span><span class="at">hourlyName</span><span class="op">;</span></span>
<span id="cb117-3162"><a href="#cb117-3162" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> acc<span class="op">;</span></span>
<span id="cb117-3163"><a href="#cb117-3163" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {})</span>
<span id="cb117-3164"><a href="#cb117-3164" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb117-3165"><a href="#cb117-3165" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-117" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb118" data-startfrom="3169" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3168"><span id="cb118-3169"><a href="#cb118-3169" aria-hidden="true" tabindex="-1"></a><span class="co">// unique crops in the hazard data</span></span>
<span id="cb118-3170"><a href="#cb118-3170" aria-hidden="true" tabindex="-1"></a>hazardHours <span class="op">=</span> {</span>
<span id="cb118-3171"><a href="#cb118-3171" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> query <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`select hour_day</span></span>
<span id="cb118-3172"><a href="#cb118-3172" aria-hidden="true" tabindex="-1"></a><span class="vs">  , count(*) as count</span></span>
<span id="cb118-3173"><a href="#cb118-3173" aria-hidden="true" tabindex="-1"></a><span class="vs">  from hourly_data</span></span>
<span id="cb118-3174"><a href="#cb118-3174" aria-hidden="true" tabindex="-1"></a><span class="vs">  group by 1</span></span>
<span id="cb118-3175"><a href="#cb118-3175" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1`</span>)<span class="op">;</span></span>
<span id="cb118-3176"><a href="#cb118-3176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3177"><a href="#cb118-3177" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> query</span>
<span id="cb118-3178"><a href="#cb118-3178" aria-hidden="true" tabindex="-1"></a> }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-118" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb119" data-startfrom="3182" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3181"><span id="cb119-3182"><a href="#cb119-3182" aria-hidden="true" tabindex="-1"></a><span class="co">// formatting crop names</span></span>
<span id="cb119-3183"><a href="#cb119-3183" aria-hidden="true" tabindex="-1"></a>hourlyNames <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb119-3184"><a href="#cb119-3184" aria-hidden="true" tabindex="-1"></a>  hazardHours<span class="op">,</span></span>
<span id="cb119-3185"><a href="#cb119-3185" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">distinct</span>(<span class="st">"hour_day"</span>)<span class="op">,</span></span>
<span id="cb119-3186"><a href="#cb119-3186" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">select</span>(<span class="st">"hour_day"</span>)<span class="op">,</span></span>
<span id="cb119-3187"><a href="#cb119-3187" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb119-3188"><a href="#cb119-3188" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert to number for sorting</span></span>
<span id="cb119-3189"><a href="#cb119-3189" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hourlyNum</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="pp">parseInt</span>(d<span class="op">.</span><span class="at">hour_day</span><span class="op">,</span> <span class="dv">10</span>)<span class="op">,</span></span>
<span id="cb119-3190"><a href="#cb119-3190" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Determine the type based on the original string format (adjust as needed)</span></span>
<span id="cb119-3191"><a href="#cb119-3191" aria-hidden="true" tabindex="-1"></a>    <span class="dt">type</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (<span class="ss">/_/</span><span class="op">.</span><span class="fu">test</span>(d<span class="op">.</span><span class="at">hour_day</span>) <span class="op">?</span> <span class="st">"livestock"</span> <span class="op">:</span> <span class="st">"hour_day"</span>)<span class="op">,</span></span>
<span id="cb119-3192"><a href="#cb119-3192" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Format the name</span></span>
<span id="cb119-3193"><a href="#cb119-3193" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hourlyName</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb119-3194"><a href="#cb119-3194" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> hourlyName <span class="op">=</span> d<span class="op">.</span><span class="at">hour_day</span><span class="op">;</span></span>
<span id="cb119-3195"><a href="#cb119-3195" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="ss">/_/</span><span class="op">.</span><span class="fu">test</span>(d<span class="op">.</span><span class="at">hour_day</span>))</span>
<span id="cb119-3196"><a href="#cb119-3196" aria-hidden="true" tabindex="-1"></a>        hourlyName <span class="op">=</span> hourlyName<span class="op">.</span><span class="fu">replace</span>(<span class="st">"_"</span><span class="op">,</span> <span class="st">" ("</span>) <span class="op">+</span> <span class="st">")"</span><span class="op">;</span></span>
<span id="cb119-3197"><a href="#cb119-3197" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> hourlyName<span class="op">;</span></span>
<span id="cb119-3198"><a href="#cb119-3198" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb119-3199"><a href="#cb119-3199" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb119-3200"><a href="#cb119-3200" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Use the numeric version of hour for sorting, then remove it from the final result as it's no longer needed</span></span>
<span id="cb119-3201"><a href="#cb119-3201" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">arrange</span>([<span class="st">"type"</span><span class="op">,</span> <span class="st">"hourlyNum"</span>])<span class="op">,</span></span>
<span id="cb119-3202"><a href="#cb119-3202" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">select</span>([<span class="st">"type"</span><span class="op">,</span> <span class="st">"hour_day"</span><span class="op">,</span> <span class="st">"hourlyName"</span>])<span class="op">,</span></span>
<span id="cb119-3203"><a href="#cb119-3203" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-119" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb120" data-startfrom="3207" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3206"><span id="cb120-3207"><a href="#cb120-3207" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`### Dynamic Insights - Loss of Safe Working Hours`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-120" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb121" data-startfrom="3211" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3210"><span id="cb121-3211"><a href="#cb121-3211" aria-hidden="true" tabindex="-1"></a>data_selectedHourly <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb121-3212"><a href="#cb121-3212" aria-hidden="true" tabindex="-1"></a>  data_hourlyStress<span class="op">,</span></span>
<span id="cb121-3213"><a href="#cb121-3213" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb121-3214"><a href="#cb121-3214" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span></span>
<span id="cb121-3215"><a href="#cb121-3215" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">scenario</span> <span class="op">===</span> selectScenarioAndTimeframe2<span class="op">.</span><span class="at">scenario</span> <span class="op">&amp;&amp;</span></span>
<span id="cb121-3216"><a href="#cb121-3216" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">timeframe</span> <span class="op">===</span> selectScenarioAndTimeframe2<span class="op">.</span><span class="at">timeframe</span><span class="op">,</span></span>
<span id="cb121-3217"><a href="#cb121-3217" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb121-3218"><a href="#cb121-3218" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb121-3219"><a href="#cb121-3219" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hour_dayType</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb121-3220"><a href="#cb121-3220" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (hourlyDataTypes<span class="op">.</span><span class="at">hour_day</span><span class="op">.</span><span class="at">hour_day</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">hour_day</span>))</span>
<span id="cb121-3221"><a href="#cb121-3221" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">"hour_day"</span><span class="op">;</span></span>
<span id="cb121-3222"><a href="#cb121-3222" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="st">"other"</span><span class="op">;</span></span>
<span id="cb121-3223"><a href="#cb121-3223" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb121-3224"><a href="#cb121-3224" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hour_dayValue</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="pp">parseFloat</span>(d<span class="op">.</span><span class="at">hour_day</span>)<span class="op">,</span> <span class="co">// Ensure hour_dayValue is numeric</span></span>
<span id="cb121-3225"><a href="#cb121-3225" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb121-3226"><a href="#cb121-3226" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">select</span>([</span>
<span id="cb121-3227"><a href="#cb121-3227" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hour_dayType"</span><span class="op">,</span></span>
<span id="cb121-3228"><a href="#cb121-3228" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hazard"</span><span class="op">,</span></span>
<span id="cb121-3229"><a href="#cb121-3229" aria-hidden="true" tabindex="-1"></a>    <span class="st">"hour_day"</span><span class="op">,</span></span>
<span id="cb121-3230"><a href="#cb121-3230" aria-hidden="true" tabindex="-1"></a>    <span class="st">"delta"</span><span class="op">,</span></span>
<span id="cb121-3231"><a href="#cb121-3231" aria-hidden="true" tabindex="-1"></a>    <span class="st">"period"</span><span class="op">,</span></span>
<span id="cb121-3232"><a href="#cb121-3232" aria-hidden="true" tabindex="-1"></a>    <span class="st">"days_period"</span><span class="op">,</span></span>
<span id="cb121-3233"><a href="#cb121-3233" aria-hidden="true" tabindex="-1"></a>    <span class="st">"corrected_pop_sum"</span><span class="op">,</span></span>
<span id="cb121-3234"><a href="#cb121-3234" aria-hidden="true" tabindex="-1"></a>    <span class="st">"delta_pop_sum"</span><span class="op">,</span></span>
<span id="cb121-3235"><a href="#cb121-3235" aria-hidden="true" tabindex="-1"></a>  ])<span class="op">,</span></span>
<span id="cb121-3236"><a href="#cb121-3236" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">arrange</span>([<span class="st">"hour_dayType"</span><span class="op">,</span> T<span class="op">.</span><span class="fu">desc</span>(<span class="st">"delta"</span>)])<span class="op">,</span></span>
<span id="cb121-3237"><a href="#cb121-3237" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-121" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb122" data-startfrom="3241" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3240"><span id="cb122-3241"><a href="#cb122-3241" aria-hidden="true" tabindex="-1"></a><span class="co">// hourly exposition data</span></span>
<span id="cb122-3242"><a href="#cb122-3242" aria-hidden="true" tabindex="-1"></a>insight_totalExposedHourly <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb122-3243"><a href="#cb122-3243" aria-hidden="true" tabindex="-1"></a>  data_selectedHourly<span class="op">,</span></span>
<span id="cb122-3244"><a href="#cb122-3244" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hour_dayType</span> <span class="op">===</span> <span class="st">"hour_day"</span>)<span class="op">,</span></span>
<span id="cb122-3245"><a href="#cb122-3245" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb122-3246"><a href="#cb122-3246" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"hour_dayType"</span><span class="op">,</span> <span class="st">"hazard"</span>]<span class="op">,</span></span>
<span id="cb122-3247"><a href="#cb122-3247" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb122-3248"><a href="#cb122-3248" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb122-3249"><a href="#cb122-3249" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalExposedHourly</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"delta"</span>)<span class="op">,</span></span>
<span id="cb122-3250"><a href="#cb122-3250" aria-hidden="true" tabindex="-1"></a>        <span class="dt">period</span><span class="op">:</span> T<span class="op">.</span><span class="fu">first</span>(<span class="st">"period"</span>)<span class="op">,</span></span>
<span id="cb122-3251"><a href="#cb122-3251" aria-hidden="true" tabindex="-1"></a>        <span class="dt">days_period</span><span class="op">:</span> T<span class="op">.</span><span class="fu">first</span>(<span class="st">"days_period"</span>)<span class="op">,</span></span>
<span id="cb122-3252"><a href="#cb122-3252" aria-hidden="true" tabindex="-1"></a>        <span class="dt">corrected_pop_sum</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"corrected_pop_sum"</span>)<span class="op">,</span></span>
<span id="cb122-3253"><a href="#cb122-3253" aria-hidden="true" tabindex="-1"></a>        <span class="dt">delta_pop_sum</span><span class="op">:</span> T<span class="op">.</span><span class="fu">mean</span>(<span class="st">"delta_pop_sum"</span>)<span class="op">,</span></span>
<span id="cb122-3254"><a href="#cb122-3254" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb122-3255"><a href="#cb122-3255" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb122-3256"><a href="#cb122-3256" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb122-3257"><a href="#cb122-3257" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-122" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb123" data-startfrom="3261" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3260"><span id="cb123-3261"><a href="#cb123-3261" aria-hidden="true" tabindex="-1"></a>insight_topHourly <span class="op">=</span> {</span>
<span id="cb123-3262"><a href="#cb123-3262" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hoursByDelta <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb123-3263"><a href="#cb123-3263" aria-hidden="true" tabindex="-1"></a>    data_selectedHourly<span class="op">,</span></span>
<span id="cb123-3264"><a href="#cb123-3264" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">select</span>([<span class="st">"hour_dayType"</span><span class="op">,</span> <span class="st">"hour_day"</span><span class="op">,</span> <span class="st">"delta"</span>])<span class="op">,</span></span>
<span id="cb123-3265"><a href="#cb123-3265" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hour_dayType</span> <span class="op">==</span> <span class="st">"hour_day"</span>)</span>
<span id="cb123-3266"><a href="#cb123-3266" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb123-3267"><a href="#cb123-3267" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-3268"><a href="#cb123-3268" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Find the top hour by delta</span></span>
<span id="cb123-3269"><a href="#cb123-3269" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topHour_day <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb123-3270"><a href="#cb123-3270" aria-hidden="true" tabindex="-1"></a>    hoursByDelta<span class="op">,</span></span>
<span id="cb123-3271"><a href="#cb123-3271" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">sliceMax</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">"delta"</span>)</span>
<span id="cb123-3272"><a href="#cb123-3272" aria-hidden="true" tabindex="-1"></a>  )[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb123-3273"><a href="#cb123-3273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb123-3274"><a href="#cb123-3274" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Return the combination, including topCrop only if it's not '30' or '50'</span></span>
<span id="cb123-3275"><a href="#cb123-3275" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [topHour_day]<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d <span class="op">!==</span> <span class="kw">undefined</span>)<span class="op">;</span></span>
<span id="cb123-3276"><a href="#cb123-3276" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-123" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb124" data-startfrom="3280" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3279"><span id="cb124-3280"><a href="#cb124-3280" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`#### Helpers`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-124" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb125" data-startfrom="3284" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3283"><span id="cb125-3284"><a href="#cb125-3284" aria-hidden="true" tabindex="-1"></a>icicle_alias <span class="op">=</span> {</span>
<span id="cb125-3285"><a href="#cb125-3285" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nameMap <span class="op">=</span> {</span>
<span id="cb125-3286"><a href="#cb125-3286" aria-hidden="true" tabindex="-1"></a>    <span class="dt">population</span><span class="op">:</span> <span class="st">"Total Population"</span><span class="op">,</span></span>
<span id="cb125-3287"><a href="#cb125-3287" aria-hidden="true" tabindex="-1"></a>    <span class="dt">poverty0</span><span class="op">:</span> <span class="st">"Low Poverty"</span><span class="op">,</span></span>
<span id="cb125-3288"><a href="#cb125-3288" aria-hidden="true" tabindex="-1"></a>    <span class="dt">poverty1</span><span class="op">:</span> <span class="st">"Moderate Poverty"</span><span class="op">,</span></span>
<span id="cb125-3289"><a href="#cb125-3289" aria-hidden="true" tabindex="-1"></a>    <span class="dt">poverty2</span><span class="op">:</span> <span class="st">"High Poverty"</span><span class="op">,</span></span>
<span id="cb125-3290"><a href="#cb125-3290" aria-hidden="true" tabindex="-1"></a>    <span class="dt">education0</span><span class="op">:</span> <span class="st">"0-1 Years of Education"</span><span class="op">,</span></span>
<span id="cb125-3291"><a href="#cb125-3291" aria-hidden="true" tabindex="-1"></a>    <span class="dt">education1</span><span class="op">:</span> <span class="st">"1-5 Years of Education"</span><span class="op">,</span></span>
<span id="cb125-3292"><a href="#cb125-3292" aria-hidden="true" tabindex="-1"></a>    <span class="dt">education2</span><span class="op">:</span> <span class="st">"5+ Years of Education"</span><span class="op">,</span></span>
<span id="cb125-3293"><a href="#cb125-3293" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gender0</span><span class="op">:</span> <span class="st">"Low Female Empowerment"</span><span class="op">,</span></span>
<span id="cb125-3294"><a href="#cb125-3294" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gender1</span><span class="op">:</span> <span class="st">"Moderate Female Empowerment"</span><span class="op">,</span></span>
<span id="cb125-3295"><a href="#cb125-3295" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gender2</span><span class="op">:</span> <span class="st">"High Female Empowerment"</span></span>
<span id="cb125-3296"><a href="#cb125-3296" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb125-3297"><a href="#cb125-3297" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> nameMap<span class="op">;</span></span>
<span id="cb125-3298"><a href="#cb125-3298" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-125" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb126" data-startfrom="3302" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3301"><span id="cb126-3302"><a href="#cb126-3302" aria-hidden="true" tabindex="-1"></a>partition <span class="op">=</span> (data) <span class="kw">=&gt;</span></span>
<span id="cb126-3303"><a href="#cb126-3303" aria-hidden="true" tabindex="-1"></a>  d3</span>
<span id="cb126-3304"><a href="#cb126-3304" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">partition</span>()</span>
<span id="cb126-3305"><a href="#cb126-3305" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">padding</span>(<span class="dv">1</span>)</span>
<span id="cb126-3306"><a href="#cb126-3306" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">size</span>(narrow <span class="op">?</span> [height<span class="op">,</span> width] <span class="op">:</span> [width<span class="op">,</span> height])(</span>
<span id="cb126-3307"><a href="#cb126-3307" aria-hidden="true" tabindex="-1"></a>    d3</span>
<span id="cb126-3308"><a href="#cb126-3308" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">hierarchy</span>(data)</span>
<span id="cb126-3309"><a href="#cb126-3309" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">sum</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb126-3310"><a href="#cb126-3310" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">value</span> <span class="op">-</span> a<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb126-3311"><a href="#cb126-3311" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-126" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb127" data-startfrom="3315" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3314"><span id="cb127-3315"><a href="#cb127-3315" aria-hidden="true" tabindex="-1"></a>icicle_color <span class="op">=</span> d3</span>
<span id="cb127-3316"><a href="#cb127-3316" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">scaleOrdinal</span>()</span>
<span id="cb127-3317"><a href="#cb127-3317" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([</span>
<span id="cb127-3318"><a href="#cb127-3318" aria-hidden="true" tabindex="-1"></a>    <span class="st">"population"</span><span class="op">,</span></span>
<span id="cb127-3319"><a href="#cb127-3319" aria-hidden="true" tabindex="-1"></a>    <span class="st">"poverty2"</span><span class="op">,</span></span>
<span id="cb127-3320"><a href="#cb127-3320" aria-hidden="true" tabindex="-1"></a>    <span class="st">"poverty1"</span><span class="op">,</span></span>
<span id="cb127-3321"><a href="#cb127-3321" aria-hidden="true" tabindex="-1"></a>    <span class="st">"poverty0"</span><span class="op">,</span></span>
<span id="cb127-3322"><a href="#cb127-3322" aria-hidden="true" tabindex="-1"></a>    <span class="st">"education2"</span><span class="op">,</span></span>
<span id="cb127-3323"><a href="#cb127-3323" aria-hidden="true" tabindex="-1"></a>    <span class="st">"education1"</span><span class="op">,</span></span>
<span id="cb127-3324"><a href="#cb127-3324" aria-hidden="true" tabindex="-1"></a>    <span class="st">"education0"</span><span class="op">,</span></span>
<span id="cb127-3325"><a href="#cb127-3325" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gender2"</span><span class="op">,</span></span>
<span id="cb127-3326"><a href="#cb127-3326" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gender1"</span><span class="op">,</span></span>
<span id="cb127-3327"><a href="#cb127-3327" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gender0"</span><span class="op">,</span></span>
<span id="cb127-3328"><a href="#cb127-3328" aria-hidden="true" tabindex="-1"></a>  ])</span>
<span id="cb127-3329"><a href="#cb127-3329" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([</span>
<span id="cb127-3330"><a href="#cb127-3330" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#efefef"</span><span class="op">,</span></span>
<span id="cb127-3331"><a href="#cb127-3331" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#ec5a47"</span><span class="op">,</span></span>
<span id="cb127-3332"><a href="#cb127-3332" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#fc8a34"</span><span class="op">,</span></span>
<span id="cb127-3333"><a href="#cb127-3333" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#f4bb21"</span><span class="op">,</span></span>
<span id="cb127-3334"><a href="#cb127-3334" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#f4bb21"</span><span class="op">,</span></span>
<span id="cb127-3335"><a href="#cb127-3335" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#fc8a34"</span><span class="op">,</span></span>
<span id="cb127-3336"><a href="#cb127-3336" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#ec5a47"</span><span class="op">,</span></span>
<span id="cb127-3337"><a href="#cb127-3337" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#f4bb21"</span><span class="op">,</span></span>
<span id="cb127-3338"><a href="#cb127-3338" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#fc8a34"</span><span class="op">,</span></span>
<span id="cb127-3339"><a href="#cb127-3339" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#ec5a47"</span><span class="op">,</span></span>
<span id="cb127-3340"><a href="#cb127-3340" aria-hidden="true" tabindex="-1"></a>  ])<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-127" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb128" data-startfrom="3344" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3343"><span id="cb128-3344"><a href="#cb128-3344" aria-hidden="true" tabindex="-1"></a>targetHeight <span class="op">=</span> <span class="dv">350</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-128" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb129" data-startfrom="3348" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3347"><span id="cb129-3348"><a href="#cb129-3348" aria-hidden="true" tabindex="-1"></a>narrowHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-129" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb130" data-startfrom="3352" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3351"><span id="cb130-3352"><a href="#cb130-3352" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> narrow <span class="op">?</span> narrowHeight <span class="op">:</span> targetHeight<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-130" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb131" data-startfrom="3356" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3355"><span id="cb131-3356"><a href="#cb131-3356" aria-hidden="true" tabindex="-1"></a>narrow <span class="op">=</span> width <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-131" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb132" data-startfrom="3360" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3359"><span id="cb132-3360"><a href="#cb132-3360" aria-hidden="true" tabindex="-1"></a>segmentX <span class="op">=</span> (d) <span class="kw">=&gt;</span> (narrow <span class="op">?</span> d<span class="op">.</span><span class="at">y0</span> <span class="op">:</span> d<span class="op">.</span><span class="at">x0</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-132" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb133" data-startfrom="3364" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3363"><span id="cb133-3364"><a href="#cb133-3364" aria-hidden="true" tabindex="-1"></a>segmentY <span class="op">=</span> (d) <span class="kw">=&gt;</span> (narrow <span class="op">?</span> d<span class="op">.</span><span class="at">x0</span> <span class="op">:</span> d<span class="op">.</span><span class="at">y0</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-133" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb134" data-startfrom="3368" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3367"><span id="cb134-3368"><a href="#cb134-3368" aria-hidden="true" tabindex="-1"></a>segmentWidth <span class="op">=</span> (d) <span class="kw">=&gt;</span> (narrow <span class="op">?</span> d<span class="op">.</span><span class="at">y1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">y0</span> <span class="op">:</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">x0</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-134" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb135" data-startfrom="3372" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3371"><span id="cb135-3372"><a href="#cb135-3372" aria-hidden="true" tabindex="-1"></a>segmentHeight <span class="op">=</span> (d) <span class="kw">=&gt;</span> (narrow <span class="op">?</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">x0</span> <span class="op">:</span> d<span class="op">.</span><span class="at">y1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">y0</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-135" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb136" data-startfrom="3376" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3375"><span id="cb136-3376"><a href="#cb136-3376" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">buildHierarchy</span>(csv) {</span>
<span id="cb136-3377"><a href="#cb136-3377" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Helper function that transforms the given CSV into a hierarchical format.</span></span>
<span id="cb136-3378"><a href="#cb136-3378" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> <span class="bu">root</span> <span class="op">=</span> { <span class="dt">name</span><span class="op">:</span> <span class="st">"root"</span><span class="op">,</span> <span class="dt">children</span><span class="op">:</span> [] }<span class="op">;</span></span>
<span id="cb136-3379"><a href="#cb136-3379" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> csv<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb136-3380"><a href="#cb136-3380" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sequence <span class="op">=</span> csv[i][<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb136-3381"><a href="#cb136-3381" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> size <span class="op">=</span> <span class="op">+</span>csv[i][<span class="dv">1</span>]<span class="op">;</span></span>
<span id="cb136-3382"><a href="#cb136-3382" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="pp">isNaN</span>(size)) {</span>
<span id="cb136-3383"><a href="#cb136-3383" aria-hidden="true" tabindex="-1"></a>      <span class="co">// e.g. if this is a header row</span></span>
<span id="cb136-3384"><a href="#cb136-3384" aria-hidden="true" tabindex="-1"></a>      <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb136-3385"><a href="#cb136-3385" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb136-3386"><a href="#cb136-3386" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> parts <span class="op">=</span> sequence<span class="op">.</span><span class="fu">split</span>(<span class="st">"_"</span>)<span class="op">;</span></span>
<span id="cb136-3387"><a href="#cb136-3387" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> currentNode <span class="op">=</span> <span class="bu">root</span><span class="op">;</span></span>
<span id="cb136-3388"><a href="#cb136-3388" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> parts<span class="op">.</span><span class="at">length</span><span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb136-3389"><a href="#cb136-3389" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> children <span class="op">=</span> currentNode[<span class="st">"children"</span>]<span class="op">;</span></span>
<span id="cb136-3390"><a href="#cb136-3390" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> nodeName <span class="op">=</span> parts[j]<span class="op">;</span></span>
<span id="cb136-3391"><a href="#cb136-3391" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> childNode <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb136-3392"><a href="#cb136-3392" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> foundChild <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb136-3393"><a href="#cb136-3393" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Search for existing child with the same name</span></span>
<span id="cb136-3394"><a href="#cb136-3394" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> children<span class="op">.</span><span class="at">length</span><span class="op">;</span> k<span class="op">++</span>) {</span>
<span id="cb136-3395"><a href="#cb136-3395" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (children[k][<span class="st">"name"</span>] <span class="op">===</span> nodeName) {</span>
<span id="cb136-3396"><a href="#cb136-3396" aria-hidden="true" tabindex="-1"></a>          childNode <span class="op">=</span> children[k]<span class="op">;</span></span>
<span id="cb136-3397"><a href="#cb136-3397" aria-hidden="true" tabindex="-1"></a>          foundChild <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb136-3398"><a href="#cb136-3398" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb136-3399"><a href="#cb136-3399" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb136-3400"><a href="#cb136-3400" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb136-3401"><a href="#cb136-3401" aria-hidden="true" tabindex="-1"></a>      <span class="co">// If not found, create a new child node</span></span>
<span id="cb136-3402"><a href="#cb136-3402" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>foundChild) {</span>
<span id="cb136-3403"><a href="#cb136-3403" aria-hidden="true" tabindex="-1"></a>        childNode <span class="op">=</span> { <span class="dt">name</span><span class="op">:</span> nodeName<span class="op">,</span> <span class="dt">children</span><span class="op">:</span> [] }<span class="op">;</span></span>
<span id="cb136-3404"><a href="#cb136-3404" aria-hidden="true" tabindex="-1"></a>        children<span class="op">.</span><span class="fu">push</span>(childNode)<span class="op">;</span></span>
<span id="cb136-3405"><a href="#cb136-3405" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb136-3406"><a href="#cb136-3406" aria-hidden="true" tabindex="-1"></a>      currentNode <span class="op">=</span> childNode<span class="op">;</span></span>
<span id="cb136-3407"><a href="#cb136-3407" aria-hidden="true" tabindex="-1"></a>      <span class="co">// If it's the last part of the sequence, create a leaf node</span></span>
<span id="cb136-3408"><a href="#cb136-3408" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (j <span class="op">===</span> parts<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>) {</span>
<span id="cb136-3409"><a href="#cb136-3409" aria-hidden="true" tabindex="-1"></a>        childNode<span class="op">.</span><span class="at">value</span> <span class="op">=</span> size<span class="op">;</span></span>
<span id="cb136-3410"><a href="#cb136-3410" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb136-3411"><a href="#cb136-3411" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb136-3412"><a href="#cb136-3412" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb136-3413"><a href="#cb136-3413" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">root</span><span class="op">;</span></span>
<span id="cb136-3414"><a href="#cb136-3414" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-136" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb137" data-startfrom="3418" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3417"><span id="cb137-3418"><a href="#cb137-3418" aria-hidden="true" tabindex="-1"></a>breadcrumbWidth <span class="op">=</span> <span class="dv">200</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-137" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb138" data-startfrom="3422" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3421"><span id="cb138-3422"><a href="#cb138-3422" aria-hidden="true" tabindex="-1"></a>breadcrumbHeight <span class="op">=</span> <span class="dv">35</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-138" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb139" data-startfrom="3426" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3425"><span id="cb139-3426"><a href="#cb139-3426" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate a string that describes the points of a breadcrumb SVG polygon.</span></span>
<span id="cb139-3427"><a href="#cb139-3427" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">breadcrumbPoints</span>(d<span class="op">,</span> i) {</span>
<span id="cb139-3428"><a href="#cb139-3428" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tipWidth <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb139-3429"><a href="#cb139-3429" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> points <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb139-3430"><a href="#cb139-3430" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">push</span>(<span class="st">"0,0"</span>)<span class="op">;</span></span>
<span id="cb139-3431"><a href="#cb139-3431" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>breadcrumbWidth<span class="sc">}</span><span class="vs">,0`</span>)<span class="op">;</span></span>
<span id="cb139-3432"><a href="#cb139-3432" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>breadcrumbWidth <span class="op">+</span> tipWidth<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>breadcrumbHeight <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb139-3433"><a href="#cb139-3433" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>breadcrumbWidth<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>breadcrumbHeight<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb139-3434"><a href="#cb139-3434" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">push</span>(<span class="vs">`0,</span><span class="sc">${</span>breadcrumbHeight<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb139-3435"><a href="#cb139-3435" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb139-3436"><a href="#cb139-3436" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Leftmost breadcrumb; don't include 6th vertex.</span></span>
<span id="cb139-3437"><a href="#cb139-3437" aria-hidden="true" tabindex="-1"></a>    points<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>tipWidth<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>breadcrumbHeight <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb139-3438"><a href="#cb139-3438" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb139-3439"><a href="#cb139-3439" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> points<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb139-3440"><a href="#cb139-3440" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-139" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb140" data-startfrom="3444" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3443"><span id="cb140-3444"><a href="#cb140-3444" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`### Tabular data</span></span>
<span id="cb140-3445"><a href="#cb140-3445" aria-hidden="true" tabindex="-1"></a><span class="vs">- **ag_workforce_data**: ag workforce data showing current and projected ag populations under different scenarios and for different years. File: baseline_df_data.parquet.</span></span>
<span id="cb140-3446"><a href="#cb140-3446" aria-hidden="true" tabindex="-1"></a><span class="vs">- **heat_stress_data**: number of ag workders facing different sums of days on a year where WBGT values exceed 30 degrees. File: heat_stress_data.parquet.</span></span>
<span id="cb140-3447"><a href="#cb140-3447" aria-hidden="true" tabindex="-1"></a><span class="vs">- **hourly_data**: percent of hours across seasons (harvesting, planting) that exceed safe WBGT thresholds. File: hourly_data.parquet.</span></span>
<span id="cb140-3448"><a href="#cb140-3448" aria-hidden="true" tabindex="-1"></a><span class="vs">- **population**: population data by admin levels</span></span>
<span id="cb140-3449"><a href="#cb140-3449" aria-hidden="true" tabindex="-1"></a><span class="vs">  - population/population_long.parquet`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-140" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb141" data-startfrom="3453" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3452"><span id="cb141-3453"><a href="#cb141-3453" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> {</span>
<span id="cb141-3454"><a href="#cb141-3454" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> DuckDBClient<span class="op">.</span><span class="fu">of</span>({</span>
<span id="cb141-3455"><a href="#cb141-3455" aria-hidden="true" tabindex="-1"></a>    <span class="dt">population</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"population_long.parquet"</span>)<span class="op">,</span></span>
<span id="cb141-3456"><a href="#cb141-3456" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vop_ha</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"exposure_adm_sum.parquet"</span>)<span class="op">,</span></span>
<span id="cb141-3457"><a href="#cb141-3457" aria-hidden="true" tabindex="-1"></a>    <span class="dt">ag_workforce_data</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"baseline_df_data@16.parquet"</span>)<span class="op">,</span></span>
<span id="cb141-3458"><a href="#cb141-3458" aria-hidden="true" tabindex="-1"></a>    <span class="dt">heat_stress_data</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"heat_stress_data@7.parquet"</span>)<span class="op">,</span></span>
<span id="cb141-3459"><a href="#cb141-3459" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hourly_data</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"hourly_data@20.parquet"</span>)<span class="op">,</span></span>
<span id="cb141-3460"><a href="#cb141-3460" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb141-3461"><a href="#cb141-3461" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-141" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb142" data-startfrom="3465" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3464"><span id="cb142-3465"><a href="#cb142-3465" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`### Geographic data</span></span>
<span id="cb142-3466"><a href="#cb142-3466" aria-hidden="true" tabindex="-1"></a><span class="vs">Geo files were converted to TopoJSON and reduced in complexity before uploading to the notebook, see [Simplify large spatial files](https://observablehq.com/d/258c68ee969e8ed5?collection=@periscopic/ab-atlas) notebook for method.</span></span>
<span id="cb142-3467"><a href="#cb142-3467" aria-hidden="true" tabindex="-1"></a><span class="vs">- **admin0**: broadest level, country boundaries</span></span>
<span id="cb142-3468"><a href="#cb142-3468" aria-hidden="true" tabindex="-1"></a><span class="vs">  - boundaries/atlas-region_admin0_harmonized.geojson</span></span>
<span id="cb142-3469"><a href="#cb142-3469" aria-hidden="true" tabindex="-1"></a><span class="vs">- **admin1**: one level down from admin0, regions within each admin0 region</span></span>
<span id="cb142-3470"><a href="#cb142-3470" aria-hidden="true" tabindex="-1"></a><span class="vs">  - boundaries/atlas-region_admin1_harmonized.geojson</span></span>
<span id="cb142-3471"><a href="#cb142-3471" aria-hidden="true" tabindex="-1"></a><span class="vs">- **admin2**: lowest level, subregions of every admin1 region</span></span>
<span id="cb142-3472"><a href="#cb142-3472" aria-hidden="true" tabindex="-1"></a><span class="vs">  - boundaries/atlas-region_admin2_harmonized.geojson`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-142" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb143" data-startfrom="3476" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3475"><span id="cb143-3476"><a href="#cb143-3476" aria-hidden="true" tabindex="-1"></a>boundaries <span class="op">=</span> {</span>
<span id="cb143-3477"><a href="#cb143-3477" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input0 <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"atlas-region_admin0_harmonized.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb143-3478"><a href="#cb143-3478" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input1 <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"atlas-region_admin1_harmonizedV2@1.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb143-3479"><a href="#cb143-3479" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> input2 <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"atlas-region_admin2_harmonizedV2.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb143-3480"><a href="#cb143-3480" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3481"><a href="#cb143-3481" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> geo <span class="op">=</span> {</span>
<span id="cb143-3482"><a href="#cb143-3482" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin0</span><span class="op">:</span> topojson<span class="op">.</span><span class="fu">feature</span>(input0<span class="op">,</span> input0<span class="op">.</span><span class="at">objects</span>[<span class="st">"atlas-region_admin0_harmonized"</span>])<span class="op">,</span></span>
<span id="cb143-3483"><a href="#cb143-3483" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin1</span><span class="op">:</span> topojson<span class="op">.</span><span class="fu">feature</span>(input1<span class="op">,</span> input1<span class="op">.</span><span class="at">objects</span>[<span class="st">"atlas-region_admin1_harmonizedV2"</span>])<span class="op">,</span></span>
<span id="cb143-3484"><a href="#cb143-3484" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin2</span><span class="op">:</span> topojson<span class="op">.</span><span class="fu">feature</span>(input2<span class="op">,</span> input2<span class="op">.</span><span class="at">objects</span>[<span class="st">"atlas-region_admin2_harmonizedV2"</span>])<span class="op">,</span></span>
<span id="cb143-3485"><a href="#cb143-3485" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb143-3486"><a href="#cb143-3486" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> geo</span>
<span id="cb143-3487"><a href="#cb143-3487" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-143" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb144" data-startfrom="3491" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3490"><span id="cb144-3491"><a href="#cb144-3491" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb144-3492"><a href="#cb144-3492" aria-hidden="true" tabindex="-1"></a><span class="vs">### Risk data grouping</span></span>
<span id="cb144-3493"><a href="#cb144-3493" aria-hidden="true" tabindex="-1"></a><span class="vs">*Lookups for risk data binning, such as hazards and crop types*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-144" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb145" data-startfrom="3497" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3496"><span id="cb145-3497"><a href="#cb145-3497" aria-hidden="true" tabindex="-1"></a><span class="co">// lookup for risk data type groupings</span></span>
<span id="cb145-3498"><a href="#cb145-3498" aria-hidden="true" tabindex="-1"></a><span class="co">// used by inputs and for grouping up data</span></span>
<span id="cb145-3499"><a href="#cb145-3499" aria-hidden="true" tabindex="-1"></a>riskDataTypes <span class="op">=</span> <span class="kw">new</span> <span class="bu">Object</span>({</span>
<span id="cb145-3500"><a href="#cb145-3500" aria-hidden="true" tabindex="-1"></a>  <span class="dt">crop</span><span class="op">:</span> {</span>
<span id="cb145-3501"><a href="#cb145-3501" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crop</span><span class="op">:</span> [</span>
<span id="cb145-3502"><a href="#cb145-3502" aria-hidden="true" tabindex="-1"></a>      <span class="st">"10"</span><span class="op">,</span></span>
<span id="cb145-3503"><a href="#cb145-3503" aria-hidden="true" tabindex="-1"></a>      <span class="st">"15"</span><span class="op">,</span></span>
<span id="cb145-3504"><a href="#cb145-3504" aria-hidden="true" tabindex="-1"></a>      <span class="st">"20"</span><span class="op">,</span></span>
<span id="cb145-3505"><a href="#cb145-3505" aria-hidden="true" tabindex="-1"></a>      <span class="st">"25"</span><span class="op">,</span></span>
<span id="cb145-3506"><a href="#cb145-3506" aria-hidden="true" tabindex="-1"></a>      <span class="st">"30"</span><span class="op">,</span></span>
<span id="cb145-3507"><a href="#cb145-3507" aria-hidden="true" tabindex="-1"></a>      <span class="st">"35"</span><span class="op">,</span></span>
<span id="cb145-3508"><a href="#cb145-3508" aria-hidden="true" tabindex="-1"></a>      <span class="st">"40"</span><span class="op">,</span></span>
<span id="cb145-3509"><a href="#cb145-3509" aria-hidden="true" tabindex="-1"></a>      <span class="st">"45"</span><span class="op">,</span></span>
<span id="cb145-3510"><a href="#cb145-3510" aria-hidden="true" tabindex="-1"></a>      <span class="st">"50"</span><span class="op">,</span></span>
<span id="cb145-3511"><a href="#cb145-3511" aria-hidden="true" tabindex="-1"></a>      <span class="st">"55"</span><span class="op">,</span></span>
<span id="cb145-3512"><a href="#cb145-3512" aria-hidden="true" tabindex="-1"></a>      <span class="st">"60"</span><span class="op">,</span></span>
<span id="cb145-3513"><a href="#cb145-3513" aria-hidden="true" tabindex="-1"></a>      <span class="st">"65"</span><span class="op">,</span></span>
<span id="cb145-3514"><a href="#cb145-3514" aria-hidden="true" tabindex="-1"></a>      <span class="st">"70"</span><span class="op">,</span></span>
<span id="cb145-3515"><a href="#cb145-3515" aria-hidden="true" tabindex="-1"></a>      <span class="st">"75"</span><span class="op">,</span></span>
<span id="cb145-3516"><a href="#cb145-3516" aria-hidden="true" tabindex="-1"></a>      <span class="st">"80"</span><span class="op">,</span></span>
<span id="cb145-3517"><a href="#cb145-3517" aria-hidden="true" tabindex="-1"></a>      <span class="st">"85"</span><span class="op">,</span></span>
<span id="cb145-3518"><a href="#cb145-3518" aria-hidden="true" tabindex="-1"></a>      <span class="st">"90"</span><span class="op">,</span></span>
<span id="cb145-3519"><a href="#cb145-3519" aria-hidden="true" tabindex="-1"></a>      <span class="st">"95"</span><span class="op">,</span></span>
<span id="cb145-3520"><a href="#cb145-3520" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb145-3521"><a href="#cb145-3521" aria-hidden="true" tabindex="-1"></a>    <span class="dt">livestock</span><span class="op">:</span> [</span>
<span id="cb145-3522"><a href="#cb145-3522" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cattle_highland"</span><span class="op">,</span></span>
<span id="cb145-3523"><a href="#cb145-3523" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cattle_tropical"</span><span class="op">,</span></span>
<span id="cb145-3524"><a href="#cb145-3524" aria-hidden="true" tabindex="-1"></a>      <span class="st">"goats_highland"</span><span class="op">,</span></span>
<span id="cb145-3525"><a href="#cb145-3525" aria-hidden="true" tabindex="-1"></a>      <span class="st">"goats_tropical"</span><span class="op">,</span></span>
<span id="cb145-3526"><a href="#cb145-3526" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pigs_highland"</span><span class="op">,</span></span>
<span id="cb145-3527"><a href="#cb145-3527" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pigs_tropical"</span><span class="op">,</span></span>
<span id="cb145-3528"><a href="#cb145-3528" aria-hidden="true" tabindex="-1"></a>      <span class="st">"poultry_highland"</span><span class="op">,</span></span>
<span id="cb145-3529"><a href="#cb145-3529" aria-hidden="true" tabindex="-1"></a>      <span class="st">"poultry_tropical"</span><span class="op">,</span></span>
<span id="cb145-3530"><a href="#cb145-3530" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sheep_highland"</span><span class="op">,</span></span>
<span id="cb145-3531"><a href="#cb145-3531" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sheep_tropical"</span><span class="op">,</span></span>
<span id="cb145-3532"><a href="#cb145-3532" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb145-3533"><a href="#cb145-3533" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb145-3534"><a href="#cb145-3534" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-145" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb146" data-startfrom="3538" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3537"><span id="cb146-3538"><a href="#cb146-3538" aria-hidden="true" tabindex="-1"></a><span class="co">// lookup for hourly data type groupings</span></span>
<span id="cb146-3539"><a href="#cb146-3539" aria-hidden="true" tabindex="-1"></a><span class="co">// used by inputs and for grouping up data</span></span>
<span id="cb146-3540"><a href="#cb146-3540" aria-hidden="true" tabindex="-1"></a>hourlyDataTypes <span class="op">=</span> <span class="kw">new</span> <span class="bu">Object</span>({</span>
<span id="cb146-3541"><a href="#cb146-3541" aria-hidden="true" tabindex="-1"></a>  <span class="dt">hour_day</span><span class="op">:</span> {</span>
<span id="cb146-3542"><a href="#cb146-3542" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hour_day</span><span class="op">:</span> [</span>
<span id="cb146-3543"><a href="#cb146-3543" aria-hidden="true" tabindex="-1"></a>      <span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">12</span><span class="op">,</span> <span class="dv">13</span><span class="op">,</span> <span class="dv">14</span><span class="op">,</span> <span class="dv">15</span><span class="op">,</span> <span class="dv">16</span><span class="op">,</span> <span class="dv">17</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">19</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb146-3544"><a href="#cb146-3544" aria-hidden="true" tabindex="-1"></a>      <span class="dv">21</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">23</span><span class="op">,</span></span>
<span id="cb146-3545"><a href="#cb146-3545" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb146-3546"><a href="#cb146-3546" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb146-3547"><a href="#cb146-3547" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-146" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb147" data-startfrom="3551" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3550"><span id="cb147-3551"><a href="#cb147-3551" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb147-3552"><a href="#cb147-3552" aria-hidden="true" tabindex="-1"></a><span class="vs">### Dynamic insights</span></span>
<span id="cb147-3553"><a href="#cb147-3553" aria-hidden="true" tabindex="-1"></a><span class="vs">*functions for formatting results*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-147" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb148" data-startfrom="3557" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3556"><span id="cb148-3557"><a href="#cb148-3557" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">filterByAdminNames</span>(data) {</span>
<span id="cb148-3558"><a href="#cb148-3558" aria-hidden="true" tabindex="-1"></a>  <span class="co">// filter down data by combined selected admin0/admin1/admin2 Admin Selections</span></span>
<span id="cb148-3559"><a href="#cb148-3559" aria-hidden="true" tabindex="-1"></a>  <span class="co">// pass data from query, use tidyjs to filter by admin selection</span></span>
<span id="cb148-3560"><a href="#cb148-3560" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> result <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb148-3561"><a href="#cb148-3561" aria-hidden="true" tabindex="-1"></a>    data<span class="op">,</span></span>
<span id="cb148-3562"><a href="#cb148-3562" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb148-3563"><a href="#cb148-3563" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> (</span>
<span id="cb148-3564"><a href="#cb148-3564" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span> <span class="op">&amp;&amp;</span></span>
<span id="cb148-3565"><a href="#cb148-3565" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">admin1_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span> <span class="op">&amp;&amp;</span></span>
<span id="cb148-3566"><a href="#cb148-3566" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">admin2_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb148-3567"><a href="#cb148-3567" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb148-3568"><a href="#cb148-3568" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb148-3569"><a href="#cb148-3569" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb148-3570"><a href="#cb148-3570" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb148-3571"><a href="#cb148-3571" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-148" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb149" data-startfrom="3575" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3574"><span id="cb149-3575"><a href="#cb149-3575" aria-hidden="true" tabindex="-1"></a><span class="co">// wrapper for format functions, show chosen default</span></span>
<span id="cb149-3576"><a href="#cb149-3576" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb149-3577"><a href="#cb149-3577" aria-hidden="true" tabindex="-1"></a>  value <span class="op">=</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb149-3578"><a href="#cb149-3578" aria-hidden="true" tabindex="-1"></a>  format <span class="op">=</span> (d) <span class="kw">=&gt;</span> d<span class="op">,</span></span>
<span id="cb149-3579"><a href="#cb149-3579" aria-hidden="true" tabindex="-1"></a>  defaultValue <span class="op">=</span> <span class="st">"---"</span><span class="op">,</span></span>
<span id="cb149-3580"><a href="#cb149-3580" aria-hidden="true" tabindex="-1"></a>  debug <span class="op">=</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb149-3581"><a href="#cb149-3581" aria-hidden="true" tabindex="-1"></a>} <span class="op">=</span> {}) {</span>
<span id="cb149-3582"><a href="#cb149-3582" aria-hidden="true" tabindex="-1"></a>  <span class="co">// apply a formatting function to a value</span></span>
<span id="cb149-3583"><a href="#cb149-3583" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return default value if undefined or null</span></span>
<span id="cb149-3584"><a href="#cb149-3584" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>(value <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> value <span class="op">===</span> <span class="kw">undefined</span>)) {</span>
<span id="cb149-3585"><a href="#cb149-3585" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">format</span>(value)<span class="op">;</span></span>
<span id="cb149-3586"><a href="#cb149-3586" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb149-3587"><a href="#cb149-3587" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> defaultValue<span class="op">;</span></span>
<span id="cb149-3588"><a href="#cb149-3588" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb149-3589"><a href="#cb149-3589" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-149" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb150" data-startfrom="3593" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3592"><span id="cb150-3593"><a href="#cb150-3593" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb150-3594"><a href="#cb150-3594" aria-hidden="true" tabindex="-1"></a><span class="vs">### Data functions: format and transform</span></span>
<span id="cb150-3595"><a href="#cb150-3595" aria-hidden="true" tabindex="-1"></a><span class="vs">*apply formatting to/transform a value*</span></span>
<span id="cb150-3596"><a href="#cb150-3596" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-3597"><a href="#cb150-3597" aria-hidden="true" tabindex="-1"></a><span class="vs">- Reference: [Intl.NumberFormat()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat/NumberFormat)`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-150" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb151" data-startfrom="3601" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3600"><span id="cb151-3601"><a href="#cb151-3601" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`**Transforms**`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-151" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb152" data-startfrom="3605" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3604"><span id="cb152-3605"><a href="#cb152-3605" aria-hidden="true" tabindex="-1"></a><span class="co">// transform non-number to percent value</span></span>
<span id="cb152-3606"><a href="#cb152-3606" aria-hidden="true" tabindex="-1"></a>transformPercent <span class="op">=</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb152-3607"><a href="#cb152-3607" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d <span class="op">===</span> <span class="kw">undefined</span> <span class="op">||</span> d <span class="op">===</span> <span class="kw">null</span>) <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb152-3608"><a href="#cb152-3608" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> d <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb152-3609"><a href="#cb152-3609" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-152" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb153" data-startfrom="3613" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3612"><span id="cb153-3613"><a href="#cb153-3613" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`**Formatting**`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-153" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb154" data-startfrom="3617" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3616"><span id="cb154-3617"><a href="#cb154-3617" aria-hidden="true" tabindex="-1"></a><span class="co">// format non-number as percent</span></span>
<span id="cb154-3618"><a href="#cb154-3618" aria-hidden="true" tabindex="-1"></a>formatPercentTenth <span class="op">=</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb154-3619"><a href="#cb154-3619" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d <span class="op">===</span> <span class="kw">undefined</span> <span class="op">||</span> d <span class="op">===</span> <span class="kw">null</span>) <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb154-3620"><a href="#cb154-3620" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".1%"</span>)(d)<span class="op">;</span></span>
<span id="cb154-3621"><a href="#cb154-3621" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-154" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb155" data-startfrom="3625" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3624"><span id="cb155-3625"><a href="#cb155-3625" aria-hidden="true" tabindex="-1"></a><span class="co">// format non-number as percent</span></span>
<span id="cb155-3626"><a href="#cb155-3626" aria-hidden="true" tabindex="-1"></a>formatPercentWhole <span class="op">=</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb155-3627"><a href="#cb155-3627" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d <span class="op">===</span> <span class="kw">undefined</span> <span class="op">||</span> d <span class="op">===</span> <span class="kw">null</span>) <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb155-3628"><a href="#cb155-3628" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".0%"</span>)(d)<span class="op">;</span></span>
<span id="cb155-3629"><a href="#cb155-3629" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-155" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb156" data-startfrom="3633" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3632"><span id="cb156-3633"><a href="#cb156-3633" aria-hidden="true" tabindex="-1"></a><span class="co">// format US currency</span></span>
<span id="cb156-3634"><a href="#cb156-3634" aria-hidden="true" tabindex="-1"></a>formatUSD <span class="op">=</span> <span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(<span class="st">"en-US"</span><span class="op">,</span> {</span>
<span id="cb156-3635"><a href="#cb156-3635" aria-hidden="true" tabindex="-1"></a>  <span class="dt">notation</span><span class="op">:</span> <span class="st">"compact"</span><span class="op">,</span></span>
<span id="cb156-3636"><a href="#cb156-3636" aria-hidden="true" tabindex="-1"></a>  <span class="dt">compactDisplay</span><span class="op">:</span> <span class="st">"short"</span><span class="op">,</span></span>
<span id="cb156-3637"><a href="#cb156-3637" aria-hidden="true" tabindex="-1"></a>  <span class="dt">style</span><span class="op">:</span> <span class="st">"currency"</span><span class="op">,</span></span>
<span id="cb156-3638"><a href="#cb156-3638" aria-hidden="true" tabindex="-1"></a>  <span class="dt">currency</span><span class="op">:</span> <span class="st">"usd"</span><span class="op">,</span></span>
<span id="cb156-3639"><a href="#cb156-3639" aria-hidden="true" tabindex="-1"></a>})<span class="op">.</span><span class="at">format</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-156" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb157" data-startfrom="3643" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3642"><span id="cb157-3643"><a href="#cb157-3643" aria-hidden="true" tabindex="-1"></a><span class="co">// format number, long notation</span></span>
<span id="cb157-3644"><a href="#cb157-3644" aria-hidden="true" tabindex="-1"></a>formatNumCompactLong <span class="op">=</span> ({ locale <span class="op">=</span> <span class="st">"en-US"</span> } <span class="op">=</span> {}) <span class="kw">=&gt;</span></span>
<span id="cb157-3645"><a href="#cb157-3645" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(locale<span class="op">,</span> {</span>
<span id="cb157-3646"><a href="#cb157-3646" aria-hidden="true" tabindex="-1"></a>    <span class="dt">notation</span><span class="op">:</span> <span class="st">"compact"</span><span class="op">,</span></span>
<span id="cb157-3647"><a href="#cb157-3647" aria-hidden="true" tabindex="-1"></a>    <span class="dt">compactDisplay</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb157-3648"><a href="#cb157-3648" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unitDisplay</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb157-3649"><a href="#cb157-3649" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="at">format</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-157" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb158" data-startfrom="3653" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3652"><span id="cb158-3653"><a href="#cb158-3653" aria-hidden="true" tabindex="-1"></a><span class="co">// format number, short notation</span></span>
<span id="cb158-3654"><a href="#cb158-3654" aria-hidden="true" tabindex="-1"></a>formatNumCompactShort <span class="op">=</span> ({ locale <span class="op">=</span> <span class="st">"en-US"</span> } <span class="op">=</span> {}) <span class="kw">=&gt;</span></span>
<span id="cb158-3655"><a href="#cb158-3655" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(locale<span class="op">,</span> {</span>
<span id="cb158-3656"><a href="#cb158-3656" aria-hidden="true" tabindex="-1"></a>    <span class="dt">notation</span><span class="op">:</span> <span class="st">"compact"</span><span class="op">,</span></span>
<span id="cb158-3657"><a href="#cb158-3657" aria-hidden="true" tabindex="-1"></a>    <span class="dt">compactDisplay</span><span class="op">:</span> <span class="st">"short"</span><span class="op">,</span></span>
<span id="cb158-3658"><a href="#cb158-3658" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="at">format</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-158" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb159" data-startfrom="3662" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3661"><span id="cb159-3662"><a href="#cb159-3662" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb159-3663"><a href="#cb159-3663" aria-hidden="true" tabindex="-1"></a><span class="vs">### Querying data</span></span>
<span id="cb159-3664"><a href="#cb159-3664" aria-hidden="true" tabindex="-1"></a><span class="vs">*functions for querying data*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-159" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb160" data-startfrom="3668" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3667"><span id="cb160-3668"><a href="#cb160-3668" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getUniqueValues</span>(col<span class="op">,</span> tbl<span class="op">,</span> db) {</span>
<span id="cb160-3669"><a href="#cb160-3669" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return unique values of from db tbl as a list</span></span>
<span id="cb160-3670"><a href="#cb160-3670" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> db</span>
<span id="cb160-3671"><a href="#cb160-3671" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">query</span>(<span class="vs">`select distinct </span><span class="sc">${</span>col<span class="sc">}</span><span class="vs"> from </span><span class="sc">${</span>tbl<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb160-3672"><a href="#cb160-3672" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">then</span>((x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d[col]))<span class="op">;</span></span>
<span id="cb160-3673"><a href="#cb160-3673" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-160" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb161" data-startfrom="3677" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3676"><span id="cb161-3677"><a href="#cb161-3677" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bindTabularToGeo</span>({</span>
<span id="cb161-3678"><a href="#cb161-3678" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> []<span class="op">,</span></span>
<span id="cb161-3679"><a href="#cb161-3679" aria-hidden="true" tabindex="-1"></a>  dataBindColumn <span class="op">=</span> <span class="st">"dataBindColumn"</span><span class="op">,</span></span>
<span id="cb161-3680"><a href="#cb161-3680" aria-hidden="true" tabindex="-1"></a>  geoData <span class="op">=</span> []<span class="op">,</span></span>
<span id="cb161-3681"><a href="#cb161-3681" aria-hidden="true" tabindex="-1"></a>  geoDataBindColumn <span class="op">=</span> <span class="st">"geoDataBindColumn"</span><span class="op">,</span></span>
<span id="cb161-3682"><a href="#cb161-3682" aria-hidden="true" tabindex="-1"></a>}) {</span>
<span id="cb161-3683"><a href="#cb161-3683" aria-hidden="true" tabindex="-1"></a>  <span class="co">// bind data to geojson</span></span>
<span id="cb161-3684"><a href="#cb161-3684" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> index <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>(data<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d[dataBindColumn]<span class="op">,</span> d]))<span class="op">;</span> <span class="co">// map data by dataBindColumn</span></span>
<span id="cb161-3685"><a href="#cb161-3685" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> geojson <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(geoData))<span class="op">;</span> <span class="co">// do a copy, rather than mutate</span></span>
<span id="cb161-3686"><a href="#cb161-3686" aria-hidden="true" tabindex="-1"></a>  <span class="co">// join up data to geojson</span></span>
<span id="cb161-3687"><a href="#cb161-3687" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> f <span class="kw">of</span> geojson<span class="op">.</span><span class="at">features</span>) {</span>
<span id="cb161-3688"><a href="#cb161-3688" aria-hidden="true" tabindex="-1"></a>    f<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span> <span class="op">=</span> index<span class="op">.</span><span class="fu">get</span>(f<span class="op">.</span><span class="at">properties</span>[geoDataBindColumn])<span class="op">;</span></span>
<span id="cb161-3689"><a href="#cb161-3689" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb161-3690"><a href="#cb161-3690" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> geojson<span class="op">;</span></span>
<span id="cb161-3691"><a href="#cb161-3691" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-161" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb162" data-startfrom="3695" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3694"><span id="cb162-3695"><a href="#cb162-3695" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`***</span></span>
<span id="cb162-3696"><a href="#cb162-3696" aria-hidden="true" tabindex="-1"></a><span class="vs">## Imports</span></span>
<span id="cb162-3697"><a href="#cb162-3697" aria-hidden="true" tabindex="-1"></a><span class="vs">*External imports*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-162" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb163" data-startfrom="3701" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3700"><span id="cb163-3701"><a href="#cb163-3701" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { T } <span class="im">from</span> <span class="st">"@pbeshai/tidyjs"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-163" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb164" data-startfrom="3705" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3704"><span id="cb164-3705"><a href="#cb164-3705" aria-hidden="true" tabindex="-1"></a>selectGeoDataType<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-164" data-nodetype="expression"></div></div></div></section></main><script type="ojs-module-contents">eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7IGhlcm9JbWFnZSB9IGZyb20gXCIvaGVscGVycy9oZXJvLmpzXCI7XG5oZXJvX3VybCA9IFwiLi8uLi8uLi9pbWFnZXMvaHNoLndlYnBcIjtcblxuaGVybyA9IGhlcm9JbWFnZShub3RlYm9va1RpdGxlLCBoZXJvX3VybCk7XG5odG1sYCR7aGVyb31gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW1wb3J0IHsgYXRsYXNUT0MgfSBmcm9tICcvaGVscGVycy90b2Mub2pzJyBcbntcbiAgYXdhaXQgbmJUZXh0IC8vIGZvcmNlIHdhaXQvcmVsb2FkIHdpdGggbmJUZXh0IHRvIGxvYWQgc28gaGVhZGluZ3MgaGF2ZSBjb3JyZWN0IGxhYmVscy9sYW5ndWFnZXNcbiAgcmV0dXJuIGF0bGFzVE9DKHtcbiAgICAgIGhlYWRpbmc6IGA8Yj4ke19sYW5nKHtlbjpcIkluIHRoaXMgbm90ZWJvb2tcIiwgZnI6XCJEYW5zIGNlIG5vdGVib29rXCJ9KX08L2I+YCxcbiAgICAgIHNraXA6IFtub3RlYm9va1RpdGxlLCBcIm5vdGVib29rLXRpdGxlXCIsIFwiQXBwZW5kaXhcIiwgXCJzb3VyY2UtY29kZVwiXVxuICAgICAgfSlcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHByZXR0eSB2aWV3IG9mIGxhbmd1YWdlIHRvZ2dsZVxudmlld29mIHByZXR0eUxhbmd1YWdlVmlldyA9IHtcbiAgcmV0dXJuIElucHV0cy5iaW5kKFxuICAgIElucHV0cy5yYWRpbyhsYW5ndWFnZXMsIHtcbiAgICAgIGxhYmVsOiBfbGFuZyhuYlRleHQubGVnZW5kcy5sYW5ndWFnZSksXG4gICAgICBmb3JtYXQ6IChkKSA9PiBkLmxhYmVsXG4gICAgfSksXG4gICAgdmlld29mIGxhbmd1YWdlXG4gICk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAjICR7X2xhbmcobmJUZXh0LnNlY3Rpb25zLm92ZXJ2aWV3LnRpdGxlKX1cblxuJHtfbGFuZyhuYlRleHQuc2VjdGlvbnMub3ZlcnZpZXcuaW50cm8pfWA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAjICR7X2xhbmcobmJUZXh0LnNlY3Rpb25zLmZ1dHVyZVdvcmtmb3JjZS50aXRsZSl9XG5cbiR7X2xhbmcobmJUZXh0LnNlY3Rpb25zLmZ1dHVyZVdvcmtmb3JjZS5pbnRybyl9YDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGZvcm1hdCBhZG1pbiBzZWxlY3Rpb25zXG4vLyBiaW5kIHRvIGFwcGVuZGl4IGlucHV0cywgYWRkIHRlbXBsYXRlIHRvIGZvcm1hdFxuZ2VvSW1wYWN0QWRtaW5TZWxlY3RvcnMgPSBJbnB1dHMuZm9ybShcbiAgW1xuICAgIElucHV0cy5iaW5kKFxuICAgICAgSW5wdXRzLnNlbGVjdChkYXRhQWRtaW4wLCB7IGxhYmVsOiBhZG1pblJlZ2lvbnMubGFiZWxzLmFkbWluMCwgZm9ybWF0OiB4ID0+IHgubGFiZWwgfSksXG4gICAgICB2aWV3b2Ygc2VsZWN0QWRtaW4wXG4gICAgKSxcbiAgICBJbnB1dHMuYmluZChcbiAgICAgIElucHV0cy5zZWxlY3QoZGF0YUFkbWluMSwgeyBsYWJlbDogYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjEsIGZvcm1hdDogeCA9PiB4LmxhYmVsIH0pLFxuICAgICAgdmlld29mIHNlbGVjdEFkbWluMVxuICAgICksXG4gICAgSW5wdXRzLmJpbmQoXG4gICAgICBJbnB1dHMuc2VsZWN0KGRhdGFBZG1pbjIsIHsgbGFiZWw6IGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4yLCBmb3JtYXQ6IHggPT4geC5sYWJlbCB9KSxcbiAgICAgIHZpZXdvZiBzZWxlY3RBZG1pbjJcbiAgICApXG4gIF0sXG4gIHtcbiAgICB0ZW1wbGF0ZTogYWRtaW5Gb3JtVGVtcGxhdGVcbiAgfVxuKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZGVmaW5lIGNob2ljZXMgZm9yIHRoZSBkYXRhIHZhbHVlXG52aWV3b2Ygc2VsZWN0R2VvRGF0YVR5cGUgPSB7XG4gIGNvbnN0IG9wdGlvbnMgPSBbXG4gICAge1xuICAgICAga2V5OiBcImFnX3dvcmtmb3JjZV9kYXRhXzJcIiwgLy8gbG9va3VwIGlkIGZvciBkYXRhIG9wdGlvblxuICAgICAgZGF0YUNvbHVtbjogXCJjb3JyZWN0ZWRfYWdfcG9wXCIsIC8vIGRhdGEgY29sdW1uXG4gICAgICBsYWJlbDogX2xhbmcobmJUZXh0LnNlY3Rpb25zLmZ1dHVyZVdvcmtmb3JjZS5tYXAubWFwTGF5ZXIudmFsdWVzLmFnX3dvcmtmb3JjZV9kYXRhXzIubGFiZWwpLCAvLyBsYWJlbFxuICAgICAgbGFiZWxUaXA6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YV8yLmxhYmVsVGlwKSwgLy8gbGFiZWwgZm9yIHRvb2x0aXBcbiAgICAgIGxhYmVsTGVnZW5kOiBfbGFuZyhuYlRleHQuc2VjdGlvbnMuZnV0dXJlV29ya2ZvcmNlLm1hcC5tYXBMYXllci52YWx1ZXMuYWdfd29ya2ZvcmNlX2RhdGFfMi5sYWJlbExlZ2VuZCksIC8vIGxhYmVsIGZvciBsZWdlbmRcbiAgICAgIGZvcm1hdEZ1bmM6IGZvcm1hdE51bUNvbXBhY3RTaG9ydCh7bG9jYWxlOiBsYW5ndWFnZS5sb2NhbGV9KSwgLy8gZm9ybWF0dGluZyBmdW5jdGlvbiBmb3IgcmF3IGRhdGEgdmFsdWVcbiAgICAgIGNvbG9yUmFuZ2U6IGNvbG9yU2NhbGVzLnJhbmdlLnllbGxvd0dyZWVuLCAvLyBjb2xvciByYW5nZVxuICAgICAgY29sb3JVbmtub3duOiBjb2xvclNjYWxlcy51bmtub3duLCAvLyB1bmtub3duIGZpbGwgY29sb3IgXG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6IFwiYWdfd29ya2ZvcmNlX2RhdGFfMVwiLFxuICAgICAgZGF0YUNvbHVtbjogXCJhZ3dfdG90YWxfbWlkXCIsXG4gICAgICBsYWJlbDogX2xhbmcobmJUZXh0LnNlY3Rpb25zLmZ1dHVyZVdvcmtmb3JjZS5tYXAubWFwTGF5ZXIudmFsdWVzLmFnX3dvcmtmb3JjZV9kYXRhXzEubGFiZWwpLCBcbiAgICAgIGxhYmVsVGlwOiBfbGFuZyhuYlRleHQuc2VjdGlvbnMuZnV0dXJlV29ya2ZvcmNlLm1hcC5tYXBMYXllci52YWx1ZXMuYWdfd29ya2ZvcmNlX2RhdGFfMS5sYWJlbFRpcCksIFxuICAgICAgbGFiZWxMZWdlbmQ6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YV8xLmxhYmVsTGVnZW5kKSwgXG4gICAgICBmb3JtYXRGdW5jOiBkID0+IGAke2Zvcm1hdE51bUNvbXBhY3RTaG9ydCh7bG9jYWxlOiBsYW5ndWFnZS5sb2NhbGV9KShkKX0lYCxcbiAgICAgIGNvbG9yUmFuZ2U6IGNvbG9yU2NhbGVzLnJhbmdlLnJlZFllbGxvd0dyZWVuLFxuICAgICAgY29sb3JVbmtub3duOiBjb2xvclNjYWxlcy51bmtub3duLFxuICAgIH0sXG4gICAge1xuICAgICAga2V5OiBcImFnX3dvcmtmb3JjZV9kYXRhXCIsXG4gICAgICBkYXRhQ29sdW1uOiBcImFnd190b3RhbFwiLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YS5sYWJlbCksIFxuICAgICAgbGFiZWxUaXA6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YS5sYWJlbFRpcCksIFxuICAgICAgbGFiZWxMZWdlbmQ6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YS5sYWJlbExlZ2VuZCksIFxuICAgICAgZm9ybWF0RnVuYzogZCA9PiBgJHtmb3JtYXROdW1Db21wYWN0U2hvcnQoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSkoZCl9JWAsXG4gICAgICBjb2xvclJhbmdlOiBjb2xvclNjYWxlcy5yYW5nZS5yZWRZZWxsb3dHcmVlbixcbiAgICAgIGNvbG9yVW5rbm93bjogY29sb3JTY2FsZXMudW5rbm93bixcbiAgICB9LFxuICAgIHtcbiAgICAgIGtleTogXCJhZ193b3JrZm9yY2VfZGF0YV8xNVwiLFxuICAgICAgZGF0YUNvbHVtbjogXCJhZ3dfdG90YWxfbWlkX2Fic1wiLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YV8xNS5sYWJlbCksIFxuICAgICAgbGFiZWxUaXA6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YV8xNS5sYWJlbFRpcCksIFxuICAgICAgbGFiZWxMZWdlbmQ6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YV8xNS5sYWJlbExlZ2VuZCksIFxuICAgICAgZm9ybWF0RnVuYzogZm9ybWF0TnVtQ29tcGFjdFNob3J0KHtsb2NhbGU6IGxhbmd1YWdlLmxvY2FsZX0pLFxuICAgICAgY29sb3JSYW5nZTogY29sb3JTY2FsZXMucmFuZ2UueWVsbG93R3JlZW4sXG4gICAgICBjb2xvclVua25vd246IGNvbG9yU2NhbGVzLnVua25vd24sXG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6IFwiYWdfd29ya2ZvcmNlX2RhdGFfMTBcIixcbiAgICAgIGRhdGFDb2x1bW46IFwiYWd3X3RvdGFsX2Fic1wiLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YV8xMC5sYWJlbCksIFxuICAgICAgbGFiZWxUaXA6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YV8xMC5sYWJlbFRpcCksIFxuICAgICAgbGFiZWxMZWdlbmQ6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLm1hcExheWVyLnZhbHVlcy5hZ193b3JrZm9yY2VfZGF0YV8xMC5sYWJlbExlZ2VuZCksIFxuICAgICAgZm9ybWF0RnVuYzogZm9ybWF0TnVtQ29tcGFjdFNob3J0KHtsb2NhbGU6IGxhbmd1YWdlLmxvY2FsZX0pLFxuICAgICAgY29sb3JSYW5nZTogY29sb3JTY2FsZXMucmFuZ2UueWVsbG93R3JlZW4sXG4gICAgICBjb2xvclVua25vd246IGNvbG9yU2NhbGVzLnVua25vd24sXG4gICAgfSxcbiAgXTtcbiAgcmV0dXJuIElucHV0cy5yYWRpbyhvcHRpb25zLnNvcnQoKGEsYikgPT4gYi5rZXkubG9jYWxlQ29tcGFyZShhLmtleSkpLCB7XG4gICAgd2lkdGg6IDMwMCxcbiAgICBsYWJlbDogX2xhbmcobmJUZXh0LnNlY3Rpb25zLmZ1dHVyZVdvcmtmb3JjZS5tYXAubWFwTGF5ZXIudGl0bGUpLFxuICAgIGZvcm1hdDogKHgpID0+IHgubGFiZWwsXG4gICAgdmFsdWU6IG9wdGlvbnMuZmluZCgodCkgPT4gdC5rZXkgPT09IFwiYWdfd29ya2ZvcmNlX2RhdGFfMlwiKVxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBsb3RDaG9yb3BsZXRoR2VvSW1wYWN0ID0ge1xuICBjb25zdCBkYXRhID0gbWFwRGF0YUdlb0ltcGFjdDtcbiAgY29uc3Qgc2VsZWN0b3IgPSBzZWxlY3RHZW9EYXRhVHlwZTtcblxuICBjb25zdCBhbGxWYWx1ZXMgPSBkYXRhLmZlYXR1cmVzLmZsYXRNYXAoKGQpID0+XG4gICAgZC5wcm9wZXJ0aWVzLmRhdGEgJiYgZC5wcm9wZXJ0aWVzLmRhdGFbc2VsZWN0b3IuZGF0YUNvbHVtbl0gIT09IHVuZGVmaW5lZFxuICAgICAgPyBbTWF0aC5hYnMoZC5wcm9wZXJ0aWVzLmRhdGFbc2VsZWN0b3IuZGF0YUNvbHVtbl0pXVxuICAgICAgOiBbXVxuICApO1xuXG4gIGNvbnN0IGNhcHRpb24gPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UubWFwLmNhcHRpb24pLFxuICAgIFt7IG5hbWU6IFwic2VsZWN0b3JcIiwgdmFsdWU6IHNlbGVjdG9yLmxhYmVsIH1dXG4gICk7XG5cbiAgLy8gcmV0dXJuIHBsb3RcbiAgcmV0dXJuIFBsb3QucGxvdCh7XG4gICAgd2lkdGg6IG1hcFdpZHRoLFxuICAgIGhlaWdodDogNjAwLFxuICAgIGNhcHRpb24sXG4gICAgcHJvamVjdGlvbjoge1xuICAgICAgdHlwZTogXCJhemltdXRoYWwtZXF1YWwtYXJlYVwiLFxuICAgICAgZG9tYWluOiBkYXRhXG4gICAgfSxcbiAgICBjb2xvcjoge1xuICAgICAgbGVnZW5kOiB0cnVlLFxuICAgICAgbGFiZWw6IHNlbGVjdG9yLmxhYmVsTGVnZW5kLFxuICAgICAgcmFuZ2U6IHNlbGVjdG9yLmNvbG9yUmFuZ2UsXG4gICAgICB1bmtub3duOiBzZWxlY3Rvci5jb2xvclVua25vd24sXG4gICAgICB0aWNrRm9ybWF0OiAoZCkgPT4ge1xuICAgICAgICAvLyBDaGVjayBpZiBkYXRhQ29sdW1uIGlzIG9uZSBvZiB0aGUgc3BlY2lmaWVkIHR5cGVzXG4gICAgICAgIGlmIChcbiAgICAgICAgICBzZWxlY3Rvci5kYXRhQ29sdW1uID09PSBcImNvcnJlY3RlZF9hZ19wb3BcIiB8fFxuICAgICAgICAgIHNlbGVjdG9yLmRhdGFDb2x1bW4gPT09IFwiYWd3X3RvdGFsX21pZF9hYnNcIiB8fFxuICAgICAgICAgIHNlbGVjdG9yLmRhdGFDb2x1bW4gPT09IFwiYWd3X3RvdGFsX2Fic1wiXG4gICAgICAgICkge1xuICAgICAgICAgIC8vIFVzZSB0aGUgcHJvdmlkZWQgZm9ybWF0RnVuYyBhbmQgYXBwZW5kIGEgXCIlXCIgc3ltYm9sIGZvciB0aGVzZSB0eXBlc1xuICAgICAgICAgIHJldHVybiBzZWxlY3Rvci5mb3JtYXRGdW5jKGQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIEZvciBvdGhlciB0eXBlcywganVzdCB1c2UgdGhlIGZvcm1hdEZ1bmMgd2l0aG91dCBhcHBlbmRpbmcgYSBcIiVcIiBzeW1ib2xcbiAgICAgICAgICByZXR1cm4gYCR7c2VsZWN0b3IuZm9ybWF0RnVuYyhkKX1gO1xuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZG9tYWluOlxuICAgICAgICBzZWxlY3Rvci5kYXRhQ29sdW1uID09PSBcImNvcnJlY3RlZF9hZ19wb3BcIiB8fFxuICAgICAgICBzZWxlY3Rvci5kYXRhQ29sdW1uID09PSBcImFnd190b3RhbF9taWRfYWJzXCIgfHxcbiAgICAgICAgc2VsZWN0b3IuZGF0YUNvbHVtbiA9PT0gXCJhZ3dfdG90YWxfYWJzXCJcbiAgICAgICAgICA/IFswLCBNYXRoLm1heCguLi5hbGxWYWx1ZXMpXVxuICAgICAgICAgIDogWy1NYXRoLm1heCguLi5hbGxWYWx1ZXMpLCBNYXRoLm1heCguLi5hbGxWYWx1ZXMpXVxuICAgIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIC8vIGdlbyBkYXRhXG4gICAgICBQbG90LmdlbyhkYXRhLmZlYXR1cmVzLCB7XG4gICAgICAgIGZpbGw6IChkKSA9PiB7XG4gICAgICAgICAgY29uc3QgZGF0YUNvbHVtbiA9IHNlbGVjdG9yLmRhdGFDb2x1bW47XG4gICAgICAgICAgY29uc3QgZmlsbFZhbHVlID0gZC5wcm9wZXJ0aWVzLmRhdGFcbiAgICAgICAgICAgID8gZC5wcm9wZXJ0aWVzLmRhdGFbZGF0YUNvbHVtbl1cbiAgICAgICAgICAgIDogbnVsbDsgLy8gaGFuZGxlIG1pc3NpbmcgZGF0YVxuICAgICAgICAgIHJldHVybiBmaWxsVmFsdWU7XG4gICAgICAgIH0sXG4gICAgICAgIHN0cm9rZTogXCIjZmZmXCIsXG4gICAgICAgIHN0cm9rZVdpZHRoOiAwLjVcbiAgICAgIH0pLFxuICAgICAgLy8gYWRtaW4yIGhpZ2hsaWdodFxuICAgICAgLy8gaWYgQWRtaW4gc2VsZWN0aW9uIGluY2x1ZGVzIGFkbWluMiwgaGlnaGxpZ2h0IHNlY3Rpb25cbiAgICAgIFBsb3QuZ2VvKFxuICAgICAgICBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlXG4gICAgICAgICAgPyBkYXRhLmZlYXR1cmVzLmZpbHRlcihcbiAgICAgICAgICAgICAgKGQpID0+IGQucHJvcGVydGllcy5hZG1pbjJfbmFtZSA9PSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlXG4gICAgICAgICAgICApXG4gICAgICAgICAgOiBbXSxcbiAgICAgICAge1xuICAgICAgICAgIGZpbGw6IG51bGwsXG4gICAgICAgICAgc3Ryb2tlOiBcIiMzMzNcIixcbiAgICAgICAgICBzdHJva2VXaWR0aDogMS41XG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICAvLyBnZW8gcG9pbnRlclxuICAgICAgUGxvdC5nZW8oXG4gICAgICAgIGRhdGEsXG4gICAgICAgIFBsb3QucG9pbnRlcihcbiAgICAgICAgICBQbG90LmNlbnRyb2lkKHtcbiAgICAgICAgICAgIHN0cm9rZTogXCIjMzMzXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMS41XG4gICAgICAgICAgfSlcbiAgICAgICAgKVxuICAgICAgKSxcbiAgICAgIC8vIHRvb2x0aXBcbiAgICAgIFBsb3QudGlwKFxuICAgICAgICBkYXRhLmZlYXR1cmVzLFxuICAgICAgICBQbG90LnBvaW50ZXIoXG4gICAgICAgICAgUGxvdC5jZW50cm9pZCh7XG4gICAgICAgICAgICBjaGFubmVsczoge1xuICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICAgICAgLy8gcmVnaW9uIGxhYmVsLCBiYXNlZCBvbiBzZWxlY3Rpb25cbiAgICAgICAgICAgICAgICBsYWJlbDogTGFuZy50b1RpdGxlQ2FzZShnZXRMb3dlckxldmVsQWRtaW5MYWJlbCgpKSwgLy8gcGxvdC1sZXZlbCBzbyBpbnB1dHMgZG9uJ3QgcmVsb2FkXG4gICAgICAgICAgICAgICAgdmFsdWU6IChkKSA9PiBfbGFuZyh0ZC5hZG1pbjBfbmFtZS52YWx1ZXM/LltkLnByb3BlcnRpZXMuYWRtaW5fbmFtZV0pID8/IGQucHJvcGVydGllcy5hZG1pbl9uYW1lXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBsYWJlbDogc2VsZWN0b3IubGFiZWxUaXAsXG4gICAgICAgICAgICAgICAgdmFsdWU6IChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBkYXRhQ29sdW1uID0gc2VsZWN0b3IuZGF0YUNvbHVtbjtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSBkLnByb3BlcnRpZXMuZGF0YVxuICAgICAgICAgICAgICAgICAgICA/IGQucHJvcGVydGllcy5kYXRhW2RhdGFDb2x1bW5dXG4gICAgICAgICAgICAgICAgICAgIDogdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZm9ybWF0OiB7XG4gICAgICAgICAgICAgIG5hbWU6IHRydWUsXG4gICAgICAgICAgICAgIGRhdGE6IChkKSA9PiBgJHtzZWxlY3Rvci5mb3JtYXRGdW5jKGQpfWBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApXG4gICAgXVxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImJ1aWxkSW5saW5lRG93bmxvYWRCdXR0b24oXG4gIGRhdGFHZW9JbXBhY3QsXG4gIF9sYW5nKGRvd25sb2FkX3RyYW5zbGF0aW9uKSxcbiAgYGFnV29ya2ZvcmNlXyR7c2VsZWN0QWRtaW4wLmxhYmVsLnJlcGxhY2UoL1xccy9nLCBcIlwiKX1gLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJoZWFkZXJRdWlja0luc2lnaHRzR2VvSW1wYWN0ID0ge1xuICBjb25zdCBhZG1pbkFydGljbGUgPSBfbGFuZyhnZXRBZG1pblNlbGVjdGlvbigpPy5kYXRhPy5hcnRpY2xlMSk7XG4gIGNvbnN0IGFkbWluU2VsZWN0aW9uID0gYWRtaW5BcnRpY2xlID8/IGdldEFkbWluU2VsZWN0aW9uKCkubGFiZWw7XG4gIGNvbnN0IHRleHQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5xdWlja0luc2lnaHRzR2VuZXJhbC5oZWFkZXIpLFxuICAgIFt7IG5hbWU6IFwic2VsZWN0aW9uXCIsIHZhbHVlOiBhZG1pblNlbGVjdGlvbiB9XVxuICApO1xuXG4gIHJldHVybiBtZGAjIyMgJHt0ZXh0fWA7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gdGV4dCBpbnNpZ2h0cyBmb3IgZ2VvIGltcGFjdFxudGV4dER5bmFtaWNJbnNpZ2h0c19nZW9JbXBhY3QgPSB7XG4gIGNvbnN0IGFkbWluU2VsZWN0aW9uID0gZ2V0QWRtaW4wV2l0aEFkbWluU3ViUGFyZW5zKHthcnRpY2xlRmllbGQ6IFwiYXJ0aWNsZTJcIn0pO1xuICBjb25zdCBpID0gZHluYW1pY0luc2lnaHRzX2dlb0ltcGFjdC5pbnNpZ2h0O1xuXG4gIGNvbnN0IGN1cnJlbnRBZ1BvcCA9IGkudG90YWxBZ1BvcF9ub2Zvcm1hdDtcbiAgLy8gdG90YWxWb3AgaXMgdGhlIHByb2plY3RlZCBjaGFuZ2UgaW4gYWdyaWN1bHR1cmFsIHBvcHVsYXRpb24gYnkgMjA1MFxuICBjb25zdCBwcm9qZWN0ZWRDaGFuZ2UyMDUwID0gaS50b3RhbEFnUG9wXzJfNTBfbm9mb3JtYXQ7XG4gIGNvbnN0IHByb2plY3RlZENoYW5nZTIwMzAgPSBpLnRvdGFsQWdQb3BfMl8zMF9ub2Zvcm1hdDtcblxuICAvLyBzdHJpbmcgZm9yIHBlcmNlbnQgY2hhbmdlXG4gIGNvbnN0IHBlcmNDaGFuZ2VUeXBlID0gKGQpID0+XG4gICAgZCA+PSAwXG4gICAgICA/IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UucXVpY2tJbnNpZ2h0cy5kaXJlY3Rpb24uaW5jKVxuICAgICAgOiBfbGFuZyhuYlRleHQuc2VjdGlvbnMuZnV0dXJlV29ya2ZvcmNlLnF1aWNrSW5zaWdodHMuZGlyZWN0aW9uLmRlYyk7XG5cbiAgLy8gQ2FsY3VsYXRlIHRoZSBuZXcgdG90YWwgYWdyaWN1bHR1cmFsIHBvcHVsYXRpb24gZm9yIDIwNTBcbiAgY29uc3QgbmV3VG90YWxBZ1BvcDIwNTAgPSBjdXJyZW50QWdQb3AgKyBwcm9qZWN0ZWRDaGFuZ2UyMDUwO1xuXG4gIC8vIENhbGN1bGF0ZSB0aGUgcGVyY2VudGFnZSBjaGFuZ2VcbiAgbGV0IHBlcmNlbnRDaGFuZ2U1MCA9XG4gICAgKChwcm9qZWN0ZWRDaGFuZ2UyMDUwIC0gY3VycmVudEFnUG9wKSAvIGN1cnJlbnRBZ1BvcCkgKiAxMDA7XG4gIGxldCBjaGFuZ2VUeXBlNTAgPSBwZXJjQ2hhbmdlVHlwZShwZXJjZW50Q2hhbmdlNTApO1xuICBwZXJjZW50Q2hhbmdlNTAgPSBNYXRoLmFicyhwZXJjZW50Q2hhbmdlNTApLnRvRml4ZWQoMSk7IC8vIEtlZXBpbmcgdHdvIGRlY2ltYWxzIGZvciByZWFkYWJpbGl0eVxuXG4gIGxldCBwZXJjZW50Q2hhbmdlMzAgPVxuICAgICgocHJvamVjdGVkQ2hhbmdlMjAzMCAtIGN1cnJlbnRBZ1BvcCkgLyBjdXJyZW50QWdQb3ApICogMTAwO1xuICBsZXQgY2hhbmdlVHlwZTMwID0gcGVyY0NoYW5nZVR5cGUocGVyY2VudENoYW5nZTMwKTtcbiAgcGVyY2VudENoYW5nZTMwID0gTWF0aC5hYnMocGVyY2VudENoYW5nZTMwKS50b0ZpeGVkKDEpOyAvLyBLZWVwaW5nIHR3byBkZWNpbWFscyBmb3IgcmVhZGFiaWxpdHlcblxuICBsZXQgcGVyY2VudENoYW5nZV81ID1cbiAgICAoKGkudG90YWxBZ1BvcF81XzUwX25vZm9ybWF0IC0gY3VycmVudEFnUG9wKSAvIGN1cnJlbnRBZ1BvcCkgKiAxMDA7XG4gIGxldCBjaGFuZ2VUeXBlXzUgPSBwZXJjQ2hhbmdlVHlwZShwZXJjZW50Q2hhbmdlXzUpO1xuICBwZXJjZW50Q2hhbmdlXzUgPSBNYXRoLmFicyhwZXJjZW50Q2hhbmdlXzUpLnRvRml4ZWQoMSk7IC8vIEtlZXBpbmcgdHdvIGRlY2ltYWxzIGZvciByZWFkYWJpbGl0eVxuXG4gIGxldCBwZXJjZW50Q2hhbmdlMzBfNSA9XG4gICAgKChpLnRvdGFsQWdQb3BfNV8zMF9ub2Zvcm1hdCAtIGN1cnJlbnRBZ1BvcCkgLyBjdXJyZW50QWdQb3ApICogMTAwO1xuICBsZXQgY2hhbmdlVHlwZTMwXzUgPSBwZXJjQ2hhbmdlVHlwZShwZXJjZW50Q2hhbmdlMzBfNSk7XG4gIHBlcmNlbnRDaGFuZ2UzMF81ID0gTWF0aC5hYnMocGVyY2VudENoYW5nZTMwXzUpLnRvRml4ZWQoMSk7IC8vIEtlZXBpbmcgdHdvIGRlY2ltYWxzIGZvciByZWFkYWJpbGl0eVxuXG4gIGNvbnN0IHNlbGVjdGVkQ291bnRyeSA9IGdldEFkbWluU2VsZWN0aW9uMCgpLnZhbHVlOyAvLyBGdW5jdGlvbiB0byBnZXQgdGhlIHNlbGVjdGVkIGNvdW50cnlcbiAgY29uc3QgY291bnRyaWVzV2l0aG91dERhdGEgPSBbXG4gICAgXCJCdXJ1bmRpXCIsXG4gICAgXCJSd2FuZGFcIixcbiAgICBcIkxlc290aG9cIixcbiAgICBcIkdhYm9uXCIsXG4gICAgXCJFc3dhdGluaVwiLFxuICAgIFwiRXF1YXRvcmlhbCBHdWluZWFcIlxuICBdO1xuXG4gIGNvbnN0IGluc2lnaHRCYXNlID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICBfbGFuZyhuYlRleHQuc2VjdGlvbnMuZnV0dXJlV29ya2ZvcmNlLnF1aWNrSW5zaWdodHMuYmFzZVBvcCksXG4gICAgW1xuICAgICAgeyBuYW1lOiBcImdlb1wiLCB2YWx1ZTogYWRtaW5TZWxlY3Rpb24gfSxcbiAgICAgIHsgbmFtZTogXCJ0b3RhbFwiLCB2YWx1ZTogaS50b3RhbEFnUG9wIH1cbiAgICBdXG4gICk7XG4gIGNvbnN0IGluc2lnaHRQb3BDaGFuZ2UgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5mdXR1cmVXb3JrZm9yY2UucXVpY2tJbnNpZ2h0cy5wb3BDaGFuZ2UpLFxuICAgIFtcbiAgICAgIHsgbmFtZTogXCJjaGFuZ2UyMDMwXCIsIHZhbHVlOiBpLnRvdGFsQWdQb3BfMl8zMCB9LFxuICAgICAgeyBuYW1lOiBcImNoYW5nZTIwNTBcIiwgdmFsdWU6IGkudG90YWxBZ1BvcF8yXzUwIH0sXG4gICAgICB7IG5hbWU6IFwiZGlyZWN0aW9uMjAzMFwiLCB2YWx1ZTogY2hhbmdlVHlwZTMwIH0sXG4gICAgICB7IG5hbWU6IFwiZGlyZWN0aW9uMjA1MFwiLCB2YWx1ZTogY2hhbmdlVHlwZTUwIH0sXG4gICAgICB7IG5hbWU6IFwicGVyYzIwMzBcIiwgdmFsdWU6IHBlcmNlbnRDaGFuZ2UzMCB9LFxuICAgICAgeyBuYW1lOiBcInBlcmMyMDUwXCIsIHZhbHVlOiBwZXJjZW50Q2hhbmdlNTAgfVxuICAgIF1cbiAgKTtcbiAgY29uc3QgaW5zaWdodFBvcFNjZW5hcmlvID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICBfbGFuZyhuYlRleHQuc2VjdGlvbnMuZnV0dXJlV29ya2ZvcmNlLnF1aWNrSW5zaWdodHMucG9wU2NlbmFyaW8pLFxuICAgIFtcbiAgICAgIHsgbmFtZTogXCJwb3AyMDMwXCIsIHZhbHVlOiBpLnRvdGFsQWdQb3BfNV8zMCB9LFxuICAgICAgeyBuYW1lOiBcInBvcDIwNTBcIiwgdmFsdWU6IGkudG90YWxBZ1BvcF81XzUwIH0sXG4gICAgICB7IG5hbWU6IFwiZGlyZWN0aW9uXCIsIHZhbHVlOiBjaGFuZ2VUeXBlMzBfNSB9LFxuICAgICAgeyBuYW1lOiBcInBlcmMyMDMwXCIsIHZhbHVlOiBwZXJjZW50Q2hhbmdlMzBfNSB9LFxuICAgICAgeyBuYW1lOiBcInBlcmMyMDUwXCIsIHZhbHVlOiBwZXJjZW50Q2hhbmdlXzUgfVxuICAgIF1cbiAgKVxuXG4gIC8vIENoZWNrIGlmIHRoZSBzZWxlY3RlZCBjb3VudHJ5IGlzIGluIHRoZSBsaXN0IG9mIGNvdW50cmllcyB3aXRob3V0IGRhdGFcbiAgaWYgKGNvdW50cmllc1dpdGhvdXREYXRhLmluY2x1ZGVzKHNlbGVjdGVkQ291bnRyeSkpIHtcbiAgICByZXR1cm4gbWRgJHtfbGFuZyhuYlRleHQuc2VjdGlvbnMucXVpY2tJbnNpZ2h0c0dlbmVyYWwubm9EYXRhQmx1cmIpfWA7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIG1kYCR7c3R5bGluZ30ke2luc2lnaHRCYXNlfVxuXG4ke2luc2lnaHRQb3BDaGFuZ2V9XG5cbiR7aW5zaWdodFBvcFNjZW5hcmlvfWA7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAjICR7X2xhbmcobmJUZXh0LnNlY3Rpb25zLmhlYXRTdHJlc3MudGl0bGUpfWA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgJHtfbGFuZyhuYlRleHQuc2VjdGlvbnMuaGVhdFN0cmVzcy5pbnRybyl9YDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBmb3JtYXQgYWRtaW4gc2VsZWN0aW9uc1xuLy8gYmluZCB0byBhcHBlbmRpeCBpbnB1dHMsIGFkZCB0ZW1wbGF0ZSB0byBmb3JtYXRcbklucHV0cy5mb3JtKFxuICBbXG4gICAgSW5wdXRzLmJpbmQoXG4gICAgICBJbnB1dHMuc2VsZWN0KGRhdGFBZG1pbjAsIHsgbGFiZWw6IGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4wLCBmb3JtYXQ6IHggPT4geC5sYWJlbCB9KSxcbiAgICAgIHZpZXdvZiBzZWxlY3RBZG1pbjBcbiAgICApLFxuICAgIElucHV0cy5iaW5kKFxuICAgICAgSW5wdXRzLnNlbGVjdChkYXRhQWRtaW4xLCB7IGxhYmVsOiBhZG1pblJlZ2lvbnMubGFiZWxzLmFkbWluMSwgZm9ybWF0OiB4ID0+IHgubGFiZWwgfSksXG4gICAgICB2aWV3b2Ygc2VsZWN0QWRtaW4xXG4gICAgKSxcbiAgICBJbnB1dHMuYmluZChcbiAgICAgIElucHV0cy5zZWxlY3QoZGF0YUFkbWluMiwgeyBsYWJlbDogYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjIsIGZvcm1hdDogeCA9PiB4LmxhYmVsIH0pLFxuICAgICAgdmlld29mIHNlbGVjdEFkbWluMlxuICAgIClcbiAgXSxcbiAge1xuICAgIHRlbXBsYXRlOiBhZG1pbkZvcm1UZW1wbGF0ZVxuICB9XG4pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIHNlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lID0ge1xuICAvLyBzY2VuYXJpbyBhbmQgdGltZWZyYW1lXG5cbiAgY29uc3QgZGF0YSA9IFtcbiAgICB7bGFiZWw6ICdTU1AyNDU6IDIwMzAnLCBzY2VuYXJpbzogJ1NTUDInLCB0aW1lZnJhbWU6ICcyMDMwJ30sXG4gICAge2xhYmVsOiAnU1NQMjQ1OiAyMDUwJywgc2NlbmFyaW86ICdTU1AyJywgdGltZWZyYW1lOiAnMjA1MCd9LFxuICAgIHtsYWJlbDogJ1NTUDU4NTogMjAzMCcsIHNjZW5hcmlvOiAnU1NQNScsIHRpbWVmcmFtZTogJzIwMzAnfSxcbiAgICB7bGFiZWw6ICdTU1A1ODU6IDIwNTAnLCBzY2VuYXJpbzogJ1NTUDUnLCB0aW1lZnJhbWU6ICcyMDUwJ30sXG4gIF1cbiAgXG4gIHJldHVybiBJbnB1dHMuc2VsZWN0KGRhdGEsIHtcbiAgICBsYWJlbDogX2xhbmcobmJUZXh0LmxlZ2VuZHMuc2NlbmFyaW8pLFxuICAgIGZvcm1hdDogeCA9PiB4LmxhYmVsLFxuICAgIHZhbHVlOiBkYXRhLmZpbmQoZCA9PiBkLmxhYmVsID09PSAnU1NQMjQ1OiAyMDUwJylcbiAgfSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIHNlbGVjdFRocmVzaG9sZCA9IHtcbiAgLy8gc2NlbmFyaW8gYW5kIHRpbWVmcmFtZVxuXG4gIGNvbnN0IGRhdGEgPSBbXG4gICAge2xhYmVsOiAnMjjCsEMnLCB0aHJlc2hvbGQ6ICcyOCd9LFxuICAgIHtsYWJlbDogJzMwwrBDJywgdGhyZXNob2xkOiAnMzAnfSxcbiAgXVxuICBcbiAgcmV0dXJuIElucHV0cy5zZWxlY3QoZGF0YSwge1xuICAgIGxhYmVsOiBfbGFuZyhuYlRleHQubGVnZW5kcy50aHJlc2hvbGQpLFxuICAgIGZvcm1hdDogeCA9PiB4LmxhYmVsLFxuICAgIHZhbHVlOiBkYXRhLmZpbmQoZCA9PiBkLmxhYmVsID09PSAnMjgnKVxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IF9hbnlEYXRhID0gVC50aWR5KFxuICAgIGRhdGFfaGF6YXJkVm9QLFxuICAgIFQuZ3JvdXBCeShcbiAgICAgIFtcbiAgICAgICAgXCJhZG1pbjBfbmFtZVwiLFxuICAgICAgICBcImFkbWluMV9uYW1lXCIsXG4gICAgICAgIFwiYWRtaW4yX25hbWVcIixcbiAgICAgICAgXCJzY2VuYXJpb1wiLFxuICAgICAgICBcInRpbWVmcmFtZVwiLFxuICAgICAgICBcInRocmVzaG9sZFwiLFxuICAgICAgICBcImNyb3BcIlxuICAgICAgXSxcbiAgICAgIFtcbiAgICAgICAgVC5zdW1tYXJpemUoe1xuICAgICAgICAgIHZvcF9hbnk6IFQuc3VtKFwidm9wXCIpXG4gICAgICAgIH0pXG4gICAgICBdXG4gICAgKVxuICApO1xuXG4gIGNvbnN0IF9kYXRhV2l0aEFueUNvbHVtbiA9IFQudGlkeShcbiAgICBkYXRhX2hhemFyZFZvUCxcbiAgICBULmxlZnRKb2luKF9hbnlEYXRhLCB7XG4gICAgICBieTogW1xuICAgICAgICBcImFkbWluMF9uYW1lXCIsXG4gICAgICAgIFwiYWRtaW4xX25hbWVcIixcbiAgICAgICAgXCJhZG1pbjJfbmFtZVwiLFxuICAgICAgICBcInNjZW5hcmlvXCIsXG4gICAgICAgIFwidGltZWZyYW1lXCIsXG4gICAgICAgIFwiY3JvcFwiLFxuICAgICAgICBcInRocmVzaG9sZFwiXG4gICAgICBdXG4gICAgfSlcbiAgKTtcblxuICBjb25zdCBkYXRhID0gX2RhdGFXaXRoQW55Q29sdW1uO1xuICBjb25zdCBkYXRhQW55ID0gZGF0YS5maWx0ZXIoKGQpID0+IGQuaGF6YXJkID09IFwiYW55XCIpOyAvLyBjb21iaW5lZFxuICBjb25zdCBkYXRhQmFycyA9IFtcbiAgICAuLi5kYXRhLmZpbHRlcigoZCkgPT4gZC5oYXphcmQgIT09IFwiYW55XCIgJiYgZC52b3AgIT09IDApIC8vIHJlbW92ZSB0aGUgY29tYmluZWQgaGF6YXJkXG4gIF07XG4gIGNvbnN0IF9mb3JtYXROdW1iZXIgPSBmb3JtYXROdW1Db21wYWN0U2hvcnQoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSk7XG4gIGNvbnN0IHhEb21haW4gPSBjcm9wTmFtZXNcbiAgLmZpbHRlcihkID0+IHtcbiAgICBjb25zdCBhdmFpbGFibGVDcm9wcyA9IF8udW5pcShkYXRhQmFycy5tYXAoZCA9PiBkLmNyb3ApKTtcbiAgICByZXR1cm4gYXZhaWxhYmxlQ3JvcHMuaW5jbHVkZXMoZC5jcm9wKTtcbiAgfSlcbiAgLm1hcChkID0+IHtcbiAgICBjb25zdCB1cHBlckJvdW5kID0gcGFyc2VJbnQoZC5jcm9wTmFtZSwgMTApOyAvLyBBc3N1bWluZyBjcm9wTmFtZSBpcyB0aGUgdXBwZXIgYm91bmRcbiAgICBjb25zdCBsb3dlckJvdW5kID0gTWF0aC5tYXgoMCwgdXBwZXJCb3VuZCAtIDUpO1xuICAgIHJldHVybiBgJHtsb3dlckJvdW5kfS0ke3VwcGVyQm91bmR9JWA7XG4gIH0pO1xuXG4gIGNvbnN0IG1heFZhbHVlID0gZDMubWF4KGRhdGFCYXJzLCAoZCkgPT4gZC52b3ApICogMS41OyAvLyBhZGRpbmcgMTAlIGJ1ZmZlclxuXG4gIHJldHVybiBQbG90LnBsb3Qoe1xuICAgIC8vIGNhcHRpb246IGBUbyBlbnN1cmUgdGhhdCB0aGUgZGV0YWlscyBhY3Jvc3MgYWxsIGJpbnMgYXJlIHZpc2libGUgd2l0aG91dCBiZWluZyBkb21pbmF0ZWQgYnkgdGhlIGluaXRpYWwgcmFuZ2UsIHRoZSAwLTUlIGJpbiBoYXMgYmVlbiBpbnRlbnRpb25hbGx5IGV4Y2x1ZGVkIGZyb20gdGhpcyB2aXN1YWxpemF0aW9uLmAsXG4gICAgY2FwdGlvbjogX2xhbmcobmJUZXh0LnNlY3Rpb25zLmhlYXRTdHJlc3MuYmFyQ2hhcnQuY2FwdGlvbiksXG4gICAgd2lkdGgsXG4gICAgaGVpZ2h0OiA2MDAsXG4gICAgbWFyZ2luTGVmdDogNDAsXG4gICAgbWFyZ2luUmlnaHQ6IDQwLFxuICAgIG1hcmdpbkJvdHRvbTogNDAsXG4gICAgY29sb3I6IHtcbiAgICAgIGRvbWFpbjogaGF6YXJkUGxvdExvb2t1cC5jb2xvci5kb21haW4sXG4gICAgICByYW5nZTogaGF6YXJkUGxvdExvb2t1cC5jb2xvci5yYW5nZSxcbiAgICAgIGxlZ2VuZDogdHJ1ZVxuICAgIH0sXG4gICAgeDoge1xuICAgICAgZG9tYWluOiB4RG9tYWluLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5oZWF0U3RyZXNzLmJhckNoYXJ0LnhMYWJlbCksXG4gICAgICBsYWJlbFN0eWxlOiB7IGZvbnRTaXplOiAnMzZweCcgfSwgLy8gSHlwb3RoZXRpY2FsIEFQSVxuICAgIH0sXG4gICAgeToge1xuICAgICAgbmljZTogdHJ1ZSxcbiAgICAgIGdyaWQ6IHRydWUsXG4gICAgICBsYWJlbDogX2xhbmcobmJUZXh0LnNlY3Rpb25zLmhlYXRTdHJlc3MuYmFyQ2hhcnQueUxhYmVsKSxcbiAgICAgIHRpY2tGb3JtYXQ6IGQgPT4gX2Zvcm1hdE51bWJlcihkKSxcbiAgICB9LFxuICAgIG1hcmtzOiBbXG4gICAgICAvLyBtYWluIHgtYXhpc1xuICAgICAgUGxvdC5heGlzWCh7XG4gICAgICAgIHRpY2tTaXplOiAwLFxuICAgICAgICAvLyBsaW5lV2lkdGg6IDMsXG4gICAgICB9KSxcbiAgICAgIC8vIHBvaW50ZXIgd2hpdGUtb3V0XG4gICAgICBQbG90LmF4aXNYKFxuICAgICAgICBQbG90LnBvaW50ZXJYKHtcbiAgICAgICAgICBsYWJlbDogbnVsbCxcbiAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgdGV4dFN0cm9rZTogXCJ3aGl0ZVwiLFxuICAgICAgICAgIHRleHRTdHJva2VXaWR0aDogMSxcbiAgICAgICAgICB0aWNrU2l6ZTogMFxuICAgICAgICB9KVxuICAgICAgKSxcbiAgICAgIC8vIGJvbGQgcG9pbnRlclxuICAgICAgUGxvdC5heGlzWChcbiAgICAgICAgUGxvdC5wb2ludGVyWCh7XG4gICAgICAgICAgZm9udFdlaWdodDogXCJib2xkXCIsXG4gICAgICAgICAgbGFiZWw6IG51bGwsXG4gICAgICAgICAgdGlja1NpemU6IDBcbiAgICAgICAgfSlcbiAgICAgICksXG4gICAgICAvLyBoYXphcmQgY29tcG9uZW50IGJhcnNcbiAgICAgIFBsb3QuYmFyWShcbiAgICAgICAgZGF0YUJhcnMsXG4gICAgICAgIFBsb3Quc3RhY2tZKFxuICAgICAgICAgIHsgb3JkZXI6IGhhemFyZFBsb3RMb29rdXAuY29sb3IuZG9tYWluIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeTogKGQpID0+IGQudm9wLFxuICAgICAgICAgICAgeDogZCA9PiB7XG4gICAgICBjb25zdCB1cHBlckJvdW5kID0gcGFyc2VJbnQoaGF6YXJkUGxvdExvb2t1cC5jcm9wc1tkLmNyb3BdLCAxMCk7IC8vIEFzc3VtaW5nIHRoaXMgZ2l2ZXMgdGhlIHVwcGVyIGJvdW5kIGFzIGJlZm9yZVxuICAgICAgY29uc3QgbG93ZXJCb3VuZCA9IE1hdGgubWF4KDAsIHVwcGVyQm91bmQgLSA1KTtcbiAgICAgIHJldHVybiBgJHtsb3dlckJvdW5kfS0ke3VwcGVyQm91bmR9JWA7XG4gICAgfSxcbiAgICAgICAgICAgIGZpbGw6IChkKSA9PiBoYXphcmRQbG90TG9va3VwLm5hbWVzW2QuaGF6YXJkXSxcbiAgICAgICAgICAgIHN0cm9rZTogXCIjZmZmXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMC4yNVxuICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgKSxcbiAgICAgIC8vIHRvb2x0aXBcbiAgICAgIFBsb3QudGlwKFxuICAgICAgICBkYXRhQmFycyxcbiAgICAgICAgUGxvdC5wb2ludGVyWChcbiAgICAgICAgICBQbG90LnN0YWNrWShcbiAgICAgICAgICAgIHsgb3JkZXI6IGhhemFyZFBsb3RMb29rdXAuY29sb3IuZG9tYWluIH0sXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgIHk6IChkKSA9PiBkLnZvcCxcbiAgICAgICAgICAgICAgeDogZCA9PiB7XG4gICAgICBjb25zdCB1cHBlckJvdW5kID0gcGFyc2VJbnQoaGF6YXJkUGxvdExvb2t1cC5jcm9wc1tkLmNyb3BdLCAxMCk7IC8vIEFzc3VtaW5nIHRoaXMgZ2l2ZXMgdGhlIHVwcGVyIGJvdW5kIGFzIGJlZm9yZVxuICAgICAgY29uc3QgbG93ZXJCb3VuZCA9IE1hdGgubWF4KDAsIHVwcGVyQm91bmQgLSA1KTtcbiAgICAgIHJldHVybiBgJHtsb3dlckJvdW5kfS0ke3VwcGVyQm91bmR9JWA7XG4gICAgfSxcbiAgICAgICAgICAgICAgZmlsbDogKGQpID0+IGhhemFyZFBsb3RMb29rdXAubmFtZXNbZC5oYXphcmRdLFxuICAgICAgICAgICAgICBjaGFubmVsczoge1xuICAgICAgICAgICAgICAgIGhhemFyZDoge1xuICAgICAgICAgICAgICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5oZWF0U3RyZXNzLmJhckNoYXJ0LnRvb2x0aXAucGVyaW9kKSxcbiAgICAgICAgICAgICAgICAgIHZhbHVlOiAoZCkgPT4gaGF6YXJkUGxvdExvb2t1cC5uYW1lc1tkLmhhemFyZF1cbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIHZvcDoge1xuICAgICAgICAgICAgICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5oZWF0U3RyZXNzLmJhckNoYXJ0LnRvb2x0aXAuZXhwb3NlZCksXG4gICAgICAgICAgICAgICAgICB2YWx1ZTogKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgdm9wID0gZC52b3A7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBgKCR7dm9wfSlgO1xuICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgIHZhbHVlOiAgKGQpID0+ICBfZm9ybWF0TnVtYmVyKGQudm9wKVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZm9ybWF0OiB7XG4gICAgICAgICAgICAgICAgeDogZmFsc2UsXG4gICAgICAgICAgICAgICAgeTogZmFsc2UsXG4gICAgICAgICAgICAgICAgZmlsbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdm9wOiB0cnVlLFxuICAgICAgICAgICAgICAgIGhhemFyZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwZXJjOiB0cnVlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICksXG4gICAgICAvLyB0b3RhbCBWb1AsIHNpZGViYXIgaGlnaGxpZ2h0XG4gICAgICBQbG90LnRleHRZKFxuICAgICAgICBkYXRhQW55LFxuICAgICAgICBQbG90LnBvaW50ZXIoe1xuICAgICAgICAgIHk6IG1heFZhbHVlLFxuICAgICAgICAgIHg6IGQgPT4ge1xuICAgICAgY29uc3QgdXBwZXJCb3VuZCA9IHBhcnNlSW50KGhhemFyZFBsb3RMb29rdXAuY3JvcHNbZC5jcm9wXSwgMTApOyAvLyBBc3N1bWluZyB0aGlzIGdpdmVzIHRoZSB1cHBlciBib3VuZCBhcyBiZWZvcmVcbiAgICAgIGNvbnN0IGxvd2VyQm91bmQgPSBNYXRoLm1heCgwLCB1cHBlckJvdW5kIC0gNSk7XG4gICAgICByZXR1cm4gYCR7bG93ZXJCb3VuZH0tJHt1cHBlckJvdW5kfSVgO1xuICAgIH0sXG4gICAgICAgICAgdGV4dDogKGQpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0gZC52b3BfdG90YWw7XG4gICAgICAgICAgICByZXR1cm4gYCR7dmFsdWV9YDtcbiAgICAgICAgICB9LFxuICAgICAgICAgIHRleHRBbmNob3I6IFwic3RhcnRcIixcbiAgICAgICAgICBkeDogNlxuICAgICAgICB9KVxuICAgICAgKVxuICAgIF1cbiAgfSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBfYW55RGF0YSA9IFQudGlkeShcbiAgICBkYXRhX2hhemFyZFZvUCxcbiAgICBULmdyb3VwQnkoXG4gICAgICBbXG4gICAgICAgIFwiYWRtaW4wX25hbWVcIixcbiAgICAgICAgXCJhZG1pbjFfbmFtZVwiLFxuICAgICAgICBcImFkbWluMl9uYW1lXCIsXG4gICAgICAgIFwic2NlbmFyaW9cIixcbiAgICAgICAgXCJ0aW1lZnJhbWVcIixcbiAgICAgICAgXCJ0aHJlc2hvbGRcIixcbiAgICAgICAgXCJjcm9wXCJcbiAgICAgIF0sXG4gICAgICBbXG4gICAgICAgIFQuc3VtbWFyaXplKHtcbiAgICAgICAgICB2b3BfYW55OiBULnN1bShcInZvcFwiKVxuICAgICAgICB9KVxuICAgICAgXVxuICAgIClcbiAgKTtcblxuICBjb25zdCBfZGF0YVdpdGhBbnlDb2x1bW4gPSBULnRpZHkoXG4gICAgZGF0YV9oYXphcmRWb1AsXG4gICAgVC5sZWZ0Sm9pbihfYW55RGF0YSwge1xuICAgICAgYnk6IFtcbiAgICAgICAgXCJhZG1pbjBfbmFtZVwiLFxuICAgICAgICBcImFkbWluMV9uYW1lXCIsXG4gICAgICAgIFwiYWRtaW4yX25hbWVcIixcbiAgICAgICAgXCJzY2VuYXJpb1wiLFxuICAgICAgICBcInRpbWVmcmFtZVwiLFxuICAgICAgICBcImNyb3BcIixcbiAgICAgICAgXCJ0aHJlc2hvbGRcIlxuICAgICAgXVxuICAgIH0pXG4gICk7XG5cbiAgY29uc3QgZGF0YSA9IF9kYXRhV2l0aEFueUNvbHVtbjtcbiAgcmV0dXJuIGJ1aWxkSW5saW5lRG93bmxvYWRCdXR0b24oZGF0YSwgX2xhbmcoZG93bmxvYWRfdHJhbnNsYXRpb24pLCBgZGF5c1Vuc2FmZUhlYXRTdHJlc3NfJHtzZWxlY3RBZG1pbjAubGFiZWwucmVwbGFjZSgvXFxzL2csIFwiXCIpfWApXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgJHtfbGFuZyhuYlRleHQuc2VjdGlvbnMuaGVhdFN0cmVzcy5maWd1cmVCb2R5KX1gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImhlYWRlclF1aWNrSW5zaWdodHNCYXJzID0ge1xuICBjb25zdCBhZG1pbkFydGljbGUgPSBfbGFuZyhnZXRBZG1pblNlbGVjdGlvbigpPy5kYXRhPy5hcnRpY2xlMSk7XG4gIGNvbnN0IGFkbWluU2VsZWN0aW9uID0gYWRtaW5BcnRpY2xlID8/IGdldEFkbWluU2VsZWN0aW9uKCkubGFiZWw7XG4gIGNvbnN0IHRleHQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5xdWlja0luc2lnaHRzR2VuZXJhbC5oZWFkZXIpLFxuICAgIFt7IG5hbWU6IFwic2VsZWN0aW9uXCIsIHZhbHVlOiBhZG1pblNlbGVjdGlvbiB9XVxuICApO1xuXG4gIHJldHVybiBtZGAjIyMgJHt0ZXh0fWA7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBjcm9wID0gaW5zaWdodF90b3RhbEV4cG9zZWRWb3AuZmlsdGVyKFxuICAgIChkKSA9PiBkLnRvdGFsRXhwb3NlZFZvcCAhPT0gMCAmJiBkLmNyb3BUeXBlID09IFwiY3JvcFwiXG4gICk/LlswXT8uW1widG90YWxFeHBvc2VkVm9wXCJdO1xuXG4gIGNvbnN0IHRvdGFsRXhwb3NlZFZvcEJhc2VsaW5lID1cbiAgICBpbnNpZ2h0X3RvdGFsRXhwb3NlZFZvcC5maW5kKFxuICAgICAgKGQpID0+IGQuY3JvcFR5cGUgPT09IFwiY3JvcFwiICYmIGQuaGF6YXJkID09PSBcImJhc2VsaW5lXCJcbiAgICApPy50b3RhbEV4cG9zZWRWb3AgfHwgXCJubyBkYXRhXCI7XG4gIGNvbnN0IHRvdGFsRXhwb3NlZFZvcFByb2plY3Rpb24gPVxuICAgIGluc2lnaHRfdG90YWxFeHBvc2VkVm9wLmZpbmQoXG4gICAgICAoZCkgPT4gZC5jcm9wVHlwZSA9PT0gXCJjcm9wXCIgJiYgZC5oYXphcmQgPT09IFwicHJvamVjdGlvblwiXG4gICAgKT8udG90YWxFeHBvc2VkVm9wIHx8IFwibm8gZGF0YVwiO1xuICBjb25zdCB0b3RhbEV4cG9zZWRWb3BPdmVyMzAgPVxuICAgIGluc2lnaHRfdG90YWxFeHBvc2VkVm9wLmZpbmQoKGQpID0+IGQuaGF6YXJkID09PSBcInByb2plY3Rpb25cIilcbiAgICAgID8udG90YWxFeHBvc2VkVm9wT3ZlcjMwIHx8IDA7XG4gIGNvbnN0IHRvdGFsRXhwb3NlZFZvcE92ZXI1MCA9XG4gICAgaW5zaWdodF90b3RhbEV4cG9zZWRWb3AuZmluZCgoZCkgPT4gZC5oYXphcmQgPT09IFwicHJvamVjdGlvblwiKVxuICAgICAgPy50b3RhbEV4cG9zZWRWb3BPdmVyNTAgfHwgMDtcbiAgY29uc3QgdG90YWxFeHBvc2VkVm9wT3ZlcjMwX2IgPVxuICAgIGluc2lnaHRfdG90YWxFeHBvc2VkVm9wLmZpbmQoKGQpID0+IGQuaGF6YXJkID09PSBcImJhc2VsaW5lXCIpXG4gICAgICA/LnRvdGFsRXhwb3NlZFZvcE92ZXIzMCB8fCAwO1xuICBjb25zdCB0b3RhbEV4cG9zZWRWb3BPdmVyNTBfYiA9XG4gICAgaW5zaWdodF90b3RhbEV4cG9zZWRWb3AuZmluZCgoZCkgPT4gZC5oYXphcmQgPT09IFwiYmFzZWxpbmVcIilcbiAgICAgID8udG90YWxFeHBvc2VkVm9wT3ZlcjUwIHx8IDA7XG5cbiAgY29uc3QgZm9ybWF0Vm9wID0gKHZvcCkgPT5cbiAgICB2b3AgPT09IFwibm8gZGF0YVwiXG4gICAgICA/IHZvcFxuICAgICAgOiBmb3JtYXROdW1Db21wYWN0U2hvcnQoeyBsb2NhbGU6IGxhbmd1YWdlLmxvY2FsZSB9KSh2b3ApO1xuXG4gIGZ1bmN0aW9uIGZpbmRUb3BDcm9wQnlIYXphcmQoaGF6YXJkVHlwZSkge1xuICAgIGNvbnN0IGZpbHRlcmVkQ3JvcHMgPSBULnRpZHkoXG4gICAgICBkYXRhX3NlbGVjdGVkSGF6YXJkQ3JvcFR5cGUsXG4gICAgICBULnNlbGVjdChbXCJjcm9wVHlwZVwiLCBcImNyb3BcIiwgXCJ2b3BcIiwgXCJoYXphcmRcIl0pLFxuICAgICAgVC5maWx0ZXIoKGQpID0+IGQuY3JvcFR5cGUgPT0gXCJjcm9wXCIgJiYgZC5oYXphcmQgPT0gaGF6YXJkVHlwZSksXG4gICAgICBULnNsaWNlTWF4KDEsIFwidm9wXCIpXG4gICAgKTtcblxuICAgIHJldHVybiBmaWx0ZXJlZENyb3BzWzBdOyAvLyBBc3N1bWluZyB0aGVyZSdzIGF0IGxlYXN0IG9uZSBlbnRyeSBhZnRlciBmaWx0ZXJpbmdcbiAgfVxuXG4gIC8vIENhbGN1bGF0ZSB0b3BDcm9wX2IgYW5kIHRvcENyb3BfcCB1c2luZyB0aGUgYWRqdXN0ZWQgZnVuY3Rpb25cbiAgY29uc3QgdG9wQ3JvcF9iID0gZmluZFRvcENyb3BCeUhhemFyZChcImJhc2VsaW5lXCIpO1xuICBjb25zdCB0b3BDcm9wX3AgPSBmaW5kVG9wQ3JvcEJ5SGF6YXJkKFwicHJvamVjdGlvblwiKTtcblxuICBjb25zdCBsb3dlckJvdW5kX2IgPSBoYXphcmRQbG90TG9va3VwLmNyb3BzW3RvcENyb3BfYj8uW1wiY3JvcFwiXV0gLSA1O1xuICBjb25zdCB1cHBlckJvdW5kX2IgPSBoYXphcmRQbG90TG9va3VwLmNyb3BzW3RvcENyb3BfYj8uW1wiY3JvcFwiXV07XG5cbiAgY29uc3QgbG93ZXJCb3VuZF9wID0gaGF6YXJkUGxvdExvb2t1cC5jcm9wc1t0b3BDcm9wX3A/LltcImNyb3BcIl1dIC0gNTtcbiAgY29uc3QgdXBwZXJCb3VuZF9wID0gaGF6YXJkUGxvdExvb2t1cC5jcm9wc1t0b3BDcm9wX3A/LltcImNyb3BcIl1dO1xuXG4gIGNvbnN0IG1pc3NpbmdWYWx1ZSA9IFwiLS0tIG5vIGRhdGEgZm9yIHRoYXQgYmluIC0tLVwiO1xuXG4gIGZ1bmN0aW9uIHNob3dSZXN1bHQodmFsdWUsIGZvcm1hdCkge1xuICAgIGlmICh2YWx1ZSA9PT0gbnVsbCB8fCB2YWx1ZSA9PT0gdW5kZWZpbmVkKSByZXR1cm4gbWlzc2luZ1ZhbHVlO1xuICAgIHJldHVybiBmb3JtYXQodmFsdWUpO1xuICB9XG5cbiAgZnVuY3Rpb24gZmluZE1lZGlhbkNyb3BXaXRoVm9wKGRhdGEpIHtcbiAgICBjb25zdCBzb3J0ZWREYXRhID0gWy4uLmRhdGFdXG4gICAgICAuZmlsdGVyKChkKSA9PiAhaXNOYU4oZC52b3ApKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGEudm9wIC0gYi52b3ApO1xuICAgIGNvbnN0IG1lZGlhbkluZGV4ID0gTWF0aC5mbG9vcihzb3J0ZWREYXRhLmxlbmd0aCAvIDIpO1xuXG4gICAgaWYgKHNvcnRlZERhdGEubGVuZ3RoID09PSAwKSByZXR1cm4geyBjcm9wOiB1bmRlZmluZWQsIHZvcDogdW5kZWZpbmVkIH07XG5cbiAgICByZXR1cm4gc29ydGVkRGF0YS5sZW5ndGggJSAyICE9PSAwXG4gICAgICA/IHNvcnRlZERhdGFbbWVkaWFuSW5kZXhdXG4gICAgICA6IHNvcnRlZERhdGFbbWVkaWFuSW5kZXhdO1xuICB9XG4gIGNvbnN0IGJhc2VsaW5lRGF0YSA9IGRhdGFfc2VsZWN0ZWRIYXphcmRDcm9wVHlwZS5maWx0ZXIoXG4gICAgKGQpID0+IGQuaGF6YXJkID09PSBcImJhc2VsaW5lXCIgJiYgZC5jcm9wVHlwZSA9PSBcImNyb3BcIlxuICApO1xuICBjb25zdCBwcm9qZWN0aW9uRGF0YSA9IGRhdGFfc2VsZWN0ZWRIYXphcmRDcm9wVHlwZS5maWx0ZXIoXG4gICAgKGQpID0+IGQuaGF6YXJkID09PSBcInByb2plY3Rpb25cIlxuICApO1xuXG4gIGNvbnN0IG1lZGlhbkNyb3BJbmZvQmFzZWxpbmUgPSBmaW5kTWVkaWFuQ3JvcFdpdGhWb3AoYmFzZWxpbmVEYXRhKTtcbiAgY29uc3QgbWVkaWFuQ3JvcEluZm9Qcm9qZWN0aW9uID0gZmluZE1lZGlhbkNyb3BXaXRoVm9wKHByb2plY3Rpb25EYXRhKTtcblxuICBjb25zdCBnZXRCaW5Cb3VuZHMgPSAoY3JvcFZhbHVlKSA9PiB7XG4gICAgLy8gQXNzdW1pbmcgY3JvcFZhbHVlIGRpcmVjdGx5IHJlbGF0ZXMgdG8gdGhlIGJpbiwgYWRqdXN0IGFzIG5lY2Vzc2FyeSBmb3IgeW91ciBsb2dpY1xuICAgIGNvbnN0IGxvd2VyQm91bmQgPSBjcm9wVmFsdWUgLSAoY3JvcFZhbHVlICUgNSk7IC8vIEFkanVzdCBiYXNlZCBvbiBob3cgYmlucyBhcmUgZGVmaW5lZFxuICAgIGNvbnN0IHVwcGVyQm91bmQgPSBsb3dlckJvdW5kICsgNTtcbiAgICByZXR1cm4geyBsb3dlckJvdW5kLCB1cHBlckJvdW5kIH07XG4gIH07XG5cbiAgY29uc3QgbWVkaWFuQ3JvcEJhc2VsaW5lQm91bmRzID0gZ2V0QmluQm91bmRzKG1lZGlhbkNyb3BJbmZvQmFzZWxpbmUuY3JvcCk7XG4gIGNvbnN0IG1lZGlhbkNyb3BQcm9qZWN0aW9uQm91bmRzID0gZ2V0QmluQm91bmRzKFxuICAgIG1lZGlhbkNyb3BJbmZvUHJvamVjdGlvbi5jcm9wXG4gICk7XG5cbiAgLy8gRXhhbXBsZSBmdW5jdGlvbiB0byBjb252ZXJ0IHBlcmNlbnRhZ2VzIHRvIG1vbnRoc1xuICBmdW5jdGlvbiBwZXJjZW50VG9Nb250aHMocGVyY2VudCkge1xuICAgIHJldHVybiAocGVyY2VudCAqIDEyKSAvIDEwMDtcbiAgfVxuXG4gIC8vIENhbGN1bGF0ZSBtb250aHMgZm9yIGJhc2VsaW5lIGFuZCBwcm9qZWN0aW9uIG1lZGlhbiBiaW5zXG4gIGNvbnN0IGJhc2VsaW5lTW9udGhzTG93ZXIgPSBwZXJjZW50VG9Nb250aHMoXG4gICAgbWVkaWFuQ3JvcEJhc2VsaW5lQm91bmRzLmxvd2VyQm91bmRcbiAgKTtcbiAgY29uc3QgYmFzZWxpbmVNb250aHNVcHBlciA9IHBlcmNlbnRUb01vbnRocyhcbiAgICBtZWRpYW5Dcm9wQmFzZWxpbmVCb3VuZHMudXBwZXJCb3VuZFxuICApO1xuICBjb25zdCBwcm9qZWN0aW9uTW9udGhzTG93ZXIgPSBwZXJjZW50VG9Nb250aHMoXG4gICAgbWVkaWFuQ3JvcFByb2plY3Rpb25Cb3VuZHMubG93ZXJCb3VuZFxuICApO1xuICBjb25zdCBwcm9qZWN0aW9uTW9udGhzVXBwZXIgPSBwZXJjZW50VG9Nb250aHMoXG4gICAgbWVkaWFuQ3JvcFByb2plY3Rpb25Cb3VuZHMudXBwZXJCb3VuZFxuICApO1xuXG4gIGxldCBwZXJjZW50Q2hhbmdlID1cbiAgICAoKHRvdGFsRXhwb3NlZFZvcE92ZXI1MCAtIHRvdGFsRXhwb3NlZFZvcE92ZXI1MF9iKSAvXG4gICAgICB0b3RhbEV4cG9zZWRWb3BPdmVyNTBfYikgKlxuICAgIDEwMDtcbiAgcGVyY2VudENoYW5nZSA9IE1hdGguYWJzKHBlcmNlbnRDaGFuZ2UpLnRvRml4ZWQoMSk7XG4gIGxldCBjaGFuZ2VUeXBlID0gcGVyY2VudENoYW5nZSA+PSAwID8gXCJhbiBpbmNyZWFzZVwiIDogXCJhIGRlY3JlYXNlXCI7XG5cbiAgbGV0IHBlcmNlbnRDaGFuZ2UyID1cbiAgICAoKHRvdGFsRXhwb3NlZFZvcE92ZXIzMCAtIHRvdGFsRXhwb3NlZFZvcE92ZXIzMF9iKSAvXG4gICAgICB0b3RhbEV4cG9zZWRWb3BPdmVyMzBfYikgKlxuICAgIDEwMDtcbiAgcGVyY2VudENoYW5nZTIgPSBNYXRoLmFicyhwZXJjZW50Q2hhbmdlMikudG9GaXhlZCgxKTtcbiAgbGV0IGNoYW5nZVR5cGUyID0gcGVyY2VudENoYW5nZSA+PSAwID8gXCJhbiBpbmNyZWFzZVwiIDogXCJhIGRlY3JlYXNlXCI7XG5cbiAgY29uc3Qgc2NlbmFyaW9MYWJlbCA9XG4gICAgc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUuc2NlbmFyaW8gPT09IFwiU1NQMlwiID8gXCJTU1AyIDQuNVwiIDogXCJTU1A1IDguNVwiO1xuXG4gIC8vIGNvbnN0IG92ZXIzMEluc2lnaHQgPSBgRm9yIHRoZSBiYXNlbGluZSBwZXJpb2QsICoqJHtmb3JtYXRWb3AoXG4gIC8vICAgdG90YWxFeHBvc2VkVm9wT3ZlcjUwX2JcbiAgLy8gKX0qKiBwZW9wbGUgZXhwZXJpZW5jZWQgdW5zYWZlIHdvcmtpbmcgY29uZGl0aW9ucyBmb3IgYXQgbGVhc3QgKipoYWxmIG9mIHRoZSBkYXlzKiogaW4gdGhlIHllYXIuIFVuZGVyIHRoZSBzY2VuYXJpbyAqKiR7c2NlbmFyaW9MYWJlbH0qKiBhbmQgeWVhciAqKiR7XG4gIC8vICAgc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUudGltZWZyYW1lXG4gIC8vIH0qKiwgaXQncyBleHBlY3RlZCB0byByaXNlIHRvICoqJHtmb3JtYXRWb3AoXG4gIC8vICAgdG90YWxFeHBvc2VkVm9wT3ZlcjUwXG4gIC8vICl9KiogcGVvcGxlLmA7XG5cbiAgY29uc3QgaW5zaWdodE92ZXIzMCA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXMoXG4gICAgX2xhbmcobmJUZXh0LnNlY3Rpb25zLmhlYXRTdHJlc3MucXVpY2tJbnNpZ2h0cy5vdmVydmlldyksXG4gICAgW1xuICAgICAgeyBuYW1lOiBcImJhc2VSaXNrXCIsIHZhbHVlOiBmb3JtYXRWb3AodG90YWxFeHBvc2VkVm9wT3ZlcjMwX2IpIH0sXG4gICAgICB7IG5hbWU6IFwic2NlbmFyaW9cIiwgdmFsdWU6IHNjZW5hcmlvTGFiZWwgfSxcbiAgICAgIHsgbmFtZTogXCJ5ZWFyXCIsIHZhbHVlOiBzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZS50aW1lZnJhbWUgfSxcbiAgICAgIHsgbmFtZTogXCJwcm9qZWN0aW9uUmlza1wiLCB2YWx1ZTogZm9ybWF0Vm9wKHRvdGFsRXhwb3NlZFZvcE92ZXIzMCkgfVxuICAgIF1cbiAgKTtcblxuICBjb25zdCBpbnNpZ2h0T3ZlcjUwID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICBfbGFuZyhuYlRleHQuc2VjdGlvbnMuaGVhdFN0cmVzcy5xdWlja0luc2lnaHRzLmhhbGYpLFxuICAgIFtcbiAgICAgIHsgbmFtZTogXCJiYXNlbGluZVwiLCB2YWx1ZTogZm9ybWF0Vm9wKHRvdGFsRXhwb3NlZFZvcE92ZXI1MF9iKSB9LFxuICAgICAgeyBuYW1lOiBcInNjZW5hcmlvXCIsIHZhbHVlOiBzY2VuYXJpb0xhYmVsIH0sXG4gICAgICB7IG5hbWU6IFwieWVhclwiLCB2YWx1ZTogc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUudGltZWZyYW1lIH0sXG4gICAgICB7IG5hbWU6IFwicHJvamVjdGlvblwiLCB2YWx1ZTogZm9ybWF0Vm9wKHRvdGFsRXhwb3NlZFZvcE92ZXI1MCkgfVxuICAgIF1cbiAgKTtcblxuICAvLyBjb25zdCBvdmVyNTBJbnNpZ2h0ID0gYEZvciBvdmVyICoqMTAwIGRheXMqKiBpbiBhIHllYXIsIHRoZSBwZW9wbGUgYXQgcmlzayBmb3IgdGhlIGJhc2VsaW5lIHdlcmUgKioke2Zvcm1hdFZvcChcbiAgLy8gICB0b3RhbEV4cG9zZWRWb3BPdmVyMzBfYlxuICAvLyApfSoqOyB1bmRlciB0aGUgc2NlbmFyaW8gKioke3NjZW5hcmlvTGFiZWx9KiogYW5kIHllYXIgKioke1xuICAvLyAgIHNlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lLnRpbWVmcmFtZVxuICAvLyB9KiosIGl0IGFzY2VuZHMgdG8gKioke2Zvcm1hdFZvcCh0b3RhbEV4cG9zZWRWb3BPdmVyMzApfSoqLmA7XG5cbiAgY29uc3QgbWVkaWFuRXhwbGFuYXRpb24gPSBgV2hlbiB3ZSBzYXkgd2UncmUgJ2xvb2tpbmcgYXQgdGhlIG1lZGlhbicsIHdlIG1lYW4gZm9jdXNpbmcgb24gdGhlIGdyb3VwIGluIHRoZSBleGFjdCBtaWRkbGUgd2hlbiBhcnJhbmdpbmcgZXZlcnlvbmUgZnJvbSB0aGUgbGVhc3QgdG8gdGhlIG1vc3QgZXhwb3NlZCB0byBoZWF0IHN0cmVzcyBvdmVyIHRoZSB5ZWFyLiBJdCdzIGxpa2UgZmluZGluZyB0aGUgbWlkZGxlIHBvaW50IGluIGEgbGluZSBvZiBwZW9wbGUgc29ydGVkIGJ5IGhvdyBsb25nIHRoZXkncmUgZXhwb3NlZCB0byBoaWdoIGhlYXQuYDtcblxuICBjb25zdCBzZWxlY3RlZENvdW50cnkgPSBnZXRBZG1pblNlbGVjdGlvbjAoKS52YWx1ZTsgLy8gRnVuY3Rpb24gdG8gZ2V0IHRoZSBzZWxlY3RlZCBjb3VudHJ5XG4gIGNvbnN0IGNvdW50cmllc1dpdGhvdXREYXRhID0gW1xuICAgIFwiQnVydW5kaVwiLFxuICAgIFwiUndhbmRhXCIsXG4gICAgXCJMZXNvdGhvXCIsXG4gICAgXCJHYWJvblwiLFxuICAgIFwiRXN3YXRpbmlcIixcbiAgICBcIkVxdWF0b3JpYWwgR3VpbmVhXCJcbiAgXTtcblxuICAvLyBDaGVjayBpZiB0aGUgc2VsZWN0ZWQgY291bnRyeSBpcyBpbiB0aGUgbGlzdCBvZiBjb3VudHJpZXMgd2l0aG91dCBkYXRhXG4gIGlmIChjb3VudHJpZXNXaXRob3V0RGF0YS5pbmNsdWRlcyhzZWxlY3RlZENvdW50cnkpKSB7XG4gICAgcmV0dXJuIG1kYCR7X2xhbmcobmJUZXh0LnNlY3Rpb25zLnF1aWNrSW5zaWdodHNHZW5lcmFsLm5vRGF0YUJsdXJiKX1gO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBtZGAke2luc2lnaHRPdmVyMzB9XG5cbiR7aW5zaWdodE92ZXI1MH1gO1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgIyAke19sYW5nKG5iVGV4dC5zZWN0aW9ucy53b3JraW5nSG91cnMudGl0bGUpfVxuXG4ke19sYW5nKG5iVGV4dC5zZWN0aW9ucy53b3JraW5nSG91cnMuaW50cm8pfWA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld0JpbmRBZG1pblNlbGVjdG9ycyA9IC8vIGZvcm1hdCBhZG1pbiBzZWxlY3Rpb25zXG4vLyBiaW5kIHRvIGFwcGVuZGl4IGlucHV0cywgYWRkIHRlbXBsYXRlIHRvIGZvcm1hdFxuSW5wdXRzLmZvcm0oXG4gIFtcbiAgICBJbnB1dHMuYmluZChcbiAgICAgIElucHV0cy5zZWxlY3QoZGF0YUFkbWluMCwgeyBsYWJlbDogYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjAsIGZvcm1hdDogeCA9PiB4LmxhYmVsIH0pLFxuICAgICAgdmlld29mIHNlbGVjdEFkbWluMFxuICAgICksXG4gICAgSW5wdXRzLmJpbmQoXG4gICAgICBJbnB1dHMuc2VsZWN0KGRhdGFBZG1pbjEsIHsgbGFiZWw6IGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4xLCBmb3JtYXQ6IHggPT4geC5sYWJlbCB9KSxcbiAgICAgIHZpZXdvZiBzZWxlY3RBZG1pbjFcbiAgICApLFxuICAgIElucHV0cy5iaW5kKFxuICAgICAgSW5wdXRzLnNlbGVjdChkYXRhQWRtaW4yLCB7IGxhYmVsOiBhZG1pblJlZ2lvbnMubGFiZWxzLmFkbWluMiwgZm9ybWF0OiB4ID0+IHgubGFiZWwgfSksXG4gICAgICB2aWV3b2Ygc2VsZWN0QWRtaW4yXG4gICAgKVxuICBdLFxuICB7XG4gICAgdGVtcGxhdGU6IGFkbWluRm9ybVRlbXBsYXRlXG4gIH1cbilcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2Ygc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUyID0ge1xuICAvLyBzY2VuYXJpbyBhbmQgdGltZWZyYW1lXG5cbiAgY29uc3QgZGF0YSA9IFtcbiAgICAvLyB7bGFiZWw6ICdTU1AyNDU6IDIwMzAnLCBzY2VuYXJpbzogJ1NTUDInLCB0aW1lZnJhbWU6ICcyMDMwJ30sXG4gICAge2xhYmVsOiAnU1NQMjQ1OiAyMDUwJywgc2NlbmFyaW86ICdTU1AyNDUnLCB0aW1lZnJhbWU6ICcyMDUwJ30sXG4gICAgLy8ge2xhYmVsOiAnU1NQNTg1OiAyMDMwJywgc2NlbmFyaW86ICdTU1A1JywgdGltZWZyYW1lOiAnMjAzMCd9LFxuICAgIHtsYWJlbDogJ1NTUDU4NTogMjA1MCcsIHNjZW5hcmlvOiAnU1NQNTg1JywgdGltZWZyYW1lOiAnMjA1MCd9LFxuICBdXG4gIFxuICByZXR1cm4gSW5wdXRzLnNlbGVjdChkYXRhLCB7XG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5sZWdlbmRzLnNjZW5hcmlvKSxcbiAgICBmb3JtYXQ6IHggPT4geC5sYWJlbCxcbiAgICB2YWx1ZTogZGF0YS5maW5kKGQgPT4gZC5sYWJlbCA9PT0gJ1NTUDI0NTogMjA1MCcpXG4gIH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBzZWxlY3RUaHJlc2hvbGQyID0ge1xuICAvLyB0aHJlc2hvbGRcblxuICBjb25zdCBkYXRhID0gW1xuICAgIHtsYWJlbDogJzI4wrBDJywgdGhyZXNob2xkOiAnMjgnfSxcbiAgICB7bGFiZWw6ICczMMKwQycsIHRocmVzaG9sZDogJzMwJ30sXG4gICAge2xhYmVsOiAnMzLCsEMnLCB0aHJlc2hvbGQ6ICczMid9LFxuICBdXG4gIFxuICByZXR1cm4gSW5wdXRzLnNlbGVjdChkYXRhLCB7XG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5sZWdlbmRzLnRocmVzaG9sZCksXG4gICAgZm9ybWF0OiB4ID0+IHgubGFiZWwsXG4gICAgdmFsdWU6IGRhdGEuZmluZChkID0+IGQubGFiZWwgPT09ICczMCcpXG4gIH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiByYWRpb3MgPSB7XG4gIGNvbnN0IGRhdGEgPSBbXG4gICAge1xuICAgICAgbGFiZWw6IExhbmcudG9UaXRsZUNhc2UoX2xhbmcobmJUZXh0LmxlZ2VuZHMuc2Vhc29uVHlwZXMucGxhbnRpbmcpKSxcbiAgICAgIHZhbHVlOiBcInBsYW50aW5nXCJcbiAgICB9LFxuICAgIHtcbiAgICAgIGxhYmVsOiBMYW5nLnRvVGl0bGVDYXNlKF9sYW5nKG5iVGV4dC5sZWdlbmRzLnNlYXNvblR5cGVzLmhhcnZlc3RpbmcpKSxcbiAgICAgIHZhbHVlOiBcImhhcnZlc3RpbmdcIlxuICAgIH1cbiAgXTtcbiAgcmV0dXJuIElucHV0cy5yYWRpbyhkYXRhLCB7XG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5sZWdlbmRzLnNlYXNvbiksXG4gICAgZm9ybWF0OiAoeCkgPT4geC5sYWJlbCxcbiAgICB2YWx1ZTogZGF0YS5maW5kKCh4KSA9PiB4LnZhbHVlID09IFwicGxhbnRpbmdcIilcbiAgfSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGxvdEhvdXJTZWFzb25Mb3NzID0ge1xuICBjb25zdCBfYW55RGF0YSA9IFQudGlkeShcbiAgICBkYXRhX2hvdXJseVN0cmVzcyxcbiAgICBULmdyb3VwQnkoXG4gICAgICBbXG4gICAgICAgIFwiYWRtaW4wX25hbWVcIixcbiAgICAgICAgXCJhZG1pbjFfbmFtZVwiLFxuICAgICAgICBcImFkbWluMl9uYW1lXCIsXG4gICAgICAgIFwic2NlbmFyaW9cIixcbiAgICAgICAgXCJ0aW1lZnJhbWVcIixcbiAgICAgICAgXCJ0aHJlc2hvbGRcIixcbiAgICAgICAgXCJob3VyX2RheVwiXG4gICAgICBdLFxuICAgICAgW1xuICAgICAgICBULnN1bW1hcml6ZSh7XG4gICAgICAgICAgdm9wX2FueTogVC5tZWFuKFwiZGVsdGFcIilcbiAgICAgICAgfSlcbiAgICAgIF1cbiAgICApXG4gICk7XG5cbiAgY29uc3QgX2RhdGFXaXRoQW55Q29sdW1uID0gVC50aWR5KFxuICAgIGRhdGFfaG91cmx5U3RyZXNzLFxuICAgIFQubGVmdEpvaW4oX2FueURhdGEsIHtcbiAgICAgIGJ5OiBbXG4gICAgICAgIFwiYWRtaW4wX25hbWVcIixcbiAgICAgICAgXCJhZG1pbjFfbmFtZVwiLFxuICAgICAgICBcImFkbWluMl9uYW1lXCIsXG4gICAgICAgIFwic2NlbmFyaW9cIixcbiAgICAgICAgXCJ0aW1lZnJhbWVcIixcbiAgICAgICAgXCJob3VyX2RheVwiLFxuICAgICAgICBcInRocmVzaG9sZFwiXG4gICAgICBdXG4gICAgfSlcbiAgKTtcblxuICBjb25zdCBkYXRhID0gX2RhdGFXaXRoQW55Q29sdW1uLmZpbHRlcihkID0+IGQuaGF6YXJkID09IHJhZGlvcy52YWx1ZSk7XG4gIGNvbnN0IGRhdGFBbnkgPSBkYXRhLmZpbHRlcigoZCkgPT4gZC5oYXphcmQgPT0gXCJhbnlcIik7IC8vIGNvbWJpbmVkXG4gIGNvbnN0IGRhdGFCYXJzID0gW1xuICAgIC4uLmRhdGEuZmlsdGVyKChkKSA9PiBkLmhhemFyZCAhPT0gXCJhbnlcIiAmJiBkLmRlbHRhICE9PSAwKSAvLyByZW1vdmUgdGhlIGNvbWJpbmVkIGhhemFyZFxuICBdO1xuXG4gIGNvbnN0IF9mb3JtYXRQZXJjZW50ID0gKG51bSkgPT4ge1xuICByZXR1cm4gYCR7bnVtLnRvRml4ZWQoMSl9JWA7XG59O1xuICBjb25zdCB4RG9tYWluID0gaG91cmx5TmFtZXMubWFwKGQgPT4gZC5ob3VybHlOYW1lKTtcblxuICBjb25zdCBtYXhWYWx1ZSA9IGQzLm1heChkYXRhQmFycywgKGQpID0+IGQuZGVsdGEpICogMS43NTsgLy8gYWRkaW5nIDEwJSBidWZmZXJcblxuICByZXR1cm4gUGxvdC5wbG90KHtcbiAgICAvLyBjYXB0aW9uOiBgVGhlIGRhdGEgb24gdGhlIHBsb3QgYWJvdmUgaXMgc3RhY2tlZCBmb3IgdmlzdWFsaXphdGlvbiBwdXJwb3NlcywgYnV0IHBlcmNlbnRhZ2VzIGFyZSBiYXNlZCBvbiBkaWZmZXJlbnQgcGFydHMgb2YgdGhlIHllYXIsIGRlcGVuZGluZyBvbiB0aGUgc2Vhc29uLmAsXG4gICAgd2lkdGg6IDgwMCxcbiAgICBoZWlnaHQ6IDUwMCxcbiAgICBtYXJnaW5MZWZ0OiA0MCxcbiAgICBtYXJnaW5SaWdodDogNSxcbiAgICBtYXJnaW5Cb3R0b206IDM1LFxuICAgIGNvbG9yOiB7XG4gICAgICBkb21haW46IGhvdXJseVBsb3RMb29rdXAuY29sb3IuZG9tYWluLFxuICAgICAgcmFuZ2U6IGhvdXJseVBsb3RMb29rdXAuY29sb3IucmFuZ2UsXG4gICAgICBsZWdlbmQ6IGZhbHNlXG4gICAgfSxcbiAgICB4OiB7XG4gICAgICBkb21haW46IHhEb21haW4sXG4gICAgICBsYWJlbDogX2xhbmcobmJUZXh0LnNlY3Rpb25zLndvcmtpbmdIb3Vycy5iYXJDaGFydC54TGFiZWwpXG4gICAgfSxcbiAgICB5OiB7XG4gICAgICBkb21haW46IFswLCBtYXhWYWx1ZV0sXG4gICAgICBncmlkOiB0cnVlLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy53b3JraW5nSG91cnMuYmFyQ2hhcnQueUxhYmVsKSxcbiAgICAgIC8vIHRpY2tTaXplOiAwLCAvLyBTZXQgdGljayBzaXplIHRvIDAgdG8gaGlkZSB0aGUgdGlja3NcbiAgICAgIC8vIHRpY2tGb3JtYXQ6ICgpID0+IFwiXCIsIC8vIFJldHVybiBhbiBlbXB0eSBzdHJpbmcgdG8gaGlkZSB0aWNrIGxhYmVsc1xuICAgIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIC8vIG1haW4geS1heGlzXG4gICAgICBQbG90LmF4aXNYKHtcbiAgICAgICAgdGlja1NpemU6IDAsXG4gICAgICB9KSxcbiAgICAgIC8vIHBvaW50ZXIgd2hpdGUtb3V0XG4gICAgICBQbG90LmF4aXNYKFxuICAgICAgICBQbG90LnBvaW50ZXJYKHtcbiAgICAgICAgICBsYWJlbDogbnVsbCxcbiAgICAgICAgICBmaWxsOiBcIndoaXRlXCIsXG4gICAgICAgICAgdGV4dFN0cm9rZTogXCJ3aGl0ZVwiLFxuICAgICAgICAgIHRleHRTdHJva2VXaWR0aDogMixcbiAgICAgICAgICB0aWNrU2l6ZTogMFxuICAgICAgICB9KVxuICAgICAgKSxcbiAgICAgIC8vIGJvbGQgcG9pbnRlclxuICAgICAgUGxvdC5heGlzWChcbiAgICAgICAgUGxvdC5wb2ludGVyWCh7XG4gICAgICAgICAgbGFiZWw6IG51bGwsXG4gICAgICAgICAgZm9udFdlaWdodDogXCJib2xkXCIsXG4gICAgICAgICAgdGlja1NpemU6IDBcbiAgICAgICAgfSlcbiAgICAgICksXG4gICAgICAvLyBoYXphcmQgY29tcG9uZW50IGJhcnNcbiAgICAgIFBsb3QuYmFyWShcbiAgICAgICAgZGF0YUJhcnMsXG4gICAgICAgIFBsb3Quc3RhY2tZKFxuICAgICAgICAgIHsgb3JkZXI6IGhvdXJseVBsb3RMb29rdXAuY29sb3IuZG9tYWluIH0sXG4gICAgICAgICAge1xuICAgICAgICAgICAgeTogKGQpID0+IGQuZGVsdGEsXG4gICAgICAgICAgICB4OiAoZCkgPT4gaG91cmx5UGxvdExvb2t1cC5ob3Vyc1tkLmhvdXJfZGF5XSxcbiAgICAgICAgICAgIGZpbGw6IChkKSA9PiBob3VybHlQbG90TG9va3VwLm5hbWVzW2QuaGF6YXJkXSxcbiAgICAgICAgICAgIHN0cm9rZTogXCIjZmZmXCIsXG4gICAgICAgICAgICBzdHJva2VXaWR0aDogMC4xLFxuICAgICAgICAgICAgd2lkdGg6IDEgLy8gQWRqdXN0IHRoaXMgdmFsdWUgdG8gY29udHJvbCB0aGUgdGhpY2tuZXNzIG9mIHRoZSBiYXJzXG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICApLFxuICAgICAgLy8gdG9vbHRpcFxuICAgICAgUGxvdC50aXAoXG4gICAgICAgIGRhdGFCYXJzLFxuICAgICAgICBQbG90LnBvaW50ZXJYKFxuICAgICAgICAgIFBsb3Quc3RhY2tZKFxuICAgICAgICAgICAgeyBvcmRlcjogaG91cmx5UGxvdExvb2t1cC5jb2xvci5kb21haW4gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgeTogKGQpID0+IGQuZGVsdGEsXG4gICAgICAgICAgICAgIHg6IChkKSA9PiBob3VybHlQbG90TG9va3VwLmhvdXJzW2QuaG91cl9kYXldLFxuICAgICAgICAgICAgICBmaWxsOiAoZCkgPT4gaG91cmx5UGxvdExvb2t1cC5uYW1lc1tkLmhhemFyZF0sXG4gICAgICAgICAgICAgIGNoYW5uZWxzOiB7XG4gICAgICAgICAgICAgICAgaGF6YXJkOiB7XG4gICAgICAgICAgICAgICAgICBsYWJlbDogX2xhbmcobmJUZXh0LnNlY3Rpb25zLndvcmtpbmdIb3Vycy5iYXJDaGFydC50b29sdGlwLnBlcmlvZCksXG4gICAgICAgICAgICAgICAgICB2YWx1ZTogKGQpID0+IGhvdXJseVBsb3RMb29rdXAubmFtZXNbZC5oYXphcmRdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBkZWx0YToge1xuICAgICAgICAgICAgICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5zZWN0aW9ucy53b3JraW5nSG91cnMuYmFyQ2hhcnQudG9vbHRpcC5wZXJjKSxcbiAgICAgICAgICAgICAgICAgIHZhbHVlOiAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBkZWx0YV9udW0gPSBkLmRlbHRhO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCgke2RlbHRhX251bX0pYDtcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICB2YWx1ZTogIChkKSA9PiAgX2Zvcm1hdFBlcmNlbnQoZC5kZWx0YSlcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGZvcm1hdDoge1xuICAgICAgICAgICAgICAgIHg6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHk6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGZpbGw6IGZhbHNlLFxuICAgICAgICAgICAgICAgIGRlbHRhOiB0cnVlLFxuICAgICAgICAgICAgICAgIGhhemFyZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwZXJjOiB0cnVlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICksXG4gICAgICAvLyB0b3RhbCBWb1AsIHNpZGViYXIgaGlnaGxpZ2h0XG4gICAgICBQbG90LnRleHRZKFxuICAgICAgICBkYXRhQW55LFxuICAgICAgICBQbG90LnBvaW50ZXJYKHtcbiAgICAgICAgICB5OiBtYXhWYWx1ZSxcbiAgICAgICAgICB4OiAoZCkgPT4gaG91cmx5UGxvdExvb2t1cC5ob3Vyc1tkLmhvdXJfZGF5XSxcbiAgICAgICAgICB0ZXh0OiAoZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBkLmRlbHRhX3RvdGFsO1xuICAgICAgICAgICAgcmV0dXJuIGAke3ZhbHVlfWA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZXh0QW5jaG9yOiBcInN0YXJ0XCIsXG4gICAgICAgICAgZHg6IDVcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICBdXG4gIH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgbGV0IGRhdGEgPSBULnRpZHkoXG4gICAgZGF0YV9ob3VybHlTdHJlc3MsXG4gICAgVC5ncm91cEJ5KFxuICAgICAgW1xuICAgICAgICBcImFkbWluMF9uYW1lXCIsXG4gICAgICAgIFwiYWRtaW4xX25hbWVcIixcbiAgICAgICAgXCJhZG1pbjJfbmFtZVwiLFxuICAgICAgICBcInNjZW5hcmlvXCIsXG4gICAgICAgIFwidGltZWZyYW1lXCIsXG4gICAgICAgIFwidGhyZXNob2xkXCIsXG4gICAgICAgIFwiaG91cl9kYXlcIlxuICAgICAgXSxcbiAgICAgIFtcbiAgICAgICAgVC5zdW1tYXJpemUoe1xuICAgICAgICAgIHZvcF9hbnk6IFQubWVhbihcImRlbHRhXCIpXG4gICAgICAgIH0pXG4gICAgICBdXG4gICAgKVxuICApO1xuICByZXR1cm4gYnVpbGRJbmxpbmVEb3dubG9hZEJ1dHRvbihkYXRhLCBfbGFuZyhkb3dubG9hZF90cmFuc2xhdGlvbiksIGBob3VybHlIdW1hbkhlYXRTdHJlc3NfJHtzZWxlY3RBZG1pbjAubGFiZWwucmVwbGFjZSgvXFxzL2csIFwiXCIpfWApXG4gIH1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJoZWFkZXJRdWlja0luc2lnaHRzSG91cmx5ID0ge1xuICBjb25zdCBhZG1pbkFydGljbGUgPSBfbGFuZyhnZXRBZG1pblNlbGVjdGlvbigpPy5kYXRhPy5hcnRpY2xlMSk7XG4gIGNvbnN0IGFkbWluU2VsZWN0aW9uID0gYWRtaW5BcnRpY2xlID8/IGdldEFkbWluU2VsZWN0aW9uKCkubGFiZWw7XG4gIGNvbnN0IHRleHQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5xdWlja0luc2lnaHRzR2VuZXJhbC5oZWFkZXIpLFxuICAgIFt7IG5hbWU6IFwic2VsZWN0aW9uXCIsIHZhbHVlOiBhZG1pblNlbGVjdGlvbiB9XVxuICApO1xuXG4gIHJldHVybiBtZGAjIyMgJHt0ZXh0fVxuJHtzdHlsaW5nfWA7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW5zaWdodHNIb3VyU2Vhc29uTG9zcyA9IHtcbiAgY29uc3QgaSA9IGR5bmFtaWNJbnNpZ2h0c19nZW9JbXBhY3QuaW5zaWdodDtcblxuICBjb25zdCBjdXJyZW50QWdQb3AgPSBpLnRvdGFsQWdQb3Bfbm9mb3JtYXQ7XG4gIC8vIHRvdGFsVm9wIGlzIHRoZSBwcm9qZWN0ZWQgY2hhbmdlIGluIGFncmljdWx0dXJhbCBwb3B1bGF0aW9uIGJ5IDIwNTBcblxuICBjb25zdCBwcm9qZWN0ZWRDaGFuZ2UyMDUwID0gaS50b3RhbEFnUG9wXzVfNTBfbm9mb3JtYXQ7XG4gIGNvbnN0IHByb2plY3RlZENoYW5nZTIwMzAgPSBpLnRvdGFsVm9wTWlkX25vZm9ybWF0O1xuICBjb25zdCBwb3BfMjA1MCA9IGN1cnJlbnRBZ1BvcCArIHByb2plY3RlZENoYW5nZTIwNTA7XG4gIGNvbnN0IGNyb3AgPSBpbnNpZ2h0X3RvdGFsRXhwb3NlZEhvdXJseS5maWx0ZXIoXG4gICAgKGQpID0+IGQudG90YWxFeHBvc2VkSG91cmx5ICE9PSAwICYmIGQuaG91cl9kYXlUeXBlID09IFwiaG91cl9kYXlcIlxuICApPy5bMF0/LltcInRvdGFsRXhwb3NlZEhvdXJseVwiXTtcblxuICBjb25zdCBwb3Bfc3VtMiA9IGluc2lnaHRfdG90YWxFeHBvc2VkSG91cmx5LmZpbHRlcihcbiAgICAoZCkgPT4gZC5jb3JyZWN0ZWRfcG9wX3N1bSAhPT0gMCAmJiBkLmhvdXJfZGF5VHlwZSA9PSBcImhvdXJfZGF5XCJcbiAgKT8uWzBdPy5bXCJjb3JyZWN0ZWRfcG9wX3N1bVwiXTtcblxuICBjb25zdCB0b3RhbFBlcmNlbnRIYXJ2ZXN0aW5nID1cbiAgICBpbnNpZ2h0X3RvdGFsRXhwb3NlZEhvdXJseS5maW5kKFxuICAgICAgKGQpID0+IGQuaG91cl9kYXlUeXBlID09PSBcImhvdXJfZGF5XCIgJiYgZC5oYXphcmQgPT09IFwiaGFydmVzdGluZ1wiXG4gICAgKT8udG90YWxFeHBvc2VkSG91cmx5IHx8IFwibm8gZGF0YVwiO1xuICBjb25zdCB0b3RhbFBlcmNlbnRQbGFudGluZyA9XG4gICAgaW5zaWdodF90b3RhbEV4cG9zZWRIb3VybHkuZmluZChcbiAgICAgIChkKSA9PiBkLmhvdXJfZGF5VHlwZSA9PT0gXCJob3VyX2RheVwiICYmIGQuaGF6YXJkID09PSBcInBsYW50aW5nXCJcbiAgICApPy50b3RhbEV4cG9zZWRIb3VybHkgfHwgXCJubyBkYXRhXCI7XG5cbiAgY29uc3QgZm9ybWF0Vm9wID0gKHZvcCkgPT5cbiAgICB2b3AgPT09IFwibm8gZGF0YVwiXG4gICAgICA/IHZvcFxuICAgICAgOiBmb3JtYXROdW1Db21wYWN0U2hvcnQoeyBsb2NhbGU6IGxhbmd1YWdlLmxvY2FsZSB9KSh2b3ApO1xuXG4gIGNvbnN0IHRvcEhvdXJfZGF5ID0gaW5zaWdodF90b3BIb3VybHkuZmlsdGVyKFxuICAgIChkKSA9PiBkLmRlbHRhICE9PSAwICYmIGQuaG91cl9kYXlUeXBlID09IFwiaG91cl9kYXlcIlxuICApPy5bMF07XG5cbiAgY29uc3QgbWlzc2luZ1ZhbHVlID0gXCItLS0gbm8gZGF0YSBmb3IgdGhhdCBiaW4gLS0tXCI7XG5cbiAgZnVuY3Rpb24gc2hvd1Jlc3VsdCh2YWx1ZSwgZm9ybWF0KSB7XG4gICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHJldHVybiBtaXNzaW5nVmFsdWU7XG4gICAgcmV0dXJuIGZvcm1hdCh2YWx1ZSk7XG4gIH1cblxuICAvLyBGaW5kIGEgcm93IGZvciBlYWNoIGhhemFyZCB0eXBlIHRvIGdldCBwZXJpb2QgYW5kIHRvdGFsX2RheXNcbiAgY29uc3QgaGFydmVzdGluZ0luc2lnaHQgPSBpbnNpZ2h0X3RvdGFsRXhwb3NlZEhvdXJseS5maW5kKFxuICAgIChkKSA9PiBkLmhhemFyZCA9PT0gXCJoYXJ2ZXN0aW5nXCJcbiAgKTtcbiAgY29uc3QgcGxhbnRpbmdJbnNpZ2h0ID0gaW5zaWdodF90b3RhbEV4cG9zZWRIb3VybHkuZmluZChcbiAgICAoZCkgPT4gZC5oYXphcmQgPT09IFwicGxhbnRpbmdcIlxuICApO1xuXG4gIGNvbnN0IHBlcmlvZEhhcnZlc3RpbmcgPVxuICAgIGluc2lnaHRfdG90YWxFeHBvc2VkSG91cmx5LmZpbmQoXG4gICAgICAoZCkgPT4gZC5ob3VyX2RheVR5cGUgPT09IFwiaG91cl9kYXlcIiAmJiBkLmhhemFyZCA9PT0gXCJoYXJ2ZXN0aW5nXCJcbiAgICApPy5wZXJpb2QgfHwgXCJubyBkYXRhXCI7XG4gIGNvbnN0IHRvdGFsRGF5c0hhcnZlc3RpbmcgPSBoYXJ2ZXN0aW5nSW5zaWdodFxuICAgID8gaGFydmVzdGluZ0luc2lnaHQuZGF5c19wZXJpb2RcbiAgICA6IFwibm8gZGF0YVwiO1xuICBjb25zdCBwZXJpb2RQbGFudGluZyA9IHBsYW50aW5nSW5zaWdodCA/IHBsYW50aW5nSW5zaWdodC5wZXJpb2QgOiBcIm5vIGRhdGFcIjtcbiAgY29uc3QgdG90YWxEYXlzUGxhbnRpbmcgPSBwbGFudGluZ0luc2lnaHRcbiAgICA/IHBsYW50aW5nSW5zaWdodC5kYXlzX3BlcmlvZFxuICAgIDogXCJubyBkYXRhXCI7XG5cbiAgY29uc3QgcG9wX3N1bSA9IGhhcnZlc3RpbmdJbnNpZ2h0XG4gICAgPyBoYXJ2ZXN0aW5nSW5zaWdodC5jb3JyZWN0ZWRfcG9wX3N1bVxuICAgIDogXCJubyBkYXRhXCI7XG4gIGNvbnN0IGRlbHRhX21lYW4gPSBoYXJ2ZXN0aW5nSW5zaWdodFxuICAgID8gaGFydmVzdGluZ0luc2lnaHQuZGVsdGFfcG9wX21lYW5cbiAgICA6IFwibm8gZGF0YVwiO1xuXG4gIGNvbnN0IHRvdGFsUGVyY2VudEhhcnZlc3RpbmdOdW1lcmljID1cbiAgICB0b3RhbFBlcmNlbnRIYXJ2ZXN0aW5nICE9PSBcIm5vIGRhdGFcIlxuICAgICAgPyBwYXJzZUZsb2F0KHRvdGFsUGVyY2VudEhhcnZlc3RpbmcpXG4gICAgICA6IDA7XG4gIGNvbnN0IHRvdGFsRGF5c0hhcnZlc3RpbmdOdW1lcmljID1cbiAgICB0b3RhbERheXNIYXJ2ZXN0aW5nICE9PSBcIm5vIGRhdGFcIiA/IHBhcnNlRmxvYXQodG90YWxEYXlzSGFydmVzdGluZykgOiAwO1xuICBjb25zdCB0b3RhbFBlcmNlbnRQbGFudGluZ051bWVyaWMgPVxuICAgIHRvdGFsUGVyY2VudFBsYW50aW5nICE9PSBcIm5vIGRhdGFcIiA/IHBhcnNlRmxvYXQodG90YWxQZXJjZW50UGxhbnRpbmcpIDogMDtcbiAgY29uc3QgdG90YWxEYXlzUGxhbnRpbmdOdW1lcmljID1cbiAgICB0b3RhbERheXNQbGFudGluZyAhPT0gXCJubyBkYXRhXCIgPyBwYXJzZUZsb2F0KHRvdGFsRGF5c1BsYW50aW5nKSA6IDA7XG5cbiAgY29uc3QgcG9wX3N1bU51bWVyaWMgPSBwb3BfMjA1MCAhPT0gXCJubyBkYXRhXCIgPyBwYXJzZUZsb2F0KHBvcF8yMDUwKSA6IDA7XG5cbiAgY29uc3QgdG90YWxIb3Vyc0xvc3RIYXJ2ZXN0ID1cbiAgICAodG90YWxQZXJjZW50SGFydmVzdGluZ051bWVyaWMgLyAxMDApICpcbiAgICB0b3RhbERheXNIYXJ2ZXN0aW5nTnVtZXJpYyAqXG4gICAgcG9wX3N1bU51bWVyaWM7XG4gIGNvbnN0IHRvdGFsSG91cnNMb3N0UGxhbnRpbmcgPVxuICAgICh0b3RhbFBlcmNlbnRQbGFudGluZ051bWVyaWMgLyAxMDApICpcbiAgICB0b3RhbERheXNQbGFudGluZ051bWVyaWMgKlxuICAgIHBvcF9zdW1OdW1lcmljO1xuXG4gIGNvbnN0IHRvdGFsV29ya2luZ0RheXNMb3N0SGFydmVzdCA9IHRvdGFsSG91cnNMb3N0SGFydmVzdCAvIDg7IC8vIGFzc3VtaW5nIDhoIHdvcmtpbmcgZGF5XG4gIGNvbnN0IHRvdGFsV29ya2luZ0RheXNMb3N0UGxhbnRpbmcgPSB0b3RhbEhvdXJzTG9zdFBsYW50aW5nIC8gODsgLy8gYXNzdW1pbmcgOGggd29ya2luZyBkYXlcblxuICBjb25zdCB0b3RhbFdvcmtpbmdEYXlzTG9zdEhhcnZlc3RGb3JtYXR0ZWQgPSBmb3JtYXRWb3AoXG4gICAgdG90YWxXb3JraW5nRGF5c0xvc3RIYXJ2ZXN0LnRvRml4ZWQoMSlcbiAgKTsgLy8gZm9ybWF0dGluZ1xuICBjb25zdCB0b3RhbFdvcmtpbmdEYXlzTG9zdFBsYW50aW5nRm9ybWF0dGVkID0gZm9ybWF0Vm9wKFxuICAgIHRvdGFsV29ya2luZ0RheXNMb3N0UGxhbnRpbmcudG9GaXhlZCgxKVxuICApOyAvLyBmb3JtYXR0aW5nXG5cblxuICBjb25zdCBpbnNpZ2h0SW50cm8gPSBfbGFuZyhuYlRleHQuc2VjdGlvbnMud29ya2luZ0hvdXJzLnF1aWNrSW5zaWdodHMuaW50cm8pO1xuICBjb25zdCBpbnNpZ2h0Qm9keSA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXMoXG4gICAgX2xhbmcobmJUZXh0LnNlY3Rpb25zLndvcmtpbmdIb3Vycy5xdWlja0luc2lnaHRzLmJvZHkpLFxuICAgIFtcbiAgICAgIHsgbmFtZTogXCJzY2VuYXJpb1wiLCB2YWx1ZTogc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUyLnNjZW5hcmlvIH0sXG4gICAgICB7IG5hbWU6IFwieWVhclwiLCB2YWx1ZTogc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUyLnRpbWVmcmFtZSB9LFxuICAgICAgeyBuYW1lOiBcInRvdGFsSG91cnNcIiwgdmFsdWU6IGZvcm1hdFZvcCh0b3RhbEhvdXJzTG9zdEhhcnZlc3QpIH0sXG4gICAgICB7IG5hbWU6IFwiZGF5c0hhcnZlc3RcIiwgdmFsdWU6IGZvcm1hdFZvcCh0b3RhbERheXNIYXJ2ZXN0aW5nKSB9LFxuICAgICAgeyBuYW1lOiBcIndob2xlV29ya2luZ0RheXNcIiwgdmFsdWU6IHRvdGFsV29ya2luZ0RheXNMb3N0SGFydmVzdEZvcm1hdHRlZCB9XG4gICAgXVxuICApO1xuICBjb25zdCBpbnNpZ2h0TG9zdERheXMgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5zZWN0aW9ucy53b3JraW5nSG91cnMucXVpY2tJbnNpZ2h0cy5sb3N0RGF5cyksXG4gICAgW1xuICAgICAgeyBuYW1lOiBcInBlcmlvZFwiLCB2YWx1ZTogZm9ybWF0Vm9wKHRvdGFsRGF5c1BsYW50aW5nKSB9LFxuICAgICAgeyBuYW1lOiBcImdlb1wiLCB2YWx1ZTogZ2V0QWRtaW4wV2l0aEFkbWluU3ViUGFyZW5zKHthcnRpY2xlRmllbGQ6IFwiYXJ0aWNsZTFcIn0pIH0sXG4gICAgICB7IG5hbWU6IFwibG9zdERheXNcIiwgdmFsdWU6IHRvdGFsV29ya2luZ0RheXNMb3N0UGxhbnRpbmdGb3JtYXR0ZWQgfVxuICAgIF1cbiAgKTtcblxuICBjb25zdCBzZWxlY3RlZENvdW50cnkgPSBnZXRBZG1pblNlbGVjdGlvbjAoKS52YWx1ZTsgLy8gRnVuY3Rpb24gdG8gZ2V0IHRoZSBzZWxlY3RlZCBjb3VudHJ5XG4gIGNvbnN0IGNvdW50cmllc1dpdGhvdXREYXRhID0gW1xuICAgIFwiQnVydW5kaVwiLFxuICAgIFwiUndhbmRhXCIsXG4gICAgXCJMZXNvdGhvXCIsXG4gICAgXCJHYWJvblwiLFxuICAgIFwiRXN3YXRpbmlcIixcbiAgICBcIkVxdWF0b3JpYWwgR3VpbmVhXCJcbiAgXTtcblxuICAvLyBDaGVjayBpZiB0aGUgc2VsZWN0ZWQgY291bnRyeSBpcyBpbiB0aGUgbGlzdCBvZiBjb3VudHJpZXMgd2l0aG91dCBkYXRhXG4gIGlmIChjb3VudHJpZXNXaXRob3V0RGF0YS5pbmNsdWRlcyhzZWxlY3RlZENvdW50cnkpKSB7XG4gICAgcmV0dXJuIG1kYCR7X2xhbmcobmJUZXh0LnNlY3Rpb25zLnF1aWNrSW5zaWdodHNHZW5lcmFsLm5vRGF0YUJsdXJiKX1gO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiBtZGAgJHtpbnNpZ2h0SW50cm99IFxuXG4ke2luc2lnaHRCb2R5fVxuXG4ke2luc2lnaHRMb3N0RGF5c31cblxuYDtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYCMgJHtfbGFuZyhuYlRleHQuc2VjdGlvbnMuc3VtbWFyeS50aXRsZSl9XG5cbiR7X2xhbmcobmJUZXh0LnNlY3Rpb25zLnN1bW1hcnkuaW50cm8pfWA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgIyAke19sYW5nKG5iVGV4dC5zZWN0aW9ucy5tZXRob2RzLnRpdGxlKX1cblxuIyMgJHtfbGFuZyhuYlRleHQuc2VjdGlvbnMubWV0aG9kcy5hZ1dvcmtmb3JjZS50aXRsZSl9XG4ke19sYW5nKG5iVGV4dC5zZWN0aW9ucy5tZXRob2RzLmFnV29ya2ZvcmNlLmJvZHkpfVxuXG4jIyAke19sYW5nKG5iVGV4dC5zZWN0aW9ucy5tZXRob2RzLmhlYXRTdHJlc3MudGl0bGUpfVxuJHtfbGFuZyhuYlRleHQuc2VjdGlvbnMubWV0aG9kcy5oZWF0U3RyZXNzLmJvZHkpfVxuXG4jIyAke19sYW5nKG5iVGV4dC5zZWN0aW9ucy5tZXRob2RzLmhvdXJseUV4cG9zdXJlLnRpdGxlKX1cbiR7X2xhbmcobmJUZXh0LnNlY3Rpb25zLm1ldGhvZHMuaG91cmx5RXhwb3N1cmUuYm9keSl9XG5cbiMgJHtfbGFuZyhuYlRleHQuc2VjdGlvbnMubWV0aG9kcy5hZGRpdGlvbmFsTWV0aG9kcy50aXRsZSl9XG4ke19sYW5nKG5iVGV4dC5zZWN0aW9ucy5tZXRob2RzLmFkZGl0aW9uYWxNZXRob2RzLmJvZHkpfVxuXG4ke19sYW5nKG5iVGV4dC5zZWN0aW9ucy5tZXRob2RzLmFkZGl0aW9uYWxNZXRob2RzLmxpbmtOb3RlKX1cblxuIyMgJHtfbGFuZyhuYlRleHQuc2VjdGlvbnMubWV0aG9kcy5jaXRhdGlvbi50aXRsZSl9XG4ke19sYW5nKG5iVGV4dC5zZWN0aW9ucy5tZXRob2RzLmNpdGF0aW9uLmJvZHkpfWA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTMzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgU3VwcG9ydCBub3RlYm9va1xuW1N1cHBvcnQgTm90ZWJvb2tdKGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AcGVyaXNjb3BpYy9hYi1hdGxhcy1zcG90bGlnaHQtc3VwcG9ydCk6IHVzZWQgZm9yIGltcG9ydHMgYWNyb3NzIHNwb3RsaWdodHMuYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBUcmFuc2xhdGlvblxuX05vdGVib29rIGxhbmd1YWdlIGhhbmRsaW5nIGFuZCBtYWluIHRleHRfYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpbXBvcnQgeyBMYW5nIH0gZnJvbSBcIjdkNDY2NzlmN2QwZDkxN2VcIjtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJsYW5ndWFnZXMgPSBbXG4gIHsga2V5OiBcImVuXCIsIGxhYmVsOiBcIkVuZ2xpc2hcIiwgbG9jYWxlOiBcImVuLVVTXCIgfSxcbiAgeyBrZXk6IFwiZnJcIiwgbGFiZWw6IFwiRnJhbsOnYWlzXCIsIGxvY2FsZTogXCJmci1GUlwiIH0sXG5dO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGdldCB0aGUgZGVmYXVsdCBsYW5ndWFnZSBrZXkgZnJvbSBwYXJhbWV0ZXIsIG9yIHVzZSBkZWZhdWx0XG5kZWZhdWx0TGFuZ0tleSA9IHtcbiAgY29uc3QgbmFtZSA9IFwibGFuZ1wiO1xuICBjb25zdCBsaXN0ID0gbGFuZ3VhZ2VzLm1hcCgoZCkgPT4gZC5rZXkpO1xuICBjb25zdCBkZWZhdWx0S2V5ID0gXCJlblwiO1xuXG4gIGNvbnN0IHF1ZXJ5UGFyYW0gPSBhd2FpdCBMYW5nLmdldFBhcmFtRnJvbUxpc3QoeyBuYW1lLCBsaXN0IH0pO1xuXG4gIHJldHVybiBxdWVyeVBhcmFtID8/IGRlZmF1bHRLZXk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gaGVscGVyIHNob3J0aGFuZCBmb3IgTGFuZyB0ZXh0LWdldHRpbmdcbl9sYW5nID0gTGFuZy5sZyhsYW5ndWFnZS5rZXkpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIG1haW4gdG9nZ2xlIG9mIGxhbmd1YWdlIGtleVxudmlld29mIGxhbmd1YWdlID0gSW5wdXRzLnJhZGlvKGxhbmd1YWdlcywge1xuICBsYWJlbDogXCJNYWluIGxhbmd1YWdlIHRvZ2dsZVwiLFxuICBmb3JtYXQ6IChkKSA9PiBkLmtleSxcbiAgdmFsdWU6IGxhbmd1YWdlcy5maW5kKCh4KSA9PiB4LmtleSA9PT0gZGVmYXVsdExhbmdLZXkpLFxufSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJuYlRleHQgPSB7XG4gIHJldHVybiB7XG4gICAgbGVnZW5kczoge1xuICAgICAgbGFuZ3VhZ2U6IHtcbiAgICAgICAgZW46IFwibGFuZ3VhZ2VcIixcbiAgICAgICAgZnI6IFwibGFuZ3VlXCJcbiAgICAgIH0sXG4gICAgICB0b2M6IHtcbiAgICAgICAgZW46IFwiaW4gdGhpcyBub3RlYm9va1wiLFxuICAgICAgICBmcjogXCJkYW5zIGNlIG5vdGVib29rXCJcbiAgICAgIH0sXG4gICAgICBhZG1pblNlbGVjdGlvbnM6IHtcbiAgICAgICAgY291bnRyeToge1xuICAgICAgICAgIGVuOiBcImNvdW50cnlcIixcbiAgICAgICAgICBmcjogXCJwYXlzXCJcbiAgICAgICAgfSxcbiAgICAgICAgcmVnaW9uOiB7XG4gICAgICAgICAgZW46IFwicmVnaW9uXCIsXG4gICAgICAgICAgZnI6IFwicsOpZ2lvblwiXG4gICAgICAgIH0sXG4gICAgICAgIHN1YnJlZ2lvbjoge1xuICAgICAgICAgIGVuOiBcInN1YnJlZ2lvblwiLFxuICAgICAgICAgIGZyOiBcInNvdXMtcsOpZ2lvblwiXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzY2VuYXJpbzoge1xuICAgICAgICBlbjogXCJzY2VuYXJpb1wiLFxuICAgICAgICBmcjogXCJzY8OpbmFyaW9cIlxuICAgICAgfSxcbiAgICAgIHRocmVzaG9sZDoge1xuICAgICAgICBlbjogXCJ0aHJlc2hvbGRcIixcbiAgICAgICAgZnI6IFwic2V1aWxcIlxuICAgICAgfSxcbiAgICAgIHNlYXNvbjoge1xuICAgICAgICBlbjogXCJzZWFzb25cIixcbiAgICAgICAgZnI6IFwic2Fpc29uXCJcbiAgICAgIH0sXG4gICAgICBzZWFzb25UeXBlczoge1xuICAgICAgICBwbGFudGluZzoge1xuICAgICAgICAgIGVuOiBcInBsYW50aW5nXCIsXG4gICAgICAgICAgZnI6IFwicGxhbnRhdGlvblwiXG4gICAgICAgIH0sXG4gICAgICAgIGhhcnZlc3Rpbmc6IHtcbiAgICAgICAgICBlbjogXCJoYXJ2ZXN0aW5nXCIsXG4gICAgICAgICAgZnI6IFwicsOpY29sdGVcIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBzZWN0aW9uczoge1xuICAgICAgcXVpY2tJbnNpZ2h0c0dlbmVyYWw6IHtcbiAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgZW46IFwiUXVpY2sgSW5zaWdodHMgZm9yIDo6OnNlbGVjdGlvbjo6OlwiLFxuICAgICAgICAgIGZyOiBcIkFwZXLDp3UgUmFwaWRlIHBvdXIgOjo6c2VsZWN0aW9uOjo6XCJcbiAgICAgICAgfSxcbiAgICAgICAgbm9EYXRhQmx1cmI6IHtcbiAgICAgICAgICBlbjogXCJDdXJyZW50bHksIHRoZXJlIGlzIG5vIGF2YWlsYWJsZSBkYXRhIGZvciB0aGlzIGNvdW50cnkuIFBsZWFzZSwgc2VsZWN0IGFub3RoZXIgY291bnRyeS5cIixcbiAgICAgICAgICBmcjogXCJBY3R1ZWxsZW1lbnQsIGF1Y3VuZSBkb25uw6llIG7igJllc3QgZGlzcG9uaWJsZSBwb3VyIGNlIHBheXMuIFZldWlsbGV6IHPDqWxlY3Rpb25uZXIgdW4gYXV0cmUgcGF5cy5cIlxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgb3ZlcnZpZXc6IHtcbiAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICBlbjogXCJPdmVydmlld1wiLFxuICAgICAgICAgIGZyOiBcIlZ1ZSBk4oCZRW5zZW1ibGVcIlxuICAgICAgICB9LFxuICAgICAgICBpbnRybzoge1xuICAgICAgICAgIGVuOiBcIkFmcmljYW4gZm9vZCBzeXN0ZW1zIGRlcGVuZCBvbiBtYW51YWwgbGFib3VyIGZvciBwcm9kdWN0aW9uLCBkaXN0cmlidXRpb24sIGFuZCBwcm9jZXNzaW5nLiBFY29ub21pYyBkZXZlbG9wbWVudCBpcyBsZWFkaW5nIHRvIGNoYW5nZXMgaW4gdGhlIHN0cnVjdHVyZSBhbmQgc2l6ZSBvZiB0aGUgbGFib3VyIGZvcmNlLiBUaGlzIGNoYW5nZSwgaW4gdGhlIG51bWJlciBhbmQgc2l6ZSBvZiB0aGUgYWdyaWN1bHR1cmFsIHdvcmtmb3JjZSwgaXMgaGFwcGVuaW5nIGluIHBhcmFsbGVsIHRvIGNsaW1hdGUgY2hhbmdlLiBUaGUgaW50ZXJzZWN0aW9uIG9mIHRoZXNlIHR3byBkcml2ZXJzIHRvZ2V0aGVyIHBvc2UgYSByYW5nZSBvZiByaXNrcyB0byB0aGUgQWZyaWNhbiBjb250aW5lbnQncyBmb29kIHN5c3RlbXMuIFRoaXMgbm90ZWJvb2sgYWltcyB0byBjb21tdW5pY2F0ZSB0aGUgc2l6ZSBvZiB0aGUgYWdyaWN1bHR1cmFsIHdvcmtmb3JjZSBhdCByaXNrIHRvIGV4dHJlbWUgaGVhdCB0b2RheSwgYW5kIGluIHRoZSBmdXR1cmUuIEl0IHByZXNlbnRzIGEgbmV3IGluc2lnaHQgaW50byB0aGlzIHJpc2sgbGV2ZXJhZ2luZyBhIHJhbmdlIG9mIG5ldyBkYXRhc2V0cyBhbmQgaGlnaGxpZ2h0cyBob3cgdGhlIHdvcmtkYXkgZm9yIGRpZmZlcmVudCBsYWJvdXJlcnMgd2lsbCBiZSBkaXNydXB0ZWQgYnkgY2xpbWF0ZSBjaGFuZ2UgaW4gdGhlIGZ1dHVyZS4gWW91IGNhbiBmb2xsb3cgdGhlIG5hcnJhdGl2ZSBmb3IgdGhlIGNvbnRpbmVudCBhcyBhIHdob2xlLCBvciBzZWxlY3QgaW5kaXZpZHVhbCBjb3VudHJpZXMgZm9yIGdlb2dyYXBoeS1zcGVjaWZpYyBzdGF0aXN0aWNzLlwiLFxuICAgICAgICAgIGZyOiBcIkxlcyBzeXN0w6htZXMgYWxpbWVudGFpcmVzIGFmcmljYWlucyBkw6lwZW5kZW50IGR1IHRyYXZhaWwgbWFudWVsIHBvdXIgbGEgcHJvZHVjdGlvbiwgbGEgZGlzdHJpYnV0aW9uIGV0IGxhIHRyYW5zZm9ybWF0aW9uLiBMZSBkw6l2ZWxvcHBlbWVudCDDqWNvbm9taXF1ZSBlbnRyYcOubmUgZGVzIGNoYW5nZW1lbnRzIGRhbnMgbGEgc3RydWN0dXJlIGV0IGxhIHRhaWxsZSBkZSBsYSBwb3B1bGF0aW9uIGFjdGl2ZS4gQ2UgY2hhbmdlbWVudCwgZGFucyBsZSBub21icmUgZXQgbGEgdGFpbGxlIGRlIGxhIG1haW4tZOKAmcWTdXZyZSBhZ3JpY29sZSwgc2UgcHJvZHVpdCBwYXJhbGzDqGxlbWVudCBhdSBjaGFuZ2VtZW50IGNsaW1hdGlxdWUuIEzigJlpbnRlcnNlY3Rpb24gZGUgY2VzIGRldXggZmFjdGV1cnMgcHLDqXNlbnRlIHVuZSBzw6lyaWUgZGUgcmlzcXVlcyBwb3VyIGxlcyBzeXN0w6htZXMgYWxpbWVudGFpcmVzIGR1IGNvbnRpbmVudCBhZnJpY2Fpbi4gQ2UgY2FybmV0IHZpc2Ugw6AgY29tbXVuaXF1ZXIgbGEgdGFpbGxlIGRlIGxhIG1haW4gZOKAmcWTdXZyZSBhZ3JpY29sZSBleHBvc8OpZSBhdWpvdXJk4oCZaHVpIGV0IMOgIGzigJlhdmVuaXIgw6AgbGEgY2hhbGV1ciBleHRyw6ptZS4gSWwgcHLDqXNlbnRlIHVuIG5vdXZlbCBhcGVyw6d1IGRlIGNlIHJpc3F1ZSBlbiBleHBsb2l0YW50IHVuZSBzw6lyaWUgZGUgbm91dmVhdXggZW5zZW1ibGVzIGRlIGRvbm7DqWVzIGV0IHNvdWxpZ25lIGNvbW1lbnQgbGEgam91cm7DqWUgZGUgdHJhdmFpbCBkZXMgZGlmZsOpcmVudHMgdHJhdmFpbGxldXJzIHNlcmEgcGVydHVyYsOpZSBwYXIgbGUgY2hhbmdlbWVudCBjbGltYXRpcXVlIMOgIGwnYXZlbmlyLiBWb3VzIHBvdXZleiBzdWl2cmUgbGUgcsOpY2l0IGR1IGNvbnRpbmVudCBkYW5zIHNvbiBlbnNlbWJsZSBvdSBzw6lsZWN0aW9ubmVyIGRlcyBwYXlzIGluZGl2aWR1ZWxzIHBvdXIgb2J0ZW5pciBkZXMgc3RhdGlzdGlxdWVzIHNww6ljaWZpcXVlcyDDoCBsYSBnw6lvZ3JhcGhpZS5cIlxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgZnV0dXJlV29ya2ZvcmNlOiB7XG4gICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgZW46IFwiVGhlIEZ1dHVyZSBvZiB0aGUgQWdyaWN1bHR1cmFsIFdvcmtmb3JjZVwiLFxuICAgICAgICAgIGZyOiBcIkzigJlhdmVuaXIgZGUgbGEgTWFpbi1k4oCZxZJ1dnJlIEFncmljb2xlXCJcbiAgICAgICAgfSxcbiAgICAgICAgaW50cm86IHtcbiAgICAgICAgICBlbjogXCJUaGUgYWdyaWN1bHR1cmFsIHdvcmtmb3JjZSBjb3ZlcnMgdGhlIGVudGlyZSBlbXBsb3llZCBwb3J0aW9uIG9mIHRoZSBlbXBsb3lhYmxlIHBvcHVsYXRpb24gaW52b2x2ZWQgaW4gdGhlIGFncmljdWx0dXJlIHNlY3Rvci4gSW4gdGhlIEFmcmljYW4gY29udGluZW50LCB0aGUgdmFzdCBtYWpvcml0eSBvZiB0aGVzZSBhcmUgZmFybWVycy4gSG93ZXZlciwgdGhlIG51bWJlciBvZiBmYXJtZXJzIGFuZCB0aGUgc2l6ZSBvZiB0aGUgd29ya2ZvcmNlIGlzIG5vdCBzdGF0aWMsIGFuZCBkZXBlbmRzIG9uIHN0cnVjdHVyYWwgZmFjdG9ycyB3aGljaCBkcml2ZSBydXJhbCBwb3B1bGF0aW9uIGdyb3d0aCwgcHVzaCBvciBwdWxsIHRoZSBydXJhbCBwb3B1bGF0aW9uIHRvd2FyZHMgdXJiYW4gYXJlYXMgb3ZlciB0aW1lLiAgSGVyZSwgeW91IGNhbiBleHBsb3JlIGhvdyB0aGUgc2l6ZSBvZiB0aGUgYWdyaWN1bHR1cmFsIHdvcmtmb3JjZSB0b2RheSBhbmQgaG93IGl0IHdpbGwgY2hhbmdlIGFzIGEgcmVzdWx0IG9mIHRoZXNlIGZhY3RvcnMgaW4gdGhlIGZ1dHVyZS5cIixcbiAgICAgICAgICBmcjogXCJMYSBtYWluIGTigJnFk3V2cmUgYWdyaWNvbGUgY291dnJlIGzigJllbnNlbWJsZSBkZSBsYSBwYXJ0IG9jY3Vww6llIGRlIGxhIHBvcHVsYXRpb24gZW1wbG95YWJsZSBpbXBsaXF1w6llIGRhbnMgbGUgc2VjdGV1ciBhZ3JpY29sZS4gU3VyIGxlIGNvbnRpbmVudCBhZnJpY2FpbiwgbGEgZ3JhbmRlIG1ham9yaXTDqSBk4oCZZW50cmUgZXV4IHNvbnQgZGVzIGFncmljdWx0ZXVycy4gQ2VwZW5kYW50LCBsZSBub21icmUgZOKAmWFncmljdWx0ZXVycyBldCBsYSB0YWlsbGUgZGUgbGEgbWFpbiBk4oCZxZN1dnJlIG5lIHNvbnQgcGFzIHN0YXRpcXVlcyBldCBkw6lwZW5kZW50IGRlIGZhY3RldXJzIHN0cnVjdHVyZWxzIHF1aSBzdGltdWxlbnQgbGEgY3JvaXNzYW5jZSBkZSBsYSBwb3B1bGF0aW9uIHJ1cmFsZSwgcG91c3NlbnQgb3UgYXR0aXJlbnQgbGEgcG9wdWxhdGlvbiBydXJhbGUgdmVycyBsZXMgem9uZXMgdXJiYWluZXMgYXUgZmlsIGR1IHRlbXBzLiBJY2ksIHZvdXMgcG91dmV6IGTDqWNvdXZyaXIgY29tbWVudCBsYSB0YWlsbGUgZGUgbGEgbWFpbi1k4oCZxZN1dnJlIGFncmljb2xlIGF1am91cmTigJlodWkgZXQgY29tbWVudCBlbGxlIMOpdm9sdWVyYSBlbiByYWlzb24gZGUgY2VzIGZhY3RldXJzIMOgIGzigJlhdmVuaXIuXCJcbiAgICAgICAgfSxcbiAgICAgICAgbWFwOiB7XG4gICAgICAgICAgY2FwdGlvbjoge1xuICAgICAgICAgICAgZW46IGBHcmV5IHJlZ2lvbnMgc2lnbmFsIGxhY2sgb2YgOjo6c2VsZWN0b3I6OjogZGF0YWAsXG4gICAgICAgICAgICBmcjogYExlcyByw6lnaW9ucyBncmlzZXMgc2lnbmFsZW50IHVuIG1hbnF1ZSBkZSBkb25uw6llcyBzdXIgbGEgOjo6c2VsZWN0b3I6OjpgXG4gICAgICAgICAgfSxcbiAgICAgICAgICBtYXBMYXllcjoge1xuICAgICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgICAgZW46IFwiTWFwIExheWVyXCIsXG4gICAgICAgICAgICAgIGZyOiBcIkNvdWNoZSBkZSBDYXJ0ZVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdmFsdWVzOiB7XG4gICAgICAgICAgICAgIGFnX3dvcmtmb3JjZV9kYXRhXzI6IHtcbiAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgZW46IFwiQWcgcG9wdWxhdGlvbiBiYXNlbGluZSAoY2lyY2EgMjAwNSlcIixcbiAgICAgICAgICAgICAgICAgIGZyOiBcIlLDqWbDqXJlbmNlIGRlIGxhIHBvcHVsYXRpb24gYWdyaWNvbGUgKHZlcnMgMjAwNSlcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbGFiZWxUaXA6IHtcbiAgICAgICAgICAgICAgICAgIGVuOiBcIkFnIHBvcHVsYXRpb25cIixcbiAgICAgICAgICAgICAgICAgIGZyOiBcIlBvcHVsYXRpb24gYWdyaWNvbGVcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbGFiZWxMZWdlbmQ6IHtcbiAgICAgICAgICAgICAgICAgIGVuOiBcIkFnIHBvcHVsYXRpb25cIixcbiAgICAgICAgICAgICAgICAgIGZyOiBcIlBvcHVsYXRpb24gYWdyaWNvbGVcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgYWdfd29ya2ZvcmNlX2RhdGFfMToge1xuICAgICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgICBlbjogXCJQZXJjZW50YWdlIGNoYW5nZSBieSAyMDMwXCIsXG4gICAgICAgICAgICAgICAgICBmcjogXCJQb3VyY2VudGFnZSBkZSBjaGFuZ2VtZW50IGTigJlpY2kgMjAzMFwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsYWJlbFRpcDoge1xuICAgICAgICAgICAgICAgICAgZW46IFwiUG9wdWxhdGlvbiBjaGFuZ2UgYnkgMjAzMFwiLFxuICAgICAgICAgICAgICAgICAgZnI6IFwiQ2hhbmdlbWVudCBlbiBwb3B1bGF0aW9uIGTigJlpY2kgMjAzMFwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsYWJlbExlZ2VuZDoge1xuICAgICAgICAgICAgICAgICAgZW46IFwiUG9wdWxhdGlvbiBjaGFuZ2UgYnkgMjAzMCAoJSlcIixcbiAgICAgICAgICAgICAgICAgIGZyOiBcIkNoYW5nZW1lbnQgZW4gcG9wdWxhdGlvbiBk4oCZaWNpIDIwMzAgKCUpXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGFnX3dvcmtmb3JjZV9kYXRhOiB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICAgIGVuOiBcIlBlcmNlbnRhZ2UgY2hhbmdlIGJ5IDIwNTBcIixcbiAgICAgICAgICAgICAgICAgIGZyOiBcIlBvdXJjZW50YWdlIGRlIGNoYW5nZW1lbnQgZOKAmWljaSAyMDUwXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxhYmVsVGlwOiB7XG4gICAgICAgICAgICAgICAgICBlbjogXCJQb3B1bGF0aW9uIGNoYW5nZSBieSAyMDUwXCIsXG4gICAgICAgICAgICAgICAgICBmcjogXCJDaGFuZ2VtZW50IGVuIHBvcHVsYXRpb24gZOKAmWljaSAyMDUwXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxhYmVsTGVnZW5kOiB7XG4gICAgICAgICAgICAgICAgICBlbjogXCJQb3B1bGF0aW9uIGNoYW5nZSBieSAyMDUwICglKVwiLFxuICAgICAgICAgICAgICAgICAgZnI6IFwiQ2hhbmdlbWVudCBlbiBwb3B1bGF0aW9uIGTigJlpY2kgMjA1MCAoJSlcIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgYWdfd29ya2ZvcmNlX2RhdGFfMTU6IHtcbiAgICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgICAgZW46IFwiQWcgcG9wdWxhdGlvbiBpbiAyMDMwXCIsXG4gICAgICAgICAgICAgICAgICBmcjogXCJQb3B1bGF0aW9uIGFncmljb2xlIGVuIDIwMzBcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbGFiZWxUaXA6IHtcbiAgICAgICAgICAgICAgICAgIGVuOiBcIkFnIHBvcHVsYXRpb24gaW4gMjAzMFwiLFxuICAgICAgICAgICAgICAgICAgZnI6IFwiUG9wdWxhdGlvbiBhZ3JpY29sZSBlbiAyMDMwXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGxhYmVsTGVnZW5kOiB7XG4gICAgICAgICAgICAgICAgICBlbjogXCJBZyBwb3B1bGF0aW9uIGluIDIwMzBcIixcbiAgICAgICAgICAgICAgICAgIGZyOiBcIlBvcHVsYXRpb24gYWdyaWNvbGUgZW4gMjAzMFwiXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBhZ193b3JrZm9yY2VfZGF0YV8xMDoge1xuICAgICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgICBlbjogXCJBZyBwb3B1bGF0aW9uIGluIDIwNTBcIixcbiAgICAgICAgICAgICAgICAgIGZyOiBcIlBvcHVsYXRpb24gYWdyaWNvbGUgZW4gMjA1MFwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBsYWJlbFRpcDoge1xuICAgICAgICAgICAgICAgICAgZW46IFwiQWcgcG9wdWxhdGlvbiBpbiAyMDUwXCIsXG4gICAgICAgICAgICAgICAgICBmcjogXCJQb3B1bGF0aW9uIGFncmljb2xlIGVuIDIwNTBcIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbGFiZWxMZWdlbmQ6IHtcbiAgICAgICAgICAgICAgICAgIGVuOiBcIkFnIHBvcHVsYXRpb24gaW4gMjA1MFwiLFxuICAgICAgICAgICAgICAgICAgZnI6IFwiUG9wdWxhdGlvbiBhZ3JpY29sZSBlbiAyMDUwXCJcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHF1aWNrSW5zaWdodHM6IHtcbiAgICAgICAgICBkaXJlY3Rpb246IHtcbiAgICAgICAgICAgIGluYzoge1xuICAgICAgICAgICAgICBlbjogXCJhbiBpbmNyZWFzZVwiLFxuICAgICAgICAgICAgICBmcjogXCJ1bmUgYXVnbWVudGF0aW9uXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBkZWM6IHtcbiAgICAgICAgICAgICAgZW46IFwiYSBkZWNyZWFzZVwiLFxuICAgICAgICAgICAgICBmcjogXCJ1bmUgZGltaW51dGlvblwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBiYXNlUG9wOiB7XG4gICAgICAgICAgICBlbjogYCoqOjo6Z2VvOjo6KirigJlzIHRvdGFsIGFncmljdWx0dXJhbCBwb3B1bGF0aW9uIGlzICoqOjo6dG90YWw6OjoqKiBmb3IgdGhlIGJhc2VsaW5lIHllYXIsIGNpcmNhIDIwMDUuYCxcbiAgICAgICAgICAgIGZyOiBgTGEgcG9wdWxhdGlvbiBhZ3JpY29sZSB0b3RhbGUgKio6OjpnZW86OjoqKiBlc3QgZGUgKio6Ojp0b3RhbDo6OioqIHBvdXIgbOKAmWFubsOpZSBkZSByw6lmw6lyZW5jZSwgdmVycyAyMDA1LmBcbiAgICAgICAgICB9LCBcbiAgICAgICAgICBwb3BDaGFuZ2U6IHtcbiAgICAgICAgICAgIGVuOiBgVGhlIHRvdGFsIGFncmljdWx0dXJhbCBwb3B1bGF0aW9uIGlzIGV4cGVjdGVkIHRvIGNoYW5nZSB0byAqKjo6OmNoYW5nZTIwMzA6OjoqKiBieSAyMDMwLCBhbmQgdG8gKio6OjpjaGFuZ2UyMDUwOjo6KiogYnkgMjA1MCwgdW5kZXIgU1NQMjQ1LiBUaGVzZSByZXByZXNlbnQgKio6OjpkaXJlY3Rpb24yMDMwOjo6Kiogb2YgKio6OjpwZXJjMjAzMDo6OiUqKiBhbmQgKio6OjpkaXJlY3Rpb24yMDUwOjo6Kiogb2YgKio6OjpwZXJjMjA1MDo6OiUqKiwgcmVzcGVjdGl2ZWx5LmAsXG4gICAgICAgICAgICBmcjogYExhIHBvcHVsYXRpb24gYWdyaWNvbGUgdG90YWxlIGRldnJhaXQgcGFzc2VyIMOgICoqOjo6Y2hhbmdlMjAzMDo6OioqIGTigJlpY2kgMjAzMCBldCDDoCAqKjo6OmNoYW5nZTIwNTA6OjoqKiBk4oCZaWNpIDIwNTAsIGRhbnMgbGUgY2FkcmUgZHUgU1NQMjQ1LiBDZWxhIHJlcHLDqXNlbnRlICoqOjo6ZGlyZWN0aW9uMjAzMDo6OioqIGRlICoqOjo6cGVyYzIwMzA6OjolKiogZXQgKio6OjpkaXJlY3Rpb24yMDUwOjo6KiogZGUgKio6OjpwZXJjMjA1MDo6OiUqKiwgcmVzcGVjdGl2ZW1lbnQuYFxuICAgICAgICAgIH0sXG4gICAgICAgICAgcG9wU2NlbmFyaW86IHtcbiAgICAgICAgICAgIGVuOiBgVW5kZXIgU1NQNTg1LCB0aGUgdG90YWwgYWdyaWN1bHR1cmFsIHBvcHVsYXRpb24gd2lsbCBiZSAqKjo6OnBvcDIwMzA6OjoqKiBieSAyMDMwIGFuZCAqKjo6OnBvcDIwNTA6OjoqKiBieSAyMDUwLiBUaGVzZSByZXByZXNlbnQgKio6OjpkaXJlY3Rpb246OjoqKiBvZiAqKjo6OnBlcmMyMDMwOjo6JSoqIGFuZCAqKjo6OnBlcmMyMDUwOjo6JSoqLCByZXNwZWN0aXZlbHkuYCxcbiAgICAgICAgICAgIGZyOiBgRGFucyBsZSBjYWRyZSBkdSBTU1A1ODUsIGxhIHBvcHVsYXRpb24gYWdyaWNvbGUgdG90YWxlIHNlcmEgZGUgKio6Ojpwb3AyMDMwOjo6KiogZCdpY2kgMjAzMCBldCBkZSAqKjo6OnBvcDIwNTA6OjoqKiBkJ2ljaSAyMDUwLiBDZWxhIHJlcHLDqXNlbnRlICoqOjo6ZGlyZWN0aW9uOjo6KiogZGUgKio6OjpwZXJjMjAzMDo6OiUqKiBldCAqKjo6OnBlcmMyMDUwOjo6JSoqLCByZXNwZWN0aXZlbWVudC5gXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaGVhdFN0cmVzczoge1xuICAgICAgICB0aXRsZToge1xuICAgICAgICAgIGVuOiBcIkhlYXQgU3RyZXNzIGluIE51bWJlcnNcIixcbiAgICAgICAgICBmcjogXCJMZSBTdHJlc3MgVGhlcm1pcXVlIGVuIENoaWZmcmVzXCJcbiAgICAgICAgfSxcbiAgICAgICAgaW50cm86IHtcbiAgICAgICAgICBlbjogXCJBbiBpbXBvcnRhbnQgcXVlc3Rpb24gaXMgaG93IHRoZSBpbmNyZWFzZXMgaW4gYWdyaWN1bHR1cmFsIHdvcmtmb3JjZSBvbiB0aGUgQWZyaWNhbiBjb250aW5lbnQgd2lsbCBiZSBhZmZlY3RlZCBieSBjbGltYXRlIGNoYW5nZS4gQSBrZXkgaW5kaWNhdG9yIG9mIGNsaW1hdGUgY2hhbmdlIGltcGFjdHMgb24gaHVtYW4gd2VsbCBiZWluZyBpcyBoZWF0IHN0cmVzcy4gVGhlIGxldmVsIG9mIGhlYXQgc3RyZXNzIGV4cGVyaWVuY2VkIGJ5IGEgcGVyc29uIGRlcGVuZHMgbm90IG9ubHkgb24gdGVtcGVyYXR1cmUgYnV0IGFsc28gb24gaHVtaWRpdHksIHdoaWNoIGFyZSB0b2dldGhlciBvZnRlbiByZXByZXNlbnRlZCBpbiB0ZXJtcyBvZiBXZXQgQnVsYiBHbG9iZSBUZW1wZXJhdHVyZSwgd2hlcmUgdGhyZXNob2xkcyBleGNlZWRpbmcgMjjCsEMgYXJlIGNvbnNpZGVyZWQgaGFybWZ1bCwgYW5kIHRob3NlIGV4Y2VlZGluZyAzMsKwQyBleHRyZW1lbHkgaGFybWZ1bC4gVXNlIHRoZSBkcm9wZG93bnMgYmVsb3cgdG8gZXhwbG9yZSBob3cgbWFueSBkYXlzIGluIHRoZSB5ZWFyIHRoZSBhZ3JpY3VsdHVyYWwgd29ya2ZvcmNlIHdpbGwgYmUgZXhwb3NlZCB0byBoYXJtZnVsIGhlYXQgc3RyZXNzIGZvciBzcGVjaWZpYyBnZW9ncmFwaGllcywgdGVtcGVyYXR1cmUgdGhyZXNob2xkcyBhbmQgY2xpbWF0ZSBjaGFuZ2Ugc2NlbmFyaW9zLlwiLFxuICAgICAgICAgIGZyOiBcIlVuZSBxdWVzdGlvbiBpbXBvcnRhbnRlIGVzdCBkZSBzYXZvaXIgY29tbWVudCBsZXMgYXVnbWVudGF0aW9ucyBkZSBsYSBtYWluLWQnxZN1dnJlIGFncmljb2xlIHN1ciBsZSBjb250aW5lbnQgYWZyaWNhaW4gc2Vyb250IGFmZmVjdMOpZXMgcGFyIGxlIGNoYW5nZW1lbnQgY2xpbWF0aXF1ZS4gVW4gaW5kaWNhdGV1ciBjbMOpIGRlcyBpbXBhY3RzIGR1IGNoYW5nZW1lbnQgY2xpbWF0aXF1ZSBzdXIgbGUgYmllbi3DqnRyZSBodW1haW4gZXN0IGxlIHN0cmVzcyB0aGVybWlxdWUuIExlIG5pdmVhdSBkZSBzdHJlc3MgdGhlcm1pcXVlIHJlc3NlbnRpIHBhciB1bmUgcGVyc29ubmUgZMOpcGVuZCBub24gc2V1bGVtZW50IGRlIGxhIHRlbXDDqXJhdHVyZSBtYWlzIGF1c3NpIGRlIGwnaHVtaWRpdMOpLCBxdWkgc29udCBzb3V2ZW50IHJlcHLDqXNlbnTDqXMgY29uam9pbnRlbWVudCBlbiB0ZXJtZXMgZGUgdGVtcMOpcmF0dXJlIGR1IGdsb2JlIGh1bWlkZSwgb8O5IGRlcyBzZXVpbHMgZMOpcGFzc2FudCAyOMKwQyBzb250IGNvbnNpZMOpcsOpcyBjb21tZSBudWlzaWJsZXMsIGV0IGNldXggZMOpcGFzc2FudCAzMsKwQyBleHRyw6ptZW1lbnQgbnVpc2libGVzLiBVdGlsaXNleiBsZXMgbWVudXMgZMOpcm91bGFudHMgY2ktZGVzc291cyBwb3VyIGV4cGxvcmVyIGNvbWJpZW4gZGUgam91cnMgZGFucyBsJ2FubsOpZSBsYSBtYWluLWQnxZN1dnJlIGFncmljb2xlIHNlcmEgZXhwb3PDqWUgw6AgdW4gc3RyZXNzIHRoZXJtaXF1ZSBudWlzaWJsZSBwb3VyIGRlcyBnw6lvZ3JhcGhpZXMgc3DDqWNpZmlxdWVzLCBkZXMgc2V1aWxzIGRlIHRlbXDDqXJhdHVyZSBldCBkZXMgc2PDqW5hcmlvcyBkZSBjaGFuZ2VtZW50IGNsaW1hdGlxdWUuXCJcbiAgICAgICAgfSxcbiAgICAgICAgYmFyQ2hhcnQ6IHtcbiAgICAgICAgICBjYXB0aW9uOiB7XG4gICAgICAgICAgICBlbjogXCJUbyBlbnN1cmUgdGhhdCB0aGUgZGV0YWlscyBhY3Jvc3MgYWxsIGJpbnMgYXJlIHZpc2libGUgd2l0aG91dCBiZWluZyBkb21pbmF0ZWQgYnkgdGhlIGluaXRpYWwgcmFuZ2UsIHRoZSAwLTUlIGJpbiBoYXMgYmVlbiBpbnRlbnRpb25hbGx5IGV4Y2x1ZGVkIGZyb20gdGhpcyB2aXN1YWxpemF0aW9uLlwiLFxuICAgICAgICAgICAgZnI6IFwiUG91ciBnYXJhbnRpciBxdWUgbGVzIGTDqXRhaWxzIGRhbnMgdG91cyBsZXMgZ3JvdXBlcyBzb250IHZpc2libGVzIHNhbnMgw6p0cmUgZG9taW7DqXMgcGFyIGxhIHBsYWdlIGluaXRpYWxlLCBsZSBncm91cGUgMC01ICUgYSDDqXTDqSBpbnRlbnRpb25uZWxsZW1lbnQgZXhjbHUgZGUgY2V0dGUgdmlzdWFsaXNhdGlvbi5cIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgZ3JvdXA6IHtcbiAgICAgICAgICAgIGJhc2VsaW5lOiB7XG4gICAgICAgICAgICAgIGVuOiBcIkJhc2VsaW5lXCIsXG4gICAgICAgICAgICAgIGZyOiBcIlLDqWbDqXJlbmNlXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwcm9qZWN0aW9uOiB7XG4gICAgICAgICAgICAgIGVuOiBcIlByb2plY3Rpb25cIixcbiAgICAgICAgICAgICAgZnI6IFwiUHJvamVjdGlvblwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICB4TGFiZWw6IHtcbiAgICAgICAgICAgIGVuOiBcIlBlcmNlbnQgb2YgWWVhciBFeGNlZWRpbmcgU2FmZSBXb3JraW5nIENvbmRpdGlvbnNcIixcbiAgICAgICAgICAgIGZyOiBcIlBvdXJjZW50YWdlIGRlIGwnYW5uw6llIGTDqXBhc3NhbnQgbGVzIGNvbmRpdGlvbnMgZGUgdHJhdmFpbCBzw6ljdXJpdGFpcmVzXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHlMYWJlbDoge1xuICAgICAgICAgICAgZW46IFwiUGVvcGxlIEV4cG9zZWRcIixcbiAgICAgICAgICAgIGZyOiBcIlBlcnNvbm5lcyBFeHBvc8OpZXNcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgdG9vbHRpcDoge1xuICAgICAgICAgICAgZXhwb3NlZDoge1xuICAgICAgICAgICAgICBlbjogXCJBZyBwb3AgZXhwb3NlZFwiLFxuICAgICAgICAgICAgICBmcjogXCJQb3B1bGF0aW9uIGFncmljb2xlIGV4cG9zw6llXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwZXJpb2Q6IHtcbiAgICAgICAgICAgICAgZW46IFwiUGVyaW9kXCIsXG4gICAgICAgICAgICAgIGZyOiBcIlDDqXJpb2RlXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZpZ3VyZUJvZHk6IHtcbiAgICAgICAgICBlbjogXCJUaGUgZmlndXJlIHByZXNlbnRzIHRoZSBjb3VudCBvZiBhZ3JpY3VsdHVyYWwgd29ya2VycyBzdWJqZWN0IHRvIHVuc2FmZSBXZXQgQnVsYiBHbG9iZSBUZW1wZXJhdHVyZSAoV0JHVCkgbGV2ZWxzIGFjcm9zcyB0aGUgeWVhciwgYmFzZWQgb24gYm90aCBiYXNlbGluZSBkYXRhIGFuZCBwcm9qZWN0aW9ucy4gRm9yIGluc3RhbmNlLCBpZiBhIHByb2plY3Rpb24gZGlzcGxheXMgMTYgbWlsbGlvbiBwZW9wbGUgd2l0aGluIHRoZSA0NSUtNTAlIGJpbiwgaXQgbWVhbnMgdGhhdCB0aGVzZSBpbmRpdmlkdWFscyBhcmUgZXhwb3NlZCB0byB1bnNhZmUgd29ya2luZyBjb25kaXRpb25zIGZvciBhIHBvcnRpb24gb2YgdGhlaXIgZGF5LCA0NSUgdG8gNTAlIG9mIHRoZSBkYXlzIGluIHRoZSB5ZWFyLlwiLFxuICAgICAgICAgIGZyOiBcIkxhIGZpZ3VyZSBwcsOpc2VudGUgbGUgbm9tYnJlIGRlIHRyYXZhaWxsZXVycyBhZ3JpY29sZXMgc291bWlzIMOgIGRlcyBuaXZlYXV4IGRhbmdlcmV1eCBkZSB0ZW1ww6lyYXR1cmUgZHUgZ2xvYmUgaHVtaWRlIChXQkdUKSB0b3V0IGF1IGxvbmcgZGUgbOKAmWFubsOpZSwgc3VyIGxhIGJhc2Ugw6AgbGEgZm9pcyBkZSBkb25uw6llcyBkZSBiYXNlIGV0IGRlIHByb2plY3Rpb25zLiBQYXIgZXhlbXBsZSwgc2kgdW5lIHByb2plY3Rpb24gYWZmaWNoZSAxNiBtaWxsaW9ucyBkZSBwZXJzb25uZXMgZGFucyBsYSB0cmFuY2hlIDQ1IMOgIDUwICUsIGNlbGEgc2lnbmlmaWUgcXVlIGNlcyBwZXJzb25uZXMgc29udCBleHBvc8OpZXMgw6AgZGVzIGNvbmRpdGlvbnMgZGUgdHJhdmFpbCBkYW5nZXJldXNlcyBwZW5kYW50IHVuZSBwYXJ0aWUgZGUgbGV1ciBqb3VybsOpZSwgc29pdCA0NSDDoCA1MCAlIGRlcyBqb3VycyBkZSBs4oCZYW5uw6llLlwiXG4gICAgICAgIH0sXG4gICAgICAgIHF1aWNrSW5zaWdodHM6IHtcbiAgICAgICAgICBvdmVydmlldzoge1xuICAgICAgICAgICAgZW46IGBGb3Igb3ZlciAqKjEwMCBkYXlzKiogaW4gYSB5ZWFyLCB0aGUgcGVvcGxlIGF0IHJpc2sgZm9yIHRoZSBiYXNlbGluZSB3ZXJlICoqOjo6YmFzZVJpc2s6OjoqKjsgdW5kZXIgdGhlIHNjZW5hcmlvICoqOjo6c2NlbmFyaW86OjoqKiBhbmQgeWVhciAqKjo6OnllYXI6OjoqKiwgaXQgYXNjZW5kcyB0byAqKjo6OnByb2plY3Rpb25SaXNrOjo6KiouYCxcbiAgICAgICAgICAgIGZyOiBgUGVuZGFudCBwbHVzIGRlICoqMTAwIGpvdXJzKiogcGFyIGFuLCBsZXMgcGVyc29ubmVzIMOgIHJpc3F1ZSDDqXRhaWVudCBkZSAqKjo6OmJhc2VSaXNrOjo6Kio7IGRhbnMgbGUgc2PDqW5hcmlvICoqOjo6c2NlbmFyaW86OjoqKiBldCBsJ2FubsOpZSAqKjo6OnllYXI6OjoqKiwgaWwgbW9udGUgw6AgKio6Ojpwcm9qZWN0aW9uUmlzazo6OiBkZSBwZXJzb25uZXMqKi5gXG4gICAgICAgICAgfSxcbiAgICAgICAgICBoYWxmOiB7XG4gICAgICAgICAgICBlbjogYEZvciB0aGUgYmFzZWxpbmUgcGVyaW9kLCAqKjo6OmJhc2VsaW5lOjo6KiogcGVvcGxlIGV4cGVyaWVuY2VkIHVuc2FmZSB3b3JraW5nIGNvbmRpdGlvbnMgZm9yIGF0IGxlYXN0ICoqaGFsZiBvZiB0aGUgZGF5cyoqIGluIHRoZSB5ZWFyLiBVbmRlciB0aGUgc2NlbmFyaW8gKio6OjpzY2VuYXJpbzo6OioqIGFuZCB5ZWFyICoqOjo6eWVhcjo6OioqLCBpdCdzIGV4cGVjdGVkIHRvIHJpc2UgdG8gKio6Ojpwcm9qZWN0aW9uOjo6KiogcGVvcGxlLmAsXG4gICAgICAgICAgICBmcjogYFBvdXIgbGEgcMOpcmlvZGUgZGUgcsOpZsOpcmVuY2UsICoqOjo6YmFzZWxpbmU6OjoqKiBwZXJzb25uZXMgb250IGNvbm51IGRlcyBjb25kaXRpb25zIGRlIHRyYXZhaWwgZGFuZ2VyZXVzZXMgcGVuZGFudCBhdSBtb2lucyBsYSAqKm1vaXRpw6kgZGVzIGpvdXJzKiogZGUgbCdhbm7DqWUuIERhbnMgbGUgc2PDqW5hcmlvICoqOjo6c2NlbmFyaW86OjoqKiBldCBsJ2FubsOpZSAqKjo6OnllYXI6OjoqKiwgb24gcydhdHRlbmQgw6AgY2UgcXUnaWwgcyfDqWzDqHZlIMOgICoqOjo6cHJvamVjdGlvbjo6OioqIHBlcnNvbm5lcy5gXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgd29ya2luZ0hvdXJzOiB7XG4gICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgZW46IFwiTG9zcyBvZiBTYWZlIFdvcmtpbmcgSG91cnNcIixcbiAgICAgICAgICBmcjogXCJQZXJ0ZSBkJ0hldXJlcyBkZSBUcmF2YWlsIFPDqWN1cmlzw6llc1wiXG4gICAgICAgIH0sXG4gICAgICAgIGludHJvOiB7XG4gICAgICAgICAgZW46IFwiSW1wb3J0YW50bHksIGl0IGlzIG5vdCBqdXN0IHRoZSBkYXlzIG9mIGNsaW1hdGUgZGlzcnVwdGlvbnMgdG8gdGhlIGFncmljdWx0dXJhbCB3b3JrZm9yY2UgdGhhdCBtYXR0ZXIuIFRoZSBob3VycyBkdXJpbmcgdGhlIGRheSBhbmQgdGhlIHRpbWUgaW4gdGhlIGdyb3dpbmcgc2Vhc29uLCB3aGV0aGVyIHBsYW50aW5nLCBvciBoYXJ2ZXN0aW5nLCBhbGwgaW5mbHVlbmNlICBob3cgdGhlc2UgZGlzcnVwdGlvbnMgd2lsbCB0YWtlIHBsYWNlIGFuZCBpbXBhY3Qgb24gdGhlIHNlY3Rvci4gVXNlIHRoZSBmaWd1cmUgYmVsb3cgdG8gZXhwbG9yZSBob3cgdGhlc2Ugc2FmZSB3b3JraW5nIGhvdXJzIHdpbGwgYmUgZGlzcnVwdGVkIGZvciBkaWZmZXJlbnQgcG9wdWxhdGlvbnMgdW5kZXIgZGlmZmVyZW50IGNsaW1hdGUgc2NlbmFyaW9zLCB0ZW1wZXJhdHVyZSB0aHJlc2hvbGRzLCBhbmQgZGlmZmVyZW50IGdlb2dyYXBoaWVzIG9uIHRoZSBBZnJpY2FuIGNvbnRpbmVudC5cIixcbiAgICAgICAgICBmcjogXCJJbCBlc3QgaW1wb3J0YW50IGRlIG5vdGVyIHF1ZSBjZSBuZSBzb250IHBhcyBzZXVsZW1lbnQgbGVzIGpvdXJzIGRlIHBlcnR1cmJhdGlvbnMgY2xpbWF0aXF1ZXMgcXVpIGFmZmVjdGVudCBsYSBtYWluLWQnxZN1dnJlIGFncmljb2xlIHF1aSBjb21wdGVudC4gTGVzIGhldXJlcyBwZW5kYW50IGxhIGpvdXJuw6llIGV0IGxlIG1vbWVudCBkYW5zIGxhIHNhaXNvbiBkZSBjcm9pc3NhbmNlLCBxdWUgY2Ugc29pdCBsb3JzIGRlIGxhIHBsYW50YXRpb24gb3UgZGUgbGEgcsOpY29sdGUsIGluZmx1ZW5jZW50IHRvdXRlcyBsYSBtYW5pw6hyZSBkb250IGNlcyBwZXJ0dXJiYXRpb25zIHNlIHByb2R1aXJvbnQgZXQgYXVyb250IHVuIGltcGFjdCBzdXIgbGUgc2VjdGV1ci4gVXRpbGlzZXogbGEgZmlndXJlIGNpLWRlc3NvdXMgcG91ciBleHBsb3JlciBjb21tZW50IGNlcyBoZXVyZXMgZGUgdHJhdmFpbCBzw6ljdXJpc8OpZXMgc2Vyb250IHBlcnR1cmLDqWVzIHBvdXIgZGlmZsOpcmVudGVzIHBvcHVsYXRpb25zIHNvdXMgZGlmZsOpcmVudHMgc2PDqW5hcmlvcyBjbGltYXRpcXVlcywgc2V1aWxzIGRlIHRlbXDDqXJhdHVyZSBldCBkaWZmw6lyZW50ZXMgZ8Opb2dyYXBoaWVzIHN1ciBsZSBjb250aW5lbnQgYWZyaWNhaW4uXCJcbiAgICAgICAgfSxcbiAgICAgICAgYmFyQ2hhcnQ6IHtcbiAgICAgICAgICB4TGFiZWw6IHtcbiAgICAgICAgICAgIGVuOiBcIkhvdXIgb2YgRGF5XCIsXG4gICAgICAgICAgICBmcjogXCJIZXVyZSBkZSBsYSBKb3VybsOpZVwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICB5TGFiZWw6IHtcbiAgICAgICAgICAgIGVuOiBcIlBlcmNlbnQgTG9zcyBvZiBTZWFzb24gZHVlIHRvIEV4dHJlbWUgSGVhdFwiLFxuICAgICAgICAgICAgZnI6IFwiUG91cmNlbnRhZ2UgZGUgUGVydGUgZGUgU2Fpc29uIGR1ZSDDoCB1bmUgQ2hhbGV1ciBFeHRyw6ptZVwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICB0b29sdGlwOiB7XG4gICAgICAgICAgICBwZXJjOiB7XG4gICAgICAgICAgICAgIGVuOiBcIlBlcmNlbnQgbG9zc1wiLFxuICAgICAgICAgICAgICBmcjogXCJQb3VyY2VudGFnZSBkZSBwZXJ0ZVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGVyaW9kOiB7XG4gICAgICAgICAgICAgIGVuOiBcIlBlcmlvZFwiLFxuICAgICAgICAgICAgICBmcjogXCJQw6lyaW9kZVwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBxdWlja0luc2lnaHRzOiB7XG4gICAgICAgICAgaW50cm86IHtcbiAgICAgICAgICAgIGVuOiBgVGhlIGZpZ3VyZSBpbGx1c3RyYXRlcyB0aGUgcGVyY2VudGFnZSBvZiB0aGUgaGFydmVzdGluZyBhbmQgcGxhbnRpbmcgc2Vhc29ucyBkdXJpbmcgd2hpY2ggdGhlIFdldCBCdWxiIEdsb2JlIFRlbXBlcmF0dXJlIChXQkdUKSBzdXJwYXNzZXMgc2FmZSB3b3JraW5nIGxpbWl0cywgYXMgcGVyIHRoZSBzZWxlY3RlZCB0aHJlc2hvbGQsIHJlbGF0aXZlIHRvIHRoZSBiYXNlbGluZS4gVGhpcyBoaWdobGlnaHRzIHRoZSBwcm9qZWN0ZWQgY2hhbmdlcyBmb3IgdGhlIGZ1dHVyZS4gRm9yIGV4YW1wbGUsIGEgKioxNSUqKiBmaWd1cmUgZm9yIHRoZSBoYXJ2ZXN0aW5nIHNlYXNvbiBhdCAxMWFtIGluZGljYXRlcyB0aGF0LCB1bmRlciB0aGUgc3BlY2lmaWVkIHNjZW5hcmlvIGFuZCB5ZWFyLCB0aGVyZSB3aWxsIGJlICoqMTUlIGZld2VyIGRheXMqKiBvdXQgb2YgdGhlIHRvdGFsIHNlYXNvbiB3aGVyZSB0aGUgcG9wdWxhdGlvbiBjYW4gd29yayBzYWZlbHkgYXQgdGhhdCB0aW1lLmAsXG4gICAgICAgICAgICBmcjogYExhIGZpZ3VyZSBpbGx1c3RyZSBsZSBwb3VyY2VudGFnZSBkZXMgc2Fpc29ucyBkZSByw6ljb2x0ZSBldCBkZSBwbGFudGF0aW9uIGF1IGNvdXJzIGRlc3F1ZWxsZXMgbGEgdGVtcMOpcmF0dXJlIGR1IGdsb2JlIGh1bWlkZSAoV0JHVCkgZMOpcGFzc2UgbGVzIGxpbWl0ZXMgZGUgdHJhdmFpbCBzw6ljdXJpdGFpcmUsIHNlbG9uIGxlIHNldWlsIHPDqWxlY3Rpb25uw6ksIHBhciByYXBwb3J0IMOgIGxhIHLDqWbDqXJlbmNlLiBDZWxhIG1ldCBlbiDDqXZpZGVuY2UgbGVzIGNoYW5nZW1lbnRzIHByb2pldMOpcyBwb3VyIGzigJlhdmVuaXIuIFBhciBleGVtcGxlLCB1biBjaGlmZnJlIGRlICoqMTUlKiogcG91ciBsYSBzYWlzb24gZGUgcsOpY29sdGUgw6AgMTEgaGV1cmVzIGR1IG1hdGluIGluZGlxdWUgcXVlLCBzZWxvbiBsZSBzY8OpbmFyaW8gZXQgbCdhbm7DqWUgc3DDqWNpZmnDqXMsIGlsIHkgYXVyYSAqKjE1JSBkZSBqb3VycyBlbiBtb2lucyoqIHN1ciBsYSBzYWlzb24gdG90YWxlIG/DuSBsYSBwb3B1bGF0aW9uIHBvdXJyYSB0cmF2YWlsbGVyIGVuIHRvdXRlIHPDqWN1cml0w6kgw6AgY2UgbW9tZW50LWzDoC5gXG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiB7XG4gICAgICAgICAgICBlbjogYFVuZGVyIHNjZW5hcmlvICoqOjo6c2NlbmFyaW86OjoqKiBhbmQgeWVhciAqKjo6OnllYXI6OjoqKiwgYSBwb2xpY3kgb2YgYXZvaWRpbmcgdW5zYWZlIHdvcmtpbmcgaG91cnMgd291bGQgdHJhbnNsYXRlIGludG8gKio6Ojp0b3RhbEhvdXJzOjo6Kiogd29ya2luZyBob3VycyBsb3N0IGR1cmluZyB0aGUgaGFydmVzdGluZyBzZWFzb24sIHNwYW5uaW5nICoqOjo6ZGF5c0hhcnZlc3Q6OjoqKiBkYXlzOyBpZiB3ZSBjb25zaWRlciBhIGNvbW1vbiB3b3JraW5nIGRheSB0byBoYXZlIDggaG91cnMsIHRoaXMgdHJhbnNsYXRlcyBpbnRvICoqOjo6d2hvbGVXb3JraW5nRGF5czo6OioqIHRvdGFsIHdvcmtpbmcgZGF5cyBsb3N0IGluIGhhcnZlc3RpbmcgaW4gYSB5ZWFyLmAsXG4gICAgICAgICAgICBmcjogYERhbnMgbGUgc2PDqW5hcmlvICoqOjo6c2NlbmFyaW86OjoqKiBldCBs4oCZYW5uw6llICoqOjo6eWVhcjo6OioqLCB1bmUgcG9saXRpcXVlIHZpc2FudCDDoCDDqXZpdGVyIGxlcyBoZXVyZXMgZGUgdHJhdmFpbCBkYW5nZXJldXNlcyBzZSB0cmFkdWlyYWl0IHBhciAqKjo6OnRvdGFsSG91cnM6OjoqKiBoZXVyZXMgZGUgdHJhdmFpbCBwZXJkdWVzIHBlbmRhbnQgbGEgc2Fpc29uIGRlcyByw6ljb2x0ZXMsIHPigJnDqXRhbGFudCBzdXIgKio6OjpkYXlzSGFydmVzdDo6OioqIGpvdXJzOyBzaSBs4oCZb24gY29uc2lkw6hyZSBxdeKAmXVuZSBqb3VybsOpZSBkZSB0cmF2YWlsIGNvbW11bmUgY29tcHRlIDggaGV1cmVzLCBjZWxhIHNlIHRyYWR1aXQgcGFyICoqOjo6d2hvbGVXb3JraW5nRGF5czo6OioqIGpvdXJzIGRlIHRyYXZhaWwgcGVyZHVzIGF1IHRvdGFsIHBvdXIgbGEgcsOpY29sdGUgYXUgY291cnMgZOKAmXVuZSBhbm7DqWUuYFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbG9zdERheXM6IHtcbiAgICAgICAgICAgIGVuOiBgRm9yIHRoZSBwbGFudGluZyBwZXJpb2QsIHNwYW5uaW5nICoqOjo6cGVyaW9kOjo6KiogZGF5cywgKio6OjpnZW86OjoqKiB3b3VsZCBsb3NlICoqOjo6bG9zdERheXM6OjoqKiB3aG9sZSB3b3JraW5nIGRheXMuYCxcbiAgICAgICAgICAgIGZyOiBgUG91ciBsYSBww6lyaW9kZSBkZSBwbGFudGF0aW9uLCBxdWkgcyfDqXRlbmQgc3VyICoqOjo6cGVyaW9kOjo6Kiogam91cnMsICoqOjo6Z2VvOjo6KiogcGVyZHJhaXQgKio6Ojpsb3N0RGF5czo6OioqIGpvdXJzIGRlIHRyYXZhaWwgZW50aWVycy5gXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgc3VtbWFyeToge1xuICAgICAgICB0aXRsZToge1xuICAgICAgICAgIGVuOiBcIlN1bW1hcnlcIixcbiAgICAgICAgICBmcjogXCJSw6lzdW3DqVwiXG4gICAgICAgIH0sXG4gICAgICAgIGludHJvOiB7XG4gICAgICAgICAgZW46IFwiQ2xpbWF0ZSBjaGFuZ2Ugd2lsbCBkcml2ZSBkaXNydXB0aW9ucyB0byB0aGUgQWZyaWNhbiBhZ3JpY3VsdHVyYWwgbGFib3VyIGZvcmNlLiBUaGlzIGhhcyBpbXBvcnRhbnQgaW1wbGljYXRpb25zIGZvciBlY29ub21pYyBkZXZlbG9wbWVudCwgaHVtYW4gaGVhbHRoLCBnZW5kZXIgZXF1aXR5LCBhcyB3ZWxsIGFzIGZvb2Qgc2VjdXJpdHkuIFRoZSBzaXplIG9mIHRoZSBleHBlY3RlZCBkaXNydXB0aW9ucyBkZXBlbmQgbm90IG9ubHkgb24gY2xpbWF0ZSBzdHJlc3NvcnMsIHN1Y2ggYXMgaW5jcmVhc2luZyBoZWF0IHN0cmVzcywgYnV0IGFsc28gb24gdGhlIGV4cGVjdGVkIGNoYW5nZSBpbiB0aGUgc2l6ZSBvZiB0aGUgYWdyaWN1bHR1cmFsIHdvcmtmb3JjZS4gVGhlcmUgYXJlIGEgbnVtYmVyIG9mIGxvY2F0aW9ucyB3aGVyZSB0aGVzZSB0d28gZmFjdG9ycyB3aWxsIGNvbGxpZGUsIGRyaXZpbmcgaW5jcmVhc2VkIHJpc2tzLCBsb3NzIG9mIHNhZmUgd29ya2luZyBob3VycywgYWdyaWN1bHR1cmFsIHByb2R1Y3Rpdml0eSwgYW5kIHVsdGltYXRlbHkgdGhlIHJpZ2h0IHRvIHdvcmsgaW4gYSBzYWZlIGNsaW1hdGUgZm9yIG1pbGxpb25zLiBBIG51bWJlciBvZiBzb2x1dGlvbnMgaGF2ZSBiZWVuIHByb3Bvc2VkIHRvIGRlYWwgd2l0aCB0aGlzIHN0cmVzcywgaW5jbHVkaW5nIHNoaWZ0aW5nIHdvcmtpbmcgaG91cnMgc2hpZnRpbmcgaW4gd29ya2luZyBob3VycywgaW5jcmVhc2VkIHNoYWRlIG9uIGZhcm1zLCBpbmNyZWFzZWQgbWVjaGFuaXNhdGlvbiwgaW1wcm92ZWQgd29ya2VyIHNhZmV0eSBwcm90b2NvbHMsIGltcHJvdmVkIGh5ZHJhdGlvbiBhbmQgb3RoZXIgaGVhdCBzdHJlc3MgY29waW5nIG1lY2hhbmlzbXMuIFVsdGltYXRlbHkgaG93ZXZlciwgc29sdXRpb25zIG9uIHRoZSBzY2FsZSBvZiBhZGFwdGF0aW9uIHJlcXVpcmVkIGhhdmUgeWV0IHRvIGJlIGRldmVsb3BlZCwgYW5kIGJhc2VkIG9uIHRoZSBzaXplIG9mIHRoaXMgcmlzayBuZWVkIHRvIGJlIGFkZHJlc3NlZCB1cmdlbnRseSB0byBtYWludGFpbiBodW1hbiBoZWFsdGggYW5kIGVudmlyb25tZW50YWwgcmlnaHRzLCBhZ3JpY3VsdHVyYWwgcHJvZHVjdGl2aXR5LCBhbmQgZm9vZCBzZWN1cml0eSwgbm93IGFuZCBpbiB0aGUgZnV0dXJlLlwiLFxuICAgICAgICAgIGZyOiBcIkxlIGNoYW5nZW1lbnQgY2xpbWF0aXF1ZSBlbnRyYcOubmVyYSBkZXMgcGVydHVyYmF0aW9ucyBkYW5zIGxhIG1haW4tZOKAmcWTdXZyZSBhZ3JpY29sZSBhZnJpY2FpbmUuIENlbGEgYSBkZXMgaW1wbGljYXRpb25zIGltcG9ydGFudGVzIHBvdXIgbGUgZMOpdmVsb3BwZW1lbnQgw6ljb25vbWlxdWUsIGxhIHNhbnTDqSBodW1haW5lLCBs4oCZw6lxdWl0w6kgZW50cmUgbGVzIHNleGVzIGFpbnNpIHF1ZSBsYSBzw6ljdXJpdMOpIGFsaW1lbnRhaXJlLiBM4oCZYW1wbGV1ciBkZXMgcGVydHVyYmF0aW9ucyBhdHRlbmR1ZXMgZMOpcGVuZCBub24gc2V1bGVtZW50IGRlcyBmYWN0ZXVycyBkZSBzdHJlc3MgY2xpbWF0aXF1ZXMsIHRlbHMgcXVlIGzigJlhdWdtZW50YXRpb24gZHUgc3RyZXNzIHRoZXJtaXF1ZSwgbWFpcyDDqWdhbGVtZW50IGRlIGzigJnDqXZvbHV0aW9uIGF0dGVuZHVlIGRlIGxhIHRhaWxsZSBkZSBsYSBtYWluIGTigJnFk3V2cmUgYWdyaWNvbGUuIElsIGV4aXN0ZSB1biBjZXJ0YWluIG5vbWJyZSBk4oCZZW5kcm9pdHMgb8O5IGNlcyBkZXV4IGZhY3RldXJzIGVudHJlcm9udCBlbiBjb2xsaXNpb24sIGVudHJhw65uYW50IHVuZSBhdWdtZW50YXRpb24gZGVzIHJpc3F1ZXMsIHVuZSBwZXJ0ZSBk4oCZaGV1cmVzIGRlIHRyYXZhaWwgc8O7cmVzLCB1bmUgcGVydGUgZGUgcHJvZHVjdGl2aXTDqSBhZ3JpY29sZSBldCwgZW4gZmluIGRlIGNvbXB0ZSwgbGUgZHJvaXQgZGUgdHJhdmFpbGxlciBkYW5zIHVuIGNsaW1hdCBzw7tyIHBvdXIgZGVzIG1pbGxpb25zIGRlIHBlcnNvbm5lcy4gVW4gY2VydGFpbiBub21icmUgZGUgc29sdXRpb25zIG9udCDDqXTDqSBwcm9wb3PDqWVzIHBvdXIgZmFpcmUgZmFjZSDDoCBjZSBzdHJlc3MsIG5vdGFtbWVudCBsZSBkw6ljYWxhZ2UgZGVzIGhvcmFpcmVzIGRlIHRyYXZhaWwsIGwnYXVnbWVudGF0aW9uIGRlIGwnb21icmUgZGFucyBsZXMgZmVybWVzLCBsJ2F1Z21lbnRhdGlvbiBkZSBsYSBtw6ljYW5pc2F0aW9uLCBsJ2Ftw6lsaW9yYXRpb24gZGVzIHByb3RvY29sZXMgZGUgc8OpY3VyaXTDqSBkZXMgdHJhdmFpbGxldXJzLCBsJ2Ftw6lsaW9yYXRpb24gZGUgbCdoeWRyYXRhdGlvbiBldCBkJ2F1dHJlcyBtw6ljYW5pc21lcyBkJ2FkYXB0YXRpb24gYXUgc3RyZXNzIHRoZXJtaXF1ZS4gVG91dGVmb2lzLCBlbiBmaW4gZGUgY29tcHRlLCBsZXMgc29sdXRpb25zIMOgIGzigJnDqWNoZWxsZSBk4oCZYWRhcHRhdGlvbiByZXF1aXNlIGRvaXZlbnQgZW5jb3JlIMOqdHJlIGTDqXZlbG9wcMOpZXMgZXQsIGNvbXB0ZSB0ZW51IGRlIGzigJlhbXBsZXVyIGRlIGNlIHJpc3F1ZSwgaWwgY29udmllbnQgZOKAmXkgcmVtw6lkaWVyIGRlIHRvdXRlIHVyZ2VuY2UgYWZpbiBkZSBwcsOpc2VydmVyIGxhIHNhbnTDqSBodW1haW5lIGV0IGxlcyBkcm9pdHMgZW52aXJvbm5lbWVudGF1eCwgbGEgcHJvZHVjdGl2aXTDqSBhZ3JpY29sZSBldCBsYSBzw6ljdXJpdMOpIGFsaW1lbnRhaXJlLCBhdWpvdXJk4oCZaHVpIGV0IMOgIGzigJlhdmVuaXIuXCJcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIG1ldGhvZHM6IHtcbiAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICBlbjogXCJNZXRob2RzXCIsXG4gICAgICAgICAgZnI6IFwiTcOpdGhvZG9sb2dpZVwiXG4gICAgICAgIH0sXG4gICAgICAgIGFnV29ya2ZvcmNlOiB7XG4gICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgIGVuOiBcIkFncmljdWx0dXJhbCB3b3JrZm9yY2VcIixcbiAgICAgICAgICAgIGZyOiBcIk1haW4gZCfFk3V2cmUgYWdyaWNvbGVcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgYm9keToge1xuICAgICAgICAgICAgZW46IGBXZSBnZW5lcmF0ZWQgZ3JpZGRlZCBwcmVkaWN0aW9ucyBmb3IgdGhlIGFncmljdWx0dXJhbCB3b3JrZm9yY2UgYnkgZmlyc3QgaGFybW9uaXNpbmcgc3VibmF0aW9uYWwgZGF0YSBmcm9tIGNlbnN1cyBzdGF0aXN0aWNzIGZyb20gYSByYW5nZSBvZiBnb3Zlcm5tZW50IHNvdXJjZXMsIHdpdGggbmF0aW9uYWwgZGF0YSBmcm9tIHRoZSBbSW50ZXJuYXRpb25hbCBMYWJvdXIgT3JnYW5pc2F0aW9uIChJTE8pXShodHRwczovL3JzaGlueS5pbG8ub3JnL2RhdGFleHBsb3JlcjM2Lz9sYW5nPWVuJnNlZ21lbnQ9aW5kaWNhdG9yJmlkPUVBUF8yV0FQX1NFWF9BR0VfUlRfQSkgb24gdGhlIHByb3BvcnRpb24gb2YgdGhlIHBvcHVsYXRpb24gZW1wbG95ZWQgaW4gYWdyaWN1bHR1cmUuIFRoZW4sIHVzaW5nIGEgZ2Vvc3BhdGlhbCB2ZXJzaW9uIG9mIHRoZSBwcmVkaWN0aXZlIGZyYW1ld29yayBpbnRyb2R1Y2VkIGJ5IFtNZWhyYWJpLCBaICgyMDIzKSBOYXQgU3VzdF0oaHR0cHM6Ly9kb2kub3JnLzEwLjEwMzgvczQxODkzLTAyMy0wMTExMC15KSwgd2UgZml0IGZ1bmN0aW9ucyByZWxhdGluZyB3b3JrZm9yY2Ugc2l6ZSB0byBbcG9wdWxhdGlvbiBzdGF0aXN0aWNzIGZyb20gSm9uZXMgYW5kIE/igJlOZWlsbCAoMjAxNildKGh0dHBzOi8vd3d3LmNnZC51Y2FyLmVkdS9zZWN0aW9ucy9pYW0vbW9kZWxpbmcvc3BhdGlhbC1wb3B1bGF0aW9uKSwgW2dyaWRkZWQgZ2RwIGZyb20gV2FuZyBhbmQgU3VuICgyMDIyKV0oaHR0cHM6Ly93d3cubmF0dXJlLmNvbS9hcnRpY2xlcy9zNDE1OTctMDIyLTAxMzAwLXgpLCBhbmQgW2FncmljdWx0dXJhbCBsYW5kIGFyZWEgYnkgUmFtYW5rdXR0eSBldCBhbC4gKDIwMDgpXShodHRwczovL2FndXB1YnMub25saW5lbGlicmFyeS53aWxleS5jb20vZG9pLzEwLjEwMjkvMjAwN0dCMDAyOTUyKS4gV2UgZW1wbG95ZWQgc3RhY2tlZCBtYWNoaW5lIGxlYXJuaW5nIG1vZGVscyAoYm9vc3RlZCByZWdyZXNzaW9uIHRyZWVzLCByYW5kb20gZm9yZXN0cykgZm9yIHRoZSBmaXR0aW5nIHByb2Nlc3MuIFVzaW5nIHRoZXNlIG1vZGVscyBhbmQgY3VycmVudCBhbmQgZnV0dXJlIGdyaWRkZWQgZGF0YSB3ZSBnZW5lcmF0ZWQgYmFzZWxpbmUtcGVyaW9kIChjaXJjYSAyMDA1KSBhbmQgZnV0dXJlICgyMDMwLCAyMDUwKSBlc3RpbWF0ZXMgb2YgdGhlIGFncmljdWx0dXJhbCB3b3JrZm9yY2UgYXQgMC4wODMgZGVncmVlcyByZXNvbHV0aW9uIGZvciB0aGUgQWZyaWNhbiBjb250aW5lbnQuYCxcbiAgICAgICAgICAgIGZyOiBgTm91cyBhdm9ucyBnw6luw6lyw6kgZGVzIHByw6l2aXNpb25zIGVuIGdyaWxsZSBwb3VyIGxhIG1haW4tZCfFk3V2cmUgYWdyaWNvbGUgZW4gaGFybW9uaXNhbnQgZCdhYm9yZCBsZXMgZG9ubsOpZXMgc3VibmF0aW9uYWxlcyBpc3N1ZXMgZGVzIHN0YXRpc3RpcXVlcyBkZSByZWNlbnNlbWVudCBwcm92ZW5hbnQgZGUgZGl2ZXJzZXMgc291cmNlcyBnb3V2ZXJuZW1lbnRhbGVzLCBhdmVjIGxlcyBkb25uw6llcyBuYXRpb25hbGVzIGRlIFtsJ09yZ2FuaXNhdGlvbiBpbnRlcm5hdGlvbmFsZSBkdSB0cmF2YWlsXShodHRwczovL3JzaGlueS5pbG8ub3JnL2RhdGFleHBsb3JlcjM2Lz9sYW5nPWVuJnNlZ21lbnQ9aW5kaWNhdG9yJmlkPUVBUF8yV0FQX1NFWF9BR0VfUlRfQSkgKE9JVCkgc3VyIGxhIHByb3BvcnRpb24gZGUgbGEgcG9wdWxhdGlvbiBlbXBsb3nDqWUgZGFucyBsJ2FncmljdWx0dXJlLiBFbnN1aXRlLCBlbiB1dGlsaXNhbnQgdW5lIHZlcnNpb24gZ8Opb3NwYXRpYWxlIGR1IGNhZHJlIHByw6lkaWN0aWYgaW50cm9kdWl0IHBhciBbTWVocmFiaSwgWiAoMjAyMykgTmF0IFN1c3RdKGh0dHBzOi8vZG9pLm9yZy8xMC4xMDM4L3M0MTg5My0wMjMtMDExMTAteSksIG5vdXMgYWp1c3RvbnMgbGVzIGZvbmN0aW9ucyByZWxpYW50IGxhIHRhaWxsZSBkZSBsYSBtYWluLWQnxZN1dnJlIGF1eCBbc3RhdGlzdGlxdWVzIGTDqW1vZ3JhcGhpcXVlcyBkZSBKb25lcyBldCBPJ05laWxsICgyMDE2KV0oaHR0cHM6Ly93d3cuY2dkLnVjYXIuZWR1L3NlY3Rpb25zL2lhbS9tb2RlbGluZy9zcGF0aWFsLXBvcHVsYXRpb24pLCBbbGUgUElCIG1haWxsw6kgZGUgV2FuZyBldCBTdW4gKDIwMjIpXShodHRwczovL3d3dy5uYXR1cmUuY29tL2FydGljbGVzL3M0MTU5Ny0wMjItMDEzMDAteCksIGV0IGxhIFtzdXBlcmZpY2llIGRlcyB0ZXJyZXMgYWdyaWNvbGVzIHBhciBSYW1hbmt1dHR5IGV0IGFsLiAoMjAwOCldKGh0dHBzOi8vYWd1cHVicy5vbmxpbmVsaWJyYXJ5LndpbGV5LmNvbS9kb2kvMTAuMTAyOS8yMDA3R0IwMDI5NTIpLiBOb3VzIGF2b25zIHV0aWxpc8OpIGRlcyBtb2TDqGxlcyBkJ2FwcHJlbnRpc3NhZ2UgYXV0b21hdGlxdWUgZW1waWzDqXMgKGFyYnJlcyBkZSByw6lncmVzc2lvbiBhbcOpbGlvcsOpcywgcmFuZG9tIGZvcmVzdHMpIHBvdXIgbGUgcHJvY2Vzc3VzIGQnYWp1c3RlbWVudC4gw4AgbOKAmWFpZGUgZGUgY2VzIG1vZMOobGVzIGV0IGRlcyBkb25uw6llcyBlbiBncmlsbGUgYWN0dWVsbGVzIGV0IGZ1dHVyZXMsIG5vdXMgYXZvbnMgZ8OpbsOpcsOpIGRlcyBlc3RpbWF0aW9ucyBwb3VyIGxhIHDDqXJpb2RlIGRlIHLDqWbDqXJlbmNlICh2ZXJzIDIwMDUpIGV0IGZ1dHVyZSAoMjAzMCwgMjA1MCkgZGUgbGEgbWFpbi1k4oCZxZN1dnJlIGFncmljb2xlIGF2ZWMgdW5lIHLDqXNvbHV0aW9uIGRlIDAsMDgzIGRlZ3LDqXMgcG91ciBsZSBjb250aW5lbnQgYWZyaWNhaW4uYFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgaGVhdFN0cmVzczoge1xuICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICBlbjogXCJIZWF0IHN0cmVzc1wiLFxuICAgICAgICAgICAgZnI6IFwiU3RyZXNzIHRoZXJtaXF1ZVwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiB7XG4gICAgICAgICAgICBlbjogYFdlIHVzZSBoaWdoLXJlc29sdXRpb24sIGRhaWx5IGdyaWRkZWQgZGF0YSBmcm9tIHRoZSBDbGltYXRlIEhhemFyZHMgQ2VudGVyIENvdXBsZWQgTW9kZWwgSW50ZXJjb21wYXJpc29uIFByb2plY3QgUGhhc2UgNiAoQ0hDLUNNSVA2KSBkYXRhc2V0IFtXaWxsaWFtcyBldCBhbC4gKDIwMjQpXShodHRwczovL3d3dy5uYXR1cmUuY29tL2FydGljbGVzL3M0MTU5Ny0wMjQtMDMwNzQtdykuIFRoZSBDSEMtQ01JUDYgZGF0YXNldCBwcm92aWRlcyBmdXR1cmUgZXN0aW1hdGVzIGZvciAyMDMwIGFuZCAyMDUwLCB3aG9zZSBkZWx0YSBmaWVsZHMgYXJlIGJhc2VkIG9uIHRoZSBDTUlQNiBtdWx0aS1tb2RlbCBlbnNlbWJsZSBmb3JlY2FzdHMgZm9yIHRoZSBTU1AgMjQ1IGFuZCBTU1AgNTg1IHNjZW5hcmlvcy4gQXMgaW5wdXRzIHRvIGNvbXB1dGUgV0JHVCB2YWx1ZXMsIHdlIHRha2UgZnJvbSB0aGUgZGF0YXNldCB0aHJlZSBtYWluIHZhcmlhYmxlczogdGhlIGRhaWx5IG1heGltdW0gYW5kIG1pbmltdW0gdGVtcGVyYXR1cmVzIChUbWF4IGFuZCBUbWluKSwgYXMgd2VsbCBhcyB0aGUgbWF4aW11bSBkYWlseSByZWxhdGl2ZSBodW1pZGl0eSAoUkh4KSB0aGF0IG9jY3VycyBhdCB0aGUgdGltZSBvZiBUbWF4LCBmb3IgYm90aCwgdGhlIG9ic2VydmF0aW9uIHBlcmlvZCAoY2lyY2EgMjAwNSwgYXZlcmFnZSB0YWtlbiBhY3Jvc3MgMTAgeWVhcnMpLCBhbmQgdGhlIGZ1dHVyZSBwcm9qZWN0aW9ucyB1bmRlciBTU1AgMi40NSBhbmQgNS44NSAoeWVhcnMgMjAzMCBhbmQgMjA1MCwgYXZlcmFnZSB0YWtlbiBhY3Jvc3MgMTAgeWVhcnMpLmAsXG4gICAgICAgICAgICBmcjogYE5vdXMgdXRpbGlzb25zIGRlcyBkb25uw6llcyBlbiBncmlsbGUgcXVvdGlkaWVubmVzIMOgIGhhdXRlIHLDqXNvbHV0aW9uIHByb3ZlbmFudCBkZSBsJ2Vuc2VtYmxlIGRlIGRvbm7DqWVzIGRlIGxhIHBoYXNlIDYgZHUgcHJvamV0IGRlIGNvbXBhcmFpc29uIGRlIG1vZMOobGVzIGNvdXBsw6lzIGR1IENsaW1hdGUgSGF6YXJkcyBDZW50ZXIgKENIQy1DTUlQNikgW1dpbGxpYW1zIGV0IGFsLiAoMjAyNCldKGh0dHBzOi8vd3d3Lm5hdHVyZS5jb20vYXJ0aWNsZXMvczQxNTk3LTAyNC0wMzA3NC13KS4gTCdlbnNlbWJsZSBkZSBkb25uw6llcyBDSEMtQ01JUDYgZm91cm5pdCBkZXMgZXN0aW1hdGlvbnMgZnV0dXJlcyBwb3VyIDIwMzAgZXQgMjA1MCwgZG9udCBsZXMgY2hhbXBzIGRlbHRhIHNvbnQgYmFzw6lzIHN1ciBsZXMgcHLDqXZpc2lvbnMgZCdlbnNlbWJsZSBtdWx0aW1vZMOobGVzIENNSVA2IHBvdXIgbGVzIHNjw6luYXJpb3MgU1NQIDI0NSBldCBTU1AgNTg1LiBDb21tZSBlbnRyw6llcyBwb3VyIGNhbGN1bGVyIGxlcyB2YWxldXJzIFdCR1QsIG5vdXMgcHJlbm9ucyDDoCBwYXJ0aXIgZGUgbCdlbnNlbWJsZSBkZSBkb25uw6llcyB0cm9pcyB2YXJpYWJsZXMgcHJpbmNpcGFsZXMgOiBsZXMgdGVtcMOpcmF0dXJlcyBxdW90aWRpZW5uZXMgbWF4aW1hbGVzIGV0IG1pbmltYWxlcyAoVG1heCBldCBUbWluKSwgYWluc2kgcXVlIGwnaHVtaWRpdMOpIHJlbGF0aXZlIHF1b3RpZGllbm5lIG1heGltYWxlIChSSHgpIHF1aSBzZSBwcm9kdWl0IGF1IG1vbWVudCBkZSBUbWF4LCBwb3VyIGxlcyBkZXV4LCBsYSBww6lyaW9kZSBk4oCZb2JzZXJ2YXRpb24gKHZlcnMgMjAwNSwgbW95ZW5uZSBzdXIgMTAgYW5zKSBldCBsZXMgcHJvamVjdGlvbnMgZnV0dXJlcyBkYW5zIGxlIGNhZHJlIGRlcyBQQVMgMiw0NSBldCA1LDg1IChhbm7DqWVzIDIwMzAgZXQgMjA1MCwgbW95ZW5uZSBzdXIgMTAgYW5zKS5gXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBob3VybHlFeHBvc3VyZToge1xuICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICBlbjogXCJIb3VybHkgZXhwb3N1cmVcIixcbiAgICAgICAgICAgIGZyOiBcIkV4cG9zaXRpb24gaG9yYWlyZVwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiB7XG4gICAgICAgICAgICBlbjogYFdlIGV4YW1pbmUgYWdyaWN1bHR1cmFsIHdvcmtlcnMnIGhvdXJseSBleHBvc3VyZSB0byBoZWF0IHN0cmVzcyBkdXJpbmcgdGhlIGhhcnZlc3RpbmcgYW5kIHBsYW50aW5nIHNlYXNvbnMsIGNydWNpYWwgcGVyaW9kcyBpbiB0aGUgYWdyaWN1bHR1cmFsIGNhbGVuZGFyLCB3aGVyZSBhZ3JpY3VsdHVyYWwgbGFib3VyZXJzIGFyZSBleHBvc2VkIHRvIHByb2xvbmdlZCBsYWJvdXItaW50ZW5zZSBvdXRkb29yIGFjdGl2aXR5LCBtYWtpbmcgdGhlbSBtb3JlIHN1c2NlcHRpYmxlIHRvIHRoZSBpbXBhY3RzIG9mIGhlYXQgc3RyZXNzLiBXZSB1c2UgdGhlIGNyb3AgY2FsZW5kYXJzIGZyb20gW0dHQ01JIFBoYXNlIDNdKGh0dHBzOi8vemVub2RvLm9yZy9yZWNvcmRzLzUwNjI1MTMpLCB3aGljaCBwcm92aWRlIHRoZSBwbGFudGluZyBhbmQgaGFydmVzdGluZyBkYXRlcyBmb3IgZWlnaHRlZW4gZGlzdGluY3QgY3JvcHMgYW5kIHNob3cgZXhwb3N1cmUgaGlzdG9ncmFtcyBkdXJpbmcgdGhlc2UgcGVyaW9kcy4gVGhlIGhpc3RvZ3JhbXMgcXVhbnRpZnkgdGhlIHBlcmNlbnRhZ2Ugb2YgZGF5cyB3aXRoaW4gdGhlIGhhcnZlc3Rpbmcgb3IgcGxhbnRpbmcgcGVyaW9kcyB0aGF0IHN1cnBhc3MgV0JHVCBzYWZldHkgc3RhbmRhcmRzIGZvciBlYWNoIGhvdXIgb2YgdGhlIGRheS4gSGVyZSB3ZSBjb21wdXRlIGFuZCByZWx5IG9uIGhvdXJseSBXQkdUIGV4Y2VlZGFuY2VzIGluIHByZXNlbnQgYW5kIGZ1dHVyZSwgZm9yIGRpZmZlcmVudCBTU1BzIGFuZCB5ZWFycy4gVGhlIGNhbGN1bGF0aW9ucyBmb3IgdGhlIGhvdXJseSB0ZW1wZXJhdHVyZSByZWx5IG9uIExpbnZpbGzigJlzICgxOTkwKSBtZXRob2QgZm9yIHByZWRpY3RpbmcgaG91cmx5IHRlbXBlcmF0dXJlcyBmcm9tIGRhaWx5IG1pbmltdW0gYW5kIG1heGltdW0gbWVhc3VyZW1lbnRzLiBUbyBjb21wdXRlIHN1Y2ggdGVtcGVyYXR1cmUgcHJvZmlsZXMsIHdlIHJlbHkgb24gZGF5bGVuZ3RoIHZhbHVlcywgbWFpbmx5IHRha2VuIGZyb20gW1NwZW5jZXIgKDE5NzEpXShodHRwczovL3d3dy5tYWlsLWFyY2hpdmUuY29tL3N1bmRpYWxAdW5pLWtvZWxuLmRlL21zZzAxMDUwLmh0bWwpLiBUaGlzIGFwcHJvYWNoIHdhcyB1c2VkIHRvIGNyZWF0ZSBob3VybHkgdGVtcGVyYXR1cmUgcHJvZmlsZXM7IHRoZW4sIGhvdXJseSBoZWF0IGluZGV4IHZhbHVlcyByZWx5aW5nIG9uIHJlbGF0aXZlIGh1bWlkaXR5IHZhbHVlcyBhbmQgZm9sbG93aW5nIHRoZSBbTk9BQSBndWlkZWxpbmVzXShodHRwczovL3d3dy53cGMubmNlcC5ub2FhLmdvdi9odG1sL2hlYXRpbmRleF9lcXVhdGlvbi5zaHRtbCk7IGFuZCwgZmluYWxseSwgaG91cmx5IFdCR1QsIHdoaWNoIHdhcyBldmFsdWF0ZWQgYXQgdGhyZWUgZGlmZmVyZW50IHRocmVzaG9sZHMg4oCTIDI4LCAzMCBhbmQgMzIgZGVncmVlcyBDZWxzaXVzLmAsXG4gICAgICAgICAgICBmcjogYE5vdXMgZXhhbWlub25zIGwnZXhwb3NpdGlvbiBob3JhaXJlIGRlcyB0cmF2YWlsbGV1cnMgYWdyaWNvbGVzIGF1IHN0cmVzcyB0aGVybWlxdWUgcGVuZGFudCBsZXMgc2Fpc29ucyBkZSByw6ljb2x0ZSBldCBkZSBwbGFudGF0aW9uLCBww6lyaW9kZXMgY3J1Y2lhbGVzIGR1IGNhbGVuZHJpZXIgYWdyaWNvbGUsIG/DuSBsZXMgdHJhdmFpbGxldXJzIGFncmljb2xlcyBzb250IGV4cG9zw6lzIMOgIHVuZSBhY3Rpdml0w6kgZXh0w6lyaWV1cmUgcHJvbG9uZ8OpZSBldCBpbnRlbnNlLCBsZXMgcmVuZGFudCBwbHVzIHNlbnNpYmxlcyBhdXggaW1wYWN0cyBkdSBzdHJlc3MgdGhlcm1pcXVlLiBOb3VzIHV0aWxpc29ucyBsZXMgY2FsZW5kcmllcnMgZGUgY3VsdHVyZXMgZGUgbGEgW3BoYXNlIDMgZHUgR0dDTUldKGh0dHBzOi8vemVub2RvLm9yZy9yZWNvcmRzLzUwNjI1MTMpLCBxdWkgZm91cm5pc3NlbnQgbGVzIGRhdGVzIGRlIHBsYW50YXRpb24gZXQgZGUgcsOpY29sdGUgZGUgZGl4LWh1aXQgY3VsdHVyZXMgZGlzdGluY3RlcyBldCBhZmZpY2hlbnQgZGVzIGhpc3RvZ3JhbW1lcyBkJ2V4cG9zaXRpb24gcGVuZGFudCBjZXMgcMOpcmlvZGVzLiBMZXMgaGlzdG9ncmFtbWVzIHF1YW50aWZpZW50IGxlIHBvdXJjZW50YWdlIGRlIGpvdXJzIGF1IGNvdXJzIGRlcyBww6lyaW9kZXMgZGUgcsOpY29sdGUgb3UgZGUgcGxhbnRhdGlvbiBxdWkgZMOpcGFzc2VudCBsZXMgbm9ybWVzIGRlIHPDqWN1cml0w6kgZHUgV0JHVCBwb3VyIGNoYXF1ZSBoZXVyZSBkZSBsYSBqb3VybsOpZS4gSWNpLCBub3VzIGNhbGN1bG9ucyBldCBub3VzIGFwcHV5b25zIHN1ciBsZXMgZMOpcGFzc2VtZW50cyBob3JhaXJlcyBkdSBXQkdUIGRhbnMgbGUgcHLDqXNlbnQgZXQgbGUgZnV0dXIsIHBvdXIgZGlmZsOpcmVudHMgU1NQIGV0IGFubsOpZXMuIExlcyBjYWxjdWxzIGRlIHRlbXDDqXJhdHVyZSBob3JhaXJlIHPigJlhcHB1aWVudCBzdXIgbGEgbcOpdGhvZGUgZGUgTGludmlsbCAoMTk5MCkgcG91ciBwcsOpZGlyZSBsZXMgdGVtcMOpcmF0dXJlcyBob3JhaXJlcyDDoCBwYXJ0aXIgZGUgbWVzdXJlcyBxdW90aWRpZW5uZXMgbWluaW1hbGVzIGV0IG1heGltYWxlcy4gUG91ciBjYWxjdWxlciBkZSB0ZWxzIHByb2ZpbHMgZGUgdGVtcMOpcmF0dXJlLCBub3VzIG5vdXMgYXBwdXlvbnMgc3VyIGxlcyB2YWxldXJzIGRlIGxvbmd1ZXVyIGR1IGpvdXIsIHByaW5jaXBhbGVtZW50IHRpcsOpZXMgZGUgW1NwZW5jZXIgKDE5NzEpXShodHRwczovL3d3dy5tYWlsLWFyY2hpdmUuY29tL3N1bmRpYWxAdW5pLWtvZWxuLmRlL21zZzAxMDUwLmh0bWwpLiBDZXR0ZSBhcHByb2NoZSBhIMOpdMOpIHV0aWxpc8OpZSBwb3VyIGNyw6llciBkZXMgcHJvZmlscyBkZSB0ZW1ww6lyYXR1cmUgaG9yYWlyZXMgOyBwdWlzLCBsZXMgdmFsZXVycyBob3JhaXJlcyBkZSBsJ2luZGljZSBkZSBjaGFsZXVyIGJhc8OpZXMgc3VyIGxlcyB2YWxldXJzIGQnaHVtaWRpdMOpIHJlbGF0aXZlIGV0IHN1aXZhbnQgbGVzIFtkaXJlY3RpdmVzIGRlIGxhIE5PQUFdKGh0dHBzOi8vd3d3LndwYy5uY2VwLm5vYWEuZ292L2h0bWwvaGVhdGluZGV4X2VxdWF0aW9uLnNodG1sKTsgZXQgZW5maW4gbGUgV0JHVCBob3JhaXJlLCBxdWkgYSDDqXTDqSDDqXZhbHXDqSDDoCB0cm9pcyBzZXVpbHMgZGlmZsOpcmVudHMg4oCTIDI4LCAzMCBldCAzMiBkZWdyw6lzIENlbHNpdXMuYFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYWRkaXRpb25hbE1ldGhvZHM6IHtcbiAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgZW46IFwiQWRkaXRpb25hbCBtZXRob2RzXCIsXG4gICAgICAgICAgICBmcjogXCJNw6l0aG9kb2xvZ2llIHN1cHBsw6ltZW50YWlyZVwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiB7XG4gICAgICAgICAgICBlbjogYEZ1bGwgbWV0aG9kb2xvZ2ljYWwgZGV0YWlscyBhcmUgY29udGFpbmVkIGluIHR3byBmb3J0aGNvbWluZyBiYWNrZ3JvdW5kIHBhcGVyczpcbi0gT3JtYXphLVp1bHVldGEsIE4gYW5kIE1laHJhYmksIFouICpNYXBwaW5nIGdsb2JhbCBhZ3JpY3VsdHVyYWwgd29ya2ZvcmNlKlxuLSBPcm1hemEtWnVsdWV0YSwgTiBhbmQgTWVocmFiaSwgWi4gKlJlZHVjdGlvbnMgaW4gdGhlIGFncmljdWx0dXJhbCB3b3JrZGF5IGluIGZ1dHVyZSBkdWUgdG8gY2xpbWF0ZSBjaGFuZ2UqYCxcbiAgICAgICAgICAgIGZyOiBgTGVzIGTDqXRhaWxzIG3DqXRob2RvbG9naXF1ZXMgY29tcGxldHMgc29udCBjb250ZW51cyBkYW5zIGRldXggZG9jdW1lbnRzIGRlIHLDqWbDqXJlbmNlIMOgIHZlbmlyOlxuLSBPcm1hemEtWnVsdWV0YSwgTiBldCBNZWhyYWJpLCBaLiAqQ2FydG9ncmFwaGllIGRlIGxhIG1haW4tZCfFk3V2cmUgYWdyaWNvbGUgbW9uZGlhbGUqXG4tIE9ybWF6YS1adWx1ZXRhLCBOIGV0IE1laHJhYmksIFouICpSw6lkdWN0aW9ucyBkZSBsYSBqb3VybsOpZSBkZSB0cmF2YWlsIGFncmljb2xlIMOgIGwnYXZlbmlyIGVuIHJhaXNvbiBkdSBjaGFuZ2VtZW50IGNsaW1hdGlxdWUqYFxuICAgICAgICAgIH0sXG4gICAgICAgICAgbGlua05vdGU6IHtcbiAgICAgICAgICAgIGVuOiBcIkxpbmtzIHdpbGwgYmUgdXBkYXRlZCB3aGVuIHB1Ymxpc2hlZC5cIixcbiAgICAgICAgICAgIGZyOiBcIkxlcyBsaWVucyBzZXJvbnQgbWlzIMOgIGpvdXIgdW5lIGZvaXMgcHVibGnDqXMuXCJcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGNpdGF0aW9uOiB7XG4gICAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICAgIGVuOiBcIkNpdGF0aW9uXCIsXG4gICAgICAgICAgICBmcjogXCJDaXRhdGlvblwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICBib2R5OiB7XG4gICAgICAgICAgICBlbjogXCJJZiB0aGUgYWJvdmUgbGlua3MgdG8gYmFja2dyb3VuZCBwYXBlcnMgYXJlIG5vdCBsaXZlLCBwbGVhc2UgdXNlIHRoZSBmb2xsb3dpbmcgY2l0YXRpb24gZm9yIHRoaXMgYW5hbHlzaXM6IE9ybWF6YS1adWx1ZXRhLCBOIGFuZCBNZWhyYWJpLCBaLiAyMDI0LiBXaWRlc3ByZWFkIFdvcmtmb3JjZSBEaXNydXB0aW9ucy4gQWZyaWNhIEFncmljdWx0dXJlIEFkYXB0YXRpb24gQXRsYXMuIENHSUFSLlwiLFxuICAgICAgICAgICAgZnI6IFwiU2kgbGVzIGxpZW5zIGNpLWRlc3N1cyB2ZXJzIGxlcyBkb2N1bWVudHMgZGUgcsOpZsOpcmVuY2UgbmUgc29udCBwYXMgYWN0aWZzLCB2ZXVpbGxleiB1dGlsaXNlciBsYSBjaXRhdGlvbiBzdWl2YW50ZSBwb3VyIGNldHRlIGFuYWx5c2U6IE9ybWF6YS1adWx1ZXRhLCBOIGV0IE1laHJhYmksIFouIDIwMjQuIERpc3J1cHRpb25zIGfDqW7DqXJhbGlzw6llcyBkZSBsYSBtYWluLWQnxZN1dnJlLiBBdGxhcyBkZSBs4oCZYWRhcHRhdGlvbiBkZSBs4oCZYWdyaWN1bHR1cmUgZW4gQWZyaXF1ZS4gR0NSQUkuXCJcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH07XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZGF0YSB0cmFuc2xhdGlvbiB2YWx1ZXNcbnRkID0ge1xuICBsZXQgZGF0YSA9IGF3YWl0IEZpbGVBdHRhY2htZW50KFwiYWJBdGxhcy10ZC10cmFuc2xhdGlvbi1kYXRhLXYxLmpzb25cIikuanNvbigpXG5cbiAgLy8gdXBkYXRlIFNTQSBkZWZhdWx0XG4gIGRhdGEuYWRtaW4wX25hbWUudmFsdWVzLlNTQS5lbiA9IFwiU3ViLVNhaGFyYW4gQWZyaWNhXCJcbiAgLy8gY290ZSBkJ2l2b2lyZSwgY29tbWEgdmVyc2lvbiBkdXBsaWNhdGVcbiAgZGF0YS5hZG1pbjBfbmFtZS52YWx1ZXNbXCJDw7R0ZSBk4oCZSXZvaXJlXCJdID0gZGF0YS5hZG1pbjBfbmFtZS52YWx1ZXNbXCJDw7R0ZSBkJ0l2b2lyZVwiXVxuICBcbiAgcmV0dXJuIGRhdGFcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBOb3RlYm9vayBWYXJpYWJsZXNcbl9NYWluIHZhcmlhYmxlcyBhY3Jvc3Mgbm90ZWJvb2tfYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBtYWluIHRpdGxlIG9mIHRoZSBub3RlYm9va1xubm90ZWJvb2tUaXRsZSA9IF9sYW5nKHtcbiAgZW46IFwiVW5kZXJzdGFuZCBIZWF0IFN0cmVzcyBvbiBQcm9kdWNlcnNcIixcbiAgZnI6IFwiQ29tcHJlbmRyZSBsZSBzdHJlc3MgdGhlcm1pcXVlIHN1ciBsZXMgcHJvZHVjdGV1cnNcIixcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGluZm8gZm9yIHRoZSBhZG1pbiBzZWxlY3RvcnNcbmFkbWluUmVnaW9ucyA9IHtcbiAgcmV0dXJuIHtcbiAgICBsYWJlbHM6IHtcbiAgICAgIGFkbWluMDogX2xhbmcobmJUZXh0LmxlZ2VuZHMuYWRtaW5TZWxlY3Rpb25zLmNvdW50cnkpLFxuICAgICAgYWRtaW4xOiBfbGFuZyhuYlRleHQubGVnZW5kcy5hZG1pblNlbGVjdGlvbnMucmVnaW9uKSxcbiAgICAgIGFkbWluMjogX2xhbmcobmJUZXh0LmxlZ2VuZHMuYWRtaW5TZWxlY3Rpb25zLnN1YnJlZ2lvbilcbiAgICB9XG4gIH07XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gZ2V0TG93ZXJMZXZlbEFkbWluTGFiZWwoc2VsZWN0aW9ucyA9IGFkbWluU2VsZWN0aW9ucykge1xuICAvLyBiYXNlZCBvbiBhZG1pbiBzZWxlY3Rpb24sIGdldCB0aGUgbG93ZXIgbGV2ZWwgbGFiZWxcbiAgaWYgKHNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlKSByZXR1cm4gYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjI7XG4gIGlmIChzZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZSkgcmV0dXJuIGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4yO1xuICBpZiAoc2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWUpIHJldHVybiBhZG1pblJlZ2lvbnMubGFiZWxzLmFkbWluMTtcbiAgZWxzZSByZXR1cm4gYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjA7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibW9uZXRhcnlWb1BOb3RlID0gYE1vbmV0YXJ5IFZvUCB2YWx1ZXMgYXJlIHJlcHJlc2VudGVkIGluIDIwMDUgaW50ZXJuYXRpb25hbCBkb2xsYXJzLmA7IC8vIG5vdGUgYWJvdXQgVm9QIHNvdXJjZVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHdpZHRoIG9mIHRoZSBtYXBzXG5tYXBXaWR0aCA9IDYyNTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBOb3RlYm9vayBTdHlsaW5nXG4qc3R5bGluZyBoZWxwZXJzKlxuU3R5bGVzaGVldCBpcyBhIG5hbWVkIGNlbGwsIHdoaWNoIGlzIG5lY2Vzc2FyeSB0byBpbmNsdWRlIGZvciBlbWJlZHMuYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAqKkNTUyBzdHlsaW5nKipgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYCoqQ29sb3IgU2NhbGVzKipgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGNvbG9yIHNjYWxlIGluZm9cbmNvbG9yU2NhbGVzID0ge1xuICByZXR1cm4ge1xuICAgIHJhbmdlOiB7XG4gICAgICBncmVlbjogWycjRTRGNUQwJywgJyMwMTUwMjMnXSxcbiAgICAgIGJsdWU6IFsnI0U4RjJGRicsICcjMDAzRTZCJ10sXG4gICAgICBicm93bjogWycjRkZGREU1JywgJyNBODdCMDAnXSxcbiAgICAgIHllbGxvd0dyZWVuOiBbJyNGN0Q3MzInLCAnIzIxNjcyOSddLFxuICAgICAgb3JhbmdlUmVkOiBbJyNGNEJCMjEnLCAnI0VDNUE0NyddLFxuICAgICAgYmx1ZVdoaXRlUmVkOiBbJyMwMDNFNkInLCAnI0ZGRkZGRicsICcjRUM1QTQ3J10sXG4gICAgICByZWRZZWxsb3dHcmVlbjogW1wiI0VDNUE0N1wiLCBcIiNGNEJCMjFcIiwgJyMyMTY3MjknXVxuICAgIH0sXG4gICAgdW5rbm93bjogXCIjY2NjXCJcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7XG4gIGJ1aWxkSW5saW5lRG93bmxvYWRCdXR0b24sXG4gIGRvd25sb2FkQnV0dG9uQ1NTLFxuICBkb3dubG9hZF90cmFuc2xhdGlvbixcbn0gZnJvbSBcIjFiZGE1ZjliNjBjNjQyMjNcIjtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkb3dubG9hZEJ1dHRvbkNTUztcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBBZG1pbiBTZWxlY3Rpb25cbipHbG9iYWwgYWRtaW4gc2VsZWN0b3IgdXNpbmcgZHJvcGRvd25zKlxuXG5UaGlzIGlzIHRoZSBnbG9iYWwgc2VsZWN0b3IgZm9yIHRoZSBzZWxlY3RlZCByZWdpb25cbi0gVGhlIGNvbXBsZXRlZCBkYXRhIGlzIGNvbnRhaW5lZCB3aXRoaW4gYWRtaW5TZWxlY3Rpb25zIHRvIGJlIHVzZWQgaW4gcXVlcmllc1xuLSBEcm9wZG93bnMgYXJlIGRlZmluZWQgYmVsb3cgdGhlbiBib3VuZCBmb3IgZWFjaCBzZWN0aW9uXG4gIC0gRGVmaW5lZCBhcyBzZXBhcmF0ZSBjZWxscyBzaW5jZSB0aGV5IGR5bmFtaWNhbGx5IHJlc3BvbmQgdG8gZGlmZmVyZW50IHZhbHVlc1xuICAgIC0gSW4gbmFycmF0aXZlLCB0aGV5IGFyZSBzaW1wbHkgdmlld3Mgb2YgdGhlIGRhdGEgIFxuICAtIERyb3Bkb3ducyBhcmUgZHluYW1pYyBiYXNlZCBvbiBoaWdoZXItbGV2ZWwgY2hvaWNlc1xuICAtIE9wdGlvbnMgYXJlIGRlZmluZWQgZnJvbSB0aGUgZ2VvZ3JhcGhpYyBkYXRhXG4gIC0gbnVsbCB2YWx1ZSBtZWFucyB1bnNlbGVjdGVkIHJlZ2lvblxuLSBEcm9wZG93bnMgYXJlIGFkZGVkIHRvIGVhY2ggc2VjdGlvbiwgdXNpbmcgSW5wdXRzLmJpbmQgdG8gY3JlYXRlIHN5bmNocm9uaXplZCBpbnB1dHMgKHNlZSB2aWV3b2YgZm9yIGlucHV0IGRlZmluaXRpb25zKS4gQSBmb3JtIGlucHV0IGlzIHVzZWQgdG8gY29uc29saWRhdGUgYW5kIGFwcGx5IGEgdGVtcGxhdGUgdG8gZm9ybWF0LmA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTU1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZ2V0IGFkbWluMCBvcHRpb25zIGZyb20gZ2VvXG5kYXRhQWRtaW4wID0ge1xuICBjb25zdCBkYXRhID0gYm91bmRhcmllcy5hZG1pbjAuZmVhdHVyZXMubWFwKChkKSA9PiBkLnByb3BlcnRpZXMpO1xuICAvLyBhZGQgYSBibGFuayB2YWx1ZVxuICByZXR1cm4gW251bGwsIC4uLmRhdGEubWFwKChkKSA9PiBkLmFkbWluX25hbWUpXS5tYXAoKGQpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgbGFiZWw6XG4gICAgICAgIGQgPT0gbnVsbFxuICAgICAgICAgID8gZ2xvYmFsU2VsZWN0aW9uLmxhYmVsXG4gICAgICAgICAgOiBfbGFuZyh0ZC5hZG1pbjBfbmFtZS52YWx1ZXM/LltkXS5nZW5lcmFsKSxcbiAgICAgIHZhbHVlOiBkLFxuICAgICAgZGF0YTogZCA9PSBudWxsID8gZ2xvYmFsU2VsZWN0aW9uLmRhdGEgOiB0ZC5hZG1pbjBfbmFtZS52YWx1ZXM/LltkXSxcbiAgICB9O1xuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBnZXQgYWRtaW4xIG9wdGlvbnMgYmFzZWQgb24gYWRtaW4wIHNlbGVjdGlvblxuLy8gKHRoZSBhZG1pbjEgcmVnaW9ucyB3aXRoaW4gc2VsZWN0ZWQgYWRtaW4wKVxuZGF0YUFkbWluMSA9IHtcbiAgLy8gYWRtaW4gMSwgZmlsdGVyIGJ5IDAgXG4gIGNvbnN0IGRhdGEgPSBib3VuZGFyaWVzLmFkbWluMS5mZWF0dXJlcy5tYXAoZCA9PiBkLnByb3BlcnRpZXMpXG4gIC5maWx0ZXIoZCA9PiBkLmFkbWluMF9uYW1lID09IHNlbGVjdEFkbWluMC52YWx1ZSlcbiAgLy8gYWRkIGJsYW5rIHZhbHVlXG4gIHJldHVybiBbbnVsbCwgLi4uZGF0YS5tYXAoZCA9PiBkLmFkbWluMV9uYW1lKV0ubWFwKGQgPT4ge1xuICAgIHJldHVybiB7bGFiZWw6IGQsIHZhbHVlOiBkfVxuICB9KVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGdldCBhZG1pbjIgb3B0aW9ucyBiYXNlZCBvbiBhZG1pbjEgc2VsZWN0aW9uXG4vLyAodGhlIGFkbWluMiByZWdpb25zIHdpdGhpbiBzZWxlY3RlZCBhZG1pbjEpXG5kYXRhQWRtaW4yID0ge1xuICBjb25zdCBkYXRhID0gYm91bmRhcmllcy5hZG1pbjIuZmVhdHVyZXMubWFwKGQgPT4gZC5wcm9wZXJ0aWVzKVxuICAuZmlsdGVyKGQgPT4gZC5hZG1pbjBfbmFtZSA9PSBzZWxlY3RBZG1pbjAudmFsdWUgJiYgZC5hZG1pbjFfbmFtZSA9PSBzZWxlY3RBZG1pbjEudmFsdWUpXG4gIC8vIGFkZCBibGFuayB2YWx1ZVxuICByZXR1cm4gW251bGwsIC4uLmRhdGEubWFwKGQgPT4gZC5hZG1pbjJfbmFtZSldLm1hcChkID0+IHtcbiAgICByZXR1cm4ge2xhYmVsOiBkLCB2YWx1ZTogZH1cbiAgfSlcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2Ygc2VsZWN0QWRtaW4wID0gSW5wdXRzLnNlbGVjdChkYXRhQWRtaW4wLCB7bGFiZWw6IGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4wLCBmb3JtYXQ6IHggPT4geC5sYWJlbH0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTU5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIHNlbGVjdEFkbWluMSA9IElucHV0cy5zZWxlY3QoZGF0YUFkbWluMSwge2xhYmVsOiBhZG1pblJlZ2lvbnMubGFiZWxzLmFkbWluMSwgZm9ybWF0OiB4ID0+IHgubGFiZWx9KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBzZWxlY3RBZG1pbjIgPSBJbnB1dHMuc2VsZWN0KGRhdGFBZG1pbjIsIHtsYWJlbDogYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjIsIGZvcm1hdDogeCA9PiB4LmxhYmVsfSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBzZWxlY3RlZCBhZG1pbiByZWdpb25zIGZyb20gZHJvcGRvd25zXG5hZG1pblNlbGVjdGlvbnMgPSBuZXcgT2JqZWN0KHtcbiAgc2VsZWN0QWRtaW4wOiBzZWxlY3RBZG1pbjAsXG4gIHNlbGVjdEFkbWluMTogc2VsZWN0QWRtaW4xLFxuICBzZWxlY3RBZG1pbjI6IHNlbGVjdEFkbWluMixcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHRlbXBsYXRlIHRvIGZvcm1hdCBhZG1pbiBzZWxlY3Rpb24gZm9ybVxuYWRtaW5Gb3JtVGVtcGxhdGUgPSAoaW5wdXRzKSA9PlxuICBodGwuaHRtbGA8ZGl2IHN0eWxlPVwiZGlzcGxheTogZmxleDsgZ2FwOiAzZW1cIj4ke2lucHV0c308L2Rpdj5gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYC0tLVxuIyMjIEFkbWluIFNlbGVjdGlvbiAtIERpc3BsYXlcbipTaG93aW5nIGFkbWluIHNlbGVjdGlvbnMqYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBvcHRpb25zIGZvciB0aGUgZ2xvYmFsIGFkbWluIHNlbGVjdGlvblxuLy8gdXNlZCB3aGVuIG5vIGFkbWluIHNlbGVjdGlvbiBpcyBtYWRlXG5nbG9iYWxTZWxlY3Rpb24gPSB7XG4gIHJldHVybiB7XG4gICAgbGFiZWw6IF9sYW5nKHRkLmFkbWluMF9uYW1lLnZhbHVlcy5TU0EuZ2VuZXJhbCksXG4gICAgdmFsdWU6IG51bGwsXG4gICAgZGF0YTogdGQuYWRtaW4wX25hbWUudmFsdWVzLlNTQVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gZ2V0QWRtaW5TZWxlY3Rpb24oc2VsZWN0aW9ucyA9IGFkbWluU2VsZWN0aW9ucykge1xuICAvLyBnZXQgdGhlIG1vc3QgZ3JhbnVsYXIgYWRtaW4gc2VsZWN0aW9uIG1hZGVcbiAgY29uc3QgYTAgPSBzZWxlY3Rpb25zLnNlbGVjdEFkbWluMDtcbiAgY29uc3QgYTEgPSBzZWxlY3Rpb25zLnNlbGVjdEFkbWluMTtcbiAgY29uc3QgYTIgPSBzZWxlY3Rpb25zLnNlbGVjdEFkbWluMjtcbiAgY29uc3QgZ2xvYmFsID0gZ2xvYmFsU2VsZWN0aW9uO1xuXG4gIHJldHVybiBhMi52YWx1ZSA/IGEyIDogYTEudmFsdWUgPyBhMSA6IGEwLnZhbHVlID8gYTAgOiBnbG9iYWw7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gZ2V0QWRtaW5TZWxlY3Rpb24wKHNlbGVjdGlvbnMgPSBhZG1pblNlbGVjdGlvbnMpIHtcbiAgLy8gZ2V0IHRoZSBtb3N0IGdyYW51bGFyIGFkbWluIHNlbGVjdGlvbiBtYWRlXG4gIGNvbnN0IGEwID0gc2VsZWN0aW9ucy5zZWxlY3RBZG1pbjA7XG5cbiAgcmV0dXJuIGEwO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGdldEFkbWluU2VsZWN0aW9uQWRtaW4wKHNlbGVjdGlvbnMgPSBhZG1pblNlbGVjdGlvbnMpIHtcbiAgLy8gZ2V0IHRoZSBzZWxlY3RlZCBhZG1pbjAgb3IgZ2xvYmFsIHZhbHVlXG4gIGNvbnN0IGEwID0gc2VsZWN0aW9ucy5zZWxlY3RBZG1pbjA7XG4gIGNvbnN0IGdsb2JhbCA9IGdsb2JhbFNlbGVjdGlvbjtcblxuICByZXR1cm4gYTAudmFsdWUgPyBhMCA6IGdsb2JhbDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBnZXRBZG1pblNlbGVjdGlvbk1hcmtkb3duUGF0aChzZWxlY3Rpb25zID0gYWRtaW5TZWxlY3Rpb25zKSB7XG4gIC8vIGZ1bmN0aW9uIHRvIHNob3cgc2VsZWN0ZWQgYWRtaW4gcmVnaW9uXG4gIC8vIHJldHVybiBwYXRoIHNob3dpbmcgbmVzdGVkIGFkbWluIHNlbGVjdGlvblxuXG4gIGNvbnN0IGRlbGltID0gXCIg4oaSIFwiO1xuICBjb25zdCBwYXRoID0gW1xuICAgIHNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLmxhYmVsLFxuICAgIHNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLmxhYmVsLFxuICAgIHNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLmxhYmVsLFxuICBdLmZpbHRlcigoZCkgPT4gZCk7XG5cbiAgY29uc3QgZm9ybWF0dGVkID0gcGF0aFxuICAgIC5maWx0ZXIoKGQpID0+IGQpXG4gICAgLm1hcCgoZCwgaSkgPT4ge1xuICAgICAgcmV0dXJuIGkgPT0gcGF0aC5sZW5ndGggLSAxID8gYCoqJHtkfSoqYCA6IGAqJHtkfSpgO1xuICAgIH0pO1xuXG4gIHJldHVybiBmb3JtYXR0ZWQubGVuZ3RoID09IDBcbiAgICA/IGAqKiR7Z2xvYmFsU2VsZWN0aW9uLmxhYmVsfSoqYCAvLyBubyBzZWxlY3Rpb24sIGFsbCBvZiBBZnJpY2FcbiAgICA6IGAke2Zvcm1hdHRlZC5qb2luKGRlbGltKX1gO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImdldEFkbWluMFdpdGhBZG1pblN1YlBhcmVucyA9ICh7XG4gIGFydGljbGVGaWVsZCA9IFwiZ2VuZXJhbFwiLFxuICBzaG93UGFyZW5zID0gdHJ1ZSxcbn0gPSB7fSkgPT4ge1xuICAvLyBnZXR0aW5nIGFkbWluMCwgd2l0aCBhZG1pbjEgaW4gcGFyZW5zXG4gIC8vIGNhbiBzcGVjaWZ5IGFkbWluMGFydGljbGUgbG9va3VwXG4gIGNvbnN0IGEwID0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMDtcbiAgY29uc3QgYTEgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xO1xuICBjb25zdCBhMiA9IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjI7XG5cbiAgY29uc3QgYTBXaXRoQXJ0aWNsZSA9XG4gICAgYTAudmFsdWUgPT0gbnVsbFxuICAgICAgPyBfbGFuZyh0ZC5hZG1pbjBfbmFtZS52YWx1ZXM/LltcIlNTQVwiXT8uW2FydGljbGVGaWVsZF0pXG4gICAgICA6IF9sYW5nKHRkLmFkbWluMF9uYW1lLnZhbHVlcz8uW2EwLnZhbHVlXT8uW2FydGljbGVGaWVsZF0pO1xuICBpZiAoYTEudmFsdWUgPT0gbnVsbCkgcmV0dXJuIGEwV2l0aEFydGljbGU7XG4gIGlmICghc2hvd1BhcmVucykgcmV0dXJuIGEwV2l0aEFydGljbGU7XG4gIGNvbnN0IHN1YkxhYmVsID0gYTIudmFsdWUgPT0gbnVsbCA/IGExLmxhYmVsIDogYTIubGFiZWw7XG4gIHJldHVybiBgJHthMFdpdGhBcnRpY2xlfSAoJHtzdWJMYWJlbH0pYDtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTcwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgQ2hvcm9wbGV0aCBtYXAgLSBHZW9ncmFwaGljIEltcGFjdFxuKlNob3dpbmcgY29udGV4dCBmb3IgYWRtaW4gc2VsZWN0aW9uKlxuXG5UaGVyZSBpcyBzb21lIGhvb3AtanVtcGluZyB0byBnZXQgdGhlIHJpZ2h0IGRhdGEgYmFzZWQgb24gdGhlIEFkbWluIFNlbGVjdGlvbi4gVGhlIHRhYnVsYXIgZGF0YSBpcyB0aGVuIGJvdW5kIHRvIHRoZSBhcHBsaWNhYmxlIGdlb2pzb24sIGFuZCB2aXN1YWxpemVkIHdpdGggUGxvdC5gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHBvcHVsYXRpb24gZGF0YVxuZGF0YVBvcHVsYXRpb24gPSBkYi5xdWVyeShgXG5zZWxlY3QgKiBcbmZyb20gYWdfd29ya2ZvcmNlX2RhdGFcbmApO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHRvdGFsIFZvUCBkYXRhXG5kYXRhVG90YWxBZ1cgPSBkYi5xdWVyeShgXG5zZWxlY3QgYWRtaW4wX25hbWVcbiAgLCBhZG1pbjFfbmFtZVxuICAsIGFkbWluMl9uYW1lXG4gICwgTUVBTihwZXJjZW50YWdlX2NoYW5nZV9TU1AyXzIwNTBfYWcpIGFzIGFnd190b3RhbFxuICBmcm9tIGFnX3dvcmtmb3JjZV9kYXRhXG4gIGdyb3VwIGJ5IDEsIDIsIDNcbiAgb3JkZXIgYnkgMSwgMiwgM1xuYCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTczIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gdG90YWwgVm9QIGRhdGFcbmRhdGFUb3RhbEFnV19hYnMgPSBkYi5xdWVyeShgXG5zZWxlY3QgYWRtaW4wX25hbWVcbiAgLCBhZG1pbjFfbmFtZVxuICAsIGFkbWluMl9uYW1lXG4gICwgU1VNKGNvcnJlY3RlZF9pbmRleF9hZ19wb3BfU1NQMl8yMDUwKSBhcyBhZ3dfdG90YWxfYWJzXG4gIGZyb20gYWdfd29ya2ZvcmNlX2RhdGFcbiAgZ3JvdXAgYnkgMSwgMiwgM1xuICBvcmRlciBieSAxLCAyLCAzXG5gKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyB0b3RhbCBBZ19TU1AyXzIwMzAgZGF0YVxuZGF0YVRvdGFsQWdXTWlkID0gZGIucXVlcnkoYFxuc2VsZWN0IGFkbWluMF9uYW1lXG4gICwgYWRtaW4xX25hbWVcbiAgLCBhZG1pbjJfbmFtZVxuICAsIE1FQU4ocGVyY2VudGFnZV9jaGFuZ2VfU1NQMl8yMDMwX2FnKSBhcyBhZ3dfdG90YWxfbWlkXG4gIGZyb20gYWdfd29ya2ZvcmNlX2RhdGFcbiAgZ3JvdXAgYnkgMSwgMiwgM1xuICBvcmRlciBieSAxLCAyLCAzXG5gKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyB0b3RhbCBWb1AgZGF0YVxuZGF0YVRvdGFsQWdXTWlkX2FicyA9IGRiLnF1ZXJ5KGBcbnNlbGVjdCBhZG1pbjBfbmFtZVxuICAsIGFkbWluMV9uYW1lXG4gICwgYWRtaW4yX25hbWVcbiAgLCBTVU0oY29ycmVjdGVkX2luZGV4X2FnX3BvcF9TU1AyXzIwMzApIGFzIGFnd190b3RhbF9taWRfYWJzXG4gIGZyb20gYWdfd29ya2ZvcmNlX2RhdGFcbiAgZ3JvdXAgYnkgMSwgMiwgM1xuICBvcmRlciBieSAxLCAyLCAzXG5gKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBncmFiIHRhYnVsYXIgZGF0YSBmb3IgY2hvcm9wbGV0aFxuZGF0YUdlb0ltcGFjdCA9IHtcbiAgLy8gZ2V0IGRhdGEgZm9yIGNob3JvcGxldGggbWFwIGJhc2VkIG9uIGNob2ljZVxuICBsZXQgZGF0YVNvdXJjZTtcblxuICBpZiAoc2VsZWN0R2VvRGF0YVR5cGUua2V5ID09IFwiYWdfd29ya2ZvcmNlX2RhdGFfMlwiKSB7XG4gICAgZGF0YVNvdXJjZSA9IGRhdGFQb3B1bGF0aW9uO1xuICB9IGVsc2UgaWYgKHNlbGVjdEdlb0RhdGFUeXBlLmtleSA9PSBcImFnX3dvcmtmb3JjZV9kYXRhXCIpIHtcbiAgICBkYXRhU291cmNlID0gZGF0YVRvdGFsQWdXO1xuICB9IGVsc2UgIGlmIChzZWxlY3RHZW9EYXRhVHlwZS5rZXkgPT0gXCJhZ193b3JrZm9yY2VfZGF0YV8xNVwiKSB7XG4gICAgZGF0YVNvdXJjZSA9IGRhdGFUb3RhbEFnV01pZF9hYnM7XG4gIH0gZWxzZSAgaWYgKHNlbGVjdEdlb0RhdGFUeXBlLmtleSA9PSBcImFnX3dvcmtmb3JjZV9kYXRhXzEwXCIpIHtcbiAgICBkYXRhU291cmNlID0gZGF0YVRvdGFsQWdXX2FicztcbiAgfSBlbHNlIHtcbiAgICBkYXRhU291cmNlID0gZGF0YVRvdGFsQWdXTWlkO1xuICB9XG5cbiAgLy8gc2VsZWN0IGRpZmZlcmVudCBkYXRhIGJhc2VkIG9uIGFkbWluIHNlbGVjdGlvbnNcbiAgaWYgKGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjEudmFsdWUpIHtcbiAgICAvLyBhZG1pbjEgb3IgMiBpcyBzZWxlY3RlZCwgc2hvdyBhbGwgYWRtaW4yJ3MgZm9yIHNlbGVjdGVkIGFkbWluMVxuICAgIHJldHVybiBULnRpZHkoXG4gICAgICBkYXRhU291cmNlLFxuICAgICAgVC5maWx0ZXIoKGQpID0+IHtcbiAgICAgICAgcmV0dXJuIGQuYWRtaW4wX25hbWUgPT0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZSAmJlxuICAgICAgICAgIGQuYWRtaW4xX25hbWUgPT0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZVxuICAgICAgICAgICYmIGQuYWRtaW4yX25hbWUgLy8gYWx3YXlzIG5vbi1udWxsXG4gICAgICB9KVxuICAgICk7XG4gIH0gZWxzZSBpZiAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZSkge1xuICAgIC8vIGFkbWluMCBpcyBzZWxlY3RlZCwgd2l0aCBubyBhZG1pbjFcbiAgICAvLyBnZXQgYWxsIGFkbWluMSBkYXRhIGZvciBzZWxlY3RlZCBhZG1pbjBcbiAgICByZXR1cm4gVC50aWR5KFxuICAgICAgZGF0YVNvdXJjZSxcbiAgICAgIFQuZmlsdGVyKChkKSA9PiB7XG4gICAgICAgIHJldHVybiBkLmFkbWluMF9uYW1lID09IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWVcbiAgICAgICAgJiYgZC5hZG1pbjFfbmFtZSAvLyBhbHdheXMgbm9uLW51bGwgXG4gICAgICAgICYmICFkLmFkbWluMl9uYW1lIC8vIGFsd2F5cyBudWxsXG4gICAgICB9KVxuICAgIClcbiAgfSBlbHNlIHtcbiAgICAvLyBlbmQgY2FzZTogYWRtaW4wIGlzIG5vdCBzZWxlY3RlZFxuICAgIC8vIGdldCBhbGwgYWRtaW4wIGRhdGFcbiAgICByZXR1cm4gVC50aWR5KFxuICAgICAgZGF0YVNvdXJjZSxcbiAgICAgIFQuZmlsdGVyKChkKSA9PiB7XG4gICAgICAgIHJldHVybiAhZC5hZG1pbjFfbmFtZSAvLyBhbHdheXMgbnVsbCBcbiAgICAgICAgJiYgIWQuYWRtaW4yX25hbWUgLy8gYWx3YXlzIG51bGxcbiAgICAgIH0pXG4gICAgKVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTc3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gYmluZCBnZW9qc29uIHRvIHRhYnVsYXIgZGF0YVxubWFwRGF0YUdlb0ltcGFjdCA9IHtcbiAgLy8gbm8gc2VsZWN0aW9uc1xuICBpZiAoIWFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWUpIHtcbiAgICByZXR1cm4gYmluZFRhYnVsYXJUb0dlbyh7XG4gICAgICBkYXRhOiBkYXRhR2VvSW1wYWN0LFxuICAgICAgZGF0YUJpbmRDb2x1bW46IFwiYWRtaW4wX25hbWVcIixcbiAgICAgIGdlb0RhdGE6IGJvdW5kYXJpZXMuYWRtaW4wLFxuICAgICAgZ2VvRGF0YUJpbmRDb2x1bW46IFwiYWRtaW4wX25hbWVcIlxuICAgIH0pO1xuICB9XG4gIC8vIGFkbWluMCBzZWxlY3RlZCBvbmx5XG4gIGVsc2UgaWYgKCFhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlKSB7XG4gICAgY29uc3QgZGF0YSA9IFQudGlkeShcbiAgICAgIGRhdGFHZW9JbXBhY3QsXG4gICAgICBULm11dGF0ZSh7IGExX2EwOiAoZCkgPT4gW2QuYWRtaW4xX25hbWUsIGQuYWRtaW4wX25hbWVdLmpvaW4oXCJfXCIpIH0pXG4gICAgKTtcbiAgICBjb25zdCBnZW9EYXRhID0ge1xuICAgICAgLi4uYm91bmRhcmllcy5hZG1pbjEsXG4gICAgICBmZWF0dXJlczogYm91bmRhcmllcy5hZG1pbjEuZmVhdHVyZXMuZmlsdGVyKFxuICAgICAgICAoZCkgPT4gZC5wcm9wZXJ0aWVzLmFkbWluMF9uYW1lID09IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWVcbiAgICAgIClcbiAgICB9O1xuXG4gICAgcmV0dXJuIGJpbmRUYWJ1bGFyVG9HZW8oe1xuICAgICAgZGF0YTogZGF0YSxcbiAgICAgIGRhdGFCaW5kQ29sdW1uOiBcImExX2EwXCIsXG4gICAgICBnZW9EYXRhOiBnZW9EYXRhLFxuICAgICAgZ2VvRGF0YUJpbmRDb2x1bW46IFwiYTFfYTBcIlxuICAgIH0pO1xuICB9XG5cbiAgLy8gYWRtaW4xIGlzIHNlbGVjdGVkXG4gIC8vIHNob3cgYWxsIGFkbWluMiByZWdpb25zIHdpdGhpbiBhZG1pbjFcbiAgZWxzZSB7XG4gICAgY29uc3QgZGF0YSA9IFQudGlkeShcbiAgICAgIGRhdGFHZW9JbXBhY3QsXG4gICAgICBULm11dGF0ZSh7XG4gICAgICAgIGEyX2ExX2EwOiAoZCkgPT4gW2QuYWRtaW4yX25hbWUsIGQuYWRtaW4xX25hbWUsIGQuYWRtaW4wX25hbWVdLmpvaW4oXCJfXCIpXG4gICAgICB9KVxuICAgICk7XG4gICAgY29uc3QgZ2VvRGF0YSA9IHtcbiAgICAgIC4uLmJvdW5kYXJpZXMuYWRtaW4yLFxuICAgICAgZmVhdHVyZXM6IGJvdW5kYXJpZXMuYWRtaW4yLmZlYXR1cmVzLmZpbHRlcihcbiAgICAgICAgKGQpID0+IGQucHJvcGVydGllcy5hZG1pbjFfbmFtZSA9PSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlICYmIGQucHJvcGVydGllcy5hZG1pbjBfbmFtZSA9PSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlXG4gICAgICApXG4gICAgfTtcblxuICAgIHJldHVybiBiaW5kVGFidWxhclRvR2VvKHtcbiAgICAgIGRhdGE6IGRhdGEsXG4gICAgICBkYXRhQmluZENvbHVtbjogXCJhMl9hMV9hMFwiLFxuICAgICAgZ2VvRGF0YTogZ2VvRGF0YSxcbiAgICAgIGdlb0RhdGFCaW5kQ29sdW1uOiBcImEyX2ExX2EwXCJcbiAgICB9KTtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYC0tLVxuIyMjIER5bmFtaWMgSW5zaWdodHMgLSBHZW9ncmFwaGljIEltcGFjdFxuKnF1aWNrIGluc2lnaHRzIGZvciBnaXZlbiBhZG1pbiBzZWxlY3Rpb24qXG5cbi0gU3FsIGNlbGxzIGFkZCBhIHJvdyB0aGF0IGlzIHRoZSBjb21iaW5lZCB2YWx1ZSBmb3IgYWxsIGFkbWluIHJlZ2lvbnMsIHdoZXJlIGFsbCBhZG1pbiBuYW1lcyBhcmUgbnVsbC5gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYEhlcmUgYXJlIHRoZSBjb21iaW5lZCBkYXRhIGFuZCBpbnNpZ2h0cyBmb3IgY3JlYXRpbmcgdGhlIGR5bmFtaWMgbmFycmF0aXZlLiBEYXRhIHRhYmxlcyBhcmUgYmVsb3cuYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBkeW5hbWljIGluc2lnaHRzIGZvciBhbiBBZG1pbiBTZWxlY3Rpb25cbmR5bmFtaWNJbnNpZ2h0c19nZW9JbXBhY3QgPSB7XG4gIC8vIGRlZmluZSBkYXRhXG4gIGNvbnN0IHRvdGFsVm9wID0gZmlsdGVyQnlBZG1pbk5hbWVzKGR5bkluc2lnaHRHZW9fdm9wVG90YWxzKTtcbiAgY29uc3QgcG9wdWxhdGlvbiA9IGZpbHRlckJ5QWRtaW5OYW1lcyhkeW5JbnNpZ2h0R2VvX3BvcHVsYXRpb24pO1xuICBjb25zdCBwZXJjMzAgPSBmaWx0ZXJCeUFkbWluTmFtZXMoZHluSW5zaWdodEdlb19wZXJjZW50VG90YWxzX21pZCk7XG4gIGNvbnN0IHBlcmM1MCA9IGZpbHRlckJ5QWRtaW5OYW1lcyhkeW5JbnNpZ2h0R2VvX3BlcmNlbnRUb3RhbHMpO1xuXG4gIC8vIGZvcm1hdCBmdW5jdGlvbnNcbiAgY29uc3QgX2Zvcm1hdFRvcE5Wb3AgPSBmb3JtYXRVU0Q7XG4gIGNvbnN0IF9mb3JtYXROdW1iZXIgPSBmb3JtYXROdW1Db21wYWN0TG9uZyh7bG9jYWxlOiBsYW5ndWFnZS5sb2NhbGV9KTtcblxuICBmdW5jdGlvbiBnZXRUb3BWYWx1ZSh7IGQsIGkgfSA9IHt9KSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRhdGE6IGQ/LltpXT8uYWd3X3RvdGFsLFxuICAgICAgdmFsdWU6IGZvcm1hdFdpdGhEZWZhdWx0KHtcbiAgICAgICAgdmFsdWU6IGQ/LltpXT8uYWd3X3RvdGFsLFxuICAgICAgICBmb3JtYXQ6IF9mb3JtYXROdW1iZXJcbiAgICAgIH0pLFxuICAgICAgbGFiZWw6IGZvcm1hdFdpdGhEZWZhdWx0KHtcbiAgICAgICAgdmFsdWU6IGQ/LltpXT8uY3JvcFxuICAgICAgfSlcbiAgICB9O1xuICB9XG5cbiAgLy8gbWFrZSBpbnNpZ2h0cyAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmV0dXJuIHtcbiAgICBkYXRhOiB7XG4gICAgICB0b3RhbFZvcCxcbiAgICAgIHBvcHVsYXRpb25cbiAgICB9LFxuICAgIGluc2lnaHQ6IHtcbiAgICAgIHRvdGFsVm9wOiBmb3JtYXRXaXRoRGVmYXVsdCh7XG4gICAgICAgIHZhbHVlOiB0b3RhbFZvcD8uWzBdPy5hZ3dfdG90YWwsXG4gICAgICAgIGZvcm1hdDogX2Zvcm1hdE51bWJlclxuICAgICAgfSksXG4gICAgICB0b3RhbFBvcDogZm9ybWF0V2l0aERlZmF1bHQoe1xuICAgICAgICB2YWx1ZTogcG9wdWxhdGlvbj8uWzBdPy50b3RhbF9wb3AsXG4gICAgICAgIGZvcm1hdDogX2Zvcm1hdE51bWJlclxuICAgICAgfSksXG4gICAgICB0b3RhbFJ1cmFsUG9wOiBmb3JtYXRXaXRoRGVmYXVsdCh7XG4gICAgICAgIHZhbHVlOiBwb3B1bGF0aW9uPy5bMF0/LnJ1cmFsX3BvcCxcbiAgICAgICAgZm9ybWF0OiBfZm9ybWF0TnVtYmVyXG4gICAgICB9KSxcbiAgICAgIHRvdGFsQWdQb3A6IGZvcm1hdFdpdGhEZWZhdWx0KHtcbiAgICAgICAgdmFsdWU6IHBvcHVsYXRpb24/LlswXT8uYWdfcG9wLFxuICAgICAgICBmb3JtYXQ6IF9mb3JtYXROdW1iZXJcbiAgICAgIH0pLFxuICAgICAgdG90YWxBZ1BvcF9ub2Zvcm1hdDogZm9ybWF0V2l0aERlZmF1bHQoe1xuICAgICAgICB2YWx1ZTogcG9wdWxhdGlvbj8uWzBdPy5hZ19wb3BcbiAgICAgIH0pLFxuICAgICAgdG90YWxBZ1BvcF8yXzMwOiBmb3JtYXRXaXRoRGVmYXVsdCh7XG4gICAgICAgIHZhbHVlOiBwb3B1bGF0aW9uPy5bMF0/LmFnX3BvcF8yXzMwLFxuICAgICAgICBmb3JtYXQ6IF9mb3JtYXROdW1iZXJcbiAgICAgIH0pLFxuICAgICAgdG90YWxBZ1BvcF8yXzMwX25vZm9ybWF0OiBmb3JtYXRXaXRoRGVmYXVsdCh7XG4gICAgICAgIHZhbHVlOiBwb3B1bGF0aW9uPy5bMF0/LmFnX3BvcF8yXzMwXG4gICAgICB9KSxcbiAgICAgIHRvdGFsQWdQb3BfMl81MDogZm9ybWF0V2l0aERlZmF1bHQoe1xuICAgICAgICB2YWx1ZTogcG9wdWxhdGlvbj8uWzBdPy5hZ19wb3BfMl81MCxcbiAgICAgICAgZm9ybWF0OiBfZm9ybWF0TnVtYmVyXG4gICAgICB9KSxcbiAgICAgIHRvdGFsQWdQb3BfMl81MF9ub2Zvcm1hdDogZm9ybWF0V2l0aERlZmF1bHQoe1xuICAgICAgICB2YWx1ZTogcG9wdWxhdGlvbj8uWzBdPy5hZ19wb3BfMl81MFxuICAgICAgfSksXG4gICAgICB0b3RhbEFnUG9wXzVfMzA6IGZvcm1hdFdpdGhEZWZhdWx0KHtcbiAgICAgICAgdmFsdWU6IHBvcHVsYXRpb24/LlswXT8uYWdfcG9wXzVfMzAsXG4gICAgICAgIGZvcm1hdDogX2Zvcm1hdE51bWJlclxuICAgICAgfSksXG4gICAgICB0b3RhbEFnUG9wXzVfMzBfbm9mb3JtYXQ6IGZvcm1hdFdpdGhEZWZhdWx0KHtcbiAgICAgICAgdmFsdWU6IHBvcHVsYXRpb24/LlswXT8uYWdfcG9wXzVfMzBcbiAgICAgIH0pLFxuICAgICAgdG90YWxBZ1BvcF81XzUwOiBmb3JtYXRXaXRoRGVmYXVsdCh7XG4gICAgICAgIHZhbHVlOiBwb3B1bGF0aW9uPy5bMF0/LmFnX3BvcF81XzUwLFxuICAgICAgICBmb3JtYXQ6IF9mb3JtYXROdW1iZXJcbiAgICAgIH0pLFxuICAgICAgdG90YWxBZ1BvcF81XzUwX25vZm9ybWF0OiBmb3JtYXRXaXRoRGVmYXVsdCh7XG4gICAgICAgIHZhbHVlOiBwb3B1bGF0aW9uPy5bMF0/LmFnX3BvcF81XzUwXG4gICAgICB9KSxcbiAgICB9XG4gIH07XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMjIERhdGEgY2VsbHMgZm9yIGluc2lnaHRzYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyB0b3RhbCBoYXJ2ZXN0ZWQgYXJlYVxuZHluSW5zaWdodEdlb19wZXJjZW50VG90YWxzX21pZCA9IGRiLnF1ZXJ5KGBcbndpdGggdGJsIGFzIChcbiAgLS0gdG90YWwgcGVyY2VudGFnZXNcbiAgU0VMRUNUIGFkbWluMF9uYW1lLCBhZG1pbjFfbmFtZSwgYWRtaW4yX25hbWUsIE1FQU4ocGVyY2VudGFnZV9jaGFuZ2VfU1NQMl8yMDMwX2FnKSBBUyBwZXJjZW50X2NoYW5nZV8zMFxuICAgIEZST00gYWdfd29ya2ZvcmNlX2RhdGFcbiAgICBHUk9VUCBCWSAxLCAyLCAzXG4gICAgT1JERVIgQlkgMSwgMiwgM1xuKVxuXG4tLSBRVUVSWSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbihcbiAgLS0gdG90YWwgZm9yIGFsbCByZWdpb25zXG4gIHNlbGVjdCBudWxsIGFzIGFkbWluMF9uYW1lXG4gICAgLCBudWxsIGFzIGFkbWluMV9uYW1lXG4gICAgLCBudWxsIGFzIGFkbWluMl9uYW1lXG4gICAgLCBwZXJjZW50X2NoYW5nZV8zMFxuICAgIGZyb20gKFxuICAgICAgc2VsZWN0IG1lYW4ocGVyY2VudF9jaGFuZ2VfMzApIGFzIHBlcmNlbnRfY2hhbmdlXzMwXG4gICAgICAgIGZyb20gdGJsXG4gICAgICAgIHdoZXJlIGFkbWluMV9uYW1lIGlzIG51bGxcbiAgICApXG4gIFxuICB1bmlvblxuICBcbiAgc2VsZWN0ICogXG4gICAgZnJvbSB0YmxcbiAgXG4gIG9yZGVyIGJ5IDEsIDIsIDNcbilcbmApO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHRvdGFsIGhhcnZlc3RlZCBhcmVhXG5keW5JbnNpZ2h0R2VvX3BlcmNlbnRUb3RhbHMgPSBkYi5xdWVyeShgXG53aXRoIHRibCBhcyAoXG4gIC0tIHRvdGFsIHBlcmNlbnRhZ2VzXG4gIFNFTEVDVCBhZG1pbjBfbmFtZSwgYWRtaW4xX25hbWUsIGFkbWluMl9uYW1lLCBNRUFOKHBlcmNlbnRhZ2VfY2hhbmdlX1NTUDJfMjA1MF9hZykgQVMgcGVyY2VudF9jaGFuZ2VfNTBcbiAgICBGUk9NIGFnX3dvcmtmb3JjZV9kYXRhXG4gICAgR1JPVVAgQlkgMSwgMiwgM1xuICAgIE9SREVSIEJZIDEsIDIsIDNcbilcblxuLS0gUVVFUlkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4oXG4gIC0tIHRvdGFsIGZvciBhbGwgcmVnaW9uc1xuICBzZWxlY3QgbnVsbCBhcyBhZG1pbjBfbmFtZVxuICAgICwgbnVsbCBhcyBhZG1pbjFfbmFtZVxuICAgICwgbnVsbCBhcyBhZG1pbjJfbmFtZVxuICAgICwgcGVyY2VudF9jaGFuZ2VfNTBcbiAgICBmcm9tIChcbiAgICAgIHNlbGVjdCBtZWFuKHBlcmNlbnRfY2hhbmdlXzUwKSBhcyBwZXJjZW50X2NoYW5nZV81MFxuICAgICAgICBmcm9tIHRibFxuICAgICAgICB3aGVyZSBhZG1pbjFfbmFtZSBpcyBudWxsXG4gICAgKVxuICBcbiAgdW5pb25cbiAgXG4gIHNlbGVjdCAqIFxuICAgIGZyb20gdGJsXG4gIFxuICBvcmRlciBieSAxLCAyLCAzXG4pXG5gKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkeW5JbnNpZ2h0R2VvX3ZvcFRvdGFscyA9IGRiLnF1ZXJ5KGBcbi0tIHRvdGFsIGFnIHdvcmtmb3JjZVxud2l0aCB0YmwgYXMgKFxuICAtLSB0b3RhbCBWb1AgYW5kIGhhcnZlc3RlZCBhcmVhXG4gIFNFTEVDVCBhZG1pbjBfbmFtZSwgYWRtaW4xX25hbWUsIGFkbWluMl9uYW1lLCBzdW0oY29ycmVjdGVkX2luZGV4X2FnX3BvcF9TU1AyXzIwNTApIEFTIGFnd190b3RhbFxuICAgIEZST00gYWdfd29ya2ZvcmNlX2RhdGFcbiAgICBHUk9VUCBCWSAxLCAyLCAzXG4gICAgT1JERVIgQlkgMSwgMiwgM1xuKVxuXG4tLSBRVUVSWSAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbihcbiAgLS0gdG90YWwgZm9yIGFsbCByZWdpb25zXG4gIHNlbGVjdCBudWxsIGFzIGFkbWluMF9uYW1lXG4gICAgLCBudWxsIGFzIGFkbWluMV9uYW1lXG4gICAgLCBudWxsIGFzIGFkbWluMl9uYW1lXG4gICAgLCBhZ3dfdG90YWxcbiAgICBmcm9tIChcbiAgICAgIHNlbGVjdCBtZWFuKGFnd190b3RhbCkgYXMgYWd3X3RvdGFsXG4gICAgICAgIGZyb20gdGJsXG4gICAgICAgIHdoZXJlIGFkbWluMV9uYW1lIGlzIG51bGxcbiAgICApXG4gIFxuICB1bmlvblxuICBcbiAgc2VsZWN0ICogXG4gICAgZnJvbSB0YmxcbiAgXG4gIG9yZGVyIGJ5IDEsIDIsIDNcbilcbmApO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImR5bkluc2lnaHRHZW9fcG9wdWxhdGlvbiA9IGRiLnF1ZXJ5KGBcbndpdGggdGJsIGFzIChcbiAgLS0gYWcgd29ya2ZvcmNlIHBvcHVsYXRpb24gZGF0YVxuICBzZWxlY3QgYWRtaW4wX25hbWVcbiAgICAsIGFkbWluMV9uYW1lXG4gICAgLCBhZG1pbjJfbmFtZVxuICAgICwgdG90YWxcbiAgICAsIHJ1cmFsXG4gICAgLCBjb3JyZWN0ZWRfYWdfcG9wXG4gICAgLCBjb3JyZWN0ZWRfaW5kZXhfYWdfcG9wX1NTUDJfMjA1MFxuICAgICwgY29ycmVjdGVkX2luZGV4X2FnX3BvcF9TU1AyXzIwMzBcbiAgICAsIGNvcnJlY3RlZF9pbmRleF9hZ19wb3BfU1NQNV8yMDUwXG4gICAgLCBjb3JyZWN0ZWRfaW5kZXhfYWdfcG9wX1NTUDVfMjAzMFxuICAgIGZyb20gYWdfd29ya2ZvcmNlX2RhdGFcbiAgICBvcmRlciBieSBhZG1pbjBfbmFtZVxuICAgICwgYWRtaW4xX25hbWVcbiAgICAsIGFkbWluMl9uYW1lXG4pXG5cbi0tIFFVRVJZIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuKFxuICAtLSB0b3RhbCBmb3IgYWxsIHJlZ2lvbnNcbiAgc2VsZWN0IG51bGwgYXMgYWRtaW4wX25hbWVcbiAgICAsIG51bGwgYXMgYWRtaW4xX25hbWVcbiAgICAsIG51bGwgYXMgYWRtaW4yX25hbWVcbiAgICAsICpcbiAgICBmcm9tIChcbiAgICAgIHNlbGVjdCBzdW0odG90YWwpIGFzIHRvdGFsX3BvcFxuICAgICAgICAsIHN1bShydXJhbCkgYXMgcnVyYWxfcG9wXG4gICAgICAgICwgc3VtKGNvcnJlY3RlZF9hZ19wb3ApIGFzIGFnX3BvcFxuICAgICAgICAsIHN1bShjb3JyZWN0ZWRfaW5kZXhfYWdfcG9wX1NTUDJfMjAzMCkgYXMgYWdfcG9wXzJfMzBcbiAgICAgICAgLCBzdW0oY29ycmVjdGVkX2luZGV4X2FnX3BvcF9TU1AyXzIwNTApIGFzIGFnX3BvcF8yXzUwXG4gICAgICAgICwgc3VtKGNvcnJlY3RlZF9pbmRleF9hZ19wb3BfU1NQNV8yMDUwKSBhcyBhZ19wb3BfNV81MFxuICAgICAgICAsIHN1bShjb3JyZWN0ZWRfaW5kZXhfYWdfcG9wX1NTUDVfMjAzMCkgYXMgYWdfcG9wXzVfMzBcbiAgICAgICAgZnJvbSB0YmxcbiAgICAgICAgd2hlcmUgYWRtaW4xX25hbWUgaXMgbnVsbFxuICAgIClcbiAgXG4gIHVuaW9uXG4gIFxuICBzZWxlY3QgKlxuICAgIGZyb20gdGJsXG4gIFxuICBvcmRlciBieSAxLCAyLCAzXG4pXG5gKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBCYXIgQ2hhcnRzIC0gSGF6YXJkcyBhbmQgRXhwb3N1cmVzXG4qZ2V0dGluZyBkYXRhIGJhc2VkIG9uIGFkbWluIHNlbGVjdGlvbiBhbmQgaGF6YXJkIG9wdGlvbnMqYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAjIyMjIFBsb3QgRnVuY3Rpb25cbk1ha2luZyB0aGUgdG9wIFZvUCBiYXIgY2hhcnRzYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBtYWtlIHRoZSBiYXIgY2hhcnQgZm9yIHRvcCBjcm9wc1xuLy8gYXBwcm9hY2ggaXMgcGFzc2luZyBpbiBkYXRhIGZvciBzZWxlY3RlZCBoYXphcmQgYW5kIGNyb3AgdHlwZVxuZnVuY3Rpb24gbWFrZVRvcENyb3BCYXJDaGFydChkYXRhKSB7XG4gIC8vIGlmIG5vIGRhdGEgaXMgYXZhaWxhYmxlIGZvciBzZWxlY3RlZCBoYXphcmQsIHNob3cgYSBtZXNzYWdlXG4gIGlmIChkYXRhLmxlbmd0aCA9PSAwKSB7XG4gICAgcmV0dXJuIG1kYCpObyBWb1AgZXhwb3N1cmUqYDtcbiAgfVxuICBjb25zdCB0b3BOID0gMTA7XG5cbiAgcmV0dXJuIFBsb3QucGxvdCh7XG4gICAgd2lkdGgsXG4gICAgbWFyZ2luTGVmdDogMTAwLFxuICAgIGNhcHRpb246IG1vbmV0YXJ5Vm9QTm90ZSxcbiAgICB4OiB7XG4gICAgICB0aWNrRm9ybWF0OiBmb3JtYXRVU0QsXG4gICAgICBsYWJlbDogXCJWb1AgYXQgcmlzayAoJClcIixcbiAgICAgIGdyaWQ6IHRydWUsXG4gICAgfSxcbiAgICB5OiB7XG4gICAgICBsYWJlbDogbnVsbCxcbiAgICAgIHRpY2tTaXplOiAwLFxuICAgIH0sXG4gICAgY29sb3I6IHtcbiAgICAgIGRvbWFpbjogaGF6YXJkUGxvdExvb2t1cC5jb2xvci5kb21haW4sXG4gICAgICByYW5nZTogaGF6YXJkUGxvdExvb2t1cC5jb2xvci5yYW5nZSxcbiAgICB9LFxuICAgIG1hcmtzOiBbXG4gICAgICBQbG90LmJhclgoZGF0YSwge1xuICAgICAgICB4OiBcInZvcFwiLFxuICAgICAgICB5OiAoZCkgPT4gaGF6YXJkUGxvdExvb2t1cC5jcm9wc1tkLmNyb3BdLFxuICAgICAgICBmaWxsOiAoZCkgPT4gaGF6YXJkUGxvdExvb2t1cC5uYW1lc1tkLmhhemFyZF0sXG4gICAgICAgIHNvcnQ6IHsgeTogXCJ4XCIsIHJldmVyc2U6IHRydWUsIGxpbWl0OiAxMCB9LFxuICAgICAgICBjaGFubmVsczoge1xuICAgICAgICAgIHZvcDoge1xuICAgICAgICAgICAgbGFiZWw6IFwiVm9QIGF0IHJpc2tcIixcbiAgICAgICAgICAgIHZhbHVlOiBcInZvcFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHRpcDoge1xuICAgICAgICAgIGZvcm1hdDoge1xuICAgICAgICAgICAgeDogZmFsc2UsXG4gICAgICAgICAgICB5OiBmYWxzZSxcbiAgICAgICAgICAgIGZpbGw6IGZhbHNlLFxuICAgICAgICAgICAgdm9wOiAoZCkgPT4gZm9ybWF0VVNEKGQpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICBdLFxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAjIyMjIEhhemFyZCBEYXRhYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkYXRhX2hhemFyZFZvUCA9IFQudGlkeShcbiAgLy8gZGF0YSBmb3Igc2VsZWN0ZWQgaGF6YXJkIHNjZW5hcmlvLCB3aXRoIHRvdGFsIHZvcFxuICBkYXRhSGF6YXJkU2VsZWN0ZWQsXG4gIFQubGVmdEpvaW4oZGF0YUhhemFyZFZvUFRvdGFsU2VsZWN0ZWQsIHtcbiAgICBieTogW1wiYWRtaW4wX25hbWVcIiwgXCJhZG1pbjFfbmFtZVwiLCBcImFkbWluMl9uYW1lXCIsIFwiY3JvcFwiXSxcbiAgfSksXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFIYXphcmRWb1BUb3RhbFNlbGVjdGVkID0gVC50aWR5KFxuICBkYXRhSGF6YXJkU2VsZWN0ZWQsXG4gIFQuZ3JvdXBCeShcbiAgICBbXG4gICAgICBcImFkbWluMF9uYW1lXCIsXG4gICAgICBcImFkbWluMV9uYW1lXCIsXG4gICAgICBcImFkbWluMl9uYW1lXCIsXG4gICAgICBcInRocmVzaG9sZFwiLFxuICAgICAgXCJzY2VuYXJpb1wiLFxuICAgICAgXCJ0aW1lZnJhbWVcIixcbiAgICAgIFwiY3JvcFwiLFxuICAgIF0sXG4gICAgW1xuICAgICAgVC5zdW1tYXJpemUoe1xuICAgICAgICB2b3BfdG90YWw6IFQuc3VtKFwidm9wXCIpLFxuICAgICAgfSksXG4gICAgXSxcbiAgKSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gdW5pcXVlIGNyb3BzIGluIHRoZSBoYXphcmQgZGF0YVxuaGF6YXJkQ3JvcHMgPSB7XG4gIGNvbnN0IHF1ZXJ5ID0gYXdhaXQgZGIucXVlcnkoYHNlbGVjdCBjcm9wXG4gICwgY291bnQoKikgYXMgY291bnRcbiAgZnJvbSBoZWF0X3N0cmVzc19kYXRhXG4gIGdyb3VwIGJ5IDFcbiAgb3JkZXIgYnkgMWApO1xuXG4gIHJldHVybiBxdWVyeVxuIH1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBmb3JtYXR0aW5nIGNyb3AgbmFtZXNcbmNyb3BOYW1lcyA9IFQudGlkeShcbiAgaGF6YXJkQ3JvcHMsXG4gIFQuZGlzdGluY3QoXCJjcm9wXCIpLFxuICBULnNlbGVjdChcImNyb3BcIiksXG4gIFQubXV0YXRlKHtcbiAgICAvLyBDb252ZXJ0IGNyb3AgdG8gbnVtYmVyIGZvciBzb3J0aW5nXG4gICAgY3JvcE51bTogKGQpID0+IHBhcnNlSW50KGQuY3JvcCwgMTApLFxuICAgIC8vIERldGVybWluZSB0aGUgdHlwZSBiYXNlZCBvbiB0aGUgb3JpZ2luYWwgc3RyaW5nIGZvcm1hdCAoYWRqdXN0IGFzIG5lZWRlZClcbiAgICB0eXBlOiAoZCkgPT4gKC9fLy50ZXN0KGQuY3JvcCkgPyBcImxpdmVzdG9ja1wiIDogXCJjcm9wXCIpLFxuICAgIC8vIEZvcm1hdCB0aGUgY3JvcCBuYW1lXG4gICAgY3JvcE5hbWU6IChkKSA9PiB7XG4gICAgICBsZXQgY3JvcE5hbWUgPSBkLmNyb3AuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBkLmNyb3Auc2xpY2UoMSk7XG4gICAgICBpZiAoL18vLnRlc3QoZC5jcm9wKSkgY3JvcE5hbWUgPSBjcm9wTmFtZS5yZXBsYWNlKFwiX1wiLCBcIiAoXCIpICsgXCIpXCI7XG4gICAgICByZXR1cm4gY3JvcE5hbWU7XG4gICAgfSxcbiAgfSksXG4gIC8vIFVzZSB0aGUgbnVtZXJpYyB2ZXJzaW9uIG9mIGNyb3AgZm9yIHNvcnRpbmcsIHRoZW4gcmVtb3ZlIGl0IGZyb20gdGhlIGZpbmFsIHJlc3VsdCBhcyBpdCdzIG5vIGxvbmdlciBuZWVkZWRcbiAgVC5hcnJhbmdlKFtcInR5cGVcIiwgXCJjcm9wTnVtXCJdKSxcbiAgVC5zZWxlY3QoW1widHlwZVwiLCBcImNyb3BcIiwgXCJjcm9wTmFtZVwiXSksIC8vIEFzc3VtaW5nIHlvdSB3YW50IHRvIGtlZXAgdGhlc2UgZmllbGRzIGluIHRoZSBmaW5hbCBvdXRwdXRcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTk0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gbG9va3VwcyBmb3IgaGF6YXJkIHBsb3RcbmhhemFyZFBsb3RMb29rdXAgPSB7XG4gIHJldHVybiB7XG4gICAgbmFtZXM6IHtcbiAgICAgIGJhc2VsaW5lOiBfbGFuZyhuYlRleHQuc2VjdGlvbnMuaGVhdFN0cmVzcy5iYXJDaGFydC5ncm91cC5iYXNlbGluZSksXG4gICAgICBwcm9qZWN0aW9uOiBfbGFuZyhuYlRleHQuc2VjdGlvbnMuaGVhdFN0cmVzcy5iYXJDaGFydC5ncm91cC5wcm9qZWN0aW9uKVxuICAgIH0sXG4gICAgY29sb3I6IHtcbiAgICAgIGRvbWFpbjogW1xuICAgICAgICBfbGFuZyhuYlRleHQuc2VjdGlvbnMuaGVhdFN0cmVzcy5iYXJDaGFydC5ncm91cC5iYXNlbGluZSksXG4gICAgICAgIF9sYW5nKG5iVGV4dC5zZWN0aW9ucy5oZWF0U3RyZXNzLmJhckNoYXJ0Lmdyb3VwLnByb2plY3Rpb24pXG4gICAgICBdLFxuICAgICAgcmFuZ2U6IFtcIiNCMUIxQjFcIiwgXCIjRUM1QTQ3XCJdXG4gICAgfSxcbiAgICBjcm9wczogY3JvcE5hbWVzLnJlZHVjZSgoYWNjLCBvYmopID0+IHtcbiAgICAgIGFjY1tvYmouY3JvcF0gPSBvYmouY3JvcE5hbWU7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9KVxuICB9O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYCMjIyMgU2VsZWN0aW5nIEhlYXQgU3RyZXNzIGRhdGEgYnkgc2NlbmFyaW9cbi0gVGhlIGRhdGEgaXMgcXVlcmllZCBhcyBzZXBhcmF0ZSBjb21wb25lbnRzIGZvciBlYWNoIGFkbWluIHJlZ2lvbiB0byByZWR1Y2UgcXVlcnkgc2l6ZSBhbmQgYWxsb3cgZm9yIGR5bmFtaWMgbnVsbCBoYW5kbGluZy4gQSB0YWJsZSBpcyBjaG9zZW4gYmFzZWQgb24gdGhlIHNlbGVjdGVkIGFkbWluIHJlZ2lvbi5gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHBpY2sgdGhlIGFkbWluIGRhdGFzZXQgYmFzZWQgb24gYWRtaW4gc2VsZWN0aW9uXG5kYXRhSGF6YXJkU2VsZWN0ZWQgPSB7XG4gIGlmIChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlKSByZXR1cm4gZGF0YUhhemFyZEFkbWluMlxuICBlbHNlIGlmIChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlKSByZXR1cm4gZGF0YUhhemFyZEFkbWluMVxuICBlbHNlIGlmIChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlKSByZXR1cm4gZGF0YUhhemFyZEFkbWluMFxuICBlbHNlIHJldHVybiBkYXRhSGF6YXJkQWRtaW5BbGxcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkYXRhSGF6YXJkQWRtaW5BbGwgPSBhd2FpdCBkYi5xdWVyeShgXG4tLSBhZG1pbjAsIGNvbWJpbmUgZm9yIFN1Yi1TYWhhcmFuIEFmcmljYVxud2l0aCBkYXRhX3RibCBhcyAoXG4gIHdpdGggdGJsIGFzIChcbiAgICAtLSB0b3RhbCBmb3IgYWxsIGFkbWluMCByZWdpb25zXG4gICAgd2l0aCBiYXNlIGFzIChcbiAgICAgIC0tIGNob3NlbiBzY2VuYXJpbyBhbmQgdGltZWZyYW1lLCBWb1BcbiAgICAgIHNlbGVjdCBhZG1pbjBfbmFtZVxuICAgICAgICAsIGFkbWluMV9uYW1lXG4gICAgICAgICwgYWRtaW4yX25hbWVcbiAgICAgICAgLCBzY2VuYXJpb1xuICAgICAgICAsIHRpbWVmcmFtZVxuICAgICAgICAsIGNyb3BcbiAgICAgICAgLCB0aHJlc2hvbGRcbiAgICAgICAgLCBoYXphcmRcbiAgICAgICAgLCB2YWx1ZSBhcyB2b3BcbiAgICAgICAgZnJvbSBoZWF0X3N0cmVzc19kYXRhXG4gICAgICAgIHdoZXJlIHRpbWVmcmFtZSA9ICcke3NlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lLnRpbWVmcmFtZX0nXG4gICAgICAgIGFuZCBzY2VuYXJpbyA9ICcke3NlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lLnNjZW5hcmlvfSdcbiAgICAgICAgYW5kIHRocmVzaG9sZCA9ICcke3NlbGVjdFRocmVzaG9sZC50aHJlc2hvbGR9J1xuICAgIClcbiAgICBcbiAgICBzZWxlY3QgKlxuICAgICAgZnJvbSBiYXNlXG4gICAgICB3aGVyZSBhZG1pbjFfbmFtZSBpcyBudWxsXG4gIClcblxuICAtLSB0b3RhbCBWb1AgZm9yIGVhY2ggY3JvcFxuICBzZWxlY3QgdGhyZXNob2xkXG4gICAgLCBzY2VuYXJpb1xuICAgICwgdGltZWZyYW1lXG4gICAgLCBoYXphcmRcbiAgICAsIGNyb3BcbiAgICAsIFNVTSh2b3ApIGFzIHZvcFxuICAgIGZyb20gdGJsXG4gICAgZ3JvdXAgYnkgdGhyZXNob2xkXG4gICAgLCBzY2VuYXJpb1xuICAgICwgdGltZWZyYW1lXG4gICAgLCBoYXphcmRcbiAgICAsIGNyb3Bcbilcblxuc2VsZWN0IG51bGwgYXMgYWRtaW4wX25hbWUgLS0gYWRkIGFkbWluIHZhbHVlcyBhcyBudWxsc1xuICAsIG51bGwgYXMgYWRtaW4xX25hbWVcbiAgLCBudWxsIGFzIGFkbWluMl9uYW1lXG4gICwgKlxuICBmcm9tIGRhdGFfdGJsXG5gKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkYXRhSGF6YXJkQWRtaW4wID0gYXdhaXQgZGIucXVlcnkoYFxuLS0gYWRtaW4wIGxldmVsIGhhemFyZCBkYXRhXG53aXRoIGJhc2UgYXMgKFxuICAtLSBjaG9zZW4gc2NlbmFyaW8gYW5kIHRpbWVmcmFtZSBWb1BcbiAgc2VsZWN0IGFkbWluMF9uYW1lXG4gICAgLCBhZG1pbjFfbmFtZVxuICAgICwgYWRtaW4yX25hbWVcbiAgICAsIHNjZW5hcmlvXG4gICAgLCB0aW1lZnJhbWVcbiAgICAsIGNyb3BcbiAgICAsIHRocmVzaG9sZFxuICAgICwgaGF6YXJkXG4gICAgLCB2YWx1ZSBhcyB2b3BcbiAgICBmcm9tIGhlYXRfc3RyZXNzX2RhdGFcbiAgICB3aGVyZSB0aW1lZnJhbWUgPSAnJHtzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZS50aW1lZnJhbWV9J1xuICAgIGFuZCBzY2VuYXJpbyA9ICcke3NlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lLnNjZW5hcmlvfSdcbiAgICBhbmQgdGhyZXNob2xkID0gJyR7c2VsZWN0VGhyZXNob2xkLnRocmVzaG9sZH0nXG4pXG5cbnNlbGVjdCAqXG4gIGZyb20gYmFzZVxuICB3aGVyZSBhZG1pbjFfbmFtZSBpcyBudWxsXG4gIGFuZCBhZG1pbjBfbmFtZSA9ICcke2FkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWV9J1xuYCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTk5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGF0YUhhemFyZEFkbWluMSA9IGF3YWl0IGRiLnF1ZXJ5KGBcbi0tIGFkbWluMSBsZXZlbCBoYXphcmQgZGF0YVxud2l0aCBiYXNlIGFzIChcbiAgLS0gY2hvc2VuIHNjZW5hcmlvIGFuZCB0aW1lZnJhbWUgVm9QXG4gIHNlbGVjdCBhZG1pbjBfbmFtZVxuICAgICwgYWRtaW4xX25hbWVcbiAgICAsIGFkbWluMl9uYW1lXG4gICAgLCBzY2VuYXJpb1xuICAgICwgdGltZWZyYW1lXG4gICAgLCBjcm9wXG4gICAgLCB0aHJlc2hvbGRcbiAgICAsIGhhemFyZFxuICAgICwgdmFsdWUgYXMgdm9wXG4gICAgZnJvbSBoZWF0X3N0cmVzc19kYXRhXG4gICAgd2hlcmUgdGltZWZyYW1lID0gJyR7c2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUudGltZWZyYW1lfSdcbiAgICBhbmQgc2NlbmFyaW8gPSAnJHtzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZS5zY2VuYXJpb30nXG4gICAgYW5kIHRocmVzaG9sZCA9ICcke3NlbGVjdFRocmVzaG9sZC50aHJlc2hvbGR9J1xuKVxuXG5zZWxlY3QgKlxuICBmcm9tIGJhc2VcbiAgd2hlcmUgYWRtaW4wX25hbWUgPScgJHthZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlfSdcbiAgYW5kIGFkbWluMV9uYW1lID0gJyR7YWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZX0nXG4gIGFuZCBhZG1pbjJfbmFtZSBpcyBudWxsXG5gKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGF0YUhhemFyZEFkbWluMiA9IGF3YWl0IGRiLnF1ZXJ5KGBcbi0tIGFkbWluMiBsZXZlbCBoYXphcmQgZGF0YVxud2l0aCBiYXNlIGFzIChcbiAgLS0gY2hvc2VuIHNjZW5hcmlvIGFuZCB0aW1lZnJhbWUgVm9QXG4gIHNlbGVjdCBhZG1pbjBfbmFtZVxuICAgICwgYWRtaW4xX25hbWVcbiAgICAsIGFkbWluMl9uYW1lXG4gICAgLCBzY2VuYXJpb1xuICAgICwgdGltZWZyYW1lXG4gICAgLCBjcm9wXG4gICAgLCB0aHJlc2hvbGRcbiAgICAsIGhhemFyZFxuICAgICwgdmFsdWUgYXMgdm9wXG4gICAgZnJvbSBoZWF0X3N0cmVzc19kYXRhXG4gICAgd2hlcmUgdGltZWZyYW1lID0gJyR7c2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUudGltZWZyYW1lfSdcbiAgICBhbmQgc2NlbmFyaW8gPSAnJHtzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZS5zY2VuYXJpb30nXG4gICAgYW5kIHRocmVzaG9sZCA9ICcke3NlbGVjdFRocmVzaG9sZC50aHJlc2hvbGR9J1xuKVxuXG5zZWxlY3QgKlxuICBmcm9tIGJhc2VcbiAgd2hlcmUgYWRtaW4wX25hbWUgPSAnJHthZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlfSdcbiAgYW5kIGFkbWluMV9uYW1lID0gJyR7YWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZX0nXG4gIGFuZCBhZG1pbjJfbmFtZSA9ICcke2FkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjIudmFsdWV9J1xuYCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYC0tLVxuIyMjIyBIZWxwZXJzYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaGVscGVyc0hhemFyZCA9IHtcbiAgcmV0dXJuIHtcbiAgICBjb2xvckRvbWFpbjogWydjcm9wJywgJ2xpdmVzdG9jayddLFxuICAgIGNvbG9yUmFuZ2U6IFsnc2VhZ3JlZW4nLCAnc2llbm5hJ11cbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBEeW5hbWljIEluc2lnaHRzIC0gSGVhdCBTdHJlc3MgaW4gTnVtYmVyc2A7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFfc2VsZWN0ZWRIYXphcmRDcm9wVHlwZSA9IFQudGlkeShcbiAgZGF0YV9oYXphcmRWb1AsXG4gIFQuZmlsdGVyKFxuICAgIChkKSA9PlxuICAgICAgZC5zY2VuYXJpbyA9PT0gc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUuc2NlbmFyaW8gJiZcbiAgICAgIGQudGltZWZyYW1lID09PSBzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZS50aW1lZnJhbWUgJiZcbiAgICAgIGQudGhyZXNob2xkID09IHNlbGVjdFRocmVzaG9sZC50aHJlc2hvbGQsXG4gICksXG4gIFQubXV0YXRlKHtcbiAgICBjcm9wVHlwZTogKGQpID0+IHtcbiAgICAgIGlmIChyaXNrRGF0YVR5cGVzLmNyb3AuY3JvcC5pbmNsdWRlcyhkLmNyb3ApKSByZXR1cm4gXCJjcm9wXCI7XG4gICAgICByZXR1cm4gXCJvdGhlclwiO1xuICAgIH0sXG4gICAgY3JvcFZhbHVlOiAoZCkgPT4gcGFyc2VGbG9hdChkLmNyb3ApLCAvLyBFbnN1cmUgY3JvcFZhbHVlIGlzIG51bWVyaWNcbiAgfSksXG4gIFQuYXJyYW5nZShbXCJjcm9wVHlwZVwiLCBULmRlc2MoXCJ2b3BcIildKSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGNvbWJpbmVkIGNyb3AgYW5kIGxpdmVzdG9jayBleHBvc2VkIGZvciBzZWxlY3Rpb25cbmluc2lnaHRfdG90YWxFeHBvc2VkVm9wID0gVC50aWR5KFxuICBkYXRhX3NlbGVjdGVkSGF6YXJkQ3JvcFR5cGUsXG4gIFQuZmlsdGVyKChkKSA9PiBkLmNyb3BUeXBlID09PSBcImNyb3BcIiksXG4gIFQuZ3JvdXBCeShcbiAgICBbXCJjcm9wVHlwZVwiLCBcImhhemFyZFwiXSxcbiAgICBbXG4gICAgICBULnN1bW1hcml6ZSh7XG4gICAgICAgIHRvdGFsRXhwb3NlZFZvcDogVC5zdW0oXCJ2b3BcIiksXG4gICAgICAgIHRvdGFsRXhwb3NlZFZvcE92ZXIzMDogVC5zdW0oKGQpID0+IChkLmNyb3BWYWx1ZSA+PSAzMCA/IGQudm9wIDogMCkpLCAvLyBTdW0gZm9yIGNyb3BzIG92ZXIgMzAlXG4gICAgICAgIHRvdGFsRXhwb3NlZFZvcE92ZXI1MDogVC5zdW0oKGQpID0+IChkLmNyb3BWYWx1ZSA+PSA1NSA/IGQudm9wIDogMCkpLCAvLyBTdW0gZm9yIGNyb3BzIG92ZXIgNTAlXG4gICAgICB9KSxcbiAgICBdLFxuICApLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTA2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW5zaWdodF90b3BFeHAgPSB7XG4gIGNvbnN0IGNyb3BzQnlWb3AgPSBULnRpZHkoXG4gICAgZGF0YV9zZWxlY3RlZEhhemFyZENyb3BUeXBlLFxuICAgIFQuc2VsZWN0KFtcImNyb3BUeXBlXCIsIFwiY3JvcFwiLCBcInZvcFwiLCBcImhhemFyZFwiXSksXG4gICAgVC5maWx0ZXIoZCA9PiBkLmNyb3BUeXBlID09IFwiY3JvcFwiKVxuICApO1xuICBcbiAgLy8gRmluZCB0aGUgdG9wIGNyb3AgYnkgdm9wXG4gIGNvbnN0IHRvcENyb3AgPSBULnRpZHkoXG4gICAgY3JvcHNCeVZvcCxcbiAgICBULnNsaWNlTWF4KDEsIFwidm9wXCIpXG4gIClbMF07XG4gIFxuICAvLyBSZXR1cm4gdGhlIGNvbWJpbmF0aW9uLCBpbmNsdWRpbmcgdG9wQ3JvcCBvbmx5IGlmIGl0J3Mgbm90ICczMCcgb3IgJzUwJ1xuICByZXR1cm4gW3RvcENyb3BdLmZpbHRlcihkID0+IGQgIT09IHVuZGVmaW5lZCk7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyB0b3RhbCB2b3AgZXhwb3NlZCBieSBlYWNoIGhhemFyZFxuaW5zaWdodF9yYW5rZWRIYXphcmRWb3BUb3RhbHMgPSBULnRpZHkoXG4gIGRhdGFfaGF6YXJkVm9QLFxuICBULmdyb3VwQnkoXG4gICAgW1wiaGF6YXJkXCJdLFxuICAgIFtcbiAgICAgIFQuc3VtbWFyaXplKHtcbiAgICAgICAgdG90YWxWb3A6IFQuc3VtKFwidm9wXCIpLFxuICAgICAgfSksXG4gICAgXSxcbiAgKSxcbiAgVC5maWx0ZXIoKGQpID0+IGQuaGF6YXJkICE9PSBcImFueVwiKSwgLy8gcmVtb3ZlIGNvbWJpbmVkIGhhemFyZFxuICBULmFycmFuZ2UoVC5kZXNjKFwidG90YWxWb3BcIikpLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTA4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyBCYXJDaGFydCAtIExvc3Mgb2YgU2FmZSBXb3JraW5nIEhvdXJzYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTA5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gbWFrZSB0aGUgYmFyIGNoYXJ0IGZvciB0b3AgY3JvcHNcbi8vIGFwcHJvYWNoIGlzIHBhc3NpbmcgaW4gZGF0YSBmb3Igc2VsZWN0ZWQgaGF6YXJkIGFuZCBjcm9wIHR5cGVcbmZ1bmN0aW9uIG1ha2VIb3VybHlCYXJDaGFydChkYXRhKSB7XG4gIC8vIGlmIG5vIGRhdGEgaXMgYXZhaWxhYmxlIGZvciBzZWxlY3RlZCBoYXphcmQsIHNob3cgYSBtZXNzYWdlXG4gIGlmIChkYXRhLmxlbmd0aCA9PSAwKSB7XG4gICAgcmV0dXJuIG1kYCpObyBWb1AgZXhwb3N1cmUqYDtcbiAgfVxuICBjb25zdCB0b3BOID0gMTA7XG5cbiAgcmV0dXJuIFBsb3QucGxvdCh7XG4gICAgd2lkdGgsXG4gICAgbWFyZ2luTGVmdDogMTAwLFxuICAgIGNhcHRpb246IG1vbmV0YXJ5Vm9QTm90ZSxcbiAgICB4OiB7XG4gICAgICB0aWNrRm9ybWF0OiBmb3JtYXRVU0QsXG4gICAgICBsYWJlbDogXCJWb1AgYXQgcmlzayAoJClcIixcbiAgICAgIGdyaWQ6IHRydWUsXG4gICAgfSxcbiAgICB5OiB7XG4gICAgICBsYWJlbDogbnVsbCxcbiAgICAgIHRpY2tTaXplOiAwLFxuICAgIH0sXG4gICAgY29sb3I6IHtcbiAgICAgIGRvbWFpbjogaG91cmx5UGxvdExvb2t1cC5jb2xvci5kb21haW4sXG4gICAgICByYW5nZTogaG91cmx5UGxvdExvb2t1cC5jb2xvci5yYW5nZSxcbiAgICB9LFxuICAgIG1hcmtzOiBbXG4gICAgICBQbG90LmJhclgoZGF0YSwge1xuICAgICAgICB4OiBcImRlbHRhXCIsXG4gICAgICAgIHk6IChkKSA9PiBob3VybHlQbG90TG9va3VwLmhvdXJzW2QuaG91cl9kYXldLFxuICAgICAgICBmaWxsOiAoZCkgPT4gaG91cmx5UGxvdExvb2t1cC5uYW1lc1tkLmhhemFyZF0sXG4gICAgICAgIHNvcnQ6IHsgeTogXCJ4XCIsIHJldmVyc2U6IHRydWUsIGxpbWl0OiAxMCB9LFxuICAgICAgICBjaGFubmVsczoge1xuICAgICAgICAgIGRlbHRhOiB7XG4gICAgICAgICAgICBsYWJlbDogXCJWb1AgYXQgcmlza1wiLFxuICAgICAgICAgICAgdmFsdWU6IFwiZGVsdGFcIixcbiAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICB0aXA6IHtcbiAgICAgICAgICBmb3JtYXQ6IHtcbiAgICAgICAgICAgIHg6IGZhbHNlLFxuICAgICAgICAgICAgeTogZmFsc2UsXG4gICAgICAgICAgICBmaWxsOiBmYWxzZSxcbiAgICAgICAgICAgIGRlbHRhOiAoZCkgPT4gZm9ybWF0VVNEKGQpLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICB9KSxcbiAgICBdLFxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZGF0YSBmb3Igc2VsZWN0ZWQgaGF6YXJkIHNjZW5hcmlvLCB3aXRoIHRvdGFsIHZvcFxuZGF0YV9ob3VybHlTdHJlc3MgPSBULnRpZHkoXG4gIGRhdGFIb3VybHlTZWxlY3RlZCxcbiAgVC5sZWZ0Sm9pbihkYXRhSGF6YXJkSG91cmx5VG90YWxTZWxlY3RlZCwge1xuICAgIGJ5OiBbXCJhZG1pbjBfbmFtZVwiLCBcImFkbWluMV9uYW1lXCIsIFwiYWRtaW4yX25hbWVcIiwgXCJob3VyX2RheVwiXSxcbiAgfSksXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkYXRhSGF6YXJkSG91cmx5VG90YWxTZWxlY3RlZCA9IFQudGlkeShcbiAgZGF0YUhvdXJseVNlbGVjdGVkLFxuICBULmdyb3VwQnkoXG4gICAgW1xuICAgICAgXCJhZG1pbjBfbmFtZVwiLFxuICAgICAgXCJhZG1pbjFfbmFtZVwiLFxuICAgICAgXCJhZG1pbjJfbmFtZVwiLFxuICAgICAgXCJ0aHJlc2hvbGRcIixcbiAgICAgIFwic2NlbmFyaW9cIixcbiAgICAgIFwidGltZWZyYW1lXCIsXG4gICAgICBcImhvdXJfZGF5XCIsXG4gICAgXSxcbiAgICBbXG4gICAgICBULnN1bW1hcml6ZSh7XG4gICAgICAgIGRlbHRhX3RvdGFsOiBULm1lYW4oXCJkZWx0YVwiKSxcbiAgICAgIH0pLFxuICAgIF0sXG4gICksXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBwaWNrIHRoZSBhZG1pbiBkYXRhc2V0IGJhc2VkIG9uIGFkbWluIHNlbGVjdGlvblxuZGF0YUhvdXJseVNlbGVjdGVkID0ge1xuICBpZiAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMi52YWx1ZSkgcmV0dXJuIGRhdGFIb3VybHlBZG1pbjJcbiAgZWxzZSBpZiAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZSkgcmV0dXJuIGRhdGFIb3VybHlBZG1pbjFcbiAgZWxzZSBpZiAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZSkgcmV0dXJuIGRhdGFIb3VybHlBZG1pbjBcbiAgZWxzZSByZXR1cm4gZGF0YUhvdXJseUFkbWluQWxsXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFIb3VybHlBZG1pbjAgPSBhd2FpdCBkYi5xdWVyeShgXG4tLSBhZG1pbjAgbGV2ZWwgaGF6YXJkIGRhdGFcbndpdGggYmFzZSBhcyAoXG4gIC0tIGNob3NlbiBzY2VuYXJpbyBhbmQgdGltZWZyYW1lIFZvUFxuICBzZWxlY3QgYWRtaW4wX25hbWVcbiAgICAgICAgLCBhZG1pbjFfbmFtZVxuICAgICAgICAsIGFkbWluMl9uYW1lXG4gICAgICAgICwgc2NlbmFyaW9cbiAgICAgICAgLCB0aW1lZnJhbWVcbiAgICAgICAgLCBob3VyX2RheVxuICAgICAgICAsIHRocmVzaG9sZFxuICAgICAgICAsIGhhemFyZFxuICAgICAgICAsIHBlcmlvZFxuICAgICAgICAsIGNvcnJlY3RlZF9wb3AgYXMgY29ycmVjdGVkX3BvcF9zdW1cbiAgICAgICAgLCBkZWx0YV9wb3AgYXMgZGVsdGFfcG9wX21lYW5cbiAgICAgICAgLCB0b3RhbF9kYXlzIGFzIGRheXNfcGVyaW9kXG4gICAgICAgICwgYXZnX2NvdW50IGFzIGRlbHRhXG4gICAgICAgIGZyb20gaG91cmx5X2RhdGFcbiAgICAgICAgd2hlcmUgdGltZWZyYW1lID0gJyR7c2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUyLnRpbWVmcmFtZX0nXG4gICAgICAgIGFuZCBzY2VuYXJpbyA9ICcke3NlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lMi5zY2VuYXJpb30nXG4gICAgICAgIGFuZCB0aHJlc2hvbGQgPSAnJHtzZWxlY3RUaHJlc2hvbGQyLnRocmVzaG9sZH0nXG4pXG5cbnNlbGVjdCAqXG4gIGZyb20gYmFzZVxuICB3aGVyZSBhZG1pbjFfbmFtZSBpcyBudWxsXG4gIGFuZCBhZG1pbjBfbmFtZSA9ICcke2FkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWV9J1xuYCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFIb3VybHlBZG1pbjEgPSBhd2FpdCBkYi5xdWVyeShgXG4tLSBhZG1pbjEgbGV2ZWwgaGF6YXJkIGRhdGFcbndpdGggYmFzZSBhcyAoXG4gIC0tIGNob3NlbiBzY2VuYXJpbyBhbmQgdGltZWZyYW1lIFZvUFxuICBzZWxlY3QgYWRtaW4wX25hbWVcbiAgICAsIGFkbWluMV9uYW1lXG4gICAgLCBhZG1pbjJfbmFtZVxuICAgICwgc2NlbmFyaW9cbiAgICAsIHRpbWVmcmFtZVxuICAgICwgaG91cl9kYXlcbiAgICAsIHRocmVzaG9sZFxuICAgICwgaGF6YXJkXG4gICAgLCBwZXJpb2RcbiAgICAsIGNvcnJlY3RlZF9wb3AgYXMgY29ycmVjdGVkX3BvcF9zdW1cbiAgICAsIGRlbHRhX3BvcCBhcyBkZWx0YV9wb3BfbWVhblxuICAgICwgdG90YWxfZGF5cyBhcyBkYXlzX3BlcmlvZFxuICAgICwgYXZnX2NvdW50IGFzIGRlbHRhXG4gICAgZnJvbSBob3VybHlfZGF0YVxuICAgIHdoZXJlIHRpbWVmcmFtZSA9ICcke3NlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lMi50aW1lZnJhbWV9J1xuICAgIGFuZCBzY2VuYXJpbyA9ICcke3NlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lMi5zY2VuYXJpb30nXG4gICAgYW5kIHRocmVzaG9sZCA9ICcke3NlbGVjdFRocmVzaG9sZDIudGhyZXNob2xkfSdcbilcblxuc2VsZWN0ICpcbiAgZnJvbSBiYXNlXG4gIHdoZXJlIGFkbWluMF9uYW1lID0gJyR7YWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZX0nXG4gIGFuZCBhZG1pbjFfbmFtZSA9ICcke2FkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjEudmFsdWV9J1xuICBhbmQgYWRtaW4yX25hbWUgaXMgbnVsbFxuYCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExNSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFIb3VybHlBZG1pbjIgPSBhd2FpdCBkYi5xdWVyeShgXG4tLSBhZG1pbjIgbGV2ZWwgaGF6YXJkIGRhdGFcbndpdGggYmFzZSBhcyAoXG4gIC0tIGNob3NlbiBzY2VuYXJpbyBhbmQgdGltZWZyYW1lIFZvUFxuICBzZWxlY3QgYWRtaW4wX25hbWVcbiAgICAgICAgLCBhZG1pbjFfbmFtZVxuICAgICAgICAsIGFkbWluMl9uYW1lXG4gICAgICAgICwgc2NlbmFyaW9cbiAgICAgICAgLCB0aW1lZnJhbWVcbiAgICAgICAgLCBob3VyX2RheVxuICAgICAgICAsIHRocmVzaG9sZFxuICAgICAgICAsIGhhemFyZFxuICAgICAgICAsIHBlcmlvZFxuICAgICAgICAsIGNvcnJlY3RlZF9wb3AgYXMgY29ycmVjdGVkX3BvcF9zdW1cbiAgICAgICAgLCBkZWx0YV9wb3AgYXMgZGVsdGFfcG9wX21lYW5cbiAgICAgICAgLCB0b3RhbF9kYXlzIGFzIGRheXNfcGVyaW9kXG4gICAgICAgICwgYXZnX2NvdW50IGFzIGRlbHRhXG4gICAgZnJvbSBob3VybHlfZGF0YVxuICAgICAgICB3aGVyZSB0aW1lZnJhbWUgPSAnJHtzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZTIudGltZWZyYW1lfSdcbiAgICAgICAgYW5kIHNjZW5hcmlvID0gJyR7c2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUyLnNjZW5hcmlvfSdcbiAgICAgICAgYW5kIHRocmVzaG9sZCA9ICcke3NlbGVjdFRocmVzaG9sZDIudGhyZXNob2xkfSdcbilcblxuc2VsZWN0ICpcbiAgZnJvbSBiYXNlXG4gIHdoZXJlIGFkbWluMF9uYW1lID0gJyR7YWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZX0nXG4gIGFuZCBhZG1pbjFfbmFtZSA9ICcke2FkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjEudmFsdWV9J1xuICBhbmQgYWRtaW4yX25hbWUgPSAnJHthZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlfSdcbmApO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkYXRhSG91cmx5QWRtaW5BbGwgPSBhd2FpdCBkYi5xdWVyeShgXG4tLSBhZG1pbjAsIGNvbWJpbmUgZm9yIFN1Yi1TYWhhcmFuIEFmcmljYVxud2l0aCBkYXRhX3RibCBhcyAoXG4gIHdpdGggdGJsIGFzIChcbiAgICAtLSB0b3RhbCBmb3IgYWxsIGFkbWluMCByZWdpb25zXG4gICAgd2l0aCBiYXNlIGFzIChcbiAgICAgIC0tIGNob3NlbiBzY2VuYXJpbyBhbmQgdGltZWZyYW1lLCBWb1BcbiAgICAgIHNlbGVjdCBhZG1pbjBfbmFtZVxuICAgICAgICAsIGFkbWluMV9uYW1lXG4gICAgICAgICwgYWRtaW4yX25hbWVcbiAgICAgICAgLCBzY2VuYXJpb1xuICAgICAgICAsIHRpbWVmcmFtZVxuICAgICAgICAsIGhvdXJfZGF5XG4gICAgICAgICwgdGhyZXNob2xkXG4gICAgICAgICwgaGF6YXJkXG4gICAgICAgICwgY29ycmVjdGVkX3BvcCBhcyBjb3JyZWN0ZWRfcG9wX3N1bVxuICAgICAgICAsIGRlbHRhX3BvcCBhcyBkZWx0YV9wb3BfbWVhblxuICAgICAgICAsIHRvdGFsX2RheXMgYXMgZGF5c19wZXJpb2RcbiAgICAgICAgLCBhdmdfY291bnQgYXMgZGVsdGFcbiAgICAgICAgZnJvbSBob3VybHlfZGF0YVxuICAgICAgICB3aGVyZSB0aW1lZnJhbWUgPSAnJHtzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZTIudGltZWZyYW1lfSdcbiAgICAgICAgYW5kIHNjZW5hcmlvID0gJyR7c2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUyLnNjZW5hcmlvfSdcbiAgICAgICAgYW5kIHRocmVzaG9sZCA9ICcke3NlbGVjdFRocmVzaG9sZDIudGhyZXNob2xkfSdcbiAgICApXG4gICAgXG4gICAgc2VsZWN0ICpcbiAgICAgIGZyb20gYmFzZVxuICAgICAgd2hlcmUgYWRtaW4xX25hbWUgaXMgbnVsbFxuICApXG5cbiAgLS0gdG90YWwgVm9QIGZvciBlYWNoIGNyb3BcbiAgc2VsZWN0IHRocmVzaG9sZFxuICAgICwgc2NlbmFyaW9cbiAgICAsIHRpbWVmcmFtZVxuICAgICwgaG91cl9kYXlcbiAgICAsIGhhemFyZFxuICAgICwgU1VNKGNvcnJlY3RlZF9wb3Bfc3VtKSBhcyBjb3JyZWN0ZWRfcG9wX3N1bVxuICAgICwgTUVBTihkZWx0YV9wb3BfbWVhbikgYXMgZGVsdGFfcG9wX21lYW5cbiAgICAsIE1FQU4oZGVsdGEpIGFzIGRlbHRhXG4gICAgLCBNRUFOKGRheXNfcGVyaW9kKSBhcyBkYXlzX3BlcmlvZFxuICAgIGZyb20gdGJsXG4gICAgZ3JvdXAgYnkgc2NlbmFyaW9cbiAgICAsIHRpbWVmcmFtZVxuICAgICwgdGhyZXNob2xkXG4gICAgLCBoYXphcmRcbiAgICAsIGhvdXJfZGF5XG4pXG5cbnNlbGVjdCBudWxsIGFzIGFkbWluMF9uYW1lIC0tIGFkZCBhZG1pbiB2YWx1ZXMgYXMgbnVsbHNcbiAgLCBudWxsIGFzIGFkbWluMV9uYW1lXG4gICwgbnVsbCBhcyBhZG1pbjJfbmFtZVxuICAsICpcbiAgZnJvbSBkYXRhX3RibFxuYCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGxvb2t1cHMgZm9yIGhhemFyZCBwbG90XG5ob3VybHlQbG90TG9va3VwID0ge1xuICByZXR1cm4ge1xuICAgIG5hbWVzOiB7XG4gICAgICBwbGFudGluZzogTGFuZy50b1RpdGxlQ2FzZShfbGFuZyhuYlRleHQubGVnZW5kcy5zZWFzb25UeXBlcy5wbGFudGluZykpLFxuICAgICAgaGFydmVzdGluZzogTGFuZy50b1RpdGxlQ2FzZShfbGFuZyhuYlRleHQubGVnZW5kcy5zZWFzb25UeXBlcy5oYXJ2ZXN0aW5nKSlcbiAgICB9LFxuICAgIGNvbG9yOiB7XG4gICAgICBkb21haW46IFtcbiAgICAgICAgTGFuZy50b1RpdGxlQ2FzZShfbGFuZyhuYlRleHQubGVnZW5kcy5zZWFzb25UeXBlcy5wbGFudGluZykpLFxuICAgICAgICBMYW5nLnRvVGl0bGVDYXNlKF9sYW5nKG5iVGV4dC5sZWdlbmRzLnNlYXNvblR5cGVzLmhhcnZlc3RpbmcpKSxcbiAgICAgIF0sXG4gICAgICByYW5nZTogW1xuICAgICAgICAvLyByZWQgZm9yIGJvdGhcbiAgICAgICAgXCIjNEZCNUI3XCIsIFxuICAgICAgICBcIiNGQ0M0MkNcIixcbiAgICAgIF0sXG4gICAgICAvLyByYW5nZTogW1xuICAgICAgLy8gICBcIiM4MDgwMDBcIiwgLy8gT2xpdmUgR3JlZW5cbiAgICAgIC8vICAgXCIjQjU2NTFEXCIsIC8vIExpZ2h0IEJyb3duXG4gICAgICAvLyBdLFxuICAgIH0sXG4gICAgaG91cnM6IGhvdXJseU5hbWVzLnJlZHVjZSgoYWNjLCBvYmopID0+IHtcbiAgICAgIGFjY1tvYmouaG91cl9kYXldID0gb2JqLmhvdXJseU5hbWU7XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9KVxuICB9O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyB1bmlxdWUgY3JvcHMgaW4gdGhlIGhhemFyZCBkYXRhXG5oYXphcmRIb3VycyA9IHtcbiAgY29uc3QgcXVlcnkgPSBhd2FpdCBkYi5xdWVyeShgc2VsZWN0IGhvdXJfZGF5XG4gICwgY291bnQoKikgYXMgY291bnRcbiAgZnJvbSBob3VybHlfZGF0YVxuICBncm91cCBieSAxXG4gIG9yZGVyIGJ5IDFgKTtcblxuICByZXR1cm4gcXVlcnlcbiB9XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGZvcm1hdHRpbmcgY3JvcCBuYW1lc1xuaG91cmx5TmFtZXMgPSBULnRpZHkoXG4gIGhhemFyZEhvdXJzLFxuICBULmRpc3RpbmN0KFwiaG91cl9kYXlcIiksXG4gIFQuc2VsZWN0KFwiaG91cl9kYXlcIiksXG4gIFQubXV0YXRlKHtcbiAgICAvLyBDb252ZXJ0IHRvIG51bWJlciBmb3Igc29ydGluZ1xuICAgIGhvdXJseU51bTogKGQpID0+IHBhcnNlSW50KGQuaG91cl9kYXksIDEwKSxcbiAgICAvLyBEZXRlcm1pbmUgdGhlIHR5cGUgYmFzZWQgb24gdGhlIG9yaWdpbmFsIHN0cmluZyBmb3JtYXQgKGFkanVzdCBhcyBuZWVkZWQpXG4gICAgdHlwZTogKGQpID0+ICgvXy8udGVzdChkLmhvdXJfZGF5KSA/IFwibGl2ZXN0b2NrXCIgOiBcImhvdXJfZGF5XCIpLFxuICAgIC8vIEZvcm1hdCB0aGUgbmFtZVxuICAgIGhvdXJseU5hbWU6IChkKSA9PiB7XG4gICAgICBsZXQgaG91cmx5TmFtZSA9IGQuaG91cl9kYXk7XG4gICAgICBpZiAoL18vLnRlc3QoZC5ob3VyX2RheSkpXG4gICAgICAgIGhvdXJseU5hbWUgPSBob3VybHlOYW1lLnJlcGxhY2UoXCJfXCIsIFwiIChcIikgKyBcIilcIjtcbiAgICAgIHJldHVybiBob3VybHlOYW1lO1xuICAgIH0sXG4gIH0pLFxuICAvLyBVc2UgdGhlIG51bWVyaWMgdmVyc2lvbiBvZiBob3VyIGZvciBzb3J0aW5nLCB0aGVuIHJlbW92ZSBpdCBmcm9tIHRoZSBmaW5hbCByZXN1bHQgYXMgaXQncyBubyBsb25nZXIgbmVlZGVkXG4gIFQuYXJyYW5nZShbXCJ0eXBlXCIsIFwiaG91cmx5TnVtXCJdKSxcbiAgVC5zZWxlY3QoW1widHlwZVwiLCBcImhvdXJfZGF5XCIsIFwiaG91cmx5TmFtZVwiXSksXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMjAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAjIyMgRHluYW1pYyBJbnNpZ2h0cyAtIExvc3Mgb2YgU2FmZSBXb3JraW5nIEhvdXJzYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGF0YV9zZWxlY3RlZEhvdXJseSA9IFQudGlkeShcbiAgZGF0YV9ob3VybHlTdHJlc3MsXG4gIFQuZmlsdGVyKFxuICAgIChkKSA9PlxuICAgICAgZC5zY2VuYXJpbyA9PT0gc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUyLnNjZW5hcmlvICYmXG4gICAgICBkLnRpbWVmcmFtZSA9PT0gc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUyLnRpbWVmcmFtZSxcbiAgKSxcbiAgVC5tdXRhdGUoe1xuICAgIGhvdXJfZGF5VHlwZTogKGQpID0+IHtcbiAgICAgIGlmIChob3VybHlEYXRhVHlwZXMuaG91cl9kYXkuaG91cl9kYXkuaW5jbHVkZXMoZC5ob3VyX2RheSkpXG4gICAgICAgIHJldHVybiBcImhvdXJfZGF5XCI7XG4gICAgICByZXR1cm4gXCJvdGhlclwiO1xuICAgIH0sXG4gICAgaG91cl9kYXlWYWx1ZTogKGQpID0+IHBhcnNlRmxvYXQoZC5ob3VyX2RheSksIC8vIEVuc3VyZSBob3VyX2RheVZhbHVlIGlzIG51bWVyaWNcbiAgfSksXG4gIFQuc2VsZWN0KFtcbiAgICBcImhvdXJfZGF5VHlwZVwiLFxuICAgIFwiaGF6YXJkXCIsXG4gICAgXCJob3VyX2RheVwiLFxuICAgIFwiZGVsdGFcIixcbiAgICBcInBlcmlvZFwiLFxuICAgIFwiZGF5c19wZXJpb2RcIixcbiAgICBcImNvcnJlY3RlZF9wb3Bfc3VtXCIsXG4gICAgXCJkZWx0YV9wb3Bfc3VtXCIsXG4gIF0pLFxuICBULmFycmFuZ2UoW1wiaG91cl9kYXlUeXBlXCIsIFQuZGVzYyhcImRlbHRhXCIpXSksXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMjIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBob3VybHkgZXhwb3NpdGlvbiBkYXRhXG5pbnNpZ2h0X3RvdGFsRXhwb3NlZEhvdXJseSA9IFQudGlkeShcbiAgZGF0YV9zZWxlY3RlZEhvdXJseSxcbiAgVC5maWx0ZXIoKGQpID0+IGQuaG91cl9kYXlUeXBlID09PSBcImhvdXJfZGF5XCIpLFxuICBULmdyb3VwQnkoXG4gICAgW1wiaG91cl9kYXlUeXBlXCIsIFwiaGF6YXJkXCJdLFxuICAgIFtcbiAgICAgIFQuc3VtbWFyaXplKHtcbiAgICAgICAgdG90YWxFeHBvc2VkSG91cmx5OiBULnN1bShcImRlbHRhXCIpLFxuICAgICAgICBwZXJpb2Q6IFQuZmlyc3QoXCJwZXJpb2RcIiksXG4gICAgICAgIGRheXNfcGVyaW9kOiBULmZpcnN0KFwiZGF5c19wZXJpb2RcIiksXG4gICAgICAgIGNvcnJlY3RlZF9wb3Bfc3VtOiBULnN1bShcImNvcnJlY3RlZF9wb3Bfc3VtXCIpLFxuICAgICAgICBkZWx0YV9wb3Bfc3VtOiBULm1lYW4oXCJkZWx0YV9wb3Bfc3VtXCIpLFxuICAgICAgfSksXG4gICAgXSxcbiAgKSxcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Imluc2lnaHRfdG9wSG91cmx5ID0ge1xuICBjb25zdCBob3Vyc0J5RGVsdGEgPSBULnRpZHkoXG4gICAgZGF0YV9zZWxlY3RlZEhvdXJseSxcbiAgICBULnNlbGVjdChbXCJob3VyX2RheVR5cGVcIiwgXCJob3VyX2RheVwiLCBcImRlbHRhXCJdKSxcbiAgICBULmZpbHRlcihkID0+IGQuaG91cl9kYXlUeXBlID09IFwiaG91cl9kYXlcIilcbiAgKTtcbiAgXG4gIC8vIEZpbmQgdGhlIHRvcCBob3VyIGJ5IGRlbHRhXG4gIGNvbnN0IHRvcEhvdXJfZGF5ID0gVC50aWR5KFxuICAgIGhvdXJzQnlEZWx0YSxcbiAgICBULnNsaWNlTWF4KDEsIFwiZGVsdGFcIilcbiAgKVswXTtcbiAgXG4gIC8vIFJldHVybiB0aGUgY29tYmluYXRpb24sIGluY2x1ZGluZyB0b3BDcm9wIG9ubHkgaWYgaXQncyBub3QgJzMwJyBvciAnNTAnXG4gIHJldHVybiBbdG9wSG91cl9kYXldLmZpbHRlcihkID0+IGQgIT09IHVuZGVmaW5lZCk7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMjQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAjIyMjIEhlbHBlcnNgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMjUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpY2ljbGVfYWxpYXMgPSB7XG4gIGNvbnN0IG5hbWVNYXAgPSB7XG4gICAgcG9wdWxhdGlvbjogXCJUb3RhbCBQb3B1bGF0aW9uXCIsXG4gICAgcG92ZXJ0eTA6IFwiTG93IFBvdmVydHlcIixcbiAgICBwb3ZlcnR5MTogXCJNb2RlcmF0ZSBQb3ZlcnR5XCIsXG4gICAgcG92ZXJ0eTI6IFwiSGlnaCBQb3ZlcnR5XCIsXG4gICAgZWR1Y2F0aW9uMDogXCIwLTEgWWVhcnMgb2YgRWR1Y2F0aW9uXCIsXG4gICAgZWR1Y2F0aW9uMTogXCIxLTUgWWVhcnMgb2YgRWR1Y2F0aW9uXCIsXG4gICAgZWR1Y2F0aW9uMjogXCI1KyBZZWFycyBvZiBFZHVjYXRpb25cIixcbiAgICBnZW5kZXIwOiBcIkxvdyBGZW1hbGUgRW1wb3dlcm1lbnRcIixcbiAgICBnZW5kZXIxOiBcIk1vZGVyYXRlIEZlbWFsZSBFbXBvd2VybWVudFwiLFxuICAgIGdlbmRlcjI6IFwiSGlnaCBGZW1hbGUgRW1wb3dlcm1lbnRcIlxuICB9O1xuICByZXR1cm4gbmFtZU1hcDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTI2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFydGl0aW9uID0gKGRhdGEpID0+XG4gIGQzXG4gICAgLnBhcnRpdGlvbigpXG4gICAgLnBhZGRpbmcoMSlcbiAgICAuc2l6ZShuYXJyb3cgPyBbaGVpZ2h0LCB3aWR0aF0gOiBbd2lkdGgsIGhlaWdodF0pKFxuICAgIGQzXG4gICAgICAuaGllcmFyY2h5KGRhdGEpXG4gICAgICAuc3VtKChkKSA9PiBkLnZhbHVlKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIudmFsdWUgLSBhLnZhbHVlKSxcbiAgKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTI3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaWNpY2xlX2NvbG9yID0gZDNcbiAgLnNjYWxlT3JkaW5hbCgpXG4gIC5kb21haW4oW1xuICAgIFwicG9wdWxhdGlvblwiLFxuICAgIFwicG92ZXJ0eTJcIixcbiAgICBcInBvdmVydHkxXCIsXG4gICAgXCJwb3ZlcnR5MFwiLFxuICAgIFwiZWR1Y2F0aW9uMlwiLFxuICAgIFwiZWR1Y2F0aW9uMVwiLFxuICAgIFwiZWR1Y2F0aW9uMFwiLFxuICAgIFwiZ2VuZGVyMlwiLFxuICAgIFwiZ2VuZGVyMVwiLFxuICAgIFwiZ2VuZGVyMFwiLFxuICBdKVxuICAucmFuZ2UoW1xuICAgIFwiI2VmZWZlZlwiLFxuICAgIFwiI2VjNWE0N1wiLFxuICAgIFwiI2ZjOGEzNFwiLFxuICAgIFwiI2Y0YmIyMVwiLFxuICAgIFwiI2Y0YmIyMVwiLFxuICAgIFwiI2ZjOGEzNFwiLFxuICAgIFwiI2VjNWE0N1wiLFxuICAgIFwiI2Y0YmIyMVwiLFxuICAgIFwiI2ZjOGEzNFwiLFxuICAgIFwiI2VjNWE0N1wiLFxuICBdKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTI4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidGFyZ2V0SGVpZ2h0ID0gMzUwO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMjkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJuYXJyb3dIZWlnaHQgPSA2MDA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImhlaWdodCA9IG5hcnJvdyA/IG5hcnJvd0hlaWdodCA6IHRhcmdldEhlaWdodDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTMxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibmFycm93ID0gd2lkdGggPD0gMDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTMyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic2VnbWVudFggPSAoZCkgPT4gKG5hcnJvdyA/IGQueTAgOiBkLngwKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTMzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic2VnbWVudFkgPSAoZCkgPT4gKG5hcnJvdyA/IGQueDAgOiBkLnkwKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTM0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic2VnbWVudFdpZHRoID0gKGQpID0+IChuYXJyb3cgPyBkLnkxIC0gZC55MCA6IGQueDEgLSBkLngwKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTM1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic2VnbWVudEhlaWdodCA9IChkKSA9PiAobmFycm93ID8gZC54MSAtIGQueDAgOiBkLnkxIC0gZC55MCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGJ1aWxkSGllcmFyY2h5KGNzdikge1xuICAvLyBIZWxwZXIgZnVuY3Rpb24gdGhhdCB0cmFuc2Zvcm1zIHRoZSBnaXZlbiBDU1YgaW50byBhIGhpZXJhcmNoaWNhbCBmb3JtYXQuXG4gIGNvbnN0IHJvb3QgPSB7IG5hbWU6IFwicm9vdFwiLCBjaGlsZHJlbjogW10gfTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjc3YubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBzZXF1ZW5jZSA9IGNzdltpXVswXTtcbiAgICBjb25zdCBzaXplID0gK2NzdltpXVsxXTtcbiAgICBpZiAoaXNOYU4oc2l6ZSkpIHtcbiAgICAgIC8vIGUuZy4gaWYgdGhpcyBpcyBhIGhlYWRlciByb3dcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBjb25zdCBwYXJ0cyA9IHNlcXVlbmNlLnNwbGl0KFwiX1wiKTtcbiAgICBsZXQgY3VycmVudE5vZGUgPSByb290O1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgcGFydHMubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IGNoaWxkcmVuID0gY3VycmVudE5vZGVbXCJjaGlsZHJlblwiXTtcbiAgICAgIGNvbnN0IG5vZGVOYW1lID0gcGFydHNbal07XG4gICAgICBsZXQgY2hpbGROb2RlID0gbnVsbDtcbiAgICAgIGxldCBmb3VuZENoaWxkID0gZmFsc2U7XG4gICAgICAvLyBTZWFyY2ggZm9yIGV4aXN0aW5nIGNoaWxkIHdpdGggdGhlIHNhbWUgbmFtZVxuICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBjaGlsZHJlbi5sZW5ndGg7IGsrKykge1xuICAgICAgICBpZiAoY2hpbGRyZW5ba11bXCJuYW1lXCJdID09PSBub2RlTmFtZSkge1xuICAgICAgICAgIGNoaWxkTm9kZSA9IGNoaWxkcmVuW2tdO1xuICAgICAgICAgIGZvdW5kQ2hpbGQgPSB0cnVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBJZiBub3QgZm91bmQsIGNyZWF0ZSBhIG5ldyBjaGlsZCBub2RlXG4gICAgICBpZiAoIWZvdW5kQ2hpbGQpIHtcbiAgICAgICAgY2hpbGROb2RlID0geyBuYW1lOiBub2RlTmFtZSwgY2hpbGRyZW46IFtdIH07XG4gICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGROb2RlKTtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnROb2RlID0gY2hpbGROb2RlO1xuICAgICAgLy8gSWYgaXQncyB0aGUgbGFzdCBwYXJ0IG9mIHRoZSBzZXF1ZW5jZSwgY3JlYXRlIGEgbGVhZiBub2RlXG4gICAgICBpZiAoaiA9PT0gcGFydHMubGVuZ3RoIC0gMSkge1xuICAgICAgICBjaGlsZE5vZGUudmFsdWUgPSBzaXplO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gcm9vdDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTM3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYnJlYWRjcnVtYldpZHRoID0gMjAwO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMzgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJicmVhZGNydW1iSGVpZ2h0ID0gMzU7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIEdlbmVyYXRlIGEgc3RyaW5nIHRoYXQgZGVzY3JpYmVzIHRoZSBwb2ludHMgb2YgYSBicmVhZGNydW1iIFNWRyBwb2x5Z29uLlxuZnVuY3Rpb24gYnJlYWRjcnVtYlBvaW50cyhkLCBpKSB7XG4gIGNvbnN0IHRpcFdpZHRoID0gMTA7XG4gIGNvbnN0IHBvaW50cyA9IFtdO1xuICBwb2ludHMucHVzaChcIjAsMFwiKTtcbiAgcG9pbnRzLnB1c2goYCR7YnJlYWRjcnVtYldpZHRofSwwYCk7XG4gIHBvaW50cy5wdXNoKGAke2JyZWFkY3J1bWJXaWR0aCArIHRpcFdpZHRofSwke2JyZWFkY3J1bWJIZWlnaHQgLyAyfWApO1xuICBwb2ludHMucHVzaChgJHticmVhZGNydW1iV2lkdGh9LCR7YnJlYWRjcnVtYkhlaWdodH1gKTtcbiAgcG9pbnRzLnB1c2goYDAsJHticmVhZGNydW1iSGVpZ2h0fWApO1xuICBpZiAoaSA+IDApIHtcbiAgICAvLyBMZWZ0bW9zdCBicmVhZGNydW1iOyBkb24ndCBpbmNsdWRlIDZ0aCB2ZXJ0ZXguXG4gICAgcG9pbnRzLnB1c2goYCR7dGlwV2lkdGh9LCR7YnJlYWRjcnVtYkhlaWdodCAvIDJ9YCk7XG4gIH1cbiAgcmV0dXJuIHBvaW50cy5qb2luKFwiIFwiKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgIyMjIFRhYnVsYXIgZGF0YVxuLSAqKmFnX3dvcmtmb3JjZV9kYXRhKio6IGFnIHdvcmtmb3JjZSBkYXRhIHNob3dpbmcgY3VycmVudCBhbmQgcHJvamVjdGVkIGFnIHBvcHVsYXRpb25zIHVuZGVyIGRpZmZlcmVudCBzY2VuYXJpb3MgYW5kIGZvciBkaWZmZXJlbnQgeWVhcnMuIEZpbGU6IGJhc2VsaW5lX2RmX2RhdGEucGFycXVldC5cbi0gKipoZWF0X3N0cmVzc19kYXRhKio6IG51bWJlciBvZiBhZyB3b3JrZGVycyBmYWNpbmcgZGlmZmVyZW50IHN1bXMgb2YgZGF5cyBvbiBhIHllYXIgd2hlcmUgV0JHVCB2YWx1ZXMgZXhjZWVkIDMwIGRlZ3JlZXMuIEZpbGU6IGhlYXRfc3RyZXNzX2RhdGEucGFycXVldC5cbi0gKipob3VybHlfZGF0YSoqOiBwZXJjZW50IG9mIGhvdXJzIGFjcm9zcyBzZWFzb25zIChoYXJ2ZXN0aW5nLCBwbGFudGluZykgdGhhdCBleGNlZWQgc2FmZSBXQkdUIHRocmVzaG9sZHMuIEZpbGU6IGhvdXJseV9kYXRhLnBhcnF1ZXQuXG4tICoqcG9wdWxhdGlvbioqOiBwb3B1bGF0aW9uIGRhdGEgYnkgYWRtaW4gbGV2ZWxzXG4gIC0gcG9wdWxhdGlvbi9wb3B1bGF0aW9uX2xvbmcucGFycXVldGA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE0MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRiID0ge1xuICByZXR1cm4gRHVja0RCQ2xpZW50Lm9mKHtcbiAgICBwb3B1bGF0aW9uOiBGaWxlQXR0YWNobWVudChcInBvcHVsYXRpb25fbG9uZy5wYXJxdWV0XCIpLFxuICAgIHZvcF9oYTogRmlsZUF0dGFjaG1lbnQoXCJleHBvc3VyZV9hZG1fc3VtLnBhcnF1ZXRcIiksXG4gICAgYWdfd29ya2ZvcmNlX2RhdGE6IEZpbGVBdHRhY2htZW50KFwiYmFzZWxpbmVfZGZfZGF0YUAxNi5wYXJxdWV0XCIpLFxuICAgIGhlYXRfc3RyZXNzX2RhdGE6IEZpbGVBdHRhY2htZW50KFwiaGVhdF9zdHJlc3NfZGF0YUA3LnBhcnF1ZXRcIiksXG4gICAgaG91cmx5X2RhdGE6IEZpbGVBdHRhY2htZW50KFwiaG91cmx5X2RhdGFAMjAucGFycXVldFwiKSxcbiAgfSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE0MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYCMjIyBHZW9ncmFwaGljIGRhdGFcbkdlbyBmaWxlcyB3ZXJlIGNvbnZlcnRlZCB0byBUb3BvSlNPTiBhbmQgcmVkdWNlZCBpbiBjb21wbGV4aXR5IGJlZm9yZSB1cGxvYWRpbmcgdG8gdGhlIG5vdGVib29rLCBzZWUgW1NpbXBsaWZ5IGxhcmdlIHNwYXRpYWwgZmlsZXNdKGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9kLzI1OGM2OGVlOTY5ZThlZDU/Y29sbGVjdGlvbj1AcGVyaXNjb3BpYy9hYi1hdGxhcykgbm90ZWJvb2sgZm9yIG1ldGhvZC5cbi0gKiphZG1pbjAqKjogYnJvYWRlc3QgbGV2ZWwsIGNvdW50cnkgYm91bmRhcmllc1xuICAtIGJvdW5kYXJpZXMvYXRsYXMtcmVnaW9uX2FkbWluMF9oYXJtb25pemVkLmdlb2pzb25cbi0gKiphZG1pbjEqKjogb25lIGxldmVsIGRvd24gZnJvbSBhZG1pbjAsIHJlZ2lvbnMgd2l0aGluIGVhY2ggYWRtaW4wIHJlZ2lvblxuICAtIGJvdW5kYXJpZXMvYXRsYXMtcmVnaW9uX2FkbWluMV9oYXJtb25pemVkLmdlb2pzb25cbi0gKiphZG1pbjIqKjogbG93ZXN0IGxldmVsLCBzdWJyZWdpb25zIG9mIGV2ZXJ5IGFkbWluMSByZWdpb25cbiAgLSBib3VuZGFyaWVzL2F0bGFzLXJlZ2lvbl9hZG1pbjJfaGFybW9uaXplZC5nZW9qc29uYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYm91bmRhcmllcyA9IHtcbiAgY29uc3QgaW5wdXQwID0gYXdhaXQgRmlsZUF0dGFjaG1lbnQoXCJhdGxhcy1yZWdpb25fYWRtaW4wX2hhcm1vbml6ZWQuanNvblwiKS5qc29uKClcbiAgY29uc3QgaW5wdXQxID0gYXdhaXQgRmlsZUF0dGFjaG1lbnQoXCJhdGxhcy1yZWdpb25fYWRtaW4xX2hhcm1vbml6ZWRWMkAxLmpzb25cIikuanNvbigpXG4gIGNvbnN0IGlucHV0MiA9IGF3YWl0IEZpbGVBdHRhY2htZW50KFwiYXRsYXMtcmVnaW9uX2FkbWluMl9oYXJtb25pemVkVjIuanNvblwiKS5qc29uKClcblxuICBjb25zdCBnZW8gPSB7XG4gICAgYWRtaW4wOiB0b3BvanNvbi5mZWF0dXJlKGlucHV0MCwgaW5wdXQwLm9iamVjdHNbXCJhdGxhcy1yZWdpb25fYWRtaW4wX2hhcm1vbml6ZWRcIl0pLFxuICAgIGFkbWluMTogdG9wb2pzb24uZmVhdHVyZShpbnB1dDEsIGlucHV0MS5vYmplY3RzW1wiYXRsYXMtcmVnaW9uX2FkbWluMV9oYXJtb25pemVkVjJcIl0pLFxuICAgIGFkbWluMjogdG9wb2pzb24uZmVhdHVyZShpbnB1dDIsIGlucHV0Mi5vYmplY3RzW1wiYXRsYXMtcmVnaW9uX2FkbWluMl9oYXJtb25pemVkVjJcIl0pLFxuICB9XG4gIHJldHVybiBnZW9cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQ0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgUmlzayBkYXRhIGdyb3VwaW5nXG4qTG9va3VwcyBmb3IgcmlzayBkYXRhIGJpbm5pbmcsIHN1Y2ggYXMgaGF6YXJkcyBhbmQgY3JvcCB0eXBlcypgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNDUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBsb29rdXAgZm9yIHJpc2sgZGF0YSB0eXBlIGdyb3VwaW5nc1xuLy8gdXNlZCBieSBpbnB1dHMgYW5kIGZvciBncm91cGluZyB1cCBkYXRhXG5yaXNrRGF0YVR5cGVzID0gbmV3IE9iamVjdCh7XG4gIGNyb3A6IHtcbiAgICBjcm9wOiBbXG4gICAgICBcIjEwXCIsXG4gICAgICBcIjE1XCIsXG4gICAgICBcIjIwXCIsXG4gICAgICBcIjI1XCIsXG4gICAgICBcIjMwXCIsXG4gICAgICBcIjM1XCIsXG4gICAgICBcIjQwXCIsXG4gICAgICBcIjQ1XCIsXG4gICAgICBcIjUwXCIsXG4gICAgICBcIjU1XCIsXG4gICAgICBcIjYwXCIsXG4gICAgICBcIjY1XCIsXG4gICAgICBcIjcwXCIsXG4gICAgICBcIjc1XCIsXG4gICAgICBcIjgwXCIsXG4gICAgICBcIjg1XCIsXG4gICAgICBcIjkwXCIsXG4gICAgICBcIjk1XCIsXG4gICAgXSxcbiAgICBsaXZlc3RvY2s6IFtcbiAgICAgIFwiY2F0dGxlX2hpZ2hsYW5kXCIsXG4gICAgICBcImNhdHRsZV90cm9waWNhbFwiLFxuICAgICAgXCJnb2F0c19oaWdobGFuZFwiLFxuICAgICAgXCJnb2F0c190cm9waWNhbFwiLFxuICAgICAgXCJwaWdzX2hpZ2hsYW5kXCIsXG4gICAgICBcInBpZ3NfdHJvcGljYWxcIixcbiAgICAgIFwicG91bHRyeV9oaWdobGFuZFwiLFxuICAgICAgXCJwb3VsdHJ5X3Ryb3BpY2FsXCIsXG4gICAgICBcInNoZWVwX2hpZ2hsYW5kXCIsXG4gICAgICBcInNoZWVwX3Ryb3BpY2FsXCIsXG4gICAgXSxcbiAgfSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNDYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBsb29rdXAgZm9yIGhvdXJseSBkYXRhIHR5cGUgZ3JvdXBpbmdzXG4vLyB1c2VkIGJ5IGlucHV0cyBhbmQgZm9yIGdyb3VwaW5nIHVwIGRhdGFcbmhvdXJseURhdGFUeXBlcyA9IG5ldyBPYmplY3Qoe1xuICBob3VyX2RheToge1xuICAgIGhvdXJfZGF5OiBbXG4gICAgICAwLCAxLCAyLCAzLCA0LCA1LCA2LCA3LCA4LCA5LCAxMCwgMTEsIDEyLCAxMywgMTQsIDE1LCAxNiwgMTcsIDE4LCAxOSwgMjAsXG4gICAgICAyMSwgMjIsIDIzLFxuICAgIF0sXG4gIH0sXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQ3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgRHluYW1pYyBpbnNpZ2h0c1xuKmZ1bmN0aW9ucyBmb3IgZm9ybWF0dGluZyByZXN1bHRzKmA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE0OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGZpbHRlckJ5QWRtaW5OYW1lcyhkYXRhKSB7XG4gIC8vIGZpbHRlciBkb3duIGRhdGEgYnkgY29tYmluZWQgc2VsZWN0ZWQgYWRtaW4wL2FkbWluMS9hZG1pbjIgQWRtaW4gU2VsZWN0aW9uc1xuICAvLyBwYXNzIGRhdGEgZnJvbSBxdWVyeSwgdXNlIHRpZHlqcyB0byBmaWx0ZXIgYnkgYWRtaW4gc2VsZWN0aW9uXG4gIGNvbnN0IHJlc3VsdCA9IFQudGlkeShcbiAgICBkYXRhLFxuICAgIFQuZmlsdGVyKChkKSA9PiB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICBkLmFkbWluMF9uYW1lID09IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWUgJiZcbiAgICAgICAgZC5hZG1pbjFfbmFtZSA9PSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlICYmXG4gICAgICAgIGQuYWRtaW4yX25hbWUgPT0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMi52YWx1ZVxuICAgICAgKTtcbiAgICB9KSxcbiAgKTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQ5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gd3JhcHBlciBmb3IgZm9ybWF0IGZ1bmN0aW9ucywgc2hvdyBjaG9zZW4gZGVmYXVsdFxuZnVuY3Rpb24gZm9ybWF0V2l0aERlZmF1bHQoe1xuICB2YWx1ZSA9IDEwMDAsXG4gIGZvcm1hdCA9IChkKSA9PiBkLFxuICBkZWZhdWx0VmFsdWUgPSBcIi0tLVwiLFxuICBkZWJ1ZyA9IGZhbHNlLFxufSA9IHt9KSB7XG4gIC8vIGFwcGx5IGEgZm9ybWF0dGluZyBmdW5jdGlvbiB0byBhIHZhbHVlXG4gIC8vIHJldHVybiBkZWZhdWx0IHZhbHVlIGlmIHVuZGVmaW5lZCBvciBudWxsXG4gIGlmICghKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpKSB7XG4gICAgcmV0dXJuIGZvcm1hdCh2YWx1ZSk7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuIGRlZmF1bHRWYWx1ZTtcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBEYXRhIGZ1bmN0aW9uczogZm9ybWF0IGFuZCB0cmFuc2Zvcm1cbiphcHBseSBmb3JtYXR0aW5nIHRvL3RyYW5zZm9ybSBhIHZhbHVlKlxuXG4tIFJlZmVyZW5jZTogW0ludGwuTnVtYmVyRm9ybWF0KCldKGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0phdmFTY3JpcHQvUmVmZXJlbmNlL0dsb2JhbF9PYmplY3RzL0ludGwvTnVtYmVyRm9ybWF0L051bWJlckZvcm1hdClgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAqKlRyYW5zZm9ybXMqKmA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE1MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHRyYW5zZm9ybSBub24tbnVtYmVyIHRvIHBlcmNlbnQgdmFsdWVcbnRyYW5zZm9ybVBlcmNlbnQgPSAoZCkgPT4ge1xuICBpZiAoZCA9PT0gdW5kZWZpbmVkIHx8IGQgPT09IG51bGwpIHJldHVybiBkO1xuICBlbHNlIHJldHVybiBkICogMTAwO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgKipGb3JtYXR0aW5nKipgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBmb3JtYXQgbm9uLW51bWJlciBhcyBwZXJjZW50XG5mb3JtYXRQZXJjZW50VGVudGggPSAoZCkgPT4ge1xuICBpZiAoZCA9PT0gdW5kZWZpbmVkIHx8IGQgPT09IG51bGwpIHJldHVybiBkO1xuICBlbHNlIHJldHVybiBkMy5mb3JtYXQoXCIuMSVcIikoZCk7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBmb3JtYXQgbm9uLW51bWJlciBhcyBwZXJjZW50XG5mb3JtYXRQZXJjZW50V2hvbGUgPSAoZCkgPT4ge1xuICBpZiAoZCA9PT0gdW5kZWZpbmVkIHx8IGQgPT09IG51bGwpIHJldHVybiBkO1xuICBlbHNlIHJldHVybiBkMy5mb3JtYXQoXCIuMCVcIikoZCk7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBmb3JtYXQgVVMgY3VycmVuY3lcbmZvcm1hdFVTRCA9IG5ldyBJbnRsLk51bWJlckZvcm1hdChcImVuLVVTXCIsIHtcbiAgbm90YXRpb246IFwiY29tcGFjdFwiLFxuICBjb21wYWN0RGlzcGxheTogXCJzaG9ydFwiLFxuICBzdHlsZTogXCJjdXJyZW5jeVwiLFxuICBjdXJyZW5jeTogXCJ1c2RcIixcbn0pLmZvcm1hdDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTU3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZm9ybWF0IG51bWJlciwgbG9uZyBub3RhdGlvblxuZm9ybWF0TnVtQ29tcGFjdExvbmcgPSAoeyBsb2NhbGUgPSBcImVuLVVTXCIgfSA9IHt9KSA9PlxuICBuZXcgSW50bC5OdW1iZXJGb3JtYXQobG9jYWxlLCB7XG4gICAgbm90YXRpb246IFwiY29tcGFjdFwiLFxuICAgIGNvbXBhY3REaXNwbGF5OiBcImxvbmdcIixcbiAgICB1bml0RGlzcGxheTogXCJsb25nXCIsXG4gIH0pLmZvcm1hdDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTU4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZm9ybWF0IG51bWJlciwgc2hvcnQgbm90YXRpb25cbmZvcm1hdE51bUNvbXBhY3RTaG9ydCA9ICh7IGxvY2FsZSA9IFwiZW4tVVNcIiB9ID0ge30pID0+XG4gIG5ldyBJbnRsLk51bWJlckZvcm1hdChsb2NhbGUsIHtcbiAgICBub3RhdGlvbjogXCJjb21wYWN0XCIsXG4gICAgY29tcGFjdERpc3BsYXk6IFwic2hvcnRcIixcbiAgfSkuZm9ybWF0O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBRdWVyeWluZyBkYXRhXG4qZnVuY3Rpb25zIGZvciBxdWVyeWluZyBkYXRhKmA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGdldFVuaXF1ZVZhbHVlcyhjb2wsIHRibCwgZGIpIHtcbiAgLy8gcmV0dXJuIHVuaXF1ZSB2YWx1ZXMgb2YgZnJvbSBkYiB0YmwgYXMgYSBsaXN0XG4gIHJldHVybiBkYlxuICAgIC5xdWVyeShgc2VsZWN0IGRpc3RpbmN0ICR7Y29sfSBmcm9tICR7dGJsfWApXG4gICAgLnRoZW4oKHgpID0+IHgubWFwKChkKSA9PiBkW2NvbF0pKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTYxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gYmluZFRhYnVsYXJUb0dlbyh7XG4gIGRhdGEgPSBbXSxcbiAgZGF0YUJpbmRDb2x1bW4gPSBcImRhdGFCaW5kQ29sdW1uXCIsXG4gIGdlb0RhdGEgPSBbXSxcbiAgZ2VvRGF0YUJpbmRDb2x1bW4gPSBcImdlb0RhdGFCaW5kQ29sdW1uXCIsXG59KSB7XG4gIC8vIGJpbmQgZGF0YSB0byBnZW9qc29uXG4gIGNvbnN0IGluZGV4ID0gbmV3IE1hcChkYXRhLm1hcCgoZCkgPT4gW2RbZGF0YUJpbmRDb2x1bW5dLCBkXSkpOyAvLyBtYXAgZGF0YSBieSBkYXRhQmluZENvbHVtblxuICBjb25zdCBnZW9qc29uID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShnZW9EYXRhKSk7IC8vIGRvIGEgY29weSwgcmF0aGVyIHRoYW4gbXV0YXRlXG4gIC8vIGpvaW4gdXAgZGF0YSB0byBnZW9qc29uXG4gIGZvciAoY29uc3QgZiBvZiBnZW9qc29uLmZlYXR1cmVzKSB7XG4gICAgZi5wcm9wZXJ0aWVzLmRhdGEgPSBpbmRleC5nZXQoZi5wcm9wZXJ0aWVzW2dlb0RhdGFCaW5kQ29sdW1uXSk7XG4gIH1cbiAgcmV0dXJuIGdlb2pzb247XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYCoqKlxuIyMgSW1wb3J0c1xuKkV4dGVybmFsIGltcG9ydHMqYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTYzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW1wb3J0IHsgVCB9IGZyb20gXCJAcGJlc2hhaS90aWR5anNcIjtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTY0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic2VsZWN0R2VvRGF0YVR5cGU7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3ByZXR0eUxhbmd1YWdlVmlldycpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzZWxlY3RHZW9EYXRhVHlwZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZScpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzZWxlY3RUaHJlc2hvbGQnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUyJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdFRocmVzaG9sZDInKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgncmFkaW9zJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2xhbmd1YWdlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdEFkbWluMCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzZWxlY3RBZG1pbjEnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0QWRtaW4yJykifV19</script><script type="module">"file:"===window.location.protocol&&alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."),window._ojs.paths.runtimeToDoc="../../notebooks/heatstressProducers",window._ojs.paths.runtimeToRoot="../..",window._ojs.paths.docToRoot="../..",window._ojs.selfContained=!1,window._ojs.runtime.interpretFromScriptTags()</script><script id="quarto-html-after-body" type="application/javascript">window.document.addEventListener("DOMContentLoaded",function(t){const e=t=>{for(const e of t.classList)if(e.startsWith("code-annotation-"))return!0;return!1},n=function(t){const e=t.trigger;e.blur(),e.classList.add("code-copy-button-checked");var n=e.getAttribute("title");let o;e.setAttribute("title","Copied!"),window.bootstrap&&(e.setAttribute("data-bs-toggle","tooltip"),e.setAttribute("data-bs-placement","left"),e.setAttribute("data-bs-title","Copied!"),o=new bootstrap.Tooltip(e,{trigger:"manual",customClass:"code-copy-button-tooltip",offset:[0,-8]}),o.show()),setTimeout(function(){o&&(o.hide(),e.removeAttribute("data-bs-title"),e.removeAttribute("data-bs-toggle"),e.removeAttribute("data-bs-placement")),e.setAttribute("title",n),e.classList.remove("code-copy-button-checked")},1e3),t.clearSelection()},o=function(t){const n=t.parentElement.cloneNode(!0).querySelector("code");for(const t of n.children)e(t)&&t.remove();return n.innerText};if(new window.ClipboardJS(".code-copy-button:not([data-in-quarto-modal])",{text:o}).on("success",n),window.document.getElementById("quarto-embedded-source-code-modal")){new window.ClipboardJS(".code-copy-button[data-in-quarto-modal]",{text:o,container:window.document.getElementById("quarto-embedded-source-code-modal")}).on("success",n)}for(var i=new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//),a=new RegExp(/^mailto:/),l=new RegExp("https://adaptationatlas.github.io/atlas_notebooks/"),r=t=>l.test(t)||i.test(t)||a.test(t),d=window.document.querySelectorAll("a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"),c=0;c<d.length;c++){const t=d[c];r(t.href)||void 0!==t.dataset.originalHref&&(t.href=t.dataset.originalHref)}function s(t,e,n,o){const i={allowHTML:!0,maxWidth:500,delay:100,arrow:!1,appendTo:function(t){return t.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"bottom-start"};e&&(i.content=e),n&&(i.onTrigger=n),o&&(i.onUntrigger=o),window.tippy(t,i)}const u=window.document.querySelectorAll('a[role="doc-noteref"]');for(c=0;c<u.length;c++){const t=u[c];s(t,function(){let e=t.getAttribute("data-footnote-href")||t.getAttribute("href");try{e=new URL(e).hash}catch{}const n=e.replace(/^#\/?/,""),o=window.document.getElementById(n);return o?o.innerHTML:""})}const h=window.document.querySelectorAll("a.quarto-xref"),m=(t,e)=>{const n=t=>{if(t.classList.remove("page-full","page-columns"),t.children)for(const e of t.children)n(e)};if(n(e),null===t||t.startsWith("sec-")){const t=document.createElement("div");if(e.children&&e.children.length>2){t.appendChild(e.children[0].cloneNode(!0));for(let n=1;n<e.children.length;n++){const o=e.children[n];if("P"!==o.tagName||""!==o.innerText){t.appendChild(o.cloneNode(!0));break}}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.innerHTML}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.innerHTML}{const t=e.querySelector("a.anchorjs-link");return t&&t.remove(),window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.classList.contains("callout")?e.outerHTML:e.innerHTML}};for(c=0;c<h.length;c++){const t=h[c];s(t,void 0,function(e){e.disable();let n,o=t.getAttribute("href");if(o.startsWith("#"))n=o;else try{n=new URL(o).hash}catch{}if(n){const t=n.replace(/^#\/?/,""),i=window.document.getElementById(t);if(null!==i)try{const n=m(t,i.cloneNode(!0));e.setContent(n)}finally{e.enable(),e.show()}else fetch(o.split("#")[0]).then(t=>t.text()).then(n=>{const o=(new DOMParser).parseFromString(n,"text/html").getElementById(t);if(null!==o){const n=m(t,o);e.setContent(n)}}).finally(()=>{e.enable(),e.show()})}else fetch(o).then(t=>t.text()).then(t=>{const n=(new DOMParser).parseFromString(t,"text/html").querySelector("main.content");if(null!==n){n.children.length>0&&"HEADER"===n.children[0].tagName&&n.children[0].remove();const t=m(null,n);e.setContent(t)}}).finally(()=>{e.enable(),e.show()})},function(t){})}let w;const g=t=>{window.document;const e=t.getAttribute("data-target-cell"),n=t.getAttribute("data-target-annotation");const o=window.document.querySelector('span[data-code-cell="'+e+'"][data-code-annotation="'+n+'"]').getAttribute("data-code-lines").split(",").map(t=>e+"-"+t);let i=null,a=null,l=null;if(o.length>0){const n=window.document.getElementById(o[0]);if(i=n.offsetTop,a=n.offsetHeight,l=n.parentElement.parentElement,o.length>1){const t=window.document.getElementById(o[o.length-1]);a=t.offsetTop+t.offsetHeight-i}if(null!==i&&null!==a&&null!==l){let t=window.document.getElementById("code-annotation-line-highlight");null===t&&(t=window.document.createElement("div"),t.setAttribute("id","code-annotation-line-highlight"),t.style.position="absolute",l.appendChild(t)),t.style.top=i-2+"px",t.style.height=a+4+"px",t.style.left=0;let n=window.document.getElementById("code-annotation-line-highlight-gutter");if(null===n){n=window.document.createElement("div"),n.setAttribute("id","code-annotation-line-highlight-gutter"),n.style.position="absolute";window.document.getElementById(e).querySelector(".code-annotation-gutter").appendChild(n)}n.style.top=i-2+"px",n.style.height=a+4+"px"}w=t}},p=()=>{["code-annotation-line-highlight","code-annotation-line-highlight-gutter"].forEach(t=>{const e=window.document.getElementById(t);e&&e.remove()}),w=void 0};window.addEventListener("resize",function(t,e){let n,o=!1;return(...i)=>{o?(n&&clearTimeout(n),n=setTimeout(()=>{t.apply(this,i),n=o=!1},e)):(t.apply(this,i),o=!0)}}(()=>{elRect=void 0,w&&g(w)},10));const f=window.document.querySelectorAll("dt[data-target-cell]");for(const t of f)t.addEventListener("click",t=>{const e=t.target;if(e!==w){p();const t=window.document.querySelector("dt[data-target-cell].code-annotation-active");t&&t.classList.remove("code-annotation-active"),g(e),e.classList.add("code-annotation-active")}else p(),e.classList.remove("code-annotation-active")});const b=t=>{const e=t.parentElement;if(e){const n=e.dataset.cites;return n?{el:t,cites:n.split(" ")}:b(t.parentElement)}};var y=window.document.querySelectorAll('a[role="doc-biblioref"]');for(c=0;c<y.length;c++){const t=y[c],e=b(t);e&&s(e.el,function(){var t=window.document.createElement("div");return e.cites.forEach(function(e){var n=window.document.createElement("div");n.classList.add("hanging-indent"),n.classList.add("csl-entry");var o=window.document.getElementById("ref-"+e);o&&(n.innerHTML=o.innerHTML),t.appendChild(n)}),t.innerHTML})}})</script></div></body></html>