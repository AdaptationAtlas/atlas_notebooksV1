<!doctype html><html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head><meta charset="utf-8"><meta name="generator" content="quarto-1.8.26"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=yes"><title>notebook</title><style>code{white-space:pre-wrap}span.smallcaps{font-variant:small-caps}div.columns{display:flex;gap:min(4vw,1.5em)}div.column{flex:auto;overflow-x:auto}div.hanging-indent{margin-left:1.5em;text-indent:-1.5em}ul.task-list{list-style:none}ul.task-list li input[type=checkbox]{width:.8em;margin:0 .8em .2em -1em;vertical-align:middle}html{-webkit-text-size-adjust:100%}pre>code.sourceCode{white-space:pre;position:relative}pre>code.sourceCode>span{display:inline-block;line-height:1.25}pre>code.sourceCode>span:empty{height:1.2em}.sourceCode{overflow:visible}code.sourceCode>span{color:inherit;text-decoration:inherit}div.sourceCode{margin:1em 0}pre.sourceCode{margin:0}@media screen{div.sourceCode{overflow:auto}}@media print{pre>code.sourceCode{white-space:pre-wrap}pre>code.sourceCode>span{text-indent:-5em;padding-left:5em}}pre.numberSource code{counter-reset:source-line 0}pre.numberSource code>span{position:relative;left:-4em;counter-increment:source-line}pre.numberSource code>span>a:first-child::before{content:counter(source-line);position:relative;left:-1em;text-align:right;vertical-align:baseline;border:none;display:inline-block;-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;padding:0 4px;width:4em}pre.numberSource{margin-left:3em;padding-left:4px}@media screen{pre>code.sourceCode>span>a:first-child::before{text-decoration:underline}}</style><script src="../../site_libs/quarto-nav/quarto-nav.js"></script><script src="../../site_libs/quarto-nav/headroom.min.js"></script><link href="../../images/atlas-icon.svg" rel="icon" type="image/svg+xml"><script src="../../site_libs/clipboard/clipboard.min.js"></script><script src="../../site_libs/quarto-html/quarto.js" type="module"></script><script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script><script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script><script src="../../site_libs/quarto-html/popper.min.js"></script><script src="../../site_libs/quarto-html/tippy.umd.min.js"></script><link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet"><link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><script src="../../site_libs/bootstrap/bootstrap.min.js"></script><link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet"><link href="../../site_libs/bootstrap/bootstrap-730ea3c3007e3756c9d7af36786c00c3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans&amp;display=swap" rel="stylesheet"><script type="module" src="../../site_libs/quarto-ojs/quarto-ojs-runtime.js"></script><link href="../../site_libs/quarto-ojs/quarto-ojs.css" rel="stylesheet"><link rel="stylesheet" href="../../styles.css"></head><body class="nav-fixed fullcontent quarto-light"><div id="quarto-search-results"></div><header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg" data-bs-theme="dark"><div class="navbar-container container-fluid"><div class="navbar-brand-container mx-auto"><a href="https://adaptationatlas.cgiar.org" class="navbar-brand navbar-brand-logo"><img src="../../images/atlas-logo.svg" alt="The Africa Agriculture Adaptation Atlas" class="navbar-logo light-content"> <img src="../../images/atlas-logo.svg" alt="The Africa Agriculture Adaptation Atlas" class="navbar-logo dark-content"></a></div><button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="window.quartoToggleHeadroom&&window.quartoToggleHeadroom()"><span class="navbar-toggler-icon"></span></button><div class="collapse navbar-collapse" id="navbarCollapse"><ul class="navbar-nav navbar-nav-scroll ms-auto"><li class="nav-item"><a class="nav-link" href="../../docs/doc_index.html"><i class="bi bi-info-circle" role="img" aria-label="More Information"></i> <span class="menu-text">Documentation</span></a></li><li class="nav-item"><a class="nav-link" href="https://github.com/AdaptationAtlas/atlas_notebooks/issues/new"><span class="menu-text">Report an Issue</span></a></li><li class="nav-item compact"><a class="nav-link" href="https://github.com/AdaptationAtlas/atlas_notebooks"><i class="bi bi-github" role="img" aria-label="GitHub"></i> <span class="menu-text"></span></a></li></ul></div><div class="quarto-navbar-tools"></div></div></nav></header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar"><main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block"></header><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb1" data-startfrom="8" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 7"><span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { heroImage } <span class="im">from</span> <span class="st">"/helpers/hero.js"</span><span class="op">;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>hero_url <span class="op">=</span> <span class="st">"./../../images/atRisk.webp"</span><span class="op">;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>hero <span class="op">=</span> <span class="fu">heroImage</span>(notebookTitle<span class="op">,</span> hero_url)<span class="op">;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">html</span><span class="vs">`</span><span class="sc">${</span>hero<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-2" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-3" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-1-4" data-nodetype="expression"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb2" data-startfrom="16" data-source-offset="-0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 15"><span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { atlasTOC } <span class="im">from</span> <span class="st">'/helpers/toc.ojs'</span> </span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> nbText <span class="co">// force wait/reload with nbText to load so headings have correct labels/languages</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">atlasTOC</span>({</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      <span class="dt">heading</span><span class="op">:</span> <span class="vs">`&lt;b&gt;</span><span class="sc">${</span><span class="fu">_lang</span>({<span class="dt">en</span><span class="op">:</span><span class="st">"In this notebook"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span><span class="st">"Dans ce notebook"</span>})<span class="sc">}</span><span class="vs">&lt;/b&gt;`</span><span class="op">,</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>      <span class="dt">skip</span><span class="op">:</span> [notebookTitle<span class="op">,</span> <span class="st">"notebook-title"</span><span class="op">,</span> <span class="st">"Appendix"</span><span class="op">,</span> <span class="st">"source-code"</span>]</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-1" data-nodetype="declaration"></div></div></div><div class="cell-output cell-output-display"><div><div id="ojs-cell-2-2" data-nodetype="expression"></div></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb3" data-startfrom="27" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 26"><span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="co">// pretty view of language toggle</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>viewof prettyLanguageView <span class="op">=</span> {</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">radio</span>(languages<span class="op">,</span> {</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">language</span>)<span class="op">,</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>      <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">label</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>    viewof language</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-3" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb4" data-startfrom="40" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 39"><span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> title <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">header</span>)</span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span>title<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-4" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb5" data-startfrom="47" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 46"><span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">overview</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">opener</span>)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-5" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb6" data-startfrom="54" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 53"><span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">h1</span>)</span>
<span id="cb6-56"><a href="#cb6-56" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb6-57"><a href="#cb6-57" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-6" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb7" data-startfrom="61" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 60"><span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> template <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">opener</span>)</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> items <span class="op">=</span> [</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">'vop_blurb'</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">vopNoteMd</span><span class="op">.</span><span class="at">blurb</span>)}</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> format <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(template<span class="op">,</span> items)</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>format<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-7" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb8" data-startfrom="72" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 71"><span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a><span class="co">// format admin selections</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="co">// bind to appendix inputs, add template to format</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>geoImpactAdminSelectors <span class="op">=</span> {</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelCountry <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">singular</span>)</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelRegion <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">singular</span>)</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelSubregion <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">subregion</span><span class="op">.</span><span class="at">singular</span>)</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>        Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin0<span class="op">,</span> {</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> labelCountry<span class="op">,</span></span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span></span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>        viewof selectAdmin0</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>        Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin1<span class="op">,</span> {</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> labelRegion<span class="op">,</span></span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span></span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>        viewof selectAdmin1</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>        Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin2<span class="op">,</span> {</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> labelSubregion<span class="op">,</span></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span></span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>        })<span class="op">,</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>        viewof selectAdmin2</span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>      <span class="dt">template</span><span class="op">:</span> adminFormTemplate</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-8" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb9" data-startfrom="111" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 110"><span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a><span class="co">// define choices for the data value</span></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>viewof selectGeoDataType <span class="op">=</span> {</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> options <span class="op">=</span> [</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"population"</span><span class="op">,</span> <span class="co">// lookup id for data option</span></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataColumn</span><span class="op">:</span> <span class="st">"rural_pop"</span><span class="op">,</span> <span class="co">// data column</span></span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">ruralPop</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span> <span class="co">// label</span></span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelTip</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">ruralPop</span><span class="op">.</span><span class="at">labelTip</span></span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span> <span class="co">// label for tooltip</span></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLegend</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">ruralPop</span><span class="op">.</span><span class="at">labelLegend</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span> <span class="co">// label for legend</span></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>      <span class="dt">formatFunc</span><span class="op">:</span> <span class="fu">formatNumCompactShort</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})<span class="op">,</span> <span class="co">// formatting function for raw data value</span></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>      <span class="dt">formatFuncLegend</span><span class="op">:</span> <span class="fu">formatNumCompactShort</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})<span class="op">,</span> <span class="co">// formatting function for legend</span></span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorRange</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">range</span><span class="op">.</span><span class="at">yellowGreen</span><span class="op">,</span> <span class="co">// color range</span></span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorUnknown</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">unknown</span> <span class="co">// unknown fill color</span></span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>      <span class="dt">key</span><span class="op">:</span> <span class="st">"vop"</span><span class="op">,</span></span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataColumn</span><span class="op">:</span> <span class="st">"vop_total"</span><span class="op">,</span></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">vop</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelTip</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">vop</span><span class="op">.</span><span class="at">labelTip</span>)<span class="op">,</span></span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labelLegend</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>        <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">vop</span><span class="op">.</span><span class="at">labelLegend</span>)<span class="op">,</span></span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>        [{ <span class="dt">name</span><span class="op">:</span> <span class="st">"unit"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> intDollarUnit }]</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>      <span class="dt">formatFunc</span><span class="op">:</span> <span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})<span class="op">,</span></span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>      <span class="dt">formatFuncLegend</span><span class="op">:</span> <span class="fu">formatUSD</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})<span class="op">,</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorRange</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">range</span><span class="op">.</span><span class="at">yellowGreen</span><span class="op">,</span></span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>      <span class="dt">colorUnknown</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">unknown</span></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">radio</span>(</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>    options<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">key</span><span class="op">.</span><span class="fu">localeCompare</span>(a<span class="op">.</span><span class="at">key</span>))<span class="op">,</span></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>      <span class="dt">width</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>      <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> options<span class="op">.</span><span class="fu">find</span>((t) <span class="kw">=&gt;</span> t<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"vop"</span>)</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-9" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb10" data-startfrom="157" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 156"><span id="cb10-157"><a href="#cb10-157" aria-hidden="true" tabindex="-1"></a>plotChoroplethGeoImpact <span class="op">=</span> {</span>
<span id="cb10-158"><a href="#cb10-158" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> mapDataGeoImpact</span>
<span id="cb10-159"><a href="#cb10-159" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selector <span class="op">=</span> selectGeoDataType</span>
<span id="cb10-160"><a href="#cb10-160" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vopCaption <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">vopNoteMd</span><span class="op">.</span><span class="at">caption</span>)<span class="op">;</span></span>
<span id="cb10-161"><a href="#cb10-161" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> missingDataLabel <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb10-162"><a href="#cb10-162" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">missingMapDataBlurb</span>)<span class="op">,</span></span>
<span id="cb10-163"><a href="#cb10-163" aria-hidden="true" tabindex="-1"></a>    [{<span class="dt">name</span><span class="op">:</span> <span class="st">"data_label"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> selector<span class="op">.</span><span class="at">label</span>}]</span>
<span id="cb10-164"><a href="#cb10-164" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-165"><a href="#cb10-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-166"><a href="#cb10-166" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> plot <span class="op">=</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb10-167"><a href="#cb10-167" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> mapWidth<span class="op">,</span></span>
<span id="cb10-168"><a href="#cb10-168" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">550</span><span class="op">,</span></span>
<span id="cb10-169"><a href="#cb10-169" aria-hidden="true" tabindex="-1"></a>    <span class="dt">caption</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>missingDataLabel<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>vopCaption<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb10-170"><a href="#cb10-170" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> {</span>
<span id="cb10-171"><a href="#cb10-171" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"azimuthal-equal-area"</span><span class="op">,</span></span>
<span id="cb10-172"><a href="#cb10-172" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> data</span>
<span id="cb10-173"><a href="#cb10-173" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb10-174"><a href="#cb10-174" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb10-175"><a href="#cb10-175" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb10-176"><a href="#cb10-176" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">labelLegend</span><span class="op">,</span></span>
<span id="cb10-177"><a href="#cb10-177" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> selector<span class="op">.</span><span class="at">colorRange</span><span class="op">,</span></span>
<span id="cb10-178"><a href="#cb10-178" aria-hidden="true" tabindex="-1"></a>      <span class="dt">unknown</span><span class="op">:</span> selector<span class="op">.</span><span class="at">colorUnknown</span><span class="op">,</span></span>
<span id="cb10-179"><a href="#cb10-179" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> selector<span class="op">.</span><span class="at">formatFuncLegend</span><span class="op">,</span></span>
<span id="cb10-180"><a href="#cb10-180" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb10-181"><a href="#cb10-181" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb10-182"><a href="#cb10-182" aria-hidden="true" tabindex="-1"></a>      <span class="co">// geo data</span></span>
<span id="cb10-183"><a href="#cb10-183" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">geo</span>(data<span class="op">.</span><span class="at">features</span><span class="op">,</span> {</span>
<span id="cb10-184"><a href="#cb10-184" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb10-185"><a href="#cb10-185" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> dataColumn <span class="op">=</span> selector<span class="op">.</span><span class="at">dataColumn</span></span>
<span id="cb10-186"><a href="#cb10-186" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> fillValue <span class="op">=</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span> <span class="op">?</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[dataColumn] <span class="op">:</span> <span class="kw">null</span><span class="op">;</span> <span class="co">// handle missing data</span></span>
<span id="cb10-187"><a href="#cb10-187" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> fillValue</span>
<span id="cb10-188"><a href="#cb10-188" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb10-189"><a href="#cb10-189" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb10-190"><a href="#cb10-190" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb10-191"><a href="#cb10-191" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb10-192"><a href="#cb10-192" aria-hidden="true" tabindex="-1"></a>      <span class="co">// admin2 highlight </span></span>
<span id="cb10-193"><a href="#cb10-193" aria-hidden="true" tabindex="-1"></a>      <span class="co">// if Admin selection includes admin2, highlight section</span></span>
<span id="cb10-194"><a href="#cb10-194" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">geo</span>(adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span> </span>
<span id="cb10-195"><a href="#cb10-195" aria-hidden="true" tabindex="-1"></a>               <span class="op">?</span> data<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin2_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span>)</span>
<span id="cb10-196"><a href="#cb10-196" aria-hidden="true" tabindex="-1"></a>               <span class="op">:</span> []<span class="op">,</span> {</span>
<span id="cb10-197"><a href="#cb10-197" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb10-198"><a href="#cb10-198" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#333"</span><span class="op">,</span></span>
<span id="cb10-199"><a href="#cb10-199" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">1.5</span></span>
<span id="cb10-200"><a href="#cb10-200" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb10-201"><a href="#cb10-201" aria-hidden="true" tabindex="-1"></a>      <span class="co">// geo pointer</span></span>
<span id="cb10-202"><a href="#cb10-202" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">geo</span>(data<span class="op">,</span> Plot<span class="op">.</span><span class="fu">pointer</span>(</span>
<span id="cb10-203"><a href="#cb10-203" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">centroid</span>({</span>
<span id="cb10-204"><a href="#cb10-204" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#333"</span><span class="op">,</span></span>
<span id="cb10-205"><a href="#cb10-205" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">1.5</span><span class="op">,</span></span>
<span id="cb10-206"><a href="#cb10-206" aria-hidden="true" tabindex="-1"></a>      })))<span class="op">,</span></span>
<span id="cb10-207"><a href="#cb10-207" aria-hidden="true" tabindex="-1"></a>      <span class="co">// tooltip</span></span>
<span id="cb10-208"><a href="#cb10-208" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">tip</span>(</span>
<span id="cb10-209"><a href="#cb10-209" aria-hidden="true" tabindex="-1"></a>        data<span class="op">.</span><span class="at">features</span><span class="op">,</span></span>
<span id="cb10-210"><a href="#cb10-210" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointer</span>(</span>
<span id="cb10-211"><a href="#cb10-211" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">centroid</span>({</span>
<span id="cb10-212"><a href="#cb10-212" aria-hidden="true" tabindex="-1"></a>            <span class="dt">channels</span><span class="op">:</span> {</span>
<span id="cb10-213"><a href="#cb10-213" aria-hidden="true" tabindex="-1"></a>              <span class="dt">name</span><span class="op">:</span> {</span>
<span id="cb10-214"><a href="#cb10-214" aria-hidden="true" tabindex="-1"></a>                <span class="co">// region label, based on selection</span></span>
<span id="cb10-215"><a href="#cb10-215" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> <span class="fu">getLowerLevelAdminLabel</span>()<span class="op">,</span> <span class="co">// plot-level so inputs don't reload</span></span>
<span id="cb10-216"><a href="#cb10-216" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb10-217"><a href="#cb10-217" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> translated <span class="op">=</span> <span class="fu">_lang</span>(td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin_name</span>])<span class="op">;</span></span>
<span id="cb10-218"><a href="#cb10-218" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> translated <span class="op">??</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin_name</span></span>
<span id="cb10-219"><a href="#cb10-219" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb10-220"><a href="#cb10-220" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb10-221"><a href="#cb10-221" aria-hidden="true" tabindex="-1"></a>              <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb10-222"><a href="#cb10-222" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">labelTip</span><span class="op">,</span></span>
<span id="cb10-223"><a href="#cb10-223" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb10-224"><a href="#cb10-224" aria-hidden="true" tabindex="-1"></a>                <span class="kw">const</span> dataColumn <span class="op">=</span> selector<span class="op">.</span><span class="at">dataColumn</span></span>
<span id="cb10-225"><a href="#cb10-225" aria-hidden="true" tabindex="-1"></a>                <span class="kw">const</span> data <span class="op">=</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span> <span class="op">?</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[dataColumn] <span class="op">:</span> <span class="kw">undefined</span></span>
<span id="cb10-226"><a href="#cb10-226" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> data</span>
<span id="cb10-227"><a href="#cb10-227" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb10-228"><a href="#cb10-228" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb10-229"><a href="#cb10-229" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb10-230"><a href="#cb10-230" aria-hidden="true" tabindex="-1"></a>            <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb10-231"><a href="#cb10-231" aria-hidden="true" tabindex="-1"></a>              <span class="dt">name</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb10-232"><a href="#cb10-232" aria-hidden="true" tabindex="-1"></a>              <span class="dt">data</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> selector<span class="op">.</span><span class="fu">formatFunc</span>(d)</span>
<span id="cb10-233"><a href="#cb10-233" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb10-234"><a href="#cb10-234" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb10-235"><a href="#cb10-235" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb10-236"><a href="#cb10-236" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb10-237"><a href="#cb10-237" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb10-238"><a href="#cb10-238" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb10-239"><a href="#cb10-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-240"><a href="#cb10-240" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> plot</span>
<span id="cb10-241"><a href="#cb10-241" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-10" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb11" data-startfrom="245" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 244"><span id="cb11-245"><a href="#cb11-245" aria-hidden="true" tabindex="-1"></a><span class="fu">buildInlineDownloadButton</span>(</span>
<span id="cb11-246"><a href="#cb11-246" aria-hidden="true" tabindex="-1"></a>  mapDataGeoImpact<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>)<span class="op">,</span></span>
<span id="cb11-247"><a href="#cb11-247" aria-hidden="true" tabindex="-1"></a>  <span class="fu">_lang</span>(download_translation)<span class="op">,</span></span>
<span id="cb11-248"><a href="#cb11-248" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`</span><span class="sc">${</span>selectGeoDataType<span class="op">.</span><span class="at">key</span><span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb11-249"><a href="#cb11-249" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-11" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb12" data-startfrom="253" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 252"><span id="cb12-253"><a href="#cb12-253" aria-hidden="true" tabindex="-1"></a>headerQuickInsightsGeoImpact <span class="op">=</span> {</span>
<span id="cb12-254"><a href="#cb12-254" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> template <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">title</span>)</span>
<span id="cb12-255"><a href="#cb12-255" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> items <span class="op">=</span> [</span>
<span id="cb12-256"><a href="#cb12-256" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"insight_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">quickInsights</span>)}<span class="op">,</span></span>
<span id="cb12-257"><a href="#cb12-257" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">name</span><span class="op">:</span> <span class="st">"admin_selection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">getAdminSelection</span>()<span class="op">.</span><span class="at">label</span>}<span class="op">,</span></span>
<span id="cb12-258"><a href="#cb12-258" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb12-259"><a href="#cb12-259" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> format <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(template<span class="op">,</span> items)</span>
<span id="cb12-260"><a href="#cb12-260" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`### </span><span class="sc">${</span>format<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb12-261"><a href="#cb12-261" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-12" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb13" data-startfrom="265" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 264"><span id="cb13-265"><a href="#cb13-265" aria-hidden="true" tabindex="-1"></a><span class="co">// text insights for geo impact</span></span>
<span id="cb13-266"><a href="#cb13-266" aria-hidden="true" tabindex="-1"></a>textDynamicInsights_geoImpact <span class="op">=</span> {</span>
<span id="cb13-267"><a href="#cb13-267" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminSelection <span class="op">=</span> <span class="fu">getAdminSelectionLabelWithParen</span>({</span>
<span id="cb13-268"><a href="#cb13-268" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin0Label</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb13-269"><a href="#cb13-269" aria-hidden="true" tabindex="-1"></a>      td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[<span class="fu">getAdminSelectionAdmin0</span>()<span class="op">.</span><span class="at">value</span> <span class="op">??</span> <span class="st">"SSA"</span>][<span class="st">"article3"</span>]</span>
<span id="cb13-270"><a href="#cb13-270" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb13-271"><a href="#cb13-271" aria-hidden="true" tabindex="-1"></a>    <span class="dt">adminSublabel</span><span class="op">:</span> <span class="fu">getAdminSelection</span>()<span class="op">.</span><span class="at">label</span></span>
<span id="cb13-272"><a href="#cb13-272" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb13-273"><a href="#cb13-273" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> i <span class="op">=</span> dynamicInsights_geoImpact<span class="op">.</span><span class="at">insight</span><span class="op">;</span></span>
<span id="cb13-274"><a href="#cb13-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-275"><a href="#cb13-275" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> translateCrop <span class="op">=</span> (crop) <span class="kw">=&gt;</span> <span class="fu">_lang</span>(td<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[crop])<span class="op">;</span></span>
<span id="cb13-276"><a href="#cb13-276" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topCommoditiesFiltered <span class="op">=</span> i<span class="op">.</span><span class="at">topCommodities</span><span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">data</span> <span class="op">!==</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb13-277"><a href="#cb13-277" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topCommoditiesList <span class="op">=</span> topCommoditiesFiltered<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb13-278"><a href="#cb13-278" aria-hidden="true" tabindex="-1"></a>    (d<span class="op">,</span> i) <span class="kw">=&gt;</span></span>
<span id="cb13-279"><a href="#cb13-279" aria-hidden="true" tabindex="-1"></a>      <span class="vs">`</span><span class="sc">${</span></span>
<span id="cb13-280"><a href="#cb13-280" aria-hidden="true" tabindex="-1"></a>        i <span class="op">==</span> topCommoditiesFiltered<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb13-281"><a href="#cb13-281" aria-hidden="true" tabindex="-1"></a>          <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">and</span>)<span class="sc">}</span><span class="vs"> `</span></span>
<span id="cb13-282"><a href="#cb13-282" aria-hidden="true" tabindex="-1"></a>          <span class="op">:</span> <span class="st">""</span></span>
<span id="cb13-283"><a href="#cb13-283" aria-hidden="true" tabindex="-1"></a>      <span class="sc">}</span><span class="vs">**</span><span class="sc">${</span><span class="fu">translateCrop</span>(d<span class="op">.</span><span class="at">label</span>)<span class="sc">}</span><span class="vs">** (**</span><span class="sc">${</span>d<span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">**)`</span></span>
<span id="cb13-284"><a href="#cb13-284" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-285"><a href="#cb13-285" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topLivestockFiltered <span class="op">=</span> i<span class="op">.</span><span class="at">topLivestock</span><span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">data</span> <span class="op">!==</span> <span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb13-286"><a href="#cb13-286" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topLivestockList <span class="op">=</span> topLivestockFiltered<span class="op">.</span><span class="fu">map</span>(</span>
<span id="cb13-287"><a href="#cb13-287" aria-hidden="true" tabindex="-1"></a>    (d<span class="op">,</span> i) <span class="kw">=&gt;</span></span>
<span id="cb13-288"><a href="#cb13-288" aria-hidden="true" tabindex="-1"></a>      <span class="vs">`</span><span class="sc">${</span></span>
<span id="cb13-289"><a href="#cb13-289" aria-hidden="true" tabindex="-1"></a>        i <span class="op">==</span> topLivestockFiltered<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb13-290"><a href="#cb13-290" aria-hidden="true" tabindex="-1"></a>          <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">and</span>)<span class="sc">}</span><span class="vs"> `</span></span>
<span id="cb13-291"><a href="#cb13-291" aria-hidden="true" tabindex="-1"></a>          <span class="op">:</span> <span class="st">""</span></span>
<span id="cb13-292"><a href="#cb13-292" aria-hidden="true" tabindex="-1"></a>      <span class="sc">}</span><span class="vs">**</span><span class="sc">${</span><span class="fu">translateCrop</span>(d<span class="op">.</span><span class="at">label</span>)<span class="sc">}</span><span class="vs">** (**</span><span class="sc">${</span>d<span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">**)`</span></span>
<span id="cb13-293"><a href="#cb13-293" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-294"><a href="#cb13-294" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-295"><a href="#cb13-295" aria-hidden="true" tabindex="-1"></a>  <span class="co">// new code</span></span>
<span id="cb13-296"><a href="#cb13-296" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langBasePath <span class="op">=</span> nbText<span class="op">.</span><span class="at">africaMap</span><span class="op">.</span><span class="at">insights</span><span class="op">;</span></span>
<span id="cb13-297"><a href="#cb13-297" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langOverview <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb13-298"><a href="#cb13-298" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(langBasePath<span class="op">.</span><span class="at">insightOverview</span>)<span class="op">,</span></span>
<span id="cb13-299"><a href="#cb13-299" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb13-300"><a href="#cb13-300" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_selection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> adminSelection }<span class="op">,</span></span>
<span id="cb13-301"><a href="#cb13-301" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"total_vop"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i<span class="op">.</span><span class="at">totalVop</span> }</span>
<span id="cb13-302"><a href="#cb13-302" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb13-303"><a href="#cb13-303" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-304"><a href="#cb13-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-305"><a href="#cb13-305" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langAreaAndPop <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb13-306"><a href="#cb13-306" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(langBasePath<span class="op">.</span><span class="at">insightAreaAndPop</span>)<span class="op">,</span></span>
<span id="cb13-307"><a href="#cb13-307" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb13-308"><a href="#cb13-308" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"area"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i<span class="op">.</span><span class="at">totalHa</span> }<span class="op">,</span></span>
<span id="cb13-309"><a href="#cb13-309" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"population"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> i<span class="op">.</span><span class="at">totalPop</span> }</span>
<span id="cb13-310"><a href="#cb13-310" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb13-311"><a href="#cb13-311" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-312"><a href="#cb13-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-313"><a href="#cb13-313" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langTopCommodity <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb13-314"><a href="#cb13-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(langBasePath<span class="op">.</span><span class="at">insightTopCommodity</span>)<span class="op">,</span></span>
<span id="cb13-315"><a href="#cb13-315" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb13-316"><a href="#cb13-316" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"commodity_word"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="st">"commodities"</span> }<span class="op">,</span></span>
<span id="cb13-317"><a href="#cb13-317" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb13-318"><a href="#cb13-318" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">"verb"</span><span class="op">,</span></span>
<span id="cb13-319"><a href="#cb13-319" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span></span>
<span id="cb13-320"><a href="#cb13-320" aria-hidden="true" tabindex="-1"></a>          topCommoditiesFiltered<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb13-321"><a href="#cb13-321" aria-hidden="true" tabindex="-1"></a>            <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">toBe</span><span class="op">.</span><span class="at">singular</span>)</span>
<span id="cb13-322"><a href="#cb13-322" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">toBe</span><span class="op">.</span><span class="at">plural</span>)</span>
<span id="cb13-323"><a href="#cb13-323" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb13-324"><a href="#cb13-324" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"list_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> topCommoditiesList<span class="op">.</span><span class="fu">join</span>(<span class="st">", "</span>) }</span>
<span id="cb13-325"><a href="#cb13-325" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb13-326"><a href="#cb13-326" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-327"><a href="#cb13-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-328"><a href="#cb13-328" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langTopLivestock <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb13-329"><a href="#cb13-329" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(langBasePath<span class="op">.</span><span class="at">insightTopLivestock</span>)<span class="op">,</span></span>
<span id="cb13-330"><a href="#cb13-330" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb13-331"><a href="#cb13-331" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb13-332"><a href="#cb13-332" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">"verb"</span><span class="op">,</span></span>
<span id="cb13-333"><a href="#cb13-333" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span></span>
<span id="cb13-334"><a href="#cb13-334" aria-hidden="true" tabindex="-1"></a>          topLivestockFiltered<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">1</span></span>
<span id="cb13-335"><a href="#cb13-335" aria-hidden="true" tabindex="-1"></a>            <span class="op">?</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">toBe</span><span class="op">.</span><span class="at">singular</span>)</span>
<span id="cb13-336"><a href="#cb13-336" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">toBe</span><span class="op">.</span><span class="at">plural</span>)</span>
<span id="cb13-337"><a href="#cb13-337" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb13-338"><a href="#cb13-338" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"list_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> topLivestockList<span class="op">.</span><span class="fu">join</span>(<span class="st">", "</span>) }</span>
<span id="cb13-339"><a href="#cb13-339" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb13-340"><a href="#cb13-340" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb13-341"><a href="#cb13-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-342"><a href="#cb13-342" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>langOverview<span class="sc">}</span></span>
<span id="cb13-343"><a href="#cb13-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-344"><a href="#cb13-344" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>langAreaAndPop<span class="sc">}</span></span>
<span id="cb13-345"><a href="#cb13-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-346"><a href="#cb13-346" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>langTopCommodity<span class="sc">}</span></span>
<span id="cb13-347"><a href="#cb13-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-348"><a href="#cb13-348" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>langTopLivestock<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb13-349"><a href="#cb13-349" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-13" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb14" data-startfrom="353" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 352"><span id="cb14-353"><a href="#cb14-353" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb14-354"><a href="#cb14-354" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">intro</span><span class="op">.</span><span class="at">h1</span>)</span>
<span id="cb14-355"><a href="#cb14-355" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb14-356"><a href="#cb14-356" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-14" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb15" data-startfrom="360" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 359"><span id="cb15-360"><a href="#cb15-360" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb15-361"><a href="#cb15-361" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminSelection <span class="op">=</span> <span class="fu">getAdminSelectionLabelWithParen</span>({</span>
<span id="cb15-362"><a href="#cb15-362" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin0Label</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(</span>
<span id="cb15-363"><a href="#cb15-363" aria-hidden="true" tabindex="-1"></a>      <span class="fu">_lang</span>(</span>
<span id="cb15-364"><a href="#cb15-364" aria-hidden="true" tabindex="-1"></a>        td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[<span class="fu">getAdminSelectionAdmin0</span>()<span class="op">.</span><span class="at">value</span> <span class="op">??</span> <span class="st">"SSA"</span>][<span class="st">"article2"</span>]</span>
<span id="cb15-365"><a href="#cb15-365" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb15-366"><a href="#cb15-366" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb15-367"><a href="#cb15-367" aria-hidden="true" tabindex="-1"></a>    <span class="dt">adminSublabel</span><span class="op">:</span> <span class="fu">getAdminSelection</span>()<span class="op">.</span><span class="at">label</span></span>
<span id="cb15-368"><a href="#cb15-368" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb15-369"><a href="#cb15-369" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> format <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb15-370"><a href="#cb15-370" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">intro</span><span class="op">.</span><span class="at">opener</span>)<span class="op">,</span></span>
<span id="cb15-371"><a href="#cb15-371" aria-hidden="true" tabindex="-1"></a>    [{ <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_selection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> adminSelection }]</span>
<span id="cb15-372"><a href="#cb15-372" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb15-373"><a href="#cb15-373" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>format<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb15-374"><a href="#cb15-374" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-15" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb16" data-startfrom="378" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 377"><span id="cb16-378"><a href="#cb16-378" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb16-379"><a href="#cb16-379" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">compoundHazards</span><span class="op">.</span><span class="at">h2</span>)</span>
<span id="cb16-380"><a href="#cb16-380" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`## </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb16-381"><a href="#cb16-381" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-16" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb17" data-startfrom="385" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 384"><span id="cb17-385"><a href="#cb17-385" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-386"><a href="#cb17-386" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb17-387"><a href="#cb17-387" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">compoundHazards</span><span class="op">.</span><span class="at">opener</span>)<span class="op">,</span></span>
<span id="cb17-388"><a href="#cb17-388" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb17-389"><a href="#cb17-389" aria-hidden="true" tabindex="-1"></a>      {<span class="dt">name</span><span class="op">:</span> <span class="st">"vop_note"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">vopNoteMd</span><span class="op">.</span><span class="at">blurb</span>)}<span class="op">,</span></span>
<span id="cb17-390"><a href="#cb17-390" aria-hidden="true" tabindex="-1"></a>      {<span class="dt">name</span><span class="op">:</span> <span class="st">"admin_selection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">getAdminSelection</span>()<span class="op">.</span><span class="at">label</span>}</span>
<span id="cb17-391"><a href="#cb17-391" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb17-392"><a href="#cb17-392" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-393"><a href="#cb17-393" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb17-394"><a href="#cb17-394" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-17" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb18" data-startfrom="398" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 397"><span id="cb18-398"><a href="#cb18-398" aria-hidden="true" tabindex="-1"></a><span class="co">// format admin selections</span></span>
<span id="cb18-399"><a href="#cb18-399" aria-hidden="true" tabindex="-1"></a><span class="co">// bind to appendix inputs, add template to format</span></span>
<span id="cb18-400"><a href="#cb18-400" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb18-401"><a href="#cb18-401" aria-hidden="true" tabindex="-1"></a>  [</span>
<span id="cb18-402"><a href="#cb18-402" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb18-403"><a href="#cb18-403" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin0<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb18-404"><a href="#cb18-404" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin0</span>
<span id="cb18-405"><a href="#cb18-405" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb18-406"><a href="#cb18-406" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb18-407"><a href="#cb18-407" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin1<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb18-408"><a href="#cb18-408" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin1</span>
<span id="cb18-409"><a href="#cb18-409" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb18-410"><a href="#cb18-410" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb18-411"><a href="#cb18-411" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin2<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb18-412"><a href="#cb18-412" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin2</span>
<span id="cb18-413"><a href="#cb18-413" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb18-414"><a href="#cb18-414" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb18-415"><a href="#cb18-415" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb18-416"><a href="#cb18-416" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> adminFormTemplate</span>
<span id="cb18-417"><a href="#cb18-417" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb18-418"><a href="#cb18-418" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-18" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb19" data-startfrom="422" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 421"><span id="cb19-422"><a href="#cb19-422" aria-hidden="true" tabindex="-1"></a>viewof selectScenarioAndTimeframe <span class="op">=</span> {</span>
<span id="cb19-423"><a href="#cb19-423" aria-hidden="true" tabindex="-1"></a>  <span class="co">// scenario and timeframe</span></span>
<span id="cb19-424"><a href="#cb19-424" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-425"><a href="#cb19-425" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> historicLabel <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span><span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">compoundHazards</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">dropdownScenario</span><span class="op">.</span><span class="at">historic</span>)<span class="sc">}</span><span class="vs">: 1995-2014`</span></span>
<span id="cb19-426"><a href="#cb19-426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-427"><a href="#cb19-427" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> [</span>
<span id="cb19-428"><a href="#cb19-428" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> historicLabel<span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'historic'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'historic'</span>}<span class="op">,</span></span>
<span id="cb19-429"><a href="#cb19-429" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'SSP245: 2021-2040'</span><span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'ssp245'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'2021_2040'</span>}<span class="op">,</span></span>
<span id="cb19-430"><a href="#cb19-430" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'SSP245: 2041-2060'</span><span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'ssp245'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'2041_2060'</span>}<span class="op">,</span></span>
<span id="cb19-431"><a href="#cb19-431" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'SSP585: 2021-2040'</span><span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'ssp585'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'2021_2040'</span>}<span class="op">,</span></span>
<span id="cb19-432"><a href="#cb19-432" aria-hidden="true" tabindex="-1"></a>    {<span class="dt">label</span><span class="op">:</span> <span class="st">'SSP585: 2041-2060'</span><span class="op">,</span> <span class="dt">scenario</span><span class="op">:</span> <span class="st">'ssp585'</span><span class="op">,</span> <span class="dt">timeframe</span><span class="op">:</span> <span class="st">'2041_2060'</span>}<span class="op">,</span></span>
<span id="cb19-433"><a href="#cb19-433" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb19-434"><a href="#cb19-434" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-435"><a href="#cb19-435" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(data<span class="op">,</span> {</span>
<span id="cb19-436"><a href="#cb19-436" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">compoundHazards</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">dropdownScenario</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb19-437"><a href="#cb19-437" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb19-438"><a href="#cb19-438" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> data<span class="op">.</span><span class="fu">find</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">timeframe</span> <span class="op">===</span> <span class="st">'historic'</span>)</span>
<span id="cb19-439"><a href="#cb19-439" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb19-440"><a href="#cb19-440" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-19" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb20" data-startfrom="444" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 443"><span id="cb20-444"><a href="#cb20-444" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb20-445"><a href="#cb20-445" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelPerc <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">compoundHazards</span><span class="op">.</span><span class="at">stackedBar</span><span class="op">.</span><span class="at">tooltipLabels</span><span class="op">.</span><span class="at">totalVop</span>)</span>
<span id="cb20-446"><a href="#cb20-446" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelHazard <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">compoundHazards</span><span class="op">.</span><span class="at">stackedBar</span><span class="op">.</span><span class="at">tooltipLabels</span><span class="op">.</span><span class="at">hazard</span>)</span>
<span id="cb20-447"><a href="#cb20-447" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> labelVop <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">compoundHazards</span><span class="op">.</span><span class="at">stackedBar</span><span class="op">.</span><span class="at">tooltipLabels</span><span class="op">.</span><span class="at">vopRisk</span>)</span>
<span id="cb20-448"><a href="#cb20-448" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> xLabel <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">compoundHazards</span><span class="op">.</span><span class="at">stackedBar</span><span class="op">.</span><span class="at">xLabel</span>)</span>
<span id="cb20-449"><a href="#cb20-449" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> marginLeft <span class="op">=</span> <span class="fu">_lang</span>({<span class="dt">en</span><span class="op">:</span> <span class="dv">110</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="dv">150</span>})<span class="op">;</span></span>
<span id="cb20-450"><a href="#cb20-450" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-451"><a href="#cb20-451" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _anyData <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb20-452"><a href="#cb20-452" aria-hidden="true" tabindex="-1"></a>    data_hazardVoP<span class="op">,</span></span>
<span id="cb20-453"><a href="#cb20-453" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> <span class="op">!</span>[<span class="st">"any"</span><span class="op">,</span> <span class="st">"no hazard"</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">hazard</span>))<span class="op">,</span> <span class="co">// only hazard components</span></span>
<span id="cb20-454"><a href="#cb20-454" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb20-455"><a href="#cb20-455" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb20-456"><a href="#cb20-456" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb20-457"><a href="#cb20-457" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb20-458"><a href="#cb20-458" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb20-459"><a href="#cb20-459" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb20-460"><a href="#cb20-460" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb20-461"><a href="#cb20-461" aria-hidden="true" tabindex="-1"></a>        <span class="st">"severity"</span><span class="op">,</span></span>
<span id="cb20-462"><a href="#cb20-462" aria-hidden="true" tabindex="-1"></a>        <span class="st">"crop"</span></span>
<span id="cb20-463"><a href="#cb20-463" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb20-464"><a href="#cb20-464" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb20-465"><a href="#cb20-465" aria-hidden="true" tabindex="-1"></a>        T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb20-466"><a href="#cb20-466" aria-hidden="true" tabindex="-1"></a>          <span class="dt">vop_any</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"vop"</span>)</span>
<span id="cb20-467"><a href="#cb20-467" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb20-468"><a href="#cb20-468" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb20-469"><a href="#cb20-469" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-470"><a href="#cb20-470" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb20-471"><a href="#cb20-471" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-472"><a href="#cb20-472" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _dataWithAnyColumn <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb20-473"><a href="#cb20-473" aria-hidden="true" tabindex="-1"></a>    data_hazardVoP<span class="op">,</span></span>
<span id="cb20-474"><a href="#cb20-474" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">leftJoin</span>(_anyData<span class="op">,</span> {</span>
<span id="cb20-475"><a href="#cb20-475" aria-hidden="true" tabindex="-1"></a>      <span class="dt">by</span><span class="op">:</span> [</span>
<span id="cb20-476"><a href="#cb20-476" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb20-477"><a href="#cb20-477" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb20-478"><a href="#cb20-478" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb20-479"><a href="#cb20-479" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb20-480"><a href="#cb20-480" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb20-481"><a href="#cb20-481" aria-hidden="true" tabindex="-1"></a>        <span class="st">"crop"</span><span class="op">,</span></span>
<span id="cb20-482"><a href="#cb20-482" aria-hidden="true" tabindex="-1"></a>        <span class="st">"severity"</span></span>
<span id="cb20-483"><a href="#cb20-483" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb20-484"><a href="#cb20-484" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-485"><a href="#cb20-485" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb20-486"><a href="#cb20-486" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-487"><a href="#cb20-487" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> _dataWithAnyColumn<span class="op">;</span></span>
<span id="cb20-488"><a href="#cb20-488" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataAny <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> <span class="st">"any"</span>)<span class="op">;</span> <span class="co">// combined</span></span>
<span id="cb20-489"><a href="#cb20-489" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataBars <span class="op">=</span> [</span>
<span id="cb20-490"><a href="#cb20-490" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">!==</span> <span class="st">"any"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">vop</span> <span class="op">!==</span> <span class="dv">0</span>) <span class="co">// remove the combined hazard</span></span>
<span id="cb20-491"><a href="#cb20-491" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb20-492"><a href="#cb20-492" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> yDomain <span class="op">=</span> cropNames</span>
<span id="cb20-493"><a href="#cb20-493" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb20-494"><a href="#cb20-494" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> availableCrops <span class="op">=</span> _<span class="op">.</span><span class="fu">uniq</span>(dataBars<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">crop</span>))<span class="op">;</span></span>
<span id="cb20-495"><a href="#cb20-495" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> availableCrops<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">crop</span>)<span class="op">;</span></span>
<span id="cb20-496"><a href="#cb20-496" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-497"><a href="#cb20-497" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span>b) <span class="kw">=&gt;</span> {</span>
<span id="cb20-498"><a href="#cb20-498" aria-hidden="true" tabindex="-1"></a>      <span class="co">// sort by type, then name</span></span>
<span id="cb20-499"><a href="#cb20-499" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a<span class="op">.</span><span class="at">type</span> <span class="op">&lt;</span> b<span class="op">.</span><span class="at">type</span>) <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb20-500"><a href="#cb20-500" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a<span class="op">.</span><span class="at">type</span> <span class="op">&gt;</span> b<span class="op">.</span><span class="at">type</span>) <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb20-501"><a href="#cb20-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-502"><a href="#cb20-502" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a<span class="op">.</span><span class="at">cropName</span> <span class="op">&lt;</span> b<span class="op">.</span><span class="at">cropName</span>) <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb20-503"><a href="#cb20-503" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (a<span class="op">.</span><span class="at">cropName</span> <span class="op">&gt;</span> b<span class="op">.</span><span class="at">cropName</span>) <span class="cf">return</span> <span class="dv">1</span></span>
<span id="cb20-504"><a href="#cb20-504" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-505"><a href="#cb20-505" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="dv">0</span></span>
<span id="cb20-506"><a href="#cb20-506" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb20-507"><a href="#cb20-507" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cropName</span>)<span class="op">;</span></span>
<span id="cb20-508"><a href="#cb20-508" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vopCaption <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">vopNoteMd</span><span class="op">.</span><span class="at">caption</span>)<span class="op">;</span></span>
<span id="cb20-509"><a href="#cb20-509" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-510"><a href="#cb20-510" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb20-511"><a href="#cb20-511" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">1200</span><span class="op">,</span></span>
<span id="cb20-512"><a href="#cb20-512" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">850</span><span class="op">,</span></span>
<span id="cb20-513"><a href="#cb20-513" aria-hidden="true" tabindex="-1"></a>    marginLeft<span class="op">,</span></span>
<span id="cb20-514"><a href="#cb20-514" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginRight</span><span class="op">:</span> <span class="dv">85</span><span class="op">,</span></span>
<span id="cb20-515"><a href="#cb20-515" aria-hidden="true" tabindex="-1"></a>    <span class="dt">caption</span><span class="op">:</span> vopCaption<span class="op">,</span></span>
<span id="cb20-516"><a href="#cb20-516" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb20-517"><a href="#cb20-517" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span><span class="op">,</span></span>
<span id="cb20-518"><a href="#cb20-518" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">range</span><span class="op">,</span></span>
<span id="cb20-519"><a href="#cb20-519" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb20-520"><a href="#cb20-520" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb20-521"><a href="#cb20-521" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb20-522"><a href="#cb20-522" aria-hidden="true" tabindex="-1"></a>      <span class="dt">ticks</span><span class="op">:</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb20-523"><a href="#cb20-523" aria-hidden="true" tabindex="-1"></a>      <span class="dt">axis</span><span class="op">:</span> <span class="st">"top"</span><span class="op">,</span></span>
<span id="cb20-524"><a href="#cb20-524" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">100</span>]<span class="op">,</span></span>
<span id="cb20-525"><a href="#cb20-525" aria-hidden="true" tabindex="-1"></a>      <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-526"><a href="#cb20-526" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> xLabel</span>
<span id="cb20-527"><a href="#cb20-527" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb20-528"><a href="#cb20-528" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb20-529"><a href="#cb20-529" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> yDomain<span class="op">,</span></span>
<span id="cb20-530"><a href="#cb20-530" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span></span>
<span id="cb20-531"><a href="#cb20-531" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb20-532"><a href="#cb20-532" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb20-533"><a href="#cb20-533" aria-hidden="true" tabindex="-1"></a>      <span class="co">// main y-axis</span></span>
<span id="cb20-534"><a href="#cb20-534" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisY</span>({</span>
<span id="cb20-535"><a href="#cb20-535" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb20-536"><a href="#cb20-536" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb20-537"><a href="#cb20-537" aria-hidden="true" tabindex="-1"></a>      <span class="co">// pointer white-out</span></span>
<span id="cb20-538"><a href="#cb20-538" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisY</span>(</span>
<span id="cb20-539"><a href="#cb20-539" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerY</span>({</span>
<span id="cb20-540"><a href="#cb20-540" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb20-541"><a href="#cb20-541" aria-hidden="true" tabindex="-1"></a>          <span class="dt">textStroke</span><span class="op">:</span> <span class="st">"white"</span><span class="op">,</span></span>
<span id="cb20-542"><a href="#cb20-542" aria-hidden="true" tabindex="-1"></a>          <span class="dt">textStrokeWidth</span><span class="op">:</span> <span class="dv">2</span><span class="op">,</span></span>
<span id="cb20-543"><a href="#cb20-543" aria-hidden="true" tabindex="-1"></a>          <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb20-544"><a href="#cb20-544" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb20-545"><a href="#cb20-545" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb20-546"><a href="#cb20-546" aria-hidden="true" tabindex="-1"></a>      <span class="co">// bold pointer</span></span>
<span id="cb20-547"><a href="#cb20-547" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">axisY</span>(</span>
<span id="cb20-548"><a href="#cb20-548" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerY</span>({</span>
<span id="cb20-549"><a href="#cb20-549" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fontWeight</span><span class="op">:</span> <span class="st">"bold"</span><span class="op">,</span></span>
<span id="cb20-550"><a href="#cb20-550" aria-hidden="true" tabindex="-1"></a>          <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span></span>
<span id="cb20-551"><a href="#cb20-551" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb20-552"><a href="#cb20-552" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb20-553"><a href="#cb20-553" aria-hidden="true" tabindex="-1"></a>      <span class="co">// hazard component bars</span></span>
<span id="cb20-554"><a href="#cb20-554" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barX</span>(</span>
<span id="cb20-555"><a href="#cb20-555" aria-hidden="true" tabindex="-1"></a>        dataBars<span class="op">,</span></span>
<span id="cb20-556"><a href="#cb20-556" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">stackX</span>(</span>
<span id="cb20-557"><a href="#cb20-557" aria-hidden="true" tabindex="-1"></a>          { <span class="dt">order</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span> }<span class="op">,</span></span>
<span id="cb20-558"><a href="#cb20-558" aria-hidden="true" tabindex="-1"></a>          {</span>
<span id="cb20-559"><a href="#cb20-559" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (d<span class="op">.</span><span class="at">vop</span> <span class="op">/</span> d<span class="op">.</span><span class="at">vop_total</span>) <span class="op">*</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb20-560"><a href="#cb20-560" aria-hidden="true" tabindex="-1"></a>            <span class="dt">y</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[d<span class="op">.</span><span class="at">crop</span>]<span class="op">,</span></span>
<span id="cb20-561"><a href="#cb20-561" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]<span class="op">,</span></span>
<span id="cb20-562"><a href="#cb20-562" aria-hidden="true" tabindex="-1"></a>            <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb20-563"><a href="#cb20-563" aria-hidden="true" tabindex="-1"></a>            <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.25</span></span>
<span id="cb20-564"><a href="#cb20-564" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb20-565"><a href="#cb20-565" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb20-566"><a href="#cb20-566" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb20-567"><a href="#cb20-567" aria-hidden="true" tabindex="-1"></a>      <span class="co">// tooltip</span></span>
<span id="cb20-568"><a href="#cb20-568" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">tip</span>(</span>
<span id="cb20-569"><a href="#cb20-569" aria-hidden="true" tabindex="-1"></a>        dataBars<span class="op">,</span></span>
<span id="cb20-570"><a href="#cb20-570" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerY</span>(</span>
<span id="cb20-571"><a href="#cb20-571" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">stackX</span>(</span>
<span id="cb20-572"><a href="#cb20-572" aria-hidden="true" tabindex="-1"></a>            { <span class="dt">order</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span> }<span class="op">,</span></span>
<span id="cb20-573"><a href="#cb20-573" aria-hidden="true" tabindex="-1"></a>            {</span>
<span id="cb20-574"><a href="#cb20-574" aria-hidden="true" tabindex="-1"></a>              <span class="dt">x</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (d<span class="op">.</span><span class="at">vop</span> <span class="op">/</span> d<span class="op">.</span><span class="at">vop_total</span>) <span class="op">*</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb20-575"><a href="#cb20-575" aria-hidden="true" tabindex="-1"></a>              <span class="dt">y</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[d<span class="op">.</span><span class="at">crop</span>]<span class="op">,</span></span>
<span id="cb20-576"><a href="#cb20-576" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]<span class="op">,</span></span>
<span id="cb20-577"><a href="#cb20-577" aria-hidden="true" tabindex="-1"></a>              <span class="dt">channels</span><span class="op">:</span> {</span>
<span id="cb20-578"><a href="#cb20-578" aria-hidden="true" tabindex="-1"></a>                <span class="dt">perc</span><span class="op">:</span> {</span>
<span id="cb20-579"><a href="#cb20-579" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">label</span><span class="op">:</span> labelPerc<span class="op">,</span></span>
<span id="cb20-580"><a href="#cb20-580" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb20-581"><a href="#cb20-581" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">const</span> percent <span class="op">=</span> <span class="fu">formatPercentWhole</span>(d<span class="op">.</span><span class="at">vop_any</span> <span class="op">/</span> d<span class="op">.</span><span class="at">vop_total</span>)<span class="op">;</span></span>
<span id="cb20-582"><a href="#cb20-582" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">const</span> vop <span class="op">=</span> <span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(d<span class="op">.</span><span class="at">vop_any</span>)<span class="op">;</span></span>
<span id="cb20-583"><a href="#cb20-583" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>percent<span class="sc">}</span><span class="vs"> (</span><span class="sc">${</span>vop<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb20-584"><a href="#cb20-584" aria-hidden="true" tabindex="-1"></a>                  }</span>
<span id="cb20-585"><a href="#cb20-585" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// value: (d) =&gt; formatUSD(d.vop_any)</span></span>
<span id="cb20-586"><a href="#cb20-586" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb20-587"><a href="#cb20-587" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hazard</span><span class="op">:</span> {</span>
<span id="cb20-588"><a href="#cb20-588" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">label</span><span class="op">:</span> labelHazard<span class="op">,</span></span>
<span id="cb20-589"><a href="#cb20-589" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]</span>
<span id="cb20-590"><a href="#cb20-590" aria-hidden="true" tabindex="-1"></a>                }<span class="op">,</span></span>
<span id="cb20-591"><a href="#cb20-591" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vop</span><span class="op">:</span> {</span>
<span id="cb20-592"><a href="#cb20-592" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">label</span><span class="op">:</span> labelVop<span class="op">,</span></span>
<span id="cb20-593"><a href="#cb20-593" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb20-594"><a href="#cb20-594" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">const</span> percent <span class="op">=</span> <span class="fu">formatPercentWhole</span>(d<span class="op">.</span><span class="at">vop</span> <span class="op">/</span> d<span class="op">.</span><span class="at">vop_total</span>)<span class="op">;</span></span>
<span id="cb20-595"><a href="#cb20-595" aria-hidden="true" tabindex="-1"></a>                    <span class="kw">const</span> vop <span class="op">=</span> <span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(d<span class="op">.</span><span class="at">vop</span>)<span class="op">;</span></span>
<span id="cb20-596"><a href="#cb20-596" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>percent<span class="sc">}</span><span class="vs"> (</span><span class="sc">${</span>vop<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb20-597"><a href="#cb20-597" aria-hidden="true" tabindex="-1"></a>                  }</span>
<span id="cb20-598"><a href="#cb20-598" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb20-599"><a href="#cb20-599" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb20-600"><a href="#cb20-600" aria-hidden="true" tabindex="-1"></a>              <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb20-601"><a href="#cb20-601" aria-hidden="true" tabindex="-1"></a>                <span class="dt">x</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb20-602"><a href="#cb20-602" aria-hidden="true" tabindex="-1"></a>                <span class="dt">y</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb20-603"><a href="#cb20-603" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fill</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb20-604"><a href="#cb20-604" aria-hidden="true" tabindex="-1"></a>                <span class="dt">vop</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-605"><a href="#cb20-605" aria-hidden="true" tabindex="-1"></a>                <span class="dt">hazard</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb20-606"><a href="#cb20-606" aria-hidden="true" tabindex="-1"></a>                <span class="dt">perc</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb20-607"><a href="#cb20-607" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb20-608"><a href="#cb20-608" aria-hidden="true" tabindex="-1"></a>              <span class="dt">lineWidth</span><span class="op">:</span> <span class="dv">50</span></span>
<span id="cb20-609"><a href="#cb20-609" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb20-610"><a href="#cb20-610" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb20-611"><a href="#cb20-611" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb20-612"><a href="#cb20-612" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb20-613"><a href="#cb20-613" aria-hidden="true" tabindex="-1"></a>      <span class="co">// total VoP, sidebar highlight</span></span>
<span id="cb20-614"><a href="#cb20-614" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">textX</span>(</span>
<span id="cb20-615"><a href="#cb20-615" aria-hidden="true" tabindex="-1"></a>        dataAny<span class="op">,</span></span>
<span id="cb20-616"><a href="#cb20-616" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointerY</span>({</span>
<span id="cb20-617"><a href="#cb20-617" aria-hidden="true" tabindex="-1"></a>          <span class="dt">x</span><span class="op">:</span> <span class="dv">100</span><span class="op">,</span></span>
<span id="cb20-618"><a href="#cb20-618" aria-hidden="true" tabindex="-1"></a>          <span class="dt">y</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[d<span class="op">.</span><span class="at">crop</span>]<span class="op">,</span></span>
<span id="cb20-619"><a href="#cb20-619" aria-hidden="true" tabindex="-1"></a>          <span class="dt">text</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb20-620"><a href="#cb20-620" aria-hidden="true" tabindex="-1"></a>            <span class="kw">const</span> value <span class="op">=</span> <span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(d<span class="op">.</span><span class="at">vop_total</span>)<span class="op">;</span></span>
<span id="cb20-621"><a href="#cb20-621" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>value<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb20-622"><a href="#cb20-622" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb20-623"><a href="#cb20-623" aria-hidden="true" tabindex="-1"></a>          <span class="dt">textAnchor</span><span class="op">:</span> <span class="st">"start"</span><span class="op">,</span></span>
<span id="cb20-624"><a href="#cb20-624" aria-hidden="true" tabindex="-1"></a>          <span class="dt">dx</span><span class="op">:</span> <span class="dv">5</span></span>
<span id="cb20-625"><a href="#cb20-625" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb20-626"><a href="#cb20-626" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb20-627"><a href="#cb20-627" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb20-628"><a href="#cb20-628" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb20-629"><a href="#cb20-629" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-20" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb21" data-startfrom="633" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 632"><span id="cb21-633"><a href="#cb21-633" aria-hidden="true" tabindex="-1"></a><span class="fu">buildInlineDownloadButton</span>(</span>
<span id="cb21-634"><a href="#cb21-634" aria-hidden="true" tabindex="-1"></a>  data_hazardVoP<span class="op">,</span></span>
<span id="cb21-635"><a href="#cb21-635" aria-hidden="true" tabindex="-1"></a>  <span class="fu">_lang</span>(download_translation)<span class="op">,</span></span>
<span id="cb21-636"><a href="#cb21-636" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`CropClimateExposure_</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">label</span><span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">\s</span><span class="ss">/g</span><span class="op">,</span> <span class="st">""</span>)<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb21-637"><a href="#cb21-637" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-21" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb22" data-startfrom="641" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 640"><span id="cb22-641"><a href="#cb22-641" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb22-642"><a href="#cb22-642" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">h1</span>)</span>
<span id="cb22-643"><a href="#cb22-643" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`## </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb22-644"><a href="#cb22-644" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-22" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb23" data-startfrom="648" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 647"><span id="cb23-648"><a href="#cb23-648" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb23-649"><a href="#cb23-649" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">intro</span>)</span>
<span id="cb23-650"><a href="#cb23-650" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb23-651"><a href="#cb23-651" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-23" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb24" data-startfrom="655" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 654"><span id="cb24-655"><a href="#cb24-655" aria-hidden="true" tabindex="-1"></a><span class="co">// picking hazard</span></span>
<span id="cb24-656"><a href="#cb24-656" aria-hidden="true" tabindex="-1"></a>viewof selectHazard <span class="op">=</span> {</span>
<span id="cb24-657"><a href="#cb24-657" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>(</span>
<span id="cb24-658"><a href="#cb24-658" aria-hidden="true" tabindex="-1"></a>    <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(hazardPlotLookup<span class="op">.</span><span class="at">names</span>)</span>
<span id="cb24-659"><a href="#cb24-659" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d <span class="op">!==</span> <span class="st">'no hazard'</span>) <span class="co">// remove no hazard option</span></span>
<span id="cb24-660"><a href="#cb24-660" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> [hazardPlotLookup<span class="op">.</span><span class="at">names</span>[d]<span class="op">,</span> d])</span>
<span id="cb24-661"><a href="#cb24-661" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb24-662"><a href="#cb24-662" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">select</span>(data<span class="op">,</span> {</span>
<span id="cb24-663"><a href="#cb24-663" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="st">'dry'</span><span class="op">,</span></span>
<span id="cb24-664"><a href="#cb24-664" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">dropdownHazard</span><span class="op">.</span><span class="at">label</span>)</span>
<span id="cb24-665"><a href="#cb24-665" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb24-666"><a href="#cb24-666" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-24" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb25" data-startfrom="670" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 669"><span id="cb25-670"><a href="#cb25-670" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb25-671"><a href="#cb25-671" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> template <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">plots</span><span class="op">.</span><span class="at">crops</span><span class="op">.</span><span class="at">header</span>)</span>
<span id="cb25-672"><a href="#cb25-672" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> items <span class="op">=</span> [{<span class="dt">name</span><span class="op">:</span> <span class="st">"hazard_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[selectHazard]<span class="op">.</span><span class="fu">toLowerCase</span>()}]</span>
<span id="cb25-673"><a href="#cb25-673" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> format <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(template<span class="op">,</span> items)</span>
<span id="cb25-674"><a href="#cb25-674" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`### </span><span class="sc">${</span>format<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb25-675"><a href="#cb25-675" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-25" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb26" data-startfrom="679" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 678"><span id="cb26-679"><a href="#cb26-679" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb26-680"><a href="#cb26-680" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> data_hazardVoP<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb26-681"><a href="#cb26-681" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb26-682"><a href="#cb26-682" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> selectHazard <span class="op">&amp;&amp;</span></span>
<span id="cb26-683"><a href="#cb26-683" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">vop</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span></span>
<span id="cb26-684"><a href="#cb26-684" aria-hidden="true" tabindex="-1"></a>      riskDataTypes<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">crop</span>)</span>
<span id="cb26-685"><a href="#cb26-685" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span> <span class="co">// lookup crop type</span></span>
<span id="cb26-686"><a href="#cb26-686" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb26-687"><a href="#cb26-687" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> marginLeft <span class="op">=</span> <span class="fu">_lang</span>({<span class="dt">en</span><span class="op">:</span> <span class="dv">110</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="dv">120</span>})<span class="op">;</span></span>
<span id="cb26-688"><a href="#cb26-688" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">makeTopCropBarChart</span>(data<span class="op">,</span> {marginLeft})<span class="op">;</span></span>
<span id="cb26-689"><a href="#cb26-689" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-26" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb27" data-startfrom="693" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 692"><span id="cb27-693"><a href="#cb27-693" aria-hidden="true" tabindex="-1"></a><span class="fu">buildInlineDownloadButton</span>(</span>
<span id="cb27-694"><a href="#cb27-694" aria-hidden="true" tabindex="-1"></a>  data_hazardVoP<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb27-695"><a href="#cb27-695" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb27-696"><a href="#cb27-696" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> selectHazard <span class="op">&amp;&amp;</span></span>
<span id="cb27-697"><a href="#cb27-697" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">vop</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span></span>
<span id="cb27-698"><a href="#cb27-698" aria-hidden="true" tabindex="-1"></a>      riskDataTypes<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">crop</span>)</span>
<span id="cb27-699"><a href="#cb27-699" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb27-700"><a href="#cb27-700" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb27-701"><a href="#cb27-701" aria-hidden="true" tabindex="-1"></a>  <span class="fu">_lang</span>(download_translation)<span class="op">,</span></span>
<span id="cb27-702"><a href="#cb27-702" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`CropRisk_</span><span class="sc">${</span>selectHazard<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb27-703"><a href="#cb27-703" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-27" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb28" data-startfrom="707" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 706"><span id="cb28-707"><a href="#cb28-707" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb28-708"><a href="#cb28-708" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> template <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">plots</span><span class="op">.</span><span class="at">livestock</span><span class="op">.</span><span class="at">header</span>)</span>
<span id="cb28-709"><a href="#cb28-709" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> items <span class="op">=</span> [{<span class="dt">name</span><span class="op">:</span> <span class="st">"hazard_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[selectHazard]<span class="op">.</span><span class="fu">toLowerCase</span>()}]</span>
<span id="cb28-710"><a href="#cb28-710" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> format <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(template<span class="op">,</span> items)</span>
<span id="cb28-711"><a href="#cb28-711" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`### </span><span class="sc">${</span>format<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb28-712"><a href="#cb28-712" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-28" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb29" data-startfrom="716" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 715"><span id="cb29-716"><a href="#cb29-716" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb29-717"><a href="#cb29-717" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> data_hazardVoP<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb29-718"><a href="#cb29-718" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb29-719"><a href="#cb29-719" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> selectHazard <span class="op">&amp;&amp;</span></span>
<span id="cb29-720"><a href="#cb29-720" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">vop</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span></span>
<span id="cb29-721"><a href="#cb29-721" aria-hidden="true" tabindex="-1"></a>      riskDataTypes<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">livestock</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">crop</span>)</span>
<span id="cb29-722"><a href="#cb29-722" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span> <span class="co">// lookup crop type</span></span>
<span id="cb29-723"><a href="#cb29-723" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb29-724"><a href="#cb29-724" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> marginLeft <span class="op">=</span> <span class="fu">_lang</span>({<span class="dt">en</span><span class="op">:</span> <span class="dv">110</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="dv">150</span>})<span class="op">;</span></span>
<span id="cb29-725"><a href="#cb29-725" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">makeTopCropBarChart</span>(data<span class="op">,</span> {marginLeft})<span class="op">;</span></span>
<span id="cb29-726"><a href="#cb29-726" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-29" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb30" data-startfrom="730" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 729"><span id="cb30-730"><a href="#cb30-730" aria-hidden="true" tabindex="-1"></a><span class="fu">buildInlineDownloadButton</span>(</span>
<span id="cb30-731"><a href="#cb30-731" aria-hidden="true" tabindex="-1"></a>  data_hazardVoP<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb30-732"><a href="#cb30-732" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (</span>
<span id="cb30-733"><a href="#cb30-733" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> selectHazard <span class="op">&amp;&amp;</span></span>
<span id="cb30-734"><a href="#cb30-734" aria-hidden="true" tabindex="-1"></a>      d<span class="op">.</span><span class="at">vop</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span></span>
<span id="cb30-735"><a href="#cb30-735" aria-hidden="true" tabindex="-1"></a>      riskDataTypes<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">livestock</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">crop</span>)</span>
<span id="cb30-736"><a href="#cb30-736" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb30-737"><a href="#cb30-737" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb30-738"><a href="#cb30-738" aria-hidden="true" tabindex="-1"></a>  <span class="fu">_lang</span>(download_translation)<span class="op">,</span></span>
<span id="cb30-739"><a href="#cb30-739" aria-hidden="true" tabindex="-1"></a>  <span class="vs">`LivestockRisk_</span><span class="sc">${</span>selectHazard<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb30-740"><a href="#cb30-740" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-30" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb31" data-startfrom="744" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 743"><span id="cb31-744"><a href="#cb31-744" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb31-745"><a href="#cb31-745" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> format <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb31-746"><a href="#cb31-746" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">title</span>)<span class="op">,</span></span>
<span id="cb31-747"><a href="#cb31-747" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb31-748"><a href="#cb31-748" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"insight_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">quickInsights</span>) }<span class="op">,</span></span>
<span id="cb31-749"><a href="#cb31-749" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_selection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">getAdminSelection</span>()<span class="op">.</span><span class="at">label</span> }<span class="op">,</span></span>
<span id="cb31-750"><a href="#cb31-750" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"scenario"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> selectScenarioAndTimeframe<span class="op">.</span><span class="at">label</span> }</span>
<span id="cb31-751"><a href="#cb31-751" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb31-752"><a href="#cb31-752" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb31-753"><a href="#cb31-753" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`### </span><span class="sc">${</span>format<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb31-754"><a href="#cb31-754" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-31" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb32" data-startfrom="758" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 757"><span id="cb32-758"><a href="#cb32-758" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb32-759"><a href="#cb32-759" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selectedHazard <span class="op">=</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[selectHazard]</span>
<span id="cb32-760"><a href="#cb32-760" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langLookup <span class="op">=</span> {</span>
<span id="cb32-761"><a href="#cb32-761" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hazard</span><span class="op">:</span> selectedHazard<span class="op">,</span></span>
<span id="cb32-762"><a href="#cb32-762" aria-hidden="true" tabindex="-1"></a>    <span class="dt">hazardBlurb</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb32-763"><a href="#cb32-763" aria-hidden="true" tabindex="-1"></a>      <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">hazardBlurb</span>)<span class="op">,</span></span>
<span id="cb32-764"><a href="#cb32-764" aria-hidden="true" tabindex="-1"></a>      [{<span class="dt">name</span><span class="op">:</span> <span class="st">"hazard_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> selectedHazard}]</span>
<span id="cb32-765"><a href="#cb32-765" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb32-766"><a href="#cb32-766" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labels</span><span class="op">:</span> {</span>
<span id="cb32-767"><a href="#cb32-767" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalVopCrop</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb32-768"><a href="#cb32-768" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">totalVopCrop</span></span>
<span id="cb32-769"><a href="#cb32-769" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb32-770"><a href="#cb32-770" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalVopLivestock</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb32-771"><a href="#cb32-771" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">totalVopLivestock</span></span>
<span id="cb32-772"><a href="#cb32-772" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb32-773"><a href="#cb32-773" aria-hidden="true" tabindex="-1"></a>      <span class="dt">exposureCrop</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb32-774"><a href="#cb32-774" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">exposureCrop</span></span>
<span id="cb32-775"><a href="#cb32-775" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb32-776"><a href="#cb32-776" aria-hidden="true" tabindex="-1"></a>      <span class="dt">exposureLivestock</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb32-777"><a href="#cb32-777" aria-hidden="true" tabindex="-1"></a>        nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">exposureLivestock</span></span>
<span id="cb32-778"><a href="#cb32-778" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb32-779"><a href="#cb32-779" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb32-780"><a href="#cb32-780" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb32-781"><a href="#cb32-781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-782"><a href="#cb32-782" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> crop <span class="op">=</span> insight_totalExposedVop<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb32-783"><a href="#cb32-783" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">totalExposedVop</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">==</span> <span class="st">"crop"</span></span>
<span id="cb32-784"><a href="#cb32-784" aria-hidden="true" tabindex="-1"></a>  )<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span>[<span class="st">"totalExposedVop"</span>]<span class="op">;</span></span>
<span id="cb32-785"><a href="#cb32-785" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> livestock <span class="op">=</span> insight_totalExposedVop<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb32-786"><a href="#cb32-786" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">totalExposedVop</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">==</span> <span class="st">"livestock"</span></span>
<span id="cb32-787"><a href="#cb32-787" aria-hidden="true" tabindex="-1"></a>  )<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span>[<span class="st">"totalExposedVop"</span>]<span class="op">;</span></span>
<span id="cb32-788"><a href="#cb32-788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-789"><a href="#cb32-789" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topCrop <span class="op">=</span> insight_topCrops<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb32-790"><a href="#cb32-790" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">vop</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">==</span> <span class="st">"crop"</span></span>
<span id="cb32-791"><a href="#cb32-791" aria-hidden="true" tabindex="-1"></a>  )<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb32-792"><a href="#cb32-792" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topLivestock <span class="op">=</span> insight_topCrops<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb32-793"><a href="#cb32-793" aria-hidden="true" tabindex="-1"></a>    (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">vop</span> <span class="op">!==</span> <span class="dv">0</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">==</span> <span class="st">"livestock"</span></span>
<span id="cb32-794"><a href="#cb32-794" aria-hidden="true" tabindex="-1"></a>  )<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb32-795"><a href="#cb32-795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-796"><a href="#cb32-796" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> missingValue <span class="op">=</span> <span class="st">"---"</span><span class="op">;</span></span>
<span id="cb32-797"><a href="#cb32-797" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-798"><a href="#cb32-798" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">showResult</span>(value<span class="op">,</span> format) {</span>
<span id="cb32-799"><a href="#cb32-799" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (value <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> value <span class="op">===</span> <span class="kw">undefined</span>) <span class="cf">return</span> missingValue<span class="op">;</span></span>
<span id="cb32-800"><a href="#cb32-800" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">format</span>(value)<span class="op">;</span></span>
<span id="cb32-801"><a href="#cb32-801" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb32-802"><a href="#cb32-802" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-803"><a href="#cb32-803" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topCropString <span class="op">=</span></span>
<span id="cb32-804"><a href="#cb32-804" aria-hidden="true" tabindex="-1"></a>    topCrop <span class="op">!==</span> <span class="kw">undefined</span></span>
<span id="cb32-805"><a href="#cb32-805" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="vs">`**</span><span class="sc">${</span>hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[topCrop<span class="op">?.</span>[<span class="st">"crop"</span>]]<span class="sc">}</span><span class="vs">** (**</span><span class="sc">${</span><span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(</span>
<span id="cb32-806"><a href="#cb32-806" aria-hidden="true" tabindex="-1"></a>          topCrop<span class="op">?.</span>[<span class="st">"vop"</span>]</span>
<span id="cb32-807"><a href="#cb32-807" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">}</span><span class="vs">**)`</span></span>
<span id="cb32-808"><a href="#cb32-808" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="vs">`**</span><span class="sc">${</span>missingValue<span class="sc">}</span><span class="vs">**`</span><span class="op">;</span></span>
<span id="cb32-809"><a href="#cb32-809" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topLivestockString <span class="op">=</span></span>
<span id="cb32-810"><a href="#cb32-810" aria-hidden="true" tabindex="-1"></a>    topLivestock <span class="op">!==</span> <span class="kw">undefined</span></span>
<span id="cb32-811"><a href="#cb32-811" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="vs">`**</span><span class="sc">${</span></span>
<span id="cb32-812"><a href="#cb32-812" aria-hidden="true" tabindex="-1"></a>          hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[topLivestock<span class="op">?.</span>[<span class="st">"crop"</span>]]</span>
<span id="cb32-813"><a href="#cb32-813" aria-hidden="true" tabindex="-1"></a>        <span class="sc">}</span><span class="vs">** (**</span><span class="sc">${</span><span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(topLivestock<span class="op">?.</span>[<span class="st">"vop"</span>])<span class="sc">}</span><span class="vs">**)`</span></span>
<span id="cb32-814"><a href="#cb32-814" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="vs">`**</span><span class="sc">${</span>missingValue<span class="sc">}</span><span class="vs">**`</span><span class="op">;</span></span>
<span id="cb32-815"><a href="#cb32-815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-816"><a href="#cb32-816" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>langLookup<span class="op">.</span><span class="at">hazardBlurb</span><span class="sc">}</span></span>
<span id="cb32-817"><a href="#cb32-817" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-818"><a href="#cb32-818" aria-hidden="true" tabindex="-1"></a><span class="vs">- </span><span class="sc">${</span>langLookup<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">totalVopCrop</span><span class="sc">}</span><span class="vs">: **</span><span class="sc">${</span><span class="fu">showResult</span>(crop<span class="op">,</span> <span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>}))<span class="sc">}</span><span class="vs">**</span></span>
<span id="cb32-819"><a href="#cb32-819" aria-hidden="true" tabindex="-1"></a><span class="vs">- </span><span class="sc">${</span>langLookup<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">totalVopLivestock</span><span class="sc">}</span><span class="vs">: **</span><span class="sc">${</span><span class="fu">showResult</span>(</span>
<span id="cb32-820"><a href="#cb32-820" aria-hidden="true" tabindex="-1"></a>    livestock<span class="op">,</span></span>
<span id="cb32-821"><a href="#cb32-821" aria-hidden="true" tabindex="-1"></a>    <span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})</span>
<span id="cb32-822"><a href="#cb32-822" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">}</span><span class="vs">**</span></span>
<span id="cb32-823"><a href="#cb32-823" aria-hidden="true" tabindex="-1"></a><span class="vs">- </span><span class="sc">${</span>langLookup<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">exposureCrop</span><span class="sc">}</span><span class="vs">: </span><span class="sc">${</span>topCropString<span class="sc">}</span></span>
<span id="cb32-824"><a href="#cb32-824" aria-hidden="true" tabindex="-1"></a><span class="vs">- </span><span class="sc">${</span>langLookup<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">exposureLivestock</span><span class="sc">}</span><span class="vs">: </span><span class="sc">${</span>topLivestockString<span class="sc">}</span></span>
<span id="cb32-825"><a href="#cb32-825" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">;</span></span>
<span id="cb32-826"><a href="#cb32-826" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-32" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb33" data-startfrom="830" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 829"><span id="cb33-830"><a href="#cb33-830" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb33-831"><a href="#cb33-831" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> intro <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">blurbBiggestHazard</span>)</span>
<span id="cb33-832"><a href="#cb33-832" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>intro<span class="sc">}</span></span>
<span id="cb33-833"><a href="#cb33-833" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>hazardPlotLookup<span class="op">.</span><span class="at">names</span>[insight_rankedHazardVopTotals<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span>[<span class="st">'hazard'</span>]]<span class="sc">}</span><span class="vs">**: **</span><span class="sc">${</span><span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(insight_rankedHazardVopTotals<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span>[<span class="st">'totalVop'</span>])<span class="sc">}</span><span class="vs">**</span></span>
<span id="cb33-834"><a href="#cb33-834" aria-hidden="true" tabindex="-1"></a><span class="vs">- **</span><span class="sc">${</span>hazardPlotLookup<span class="op">.</span><span class="at">names</span>[insight_rankedHazardVopTotals<span class="op">?.</span>[<span class="dv">1</span>]<span class="op">?.</span>[<span class="st">'hazard'</span>]]<span class="sc">}</span><span class="vs">**: **</span><span class="sc">${</span><span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(insight_rankedHazardVopTotals<span class="op">?.</span>[<span class="dv">1</span>]<span class="op">?.</span>[<span class="st">'totalVop'</span>])<span class="sc">}</span><span class="vs">**`</span></span>
<span id="cb33-835"><a href="#cb33-835" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-33" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb34" data-startfrom="839" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 838"><span id="cb34-839"><a href="#cb34-839" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb34-840"><a href="#cb34-840" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">h1</span>)</span>
<span id="cb34-841"><a href="#cb34-841" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb34-842"><a href="#cb34-842" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-34" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb35" data-startfrom="846" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 845"><span id="cb35-846"><a href="#cb35-846" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb35-847"><a href="#cb35-847" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> adminSelection <span class="op">=</span> <span class="fu">getAdminSelectionLabelWithParen</span>({</span>
<span id="cb35-848"><a href="#cb35-848" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin0Label</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb35-849"><a href="#cb35-849" aria-hidden="true" tabindex="-1"></a>      td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[<span class="fu">getAdminSelectionAdmin0</span>()<span class="op">.</span><span class="at">value</span> <span class="op">??</span> <span class="st">"SSA"</span>][<span class="st">"article3"</span>]</span>
<span id="cb35-850"><a href="#cb35-850" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb35-851"><a href="#cb35-851" aria-hidden="true" tabindex="-1"></a>    <span class="dt">adminSublabel</span><span class="op">:</span> <span class="fu">getAdminSelection</span>()<span class="op">.</span><span class="at">label</span></span>
<span id="cb35-852"><a href="#cb35-852" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb35-853"><a href="#cb35-853" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> format <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb35-854"><a href="#cb35-854" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">intro</span>)<span class="op">,</span></span>
<span id="cb35-855"><a href="#cb35-855" aria-hidden="true" tabindex="-1"></a>    [{<span class="dt">name</span><span class="op">:</span> <span class="st">"admin_selection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> adminSelection}]</span>
<span id="cb35-856"><a href="#cb35-856" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-857"><a href="#cb35-857" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>format<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb35-858"><a href="#cb35-858" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-35" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb36" data-startfrom="862" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 861"><span id="cb36-862"><a href="#cb36-862" aria-hidden="true" tabindex="-1"></a><span class="co">// format admin selections</span></span>
<span id="cb36-863"><a href="#cb36-863" aria-hidden="true" tabindex="-1"></a><span class="co">// bind to appendix inputs, add template to format</span></span>
<span id="cb36-864"><a href="#cb36-864" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb36-865"><a href="#cb36-865" aria-hidden="true" tabindex="-1"></a>  [</span>
<span id="cb36-866"><a href="#cb36-866" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb36-867"><a href="#cb36-867" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin0<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb36-868"><a href="#cb36-868" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin0</span>
<span id="cb36-869"><a href="#cb36-869" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb36-870"><a href="#cb36-870" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb36-871"><a href="#cb36-871" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin1<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb36-872"><a href="#cb36-872" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin1</span>
<span id="cb36-873"><a href="#cb36-873" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb36-874"><a href="#cb36-874" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb36-875"><a href="#cb36-875" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin2<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb36-876"><a href="#cb36-876" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin2</span>
<span id="cb36-877"><a href="#cb36-877" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb36-878"><a href="#cb36-878" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb36-879"><a href="#cb36-879" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb36-880"><a href="#cb36-880" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> adminFormTemplate</span>
<span id="cb36-881"><a href="#cb36-881" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb36-882"><a href="#cb36-882" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-36" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb37" data-startfrom="886" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 885"><span id="cb37-886"><a href="#cb37-886" aria-hidden="true" tabindex="-1"></a><span class="co">// define choices for the data value</span></span>
<span id="cb37-887"><a href="#cb37-887" aria-hidden="true" tabindex="-1"></a>viewof selectAcDataTypeNew <span class="op">=</span> {</span>
<span id="cb37-888"><a href="#cb37-888" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> options <span class="op">=</span> dataLayerOptionsAdaptiveCapacities<span class="op">;</span></span>
<span id="cb37-889"><a href="#cb37-889" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb37-890"><a href="#cb37-890" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Inputs<span class="op">.</span><span class="fu">radio</span>(options<span class="op">,</span> {</span>
<span id="cb37-891"><a href="#cb37-891" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span></span>
<span id="cb37-892"><a href="#cb37-892" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb37-893"><a href="#cb37-893" aria-hidden="true" tabindex="-1"></a>    <span class="dt">format</span><span class="op">:</span> (x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb37-894"><a href="#cb37-894" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> options<span class="op">.</span><span class="fu">find</span>((t) <span class="kw">=&gt;</span> t<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"pov"</span>)<span class="op">,</span></span>
<span id="cb37-895"><a href="#cb37-895" aria-hidden="true" tabindex="-1"></a>    <span class="dt">sort</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb37-896"><a href="#cb37-896" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb37-897"><a href="#cb37-897" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-37" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb38" data-startfrom="901" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 900"><span id="cb38-901"><a href="#cb38-901" aria-hidden="true" tabindex="-1"></a>plotChoroplethAdaptiveCapacity1 <span class="op">=</span> {</span>
<span id="cb38-902"><a href="#cb38-902" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> mapFeaturesAdaptiveCapacity<span class="op">;</span> <span class="co">// geo, with bound data</span></span>
<span id="cb38-903"><a href="#cb38-903" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> selector <span class="op">=</span> selectAcDataTypeNew<span class="op">;</span></span>
<span id="cb38-904"><a href="#cb38-904" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> options <span class="op">=</span> dataLayerOptionsAdaptiveCapacities<span class="op">;</span></span>
<span id="cb38-905"><a href="#cb38-905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-906"><a href="#cb38-906" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> filler <span class="op">=</span> selectAcDataTypeNew<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"edu"</span> <span class="op">?</span> (c) <span class="kw">=&gt;</span> c <span class="op">:</span> transformPercent</span>
<span id="cb38-907"><a href="#cb38-907" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-908"><a href="#cb38-908" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">_getOption</span>(key<span class="op">,</span> data <span class="op">=</span> options) {</span>
<span id="cb38-909"><a href="#cb38-909" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data<span class="op">.</span><span class="fu">find</span>((x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">key</span> <span class="op">==</span> key)<span class="op">;</span></span>
<span id="cb38-910"><a href="#cb38-910" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb38-911"><a href="#cb38-911" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-912"><a href="#cb38-912" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> missingDataLabel <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb38-913"><a href="#cb38-913" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">missingMapDataBlurb</span>)<span class="op">,</span></span>
<span id="cb38-914"><a href="#cb38-914" aria-hidden="true" tabindex="-1"></a>    [{ <span class="dt">name</span><span class="op">:</span> <span class="st">"data_label"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> selector<span class="op">.</span><span class="at">label</span> }]</span>
<span id="cb38-915"><a href="#cb38-915" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb38-916"><a href="#cb38-916" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-917"><a href="#cb38-917" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb38-918"><a href="#cb38-918" aria-hidden="true" tabindex="-1"></a>    <span class="dt">caption</span><span class="op">:</span> missingDataLabel<span class="op">,</span></span>
<span id="cb38-919"><a href="#cb38-919" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marginBottom</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span></span>
<span id="cb38-920"><a href="#cb38-920" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> mapWidth<span class="op">,</span></span>
<span id="cb38-921"><a href="#cb38-921" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">550</span><span class="op">,</span></span>
<span id="cb38-922"><a href="#cb38-922" aria-hidden="true" tabindex="-1"></a>    <span class="dt">projection</span><span class="op">:</span> {</span>
<span id="cb38-923"><a href="#cb38-923" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"azimuthal-equal-area"</span><span class="op">,</span></span>
<span id="cb38-924"><a href="#cb38-924" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> {</span>
<span id="cb38-925"><a href="#cb38-925" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"FeatureCollection"</span><span class="op">,</span></span>
<span id="cb38-926"><a href="#cb38-926" aria-hidden="true" tabindex="-1"></a>        <span class="dt">features</span><span class="op">:</span> data</span>
<span id="cb38-927"><a href="#cb38-927" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb38-928"><a href="#cb38-928" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb38-929"><a href="#cb38-929" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb38-930"><a href="#cb38-930" aria-hidden="true" tabindex="-1"></a>      <span class="co">// scheme: 'Cividis',</span></span>
<span id="cb38-931"><a href="#cb38-931" aria-hidden="true" tabindex="-1"></a>      <span class="dt">legend</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb38-932"><a href="#cb38-932" aria-hidden="true" tabindex="-1"></a>      <span class="co">// domain: [0, 100],</span></span>
<span id="cb38-933"><a href="#cb38-933" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span></span>
<span id="cb38-934"><a href="#cb38-934" aria-hidden="true" tabindex="-1"></a>        selector<span class="op">.</span><span class="at">key</span> <span class="op">===</span> <span class="st">"pov"</span></span>
<span id="cb38-935"><a href="#cb38-935" aria-hidden="true" tabindex="-1"></a>          <span class="op">?</span> selector<span class="op">.</span><span class="at">colorDomain</span></span>
<span id="cb38-936"><a href="#cb38-936" aria-hidden="true" tabindex="-1"></a>          <span class="op">:</span> selector<span class="op">.</span><span class="at">colorDomain</span><span class="op">.</span><span class="fu">slice</span>()<span class="op">.</span><span class="fu">reverse</span>()<span class="op">,</span></span>
<span id="cb38-937"><a href="#cb38-937" aria-hidden="true" tabindex="-1"></a>      <span class="dt">unknown</span><span class="op">:</span> selector<span class="op">.</span><span class="at">colorUnknown</span><span class="op">,</span></span>
<span id="cb38-938"><a href="#cb38-938" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">labelLegend</span></span>
<span id="cb38-939"><a href="#cb38-939" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb38-940"><a href="#cb38-940" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb38-941"><a href="#cb38-941" aria-hidden="true" tabindex="-1"></a>      <span class="co">// geo data</span></span>
<span id="cb38-942"><a href="#cb38-942" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">geo</span>(data<span class="op">,</span> {</span>
<span id="cb38-943"><a href="#cb38-943" aria-hidden="true" tabindex="-1"></a>        <span class="co">// convert non-null to percent</span></span>
<span id="cb38-944"><a href="#cb38-944" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">filler</span>(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[selector<span class="op">.</span><span class="at">dataColumn</span>])<span class="op">,</span></span>
<span id="cb38-945"><a href="#cb38-945" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#fff"</span><span class="op">,</span></span>
<span id="cb38-946"><a href="#cb38-946" aria-hidden="true" tabindex="-1"></a>        <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">0.5</span></span>
<span id="cb38-947"><a href="#cb38-947" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb38-948"><a href="#cb38-948" aria-hidden="true" tabindex="-1"></a>      <span class="co">// admin2 highlight</span></span>
<span id="cb38-949"><a href="#cb38-949" aria-hidden="true" tabindex="-1"></a>      <span class="co">// if Admin selection includes admin2, highlight section</span></span>
<span id="cb38-950"><a href="#cb38-950" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">geo</span>(</span>
<span id="cb38-951"><a href="#cb38-951" aria-hidden="true" tabindex="-1"></a>        adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb38-952"><a href="#cb38-952" aria-hidden="true" tabindex="-1"></a>          <span class="op">?</span> data<span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb38-953"><a href="#cb38-953" aria-hidden="true" tabindex="-1"></a>              (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin2_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb38-954"><a href="#cb38-954" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb38-955"><a href="#cb38-955" aria-hidden="true" tabindex="-1"></a>          <span class="op">:</span> []<span class="op">,</span></span>
<span id="cb38-956"><a href="#cb38-956" aria-hidden="true" tabindex="-1"></a>        {</span>
<span id="cb38-957"><a href="#cb38-957" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fill</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb38-958"><a href="#cb38-958" aria-hidden="true" tabindex="-1"></a>          <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#333"</span><span class="op">,</span></span>
<span id="cb38-959"><a href="#cb38-959" aria-hidden="true" tabindex="-1"></a>          <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">1.5</span></span>
<span id="cb38-960"><a href="#cb38-960" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb38-961"><a href="#cb38-961" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb38-962"><a href="#cb38-962" aria-hidden="true" tabindex="-1"></a>      <span class="co">// geo pointer</span></span>
<span id="cb38-963"><a href="#cb38-963" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">geo</span>(</span>
<span id="cb38-964"><a href="#cb38-964" aria-hidden="true" tabindex="-1"></a>        data<span class="op">,</span></span>
<span id="cb38-965"><a href="#cb38-965" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointer</span>(</span>
<span id="cb38-966"><a href="#cb38-966" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">centroid</span>({</span>
<span id="cb38-967"><a href="#cb38-967" aria-hidden="true" tabindex="-1"></a>            <span class="dt">stroke</span><span class="op">:</span> <span class="st">"#333"</span><span class="op">,</span></span>
<span id="cb38-968"><a href="#cb38-968" aria-hidden="true" tabindex="-1"></a>            <span class="dt">strokeWidth</span><span class="op">:</span> <span class="fl">1.5</span></span>
<span id="cb38-969"><a href="#cb38-969" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb38-970"><a href="#cb38-970" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-971"><a href="#cb38-971" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb38-972"><a href="#cb38-972" aria-hidden="true" tabindex="-1"></a>      <span class="co">// tooltip</span></span>
<span id="cb38-973"><a href="#cb38-973" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">tip</span>(</span>
<span id="cb38-974"><a href="#cb38-974" aria-hidden="true" tabindex="-1"></a>        data<span class="op">,</span></span>
<span id="cb38-975"><a href="#cb38-975" aria-hidden="true" tabindex="-1"></a>        Plot<span class="op">.</span><span class="fu">pointer</span>(</span>
<span id="cb38-976"><a href="#cb38-976" aria-hidden="true" tabindex="-1"></a>          Plot<span class="op">.</span><span class="fu">centroid</span>({</span>
<span id="cb38-977"><a href="#cb38-977" aria-hidden="true" tabindex="-1"></a>            <span class="dt">lineWidth</span><span class="op">:</span> <span class="kw">Infinity</span><span class="op">,</span></span>
<span id="cb38-978"><a href="#cb38-978" aria-hidden="true" tabindex="-1"></a>            <span class="dt">channels</span><span class="op">:</span> {</span>
<span id="cb38-979"><a href="#cb38-979" aria-hidden="true" tabindex="-1"></a>              <span class="dt">name</span><span class="op">:</span> {</span>
<span id="cb38-980"><a href="#cb38-980" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span></span>
<span id="cb38-981"><a href="#cb38-981" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// label for region, by admin selection</span></span>
<span id="cb38-982"><a href="#cb38-982" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// plot-level so inputs don't reload</span></span>
<span id="cb38-983"><a href="#cb38-983" aria-hidden="true" tabindex="-1"></a>                  adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb38-984"><a href="#cb38-984" aria-hidden="true" tabindex="-1"></a>                    <span class="op">?</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span></span>
<span id="cb38-985"><a href="#cb38-985" aria-hidden="true" tabindex="-1"></a>                    <span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">,</span></span>
<span id="cb38-986"><a href="#cb38-986" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb38-987"><a href="#cb38-987" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> translated <span class="op">=</span> <span class="fu">_lang</span>(td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin_name</span>])<span class="op">;</span></span>
<span id="cb38-988"><a href="#cb38-988" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> translated <span class="op">??</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin_name</span></span>
<span id="cb38-989"><a href="#cb38-989" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb38-990"><a href="#cb38-990" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb38-991"><a href="#cb38-991" aria-hidden="true" tabindex="-1"></a>              <span class="dt">percent</span><span class="op">:</span> {</span>
<span id="cb38-992"><a href="#cb38-992" aria-hidden="true" tabindex="-1"></a>                <span class="co">// specific selected value</span></span>
<span id="cb38-993"><a href="#cb38-993" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb38-994"><a href="#cb38-994" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb38-995"><a href="#cb38-995" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> dataColumn <span class="op">=</span> selector<span class="op">.</span><span class="at">dataColumn</span><span class="op">;</span></span>
<span id="cb38-996"><a href="#cb38-996" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// const data = d.properties.data[dataColumn]</span></span>
<span id="cb38-997"><a href="#cb38-997" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> data <span class="op">=</span> <span class="fu">formatPercentNoSymbol</span>(</span>
<span id="cb38-998"><a href="#cb38-998" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">transformPercent</span>(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[dataColumn])</span>
<span id="cb38-999"><a href="#cb38-999" aria-hidden="true" tabindex="-1"></a>                  )<span class="op">;</span></span>
<span id="cb38-1000"><a href="#cb38-1000" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb38-1001"><a href="#cb38-1001" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb38-1002"><a href="#cb38-1002" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb38-1003"><a href="#cb38-1003" aria-hidden="true" tabindex="-1"></a>              <span class="dt">totalPopulation</span><span class="op">:</span> {</span>
<span id="cb38-1004"><a href="#cb38-1004" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> selector<span class="op">.</span><span class="at">labelPop</span><span class="op">,</span></span>
<span id="cb38-1005"><a href="#cb38-1005" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span></span>
<span id="cb38-1006"><a href="#cb38-1006" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">formatNumCompactShort</span>({<span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span>})(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[selector<span class="op">.</span><span class="at">popColumn</span>])</span>
<span id="cb38-1007"><a href="#cb38-1007" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb38-1008"><a href="#cb38-1008" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ac_pov</span><span class="op">:</span> {</span>
<span id="cb38-1009"><a href="#cb38-1009" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> <span class="fu">_getOption</span>(<span class="st">"pov"</span>)<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb38-1010"><a href="#cb38-1010" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb38-1011"><a href="#cb38-1011" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> dataColumn <span class="op">=</span> <span class="fu">_getOption</span>(<span class="st">"pov"</span>)<span class="op">.</span><span class="at">dataColumn</span><span class="op">;</span></span>
<span id="cb38-1012"><a href="#cb38-1012" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> pov_rate <span class="op">=</span> <span class="fu">formatPercentNoSymbol</span>(</span>
<span id="cb38-1013"><a href="#cb38-1013" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">transformPercent</span>(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[dataColumn])</span>
<span id="cb38-1014"><a href="#cb38-1014" aria-hidden="true" tabindex="-1"></a>                  )<span class="op">;</span></span>
<span id="cb38-1015"><a href="#cb38-1015" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>pov_rate<span class="sc">}</span><span class="vs">%`</span></span>
<span id="cb38-1016"><a href="#cb38-1016" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb38-1017"><a href="#cb38-1017" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb38-1018"><a href="#cb38-1018" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ac_edu</span><span class="op">:</span> {</span>
<span id="cb38-1019"><a href="#cb38-1019" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> <span class="fu">_getOption</span>(<span class="st">"edu"</span>)<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb38-1020"><a href="#cb38-1020" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb38-1021"><a href="#cb38-1021" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> dataColumn <span class="op">=</span> <span class="fu">_getOption</span>(<span class="st">"edu"</span>)<span class="op">.</span><span class="at">dataColumn</span><span class="op">;</span></span>
<span id="cb38-1022"><a href="#cb38-1022" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[dataColumn]<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="sc">}</span><span class="vs"> Yrs`</span></span>
<span id="cb38-1023"><a href="#cb38-1023" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// return formatPercentNoSymbol(</span></span>
<span id="cb38-1024"><a href="#cb38-1024" aria-hidden="true" tabindex="-1"></a>                  <span class="co">//   transformPercent(d.properties.data[dataColumn])</span></span>
<span id="cb38-1025"><a href="#cb38-1025" aria-hidden="true" tabindex="-1"></a>                  <span class="co">// );</span></span>
<span id="cb38-1026"><a href="#cb38-1026" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb38-1027"><a href="#cb38-1027" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb38-1028"><a href="#cb38-1028" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ac_fem</span><span class="op">:</span> {</span>
<span id="cb38-1029"><a href="#cb38-1029" aria-hidden="true" tabindex="-1"></a>                <span class="dt">label</span><span class="op">:</span> <span class="fu">_getOption</span>(<span class="st">"fem"</span>)<span class="op">.</span><span class="at">label</span><span class="op">,</span></span>
<span id="cb38-1030"><a href="#cb38-1030" aria-hidden="true" tabindex="-1"></a>                <span class="dt">value</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb38-1031"><a href="#cb38-1031" aria-hidden="true" tabindex="-1"></a>                  <span class="kw">const</span> dataColumn <span class="op">=</span> <span class="fu">_getOption</span>(<span class="st">"fem"</span>)<span class="op">.</span><span class="at">dataColumn</span><span class="op">;</span></span>
<span id="cb38-1032"><a href="#cb38-1032" aria-hidden="true" tabindex="-1"></a>                  <span class="cf">return</span> <span class="fu">formatPercentNoSymbol</span>(</span>
<span id="cb38-1033"><a href="#cb38-1033" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">transformPercent</span>(d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span>[dataColumn])</span>
<span id="cb38-1034"><a href="#cb38-1034" aria-hidden="true" tabindex="-1"></a>                  )<span class="op">;</span></span>
<span id="cb38-1035"><a href="#cb38-1035" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb38-1036"><a href="#cb38-1036" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb38-1037"><a href="#cb38-1037" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb38-1038"><a href="#cb38-1038" aria-hidden="true" tabindex="-1"></a>            <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb38-1039"><a href="#cb38-1039" aria-hidden="true" tabindex="-1"></a>              <span class="dt">name</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb38-1040"><a href="#cb38-1040" aria-hidden="true" tabindex="-1"></a>              <span class="dt">totalPopulation</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb38-1041"><a href="#cb38-1041" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ac_pov</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb38-1042"><a href="#cb38-1042" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ac_edu</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb38-1043"><a href="#cb38-1043" aria-hidden="true" tabindex="-1"></a>              <span class="dt">ac_fem</span><span class="op">:</span> <span class="kw">true</span></span>
<span id="cb38-1044"><a href="#cb38-1044" aria-hidden="true" tabindex="-1"></a>              <span class="co">// percent: true</span></span>
<span id="cb38-1045"><a href="#cb38-1045" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb38-1046"><a href="#cb38-1046" aria-hidden="true" tabindex="-1"></a>          })</span>
<span id="cb38-1047"><a href="#cb38-1047" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb38-1048"><a href="#cb38-1048" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb38-1049"><a href="#cb38-1049" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb38-1050"><a href="#cb38-1050" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb38-1051"><a href="#cb38-1051" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-38" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb39" data-startfrom="1055" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1054"><span id="cb39-1055"><a href="#cb39-1055" aria-hidden="true" tabindex="-1"></a><span class="fu">buildInlineDownloadButton</span>(</span>
<span id="cb39-1056"><a href="#cb39-1056" aria-hidden="true" tabindex="-1"></a>  dataAdaptiveCapacity<span class="op">,</span></span>
<span id="cb39-1057"><a href="#cb39-1057" aria-hidden="true" tabindex="-1"></a>  <span class="fu">_lang</span>(download_translation)<span class="op">,</span></span>
<span id="cb39-1058"><a href="#cb39-1058" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AdaptiveCapacityMap"</span><span class="op">,</span></span>
<span id="cb39-1059"><a href="#cb39-1059" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-39" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb40" data-startfrom="1063" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1062"><span id="cb40-1063"><a href="#cb40-1063" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb40-1064"><a href="#cb40-1064" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> format <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb40-1065"><a href="#cb40-1065" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">title</span>)<span class="op">,</span></span>
<span id="cb40-1066"><a href="#cb40-1066" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb40-1067"><a href="#cb40-1067" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"insight_string"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">quickInsights</span>) }<span class="op">,</span></span>
<span id="cb40-1068"><a href="#cb40-1068" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_selection"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> <span class="fu">getAdminSelection</span>()<span class="op">.</span><span class="at">label</span> }<span class="op">,</span></span>
<span id="cb40-1069"><a href="#cb40-1069" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb40-1070"><a href="#cb40-1070" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb40-1071"><a href="#cb40-1071" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`## </span><span class="sc">${</span>format<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb40-1072"><a href="#cb40-1072" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-40" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb41" data-startfrom="1076" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1075"><span id="cb41-1076"><a href="#cb41-1076" aria-hidden="true" tabindex="-1"></a>textDynamicInsights_adaptiveCapacities2 <span class="op">=</span> {</span>
<span id="cb41-1077"><a href="#cb41-1077" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return md`TODO: based on icicle data`</span></span>
<span id="cb41-1078"><a href="#cb41-1078" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1079"><a href="#cb41-1079" aria-hidden="true" tabindex="-1"></a>  <span class="co">// dynamic insight based on selected region</span></span>
<span id="cb41-1080"><a href="#cb41-1080" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1081"><a href="#cb41-1081" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin2 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb41-1082"><a href="#cb41-1082" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin2MadLib <span class="op">=</span> <span class="fu">adaptiveCapacityInsightMadLib2</span>(</span>
<span id="cb41-1083"><a href="#cb41-1083" aria-hidden="true" tabindex="-1"></a>    dynamicInsights_adaptiveCapacity<span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span></span>
<span id="cb41-1084"><a href="#cb41-1084" aria-hidden="true" tabindex="-1"></a>    admin2</span>
<span id="cb41-1085"><a href="#cb41-1085" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb41-1086"><a href="#cb41-1086" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin1 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb41-1087"><a href="#cb41-1087" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin1MadLib <span class="op">=</span> <span class="fu">adaptiveCapacityInsightMadLib2</span>(</span>
<span id="cb41-1088"><a href="#cb41-1088" aria-hidden="true" tabindex="-1"></a>    dynamicInsights_adaptiveCapacity<span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span></span>
<span id="cb41-1089"><a href="#cb41-1089" aria-hidden="true" tabindex="-1"></a>    admin1</span>
<span id="cb41-1090"><a href="#cb41-1090" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb41-1091"><a href="#cb41-1091" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">label</span> <span class="op">??</span> globalSelection<span class="op">.</span><span class="at">label</span><span class="op">;</span></span>
<span id="cb41-1092"><a href="#cb41-1092" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0Insights <span class="op">=</span> dynamicInsights_adaptiveCapacity<span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">admin0</span><span class="op">;</span></span>
<span id="cb41-1093"><a href="#cb41-1093" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0MadLib <span class="op">=</span> <span class="fu">adaptiveCapacityInsightMadLib2</span>(</span>
<span id="cb41-1094"><a href="#cb41-1094" aria-hidden="true" tabindex="-1"></a>    admin0Insights<span class="op">,</span></span>
<span id="cb41-1095"><a href="#cb41-1095" aria-hidden="true" tabindex="-1"></a>    admin0</span>
<span id="cb41-1096"><a href="#cb41-1096" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb41-1097"><a href="#cb41-1097" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1098"><a href="#cb41-1098" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langWithinAdmin1 <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb41-1099"><a href="#cb41-1099" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">nestedLocationBlurb</span>)<span class="op">,</span></span>
<span id="cb41-1100"><a href="#cb41-1100" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb41-1101"><a href="#cb41-1101" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_inner"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> admin2 }<span class="op">,</span></span>
<span id="cb41-1102"><a href="#cb41-1102" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_outer"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> admin1 }</span>
<span id="cb41-1103"><a href="#cb41-1103" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb41-1104"><a href="#cb41-1104" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb41-1105"><a href="#cb41-1105" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> withinAdmin1 <span class="op">=</span> admin2</span>
<span id="cb41-1106"><a href="#cb41-1106" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>langWithinAdmin1<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb41-1107"><a href="#cb41-1107" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="vs">``</span><span class="op">;</span></span>
<span id="cb41-1108"><a href="#cb41-1108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1109"><a href="#cb41-1109" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langWithinAdmin0 <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb41-1110"><a href="#cb41-1110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">nestedLocationBlurb</span>)<span class="op">,</span></span>
<span id="cb41-1111"><a href="#cb41-1111" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb41-1112"><a href="#cb41-1112" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_inner"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> admin1 }<span class="op">,</span></span>
<span id="cb41-1113"><a href="#cb41-1113" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_outer"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> admin0 }</span>
<span id="cb41-1114"><a href="#cb41-1114" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb41-1115"><a href="#cb41-1115" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb41-1116"><a href="#cb41-1116" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> withinAdmin0 <span class="op">=</span> admin1</span>
<span id="cb41-1117"><a href="#cb41-1117" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>langWithinAdmin0<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb41-1118"><a href="#cb41-1118" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="vs">``</span><span class="op">;</span></span>
<span id="cb41-1119"><a href="#cb41-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1120"><a href="#cb41-1120" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Text sections ------------------------------</span></span>
<span id="cb41-1121"><a href="#cb41-1121" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin2Text <span class="op">=</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>admin2MadLib<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb41-1122"><a href="#cb41-1122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1123"><a href="#cb41-1123" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin1Text <span class="op">=</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>withinAdmin1<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>admin1MadLib<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb41-1124"><a href="#cb41-1124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1125"><a href="#cb41-1125" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0Text <span class="op">=</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>withinAdmin0<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>admin0MadLib<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb41-1126"><a href="#cb41-1126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-1127"><a href="#cb41-1127" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Final text ------------------------------</span></span>
<span id="cb41-1128"><a href="#cb41-1128" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>admin2 <span class="op">?</span> admin2Text <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb41-1129"><a href="#cb41-1129" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>admin1 <span class="op">?</span> admin1Text <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb41-1130"><a href="#cb41-1130" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>admin0Insights <span class="op">?</span> admin0Text <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb41-1131"><a href="#cb41-1131" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">;</span></span>
<span id="cb41-1132"><a href="#cb41-1132" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-41" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb42" data-startfrom="1136" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1135"><span id="cb42-1136"><a href="#cb42-1136" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb42-1137"><a href="#cb42-1137" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">delvingDeeper</span><span class="op">.</span><span class="at">h2</span>)</span>
<span id="cb42-1138"><a href="#cb42-1138" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`## </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb42-1139"><a href="#cb42-1139" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-42" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb43" data-startfrom="1143" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1142"><span id="cb43-1143"><a href="#cb43-1143" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb43-1144"><a href="#cb43-1144" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">delvingDeeper</span><span class="op">.</span><span class="at">intro</span>)</span>
<span id="cb43-1145"><a href="#cb43-1145" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb43-1146"><a href="#cb43-1146" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-43" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb44" data-startfrom="1150" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1149"><span id="cb44-1150"><a href="#cb44-1150" aria-hidden="true" tabindex="-1"></a><span class="co">// format admin selections</span></span>
<span id="cb44-1151"><a href="#cb44-1151" aria-hidden="true" tabindex="-1"></a><span class="co">// bind to appendix inputs, add template to format</span></span>
<span id="cb44-1152"><a href="#cb44-1152" aria-hidden="true" tabindex="-1"></a>Inputs<span class="op">.</span><span class="fu">form</span>(</span>
<span id="cb44-1153"><a href="#cb44-1153" aria-hidden="true" tabindex="-1"></a>  [</span>
<span id="cb44-1154"><a href="#cb44-1154" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb44-1155"><a href="#cb44-1155" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin0<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb44-1156"><a href="#cb44-1156" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin0</span>
<span id="cb44-1157"><a href="#cb44-1157" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb44-1158"><a href="#cb44-1158" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb44-1159"><a href="#cb44-1159" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin1<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb44-1160"><a href="#cb44-1160" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin1</span>
<span id="cb44-1161"><a href="#cb44-1161" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb44-1162"><a href="#cb44-1162" aria-hidden="true" tabindex="-1"></a>    Inputs<span class="op">.</span><span class="fu">bind</span>(</span>
<span id="cb44-1163"><a href="#cb44-1163" aria-hidden="true" tabindex="-1"></a>      Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin2<span class="op">,</span> { <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span> })<span class="op">,</span></span>
<span id="cb44-1164"><a href="#cb44-1164" aria-hidden="true" tabindex="-1"></a>      viewof selectAdmin2</span>
<span id="cb44-1165"><a href="#cb44-1165" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb44-1166"><a href="#cb44-1166" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">,</span></span>
<span id="cb44-1167"><a href="#cb44-1167" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb44-1168"><a href="#cb44-1168" aria-hidden="true" tabindex="-1"></a>    <span class="dt">template</span><span class="op">:</span> adminFormTemplate</span>
<span id="cb44-1169"><a href="#cb44-1169" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb44-1170"><a href="#cb44-1170" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-44" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb45" data-startfrom="1174" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1173"><span id="cb45-1174"><a href="#cb45-1174" aria-hidden="true" tabindex="-1"></a>breadcrumb <span class="op">=</span> {</span>
<span id="cb45-1175"><a href="#cb45-1175" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3</span>
<span id="cb45-1176"><a href="#cb45-1176" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)</span>
<span id="cb45-1177"><a href="#cb45-1177" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>breadcrumbWidth <span class="op">*</span> <span class="fl">4.75</span><span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>breadcrumbHeight<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb45-1178"><a href="#cb45-1178" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font"</span><span class="op">,</span> <span class="st">"11px sans-serif"</span>)</span>
<span id="cb45-1179"><a href="#cb45-1179" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"margin"</span><span class="op">,</span> <span class="st">"2px"</span>)<span class="op">;</span></span>
<span id="cb45-1180"><a href="#cb45-1180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1181"><a href="#cb45-1181" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> g <span class="op">=</span> svg</span>
<span id="cb45-1182"><a href="#cb45-1182" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"g"</span>)</span>
<span id="cb45-1183"><a href="#cb45-1183" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(icicle<span class="op">.</span><span class="at">sequence</span>)</span>
<span id="cb45-1184"><a href="#cb45-1184" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"g"</span>)</span>
<span id="cb45-1185"><a href="#cb45-1185" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> (d<span class="op">,</span> i) <span class="kw">=&gt;</span> <span class="vs">`translate(</span><span class="sc">${</span>i <span class="op">*</span> breadcrumbWidth<span class="sc">}</span><span class="vs">, 0)`</span>)<span class="op">;</span></span>
<span id="cb45-1186"><a href="#cb45-1186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1187"><a href="#cb45-1187" aria-hidden="true" tabindex="-1"></a>  g<span class="op">.</span><span class="fu">append</span>(<span class="st">"polygon"</span>)</span>
<span id="cb45-1188"><a href="#cb45-1188" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"points"</span><span class="op">,</span> breadcrumbPoints)</span>
<span id="cb45-1189"><a href="#cb45-1189" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">icicle_color</span>(d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">name</span>))</span>
<span id="cb45-1190"><a href="#cb45-1190" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"stroke"</span><span class="op">,</span> <span class="st">"white"</span>)<span class="op">;</span></span>
<span id="cb45-1191"><a href="#cb45-1191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1192"><a href="#cb45-1192" aria-hidden="true" tabindex="-1"></a>  g<span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb45-1193"><a href="#cb45-1193" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (breadcrumbWidth <span class="op">+</span> <span class="dv">10</span>) <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb45-1194"><a href="#cb45-1194" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">15</span>)</span>
<span id="cb45-1195"><a href="#cb45-1195" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"0.35em"</span>)</span>
<span id="cb45-1196"><a href="#cb45-1196" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)</span>
<span id="cb45-1197"><a href="#cb45-1197" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"white"</span>)</span>
<span id="cb45-1198"><a href="#cb45-1198" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>((d) <span class="kw">=&gt;</span> icicle_alias[d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">name</span>])<span class="op">;</span></span>
<span id="cb45-1199"><a href="#cb45-1199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1200"><a href="#cb45-1200" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (icicle<span class="op">.</span><span class="at">sequence</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb45-1201"><a href="#cb45-1201" aria-hidden="true" tabindex="-1"></a>    svg</span>
<span id="cb45-1202"><a href="#cb45-1202" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb45-1203"><a href="#cb45-1203" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">text</span>(icicle<span class="op">.</span><span class="at">percentage</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> icicle<span class="op">.</span><span class="at">percentage</span> <span class="op">+</span> <span class="st">"%"</span> <span class="op">:</span> <span class="st">""</span>)</span>
<span id="cb45-1204"><a href="#cb45-1204" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> (icicle<span class="op">.</span><span class="at">sequence</span><span class="op">.</span><span class="at">length</span> <span class="op">+</span> <span class="fl">0.25</span>) <span class="op">*</span> breadcrumbWidth)</span>
<span id="cb45-1205"><a href="#cb45-1205" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> breadcrumbHeight <span class="op">/</span> <span class="dv">2</span>)</span>
<span id="cb45-1206"><a href="#cb45-1206" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">"0.35em"</span>)</span>
<span id="cb45-1207"><a href="#cb45-1207" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">attr</span>(<span class="st">"text-anchor"</span><span class="op">,</span> <span class="st">"middle"</span>)<span class="op">;</span></span>
<span id="cb45-1208"><a href="#cb45-1208" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-1209"><a href="#cb45-1209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-1210"><a href="#cb45-1210" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb45-1211"><a href="#cb45-1211" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-45" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb46" data-startfrom="1215" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1214"><span id="cb46-1215"><a href="#cb46-1215" aria-hidden="true" tabindex="-1"></a>viewof icicle <span class="op">=</span> {</span>
<span id="cb46-1216"><a href="#cb46-1216" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> <span class="bu">root</span> <span class="op">=</span> <span class="fu">partition</span>(icicle_data)<span class="op">;</span></span>
<span id="cb46-1217"><a href="#cb46-1217" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> frozen <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb46-1218"><a href="#cb46-1218" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> frozenSequence <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb46-1219"><a href="#cb46-1219" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const padding = 10;</span></span>
<span id="cb46-1220"><a href="#cb46-1220" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> svg <span class="op">=</span> d3<span class="op">.</span><span class="fu">create</span>(<span class="st">"svg"</span>)<span class="op">;</span></span>
<span id="cb46-1221"><a href="#cb46-1221" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Make this into a view, so that the currently hovered sequence is available to the breadcrumb</span></span>
<span id="cb46-1222"><a href="#cb46-1222" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> element <span class="op">=</span> svg<span class="op">.</span><span class="fu">node</span>()<span class="op">;</span></span>
<span id="cb46-1223"><a href="#cb46-1223" aria-hidden="true" tabindex="-1"></a>  element<span class="op">.</span><span class="at">value</span> <span class="op">=</span> { <span class="dt">sequence</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">percentage</span><span class="op">:</span> <span class="fl">0.0</span> }<span class="op">;</span></span>
<span id="cb46-1224"><a href="#cb46-1224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1225"><a href="#cb46-1225" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb46-1226"><a href="#cb46-1226" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"viewBox"</span><span class="op">,</span> <span class="vs">`0 0 </span><span class="sc">${</span>width<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>height<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb46-1227"><a href="#cb46-1227" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"font"</span><span class="op">,</span> <span class="st">"12px sans-serif"</span>)<span class="op">;</span></span>
<span id="cb46-1228"><a href="#cb46-1228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1229"><a href="#cb46-1229" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb46-1230"><a href="#cb46-1230" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb46-1231"><a href="#cb46-1231" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> width)</span>
<span id="cb46-1232"><a href="#cb46-1232" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> height)</span>
<span id="cb46-1233"><a href="#cb46-1233" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"none"</span>)<span class="op">;</span></span>
<span id="cb46-1234"><a href="#cb46-1234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1235"><a href="#cb46-1235" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> segment <span class="op">=</span> svg</span>
<span id="cb46-1236"><a href="#cb46-1236" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb46-1237"><a href="#cb46-1237" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span></span>
<span id="cb46-1238"><a href="#cb46-1238" aria-hidden="true" tabindex="-1"></a>      narrow <span class="op">?</span> <span class="vs">`translate(</span><span class="sc">${</span><span class="op">-</span><span class="bu">root</span><span class="op">.</span><span class="at">y1</span><span class="sc">}</span><span class="vs">, 40)`</span> <span class="op">:</span> <span class="vs">`translate(0, </span><span class="sc">${</span><span class="op">-</span><span class="bu">root</span><span class="op">.</span><span class="at">y1</span> <span class="op">+</span> <span class="dv">40</span><span class="sc">}</span><span class="vs">)`</span></span>
<span id="cb46-1239"><a href="#cb46-1239" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-1240"><a href="#cb46-1240" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">"rect"</span>)</span>
<span id="cb46-1241"><a href="#cb46-1241" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(</span>
<span id="cb46-1242"><a href="#cb46-1242" aria-hidden="true" tabindex="-1"></a>      <span class="bu">root</span><span class="op">.</span><span class="fu">descendants</span>()<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb46-1243"><a href="#cb46-1243" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">.</span><span class="at">depth</span><span class="op">;</span></span>
<span id="cb46-1244"><a href="#cb46-1244" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb46-1245"><a href="#cb46-1245" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-1246"><a href="#cb46-1246" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">join</span>(<span class="st">"rect"</span>)</span>
<span id="cb46-1247"><a href="#cb46-1247" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> (d) <span class="kw">=&gt;</span> <span class="fu">icicle_color</span>(d<span class="op">.</span><span class="at">data</span><span class="op">.</span><span class="at">name</span>))</span>
<span id="cb46-1248"><a href="#cb46-1248" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> segmentX)</span>
<span id="cb46-1249"><a href="#cb46-1249" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> segmentY)</span>
<span id="cb46-1250"><a href="#cb46-1250" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> segmentWidth)</span>
<span id="cb46-1251"><a href="#cb46-1251" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> segmentHeight)</span>
<span id="cb46-1252"><a href="#cb46-1252" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseenter"</span><span class="op">,</span> (<span class="bu">event</span><span class="op">,</span> d) <span class="kw">=&gt;</span> {</span>
<span id="cb46-1253"><a href="#cb46-1253" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (frozen) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb46-1254"><a href="#cb46-1254" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Get the ancestors of the current segment, minus the root</span></span>
<span id="cb46-1255"><a href="#cb46-1255" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> sequence <span class="op">=</span> d<span class="op">.</span><span class="fu">ancestors</span>()<span class="op">.</span><span class="fu">reverse</span>()<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb46-1256"><a href="#cb46-1256" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Highlight the ancestors</span></span>
<span id="cb46-1257"><a href="#cb46-1257" aria-hidden="true" tabindex="-1"></a>      segment<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> (node) <span class="kw">=&gt;</span></span>
<span id="cb46-1258"><a href="#cb46-1258" aria-hidden="true" tabindex="-1"></a>        sequence<span class="op">.</span><span class="fu">indexOf</span>(node) <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">1.0</span> <span class="op">:</span> <span class="fl">0.3</span></span>
<span id="cb46-1259"><a href="#cb46-1259" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb46-1260"><a href="#cb46-1260" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> percentage <span class="op">=</span> (<span class="dv">100</span> <span class="op">*</span> (d<span class="op">.</span><span class="at">value</span> <span class="op">/</span> <span class="bu">root</span><span class="op">.</span><span class="at">value</span>))<span class="op">.</span><span class="fu">toPrecision</span>(<span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb46-1261"><a href="#cb46-1261" aria-hidden="true" tabindex="-1"></a>      element<span class="op">.</span><span class="at">value</span> <span class="op">=</span> { sequence<span class="op">,</span> percentage }<span class="op">;</span></span>
<span id="cb46-1262"><a href="#cb46-1262" aria-hidden="true" tabindex="-1"></a>      element<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span>))<span class="op">;</span></span>
<span id="cb46-1263"><a href="#cb46-1263" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb46-1264"><a href="#cb46-1264" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> (<span class="bu">event</span><span class="op">,</span> d) <span class="kw">=&gt;</span> {</span>
<span id="cb46-1265"><a href="#cb46-1265" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (frozen) {</span>
<span id="cb46-1266"><a href="#cb46-1266" aria-hidden="true" tabindex="-1"></a>        frozen <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb46-1267"><a href="#cb46-1267" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span><span class="op">;</span></span>
<span id="cb46-1268"><a href="#cb46-1268" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> {</span>
<span id="cb46-1269"><a href="#cb46-1269" aria-hidden="true" tabindex="-1"></a>        frozen <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb46-1270"><a href="#cb46-1270" aria-hidden="true" tabindex="-1"></a>        frozenSequence <span class="op">=</span> d<span class="op">.</span><span class="fu">ancestors</span>()<span class="op">.</span><span class="fu">reverse</span>()<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb46-1271"><a href="#cb46-1271" aria-hidden="true" tabindex="-1"></a>        segment<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> (node) <span class="kw">=&gt;</span></span>
<span id="cb46-1272"><a href="#cb46-1272" aria-hidden="true" tabindex="-1"></a>          frozenSequence<span class="op">.</span><span class="fu">indexOf</span>(node) <span class="op">&gt;=</span> <span class="dv">0</span> <span class="op">?</span> <span class="fl">1.0</span> <span class="op">:</span> <span class="fl">0.3</span></span>
<span id="cb46-1273"><a href="#cb46-1273" aria-hidden="true" tabindex="-1"></a>        )<span class="op">;</span></span>
<span id="cb46-1274"><a href="#cb46-1274" aria-hidden="true" tabindex="-1"></a>        <span class="kw">const</span> percentage <span class="op">=</span> (<span class="dv">100</span> <span class="op">*</span> (d<span class="op">.</span><span class="at">value</span> <span class="op">/</span> <span class="bu">root</span><span class="op">.</span><span class="at">value</span>))<span class="op">.</span><span class="fu">toPrecision</span>(<span class="dv">3</span>)<span class="op">;</span></span>
<span id="cb46-1275"><a href="#cb46-1275" aria-hidden="true" tabindex="-1"></a>        element<span class="op">.</span><span class="at">value</span> <span class="op">=</span> { <span class="dt">sequence</span><span class="op">:</span> frozenSequence<span class="op">,</span> percentage }<span class="op">;</span></span>
<span id="cb46-1276"><a href="#cb46-1276" aria-hidden="true" tabindex="-1"></a>        element<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span>))<span class="op">;</span></span>
<span id="cb46-1277"><a href="#cb46-1277" aria-hidden="true" tabindex="-1"></a>        <span class="bu">event</span><span class="op">.</span><span class="fu">stopPropagation</span>()<span class="op">;</span> <span class="co">// prevent svg click from firing</span></span>
<span id="cb46-1278"><a href="#cb46-1278" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb46-1279"><a href="#cb46-1279" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb46-1280"><a href="#cb46-1280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1281"><a href="#cb46-1281" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"mouseleave"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb46-1282"><a href="#cb46-1282" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (frozen) <span class="cf">return</span><span class="op">;</span></span>
<span id="cb46-1283"><a href="#cb46-1283" aria-hidden="true" tabindex="-1"></a>    segment<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb46-1284"><a href="#cb46-1284" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Update the value of this view</span></span>
<span id="cb46-1285"><a href="#cb46-1285" aria-hidden="true" tabindex="-1"></a>    element<span class="op">.</span><span class="at">value</span> <span class="op">=</span> { <span class="dt">sequence</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">percentage</span><span class="op">:</span> <span class="fl">0.0</span> }<span class="op">;</span></span>
<span id="cb46-1286"><a href="#cb46-1286" aria-hidden="true" tabindex="-1"></a>    element<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span>))<span class="op">;</span></span>
<span id="cb46-1287"><a href="#cb46-1287" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb46-1288"><a href="#cb46-1288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1289"><a href="#cb46-1289" aria-hidden="true" tabindex="-1"></a>  svg<span class="op">.</span><span class="fu">on</span>(<span class="st">"click"</span><span class="op">,</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb46-1290"><a href="#cb46-1290" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (frozen) {</span>
<span id="cb46-1291"><a href="#cb46-1291" aria-hidden="true" tabindex="-1"></a>      frozen <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb46-1292"><a href="#cb46-1292" aria-hidden="true" tabindex="-1"></a>      frozenSequence <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb46-1293"><a href="#cb46-1293" aria-hidden="true" tabindex="-1"></a>      segment<span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill-opacity"</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb46-1294"><a href="#cb46-1294" aria-hidden="true" tabindex="-1"></a>      element<span class="op">.</span><span class="at">value</span> <span class="op">=</span> { <span class="dt">sequence</span><span class="op">:</span> []<span class="op">,</span> <span class="dt">percentage</span><span class="op">:</span> <span class="fl">0.0</span> }<span class="op">;</span></span>
<span id="cb46-1295"><a href="#cb46-1295" aria-hidden="true" tabindex="-1"></a>      element<span class="op">.</span><span class="fu">dispatchEvent</span>(<span class="kw">new</span> <span class="bu">CustomEvent</span>(<span class="st">"input"</span>))<span class="op">;</span></span>
<span id="cb46-1296"><a href="#cb46-1296" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb46-1297"><a href="#cb46-1297" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb46-1298"><a href="#cb46-1298" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1299"><a href="#cb46-1299" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add legend</span></span>
<span id="cb46-1300"><a href="#cb46-1300" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> colorScale <span class="op">=</span> d3</span>
<span id="cb46-1301"><a href="#cb46-1301" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">scaleOrdinal</span>()</span>
<span id="cb46-1302"><a href="#cb46-1302" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">domain</span>([<span class="st">"Better"</span><span class="op">,</span> <span class="st">"Moderate"</span><span class="op">,</span> <span class="st">"Worse"</span>])</span>
<span id="cb46-1303"><a href="#cb46-1303" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">range</span>([<span class="st">"#F4BB21"</span><span class="op">,</span> <span class="st">"#FC8A34"</span><span class="op">,</span> <span class="st">"#EC5A47"</span>])<span class="op">;</span></span>
<span id="cb46-1304"><a href="#cb46-1304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1305"><a href="#cb46-1305" aria-hidden="true" tabindex="-1"></a>  svg</span>
<span id="cb46-1306"><a href="#cb46-1306" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb46-1307"><a href="#cb46-1307" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">1</span>)</span>
<span id="cb46-1308"><a href="#cb46-1308" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">5</span>)</span>
<span id="cb46-1309"><a href="#cb46-1309" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"rx"</span><span class="op">,</span> <span class="dv">10</span>) <span class="co">// Add rounded corners</span></span>
<span id="cb46-1310"><a href="#cb46-1310" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"ry"</span><span class="op">,</span> <span class="dv">10</span>) <span class="co">// Add rounded corners</span></span>
<span id="cb46-1311"><a href="#cb46-1311" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">300</span>) <span class="co">// Adjust the width to fit the legend</span></span>
<span id="cb46-1312"><a href="#cb46-1312" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">30</span>) <span class="co">// Adjust the height to fit the legend</span></span>
<span id="cb46-1313"><a href="#cb46-1313" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"fill"</span><span class="op">,</span> <span class="st">"#fff"</span>)<span class="op">;</span></span>
<span id="cb46-1314"><a href="#cb46-1314" aria-hidden="true" tabindex="-1"></a>  <span class="co">// .attr("stroke", "black");</span></span>
<span id="cb46-1315"><a href="#cb46-1315" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1316"><a href="#cb46-1316" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> legend <span class="op">=</span> svg</span>
<span id="cb46-1317"><a href="#cb46-1317" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">selectAll</span>(<span class="st">".legend"</span>)</span>
<span id="cb46-1318"><a href="#cb46-1318" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">data</span>(colorScale<span class="op">.</span><span class="fu">domain</span>())</span>
<span id="cb46-1319"><a href="#cb46-1319" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">enter</span>()</span>
<span id="cb46-1320"><a href="#cb46-1320" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"g"</span>)</span>
<span id="cb46-1321"><a href="#cb46-1321" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"class"</span><span class="op">,</span> <span class="st">"legend"</span>)</span>
<span id="cb46-1322"><a href="#cb46-1322" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"transform"</span><span class="op">,</span> <span class="kw">function</span> (d<span class="op">,</span> i) {</span>
<span id="cb46-1323"><a href="#cb46-1323" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="st">"translate("</span> <span class="op">+</span> (i <span class="op">*</span> <span class="dv">100</span> <span class="op">+</span> <span class="dv">25</span>) <span class="op">+</span> <span class="st">",11)"</span><span class="op">;</span></span>
<span id="cb46-1324"><a href="#cb46-1324" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb46-1325"><a href="#cb46-1325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1326"><a href="#cb46-1326" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb46-1327"><a href="#cb46-1327" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"rect"</span>)</span>
<span id="cb46-1328"><a href="#cb46-1328" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">0</span>)</span>
<span id="cb46-1329"><a href="#cb46-1329" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"width"</span><span class="op">,</span> <span class="dv">18</span>)</span>
<span id="cb46-1330"><a href="#cb46-1330" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"height"</span><span class="op">,</span> <span class="dv">18</span>)</span>
<span id="cb46-1331"><a href="#cb46-1331" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">style</span>(<span class="st">"fill"</span><span class="op">,</span> colorScale)<span class="op">;</span></span>
<span id="cb46-1332"><a href="#cb46-1332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1333"><a href="#cb46-1333" aria-hidden="true" tabindex="-1"></a>  legend</span>
<span id="cb46-1334"><a href="#cb46-1334" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">append</span>(<span class="st">"text"</span>)</span>
<span id="cb46-1335"><a href="#cb46-1335" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"x"</span><span class="op">,</span> <span class="dv">24</span>)</span>
<span id="cb46-1336"><a href="#cb46-1336" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"y"</span><span class="op">,</span> <span class="dv">9</span>)</span>
<span id="cb46-1337"><a href="#cb46-1337" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">attr</span>(<span class="st">"dy"</span><span class="op">,</span> <span class="st">".35em"</span>)</span>
<span id="cb46-1338"><a href="#cb46-1338" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">text</span>(<span class="kw">function</span> (d) {</span>
<span id="cb46-1339"><a href="#cb46-1339" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb46-1340"><a href="#cb46-1340" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb46-1341"><a href="#cb46-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-1342"><a href="#cb46-1342" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> element<span class="op">;</span></span>
<span id="cb46-1343"><a href="#cb46-1343" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-46" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb47" data-startfrom="1347" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1346"><span id="cb47-1347"><a href="#cb47-1347" aria-hidden="true" tabindex="-1"></a>icicle_pct_table <span class="op">=</span> {</span>
<span id="cb47-1348"><a href="#cb47-1348" aria-hidden="true" tabindex="-1"></a>  <span class="co">// A little function to basically calcualte the same thing as the breadcrumb but for all the admin region.</span></span>
<span id="cb47-1349"><a href="#cb47-1349" aria-hidden="true" tabindex="-1"></a>  <span class="co">// This is what users should see if going to a tabular view and also what they should download. It is much easier to understand and work with.</span></span>
<span id="cb47-1350"><a href="#cb47-1350" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> summarize_icicle <span class="op">=</span> (csv<span class="op">,</span> icicle_keys <span class="op">=</span> <span class="kw">null</span>) <span class="kw">=&gt;</span> {</span>
<span id="cb47-1351"><a href="#cb47-1351" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> rows <span class="op">=</span> csv<span class="op">.</span><span class="fu">map</span>(row <span class="kw">=&gt;</span> ({</span>
<span id="cb47-1352"><a href="#cb47-1352" aria-hidden="true" tabindex="-1"></a>      <span class="dt">parts</span><span class="op">:</span> row<span class="op">.</span><span class="at">path</span><span class="op">.</span><span class="fu">split</span>(<span class="st">"_"</span>)<span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)<span class="op">,</span></span>
<span id="cb47-1353"><a href="#cb47-1353" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="op">+</span>row<span class="op">.</span><span class="at">value</span></span>
<span id="cb47-1354"><a href="#cb47-1354" aria-hidden="true" tabindex="-1"></a>    }))<span class="op">;</span></span>
<span id="cb47-1355"><a href="#cb47-1355" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> total <span class="op">=</span> d3<span class="op">.</span><span class="fu">sum</span>(rows<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb47-1356"><a href="#cb47-1356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1357"><a href="#cb47-1357" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> maxDepth <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span>(<span class="op">...</span>rows<span class="op">.</span><span class="fu">map</span>((r) <span class="kw">=&gt;</span> r<span class="op">.</span><span class="at">parts</span><span class="op">.</span><span class="at">length</span>))<span class="op">;</span></span>
<span id="cb47-1358"><a href="#cb47-1358" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> levelNames <span class="op">=</span> icicle_keys</span>
<span id="cb47-1359"><a href="#cb47-1359" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(icicle_keys)</span>
<span id="cb47-1360"><a href="#cb47-1360" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> [<span class="op">...</span><span class="bu">Array</span>(maxDepth)<span class="op">.</span><span class="fu">keys</span>()]<span class="op">.</span><span class="fu">map</span>((i) <span class="kw">=&gt;</span> <span class="vs">`level</span><span class="sc">${</span>i <span class="op">+</span> <span class="dv">1</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb47-1361"><a href="#cb47-1361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1362"><a href="#cb47-1362" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> lookupName <span class="op">=</span> (dim<span class="op">,</span> key) <span class="kw">=&gt;</span> {</span>
<span id="cb47-1363"><a href="#cb47-1363" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>icicle_keys) <span class="cf">return</span> key<span class="op">;</span></span>
<span id="cb47-1364"><a href="#cb47-1364" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> icicle_keys[dim]<span class="op">?.</span>[key]<span class="op">?.</span>[<span class="dv">0</span>] <span class="op">??</span> key<span class="op">;</span></span>
<span id="cb47-1365"><a href="#cb47-1365" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb47-1366"><a href="#cb47-1366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1367"><a href="#cb47-1367" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> genderTotals <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb47-1368"><a href="#cb47-1368" aria-hidden="true" tabindex="-1"></a>    rows<span class="op">.</span><span class="fu">forEach</span>((r) <span class="kw">=&gt;</span> {</span>
<span id="cb47-1369"><a href="#cb47-1369" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> gender <span class="op">=</span> r<span class="op">.</span><span class="at">parts</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb47-1370"><a href="#cb47-1370" aria-hidden="true" tabindex="-1"></a>      genderTotals[gender] <span class="op">=</span> (genderTotals[gender] <span class="op">||</span> <span class="dv">0</span>) <span class="op">+</span> r<span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb47-1371"><a href="#cb47-1371" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb47-1372"><a href="#cb47-1372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1373"><a href="#cb47-1373" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Recursive helper</span></span>
<span id="cb47-1374"><a href="#cb47-1374" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> recurse <span class="op">=</span> (rows<span class="op">,</span> depth <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> prefix <span class="op">=</span> []) <span class="kw">=&gt;</span> {</span>
<span id="cb47-1375"><a href="#cb47-1375" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>rows<span class="op">.</span><span class="at">length</span>) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb47-1376"><a href="#cb47-1376" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (depth <span class="op">&gt;=</span> maxDepth) <span class="cf">return</span> []<span class="op">;</span></span>
<span id="cb47-1377"><a href="#cb47-1377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1378"><a href="#cb47-1378" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> d3</span>
<span id="cb47-1379"><a href="#cb47-1379" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">rollups</span>(</span>
<span id="cb47-1380"><a href="#cb47-1380" aria-hidden="true" tabindex="-1"></a>          rows<span class="op">,</span></span>
<span id="cb47-1381"><a href="#cb47-1381" aria-hidden="true" tabindex="-1"></a>          (v) <span class="kw">=&gt;</span> d3<span class="op">.</span><span class="fu">sum</span>(v<span class="op">,</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb47-1382"><a href="#cb47-1382" aria-hidden="true" tabindex="-1"></a>          (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">parts</span>[depth]</span>
<span id="cb47-1383"><a href="#cb47-1383" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb47-1384"><a href="#cb47-1384" aria-hidden="true" tabindex="-1"></a>        <span class="op">.</span><span class="fu">flatMap</span>(([k<span class="op">,</span> sum]) <span class="kw">=&gt;</span> {</span>
<span id="cb47-1385"><a href="#cb47-1385" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> current <span class="op">=</span> [<span class="op">...</span>prefix<span class="op">,</span> k]<span class="op">;</span></span>
<span id="cb47-1386"><a href="#cb47-1386" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> rowObj <span class="op">=</span> {}<span class="op">;</span></span>
<span id="cb47-1387"><a href="#cb47-1387" aria-hidden="true" tabindex="-1"></a>          levelNames<span class="op">.</span><span class="fu">forEach</span>((col<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb47-1388"><a href="#cb47-1388" aria-hidden="true" tabindex="-1"></a>            rowObj[col] <span class="op">=</span> current[i] <span class="op">?</span> <span class="fu">lookupName</span>(col<span class="op">,</span> current[i]) <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb47-1389"><a href="#cb47-1389" aria-hidden="true" tabindex="-1"></a>          })<span class="op">;</span></span>
<span id="cb47-1390"><a href="#cb47-1390" aria-hidden="true" tabindex="-1"></a>          rowObj<span class="op">.</span><span class="at">pct_total</span> <span class="op">=</span> (<span class="dv">100</span> <span class="op">*</span> sum) <span class="op">/</span> total<span class="op">;</span></span>
<span id="cb47-1391"><a href="#cb47-1391" aria-hidden="true" tabindex="-1"></a>          <span class="co">// pct relative to gender</span></span>
<span id="cb47-1392"><a href="#cb47-1392" aria-hidden="true" tabindex="-1"></a>          <span class="kw">const</span> genderKey <span class="op">=</span> prefix[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb47-1393"><a href="#cb47-1393" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (genderKey <span class="op">&amp;&amp;</span> genderTotals[genderKey]) {</span>
<span id="cb47-1394"><a href="#cb47-1394" aria-hidden="true" tabindex="-1"></a>            rowObj<span class="op">.</span><span class="at">pct_of_gender</span> <span class="op">=</span> (<span class="dv">100</span> <span class="op">*</span> sum) <span class="op">/</span> genderTotals[genderKey]<span class="op">;</span></span>
<span id="cb47-1395"><a href="#cb47-1395" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb47-1396"><a href="#cb47-1396" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> [</span>
<span id="cb47-1397"><a href="#cb47-1397" aria-hidden="true" tabindex="-1"></a>            rowObj<span class="op">,</span></span>
<span id="cb47-1398"><a href="#cb47-1398" aria-hidden="true" tabindex="-1"></a>            <span class="op">...</span><span class="fu">recurse</span>(</span>
<span id="cb47-1399"><a href="#cb47-1399" aria-hidden="true" tabindex="-1"></a>              rows<span class="op">.</span><span class="fu">filter</span>((r) <span class="kw">=&gt;</span> r<span class="op">.</span><span class="at">parts</span>[depth] <span class="op">===</span> k)<span class="op">,</span></span>
<span id="cb47-1400"><a href="#cb47-1400" aria-hidden="true" tabindex="-1"></a>              depth <span class="op">+</span> <span class="dv">1</span><span class="op">,</span></span>
<span id="cb47-1401"><a href="#cb47-1401" aria-hidden="true" tabindex="-1"></a>              current</span>
<span id="cb47-1402"><a href="#cb47-1402" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb47-1403"><a href="#cb47-1403" aria-hidden="true" tabindex="-1"></a>          ]<span class="op">;</span></span>
<span id="cb47-1404"><a href="#cb47-1404" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb47-1405"><a href="#cb47-1405" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb47-1406"><a href="#cb47-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1407"><a href="#cb47-1407" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">recurse</span>(rows)<span class="op">;</span></span>
<span id="cb47-1408"><a href="#cb47-1408" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb47-1409"><a href="#cb47-1409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-1410"><a href="#cb47-1410" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">buildInlineDownloadButton</span>(</span>
<span id="cb47-1411"><a href="#cb47-1411" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize_icicle</span>(icicle_raw<span class="op">,</span> icicle_keys)<span class="op">,</span></span>
<span id="cb47-1412"><a href="#cb47-1412" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(download_translation)<span class="op">,</span></span>
<span id="cb47-1413"><a href="#cb47-1413" aria-hidden="true" tabindex="-1"></a>    <span class="vs">`AdaptiveCapacityIcicle_</span><span class="sc">${</span>selectAdmin0<span class="op">.</span><span class="at">label</span><span class="op">.</span><span class="fu">replace</span>(<span class="ss">/</span><span class="sc">\s</span><span class="ss">/g</span><span class="op">,</span> <span class="st">""</span>)<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb47-1414"><a href="#cb47-1414" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-1415"><a href="#cb47-1415" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb47-1416"><a href="#cb47-1416" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-47" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb48" data-startfrom="1420" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1419"><span id="cb48-1420"><a href="#cb48-1420" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb48-1421"><a href="#cb48-1421" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">summary</span><span class="op">.</span><span class="at">h1</span>)</span>
<span id="cb48-1422"><a href="#cb48-1422" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb48-1423"><a href="#cb48-1423" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-48" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb49" data-startfrom="1427" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1426"><span id="cb49-1427"><a href="#cb49-1427" aria-hidden="true" tabindex="-1"></a>dynamicSummaryCell <span class="op">=</span> {</span>
<span id="cb49-1428"><a href="#cb49-1428" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> dynamicSummary <span class="op">=</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb49-1429"><a href="#cb49-1429" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add filter to do nothing in case where no admin0 is selected</span></span>
<span id="cb49-1430"><a href="#cb49-1430" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span> <span class="op">!==</span> <span class="kw">null</span>) {</span>
<span id="cb49-1431"><a href="#cb49-1431" aria-hidden="true" tabindex="-1"></a>    dynamicSummary <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb49-1432"><a href="#cb49-1432" aria-hidden="true" tabindex="-1"></a>      <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">summary</span><span class="op">.</span><span class="at">dynamicSummarylist</span>)<span class="op">,</span></span>
<span id="cb49-1433"><a href="#cb49-1433" aria-hidden="true" tabindex="-1"></a>      [{ <span class="dt">name</span><span class="op">:</span> <span class="st">"markdownList"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> dynamicSummaryMarkdown }]</span>
<span id="cb49-1434"><a href="#cb49-1434" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb49-1435"><a href="#cb49-1435" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb49-1436"><a href="#cb49-1436" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0 <span class="op">=</span> <span class="fu">_lang</span>(</span>
<span id="cb49-1437"><a href="#cb49-1437" aria-hidden="true" tabindex="-1"></a>    td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[<span class="fu">getAdminSelectionAdmin0</span>()<span class="op">.</span><span class="at">value</span> <span class="op">??</span> <span class="st">'SSA'</span>][<span class="st">"article3"</span>]</span>
<span id="cb49-1438"><a href="#cb49-1438" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb49-1439"><a href="#cb49-1439" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> intro <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb49-1440"><a href="#cb49-1440" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">summary</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">dynamicSummary</span><span class="op">.</span><span class="at">intro</span>)<span class="op">,</span></span>
<span id="cb49-1441"><a href="#cb49-1441" aria-hidden="true" tabindex="-1"></a>    [{ <span class="dt">name</span><span class="op">:</span> <span class="st">"admin0"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> admin0 }]</span>
<span id="cb49-1442"><a href="#cb49-1442" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb49-1443"><a href="#cb49-1443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-1444"><a href="#cb49-1444" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>intro<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>dynamicSummary<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb49-1445"><a href="#cb49-1445" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-49" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb50" data-startfrom="1449" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1448"><span id="cb50-1449"><a href="#cb50-1449" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb50-1450"><a href="#cb50-1450" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">summary</span><span class="op">.</span><span class="at">blocks</span><span class="op">.</span><span class="at">closer</span>)</span>
<span id="cb50-1451"><a href="#cb50-1451" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb50-1452"><a href="#cb50-1452" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-50" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb51" data-startfrom="1456" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1455"><span id="cb51-1456"><a href="#cb51-1456" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb51-1457"><a href="#cb51-1457" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">h1</span>)</span>
<span id="cb51-1458"><a href="#cb51-1458" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`# </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb51-1459"><a href="#cb51-1459" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-51" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb52" data-startfrom="1463" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1462"><span id="cb52-1463"><a href="#cb52-1463" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb52-1464"><a href="#cb52-1464" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">section1</span>)</span>
<span id="cb52-1465"><a href="#cb52-1465" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`## </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb52-1466"><a href="#cb52-1466" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-52" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb53" data-startfrom="1470" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1469"><span id="cb53-1470"><a href="#cb53-1470" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb53-1471"><a href="#cb53-1471" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">section1</span><span class="op">.</span><span class="at">subsections</span>)<span class="op">;</span></span>
<span id="cb53-1472"><a href="#cb53-1472" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb53-1473"><a href="#cb53-1473" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-53" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb54" data-startfrom="1477" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1476"><span id="cb54-1477"><a href="#cb54-1477" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb54-1478"><a href="#cb54-1478" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">section2</span>)</span>
<span id="cb54-1479"><a href="#cb54-1479" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`## </span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb54-1480"><a href="#cb54-1480" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-54" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb55" data-startfrom="1484" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1483"><span id="cb55-1484"><a href="#cb55-1484" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb55-1485"><a href="#cb55-1485" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">methods</span><span class="op">.</span><span class="at">section2</span><span class="op">.</span><span class="at">subsections</span>)</span>
<span id="cb55-1486"><a href="#cb55-1486" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb55-1487"><a href="#cb55-1487" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-55" data-nodetype="expression"></div></div></div><section id="appendix" class="level1 hidden"><h1 class="hidden">Appendix</h1><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb56" data-startfrom="1493" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1492"><span id="cb56-1493"><a href="#cb56-1493" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb56-1494"><a href="#cb56-1494" aria-hidden="true" tabindex="-1"></a><span class="vs">## Work by Topic</span></span>
<span id="cb56-1495"><a href="#cb56-1495" aria-hidden="true" tabindex="-1"></a><span class="vs">*Cells that power different sections*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-56" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb57" data-startfrom="1499" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1498"><span id="cb57-1499"><a href="#cb57-1499" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb57-1500"><a href="#cb57-1500" aria-hidden="true" tabindex="-1"></a><span class="vs">### Support notebook</span></span>
<span id="cb57-1501"><a href="#cb57-1501" aria-hidden="true" tabindex="-1"></a><span class="vs">[Support Notebook](https://observablehq.com/@periscopic/ab-atlas-spotlight-support): used for imports across spotlights.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-57" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb58" data-startfrom="1505" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1504"><span id="cb58-1505"><a href="#cb58-1505" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb58-1506"><a href="#cb58-1506" aria-hidden="true" tabindex="-1"></a><span class="vs">### Notebook Variables</span></span>
<span id="cb58-1507"><a href="#cb58-1507" aria-hidden="true" tabindex="-1"></a><span class="vs">_Main variables across notebook_`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-58" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb59" data-startfrom="1511" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1510"><span id="cb59-1511"><a href="#cb59-1511" aria-hidden="true" tabindex="-1"></a><span class="co">// main title of the notebook</span></span>
<span id="cb59-1512"><a href="#cb59-1512" aria-hidden="true" tabindex="-1"></a>notebookTitle <span class="op">=</span> <span class="fu">_lang</span>({</span>
<span id="cb59-1513"><a href="#cb59-1513" aria-hidden="true" tabindex="-1"></a>  <span class="dt">en</span><span class="op">:</span> <span class="st">"Evaluate Climate Risks"</span><span class="op">,</span></span>
<span id="cb59-1514"><a href="#cb59-1514" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Evaluer les risques climatiques"</span><span class="op">,</span></span>
<span id="cb59-1515"><a href="#cb59-1515" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-59" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb60" data-startfrom="1519" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1518"><span id="cb60-1519"><a href="#cb60-1519" aria-hidden="true" tabindex="-1"></a><span class="co">// info for the admin selectors</span></span>
<span id="cb60-1520"><a href="#cb60-1520" aria-hidden="true" tabindex="-1"></a>adminRegions <span class="op">=</span> {</span>
<span id="cb60-1521"><a href="#cb60-1521" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb60-1522"><a href="#cb60-1522" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labels</span><span class="op">:</span> {</span>
<span id="cb60-1523"><a href="#cb60-1523" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin0</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(</span>
<span id="cb60-1524"><a href="#cb60-1524" aria-hidden="true" tabindex="-1"></a>        <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">country</span><span class="op">.</span><span class="at">singular</span>)</span>
<span id="cb60-1525"><a href="#cb60-1525" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb60-1526"><a href="#cb60-1526" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin1</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(</span>
<span id="cb60-1527"><a href="#cb60-1527" aria-hidden="true" tabindex="-1"></a>        <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">region</span><span class="op">.</span><span class="at">singular</span>)</span>
<span id="cb60-1528"><a href="#cb60-1528" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb60-1529"><a href="#cb60-1529" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin2</span><span class="op">:</span> Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(</span>
<span id="cb60-1530"><a href="#cb60-1530" aria-hidden="true" tabindex="-1"></a>        <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">words</span><span class="op">.</span><span class="at">subregion</span><span class="op">.</span><span class="at">singular</span>)</span>
<span id="cb60-1531"><a href="#cb60-1531" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb60-1532"><a href="#cb60-1532" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb60-1533"><a href="#cb60-1533" aria-hidden="true" tabindex="-1"></a>    <span class="dt">allLabels</span><span class="op">:</span> {</span>
<span id="cb60-1534"><a href="#cb60-1534" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin1</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">allRegions</span>)<span class="op">,</span></span>
<span id="cb60-1535"><a href="#cb60-1535" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin2</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">supportNbText</span><span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">allSubregions</span>)<span class="op">,</span></span>
<span id="cb60-1536"><a href="#cb60-1536" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-1537"><a href="#cb60-1537" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb60-1538"><a href="#cb60-1538" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-60" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb61" data-startfrom="1542" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1541"><span id="cb61-1542"><a href="#cb61-1542" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getLowerLevelAdminLabel</span>(selections <span class="op">=</span> adminSelections) {</span>
<span id="cb61-1543"><a href="#cb61-1543" aria-hidden="true" tabindex="-1"></a>  <span class="co">// based on admin selection, get the lower level label</span></span>
<span id="cb61-1544"><a href="#cb61-1544" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">;</span></span>
<span id="cb61-1545"><a href="#cb61-1545" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">;</span></span>
<span id="cb61-1546"><a href="#cb61-1546" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin1</span><span class="op">;</span></span>
<span id="cb61-1547"><a href="#cb61-1547" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">;</span></span>
<span id="cb61-1548"><a href="#cb61-1548" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-61" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb62" data-startfrom="1552" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1551"><span id="cb62-1552"><a href="#cb62-1552" aria-hidden="true" tabindex="-1"></a><span class="co">// width of the maps</span></span>
<span id="cb62-1553"><a href="#cb62-1553" aria-hidden="true" tabindex="-1"></a>mapWidth <span class="op">=</span> <span class="dv">625</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-62" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb63" data-startfrom="1557" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1556"><span id="cb63-1557"><a href="#cb63-1557" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`**Language and notebook text**`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-63" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb64" data-startfrom="1561" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1560"><span id="cb64-1561"><a href="#cb64-1561" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Lang } <span class="im">from</span> <span class="st">"7d46679f7d0d917e"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-64" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb65" data-startfrom="1565" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1564"><span id="cb65-1565"><a href="#cb65-1565" aria-hidden="true" tabindex="-1"></a>languages <span class="op">=</span> [</span>
<span id="cb65-1566"><a href="#cb65-1566" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">"en"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"English"</span><span class="op">,</span> <span class="dt">locale</span><span class="op">:</span> <span class="st">"en-US"</span> }<span class="op">,</span></span>
<span id="cb65-1567"><a href="#cb65-1567" aria-hidden="true" tabindex="-1"></a>  { <span class="dt">key</span><span class="op">:</span> <span class="st">"fr"</span><span class="op">,</span> <span class="dt">label</span><span class="op">:</span> <span class="st">"Franais"</span><span class="op">,</span> <span class="dt">locale</span><span class="op">:</span> <span class="st">"fr-FR"</span> }<span class="op">,</span></span>
<span id="cb65-1568"><a href="#cb65-1568" aria-hidden="true" tabindex="-1"></a>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-65" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb66" data-startfrom="1572" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1571"><span id="cb66-1572"><a href="#cb66-1572" aria-hidden="true" tabindex="-1"></a><span class="co">// get the default language key from parameter, or use default</span></span>
<span id="cb66-1573"><a href="#cb66-1573" aria-hidden="true" tabindex="-1"></a>defaultLangKey <span class="op">=</span> {</span>
<span id="cb66-1574"><a href="#cb66-1574" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> name <span class="op">=</span> <span class="st">"lang"</span><span class="op">;</span></span>
<span id="cb66-1575"><a href="#cb66-1575" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> list <span class="op">=</span> languages<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span>
<span id="cb66-1576"><a href="#cb66-1576" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> defaultKey <span class="op">=</span> <span class="st">"en"</span><span class="op">;</span></span>
<span id="cb66-1577"><a href="#cb66-1577" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-1578"><a href="#cb66-1578" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> queryParam <span class="op">=</span> <span class="cf">await</span> Lang<span class="op">.</span><span class="fu">getParamFromList</span>({ name<span class="op">,</span> list })<span class="op">;</span></span>
<span id="cb66-1579"><a href="#cb66-1579" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-1580"><a href="#cb66-1580" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> queryParam <span class="op">??</span> defaultKey<span class="op">;</span></span>
<span id="cb66-1581"><a href="#cb66-1581" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-66" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb67" data-startfrom="1585" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1584"><span id="cb67-1585"><a href="#cb67-1585" aria-hidden="true" tabindex="-1"></a><span class="co">// helper shorthand for Lang text-getting</span></span>
<span id="cb67-1586"><a href="#cb67-1586" aria-hidden="true" tabindex="-1"></a>_lang <span class="op">=</span> Lang<span class="op">.</span><span class="fu">lg</span>(language<span class="op">.</span><span class="at">key</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-67" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb68" data-startfrom="1590" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1589"><span id="cb68-1590"><a href="#cb68-1590" aria-hidden="true" tabindex="-1"></a><span class="co">// main toggle of language key</span></span>
<span id="cb68-1591"><a href="#cb68-1591" aria-hidden="true" tabindex="-1"></a>viewof language <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">radio</span>(languages<span class="op">,</span> {</span>
<span id="cb68-1592"><a href="#cb68-1592" aria-hidden="true" tabindex="-1"></a>  <span class="dt">label</span><span class="op">:</span> <span class="st">"Main language toggle"</span><span class="op">,</span></span>
<span id="cb68-1593"><a href="#cb68-1593" aria-hidden="true" tabindex="-1"></a>  <span class="dt">format</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">key</span><span class="op">,</span></span>
<span id="cb68-1594"><a href="#cb68-1594" aria-hidden="true" tabindex="-1"></a>  <span class="dt">value</span><span class="op">:</span> languages<span class="op">.</span><span class="fu">find</span>((x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">key</span> <span class="op">===</span> defaultLangKey)<span class="op">,</span></span>
<span id="cb68-1595"><a href="#cb68-1595" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-68" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb69" data-startfrom="1599" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 1598"><span id="cb69-1599"><a href="#cb69-1599" aria-hidden="true" tabindex="-1"></a>nbText <span class="op">=</span> {</span>
<span id="cb69-1600"><a href="#cb69-1600" aria-hidden="true" tabindex="-1"></a>  <span class="co">// text in the notebook</span></span>
<span id="cb69-1601"><a href="#cb69-1601" aria-hidden="true" tabindex="-1"></a>  <span class="co">// recommendation: only use objects for better tab-completion</span></span>
<span id="cb69-1602"><a href="#cb69-1602" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb69-1603"><a href="#cb69-1603" aria-hidden="true" tabindex="-1"></a>    <span class="dt">supportNbText</span><span class="op">:</span> {</span>
<span id="cb69-1604"><a href="#cb69-1604" aria-hidden="true" tabindex="-1"></a>      <span class="dt">labels</span><span class="op">:</span> {</span>
<span id="cb69-1605"><a href="#cb69-1605" aria-hidden="true" tabindex="-1"></a>        <span class="dt">allRegions</span><span class="op">:</span> {</span>
<span id="cb69-1606"><a href="#cb69-1606" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"All regions"</span><span class="op">,</span></span>
<span id="cb69-1607"><a href="#cb69-1607" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Toutes les rgions"</span></span>
<span id="cb69-1608"><a href="#cb69-1608" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1609"><a href="#cb69-1609" aria-hidden="true" tabindex="-1"></a>        <span class="dt">allSubregions</span><span class="op">:</span> {</span>
<span id="cb69-1610"><a href="#cb69-1610" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"All subregions"</span><span class="op">,</span></span>
<span id="cb69-1611"><a href="#cb69-1611" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Toutes les sous-rgions"</span></span>
<span id="cb69-1612"><a href="#cb69-1612" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1613"><a href="#cb69-1613" aria-hidden="true" tabindex="-1"></a>        <span class="dt">quickInsights</span><span class="op">:</span> {</span>
<span id="cb69-1614"><a href="#cb69-1614" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Quick Insights"</span><span class="op">,</span></span>
<span id="cb69-1615"><a href="#cb69-1615" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Aperu Rapide"</span></span>
<span id="cb69-1616"><a href="#cb69-1616" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1617"><a href="#cb69-1617" aria-hidden="true" tabindex="-1"></a>        <span class="dt">language</span><span class="op">:</span> {</span>
<span id="cb69-1618"><a href="#cb69-1618" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Language"</span><span class="op">,</span></span>
<span id="cb69-1619"><a href="#cb69-1619" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Langue"</span></span>
<span id="cb69-1620"><a href="#cb69-1620" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1621"><a href="#cb69-1621" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tocTitle</span><span class="op">:</span> {</span>
<span id="cb69-1622"><a href="#cb69-1622" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"In this notebook"</span><span class="op">,</span></span>
<span id="cb69-1623"><a href="#cb69-1623" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Dans ce notebook"</span></span>
<span id="cb69-1624"><a href="#cb69-1624" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1625"><a href="#cb69-1625" aria-hidden="true" tabindex="-1"></a>        <span class="dt">crop</span><span class="op">:</span> {</span>
<span id="cb69-1626"><a href="#cb69-1626" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Crop"</span><span class="op">,</span></span>
<span id="cb69-1627"><a href="#cb69-1627" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Rcolte"</span></span>
<span id="cb69-1628"><a href="#cb69-1628" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1629"><a href="#cb69-1629" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sort</span><span class="op">:</span> {</span>
<span id="cb69-1630"><a href="#cb69-1630" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Sort"</span><span class="op">,</span></span>
<span id="cb69-1631"><a href="#cb69-1631" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Trier"</span></span>
<span id="cb69-1632"><a href="#cb69-1632" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1633"><a href="#cb69-1633" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sortTotals</span><span class="op">:</span> {</span>
<span id="cb69-1634"><a href="#cb69-1634" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Sort totals"</span><span class="op">,</span></span>
<span id="cb69-1635"><a href="#cb69-1635" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Trier les totaux"</span></span>
<span id="cb69-1636"><a href="#cb69-1636" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1637"><a href="#cb69-1637" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sortBars</span><span class="op">:</span> {</span>
<span id="cb69-1638"><a href="#cb69-1638" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Sort bars"</span><span class="op">,</span></span>
<span id="cb69-1639"><a href="#cb69-1639" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Trier les barres"</span></span>
<span id="cb69-1640"><a href="#cb69-1640" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1641"><a href="#cb69-1641" aria-hidden="true" tabindex="-1"></a>        <span class="dt">confidenceIntervals</span><span class="op">:</span> {</span>
<span id="cb69-1642"><a href="#cb69-1642" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Confidence intervals"</span><span class="op">,</span></span>
<span id="cb69-1643"><a href="#cb69-1643" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Intervalles de confiance"</span></span>
<span id="cb69-1644"><a href="#cb69-1644" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1645"><a href="#cb69-1645" aria-hidden="true" tabindex="-1"></a>        <span class="dt">highlightAez</span><span class="op">:</span> {</span>
<span id="cb69-1646"><a href="#cb69-1646" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Highlight AEZ"</span><span class="op">,</span></span>
<span id="cb69-1647"><a href="#cb69-1647" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Surligner AEZ"</span></span>
<span id="cb69-1648"><a href="#cb69-1648" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1649"><a href="#cb69-1649" aria-hidden="true" tabindex="-1"></a>        <span class="dt">highlightPractice</span><span class="op">:</span> {</span>
<span id="cb69-1650"><a href="#cb69-1650" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Highlight a practice"</span><span class="op">,</span></span>
<span id="cb69-1651"><a href="#cb69-1651" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Surligner une pratique"</span></span>
<span id="cb69-1652"><a href="#cb69-1652" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-1653"><a href="#cb69-1653" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-1654"><a href="#cb69-1654" aria-hidden="true" tabindex="-1"></a>      <span class="dt">phrases</span><span class="op">:</span> {</span>
<span id="cb69-1655"><a href="#cb69-1655" aria-hidden="true" tabindex="-1"></a>        <span class="dt">inTotal</span><span class="op">:</span> {</span>
<span id="cb69-1656"><a href="#cb69-1656" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"In total, there are"</span><span class="op">,</span></span>
<span id="cb69-1657"><a href="#cb69-1657" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Au total, il y a"</span></span>
<span id="cb69-1658"><a href="#cb69-1658" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1659"><a href="#cb69-1659" aria-hidden="true" tabindex="-1"></a>        <span class="dt">specificHas</span><span class="op">:</span> {</span>
<span id="cb69-1660"><a href="#cb69-1660" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`**:::item:::** has`</span><span class="op">,</span></span>
<span id="cb69-1661"><a href="#cb69-1661" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`**:::item:::** a`</span></span>
<span id="cb69-1662"><a href="#cb69-1662" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-1663"><a href="#cb69-1663" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-1664"><a href="#cb69-1664" aria-hidden="true" tabindex="-1"></a>      <span class="dt">words</span><span class="op">:</span> {</span>
<span id="cb69-1665"><a href="#cb69-1665" aria-hidden="true" tabindex="-1"></a>        <span class="dt">toBe</span><span class="op">:</span> {</span>
<span id="cb69-1666"><a href="#cb69-1666" aria-hidden="true" tabindex="-1"></a>          <span class="dt">singular</span><span class="op">:</span> {</span>
<span id="cb69-1667"><a href="#cb69-1667" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"is"</span><span class="op">,</span></span>
<span id="cb69-1668"><a href="#cb69-1668" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"est"</span></span>
<span id="cb69-1669"><a href="#cb69-1669" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1670"><a href="#cb69-1670" aria-hidden="true" tabindex="-1"></a>          <span class="dt">plural</span><span class="op">:</span> {</span>
<span id="cb69-1671"><a href="#cb69-1671" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"are"</span><span class="op">,</span></span>
<span id="cb69-1672"><a href="#cb69-1672" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"sont"</span></span>
<span id="cb69-1673"><a href="#cb69-1673" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1674"><a href="#cb69-1674" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1675"><a href="#cb69-1675" aria-hidden="true" tabindex="-1"></a>        <span class="dt">and</span><span class="op">:</span> {</span>
<span id="cb69-1676"><a href="#cb69-1676" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"and"</span><span class="op">,</span></span>
<span id="cb69-1677"><a href="#cb69-1677" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"et"</span></span>
<span id="cb69-1678"><a href="#cb69-1678" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1679"><a href="#cb69-1679" aria-hidden="true" tabindex="-1"></a>        <span class="dt">percentage</span><span class="op">:</span> {</span>
<span id="cb69-1680"><a href="#cb69-1680" aria-hidden="true" tabindex="-1"></a>          <span class="dt">singular</span><span class="op">:</span> {</span>
<span id="cb69-1681"><a href="#cb69-1681" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"percentage"</span><span class="op">,</span></span>
<span id="cb69-1682"><a href="#cb69-1682" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"pourcentage"</span></span>
<span id="cb69-1683"><a href="#cb69-1683" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1684"><a href="#cb69-1684" aria-hidden="true" tabindex="-1"></a>          <span class="dt">plural</span><span class="op">:</span> {</span>
<span id="cb69-1685"><a href="#cb69-1685" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"percentages"</span><span class="op">,</span></span>
<span id="cb69-1686"><a href="#cb69-1686" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"pourcentages"</span></span>
<span id="cb69-1687"><a href="#cb69-1687" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1688"><a href="#cb69-1688" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1689"><a href="#cb69-1689" aria-hidden="true" tabindex="-1"></a>        <span class="dt">crop</span><span class="op">:</span> {</span>
<span id="cb69-1690"><a href="#cb69-1690" aria-hidden="true" tabindex="-1"></a>          <span class="dt">singular</span><span class="op">:</span> {</span>
<span id="cb69-1691"><a href="#cb69-1691" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"crop"</span><span class="op">,</span></span>
<span id="cb69-1692"><a href="#cb69-1692" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"rcolte"</span></span>
<span id="cb69-1693"><a href="#cb69-1693" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1694"><a href="#cb69-1694" aria-hidden="true" tabindex="-1"></a>          <span class="dt">plural</span><span class="op">:</span> {</span>
<span id="cb69-1695"><a href="#cb69-1695" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"crops"</span><span class="op">,</span></span>
<span id="cb69-1696"><a href="#cb69-1696" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"rcoltes"</span></span>
<span id="cb69-1697"><a href="#cb69-1697" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1698"><a href="#cb69-1698" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1699"><a href="#cb69-1699" aria-hidden="true" tabindex="-1"></a>        <span class="dt">country</span><span class="op">:</span> {</span>
<span id="cb69-1700"><a href="#cb69-1700" aria-hidden="true" tabindex="-1"></a>          <span class="dt">singular</span><span class="op">:</span> {</span>
<span id="cb69-1701"><a href="#cb69-1701" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"country"</span><span class="op">,</span></span>
<span id="cb69-1702"><a href="#cb69-1702" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"pays"</span></span>
<span id="cb69-1703"><a href="#cb69-1703" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1704"><a href="#cb69-1704" aria-hidden="true" tabindex="-1"></a>          <span class="dt">plural</span><span class="op">:</span> {</span>
<span id="cb69-1705"><a href="#cb69-1705" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"countries"</span><span class="op">,</span></span>
<span id="cb69-1706"><a href="#cb69-1706" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"des pays"</span></span>
<span id="cb69-1707"><a href="#cb69-1707" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1708"><a href="#cb69-1708" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1709"><a href="#cb69-1709" aria-hidden="true" tabindex="-1"></a>        <span class="dt">region</span><span class="op">:</span> {</span>
<span id="cb69-1710"><a href="#cb69-1710" aria-hidden="true" tabindex="-1"></a>          <span class="dt">singular</span><span class="op">:</span> {</span>
<span id="cb69-1711"><a href="#cb69-1711" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"region"</span><span class="op">,</span></span>
<span id="cb69-1712"><a href="#cb69-1712" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"rgion"</span></span>
<span id="cb69-1713"><a href="#cb69-1713" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1714"><a href="#cb69-1714" aria-hidden="true" tabindex="-1"></a>          <span class="dt">plural</span><span class="op">:</span> {</span>
<span id="cb69-1715"><a href="#cb69-1715" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"regions"</span><span class="op">,</span></span>
<span id="cb69-1716"><a href="#cb69-1716" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"rgions"</span></span>
<span id="cb69-1717"><a href="#cb69-1717" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1718"><a href="#cb69-1718" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1719"><a href="#cb69-1719" aria-hidden="true" tabindex="-1"></a>        <span class="dt">subregion</span><span class="op">:</span> {</span>
<span id="cb69-1720"><a href="#cb69-1720" aria-hidden="true" tabindex="-1"></a>          <span class="dt">singular</span><span class="op">:</span> {</span>
<span id="cb69-1721"><a href="#cb69-1721" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"subregion"</span><span class="op">,</span></span>
<span id="cb69-1722"><a href="#cb69-1722" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"sous-rgion"</span></span>
<span id="cb69-1723"><a href="#cb69-1723" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1724"><a href="#cb69-1724" aria-hidden="true" tabindex="-1"></a>          <span class="dt">plural</span><span class="op">:</span> {</span>
<span id="cb69-1725"><a href="#cb69-1725" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"subregions"</span><span class="op">,</span></span>
<span id="cb69-1726"><a href="#cb69-1726" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"sous-rgions"</span></span>
<span id="cb69-1727"><a href="#cb69-1727" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1728"><a href="#cb69-1728" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1729"><a href="#cb69-1729" aria-hidden="true" tabindex="-1"></a>        <span class="dt">commodity</span><span class="op">:</span> {</span>
<span id="cb69-1730"><a href="#cb69-1730" aria-hidden="true" tabindex="-1"></a>          <span class="dt">singular</span><span class="op">:</span> {</span>
<span id="cb69-1731"><a href="#cb69-1731" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"commodity"</span><span class="op">,</span></span>
<span id="cb69-1732"><a href="#cb69-1732" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"produits de base"</span></span>
<span id="cb69-1733"><a href="#cb69-1733" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1734"><a href="#cb69-1734" aria-hidden="true" tabindex="-1"></a>          <span class="dt">plural</span><span class="op">:</span> {</span>
<span id="cb69-1735"><a href="#cb69-1735" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"commodities"</span><span class="op">,</span></span>
<span id="cb69-1736"><a href="#cb69-1736" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"produits"</span></span>
<span id="cb69-1737"><a href="#cb69-1737" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1738"><a href="#cb69-1738" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1739"><a href="#cb69-1739" aria-hidden="true" tabindex="-1"></a>        <span class="dt">overview</span><span class="op">:</span> {</span>
<span id="cb69-1740"><a href="#cb69-1740" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"overview"</span><span class="op">,</span></span>
<span id="cb69-1741"><a href="#cb69-1741" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"vue densemble"</span></span>
<span id="cb69-1742"><a href="#cb69-1742" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1743"><a href="#cb69-1743" aria-hidden="true" tabindex="-1"></a>        <span class="dt">practice</span><span class="op">:</span> {</span>
<span id="cb69-1744"><a href="#cb69-1744" aria-hidden="true" tabindex="-1"></a>          <span class="dt">singular</span><span class="op">:</span> {</span>
<span id="cb69-1745"><a href="#cb69-1745" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"practice"</span><span class="op">,</span></span>
<span id="cb69-1746"><a href="#cb69-1746" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"pratique"</span></span>
<span id="cb69-1747"><a href="#cb69-1747" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1748"><a href="#cb69-1748" aria-hidden="true" tabindex="-1"></a>          <span class="dt">plural</span><span class="op">:</span> {</span>
<span id="cb69-1749"><a href="#cb69-1749" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"practices"</span><span class="op">,</span></span>
<span id="cb69-1750"><a href="#cb69-1750" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"pratiques"</span></span>
<span id="cb69-1751"><a href="#cb69-1751" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1752"><a href="#cb69-1752" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1753"><a href="#cb69-1753" aria-hidden="true" tabindex="-1"></a>        <span class="dt">observation</span><span class="op">:</span> {</span>
<span id="cb69-1754"><a href="#cb69-1754" aria-hidden="true" tabindex="-1"></a>          <span class="dt">singular</span><span class="op">:</span> {</span>
<span id="cb69-1755"><a href="#cb69-1755" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"observation"</span><span class="op">,</span></span>
<span id="cb69-1756"><a href="#cb69-1756" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"observation"</span></span>
<span id="cb69-1757"><a href="#cb69-1757" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1758"><a href="#cb69-1758" aria-hidden="true" tabindex="-1"></a>          <span class="dt">plural</span><span class="op">:</span> {</span>
<span id="cb69-1759"><a href="#cb69-1759" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"observations"</span><span class="op">,</span></span>
<span id="cb69-1760"><a href="#cb69-1760" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"observations"</span></span>
<span id="cb69-1761"><a href="#cb69-1761" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1762"><a href="#cb69-1762" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1763"><a href="#cb69-1763" aria-hidden="true" tabindex="-1"></a>        <span class="dt">increase</span><span class="op">:</span> {</span>
<span id="cb69-1764"><a href="#cb69-1764" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"increase"</span><span class="op">,</span></span>
<span id="cb69-1765"><a href="#cb69-1765" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"augmentation"</span></span>
<span id="cb69-1766"><a href="#cb69-1766" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1767"><a href="#cb69-1767" aria-hidden="true" tabindex="-1"></a>        <span class="dt">decrease</span><span class="op">:</span> {</span>
<span id="cb69-1768"><a href="#cb69-1768" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"decrease"</span><span class="op">,</span></span>
<span id="cb69-1769"><a href="#cb69-1769" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"diminution"</span></span>
<span id="cb69-1770"><a href="#cb69-1770" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-1771"><a href="#cb69-1771" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-1772"><a href="#cb69-1772" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb69-1773"><a href="#cb69-1773" aria-hidden="true" tabindex="-1"></a>    <span class="dt">frontMatter</span><span class="op">:</span> {</span>
<span id="cb69-1774"><a href="#cb69-1774" aria-hidden="true" tabindex="-1"></a>      <span class="dt">heroImage</span><span class="op">:</span> {</span>
<span id="cb69-1775"><a href="#cb69-1775" aria-hidden="true" tabindex="-1"></a>        <span class="dt">url</span><span class="op">:</span> {</span>
<span id="cb69-1776"><a href="#cb69-1776" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(</span>
<span id="cb69-1777"><a href="#cb69-1777" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Evaluate-climate-risks.webp"</span></span>
<span id="cb69-1778"><a href="#cb69-1778" aria-hidden="true" tabindex="-1"></a>          )<span class="op">.</span><span class="fu">url</span>()<span class="op">,</span></span>
<span id="cb69-1779"><a href="#cb69-1779" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(</span>
<span id="cb69-1780"><a href="#cb69-1780" aria-hidden="true" tabindex="-1"></a>            <span class="st">"Evaluate-climate-risks-fr.webp"</span></span>
<span id="cb69-1781"><a href="#cb69-1781" aria-hidden="true" tabindex="-1"></a>          )<span class="op">.</span><span class="fu">url</span>()</span>
<span id="cb69-1782"><a href="#cb69-1782" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-1783"><a href="#cb69-1783" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-1784"><a href="#cb69-1784" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb69-1785"><a href="#cb69-1785" aria-hidden="true" tabindex="-1"></a>    <span class="dt">missingMapDataBlurb</span><span class="op">:</span> {</span>
<span id="cb69-1786"><a href="#cb69-1786" aria-hidden="true" tabindex="-1"></a>      <span class="dt">en</span><span class="op">:</span> <span class="vs">`Grey regions signal lack of :::data_label::: data.`</span><span class="op">,</span></span>
<span id="cb69-1787"><a href="#cb69-1787" aria-hidden="true" tabindex="-1"></a>      <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Les zones grises dsignent un manque de donnes relies  :::data_label:::.`</span></span>
<span id="cb69-1788"><a href="#cb69-1788" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb69-1789"><a href="#cb69-1789" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vopNoteMd</span><span class="op">:</span> {</span>
<span id="cb69-1790"><a href="#cb69-1790" aria-hidden="true" tabindex="-1"></a>      <span class="co">// note about VoP source for captions</span></span>
<span id="cb69-1791"><a href="#cb69-1791" aria-hidden="true" tabindex="-1"></a>      <span class="dt">caption</span><span class="op">:</span> {</span>
<span id="cb69-1792"><a href="#cb69-1792" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="vs">`Monetary VoP values are represented in 2005 international dollars.`</span><span class="op">,</span></span>
<span id="cb69-1793"><a href="#cb69-1793" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Les valeurs montaires de la VDP sont reprsentes en dollars internationaux de 2005.`</span></span>
<span id="cb69-1794"><a href="#cb69-1794" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-1795"><a href="#cb69-1795" aria-hidden="true" tabindex="-1"></a>      <span class="co">// narrative info, with link to wiki</span></span>
<span id="cb69-1796"><a href="#cb69-1796" aria-hidden="true" tabindex="-1"></a>      <span class="dt">blurb</span><span class="op">:</span> {</span>
<span id="cb69-1797"><a href="#cb69-1797" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="vs">`VoP, 2005 [international dollars](https://en.wikipedia.org/wiki/International_dollar)`</span><span class="op">,</span></span>
<span id="cb69-1798"><a href="#cb69-1798" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="vs">`VDP, en [dollars internationaux](https://en.wikipedia.org/wiki/International_dollar) de 2005`</span></span>
<span id="cb69-1799"><a href="#cb69-1799" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-1800"><a href="#cb69-1800" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb69-1801"><a href="#cb69-1801" aria-hidden="true" tabindex="-1"></a>    <span class="dt">overview</span><span class="op">:</span> {</span>
<span id="cb69-1802"><a href="#cb69-1802" aria-hidden="true" tabindex="-1"></a>      <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb69-1803"><a href="#cb69-1803" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"Overview"</span><span class="op">,</span></span>
<span id="cb69-1804"><a href="#cb69-1804" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"Vue dEnsemble"</span></span>
<span id="cb69-1805"><a href="#cb69-1805" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-1806"><a href="#cb69-1806" aria-hidden="true" tabindex="-1"></a>      <span class="dt">blocks</span><span class="op">:</span> {</span>
<span id="cb69-1807"><a href="#cb69-1807" aria-hidden="true" tabindex="-1"></a>        <span class="dt">opener</span><span class="op">:</span> {</span>
<span id="cb69-1808"><a href="#cb69-1808" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"African agriculture will be tested by climate change. Rising temperatures, unpredictable rainfall, and flooding will disrupt the growth and production of crops and livestock, jeopardizing food security and livelihoods for millions. This notebook aims to empower users to understand the climate risks facing African agriculture, as well as identify the adaptation barriers in terms of education, women's empowerment, and poverty. You can follow the narrative for the continent as a whole, or select individual countries for geography-specific statistics."</span><span class="op">,</span></span>
<span id="cb69-1809"><a href="#cb69-1809" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"L'agriculture africaine sera mise  l'preuve par le changement climatique. La hausse des tempratures, l'imprvisibilit des prcipitations et les inondations perturberont la croissance et la production des cultures et du btail, mettant en pril la scurit alimentaire et les moyens de subsistance de millions de personnes. Ce notebook vise  permettre aux utilisateurs de comprendre les risques climatiques auxquels est confronte l'agriculture africaine, ainsi que d'identifier les obstacles  l'adaptation en termes d'ducation, d'autonomisation des femmes et de pauvret. Vous pouvez suivre le rcit pour l'ensemble du continent ou slectionner des pays individuels pour obtenir des statistiques spcifiques  la gographie."</span></span>
<span id="cb69-1810"><a href="#cb69-1810" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-1811"><a href="#cb69-1811" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-1812"><a href="#cb69-1812" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb69-1813"><a href="#cb69-1813" aria-hidden="true" tabindex="-1"></a>    <span class="dt">africaMap</span><span class="op">:</span> {</span>
<span id="cb69-1814"><a href="#cb69-1814" aria-hidden="true" tabindex="-1"></a>      <span class="dt">blocks</span><span class="op">:</span> {</span>
<span id="cb69-1815"><a href="#cb69-1815" aria-hidden="true" tabindex="-1"></a>        <span class="dt">h1</span><span class="op">:</span> {</span>
<span id="cb69-1816"><a href="#cb69-1816" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"What Does Africa Have to Lose?"</span><span class="op">,</span></span>
<span id="cb69-1817"><a href="#cb69-1817" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Qu'est-ce que l'Afrique a  perdre?"</span></span>
<span id="cb69-1818"><a href="#cb69-1818" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1819"><a href="#cb69-1819" aria-hidden="true" tabindex="-1"></a>        <span class="dt">opener</span><span class="op">:</span> {</span>
<span id="cb69-1820"><a href="#cb69-1820" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`African agriculture is valuable, both in terms of food production and farmers. Here you can explore how the value of production (:::vop_blurb:::) and size of the rural population differ between specific countries and regions. This context is important for understanding the unique vulnerabilities facing the agricultural sector on the continent, or for specific geographies of interest.`</span><span class="op">,</span></span>
<span id="cb69-1821"><a href="#cb69-1821" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`L'agriculture africaine est de valeur, tant en termes de production alimentaire que d'agriculteurs. Ici, vous pouvez explorer comment la valeur de la production (:::vop_blurb:::) et la taille de la population rurale diffrent entre des pays et des rgions spcifiques. Ce contexte est important pour comprendre les vulnrabilits uniques auxquelles est confront le secteur agricole sur le continent, ou pour des zones gographiques spcifiques.`</span></span>
<span id="cb69-1822"><a href="#cb69-1822" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-1823"><a href="#cb69-1823" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-1824"><a href="#cb69-1824" aria-hidden="true" tabindex="-1"></a>      <span class="dt">inputs</span><span class="op">:</span> {</span>
<span id="cb69-1825"><a href="#cb69-1825" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mapLayer</span><span class="op">:</span> {</span>
<span id="cb69-1826"><a href="#cb69-1826" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb69-1827"><a href="#cb69-1827" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Map layer"</span><span class="op">,</span></span>
<span id="cb69-1828"><a href="#cb69-1828" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Couche cartographique"</span></span>
<span id="cb69-1829"><a href="#cb69-1829" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1830"><a href="#cb69-1830" aria-hidden="true" tabindex="-1"></a>          <span class="dt">options</span><span class="op">:</span> {</span>
<span id="cb69-1831"><a href="#cb69-1831" aria-hidden="true" tabindex="-1"></a>            <span class="dt">ruralPop</span><span class="op">:</span> {</span>
<span id="cb69-1832"><a href="#cb69-1832" aria-hidden="true" tabindex="-1"></a>              <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb69-1833"><a href="#cb69-1833" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"Rural population"</span><span class="op">,</span></span>
<span id="cb69-1834"><a href="#cb69-1834" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population rurale"</span></span>
<span id="cb69-1835"><a href="#cb69-1835" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb69-1836"><a href="#cb69-1836" aria-hidden="true" tabindex="-1"></a>              <span class="dt">labelTip</span><span class="op">:</span> {</span>
<span id="cb69-1837"><a href="#cb69-1837" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"Rural population"</span><span class="op">,</span></span>
<span id="cb69-1838"><a href="#cb69-1838" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population rurale"</span></span>
<span id="cb69-1839"><a href="#cb69-1839" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb69-1840"><a href="#cb69-1840" aria-hidden="true" tabindex="-1"></a>              <span class="dt">labelLegend</span><span class="op">:</span> {</span>
<span id="cb69-1841"><a href="#cb69-1841" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"Rural population"</span><span class="op">,</span></span>
<span id="cb69-1842"><a href="#cb69-1842" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population rurale"</span></span>
<span id="cb69-1843"><a href="#cb69-1843" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb69-1844"><a href="#cb69-1844" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-1845"><a href="#cb69-1845" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vop</span><span class="op">:</span> {</span>
<span id="cb69-1846"><a href="#cb69-1846" aria-hidden="true" tabindex="-1"></a>              <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb69-1847"><a href="#cb69-1847" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"Total Value of Production (VoP)"</span><span class="op">,</span></span>
<span id="cb69-1848"><a href="#cb69-1848" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"Valeur totale de la production (VDP)"</span></span>
<span id="cb69-1849"><a href="#cb69-1849" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb69-1850"><a href="#cb69-1850" aria-hidden="true" tabindex="-1"></a>              <span class="dt">labelTip</span><span class="op">:</span> {</span>
<span id="cb69-1851"><a href="#cb69-1851" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"VoP"</span><span class="op">,</span></span>
<span id="cb69-1852"><a href="#cb69-1852" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"VDP"</span></span>
<span id="cb69-1853"><a href="#cb69-1853" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb69-1854"><a href="#cb69-1854" aria-hidden="true" tabindex="-1"></a>              <span class="dt">labelLegend</span><span class="op">:</span> {</span>
<span id="cb69-1855"><a href="#cb69-1855" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="vs">`Value of Production (:::unit:::)`</span><span class="op">,</span></span>
<span id="cb69-1856"><a href="#cb69-1856" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Valeur de la production (:::unit:::)`</span></span>
<span id="cb69-1857"><a href="#cb69-1857" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb69-1858"><a href="#cb69-1858" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-1859"><a href="#cb69-1859" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1860"><a href="#cb69-1860" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-1861"><a href="#cb69-1861" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-1862"><a href="#cb69-1862" aria-hidden="true" tabindex="-1"></a>      <span class="dt">insights</span><span class="op">:</span> {</span>
<span id="cb69-1863"><a href="#cb69-1863" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb69-1864"><a href="#cb69-1864" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`:::insight_string::: for :::admin_selection:::`</span><span class="op">,</span></span>
<span id="cb69-1865"><a href="#cb69-1865" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`:::insight_string::: pour :::admin_selection:::`</span></span>
<span id="cb69-1866"><a href="#cb69-1866" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1867"><a href="#cb69-1867" aria-hidden="true" tabindex="-1"></a>        <span class="dt">insightOverview</span><span class="op">:</span> {</span>
<span id="cb69-1868"><a href="#cb69-1868" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`**:::admin_selection:::**'s total value of crop and livestock production is **:::total_vop:::**.`</span><span class="op">,</span></span>
<span id="cb69-1869"><a href="#cb69-1869" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`La valeur totale de production vgtale et animale **:::admin_selection:::** est de **:::total_vop:::**.`</span></span>
<span id="cb69-1870"><a href="#cb69-1870" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1871"><a href="#cb69-1871" aria-hidden="true" tabindex="-1"></a>        <span class="dt">insightAreaAndPop</span><span class="op">:</span> {</span>
<span id="cb69-1872"><a href="#cb69-1872" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`Its crops are produced over an area of **:::area:::** hectares, with rural areas encompassing a population of **:::population:::** people.`</span><span class="op">,</span></span>
<span id="cb69-1873"><a href="#cb69-1873" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Ses cultures sont produites sur une superficie de **:::area:::** hectares, avec ses zones rurales abritant une population de **:::population:::** personnes.`</span></span>
<span id="cb69-1874"><a href="#cb69-1874" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1875"><a href="#cb69-1875" aria-hidden="true" tabindex="-1"></a>        <span class="dt">insightTopCommodity</span><span class="op">:</span> {</span>
<span id="cb69-1876"><a href="#cb69-1876" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`The top :::commodity_word::: by value: :::list_string:::.`</span><span class="op">,</span></span>
<span id="cb69-1877"><a href="#cb69-1877" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Les principaux produits de base, en termes de valeur: :::list_string:::.`</span></span>
<span id="cb69-1878"><a href="#cb69-1878" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1879"><a href="#cb69-1879" aria-hidden="true" tabindex="-1"></a>        <span class="dt">insightTopLivestock</span><span class="op">:</span> {</span>
<span id="cb69-1880"><a href="#cb69-1880" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`The top livestock species in terms of population: :::list_string:::.`</span><span class="op">,</span></span>
<span id="cb69-1881"><a href="#cb69-1881" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Les principales espces animales en termes de population: :::list_string:::.`</span></span>
<span id="cb69-1882"><a href="#cb69-1882" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-1883"><a href="#cb69-1883" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-1884"><a href="#cb69-1884" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb69-1885"><a href="#cb69-1885" aria-hidden="true" tabindex="-1"></a>    <span class="dt">climateRisks</span><span class="op">:</span> {</span>
<span id="cb69-1886"><a href="#cb69-1886" aria-hidden="true" tabindex="-1"></a>      <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb69-1887"><a href="#cb69-1887" aria-hidden="true" tabindex="-1"></a>        <span class="dt">h1</span><span class="op">:</span> {</span>
<span id="cb69-1888"><a href="#cb69-1888" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Climate Risks"</span><span class="op">,</span></span>
<span id="cb69-1889"><a href="#cb69-1889" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Risques Climatiques"</span></span>
<span id="cb69-1890"><a href="#cb69-1890" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1891"><a href="#cb69-1891" aria-hidden="true" tabindex="-1"></a>        <span class="dt">opener</span><span class="op">:</span> {</span>
<span id="cb69-1892"><a href="#cb69-1892" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`In **:::admin_selection:::**, climate change can impact crops and livestock in diverse ways. The specific risks can vary not only by region but also by the type of crop or livestock. Use the interactive features below to select specific locations and climate change scenarios. This will help you understand the unique hazards each faces and identify the most economically important crops and livestock that are exposed to hazards.`</span><span class="op">,</span></span>
<span id="cb69-1893"><a href="#cb69-1893" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`**:::admin_selection:::**, le changement climatique peut avoir des rpercussions diverses sur les cultures et le btail. Les risques spcifiques peuvent varier non seulement en fonction de la rgion, mais aussi du type de culture ou d'levage. Utilisez les fonctions interactives ci-dessous pour slectionner des lieux spcifiques et des scnarios de changement climatique. Cela vous aidera  comprendre les alas spcifiques auxquels chacun est confront et  identifier les cultures et les levages les plus importants sur le plan conomique qui sont exposs  ces alas.`</span></span>
<span id="cb69-1894"><a href="#cb69-1894" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-1895"><a href="#cb69-1895" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-1896"><a href="#cb69-1896" aria-hidden="true" tabindex="-1"></a>      <span class="dt">compoundHazards</span><span class="op">:</span> {</span>
<span id="cb69-1897"><a href="#cb69-1897" aria-hidden="true" tabindex="-1"></a>        <span class="dt">h2</span><span class="op">:</span> {</span>
<span id="cb69-1898"><a href="#cb69-1898" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Compound Hazards"</span><span class="op">,</span></span>
<span id="cb69-1899"><a href="#cb69-1899" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Risques Exacerbs"</span></span>
<span id="cb69-1900"><a href="#cb69-1900" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1901"><a href="#cb69-1901" aria-hidden="true" tabindex="-1"></a>        <span class="dt">opener</span><span class="op">:</span> {</span>
<span id="cb69-1902"><a href="#cb69-1902" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`Understand the value of production (:::vop_note:::) at risk from across different hazards alone and in combination. Hover over the bars in the chart below to explore the proportions of agricultural value in **:::admin_selection:::** that will be exposed to different hazard combinations.`</span><span class="op">,</span></span>
<span id="cb69-1903"><a href="#cb69-1903" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Comprenez la valeur de la production (:::vop_note:::) menace par les diffrents alas, seuls ou combins. Survolez les barres du graphique ci-dessous pour dcouvrir la proportion de la valeur agricole en **:::admin_selection:::** qui sera expose  diffrentes combinaisons de risques.`</span></span>
<span id="cb69-1904"><a href="#cb69-1904" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1905"><a href="#cb69-1905" aria-hidden="true" tabindex="-1"></a>        <span class="dt">inputs</span><span class="op">:</span> {</span>
<span id="cb69-1906"><a href="#cb69-1906" aria-hidden="true" tabindex="-1"></a>          <span class="dt">dropdownScenario</span><span class="op">:</span> {</span>
<span id="cb69-1907"><a href="#cb69-1907" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb69-1908"><a href="#cb69-1908" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Scenario"</span><span class="op">,</span></span>
<span id="cb69-1909"><a href="#cb69-1909" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Scnario"</span></span>
<span id="cb69-1910"><a href="#cb69-1910" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-1911"><a href="#cb69-1911" aria-hidden="true" tabindex="-1"></a>            <span class="dt">historic</span><span class="op">:</span> {</span>
<span id="cb69-1912"><a href="#cb69-1912" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Historic"</span><span class="op">,</span></span>
<span id="cb69-1913"><a href="#cb69-1913" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Historique"</span></span>
<span id="cb69-1914"><a href="#cb69-1914" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-1915"><a href="#cb69-1915" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1916"><a href="#cb69-1916" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1917"><a href="#cb69-1917" aria-hidden="true" tabindex="-1"></a>        <span class="dt">stackedBar</span><span class="op">:</span> {</span>
<span id="cb69-1918"><a href="#cb69-1918" aria-hidden="true" tabindex="-1"></a>          <span class="dt">xLabel</span><span class="op">:</span> {</span>
<span id="cb69-1919"><a href="#cb69-1919" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Total VoP (%)"</span><span class="op">,</span></span>
<span id="cb69-1920"><a href="#cb69-1920" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"VDP Total (%)"</span></span>
<span id="cb69-1921"><a href="#cb69-1921" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1922"><a href="#cb69-1922" aria-hidden="true" tabindex="-1"></a>          <span class="dt">tooltipLabels</span><span class="op">:</span> {</span>
<span id="cb69-1923"><a href="#cb69-1923" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vopRisk</span><span class="op">:</span> {</span>
<span id="cb69-1924"><a href="#cb69-1924" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"VoP at risk from hazard"</span><span class="op">,</span></span>
<span id="cb69-1925"><a href="#cb69-1925" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"VDP en danger  cause dun risque"</span></span>
<span id="cb69-1926"><a href="#cb69-1926" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-1927"><a href="#cb69-1927" aria-hidden="true" tabindex="-1"></a>            <span class="dt">hazard</span><span class="op">:</span> {</span>
<span id="cb69-1928"><a href="#cb69-1928" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Hazard"</span><span class="op">,</span></span>
<span id="cb69-1929"><a href="#cb69-1929" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Danger"</span></span>
<span id="cb69-1930"><a href="#cb69-1930" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-1931"><a href="#cb69-1931" aria-hidden="true" tabindex="-1"></a>            <span class="dt">totalVop</span><span class="op">:</span> {</span>
<span id="cb69-1932"><a href="#cb69-1932" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Total VoP at risk"</span><span class="op">,</span></span>
<span id="cb69-1933"><a href="#cb69-1933" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"VDP Total en danger"</span></span>
<span id="cb69-1934"><a href="#cb69-1934" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-1935"><a href="#cb69-1935" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1936"><a href="#cb69-1936" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-1937"><a href="#cb69-1937" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-1938"><a href="#cb69-1938" aria-hidden="true" tabindex="-1"></a>      <span class="dt">hazardImpact</span><span class="op">:</span> {</span>
<span id="cb69-1939"><a href="#cb69-1939" aria-hidden="true" tabindex="-1"></a>        <span class="co">// define by data field values</span></span>
<span id="cb69-1940"><a href="#cb69-1940" aria-hidden="true" tabindex="-1"></a>        <span class="dt">hazards</span><span class="op">:</span> {</span>
<span id="cb69-1941"><a href="#cb69-1941" aria-hidden="true" tabindex="-1"></a>          <span class="dt">wet</span><span class="op">:</span> { <span class="dt">en</span><span class="op">:</span> <span class="st">"Wet alone"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Humide"</span> }<span class="op">,</span></span>
<span id="cb69-1942"><a href="#cb69-1942" aria-hidden="true" tabindex="-1"></a>          <span class="dt">dry</span><span class="op">:</span> { <span class="dt">en</span><span class="op">:</span> <span class="st">"Dry alone"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Sec"</span> }<span class="op">,</span></span>
<span id="cb69-1943"><a href="#cb69-1943" aria-hidden="true" tabindex="-1"></a>          <span class="dt">heat</span><span class="op">:</span> { <span class="dt">en</span><span class="op">:</span> <span class="st">"Heat alone"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Chaud"</span> }<span class="op">,</span></span>
<span id="cb69-1944"><a href="#cb69-1944" aria-hidden="true" tabindex="-1"></a>          <span class="dt">dry_heat</span><span class="op">:</span> { <span class="dt">en</span><span class="op">:</span> <span class="st">"Dry and heat"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Sec et Chaud"</span> }<span class="op">,</span></span>
<span id="cb69-1945"><a href="#cb69-1945" aria-hidden="true" tabindex="-1"></a>          <span class="dt">dry_wet</span><span class="op">:</span> { <span class="dt">en</span><span class="op">:</span> <span class="st">"Dry and wet"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Sec et Humide"</span> }<span class="op">,</span></span>
<span id="cb69-1946"><a href="#cb69-1946" aria-hidden="true" tabindex="-1"></a>          <span class="dt">heat_wet</span><span class="op">:</span> { <span class="dt">en</span><span class="op">:</span> <span class="st">"Heat and wet"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Chaud et Humide"</span> }<span class="op">,</span></span>
<span id="cb69-1947"><a href="#cb69-1947" aria-hidden="true" tabindex="-1"></a>          <span class="dt">dry_heat_wet</span><span class="op">:</span> {</span>
<span id="cb69-1948"><a href="#cb69-1948" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Heat, wet, and dry"</span><span class="op">,</span></span>
<span id="cb69-1949"><a href="#cb69-1949" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Chaud, Humide, et Sec"</span></span>
<span id="cb69-1950"><a href="#cb69-1950" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1951"><a href="#cb69-1951" aria-hidden="true" tabindex="-1"></a>          <span class="dt">no_hazard</span><span class="op">:</span> { <span class="dt">en</span><span class="op">:</span> <span class="st">"No hazard"</span><span class="op">,</span> <span class="dt">fr</span><span class="op">:</span> <span class="st">"Aucun danger"</span> }</span>
<span id="cb69-1952"><a href="#cb69-1952" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1953"><a href="#cb69-1953" aria-hidden="true" tabindex="-1"></a>        <span class="dt">h1</span><span class="op">:</span> {</span>
<span id="cb69-1954"><a href="#cb69-1954" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Hazards with the Most Exposure"</span><span class="op">,</span></span>
<span id="cb69-1955"><a href="#cb69-1955" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Alas prsentant la plus forte exposition"</span></span>
<span id="cb69-1956"><a href="#cb69-1956" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1957"><a href="#cb69-1957" aria-hidden="true" tabindex="-1"></a>        <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb69-1958"><a href="#cb69-1958" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Select different hazard combinations and see which crops and livestock have the most VoP at risk."</span><span class="op">,</span></span>
<span id="cb69-1959"><a href="#cb69-1959" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Slectionnez diffrentes combinaisons de risques et voyez quelles cultures et quels animaux sont les plus menacs."</span></span>
<span id="cb69-1960"><a href="#cb69-1960" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1961"><a href="#cb69-1961" aria-hidden="true" tabindex="-1"></a>        <span class="dt">inputs</span><span class="op">:</span> {</span>
<span id="cb69-1962"><a href="#cb69-1962" aria-hidden="true" tabindex="-1"></a>          <span class="dt">dropdownHazard</span><span class="op">:</span> {</span>
<span id="cb69-1963"><a href="#cb69-1963" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb69-1964"><a href="#cb69-1964" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Hazard"</span><span class="op">,</span></span>
<span id="cb69-1965"><a href="#cb69-1965" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Danger"</span></span>
<span id="cb69-1966"><a href="#cb69-1966" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-1967"><a href="#cb69-1967" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1968"><a href="#cb69-1968" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1969"><a href="#cb69-1969" aria-hidden="true" tabindex="-1"></a>        <span class="dt">plots</span><span class="op">:</span> {</span>
<span id="cb69-1970"><a href="#cb69-1970" aria-hidden="true" tabindex="-1"></a>          <span class="dt">general</span><span class="op">:</span> {</span>
<span id="cb69-1971"><a href="#cb69-1971" aria-hidden="true" tabindex="-1"></a>            <span class="dt">noPlotMessage</span><span class="op">:</span> {</span>
<span id="cb69-1972"><a href="#cb69-1972" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"No VoP exposure"</span><span class="op">,</span></span>
<span id="cb69-1973"><a href="#cb69-1973" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Aucune exposition VoP"</span></span>
<span id="cb69-1974"><a href="#cb69-1974" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-1975"><a href="#cb69-1975" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vopLabel</span><span class="op">:</span> {</span>
<span id="cb69-1976"><a href="#cb69-1976" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"VoP at risk"</span><span class="op">,</span></span>
<span id="cb69-1977"><a href="#cb69-1977" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"VDP  risque"</span></span>
<span id="cb69-1978"><a href="#cb69-1978" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-1979"><a href="#cb69-1979" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1980"><a href="#cb69-1980" aria-hidden="true" tabindex="-1"></a>          <span class="dt">crops</span><span class="op">:</span> {</span>
<span id="cb69-1981"><a href="#cb69-1981" aria-hidden="true" tabindex="-1"></a>            <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb69-1982"><a href="#cb69-1982" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="vs">`Crops most at exposed under :::hazard_string:::`</span><span class="op">,</span></span>
<span id="cb69-1983"><a href="#cb69-1983" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Les cultures les plus exposs  :::hazard_string:::`</span></span>
<span id="cb69-1984"><a href="#cb69-1984" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-1985"><a href="#cb69-1985" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1986"><a href="#cb69-1986" aria-hidden="true" tabindex="-1"></a>          <span class="dt">livestock</span><span class="op">:</span> {</span>
<span id="cb69-1987"><a href="#cb69-1987" aria-hidden="true" tabindex="-1"></a>            <span class="dt">header</span><span class="op">:</span> {</span>
<span id="cb69-1988"><a href="#cb69-1988" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="vs">`Livestock most at exposed under :::hazard_string:::`</span><span class="op">,</span></span>
<span id="cb69-1989"><a href="#cb69-1989" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Les btails le plus exposs  :::hazard_string:::`</span></span>
<span id="cb69-1990"><a href="#cb69-1990" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-1991"><a href="#cb69-1991" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-1992"><a href="#cb69-1992" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-1993"><a href="#cb69-1993" aria-hidden="true" tabindex="-1"></a>        <span class="dt">insights</span><span class="op">:</span> {</span>
<span id="cb69-1994"><a href="#cb69-1994" aria-hidden="true" tabindex="-1"></a>          <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb69-1995"><a href="#cb69-1995" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`:::insight_string::: for :::admin_selection::: (:::scenario:::)`</span><span class="op">,</span></span>
<span id="cb69-1996"><a href="#cb69-1996" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`:::insight_string::: pour :::admin_selection::: (:::scenario:::)`</span></span>
<span id="cb69-1997"><a href="#cb69-1997" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-1998"><a href="#cb69-1998" aria-hidden="true" tabindex="-1"></a>          <span class="dt">hazardBlurb</span><span class="op">:</span> {</span>
<span id="cb69-1999"><a href="#cb69-1999" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`For hazard: **:::hazard_string:::**`</span><span class="op">,</span></span>
<span id="cb69-2000"><a href="#cb69-2000" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Pour le risque: **:::hazard_string:::**`</span></span>
<span id="cb69-2001"><a href="#cb69-2001" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-2002"><a href="#cb69-2002" aria-hidden="true" tabindex="-1"></a>          <span class="dt">labels</span><span class="op">:</span> {</span>
<span id="cb69-2003"><a href="#cb69-2003" aria-hidden="true" tabindex="-1"></a>            <span class="dt">totalVopCrop</span><span class="op">:</span> {</span>
<span id="cb69-2004"><a href="#cb69-2004" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Total Exposed VoP, Crop"</span><span class="op">,</span></span>
<span id="cb69-2005"><a href="#cb69-2005" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Valeur Totale de la Production  Risque, Culture"</span></span>
<span id="cb69-2006"><a href="#cb69-2006" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2007"><a href="#cb69-2007" aria-hidden="true" tabindex="-1"></a>            <span class="dt">totalVopLivestock</span><span class="op">:</span> {</span>
<span id="cb69-2008"><a href="#cb69-2008" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Total Exposed VoP, Livestock"</span><span class="op">,</span></span>
<span id="cb69-2009"><a href="#cb69-2009" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Valeur Totale de la Production  Risque, Btail"</span></span>
<span id="cb69-2010"><a href="#cb69-2010" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2011"><a href="#cb69-2011" aria-hidden="true" tabindex="-1"></a>            <span class="dt">exposureCrop</span><span class="op">:</span> {</span>
<span id="cb69-2012"><a href="#cb69-2012" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Crop, greatest exposure"</span><span class="op">,</span></span>
<span id="cb69-2013"><a href="#cb69-2013" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Culture, plus  risque"</span></span>
<span id="cb69-2014"><a href="#cb69-2014" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2015"><a href="#cb69-2015" aria-hidden="true" tabindex="-1"></a>            <span class="dt">exposureLivestock</span><span class="op">:</span> {</span>
<span id="cb69-2016"><a href="#cb69-2016" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Livestock, greatest exposure"</span><span class="op">,</span></span>
<span id="cb69-2017"><a href="#cb69-2017" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Btail, plus  risque:"</span></span>
<span id="cb69-2018"><a href="#cb69-2018" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-2019"><a href="#cb69-2019" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-2020"><a href="#cb69-2020" aria-hidden="true" tabindex="-1"></a>          <span class="dt">blurbBiggestHazard</span><span class="op">:</span> {</span>
<span id="cb69-2021"><a href="#cb69-2021" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"The biggest hazards for selection and scenario/timeframe are:"</span><span class="op">,</span></span>
<span id="cb69-2022"><a href="#cb69-2022" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Les risques les plus importants pour la slection et scnario/priode sont les suivants:"</span></span>
<span id="cb69-2023"><a href="#cb69-2023" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-2024"><a href="#cb69-2024" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-2025"><a href="#cb69-2025" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-2026"><a href="#cb69-2026" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb69-2027"><a href="#cb69-2027" aria-hidden="true" tabindex="-1"></a>    <span class="dt">adaptiveCapacities</span><span class="op">:</span> {</span>
<span id="cb69-2028"><a href="#cb69-2028" aria-hidden="true" tabindex="-1"></a>      <span class="dt">h1</span><span class="op">:</span> {</span>
<span id="cb69-2029"><a href="#cb69-2029" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"Adaptive Capacities"</span><span class="op">,</span></span>
<span id="cb69-2030"><a href="#cb69-2030" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"Capacits Adaptatives"</span></span>
<span id="cb69-2031"><a href="#cb69-2031" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-2032"><a href="#cb69-2032" aria-hidden="true" tabindex="-1"></a>      <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb69-2033"><a href="#cb69-2033" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="vs">`Farmers ability to adapt to climate change in **:::admin_selection:::** hinges on several key socio-economic factors. These include poverty, education, and gender inequality, which significantly influence their vulnerability and their capacity to respond effectively. Explore the map and indexes below to gain a deeper understanding of the geographic distribution of these variables across the region. Each of the three indexes are scored between 0 and 100. For the poverty index, lower values indicate lower levels of poverty. For Education and Female Empowerment, a higher score indicates increased levels of educational attainment and female decision making power.`</span><span class="op">,</span></span>
<span id="cb69-2034"><a href="#cb69-2034" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="vs">`La capacit des agriculteurs **:::admin_selection:::**  s'adapter au changement climatique dpend de plusieurs facteurs socio-conomiques cls. Il s'agit notamment de la pauvret, de l'ducation et de l'ingalit entre les genres, qui influencent considrablement leur vulnrabilit et leur capacit  ragir efficacement. La carte et les indices ci-dessous permettent de mieux comprendre la rpartition gographique de ces variables dans la rgion. Chacun des trois indices est not entre 0 et 100. Pour l'indice de pauvret, des valeurs plus faibles indiquent des niveaux de pauvret moins levs. Pour l'indice d'ducation et d'autonomisation des femmes, un score plus lev indique des niveaux d'ducation plus levs et un pouvoir de dcision plus important pour les femmes.`</span></span>
<span id="cb69-2035"><a href="#cb69-2035" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-2036"><a href="#cb69-2036" aria-hidden="true" tabindex="-1"></a>      <span class="dt">inputs</span><span class="op">:</span> {</span>
<span id="cb69-2037"><a href="#cb69-2037" aria-hidden="true" tabindex="-1"></a>        <span class="dt">mapLayer</span><span class="op">:</span> {</span>
<span id="cb69-2038"><a href="#cb69-2038" aria-hidden="true" tabindex="-1"></a>          <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb69-2039"><a href="#cb69-2039" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="st">"Map layer"</span><span class="op">,</span></span>
<span id="cb69-2040"><a href="#cb69-2040" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="st">"Couche de carte"</span></span>
<span id="cb69-2041"><a href="#cb69-2041" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-2042"><a href="#cb69-2042" aria-hidden="true" tabindex="-1"></a>          <span class="dt">options</span><span class="op">:</span> {</span>
<span id="cb69-2043"><a href="#cb69-2043" aria-hidden="true" tabindex="-1"></a>            <span class="dt">general</span><span class="op">:</span> {</span>
<span id="cb69-2044"><a href="#cb69-2044" aria-hidden="true" tabindex="-1"></a>              <span class="dt">labels</span><span class="op">:</span> {</span>
<span id="cb69-2045"><a href="#cb69-2045" aria-hidden="true" tabindex="-1"></a>                <span class="dt">population</span><span class="op">:</span> {</span>
<span id="cb69-2046"><a href="#cb69-2046" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">en</span><span class="op">:</span> <span class="st">"Population"</span><span class="op">,</span></span>
<span id="cb69-2047"><a href="#cb69-2047" aria-hidden="true" tabindex="-1"></a>                  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population"</span></span>
<span id="cb69-2048"><a href="#cb69-2048" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb69-2049"><a href="#cb69-2049" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb69-2050"><a href="#cb69-2050" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2051"><a href="#cb69-2051" aria-hidden="true" tabindex="-1"></a>            <span class="dt">pov</span><span class="op">:</span> {</span>
<span id="cb69-2052"><a href="#cb69-2052" aria-hidden="true" tabindex="-1"></a>              <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb69-2053"><a href="#cb69-2053" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"Poverty Rate"</span><span class="op">,</span></span>
<span id="cb69-2054"><a href="#cb69-2054" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"Taux de pauvret"</span></span>
<span id="cb69-2055"><a href="#cb69-2055" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb69-2056"><a href="#cb69-2056" aria-hidden="true" tabindex="-1"></a>              <span class="dt">labelLegend</span><span class="op">:</span> {</span>
<span id="cb69-2057"><a href="#cb69-2057" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"Poverty Rate (% of population under $3.65 per day)"</span><span class="op">,</span></span>
<span id="cb69-2058"><a href="#cb69-2058" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"Taux de pauvret (% de la population vivant avec moins de 3,65 $ par jour)"</span></span>
<span id="cb69-2059"><a href="#cb69-2059" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb69-2060"><a href="#cb69-2060" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2061"><a href="#cb69-2061" aria-hidden="true" tabindex="-1"></a>            <span class="dt">edu</span><span class="op">:</span> {</span>
<span id="cb69-2062"><a href="#cb69-2062" aria-hidden="true" tabindex="-1"></a>              <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb69-2063"><a href="#cb69-2063" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"Education Attainment"</span><span class="op">,</span></span>
<span id="cb69-2064"><a href="#cb69-2064" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"Niveau d'ducation"</span></span>
<span id="cb69-2065"><a href="#cb69-2065" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb69-2066"><a href="#cb69-2066" aria-hidden="true" tabindex="-1"></a>              <span class="dt">labelLegend</span><span class="op">:</span> {</span>
<span id="cb69-2067"><a href="#cb69-2067" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"Education Attainment (Years of schooling)"</span><span class="op">,</span></span>
<span id="cb69-2068"><a href="#cb69-2068" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"Niveau d'ducation (annes de scolarit)"</span></span>
<span id="cb69-2069"><a href="#cb69-2069" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb69-2070"><a href="#cb69-2070" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2071"><a href="#cb69-2071" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fem</span><span class="op">:</span> {</span>
<span id="cb69-2072"><a href="#cb69-2072" aria-hidden="true" tabindex="-1"></a>              <span class="dt">label</span><span class="op">:</span> {</span>
<span id="cb69-2073"><a href="#cb69-2073" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"Female empowerment index"</span><span class="op">,</span></span>
<span id="cb69-2074"><a href="#cb69-2074" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"Indicateur dautonomisation des femmes"</span></span>
<span id="cb69-2075"><a href="#cb69-2075" aria-hidden="true" tabindex="-1"></a>              }<span class="op">,</span></span>
<span id="cb69-2076"><a href="#cb69-2076" aria-hidden="true" tabindex="-1"></a>              <span class="dt">labelLegend</span><span class="op">:</span> {</span>
<span id="cb69-2077"><a href="#cb69-2077" aria-hidden="true" tabindex="-1"></a>                <span class="dt">en</span><span class="op">:</span> <span class="st">"Female empowerment index (higher is better)"</span><span class="op">,</span></span>
<span id="cb69-2078"><a href="#cb69-2078" aria-hidden="true" tabindex="-1"></a>                <span class="dt">fr</span><span class="op">:</span> <span class="st">"Indicateur dautonomisation des femmes (plus cest lev, mieux cest)"</span></span>
<span id="cb69-2079"><a href="#cb69-2079" aria-hidden="true" tabindex="-1"></a>              }</span>
<span id="cb69-2080"><a href="#cb69-2080" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-2081"><a href="#cb69-2081" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-2082"><a href="#cb69-2082" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-2083"><a href="#cb69-2083" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-2084"><a href="#cb69-2084" aria-hidden="true" tabindex="-1"></a>      <span class="dt">insights</span><span class="op">:</span> {</span>
<span id="cb69-2085"><a href="#cb69-2085" aria-hidden="true" tabindex="-1"></a>        <span class="dt">title</span><span class="op">:</span> {</span>
<span id="cb69-2086"><a href="#cb69-2086" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`:::insight_string::: for :::admin_selection:::`</span><span class="op">,</span></span>
<span id="cb69-2087"><a href="#cb69-2087" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`:::insight_string::: pour :::admin_selection:::`</span></span>
<span id="cb69-2088"><a href="#cb69-2088" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-2089"><a href="#cb69-2089" aria-hidden="true" tabindex="-1"></a>        <span class="dt">madLib</span><span class="op">:</span> {</span>
<span id="cb69-2090"><a href="#cb69-2090" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`**:::admin:::**: the education index is **:::index_edu:::**, the female empowerment index is **:::index_fem:::**, and the poverty index is **:::index_pov:::**.`</span><span class="op">,</span></span>
<span id="cb69-2091"><a href="#cb69-2091" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`**:::admin:::**: lindice d'ducation est de **:::index_edu:::**,  lindex dautonomisation des femmes et de **:::index_fem:::** et lindice de pauvret est de **:::index_pov:::**.`</span></span>
<span id="cb69-2092"><a href="#cb69-2092" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-2093"><a href="#cb69-2093" aria-hidden="true" tabindex="-1"></a>        <span class="dt">nestedLocationBlurb</span><span class="op">:</span> {</span>
<span id="cb69-2094"><a href="#cb69-2094" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`**:::admin_inner:::** is located within **:::admin_outer:::**.`</span><span class="op">,</span></span>
<span id="cb69-2095"><a href="#cb69-2095" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`**:::admin_inner:::** est situ dans **:::admin_outer:::**.`</span></span>
<span id="cb69-2096"><a href="#cb69-2096" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-2097"><a href="#cb69-2097" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-2098"><a href="#cb69-2098" aria-hidden="true" tabindex="-1"></a>      <span class="dt">delvingDeeper</span><span class="op">:</span> {</span>
<span id="cb69-2099"><a href="#cb69-2099" aria-hidden="true" tabindex="-1"></a>        <span class="dt">h2</span><span class="op">:</span> {</span>
<span id="cb69-2100"><a href="#cb69-2100" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"Delving Deeper"</span><span class="op">,</span></span>
<span id="cb69-2101"><a href="#cb69-2101" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Approfondir"</span></span>
<span id="cb69-2102"><a href="#cb69-2102" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-2103"><a href="#cb69-2103" aria-hidden="true" tabindex="-1"></a>        <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb69-2104"><a href="#cb69-2104" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"By analyzing overlays of poverty levels, education attainment, and female empowerment, you can gain additional insights into the diverse challenges and opportunities faced by communities. This deeper understanding of barriers to adaptation can help you to identify the localized context in which climate risk needs to be addressed."</span><span class="op">,</span></span>
<span id="cb69-2105"><a href="#cb69-2105" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"En analysant les superpositions des niveaux de pauvret, du niveau d'ducation et de l'autonomisation des femmes, vous pouvez obtenir des informations supplmentaires sur les divers dfis et opportunits auxquels sont confrontes les communauts. Cette meilleure comprhension des obstacles  l'adaptation peut vous aider  identifier le contexte local dans lequel les risques climatiques doivent tre abords."</span></span>
<span id="cb69-2106"><a href="#cb69-2106" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-2107"><a href="#cb69-2107" aria-hidden="true" tabindex="-1"></a>        <span class="dt">plot</span><span class="op">:</span> {</span>
<span id="cb69-2108"><a href="#cb69-2108" aria-hidden="true" tabindex="-1"></a>          <span class="dt">legend</span><span class="op">:</span> {</span>
<span id="cb69-2109"><a href="#cb69-2109" aria-hidden="true" tabindex="-1"></a>            <span class="dt">domain</span><span class="op">:</span> {</span>
<span id="cb69-2110"><a href="#cb69-2110" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> [<span class="st">"Better"</span><span class="op">,</span> <span class="st">"Moderate"</span><span class="op">,</span> <span class="st">"Worse"</span>]<span class="op">,</span></span>
<span id="cb69-2111"><a href="#cb69-2111" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> [<span class="st">"Meilleur"</span><span class="op">,</span> <span class="st">"Moyen"</span><span class="op">,</span> <span class="st">"Pire"</span>]</span>
<span id="cb69-2112"><a href="#cb69-2112" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-2113"><a href="#cb69-2113" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb69-2114"><a href="#cb69-2114" aria-hidden="true" tabindex="-1"></a>          <span class="dt">nameMap</span><span class="op">:</span> {</span>
<span id="cb69-2115"><a href="#cb69-2115" aria-hidden="true" tabindex="-1"></a>            <span class="dt">population</span><span class="op">:</span> {</span>
<span id="cb69-2116"><a href="#cb69-2116" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Total Population"</span><span class="op">,</span></span>
<span id="cb69-2117"><a href="#cb69-2117" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Population Totale"</span></span>
<span id="cb69-2118"><a href="#cb69-2118" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2119"><a href="#cb69-2119" aria-hidden="true" tabindex="-1"></a>            <span class="dt">poverty0</span><span class="op">:</span> {</span>
<span id="cb69-2120"><a href="#cb69-2120" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Low Poverty"</span><span class="op">,</span></span>
<span id="cb69-2121"><a href="#cb69-2121" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Faible Niveau de Pauvret"</span></span>
<span id="cb69-2122"><a href="#cb69-2122" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2123"><a href="#cb69-2123" aria-hidden="true" tabindex="-1"></a>            <span class="dt">poverty1</span><span class="op">:</span> {</span>
<span id="cb69-2124"><a href="#cb69-2124" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Moderate Poverty"</span><span class="op">,</span></span>
<span id="cb69-2125"><a href="#cb69-2125" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Moyen Niveau de Pauvret"</span></span>
<span id="cb69-2126"><a href="#cb69-2126" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2127"><a href="#cb69-2127" aria-hidden="true" tabindex="-1"></a>            <span class="dt">poverty2</span><span class="op">:</span> {</span>
<span id="cb69-2128"><a href="#cb69-2128" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"High Poverty"</span><span class="op">,</span></span>
<span id="cb69-2129"><a href="#cb69-2129" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Haut Niveau de Pauvret"</span></span>
<span id="cb69-2130"><a href="#cb69-2130" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2131"><a href="#cb69-2131" aria-hidden="true" tabindex="-1"></a>            <span class="dt">education0</span><span class="op">:</span> {</span>
<span id="cb69-2132"><a href="#cb69-2132" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"0-1 Years of Education"</span><span class="op">,</span></span>
<span id="cb69-2133"><a href="#cb69-2133" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"0-1 ans d'ducation"</span></span>
<span id="cb69-2134"><a href="#cb69-2134" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2135"><a href="#cb69-2135" aria-hidden="true" tabindex="-1"></a>            <span class="dt">education1</span><span class="op">:</span> {</span>
<span id="cb69-2136"><a href="#cb69-2136" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"1-5 Years of Education"</span><span class="op">,</span></span>
<span id="cb69-2137"><a href="#cb69-2137" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"1-5 ans d'ducation"</span></span>
<span id="cb69-2138"><a href="#cb69-2138" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2139"><a href="#cb69-2139" aria-hidden="true" tabindex="-1"></a>            <span class="dt">education2</span><span class="op">:</span> {</span>
<span id="cb69-2140"><a href="#cb69-2140" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"5+ Years of Education"</span><span class="op">,</span></span>
<span id="cb69-2141"><a href="#cb69-2141" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"5+ ans d'ducation"</span></span>
<span id="cb69-2142"><a href="#cb69-2142" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2143"><a href="#cb69-2143" aria-hidden="true" tabindex="-1"></a>            <span class="dt">gender0</span><span class="op">:</span> {</span>
<span id="cb69-2144"><a href="#cb69-2144" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Low Female Empowerment"</span><span class="op">,</span></span>
<span id="cb69-2145"><a href="#cb69-2145" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Faible Autonomisation des Femmes"</span></span>
<span id="cb69-2146"><a href="#cb69-2146" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2147"><a href="#cb69-2147" aria-hidden="true" tabindex="-1"></a>            <span class="dt">gender1</span><span class="op">:</span> {</span>
<span id="cb69-2148"><a href="#cb69-2148" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"Moderate Female Empowerment"</span><span class="op">,</span></span>
<span id="cb69-2149"><a href="#cb69-2149" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Moyenne Autonomisation des Femmes"</span></span>
<span id="cb69-2150"><a href="#cb69-2150" aria-hidden="true" tabindex="-1"></a>            }<span class="op">,</span></span>
<span id="cb69-2151"><a href="#cb69-2151" aria-hidden="true" tabindex="-1"></a>            <span class="dt">gender2</span><span class="op">:</span> {</span>
<span id="cb69-2152"><a href="#cb69-2152" aria-hidden="true" tabindex="-1"></a>              <span class="dt">en</span><span class="op">:</span> <span class="st">"High Female Empowerment"</span><span class="op">,</span></span>
<span id="cb69-2153"><a href="#cb69-2153" aria-hidden="true" tabindex="-1"></a>              <span class="dt">fr</span><span class="op">:</span> <span class="st">"Haute Autonomisation des Femmes"</span></span>
<span id="cb69-2154"><a href="#cb69-2154" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb69-2155"><a href="#cb69-2155" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-2156"><a href="#cb69-2156" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-2157"><a href="#cb69-2157" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-2158"><a href="#cb69-2158" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb69-2159"><a href="#cb69-2159" aria-hidden="true" tabindex="-1"></a>    <span class="dt">summary</span><span class="op">:</span> {</span>
<span id="cb69-2160"><a href="#cb69-2160" aria-hidden="true" tabindex="-1"></a>      <span class="dt">h1</span><span class="op">:</span> {</span>
<span id="cb69-2161"><a href="#cb69-2161" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"Summary"</span><span class="op">,</span></span>
<span id="cb69-2162"><a href="#cb69-2162" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"Rsum"</span></span>
<span id="cb69-2163"><a href="#cb69-2163" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-2164"><a href="#cb69-2164" aria-hidden="true" tabindex="-1"></a>      <span class="dt">blocks</span><span class="op">:</span> {</span>
<span id="cb69-2165"><a href="#cb69-2165" aria-hidden="true" tabindex="-1"></a>        <span class="dt">dynamicSummary</span><span class="op">:</span> {</span>
<span id="cb69-2166"><a href="#cb69-2166" aria-hidden="true" tabindex="-1"></a>          <span class="dt">intro</span><span class="op">:</span> {</span>
<span id="cb69-2167"><a href="#cb69-2167" aria-hidden="true" tabindex="-1"></a>            <span class="dt">en</span><span class="op">:</span> <span class="vs">`The people of **:::admin0:::** need to be ready with strategies to make crops and livestock more resilient to combat the changing climate.`</span><span class="op">,</span></span>
<span id="cb69-2168"><a href="#cb69-2168" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Les habitants **:::admin0:::** doivent tre prts  mettre en place des stratgies visant  rendre les cultures et le btail plus rsistants pour lutter contre le changement climatique.`</span></span>
<span id="cb69-2169"><a href="#cb69-2169" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb69-2170"><a href="#cb69-2170" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb69-2171"><a href="#cb69-2171" aria-hidden="true" tabindex="-1"></a>        <span class="dt">closer</span><span class="op">:</span> {</span>
<span id="cb69-2172"><a href="#cb69-2172" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="st">"This work aims to enhance crop variety and livestocks breed, reduce emissions, promote sustainable land management, and educate and train populations on climate-smart agriculture practices."</span><span class="op">,</span></span>
<span id="cb69-2173"><a href="#cb69-2173" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="st">"Ces travaux visent  amliorer la varit des cultures et la race des animaux,  rduire les missions,  promouvoir la gestion durable des terres et  duquer et former les populations aux pratiques agricoles intelligentes face au climat."</span></span>
<span id="cb69-2174"><a href="#cb69-2174" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-2175"><a href="#cb69-2175" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-2176"><a href="#cb69-2176" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dynamicSummarylist</span><span class="op">:</span> {</span>
<span id="cb69-2177"><a href="#cb69-2177" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="vs">`A range of strategies and policies can be implemented in support of researching and addressing the impact of climate change on agriculture, including:</span></span>
<span id="cb69-2178"><a href="#cb69-2178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2179"><a href="#cb69-2179" aria-hidden="true" tabindex="-1"></a><span class="vs">:::markdownList:::`</span><span class="op">,</span></span>
<span id="cb69-2180"><a href="#cb69-2180" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="vs">`Une srie de stratgies et de politiques peuvent tre mises en uvre pour soutenir la recherche et la prise en compte de l'impact du changement climatique sur l'agriculture:</span></span>
<span id="cb69-2181"><a href="#cb69-2181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2182"><a href="#cb69-2182" aria-hidden="true" tabindex="-1"></a><span class="vs">:::markdownList:::`</span></span>
<span id="cb69-2183"><a href="#cb69-2183" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-2184"><a href="#cb69-2184" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb69-2185"><a href="#cb69-2185" aria-hidden="true" tabindex="-1"></a>    <span class="dt">methods</span><span class="op">:</span> {</span>
<span id="cb69-2186"><a href="#cb69-2186" aria-hidden="true" tabindex="-1"></a>      <span class="dt">h1</span><span class="op">:</span> {</span>
<span id="cb69-2187"><a href="#cb69-2187" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"Methods &amp; Sources"</span><span class="op">,</span></span>
<span id="cb69-2188"><a href="#cb69-2188" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"Mthodes &amp; Sources"</span></span>
<span id="cb69-2189"><a href="#cb69-2189" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-2190"><a href="#cb69-2190" aria-hidden="true" tabindex="-1"></a>      <span class="dt">section1</span><span class="op">:</span> {</span>
<span id="cb69-2191"><a href="#cb69-2191" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"Datasets"</span><span class="op">,</span></span>
<span id="cb69-2192"><a href="#cb69-2192" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"Ensembles de Donnes"</span><span class="op">,</span></span>
<span id="cb69-2193"><a href="#cb69-2193" aria-hidden="true" tabindex="-1"></a>        <span class="dt">subsections</span><span class="op">:</span> {</span>
<span id="cb69-2194"><a href="#cb69-2194" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`### Exposure (Value of Production)</span></span>
<span id="cb69-2195"><a href="#cb69-2195" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[Crop value of production](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/exposure_catalog/mapspam2017/mapspam2017_vop_parquet/mapspam2017_vop_parquet.json)** data comes from  MapSPAM 2017 V2r3 (Spatial Production Allocation Model) where production values are multiplied by country specific FAOstat international crop prices in (2005 International Dollars).</span></span>
<span id="cb69-2196"><a href="#cb69-2196" aria-hidden="true" tabindex="-1"></a><span class="vs">An [international dollar](https://en.wikipedia.org/wiki/International_dollar) (2005) is a hypothetical unit of currency that has the same purchasing power parity as the U.S. dollar had in the United States in 2005, allowing for comparison of what consumers can buy in different countries with the same amount of money.</span></span>
<span id="cb69-2197"><a href="#cb69-2197" aria-hidden="true" tabindex="-1"></a><span class="vs">This dataset is an updated version of MapSPAM specifically tailored for this project. It includes bug fixes and incorporates country-specific values of production instead of global averages.</span></span>
<span id="cb69-2198"><a href="#cb69-2198" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[Livestock value of production](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/exposure_catalog/GLW3_livestock/GLW3_livestock_vopPQ/GLW3_livestock_vopPQ.json)** in 2005 International Dollars were provided by the authors of [Herrero et al. (2013)](https://www.pnas.org/doi/full/10.1073/pnas.1308149110/).</span></span>
<span id="cb69-2199"><a href="#cb69-2199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2200"><a href="#cb69-2200" aria-hidden="true" tabindex="-1"></a><span class="vs">### Adaptive Capacities</span></span>
<span id="cb69-2201"><a href="#cb69-2201" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[Population](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/population/worldpop_2020/pop_2020_parquet/pop_2020_parquet.json)** data is from the [WorldPop Unconstrained Global Mosaic](https://hub.worldpop.org/geodata/listing?id=64) for 2020.</span></span>
<span id="cb69-2202"><a href="#cb69-2202" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[Poverty](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/adaptive-capacity/poverty/grdi/grdi_historical_2010-2020/grdi_historical_2010-2020.json)** data is from the [Global Gridded Deprivation Index](https://sedac.ciesin.columbia.edu/data/set/povmap-grdi-v1).</span></span>
<span id="cb69-2203"><a href="#cb69-2203" aria-hidden="true" tabindex="-1"></a><span class="vs">-  **[Education](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/adaptive-capacity/education_catalog/catalog.json)** data for the icicle plot is the mean male and female educational attainment from the [2005-2015 IHME Estimates for ages 15-49](https://ghdx.healthdata.org/record/ihme-data/africa-educational-attainment-geospatial-estimates-2000-2015). The education rate combines educational attainment with expected years of schooling in a [composite index as part of the Sub-national HDI](https://globaldatalab.org/shdi/metadata/edindex/).</span></span>
<span id="cb69-2204"><a href="#cb69-2204" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[Female Empowerment](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/adaptive-capacity/women-and-gender/female-empowerment/GenderEquity_1995-2015/GenderEquity_1995-2015.json)** is a composite index of  domestic violence, employment, reproductive healthcare, decision making power, and family planning. The index is from [Rettig, Erica (2022)](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/8GJKYW) and based on input data from the [DHS Program](https://dhsprogram.com).</span></span>
<span id="cb69-2205"><a href="#cb69-2205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2206"><a href="#cb69-2206" aria-hidden="true" tabindex="-1"></a><span class="vs">### Boundaries</span></span>
<span id="cb69-2207"><a href="#cb69-2207" aria-hidden="true" tabindex="-1"></a><span class="vs">[Administrative areas](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/boundary_catalog/geoBoundaries_SSA/collection.json) used in this notebook come from [geoBoundaries 6.0.0](https://github.com/wmgeolab/geoBoundaries). The gbHumanitarian boundaries are used and if not available then the gbOpen boundaries are substituted.</span></span>
<span id="cb69-2208"><a href="#cb69-2208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2209"><a href="#cb69-2209" aria-hidden="true" tabindex="-1"></a><span class="vs">### Climate Hazards &amp; Risk</span></span>
<span id="cb69-2210"><a href="#cb69-2210" aria-hidden="true" tabindex="-1"></a><span class="vs">[Climate hazards](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/hazard_catalog/catalog.json) were calculated using five datasets [CHIRPS](https://www.chc.ucsb.edu/data/chirps)/[CHIRTS](https://www.chc.ucsb.edu/data/chirtsdaily), [AgERA5](https://doi.org/10.24381/cds.6c68c9bb), [CMIP6 projections](https://github.com/SantanderMetGroup/ATLAS), and [crop calendars](https://zenodo.org/records/5062513). Using the R workflows mentioned below, raw hazard data were converted to risk, intersected with exposure and extracted by administrative boundaries to generate tabular data in parquet form, for example [severe_adm_int.parquet](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/hazard_catalog/hazard_risk_vop_annual/annual_digital-atlas/hazards/hazard_risk_vop/annual/severe_adm_int.parquet/annual_digital-atlas/hazards/hazard_risk_vop/annual/severe_adm_int.parquet.json).`</span><span class="op">,</span></span>
<span id="cb69-2211"><a href="#cb69-2211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2212"><a href="#cb69-2212" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`### Exposition au Risques (Valeur de Production)</span></span>
<span id="cb69-2213"><a href="#cb69-2213" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[Les donnes sur la valeur de la production des cultures](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/exposure_catalog/mapspam2017/mapspam2017_vop_parquet/mapspam2017_vop_parquet.json)** proviennent de MapSPAM 2017 V2r3 (Modle d'Allocation de Production Spatiale) o les valeurs de production sont multiplies par les prix internationaux des cultures de la FAOstat spcifiques  chaque pays en (dollars internationaux de 2005). Un [dollar international](https://en.wikipedia.org/wiki/International_dollar) (2005) est une unit montaire hypothtique qui a la mme parit de pouvoir d'achat que le dollar amricain aux tats-Unis en 2005, ce qui permet de comparer ce que les consommateurs peuvent acheter dans diffrents pays avec la mme somme d'argent. Cet ensemble de donnes est une version mise  jour de MapSPAM spcialement conue pour ce projet. Il comprend des corrections de bogues et incorpore des valeurs de production spcifiques  chaque pays au lieu de moyennes mondiales.</span></span>
<span id="cb69-2214"><a href="#cb69-2214" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[La valeur de la production animale](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/exposure_catalog/GLW3_livestock/GLW3_livestock_vopPQ/GLW3_livestock_vopPQ.json)** en dollars internationaux de 2005 a t fournie par les auteurs de [Herrero et al. (2013)](https://www.pnas.org/doi/full/10.1073/pnas.1308149110/).</span></span>
<span id="cb69-2215"><a href="#cb69-2215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2216"><a href="#cb69-2216" aria-hidden="true" tabindex="-1"></a><span class="vs">### Capacits Adaptatives</span></span>
<span id="cb69-2217"><a href="#cb69-2217" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[Les donnes dmographiques proviennent](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/population/worldpop_2020/pop_2020_parquet/pop_2020_parquet.json)** [WorldPop Unconstrained Global Mosaic](https://hub.worldpop.org/geodata/listing?id=64) pour 2020.</span></span>
<span id="cb69-2218"><a href="#cb69-2218" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[Les donnes de pauvret](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/adaptive-capacity/poverty/grdi/grdi_historical_2010-2020/grdi_historical_2010-2020.json)** proviennent du [Global Gridded Deprivation Index](https://sedac.ciesin.columbia.edu/data/set/povmap-grdi-v1).</span></span>
<span id="cb69-2219"><a href="#cb69-2219" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[Les donnes sur l'ducation](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/adaptive-capacity/education_catalog/catalog.json)** pour le dendrogramme sont le niveau d'ducation moyen des hommes et des femmes selon les [estimations de l'IHME 2005-2015 pour les 15-49 ans](https://ghdx.healthdata.org/record/ihme-data/africa-educational-attainment-geospatial-estimates-2000-2015). Le taux d'ducation combine le niveau d'ducation et le nombre d'annes de scolarisation prvues dans [un indice composite dans le cadre de l'IDH sous-national.](https://globaldatalab.org/shdi/metadata/edindex/).</span></span>
<span id="cb69-2220"><a href="#cb69-2220" aria-hidden="true" tabindex="-1"></a><span class="vs">- **[L'autonomisation des femmes](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/adaptive-capacity/women-and-gender/female-empowerment/GenderEquity_1995-2015/GenderEquity_1995-2015.json)** est un indice composite de la violence domestique, de l'emploi, des soins de sant reproductive, du pouvoir de dcision et de la planification familiale. L'indice est tir de [Rettig, Erica (2022)](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/8GJKYW) et bas sur les donnes du [programme DHS](https://dhsprogram.com).</span></span>
<span id="cb69-2221"><a href="#cb69-2221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2222"><a href="#cb69-2222" aria-hidden="true" tabindex="-1"></a><span class="vs">### Dlimitations</span></span>
<span id="cb69-2223"><a href="#cb69-2223" aria-hidden="true" tabindex="-1"></a><span class="vs">Les [zones administratives](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/boundary_catalog/geoBoundaries_SSA/collection.json) utilises dans ce notebook proviennent de [geoBoundaries 6.0.0](https://github.com/wmgeolab/geoBoundaries). Les frontires gbHumanitarian sont utilises et, si elles ne sont pas disponibles, les frontires gbOpen sont substitues.</span></span>
<span id="cb69-2224"><a href="#cb69-2224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2225"><a href="#cb69-2225" aria-hidden="true" tabindex="-1"></a><span class="vs">### Risques &amp; Dangers Climatiques</span></span>
<span id="cb69-2226"><a href="#cb69-2226" aria-hidden="true" tabindex="-1"></a><span class="vs">Les [risques climatiques](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/hazard_catalog/catalog.json) ont t calculs  l'aide de cinq ensembles de donnes: [CHIRPS](https://www.chc.ucsb.edu/data/chirps)/[CHIRTS](https://www.chc.ucsb.edu/data/chirtsdaily), [AgERA5](https://doi.org/10.24381/cds.6c68c9bb), [projections CMIP6](https://github.com/SantanderMetGroup/ATLAS), et [calendriers des cultures](https://zenodo.org/records/5062513).  l'aide des flux de travail R mentionns ci-dessous, les donnes brutes sur les alas ont t converties en risques, recoupes avec l'exposition et extraites par les limites administratives pour gnrer des donnes tabulaires sous forme de parquet, par exemple [severe_adm_int.parquet](https://radiantearth.github.io/stac-browser/#/external/digital-atlas.s3.amazonaws.com/stac/public_stac/hazard_catalog/hazard_risk_vop_annual/annual_digital-atlas/hazards/hazard_risk_vop/annual/severe_adm_int.parquet/annual_digital-atlas/hazards/hazard_risk_vop/annual/severe_adm_int.parquet.json).`</span></span>
<span id="cb69-2227"><a href="#cb69-2227" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-2228"><a href="#cb69-2228" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb69-2229"><a href="#cb69-2229" aria-hidden="true" tabindex="-1"></a>      <span class="dt">section2</span><span class="op">:</span> {</span>
<span id="cb69-2230"><a href="#cb69-2230" aria-hidden="true" tabindex="-1"></a>        <span class="dt">en</span><span class="op">:</span> <span class="st">"Methods"</span><span class="op">,</span></span>
<span id="cb69-2231"><a href="#cb69-2231" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fr</span><span class="op">:</span> <span class="st">"Mthodologie"</span><span class="op">,</span></span>
<span id="cb69-2232"><a href="#cb69-2232" aria-hidden="true" tabindex="-1"></a>        <span class="dt">subsections</span><span class="op">:</span> {</span>
<span id="cb69-2233"><a href="#cb69-2233" aria-hidden="true" tabindex="-1"></a>          <span class="dt">en</span><span class="op">:</span> <span class="vs">`### Climate Hazard Risk</span></span>
<span id="cb69-2234"><a href="#cb69-2234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2235"><a href="#cb69-2235" aria-hidden="true" tabindex="-1"></a><span class="vs">A detailed and replicable R workflow for generating raw climate hazards data is available at the [AdaptationAtlas/Hazards](https://github.com/AdaptationAtlas/hazards).</span></span>
<span id="cb69-2236"><a href="#cb69-2236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2237"><a href="#cb69-2237" aria-hidden="true" tabindex="-1"></a><span class="vs">The transformation of raw climate hazards into generic and crop-specific hazard risks was achieved using a separate, but equally replicable, R workflow, which can be found in the GitHub project [atlas/hazards_prototype](https://github.com/AdaptationAtlas/hazards_prototype). </span></span>
<span id="cb69-2238"><a href="#cb69-2238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2239"><a href="#cb69-2239" aria-hidden="true" tabindex="-1"></a><span class="vs">The process for calculating risk comprises several critical steps:</span></span>
<span id="cb69-2240"><a href="#cb69-2240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2241"><a href="#cb69-2241" aria-hidden="true" tabindex="-1"></a><span class="vs">1. **Annual or Seasonal Summarization**: Raw hazard data is aligned with the [GGCMI Phase 3 crop calendar for maize](https://zenodo.org/records/5062513), then climate hazards are summarized at either annual or seasonal timescales. Future updates of the Atlas will incorporate crop-specific calendars.</span></span>
<span id="cb69-2242"><a href="#cb69-2242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2243"><a href="#cb69-2243" aria-hidden="true" tabindex="-1"></a><span class="vs">2. **Occurrence**: For each season or year in a time series, we classify the risk of hazard occurrence (present/absent) across three severity levels (moderate, severe, extreme). Note, hazard severity is fixed to severe in this notebook.</span></span>
<span id="cb69-2244"><a href="#cb69-2244" aria-hidden="true" tabindex="-1"></a><span class="vs">   </span></span>
<span id="cb69-2245"><a href="#cb69-2245" aria-hidden="true" tabindex="-1"></a><span class="vs">  The specific hazards used in this analysis are: </span></span>
<span id="cb69-2246"><a href="#cb69-2246" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb69-2247"><a href="#cb69-2247" aria-hidden="true" tabindex="-1"></a><span class="vs">  - **Dry** = number of soil water stress days [NDWS](https://github.com/AdaptationAtlas/hazards/wiki/Hazards-definitions). Severe risk = NDWS &gt; 20 days (same across all crops and livestock).</span></span>
<span id="cb69-2248"><a href="#cb69-2248" aria-hidden="true" tabindex="-1"></a><span class="vs">  - **Heat (crops)** = days where maximum temperature &gt; 35C [NTx35](https://github.com/AdaptationAtlas/hazards/wiki/Hazards-definitions). Severe risk = NTx35 &gt; 20 days (same across all crops).</span></span>
<span id="cb69-2249"><a href="#cb69-2249" aria-hidden="true" tabindex="-1"></a><span class="vs">  - **Heat (livestock)** = thermal humidity index [THI](https://github.com/AdaptationAtlas/hazards/wiki/Hazards-definitions). Severe risk is livestock class specific, see Table 2 of [Thorton et al. 2021](https://doi.org/10.1111/gcb.15825).</span></span>
<span id="cb69-2250"><a href="#cb69-2250" aria-hidden="true" tabindex="-1"></a><span class="vs">  - **Wet** = number of waterlogging days [NDWL0](https://github.com/AdaptationAtlas/hazards/wiki/Hazards-definitions).  Severe risk = NDWL0 &gt; 5 days (same across all crops and livestock).</span></span>
<span id="cb69-2251"><a href="#cb69-2251" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb69-2252"><a href="#cb69-2252" aria-hidden="true" tabindex="-1"></a><span class="vs">  More details on hazard definitions and thresholds for severity classes can found in the atlas/hazards wiki. Future 2024 updates of the Atlas will add crop specific maximum temperature thresholds and a notebook will be created to allow users to explore hazard risks in more detail.</span></span>
<span id="cb69-2253"><a href="#cb69-2253" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2254"><a href="#cb69-2254" aria-hidden="true" tabindex="-1"></a><span class="vs">3. **Risk**: We average the classified hazards over the years or seasons encompassed by the time-series to obtain an estimation of occurrence risk. </span></span>
<span id="cb69-2255"><a href="#cb69-2255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2256"><a href="#cb69-2256" aria-hidden="true" tabindex="-1"></a><span class="vs">4. **Compound Risks**: To assess the risk of compound hazards, we multiply the risks associated with dry, heat, and wet conditions. This multiplication highlights areas where multiple hazards may coincide, posing greater risk to agricultural outputs.</span></span>
<span id="cb69-2257"><a href="#cb69-2257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2258"><a href="#cb69-2258" aria-hidden="true" tabindex="-1"></a><span class="vs">5. **Integration with Economic Data**: Finally, we multiply the compound crop hazard risk data with crop value of production data. For example, if a crop is exposed to a hazard in 50% of growing seasons and the value of production is $2M/year then, on average, $1M of production is exposed to the hazard.  The exposed value of production is then extracted by administrative areas to indicate potential economic impacts on crop production.</span></span>
<span id="cb69-2259"><a href="#cb69-2259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2260"><a href="#cb69-2260" aria-hidden="true" tabindex="-1"></a><span class="vs">### Adaptive Capacity</span></span>
<span id="cb69-2261"><a href="#cb69-2261" aria-hidden="true" tabindex="-1"></a><span class="vs">To calculate the population distribution according to adaptive capacity variables, we followed these steps:</span></span>
<span id="cb69-2262"><a href="#cb69-2262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2263"><a href="#cb69-2263" aria-hidden="true" tabindex="-1"></a><span class="vs">1. **Data Classification**: We categorized the variablespoverty rates, Female Empowerment Index, and educational attainmentinto three classes each. The classification of the Female Empowerment Index and poverty was based on the tertile distribution of the dataset. For educational attainment, we grouped the data into three categories: 0-1 years of education, 1-5 years of education, and over 5 years of education.</span></span>
<span id="cb69-2264"><a href="#cb69-2264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2265"><a href="#cb69-2265" aria-hidden="true" tabindex="-1"></a><span class="vs">2. **Spatial Intersection**: Next, we spatially overlaid these classified variables with population data. This step identified the specific combination of variable classes for each population segment.</span></span>
<span id="cb69-2266"><a href="#cb69-2266" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2267"><a href="#cb69-2267" aria-hidden="true" tabindex="-1"></a><span class="vs">3. **Spatial Extraction**: We then extracted this overlaid data by administrative boundaries. This allowed us to quantify the population within each area, falling into each adaptive capacity category.</span></span>
<span id="cb69-2268"><a href="#cb69-2268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2269"><a href="#cb69-2269" aria-hidden="true" tabindex="-1"></a><span class="vs">Through this methodology, we generated a comprehensive dataset illustrating the distribution of the population by the three elements, encompassing every combination within each administrative region.`</span><span class="op">,</span></span>
<span id="cb69-2270"><a href="#cb69-2270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2271"><a href="#cb69-2271" aria-hidden="true" tabindex="-1"></a>          <span class="dt">fr</span><span class="op">:</span> <span class="vs">`### Risques Climatiques</span></span>
<span id="cb69-2272"><a href="#cb69-2272" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2273"><a href="#cb69-2273" aria-hidden="true" tabindex="-1"></a><span class="vs">Un flux de travail R dtaill et reproductible pour gnrer des donnes brutes sur les alas climatiques est disponible sur [AdaptationAtlas/Hazards](https://github.com/AdaptationAtlas/hazards).</span></span>
<span id="cb69-2274"><a href="#cb69-2274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2275"><a href="#cb69-2275" aria-hidden="true" tabindex="-1"></a><span class="vs">La transformation des alas climatiques bruts en risques gnriques et spcifiques aux cultures a t ralise  l'aide d'un flux de travail R distinct, mais galement reproductible, qui peut tre trouv dans le projet GitHub [atlas/hazards_prototype](https://github.com/AdaptationAtlas/hazards_prototype). </span></span>
<span id="cb69-2276"><a href="#cb69-2276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2277"><a href="#cb69-2277" aria-hidden="true" tabindex="-1"></a><span class="vs">Le processus de calcul des risques comprend plusieurs tapes critiques:</span></span>
<span id="cb69-2278"><a href="#cb69-2278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2279"><a href="#cb69-2279" aria-hidden="true" tabindex="-1"></a><span class="vs">1. **Synthse annuelle ou saisonnire**: Les donnes brutes sur les risques sont alignes sur le [calendrier des cultures de la phase 3 de GGCMI pour le mas](https://zenodo.org/records/5062513), puis les risques climatiques sont rsums  l'chelle annuelle ou saisonnire. Les futures mises  jour de l'atlas intgreront des calendriers spcifiques aux cultures.</span></span>
<span id="cb69-2280"><a href="#cb69-2280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2281"><a href="#cb69-2281" aria-hidden="true" tabindex="-1"></a><span class="vs">2. **Occurrence**: Pour chaque saison ou anne d'une srie temporelle, nous classons le risque d'occurrence de l'ala (prsent/absent) selon trois niveaux de gravit (modr, grave, extrme). Dans ce *notebook*, la gravit des alas est fixe  "grave".</span></span>
<span id="cb69-2282"><a href="#cb69-2282" aria-hidden="true" tabindex="-1"></a><span class="vs">   </span></span>
<span id="cb69-2283"><a href="#cb69-2283" aria-hidden="true" tabindex="-1"></a><span class="vs">  Les risques spcifiques utiliss dans cette analyse sont les suivants: </span></span>
<span id="cb69-2284"><a href="#cb69-2284" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb69-2285"><a href="#cb69-2285" aria-hidden="true" tabindex="-1"></a><span class="vs">  - **Sec** = nombre de jours de stress hydrique du sol [NDWS](https://github.com/AdaptationAtlas/hazards/wiki/Hazards-definitions). Risque grave = NDWS &gt; 20 jours (identique pour toutes les cultures et le btail).</span></span>
<span id="cb69-2286"><a href="#cb69-2286" aria-hidden="true" tabindex="-1"></a><span class="vs">  - **Chaleur (cultures)** = jours o la temprature maximale est &gt; 35C [NTx35](https://github.com/AdaptationAtlas/hazards/wiki/Hazards-definitions). Risque grave = NTx35 &gt; 20 jours (identique pour toutes les cultures).</span></span>
<span id="cb69-2287"><a href="#cb69-2287" aria-hidden="true" tabindex="-1"></a><span class="vs">  - **Chaleur (btail)** = indice d'humidit thermique [THI](https://github.com/AdaptationAtlas/hazards/wiki/Hazards-definitions). Le risque grave est spcifique  la classe de btail, voir le tableau 2 de [Thorton et al. 2021](https://doi.org/10.1111/gcb.15825).</span></span>
<span id="cb69-2288"><a href="#cb69-2288" aria-hidden="true" tabindex="-1"></a><span class="vs">  - **Humidit** = nombre de jours d'engorgement [NDWL0](https://github.com/AdaptationAtlas/hazards/wiki/Hazards-definitions).  Risque grave = NDWL0 &gt; 5 jours (identique pour toutes les cultures et le btail).</span></span>
<span id="cb69-2289"><a href="#cb69-2289" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb69-2290"><a href="#cb69-2290" aria-hidden="true" tabindex="-1"></a><span class="vs">  Pour plus de dtails sur les dfinitions des risques et les seuils des classes de gravit, voir le wiki atlas/risques. Les futures mises  jour de l'atlas en 2024 ajouteront des seuils de temprature maximale spcifiques aux cultures et un *notebook* sera cr pour permettre aux utilisateurs d'explorer les risques de manire plus dtaille.</span></span>
<span id="cb69-2291"><a href="#cb69-2291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2292"><a href="#cb69-2292" aria-hidden="true" tabindex="-1"></a><span class="vs">3. **Risque**: Nous faisons la moyenne des alas classs sur les annes ou les saisons concernes par la srie chronologique afin d'obtenir une estimation du risque d'occurrence. </span></span>
<span id="cb69-2293"><a href="#cb69-2293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2294"><a href="#cb69-2294" aria-hidden="true" tabindex="-1"></a><span class="vs">4. **Risques Composs**: Pour valuer les risques composs, nous multiplions les risques associs aux conditions de scheresse, de chaleur et d'humidit. Cette multiplication met en vidence les zones o des risques multiples peuvent concider, ce qui reprsente un risque plus important pour la production agricole.</span></span>
<span id="cb69-2295"><a href="#cb69-2295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2296"><a href="#cb69-2296" aria-hidden="true" tabindex="-1"></a><span class="vs">5. **Intgration avec les Donnes conomiques**: Enfin, nous multiplions les donnes sur les risques composs pour les cultures par les donnes sur la valeur de la production des cultures. Par exemple, si une culture est expose  un danger pendant 50 % des saisons de croissance et que la valeur de la production est de 2 millions de dollars par an, alors, en moyenne, 1 million de dollars de la production est expose au danger. La valeur de la production expose est ensuite extraite par zone administrative pour indiquer les impacts conomiques potentiels sur la production agricole.</span></span>
<span id="cb69-2297"><a href="#cb69-2297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2298"><a href="#cb69-2298" aria-hidden="true" tabindex="-1"></a><span class="vs">### Capacit dAdaptation</span></span>
<span id="cb69-2299"><a href="#cb69-2299" aria-hidden="true" tabindex="-1"></a><span class="vs">Pour calculer la rpartition de la population en fonction des variables de la capacit d'adaptation, nous avons suivi les tapes suivantes:</span></span>
<span id="cb69-2300"><a href="#cb69-2300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2301"><a href="#cb69-2301" aria-hidden="true" tabindex="-1"></a><span class="vs">1. **Classification des Donnes**: Nous avons class les variables - taux de pauvret, indice d'autonomisation des femmes et niveau d'instruction - en trois classes chacune. La classification de l'indice d'mancipation des femmes et de la pauvret tait base sur la distribution par tertile de l'ensemble des donnes. Pour le niveau d'ducation, nous avons regroup les donnes en trois catgories : 0-1 anne d'ducation, 1-5 annes d'ducation et plus de 5 annes d'ducation.</span></span>
<span id="cb69-2302"><a href="#cb69-2302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2303"><a href="#cb69-2303" aria-hidden="true" tabindex="-1"></a><span class="vs">2. **Intersection Spatiale**: Ensuite, nous avons superpos dans l'espace ces variables classes avec les donnes dmographiques. Cette tape a permis d'identifier la combinaison spcifique de classes de variables pour chaque segment de population.</span></span>
<span id="cb69-2304"><a href="#cb69-2304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2305"><a href="#cb69-2305" aria-hidden="true" tabindex="-1"></a><span class="vs">3. **Extraction Spatiale**: Nous avons ensuite extrait ces donnes superposes en fonction des limites administratives. Cela nous a permis de quantifier la population dans chaque zone, tombant dans chaque catgorie de capacit d'adaptation.</span></span>
<span id="cb69-2306"><a href="#cb69-2306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-2307"><a href="#cb69-2307" aria-hidden="true" tabindex="-1"></a><span class="vs">Grce  cette mthodologie, nous avons gnr un ensemble de donnes complet illustrant la rpartition de la population en fonction des trois lments, englobant toutes les combinaisons au sein de chaque rgion administrative.`</span></span>
<span id="cb69-2308"><a href="#cb69-2308" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb69-2309"><a href="#cb69-2309" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb69-2310"><a href="#cb69-2310" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb69-2311"><a href="#cb69-2311" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb69-2312"><a href="#cb69-2312" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-69" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb70" data-startfrom="2316" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2315"><span id="cb70-2316"><a href="#cb70-2316" aria-hidden="true" tabindex="-1"></a><span class="co">// data translation values</span></span>
<span id="cb70-2317"><a href="#cb70-2317" aria-hidden="true" tabindex="-1"></a>td <span class="op">=</span> {</span>
<span id="cb70-2318"><a href="#cb70-2318" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> data <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"abAtlas-td-translation-data-v3.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb70-2319"><a href="#cb70-2319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-2320"><a href="#cb70-2320" aria-hidden="true" tabindex="-1"></a>  <span class="co">// // update SSA default</span></span>
<span id="cb70-2321"><a href="#cb70-2321" aria-hidden="true" tabindex="-1"></a>  <span class="co">// data.admin0_name.values.SSA.en = "Sub-Saharan Africa"</span></span>
<span id="cb70-2322"><a href="#cb70-2322" aria-hidden="true" tabindex="-1"></a>  <span class="co">// // cote d'ivoire, comma version duplicate</span></span>
<span id="cb70-2323"><a href="#cb70-2323" aria-hidden="true" tabindex="-1"></a>  <span class="co">// data.admin0_name.values["Cte dIvoire"] = data.admin0_name.values["Cte d'Ivoire"]</span></span>
<span id="cb70-2324"><a href="#cb70-2324" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-2325"><a href="#cb70-2325" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data</span>
<span id="cb70-2326"><a href="#cb70-2326" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-70" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb71" data-startfrom="2330" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2329"><span id="cb71-2330"><a href="#cb71-2330" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb71-2331"><a href="#cb71-2331" aria-hidden="true" tabindex="-1"></a><span class="vs">### Notebook Styling</span></span>
<span id="cb71-2332"><a href="#cb71-2332" aria-hidden="true" tabindex="-1"></a><span class="vs">*styling helpers*</span></span>
<span id="cb71-2333"><a href="#cb71-2333" aria-hidden="true" tabindex="-1"></a><span class="vs">Stylesheet is a named cell, which is necessary to include for embeds.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-71" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb72" data-startfrom="2337" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2336"><span id="cb72-2337"><a href="#cb72-2337" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`**Color Scales**`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-72" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb73" data-startfrom="2341" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2340"><span id="cb73-2341"><a href="#cb73-2341" aria-hidden="true" tabindex="-1"></a><span class="co">// color scale info</span></span>
<span id="cb73-2342"><a href="#cb73-2342" aria-hidden="true" tabindex="-1"></a>colorScales <span class="op">=</span> {</span>
<span id="cb73-2343"><a href="#cb73-2343" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb73-2344"><a href="#cb73-2344" aria-hidden="true" tabindex="-1"></a>    <span class="dt">range</span><span class="op">:</span> {</span>
<span id="cb73-2345"><a href="#cb73-2345" aria-hidden="true" tabindex="-1"></a>      <span class="dt">green</span><span class="op">:</span> [<span class="st">'#E4F5D0'</span><span class="op">,</span> <span class="st">'#015023'</span>]<span class="op">,</span></span>
<span id="cb73-2346"><a href="#cb73-2346" aria-hidden="true" tabindex="-1"></a>      <span class="dt">blue</span><span class="op">:</span> [<span class="st">'#E8F2FF'</span><span class="op">,</span> <span class="st">'#003E6B'</span>]<span class="op">,</span></span>
<span id="cb73-2347"><a href="#cb73-2347" aria-hidden="true" tabindex="-1"></a>      <span class="dt">brown</span><span class="op">:</span> [<span class="st">'#FFFDE5'</span><span class="op">,</span> <span class="st">'#A87B00'</span>]<span class="op">,</span></span>
<span id="cb73-2348"><a href="#cb73-2348" aria-hidden="true" tabindex="-1"></a>      <span class="dt">yellowGreen</span><span class="op">:</span> [<span class="st">'#F7D732'</span><span class="op">,</span> <span class="st">'#216729'</span>]<span class="op">,</span></span>
<span id="cb73-2349"><a href="#cb73-2349" aria-hidden="true" tabindex="-1"></a>      <span class="dt">orangeRed</span><span class="op">:</span> [<span class="st">'#F4BB21'</span><span class="op">,</span> <span class="st">'#EC5A47'</span>]<span class="op">,</span></span>
<span id="cb73-2350"><a href="#cb73-2350" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb73-2351"><a href="#cb73-2351" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unknown</span><span class="op">:</span> <span class="st">"#ccc"</span></span>
<span id="cb73-2352"><a href="#cb73-2352" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb73-2353"><a href="#cb73-2353" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-73" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb74" data-startfrom="2357" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2356"><span id="cb74-2357"><a href="#cb74-2357" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb74-2358"><a href="#cb74-2358" aria-hidden="true" tabindex="-1"></a><span class="vs">### Admin Selection</span></span>
<span id="cb74-2359"><a href="#cb74-2359" aria-hidden="true" tabindex="-1"></a><span class="vs">*Global admin selector using dropdowns*</span></span>
<span id="cb74-2360"><a href="#cb74-2360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-2361"><a href="#cb74-2361" aria-hidden="true" tabindex="-1"></a><span class="vs">This is the global selector for the selected region</span></span>
<span id="cb74-2362"><a href="#cb74-2362" aria-hidden="true" tabindex="-1"></a><span class="vs">- The completed data is contained within adminSelections to be used in queries</span></span>
<span id="cb74-2363"><a href="#cb74-2363" aria-hidden="true" tabindex="-1"></a><span class="vs">- Dropdowns are defined below then bound for each section</span></span>
<span id="cb74-2364"><a href="#cb74-2364" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Defined as separate cells since they dynamically respond to different values</span></span>
<span id="cb74-2365"><a href="#cb74-2365" aria-hidden="true" tabindex="-1"></a><span class="vs">    - In narrative, they are simply views of the data  </span></span>
<span id="cb74-2366"><a href="#cb74-2366" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Dropdowns are dynamic based on higher-level choices</span></span>
<span id="cb74-2367"><a href="#cb74-2367" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Options are defined from the geographic data</span></span>
<span id="cb74-2368"><a href="#cb74-2368" aria-hidden="true" tabindex="-1"></a><span class="vs">  - null value means unselected region</span></span>
<span id="cb74-2369"><a href="#cb74-2369" aria-hidden="true" tabindex="-1"></a><span class="vs">- Dropdowns are added to each section, using Inputs.bind to create synchronized inputs (see viewof for input definitions). A form input is used to consolidate and apply a template to format.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-74" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb75" data-startfrom="2373" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2372"><span id="cb75-2373"><a href="#cb75-2373" aria-hidden="true" tabindex="-1"></a><span class="co">// get admin0 options from geo</span></span>
<span id="cb75-2374"><a href="#cb75-2374" aria-hidden="true" tabindex="-1"></a>dataAdmin0 <span class="op">=</span> {</span>
<span id="cb75-2375"><a href="#cb75-2375" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> admin0<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span>)<span class="op">;</span></span>
<span id="cb75-2376"><a href="#cb75-2376" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add a blank value</span></span>
<span id="cb75-2377"><a href="#cb75-2377" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [<span class="kw">null</span><span class="op">,</span> <span class="op">...</span>data<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin_name</span>)]<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb75-2378"><a href="#cb75-2378" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb75-2379"><a href="#cb75-2379" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span></span>
<span id="cb75-2380"><a href="#cb75-2380" aria-hidden="true" tabindex="-1"></a>        d <span class="op">==</span> <span class="kw">null</span> <span class="op">?</span> globalSelection<span class="op">.</span><span class="at">label</span> <span class="op">:</span> <span class="fu">_lang</span>(td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[d]<span class="op">.</span><span class="at">general</span>)<span class="op">,</span></span>
<span id="cb75-2381"><a href="#cb75-2381" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> d</span>
<span id="cb75-2382"><a href="#cb75-2382" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb75-2383"><a href="#cb75-2383" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb75-2384"><a href="#cb75-2384" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-75" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb76" data-startfrom="2388" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2387"><span id="cb76-2388"><a href="#cb76-2388" aria-hidden="true" tabindex="-1"></a><span class="co">// get admin1 options based on admin0 selection</span></span>
<span id="cb76-2389"><a href="#cb76-2389" aria-hidden="true" tabindex="-1"></a><span class="co">// (the admin1 regions within selected admin0)</span></span>
<span id="cb76-2390"><a href="#cb76-2390" aria-hidden="true" tabindex="-1"></a>dataAdmin1 <span class="op">=</span> {</span>
<span id="cb76-2391"><a href="#cb76-2391" aria-hidden="true" tabindex="-1"></a>  <span class="co">// admin 1, filter by 0 </span></span>
<span id="cb76-2392"><a href="#cb76-2392" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const data = boundaries.admin1.features.map(d =&gt; d.properties)</span></span>
<span id="cb76-2393"><a href="#cb76-2393" aria-hidden="true" tabindex="-1"></a>  <span class="co">// .filter(d =&gt; d.admin0_name == selectAdmin0.value)</span></span>
<span id="cb76-2394"><a href="#cb76-2394" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> geo_db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`SELECT DISTINCT admin1_name FROM admin1_geom WHERE admin0_name = '</span><span class="sc">${</span>selectAdmin0<span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'`</span>)</span>
<span id="cb76-2395"><a href="#cb76-2395" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add blank value</span></span>
<span id="cb76-2396"><a href="#cb76-2396" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allLabel <span class="op">=</span> {</span>
<span id="cb76-2397"><a href="#cb76-2397" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">allLabels</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span></span>
<span id="cb76-2398"><a href="#cb76-2398" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="kw">null</span></span>
<span id="cb76-2399"><a href="#cb76-2399" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-2400"><a href="#cb76-2400" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [allLabel<span class="op">,</span> <span class="op">...</span>data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb76-2401"><a href="#cb76-2401" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb76-2402"><a href="#cb76-2402" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> d<span class="op">.</span><span class="at">admin1_name</span><span class="op">,</span></span>
<span id="cb76-2403"><a href="#cb76-2403" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">admin1_name</span><span class="op">,</span></span>
<span id="cb76-2404"><a href="#cb76-2404" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb76-2405"><a href="#cb76-2405" aria-hidden="true" tabindex="-1"></a>  })]<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb76-2406"><a href="#cb76-2406" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="dt">label</span><span class="op">:</span> d<span class="op">.</span><span class="at">label</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">value</span>}</span>
<span id="cb76-2407"><a href="#cb76-2407" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb76-2408"><a href="#cb76-2408" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-76" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb77" data-startfrom="2412" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2411"><span id="cb77-2412"><a href="#cb77-2412" aria-hidden="true" tabindex="-1"></a><span class="co">// get admin2 options based on admin1 selection</span></span>
<span id="cb77-2413"><a href="#cb77-2413" aria-hidden="true" tabindex="-1"></a><span class="co">// (the admin2 regions within selected admin1)</span></span>
<span id="cb77-2414"><a href="#cb77-2414" aria-hidden="true" tabindex="-1"></a>dataAdmin2 <span class="op">=</span> {</span>
<span id="cb77-2415"><a href="#cb77-2415" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const data = boundaries.admin2.features.map(d =&gt; d.properties)</span></span>
<span id="cb77-2416"><a href="#cb77-2416" aria-hidden="true" tabindex="-1"></a>  <span class="co">// .filter(d =&gt; d.admin0_name == selectAdmin0.value &amp;&amp; d.admin1_name == selectAdmin1.value)</span></span>
<span id="cb77-2417"><a href="#cb77-2417" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> <span class="cf">await</span> geo_db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`SELECT DISTINCT admin2_name FROM admin2_geom WHERE admin0_name = '</span><span class="sc">${</span>selectAdmin0<span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">' AND admin1_name = '</span><span class="sc">${</span><span class="fu">cleanAdminInput_SQL</span>(selectAdmin1<span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">'`</span>)</span>
<span id="cb77-2418"><a href="#cb77-2418" aria-hidden="true" tabindex="-1"></a>  <span class="co">// add blank value</span></span>
<span id="cb77-2419"><a href="#cb77-2419" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> allLabel <span class="op">=</span> {</span>
<span id="cb77-2420"><a href="#cb77-2420" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">allLabels</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span></span>
<span id="cb77-2421"><a href="#cb77-2421" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="kw">null</span></span>
<span id="cb77-2422"><a href="#cb77-2422" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb77-2423"><a href="#cb77-2423" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [allLabel<span class="op">,</span> <span class="op">...</span>data<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb77-2424"><a href="#cb77-2424" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb77-2425"><a href="#cb77-2425" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> d<span class="op">.</span><span class="at">admin2_name</span><span class="op">,</span></span>
<span id="cb77-2426"><a href="#cb77-2426" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">admin2_name</span><span class="op">,</span></span>
<span id="cb77-2427"><a href="#cb77-2427" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb77-2428"><a href="#cb77-2428" aria-hidden="true" tabindex="-1"></a>  })]<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> {</span>
<span id="cb77-2429"><a href="#cb77-2429" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {<span class="dt">label</span><span class="op">:</span> d<span class="op">.</span><span class="at">label</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> d<span class="op">.</span><span class="at">value</span>}</span>
<span id="cb77-2430"><a href="#cb77-2430" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb77-2431"><a href="#cb77-2431" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-77" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb78" data-startfrom="2435" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2434"><span id="cb78-2435"><a href="#cb78-2435" aria-hidden="true" tabindex="-1"></a>viewof selectAdmin0 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin0<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin0</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-78" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb79" data-startfrom="2439" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2438"><span id="cb79-2439"><a href="#cb79-2439" aria-hidden="true" tabindex="-1"></a>viewof selectAdmin1 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin1<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-79" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb80" data-startfrom="2443" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2442"><span id="cb80-2443"><a href="#cb80-2443" aria-hidden="true" tabindex="-1"></a>viewof selectAdmin2 <span class="op">=</span> Inputs<span class="op">.</span><span class="fu">select</span>(dataAdmin2<span class="op">,</span> {<span class="dt">label</span><span class="op">:</span> adminRegions<span class="op">.</span><span class="at">labels</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span> <span class="dt">format</span><span class="op">:</span> x <span class="kw">=&gt;</span> x<span class="op">.</span><span class="at">label</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-80" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb81" data-startfrom="2447" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2446"><span id="cb81-2447"><a href="#cb81-2447" aria-hidden="true" tabindex="-1"></a><span class="co">// selected admin regions from dropdowns</span></span>
<span id="cb81-2448"><a href="#cb81-2448" aria-hidden="true" tabindex="-1"></a>adminSelections <span class="op">=</span> <span class="kw">new</span> <span class="bu">Object</span>({</span>
<span id="cb81-2449"><a href="#cb81-2449" aria-hidden="true" tabindex="-1"></a>  <span class="dt">selectAdmin0</span><span class="op">:</span> selectAdmin0<span class="op">,</span></span>
<span id="cb81-2450"><a href="#cb81-2450" aria-hidden="true" tabindex="-1"></a>  <span class="dt">selectAdmin1</span><span class="op">:</span> selectAdmin1<span class="op">,</span></span>
<span id="cb81-2451"><a href="#cb81-2451" aria-hidden="true" tabindex="-1"></a>  <span class="dt">selectAdmin2</span><span class="op">:</span> selectAdmin2<span class="op">,</span></span>
<span id="cb81-2452"><a href="#cb81-2452" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-81" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb82" data-startfrom="2456" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2455"><span id="cb82-2456"><a href="#cb82-2456" aria-hidden="true" tabindex="-1"></a><span class="co">// template to format admin selection form</span></span>
<span id="cb82-2457"><a href="#cb82-2457" aria-hidden="true" tabindex="-1"></a>adminFormTemplate <span class="op">=</span> (inputs) <span class="kw">=&gt;</span></span>
<span id="cb82-2458"><a href="#cb82-2458" aria-hidden="true" tabindex="-1"></a>  htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;div style="display: flex; gap: 3em"&gt;</span><span class="sc">${</span>inputs<span class="sc">}</span><span class="vs">&lt;/div&gt;`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-82" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb83" data-startfrom="2462" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2461"><span id="cb83-2462"><a href="#cb83-2462" aria-hidden="true" tabindex="-1"></a>getAdminSelectionLabelWithParen <span class="op">=</span> ({</span>
<span id="cb83-2463"><a href="#cb83-2463" aria-hidden="true" tabindex="-1"></a>  selections <span class="op">=</span> adminSelections<span class="op">,</span></span>
<span id="cb83-2464"><a href="#cb83-2464" aria-hidden="true" tabindex="-1"></a>  admin0Label<span class="op">,</span></span>
<span id="cb83-2465"><a href="#cb83-2465" aria-hidden="true" tabindex="-1"></a>  adminSublabel<span class="op">,</span></span>
<span id="cb83-2466"><a href="#cb83-2466" aria-hidden="true" tabindex="-1"></a>} <span class="op">=</span> {}) <span class="kw">=&gt;</span> {</span>
<span id="cb83-2467"><a href="#cb83-2467" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return admin0 selection and admin1/admin2 selection if chosen (in parentheses)</span></span>
<span id="cb83-2468"><a href="#cb83-2468" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (selections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span> <span class="op">===</span> <span class="kw">null</span>) {</span>
<span id="cb83-2469"><a href="#cb83-2469" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> admin0Label<span class="op">;</span></span>
<span id="cb83-2470"><a href="#cb83-2470" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb83-2471"><a href="#cb83-2471" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>admin0Label<span class="sc">}</span><span class="vs"> (</span><span class="sc">${</span>adminSublabel<span class="sc">}</span><span class="vs">)`</span><span class="op">;</span></span>
<span id="cb83-2472"><a href="#cb83-2472" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb83-2473"><a href="#cb83-2473" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-83" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb84" data-startfrom="2477" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2476"><span id="cb84-2477"><a href="#cb84-2477" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb84-2478"><a href="#cb84-2478" aria-hidden="true" tabindex="-1"></a><span class="vs">### Admin Selection - Display</span></span>
<span id="cb84-2479"><a href="#cb84-2479" aria-hidden="true" tabindex="-1"></a><span class="vs">*Showing admin selections*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-84" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb85" data-startfrom="2483" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2482"><span id="cb85-2483"><a href="#cb85-2483" aria-hidden="true" tabindex="-1"></a><span class="co">// options for the global admin selection</span></span>
<span id="cb85-2484"><a href="#cb85-2484" aria-hidden="true" tabindex="-1"></a><span class="co">// used when no admin selection is made</span></span>
<span id="cb85-2485"><a href="#cb85-2485" aria-hidden="true" tabindex="-1"></a>globalSelection <span class="op">=</span> {</span>
<span id="cb85-2486"><a href="#cb85-2486" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb85-2487"><a href="#cb85-2487" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(td<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">values</span><span class="op">.</span><span class="at">SSA</span><span class="op">.</span><span class="at">general</span>)<span class="op">,</span></span>
<span id="cb85-2488"><a href="#cb85-2488" aria-hidden="true" tabindex="-1"></a>    <span class="dt">value</span><span class="op">:</span> <span class="kw">null</span></span>
<span id="cb85-2489"><a href="#cb85-2489" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb85-2490"><a href="#cb85-2490" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-85" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb86" data-startfrom="2494" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2493"><span id="cb86-2494"><a href="#cb86-2494" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getAdminSelection</span>(selections <span class="op">=</span> adminSelections) {</span>
<span id="cb86-2495"><a href="#cb86-2495" aria-hidden="true" tabindex="-1"></a>  <span class="co">// get the most granular admin selection made</span></span>
<span id="cb86-2496"><a href="#cb86-2496" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a0 <span class="op">=</span> selections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">;</span></span>
<span id="cb86-2497"><a href="#cb86-2497" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a1 <span class="op">=</span> selections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">;</span></span>
<span id="cb86-2498"><a href="#cb86-2498" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a2 <span class="op">=</span> selections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">;</span></span>
<span id="cb86-2499"><a href="#cb86-2499" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> <span class="bu">global</span> <span class="op">=</span> globalSelection<span class="op">;</span></span>
<span id="cb86-2500"><a href="#cb86-2500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-2501"><a href="#cb86-2501" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a2<span class="op">.</span><span class="at">value</span> <span class="op">?</span> a2 <span class="op">:</span> a1<span class="op">.</span><span class="at">value</span> <span class="op">?</span> a1 <span class="op">:</span> a0<span class="op">.</span><span class="at">value</span> <span class="op">?</span> a0 <span class="op">:</span> <span class="bu">global</span><span class="op">;</span></span>
<span id="cb86-2502"><a href="#cb86-2502" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-86" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb87" data-startfrom="2506" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2505"><span id="cb87-2506"><a href="#cb87-2506" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getAdminSelectionAdmin0</span>(selections <span class="op">=</span> adminSelections) {</span>
<span id="cb87-2507"><a href="#cb87-2507" aria-hidden="true" tabindex="-1"></a>  <span class="co">// get the selected admin0 or global value</span></span>
<span id="cb87-2508"><a href="#cb87-2508" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> a0 <span class="op">=</span> selections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">;</span></span>
<span id="cb87-2509"><a href="#cb87-2509" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> <span class="bu">global</span> <span class="op">=</span> globalSelection<span class="op">.</span><span class="at">label</span><span class="op">;</span></span>
<span id="cb87-2510"><a href="#cb87-2510" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-2511"><a href="#cb87-2511" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> a0 <span class="op">?</span> a0 <span class="op">:</span> <span class="bu">global</span><span class="op">;</span></span>
<span id="cb87-2512"><a href="#cb87-2512" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-87" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb88" data-startfrom="2516" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2515"><span id="cb88-2516"><a href="#cb88-2516" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getAdminSelectionMarkdownPath</span>(selections <span class="op">=</span> adminSelections) {</span>
<span id="cb88-2517"><a href="#cb88-2517" aria-hidden="true" tabindex="-1"></a>  <span class="co">// function to show selected admin region</span></span>
<span id="cb88-2518"><a href="#cb88-2518" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return path showing nested admin selection</span></span>
<span id="cb88-2519"><a href="#cb88-2519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-2520"><a href="#cb88-2520" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> delim <span class="op">=</span> <span class="st">"  "</span><span class="op">;</span></span>
<span id="cb88-2521"><a href="#cb88-2521" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> path <span class="op">=</span> [</span>
<span id="cb88-2522"><a href="#cb88-2522" aria-hidden="true" tabindex="-1"></a>    selections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">,</span></span>
<span id="cb88-2523"><a href="#cb88-2523" aria-hidden="true" tabindex="-1"></a>    selections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">,</span></span>
<span id="cb88-2524"><a href="#cb88-2524" aria-hidden="true" tabindex="-1"></a>    selections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">,</span></span>
<span id="cb88-2525"><a href="#cb88-2525" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d)<span class="op">;</span></span>
<span id="cb88-2526"><a href="#cb88-2526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-2527"><a href="#cb88-2527" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatted <span class="op">=</span> path</span>
<span id="cb88-2528"><a href="#cb88-2528" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d)</span>
<span id="cb88-2529"><a href="#cb88-2529" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>((d<span class="op">,</span> i) <span class="kw">=&gt;</span> {</span>
<span id="cb88-2530"><a href="#cb88-2530" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> i <span class="op">==</span> path<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span> <span class="op">?</span> <span class="vs">`**</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs">**`</span> <span class="op">:</span> <span class="vs">`*</span><span class="sc">${</span>d<span class="sc">}</span><span class="vs">*`</span><span class="op">;</span></span>
<span id="cb88-2531"><a href="#cb88-2531" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb88-2532"><a href="#cb88-2532" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-2533"><a href="#cb88-2533" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> formatted<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb88-2534"><a href="#cb88-2534" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="vs">`**</span><span class="sc">${</span>globalSelection<span class="op">.</span><span class="at">label</span><span class="sc">}</span><span class="vs">**`</span> <span class="co">// no selection, all of Africa</span></span>
<span id="cb88-2535"><a href="#cb88-2535" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>formatted<span class="op">.</span><span class="fu">join</span>(delim)<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb88-2536"><a href="#cb88-2536" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-88" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb89" data-startfrom="2540" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2539"><span id="cb89-2540"><a href="#cb89-2540" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb89-2541"><a href="#cb89-2541" aria-hidden="true" tabindex="-1"></a><span class="vs">### Choropleth map - Geographic Impact</span></span>
<span id="cb89-2542"><a href="#cb89-2542" aria-hidden="true" tabindex="-1"></a><span class="vs">*Showing context for admin selection*</span></span>
<span id="cb89-2543"><a href="#cb89-2543" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-2544"><a href="#cb89-2544" aria-hidden="true" tabindex="-1"></a><span class="vs">There is some hoop-jumping to get the right data based on the Admin Selection. The tabular data is then bound to the applicable geojson, and visualized with Plot.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-89" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb90" data-startfrom="2548" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2547"><span id="cb90-2548"><a href="#cb90-2548" aria-hidden="true" tabindex="-1"></a>dataPopulation <span class="op">=</span> <span class="kw">async</span> (admin_query) <span class="kw">=&gt;</span> {</span>
<span id="cb90-2549"><a href="#cb90-2549" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb90-2550"><a href="#cb90-2550" aria-hidden="true" tabindex="-1"></a><span class="vs">select * </span></span>
<span id="cb90-2551"><a href="#cb90-2551" aria-hidden="true" tabindex="-1"></a><span class="vs">from population</span></span>
<span id="cb90-2552"><a href="#cb90-2552" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>admin_query<span class="sc">}</span></span>
<span id="cb90-2553"><a href="#cb90-2553" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb90-2554"><a href="#cb90-2554" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-90" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb91" data-startfrom="2558" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2557"><span id="cb91-2558"><a href="#cb91-2558" aria-hidden="true" tabindex="-1"></a><span class="co">// // total VoP data</span></span>
<span id="cb91-2559"><a href="#cb91-2559" aria-hidden="true" tabindex="-1"></a>dataTotalVoP <span class="op">=</span> <span class="kw">async</span> (admin_query) <span class="kw">=&gt;</span> {</span>
<span id="cb91-2560"><a href="#cb91-2560" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb91-2561"><a href="#cb91-2561" aria-hidden="true" tabindex="-1"></a><span class="vs">select admin0_name</span></span>
<span id="cb91-2562"><a href="#cb91-2562" aria-hidden="true" tabindex="-1"></a><span class="vs">  , admin1_name</span></span>
<span id="cb91-2563"><a href="#cb91-2563" aria-hidden="true" tabindex="-1"></a><span class="vs">  , admin2_name</span></span>
<span id="cb91-2564"><a href="#cb91-2564" aria-hidden="true" tabindex="-1"></a><span class="vs">  , SUM(value) as vop_total</span></span>
<span id="cb91-2565"><a href="#cb91-2565" aria-hidden="true" tabindex="-1"></a><span class="vs">  from vop</span></span>
<span id="cb91-2566"><a href="#cb91-2566" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span><span class="sc">${</span>admin_query<span class="sc">}</span></span>
<span id="cb91-2567"><a href="#cb91-2567" aria-hidden="true" tabindex="-1"></a><span class="vs">  group by admin0_name, admin1_name, admin2_name</span></span>
<span id="cb91-2568"><a href="#cb91-2568" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by admin0_name, admin1_name, admin2_name</span></span>
<span id="cb91-2569"><a href="#cb91-2569" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb91-2570"><a href="#cb91-2570" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-91" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb92" data-startfrom="2574" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2573"><span id="cb92-2574"><a href="#cb92-2574" aria-hidden="true" tabindex="-1"></a><span class="co">// grab tabular data for choropleth</span></span>
<span id="cb92-2575"><a href="#cb92-2575" aria-hidden="true" tabindex="-1"></a>dataGeoImpact <span class="op">=</span> {</span>
<span id="cb92-2576"><a href="#cb92-2576" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> admin_query</span>
<span id="cb92-2577"><a href="#cb92-2577" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>) {</span>
<span id="cb92-2578"><a href="#cb92-2578" aria-hidden="true" tabindex="-1"></a>    admin_query <span class="op">=</span> <span class="vs">`WHERE admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">' AND admin1_name = '</span><span class="sc">${</span><span class="fu">cleanAdminInput_SQL</span>(adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">' AND admin2_name IS NOT NULL`</span></span>
<span id="cb92-2579"><a href="#cb92-2579" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) {</span>
<span id="cb92-2580"><a href="#cb92-2580" aria-hidden="true" tabindex="-1"></a>    admin_query <span class="op">=</span> <span class="vs">`WHERE admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">' AND admin1_name IS NOT NULL AND admin2_name IS NULL`</span></span>
<span id="cb92-2581"><a href="#cb92-2581" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb92-2582"><a href="#cb92-2582" aria-hidden="true" tabindex="-1"></a>    admin_query <span class="op">=</span> <span class="vs">`WHERE admin1_name IS NULL`</span></span>
<span id="cb92-2583"><a href="#cb92-2583" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb92-2584"><a href="#cb92-2584" aria-hidden="true" tabindex="-1"></a>  <span class="co">// get data for choropleth map based on choice</span></span>
<span id="cb92-2585"><a href="#cb92-2585" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataSource <span class="op">=</span> selectGeoDataType<span class="op">.</span><span class="at">key</span> <span class="op">==</span> <span class="st">"population"</span></span>
<span id="cb92-2586"><a href="#cb92-2586" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="cf">await</span> <span class="fu">dataPopulation</span>(admin_query)</span>
<span id="cb92-2587"><a href="#cb92-2587" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="cf">await</span> <span class="fu">dataTotalVoP</span>(admin_query)</span>
<span id="cb92-2588"><a href="#cb92-2588" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> dataSource </span>
<span id="cb92-2589"><a href="#cb92-2589" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-92" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb93" data-startfrom="2593" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2592"><span id="cb93-2593"><a href="#cb93-2593" aria-hidden="true" tabindex="-1"></a><span class="co">// bind geojson to tabular data</span></span>
<span id="cb93-2594"><a href="#cb93-2594" aria-hidden="true" tabindex="-1"></a>mapDataGeoImpact <span class="op">=</span> {</span>
<span id="cb93-2595"><a href="#cb93-2595" aria-hidden="true" tabindex="-1"></a>  <span class="co">// no selections</span></span>
<span id="cb93-2596"><a href="#cb93-2596" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) {</span>
<span id="cb93-2597"><a href="#cb93-2597" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">bindTabularToGeo</span>({</span>
<span id="cb93-2598"><a href="#cb93-2598" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> dataGeoImpact<span class="op">,</span></span>
<span id="cb93-2599"><a href="#cb93-2599" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataBindColumn</span><span class="op">:</span> <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb93-2600"><a href="#cb93-2600" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoData</span><span class="op">:</span> boundaries<span class="op">.</span><span class="at">admin0</span><span class="op">,</span></span>
<span id="cb93-2601"><a href="#cb93-2601" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoDataBindColumn</span><span class="op">:</span> <span class="st">"admin0_name"</span></span>
<span id="cb93-2602"><a href="#cb93-2602" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb93-2603"><a href="#cb93-2603" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-2604"><a href="#cb93-2604" aria-hidden="true" tabindex="-1"></a>  <span class="co">// admin0 selected only</span></span>
<span id="cb93-2605"><a href="#cb93-2605" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (<span class="op">!</span>adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>) {</span>
<span id="cb93-2606"><a href="#cb93-2606" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb93-2607"><a href="#cb93-2607" aria-hidden="true" tabindex="-1"></a>      dataGeoImpact<span class="op">,</span></span>
<span id="cb93-2608"><a href="#cb93-2608" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">mutate</span>({ <span class="dt">a1_a0</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">admin1_name</span><span class="op">,</span> d<span class="op">.</span><span class="at">admin0_name</span>]<span class="op">.</span><span class="fu">join</span>(<span class="st">"_"</span>) })</span>
<span id="cb93-2609"><a href="#cb93-2609" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb93-2610"><a href="#cb93-2610" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> geoData <span class="op">=</span> {</span>
<span id="cb93-2611"><a href="#cb93-2611" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>boundaries<span class="op">.</span><span class="at">admin1</span><span class="op">,</span></span>
<span id="cb93-2612"><a href="#cb93-2612" aria-hidden="true" tabindex="-1"></a>      <span class="dt">features</span><span class="op">:</span> boundaries<span class="op">.</span><span class="at">admin1</span><span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">filter</span>(</span>
<span id="cb93-2613"><a href="#cb93-2613" aria-hidden="true" tabindex="-1"></a>        (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb93-2614"><a href="#cb93-2614" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb93-2615"><a href="#cb93-2615" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb93-2616"><a href="#cb93-2616" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-2617"><a href="#cb93-2617" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">bindTabularToGeo</span>({</span>
<span id="cb93-2618"><a href="#cb93-2618" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb93-2619"><a href="#cb93-2619" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataBindColumn</span><span class="op">:</span> <span class="st">"a1_a0"</span><span class="op">,</span></span>
<span id="cb93-2620"><a href="#cb93-2620" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoData</span><span class="op">:</span> geoData<span class="op">,</span></span>
<span id="cb93-2621"><a href="#cb93-2621" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoDataBindColumn</span><span class="op">:</span> <span class="st">"a1_a0"</span></span>
<span id="cb93-2622"><a href="#cb93-2622" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb93-2623"><a href="#cb93-2623" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-2624"><a href="#cb93-2624" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-2625"><a href="#cb93-2625" aria-hidden="true" tabindex="-1"></a>  <span class="co">// admin1 is selected</span></span>
<span id="cb93-2626"><a href="#cb93-2626" aria-hidden="true" tabindex="-1"></a>  <span class="co">// show all admin2 regions within admin1</span></span>
<span id="cb93-2627"><a href="#cb93-2627" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb93-2628"><a href="#cb93-2628" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> data <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb93-2629"><a href="#cb93-2629" aria-hidden="true" tabindex="-1"></a>      dataGeoImpact<span class="op">,</span></span>
<span id="cb93-2630"><a href="#cb93-2630" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb93-2631"><a href="#cb93-2631" aria-hidden="true" tabindex="-1"></a>        <span class="dt">a2_a1_a0</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">admin2_name</span><span class="op">,</span> d<span class="op">.</span><span class="at">admin1_name</span><span class="op">,</span> d<span class="op">.</span><span class="at">admin0_name</span>]<span class="op">.</span><span class="fu">join</span>(<span class="st">"_"</span>)</span>
<span id="cb93-2632"><a href="#cb93-2632" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb93-2633"><a href="#cb93-2633" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb93-2634"><a href="#cb93-2634" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> geoData <span class="op">=</span> {</span>
<span id="cb93-2635"><a href="#cb93-2635" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>boundaries<span class="op">.</span><span class="at">admin2</span><span class="op">,</span></span>
<span id="cb93-2636"><a href="#cb93-2636" aria-hidden="true" tabindex="-1"></a>      <span class="dt">features</span><span class="op">:</span> boundaries<span class="op">.</span><span class="at">admin2</span><span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb93-2637"><a href="#cb93-2637" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin1_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb93-2638"><a href="#cb93-2638" aria-hidden="true" tabindex="-1"></a>          <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb93-2639"><a href="#cb93-2639" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb93-2640"><a href="#cb93-2640" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb93-2641"><a href="#cb93-2641" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb93-2642"><a href="#cb93-2642" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">bindTabularToGeo</span>({</span>
<span id="cb93-2643"><a href="#cb93-2643" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb93-2644"><a href="#cb93-2644" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dataBindColumn</span><span class="op">:</span> <span class="st">"a2_a1_a0"</span><span class="op">,</span></span>
<span id="cb93-2645"><a href="#cb93-2645" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoData</span><span class="op">:</span> geoData<span class="op">,</span></span>
<span id="cb93-2646"><a href="#cb93-2646" aria-hidden="true" tabindex="-1"></a>      <span class="dt">geoDataBindColumn</span><span class="op">:</span> <span class="st">"a2_a1_a0"</span></span>
<span id="cb93-2647"><a href="#cb93-2647" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb93-2648"><a href="#cb93-2648" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb93-2649"><a href="#cb93-2649" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-93" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb94" data-startfrom="2653" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2652"><span id="cb94-2653"><a href="#cb94-2653" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb94-2654"><a href="#cb94-2654" aria-hidden="true" tabindex="-1"></a><span class="vs">### Dynamic Insights - Geographic Impact</span></span>
<span id="cb94-2655"><a href="#cb94-2655" aria-hidden="true" tabindex="-1"></a><span class="vs">*quick insights for given admin selection*</span></span>
<span id="cb94-2656"><a href="#cb94-2656" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-2657"><a href="#cb94-2657" aria-hidden="true" tabindex="-1"></a><span class="vs">- Sql cells add a row that is the combined value for all admin regions, where all admin names are null.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-94" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb95" data-startfrom="2661" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2660"><span id="cb95-2661"><a href="#cb95-2661" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`Here are the combined data and insights for creating the dynamic narrative. Data tables are below.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-95" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb96" data-startfrom="2665" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2664"><span id="cb96-2665"><a href="#cb96-2665" aria-hidden="true" tabindex="-1"></a><span class="co">// dynamic insights for an Admin Selection</span></span>
<span id="cb96-2666"><a href="#cb96-2666" aria-hidden="true" tabindex="-1"></a>dynamicInsights_geoImpact <span class="op">=</span> {</span>
<span id="cb96-2667"><a href="#cb96-2667" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> admin2_null <span class="op">=</span> <span class="op">!</span>selectAdmin2<span class="op">.</span><span class="at">value</span></span>
<span id="cb96-2668"><a href="#cb96-2668" aria-hidden="true" tabindex="-1"></a>  <span class="co">// define data</span></span>
<span id="cb96-2669"><a href="#cb96-2669" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalVop <span class="op">=</span> admin2_null <span class="op">?</span> dynInsightGeo_vopTotals <span class="op">:</span> <span class="fu">filterByAdminNames</span>(dynInsightGeo_vopTotals)<span class="op">;</span></span>
<span id="cb96-2670"><a href="#cb96-2670" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> totalHa <span class="op">=</span> admin2_null <span class="op">?</span> dynInsightGeo_haTotals<span class="op">:</span> <span class="fu">filterByAdminNames</span>(dynInsightGeo_haTotals)<span class="op">;</span> </span>
<span id="cb96-2671"><a href="#cb96-2671" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> population <span class="op">=</span> admin2_null <span class="op">?</span> dynInsightGeo_population <span class="op">:</span> <span class="fu">filterByAdminNames</span>(dynInsightGeo_population)<span class="op">;</span></span>
<span id="cb96-2672"><a href="#cb96-2672" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topCommodities <span class="op">=</span> admin2_null <span class="op">?</span> dynInsightGeo_rankedNonAnimals<span class="op">:</span> <span class="fu">filterByAdminNames</span>(dynInsightGeo_rankedNonAnimals)<span class="op">;</span></span>
<span id="cb96-2673"><a href="#cb96-2673" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topLivestock <span class="op">=</span> admin2_null <span class="op">?</span> dynInsightGeo_rankedAnimals <span class="op">:</span> <span class="fu">filterByAdminNames</span>(dynInsightGeo_rankedAnimals)<span class="op">;</span></span>
<span id="cb96-2674"><a href="#cb96-2674" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-2675"><a href="#cb96-2675" aria-hidden="true" tabindex="-1"></a>  <span class="co">// format functions</span></span>
<span id="cb96-2676"><a href="#cb96-2676" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> locale <span class="op">=</span> language<span class="op">.</span><span class="at">locale</span><span class="op">;</span></span>
<span id="cb96-2677"><a href="#cb96-2677" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _formatTopNVop <span class="op">=</span> <span class="fu">formatIntDollar</span>({<span class="dt">locale</span><span class="op">:</span> locale})<span class="op">;</span></span>
<span id="cb96-2678"><a href="#cb96-2678" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _formatNumber <span class="op">=</span> <span class="fu">formatNumCompactLong</span>({<span class="dt">locale</span><span class="op">:</span> locale})<span class="op">;</span></span>
<span id="cb96-2679"><a href="#cb96-2679" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-2680"><a href="#cb96-2680" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">getTopValue</span>({ d<span class="op">,</span> i } <span class="op">=</span> {}) {</span>
<span id="cb96-2681"><a href="#cb96-2681" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb96-2682"><a href="#cb96-2682" aria-hidden="true" tabindex="-1"></a>      <span class="dt">data</span><span class="op">:</span> d<span class="op">?.</span>[i]<span class="op">?.</span><span class="at">vop_total</span><span class="op">,</span></span>
<span id="cb96-2683"><a href="#cb96-2683" aria-hidden="true" tabindex="-1"></a>      <span class="dt">value</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb96-2684"><a href="#cb96-2684" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> d<span class="op">?.</span>[i]<span class="op">?.</span><span class="at">vop_total</span><span class="op">,</span></span>
<span id="cb96-2685"><a href="#cb96-2685" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatTopNVop</span>
<span id="cb96-2686"><a href="#cb96-2686" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb96-2687"><a href="#cb96-2687" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb96-2688"><a href="#cb96-2688" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> d<span class="op">?.</span>[i]<span class="op">?.</span><span class="at">crop</span></span>
<span id="cb96-2689"><a href="#cb96-2689" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb96-2690"><a href="#cb96-2690" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb96-2691"><a href="#cb96-2691" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb96-2692"><a href="#cb96-2692" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-2693"><a href="#cb96-2693" aria-hidden="true" tabindex="-1"></a>  <span class="co">// make insights ------------------------------------</span></span>
<span id="cb96-2694"><a href="#cb96-2694" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb96-2695"><a href="#cb96-2695" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> {</span>
<span id="cb96-2696"><a href="#cb96-2696" aria-hidden="true" tabindex="-1"></a>      totalVop<span class="op">,</span></span>
<span id="cb96-2697"><a href="#cb96-2697" aria-hidden="true" tabindex="-1"></a>      totalHa<span class="op">,</span></span>
<span id="cb96-2698"><a href="#cb96-2698" aria-hidden="true" tabindex="-1"></a>      population<span class="op">,</span></span>
<span id="cb96-2699"><a href="#cb96-2699" aria-hidden="true" tabindex="-1"></a>      topCommodities<span class="op">,</span></span>
<span id="cb96-2700"><a href="#cb96-2700" aria-hidden="true" tabindex="-1"></a>      topLivestock</span>
<span id="cb96-2701"><a href="#cb96-2701" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb96-2702"><a href="#cb96-2702" aria-hidden="true" tabindex="-1"></a>    <span class="dt">insight</span><span class="op">:</span> {</span>
<span id="cb96-2703"><a href="#cb96-2703" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalVop</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb96-2704"><a href="#cb96-2704" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> totalVop<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">vop_total</span><span class="op">,</span></span>
<span id="cb96-2705"><a href="#cb96-2705" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatTopNVop</span>
<span id="cb96-2706"><a href="#cb96-2706" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb96-2707"><a href="#cb96-2707" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalHa</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb96-2708"><a href="#cb96-2708" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> totalHa<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">ha_total</span><span class="op">,</span></span>
<span id="cb96-2709"><a href="#cb96-2709" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb96-2710"><a href="#cb96-2710" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb96-2711"><a href="#cb96-2711" aria-hidden="true" tabindex="-1"></a>      <span class="dt">totalPop</span><span class="op">:</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb96-2712"><a href="#cb96-2712" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> population<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">?.</span><span class="at">rural_pop</span><span class="op">,</span></span>
<span id="cb96-2713"><a href="#cb96-2713" aria-hidden="true" tabindex="-1"></a>        <span class="dt">format</span><span class="op">:</span> _formatNumber</span>
<span id="cb96-2714"><a href="#cb96-2714" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb96-2715"><a href="#cb96-2715" aria-hidden="true" tabindex="-1"></a>      <span class="dt">topCommodities</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">.</span><span class="fu">map</span>((x) <span class="kw">=&gt;</span></span>
<span id="cb96-2716"><a href="#cb96-2716" aria-hidden="true" tabindex="-1"></a>        <span class="fu">getTopValue</span>({ <span class="dt">d</span><span class="op">:</span> topCommodities<span class="op">,</span> <span class="dt">i</span><span class="op">:</span> x })</span>
<span id="cb96-2717"><a href="#cb96-2717" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb96-2718"><a href="#cb96-2718" aria-hidden="true" tabindex="-1"></a>      <span class="dt">topLivestock</span><span class="op">:</span> [<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span>]<span class="op">.</span><span class="fu">map</span>((x) <span class="kw">=&gt;</span></span>
<span id="cb96-2719"><a href="#cb96-2719" aria-hidden="true" tabindex="-1"></a>        <span class="fu">getTopValue</span>({ <span class="dt">d</span><span class="op">:</span> topLivestock<span class="op">,</span> <span class="dt">i</span><span class="op">:</span> x })</span>
<span id="cb96-2720"><a href="#cb96-2720" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb96-2721"><a href="#cb96-2721" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb96-2722"><a href="#cb96-2722" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb96-2723"><a href="#cb96-2723" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-96" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb97" data-startfrom="2727" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2726"><span id="cb97-2727"><a href="#cb97-2727" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb97-2728"><a href="#cb97-2728" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Data cells for insights`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-97" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb98" data-startfrom="2732" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2731"><span id="cb98-2732"><a href="#cb98-2732" aria-hidden="true" tabindex="-1"></a>insight_adminQuery <span class="op">=</span> {</span>
<span id="cb98-2733"><a href="#cb98-2733" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> admin_query</span>
<span id="cb98-2734"><a href="#cb98-2734" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>) {</span>
<span id="cb98-2735"><a href="#cb98-2735" aria-hidden="true" tabindex="-1"></a>  admin_query <span class="op">=</span> <span class="vs">`WHERE admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">' AND admin1_name = '</span><span class="sc">${</span><span class="fu">cleanAdminInput_SQL</span>(adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">' AND admin2_name IS NOT NULL`</span></span>
<span id="cb98-2736"><a href="#cb98-2736" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) {</span>
<span id="cb98-2737"><a href="#cb98-2737" aria-hidden="true" tabindex="-1"></a>  admin_query <span class="op">=</span> <span class="vs">`WHERE admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">' AND admin1_name IS NOT NULL AND admin2_name IS NULL`</span></span>
<span id="cb98-2738"><a href="#cb98-2738" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb98-2739"><a href="#cb98-2739" aria-hidden="true" tabindex="-1"></a>  admin_query <span class="op">=</span> <span class="vs">`WHERE admin1_name IS NULL`</span></span>
<span id="cb98-2740"><a href="#cb98-2740" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb98-2741"><a href="#cb98-2741" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> admin_query</span>
<span id="cb98-2742"><a href="#cb98-2742" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-98" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb99" data-startfrom="2746" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2745"><span id="cb99-2746"><a href="#cb99-2746" aria-hidden="true" tabindex="-1"></a><span class="co">// total harvested area</span></span>
<span id="cb99-2747"><a href="#cb99-2747" aria-hidden="true" tabindex="-1"></a>dynInsightGeo_haTotals <span class="op">=</span> {</span>
<span id="cb99-2748"><a href="#cb99-2748" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> admin_query <span class="op">=</span> insight_adminQuery</span>
<span id="cb99-2749"><a href="#cb99-2749" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb99-2750"><a href="#cb99-2750" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb99-2751"><a href="#cb99-2751" aria-hidden="true" tabindex="-1"></a><span class="vs">with tblHA as (</span></span>
<span id="cb99-2752"><a href="#cb99-2752" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total VoP and harvested area</span></span>
<span id="cb99-2753"><a href="#cb99-2753" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT admin0_name, admin1_name, admin2_name, SUM(value) AS ha_total</span></span>
<span id="cb99-2754"><a href="#cb99-2754" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM ha</span></span>
<span id="cb99-2755"><a href="#cb99-2755" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>admin_query<span class="sc">}</span></span>
<span id="cb99-2756"><a href="#cb99-2756" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND exposure = 'ha'</span></span>
<span id="cb99-2757"><a href="#cb99-2757" aria-hidden="true" tabindex="-1"></a><span class="vs">    GROUP BY 1, 2, 3</span></span>
<span id="cb99-2758"><a href="#cb99-2758" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb99-2759"><a href="#cb99-2759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-2760"><a href="#cb99-2760" aria-hidden="true" tabindex="-1"></a><span class="vs">-- QUERY ------------------------------------------</span></span>
<span id="cb99-2761"><a href="#cb99-2761" aria-hidden="true" tabindex="-1"></a><span class="vs">(</span></span>
<span id="cb99-2762"><a href="#cb99-2762" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total for all regions</span></span>
<span id="cb99-2763"><a href="#cb99-2763" aria-hidden="true" tabindex="-1"></a><span class="vs">  select null as admin0_name</span></span>
<span id="cb99-2764"><a href="#cb99-2764" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin1_name</span></span>
<span id="cb99-2765"><a href="#cb99-2765" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin2_name</span></span>
<span id="cb99-2766"><a href="#cb99-2766" aria-hidden="true" tabindex="-1"></a><span class="vs">    , ha_total</span></span>
<span id="cb99-2767"><a href="#cb99-2767" aria-hidden="true" tabindex="-1"></a><span class="vs">    from (</span></span>
<span id="cb99-2768"><a href="#cb99-2768" aria-hidden="true" tabindex="-1"></a><span class="vs">      select sum(ha_total) as ha_total</span></span>
<span id="cb99-2769"><a href="#cb99-2769" aria-hidden="true" tabindex="-1"></a><span class="vs">        from tblHA</span></span>
<span id="cb99-2770"><a href="#cb99-2770" aria-hidden="true" tabindex="-1"></a><span class="vs">    )</span></span>
<span id="cb99-2771"><a href="#cb99-2771" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb99-2772"><a href="#cb99-2772" aria-hidden="true" tabindex="-1"></a><span class="vs">  union</span></span>
<span id="cb99-2773"><a href="#cb99-2773" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb99-2774"><a href="#cb99-2774" aria-hidden="true" tabindex="-1"></a><span class="vs">  select * </span></span>
<span id="cb99-2775"><a href="#cb99-2775" aria-hidden="true" tabindex="-1"></a><span class="vs">    from tblHA</span></span>
<span id="cb99-2776"><a href="#cb99-2776" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb99-2777"><a href="#cb99-2777" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb99-2778"><a href="#cb99-2778" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb99-2779"><a href="#cb99-2779" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span>
<span id="cb99-2780"><a href="#cb99-2780" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-99" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb100" data-startfrom="2784" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2783"><span id="cb100-2784"><a href="#cb100-2784" aria-hidden="true" tabindex="-1"></a>dynInsightGeo_vopTotals <span class="op">=</span> {</span>
<span id="cb100-2785"><a href="#cb100-2785" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> admin_query <span class="op">=</span> insight_adminQuery</span>
<span id="cb100-2786"><a href="#cb100-2786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-2787"><a href="#cb100-2787" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb100-2788"><a href="#cb100-2788" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb100-2789"><a href="#cb100-2789" aria-hidden="true" tabindex="-1"></a><span class="vs">-- total value of production</span></span>
<span id="cb100-2790"><a href="#cb100-2790" aria-hidden="true" tabindex="-1"></a><span class="vs">with tbl as (</span></span>
<span id="cb100-2791"><a href="#cb100-2791" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total VoP and harvested area</span></span>
<span id="cb100-2792"><a href="#cb100-2792" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT admin0_name, admin1_name, admin2_name, SUM(value) AS vop_total</span></span>
<span id="cb100-2793"><a href="#cb100-2793" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM vop</span></span>
<span id="cb100-2794"><a href="#cb100-2794" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>admin_query<span class="sc">}</span></span>
<span id="cb100-2795"><a href="#cb100-2795" aria-hidden="true" tabindex="-1"></a><span class="vs">    GROUP BY 1, 2, 3</span></span>
<span id="cb100-2796"><a href="#cb100-2796" aria-hidden="true" tabindex="-1"></a><span class="vs">    ORDER BY 1, 2, 3</span></span>
<span id="cb100-2797"><a href="#cb100-2797" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb100-2798"><a href="#cb100-2798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-2799"><a href="#cb100-2799" aria-hidden="true" tabindex="-1"></a><span class="vs">-- QUERY ------------------------------------------</span></span>
<span id="cb100-2800"><a href="#cb100-2800" aria-hidden="true" tabindex="-1"></a><span class="vs">(</span></span>
<span id="cb100-2801"><a href="#cb100-2801" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total for all regions</span></span>
<span id="cb100-2802"><a href="#cb100-2802" aria-hidden="true" tabindex="-1"></a><span class="vs">  select null as admin0_name</span></span>
<span id="cb100-2803"><a href="#cb100-2803" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin1_name</span></span>
<span id="cb100-2804"><a href="#cb100-2804" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin2_name</span></span>
<span id="cb100-2805"><a href="#cb100-2805" aria-hidden="true" tabindex="-1"></a><span class="vs">    , vop_total</span></span>
<span id="cb100-2806"><a href="#cb100-2806" aria-hidden="true" tabindex="-1"></a><span class="vs">    from (</span></span>
<span id="cb100-2807"><a href="#cb100-2807" aria-hidden="true" tabindex="-1"></a><span class="vs">      select sum(vop_total) as vop_total</span></span>
<span id="cb100-2808"><a href="#cb100-2808" aria-hidden="true" tabindex="-1"></a><span class="vs">        from tbl</span></span>
<span id="cb100-2809"><a href="#cb100-2809" aria-hidden="true" tabindex="-1"></a><span class="vs">    )</span></span>
<span id="cb100-2810"><a href="#cb100-2810" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb100-2811"><a href="#cb100-2811" aria-hidden="true" tabindex="-1"></a><span class="vs">  union</span></span>
<span id="cb100-2812"><a href="#cb100-2812" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb100-2813"><a href="#cb100-2813" aria-hidden="true" tabindex="-1"></a><span class="vs">  select * </span></span>
<span id="cb100-2814"><a href="#cb100-2814" aria-hidden="true" tabindex="-1"></a><span class="vs">    from tbl</span></span>
<span id="cb100-2815"><a href="#cb100-2815" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb100-2816"><a href="#cb100-2816" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb100-2817"><a href="#cb100-2817" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb100-2818"><a href="#cb100-2818" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span>
<span id="cb100-2819"><a href="#cb100-2819" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-100" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb101" data-startfrom="2823" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2822"><span id="cb101-2823"><a href="#cb101-2823" aria-hidden="true" tabindex="-1"></a>dynInsightGeo_population <span class="op">=</span> {</span>
<span id="cb101-2824"><a href="#cb101-2824" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> admin_query <span class="op">=</span> insight_adminQuery</span>
<span id="cb101-2825"><a href="#cb101-2825" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb101-2826"><a href="#cb101-2826" aria-hidden="true" tabindex="-1"></a><span class="vs">with tbl as (</span></span>
<span id="cb101-2827"><a href="#cb101-2827" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- population data</span></span>
<span id="cb101-2828"><a href="#cb101-2828" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb101-2829"><a href="#cb101-2829" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb101-2830"><a href="#cb101-2830" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb101-2831"><a href="#cb101-2831" aria-hidden="true" tabindex="-1"></a><span class="vs">    , total_pop</span></span>
<span id="cb101-2832"><a href="#cb101-2832" aria-hidden="true" tabindex="-1"></a><span class="vs">    , rural_pop</span></span>
<span id="cb101-2833"><a href="#cb101-2833" aria-hidden="true" tabindex="-1"></a><span class="vs">    from population</span></span>
<span id="cb101-2834"><a href="#cb101-2834" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>admin_query<span class="sc">}</span></span>
<span id="cb101-2835"><a href="#cb101-2835" aria-hidden="true" tabindex="-1"></a><span class="vs">    order by admin0_name</span></span>
<span id="cb101-2836"><a href="#cb101-2836" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb101-2837"><a href="#cb101-2837" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb101-2838"><a href="#cb101-2838" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb101-2839"><a href="#cb101-2839" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-2840"><a href="#cb101-2840" aria-hidden="true" tabindex="-1"></a><span class="vs">-- QUERY ------------------------------------------</span></span>
<span id="cb101-2841"><a href="#cb101-2841" aria-hidden="true" tabindex="-1"></a><span class="vs">(</span></span>
<span id="cb101-2842"><a href="#cb101-2842" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- total for all regions</span></span>
<span id="cb101-2843"><a href="#cb101-2843" aria-hidden="true" tabindex="-1"></a><span class="vs">  select null as admin0_name</span></span>
<span id="cb101-2844"><a href="#cb101-2844" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin1_name</span></span>
<span id="cb101-2845"><a href="#cb101-2845" aria-hidden="true" tabindex="-1"></a><span class="vs">    , null as admin2_name</span></span>
<span id="cb101-2846"><a href="#cb101-2846" aria-hidden="true" tabindex="-1"></a><span class="vs">    , *</span></span>
<span id="cb101-2847"><a href="#cb101-2847" aria-hidden="true" tabindex="-1"></a><span class="vs">    from (</span></span>
<span id="cb101-2848"><a href="#cb101-2848" aria-hidden="true" tabindex="-1"></a><span class="vs">      select sum(total_pop) as total_pop</span></span>
<span id="cb101-2849"><a href="#cb101-2849" aria-hidden="true" tabindex="-1"></a><span class="vs">        , sum(rural_pop) as rural_pop</span></span>
<span id="cb101-2850"><a href="#cb101-2850" aria-hidden="true" tabindex="-1"></a><span class="vs">        from tbl</span></span>
<span id="cb101-2851"><a href="#cb101-2851" aria-hidden="true" tabindex="-1"></a><span class="vs">    )</span></span>
<span id="cb101-2852"><a href="#cb101-2852" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb101-2853"><a href="#cb101-2853" aria-hidden="true" tabindex="-1"></a><span class="vs">  union</span></span>
<span id="cb101-2854"><a href="#cb101-2854" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb101-2855"><a href="#cb101-2855" aria-hidden="true" tabindex="-1"></a><span class="vs">  select *</span></span>
<span id="cb101-2856"><a href="#cb101-2856" aria-hidden="true" tabindex="-1"></a><span class="vs">    from tbl</span></span>
<span id="cb101-2857"><a href="#cb101-2857" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb101-2858"><a href="#cb101-2858" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1, 2, 3</span></span>
<span id="cb101-2859"><a href="#cb101-2859" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb101-2860"><a href="#cb101-2860" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span>
<span id="cb101-2861"><a href="#cb101-2861" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-101" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb102" data-startfrom="2865" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2864"><span id="cb102-2865"><a href="#cb102-2865" aria-hidden="true" tabindex="-1"></a>dynInsightGeo_rankedNonAnimals <span class="op">=</span> {</span>
<span id="cb102-2866"><a href="#cb102-2866" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span> admin_query <span class="op">=</span> insight_adminQuery</span>
<span id="cb102-2867"><a href="#cb102-2867" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-2868"><a href="#cb102-2868" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> data <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb102-2869"><a href="#cb102-2869" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- Combine global totals with regional data</span></span>
<span id="cb102-2870"><a href="#cb102-2870" aria-hidden="true" tabindex="-1"></a><span class="vs">  WITH tbl_vop AS (</span></span>
<span id="cb102-2871"><a href="#cb102-2871" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- Fetch the base data for NON-animals</span></span>
<span id="cb102-2872"><a href="#cb102-2872" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT admin0_name,</span></span>
<span id="cb102-2873"><a href="#cb102-2873" aria-hidden="true" tabindex="-1"></a><span class="vs">           admin1_name,</span></span>
<span id="cb102-2874"><a href="#cb102-2874" aria-hidden="true" tabindex="-1"></a><span class="vs">           admin2_name,</span></span>
<span id="cb102-2875"><a href="#cb102-2875" aria-hidden="true" tabindex="-1"></a><span class="vs">           crop,</span></span>
<span id="cb102-2876"><a href="#cb102-2876" aria-hidden="true" tabindex="-1"></a><span class="vs">           value AS vop_total</span></span>
<span id="cb102-2877"><a href="#cb102-2877" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM vop_crop</span></span>
<span id="cb102-2878"><a href="#cb102-2878" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>admin_query<span class="sc">}</span></span>
<span id="cb102-2879"><a href="#cb102-2879" aria-hidden="true" tabindex="-1"></a><span class="vs">  ),</span></span>
<span id="cb102-2880"><a href="#cb102-2880" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb102-2881"><a href="#cb102-2881" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- Calculate global totals (where admin names are null)</span></span>
<span id="cb102-2882"><a href="#cb102-2882" aria-hidden="true" tabindex="-1"></a><span class="vs">  global_total_crop AS (</span></span>
<span id="cb102-2883"><a href="#cb102-2883" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT NULL AS admin0_name,</span></span>
<span id="cb102-2884"><a href="#cb102-2884" aria-hidden="true" tabindex="-1"></a><span class="vs">           NULL AS admin1_name,</span></span>
<span id="cb102-2885"><a href="#cb102-2885" aria-hidden="true" tabindex="-1"></a><span class="vs">           NULL AS admin2_name,</span></span>
<span id="cb102-2886"><a href="#cb102-2886" aria-hidden="true" tabindex="-1"></a><span class="vs">           crop,</span></span>
<span id="cb102-2887"><a href="#cb102-2887" aria-hidden="true" tabindex="-1"></a><span class="vs">           SUM(vop_total) AS vop_total</span></span>
<span id="cb102-2888"><a href="#cb102-2888" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM tbl_vop</span></span>
<span id="cb102-2889"><a href="#cb102-2889" aria-hidden="true" tabindex="-1"></a><span class="vs">    GROUP BY crop</span></span>
<span id="cb102-2890"><a href="#cb102-2890" aria-hidden="true" tabindex="-1"></a><span class="vs">  )</span></span>
<span id="cb102-2891"><a href="#cb102-2891" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb102-2892"><a href="#cb102-2892" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- Combine global totals with regional data</span></span>
<span id="cb102-2893"><a href="#cb102-2893" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT * FROM global_total_crop</span></span>
<span id="cb102-2894"><a href="#cb102-2894" aria-hidden="true" tabindex="-1"></a><span class="vs">  UNION ALL</span></span>
<span id="cb102-2895"><a href="#cb102-2895" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT * FROM tbl_vop</span></span>
<span id="cb102-2896"><a href="#cb102-2896" aria-hidden="true" tabindex="-1"></a><span class="vs">  ORDER BY admin0_name, admin1_name, admin2_name, vop_total DESC</span></span>
<span id="cb102-2897"><a href="#cb102-2897" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span>
<span id="cb102-2898"><a href="#cb102-2898" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb102-2899"><a href="#cb102-2899" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> groupedData <span class="op">=</span> data<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> item) <span class="kw">=&gt;</span> {</span>
<span id="cb102-2900"><a href="#cb102-2900" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>item<span class="op">.</span><span class="at">admin0_name</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>item<span class="op">.</span><span class="at">admin1_name</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>item<span class="op">.</span><span class="at">admin2_name</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb102-2901"><a href="#cb102-2901" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>acc[key]) acc[key] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb102-2902"><a href="#cb102-2902" aria-hidden="true" tabindex="-1"></a>  acc[key]<span class="op">.</span><span class="fu">push</span>(item)<span class="op">;</span></span>
<span id="cb102-2903"><a href="#cb102-2903" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> acc<span class="op">;</span></span>
<span id="cb102-2904"><a href="#cb102-2904" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> {})<span class="op">;</span></span>
<span id="cb102-2905"><a href="#cb102-2905" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-2906"><a href="#cb102-2906" aria-hidden="true" tabindex="-1"></a><span class="co">// Rank within each group</span></span>
<span id="cb102-2907"><a href="#cb102-2907" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> rankedData <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(groupedData)<span class="op">.</span><span class="fu">flatMap</span>(group <span class="kw">=&gt;</span> {</span>
<span id="cb102-2908"><a href="#cb102-2908" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> group<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">vop_total</span> <span class="op">-</span> a<span class="op">.</span><span class="at">vop_total</span>)<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">.</span><span class="fu">map</span>((item<span class="op">,</span> index) <span class="kw">=&gt;</span> ({</span>
<span id="cb102-2909"><a href="#cb102-2909" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>item<span class="op">,</span></span>
<span id="cb102-2910"><a href="#cb102-2910" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rank</span><span class="op">:</span> index <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb102-2911"><a href="#cb102-2911" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb102-2912"><a href="#cb102-2912" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb102-2913"><a href="#cb102-2913" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> rankedData</span>
<span id="cb102-2914"><a href="#cb102-2914" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-102" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb103" data-startfrom="2918" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2917"><span id="cb103-2918"><a href="#cb103-2918" aria-hidden="true" tabindex="-1"></a>dynInsightGeo_rankedAnimals <span class="op">=</span> {</span>
<span id="cb103-2919"><a href="#cb103-2919" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> admin_query <span class="op">=</span> insight_adminQuery</span>
<span id="cb103-2920"><a href="#cb103-2920" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-2921"><a href="#cb103-2921" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> data <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb103-2922"><a href="#cb103-2922" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- Simplified SQL query to fetch animal data, including global totals</span></span>
<span id="cb103-2923"><a href="#cb103-2923" aria-hidden="true" tabindex="-1"></a><span class="vs">  WITH tbl_base AS (</span></span>
<span id="cb103-2924"><a href="#cb103-2924" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- Base animal data grouped by crop type</span></span>
<span id="cb103-2925"><a href="#cb103-2925" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT admin0_name,</span></span>
<span id="cb103-2926"><a href="#cb103-2926" aria-hidden="true" tabindex="-1"></a><span class="vs">           admin1_name,</span></span>
<span id="cb103-2927"><a href="#cb103-2927" aria-hidden="true" tabindex="-1"></a><span class="vs">           admin2_name,</span></span>
<span id="cb103-2928"><a href="#cb103-2928" aria-hidden="true" tabindex="-1"></a><span class="vs">           CASE </span></span>
<span id="cb103-2929"><a href="#cb103-2929" aria-hidden="true" tabindex="-1"></a><span class="vs">             WHEN crop LIKE 'cattle</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">' THEN 'cattle'</span></span>
<span id="cb103-2930"><a href="#cb103-2930" aria-hidden="true" tabindex="-1"></a><span class="vs">             WHEN crop LIKE 'goats</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">' THEN 'goats'</span></span>
<span id="cb103-2931"><a href="#cb103-2931" aria-hidden="true" tabindex="-1"></a><span class="vs">             WHEN crop LIKE 'pigs</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">' THEN 'pigs'</span></span>
<span id="cb103-2932"><a href="#cb103-2932" aria-hidden="true" tabindex="-1"></a><span class="vs">             WHEN crop LIKE 'poultry</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">' THEN 'poultry'</span></span>
<span id="cb103-2933"><a href="#cb103-2933" aria-hidden="true" tabindex="-1"></a><span class="vs">             WHEN crop LIKE 'sheep</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">' THEN 'sheep'</span></span>
<span id="cb103-2934"><a href="#cb103-2934" aria-hidden="true" tabindex="-1"></a><span class="vs">             ELSE 'other'</span></span>
<span id="cb103-2935"><a href="#cb103-2935" aria-hidden="true" tabindex="-1"></a><span class="vs">           END AS crop,</span></span>
<span id="cb103-2936"><a href="#cb103-2936" aria-hidden="true" tabindex="-1"></a><span class="vs">           SUM(value) AS vop_total</span></span>
<span id="cb103-2937"><a href="#cb103-2937" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM vop_animal</span></span>
<span id="cb103-2938"><a href="#cb103-2938" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span><span class="sc">${</span>admin_query<span class="sc">}</span></span>
<span id="cb103-2939"><a href="#cb103-2939" aria-hidden="true" tabindex="-1"></a><span class="vs">    GROUP BY admin0_name, admin1_name, admin2_name, crop</span></span>
<span id="cb103-2940"><a href="#cb103-2940" aria-hidden="true" tabindex="-1"></a><span class="vs">  ),</span></span>
<span id="cb103-2941"><a href="#cb103-2941" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb103-2942"><a href="#cb103-2942" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- Global totals where admin names are null</span></span>
<span id="cb103-2943"><a href="#cb103-2943" aria-hidden="true" tabindex="-1"></a><span class="vs">  global_total_animal AS (</span></span>
<span id="cb103-2944"><a href="#cb103-2944" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT NULL AS admin0_name,</span></span>
<span id="cb103-2945"><a href="#cb103-2945" aria-hidden="true" tabindex="-1"></a><span class="vs">           NULL AS admin1_name,</span></span>
<span id="cb103-2946"><a href="#cb103-2946" aria-hidden="true" tabindex="-1"></a><span class="vs">           NULL AS admin2_name,</span></span>
<span id="cb103-2947"><a href="#cb103-2947" aria-hidden="true" tabindex="-1"></a><span class="vs">           crop,</span></span>
<span id="cb103-2948"><a href="#cb103-2948" aria-hidden="true" tabindex="-1"></a><span class="vs">           SUM(vop_total) AS vop_total</span></span>
<span id="cb103-2949"><a href="#cb103-2949" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM tbl_base</span></span>
<span id="cb103-2950"><a href="#cb103-2950" aria-hidden="true" tabindex="-1"></a><span class="vs">    GROUP BY crop</span></span>
<span id="cb103-2951"><a href="#cb103-2951" aria-hidden="true" tabindex="-1"></a><span class="vs">  )</span></span>
<span id="cb103-2952"><a href="#cb103-2952" aria-hidden="true" tabindex="-1"></a><span class="vs">  </span></span>
<span id="cb103-2953"><a href="#cb103-2953" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- Combine global totals with the base data</span></span>
<span id="cb103-2954"><a href="#cb103-2954" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT * FROM global_total_animal</span></span>
<span id="cb103-2955"><a href="#cb103-2955" aria-hidden="true" tabindex="-1"></a><span class="vs">  UNION ALL</span></span>
<span id="cb103-2956"><a href="#cb103-2956" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT * FROM tbl_base</span></span>
<span id="cb103-2957"><a href="#cb103-2957" aria-hidden="true" tabindex="-1"></a><span class="vs">  ORDER BY admin0_name, admin1_name, admin2_name, vop_total DESC</span></span>
<span id="cb103-2958"><a href="#cb103-2958" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb103-2959"><a href="#cb103-2959" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> groupedData <span class="op">=</span> data<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> item) <span class="kw">=&gt;</span> {</span>
<span id="cb103-2960"><a href="#cb103-2960" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> key <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>item<span class="op">.</span><span class="at">admin0_name</span> <span class="op">||</span> <span class="st">'TOTAL'</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>item<span class="op">.</span><span class="at">admin1_name</span> <span class="op">||</span> <span class="st">'TOTAL'</span><span class="sc">}</span><span class="vs">-</span><span class="sc">${</span>item<span class="op">.</span><span class="at">admin2_name</span> <span class="op">||</span> <span class="st">'TOTAL'</span><span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb103-2961"><a href="#cb103-2961" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>acc[key]) acc[key] <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb103-2962"><a href="#cb103-2962" aria-hidden="true" tabindex="-1"></a>  acc[key]<span class="op">.</span><span class="fu">push</span>(item)<span class="op">;</span></span>
<span id="cb103-2963"><a href="#cb103-2963" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> acc<span class="op">;</span></span>
<span id="cb103-2964"><a href="#cb103-2964" aria-hidden="true" tabindex="-1"></a>}<span class="op">,</span> {})<span class="op">;</span></span>
<span id="cb103-2965"><a href="#cb103-2965" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-2966"><a href="#cb103-2966" aria-hidden="true" tabindex="-1"></a><span class="co">// Rank within each group</span></span>
<span id="cb103-2967"><a href="#cb103-2967" aria-hidden="true" tabindex="-1"></a><span class="kw">const</span> rankedData <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">entries</span>(groupedData)<span class="op">.</span><span class="fu">flatMap</span>(([key<span class="op">,</span> group]) <span class="kw">=&gt;</span> {</span>
<span id="cb103-2968"><a href="#cb103-2968" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Sort by value within the group</span></span>
<span id="cb103-2969"><a href="#cb103-2969" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> sortedGroup <span class="op">=</span> group<span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">value</span> <span class="op">-</span> a<span class="op">.</span><span class="at">value</span>)<span class="op">;</span></span>
<span id="cb103-2970"><a href="#cb103-2970" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb103-2971"><a href="#cb103-2971" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Take the top 3 crops for each region</span></span>
<span id="cb103-2972"><a href="#cb103-2972" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> top3 <span class="op">=</span> sortedGroup<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">3</span>)<span class="op">.</span><span class="fu">map</span>((item<span class="op">,</span> index) <span class="kw">=&gt;</span> ({</span>
<span id="cb103-2973"><a href="#cb103-2973" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>item<span class="op">,</span></span>
<span id="cb103-2974"><a href="#cb103-2974" aria-hidden="true" tabindex="-1"></a>    <span class="dt">rank</span><span class="op">:</span> index <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb103-2975"><a href="#cb103-2975" aria-hidden="true" tabindex="-1"></a>  }))<span class="op">;</span></span>
<span id="cb103-2976"><a href="#cb103-2976" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-2977"><a href="#cb103-2977" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> top3<span class="op">;</span></span>
<span id="cb103-2978"><a href="#cb103-2978" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span>
<span id="cb103-2979"><a href="#cb103-2979" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> rankedData</span>
<span id="cb103-2980"><a href="#cb103-2980" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-103" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb104" data-startfrom="2984" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2983"><span id="cb104-2984"><a href="#cb104-2984" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb104-2985"><a href="#cb104-2985" aria-hidden="true" tabindex="-1"></a><span class="vs">### Bar Charts - Hazards and Exposures</span></span>
<span id="cb104-2986"><a href="#cb104-2986" aria-hidden="true" tabindex="-1"></a><span class="vs">*getting data based on admin selection and hazard options*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-104" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb105" data-startfrom="2990" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2989"><span id="cb105-2990"><a href="#cb105-2990" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`#### Plot Function</span></span>
<span id="cb105-2991"><a href="#cb105-2991" aria-hidden="true" tabindex="-1"></a><span class="vs">Making the top VoP bar charts`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-105" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb106" data-startfrom="2995" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 2994"><span id="cb106-2995"><a href="#cb106-2995" aria-hidden="true" tabindex="-1"></a><span class="co">// make the bar chart for top crops</span></span>
<span id="cb106-2996"><a href="#cb106-2996" aria-hidden="true" tabindex="-1"></a><span class="co">// approach is passing in data for selected hazard and crop type</span></span>
<span id="cb106-2997"><a href="#cb106-2997" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">makeTopCropBarChart</span>(data<span class="op">,</span> { marginLeft <span class="op">=</span> <span class="dv">100</span> } <span class="op">=</span> {}) {</span>
<span id="cb106-2998"><a href="#cb106-2998" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vopCaption <span class="op">=</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">vopNoteMd</span><span class="op">.</span><span class="at">caption</span>)<span class="op">;</span></span>
<span id="cb106-2999"><a href="#cb106-2999" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> vopLabel <span class="op">=</span> <span class="fu">_lang</span>(</span>
<span id="cb106-3000"><a href="#cb106-3000" aria-hidden="true" tabindex="-1"></a>    nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">plots</span><span class="op">.</span><span class="at">general</span><span class="op">.</span><span class="at">vopLabel</span><span class="op">,</span></span>
<span id="cb106-3001"><a href="#cb106-3001" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb106-3002"><a href="#cb106-3002" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> noDataMessage <span class="op">=</span> <span class="fu">_lang</span>(</span>
<span id="cb106-3003"><a href="#cb106-3003" aria-hidden="true" tabindex="-1"></a>    nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">plots</span><span class="op">.</span><span class="at">general</span><span class="op">.</span><span class="at">noPlotMessage</span><span class="op">,</span></span>
<span id="cb106-3004"><a href="#cb106-3004" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb106-3005"><a href="#cb106-3005" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3006"><a href="#cb106-3006" aria-hidden="true" tabindex="-1"></a>  <span class="co">// if no data is available for selected hazard, show a message</span></span>
<span id="cb106-3007"><a href="#cb106-3007" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (data<span class="op">.</span><span class="at">length</span> <span class="op">==</span> <span class="dv">0</span>) {</span>
<span id="cb106-3008"><a href="#cb106-3008" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">md</span><span class="vs">`*</span><span class="sc">${</span>noDataMessage<span class="sc">}</span><span class="vs">*`</span><span class="op">;</span></span>
<span id="cb106-3009"><a href="#cb106-3009" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb106-3010"><a href="#cb106-3010" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topN <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb106-3011"><a href="#cb106-3011" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-3012"><a href="#cb106-3012" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> Plot<span class="op">.</span><span class="fu">plot</span>({</span>
<span id="cb106-3013"><a href="#cb106-3013" aria-hidden="true" tabindex="-1"></a>    <span class="dt">width</span><span class="op">:</span> <span class="dv">1200</span><span class="op">,</span></span>
<span id="cb106-3014"><a href="#cb106-3014" aria-hidden="true" tabindex="-1"></a>    <span class="dt">height</span><span class="op">:</span> <span class="dv">350</span><span class="op">,</span></span>
<span id="cb106-3015"><a href="#cb106-3015" aria-hidden="true" tabindex="-1"></a>    marginLeft<span class="op">,</span></span>
<span id="cb106-3016"><a href="#cb106-3016" aria-hidden="true" tabindex="-1"></a>    <span class="dt">caption</span><span class="op">:</span> vopCaption<span class="op">,</span></span>
<span id="cb106-3017"><a href="#cb106-3017" aria-hidden="true" tabindex="-1"></a>    <span class="dt">x</span><span class="op">:</span> {</span>
<span id="cb106-3018"><a href="#cb106-3018" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickFormat</span><span class="op">:</span> <span class="fu">formatUSD</span>({ <span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span> })<span class="op">,</span></span>
<span id="cb106-3019"><a href="#cb106-3019" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="vs">`</span><span class="sc">${</span>vopLabel<span class="sc">}</span><span class="vs"> (</span><span class="sc">${</span>intDollarUnit<span class="sc">}</span><span class="vs">)`</span><span class="op">,</span></span>
<span id="cb106-3020"><a href="#cb106-3020" aria-hidden="true" tabindex="-1"></a>      <span class="dt">grid</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span></span>
<span id="cb106-3021"><a href="#cb106-3021" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb106-3022"><a href="#cb106-3022" aria-hidden="true" tabindex="-1"></a>    <span class="dt">y</span><span class="op">:</span> {</span>
<span id="cb106-3023"><a href="#cb106-3023" aria-hidden="true" tabindex="-1"></a>      <span class="dt">label</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></span>
<span id="cb106-3024"><a href="#cb106-3024" aria-hidden="true" tabindex="-1"></a>      <span class="dt">tickSize</span><span class="op">:</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb106-3025"><a href="#cb106-3025" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb106-3026"><a href="#cb106-3026" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb106-3027"><a href="#cb106-3027" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">domain</span><span class="op">,</span></span>
<span id="cb106-3028"><a href="#cb106-3028" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> hazardPlotLookup<span class="op">.</span><span class="at">color</span><span class="op">.</span><span class="at">range</span><span class="op">,</span></span>
<span id="cb106-3029"><a href="#cb106-3029" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb106-3030"><a href="#cb106-3030" aria-hidden="true" tabindex="-1"></a>    <span class="dt">marks</span><span class="op">:</span> [</span>
<span id="cb106-3031"><a href="#cb106-3031" aria-hidden="true" tabindex="-1"></a>      Plot<span class="op">.</span><span class="fu">barX</span>(data<span class="op">,</span> {</span>
<span id="cb106-3032"><a href="#cb106-3032" aria-hidden="true" tabindex="-1"></a>        <span class="dt">x</span><span class="op">:</span> <span class="st">"vop"</span><span class="op">,</span></span>
<span id="cb106-3033"><a href="#cb106-3033" aria-hidden="true" tabindex="-1"></a>        <span class="dt">y</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">crops</span>[d<span class="op">.</span><span class="at">crop</span>]<span class="op">,</span></span>
<span id="cb106-3034"><a href="#cb106-3034" aria-hidden="true" tabindex="-1"></a>        <span class="dt">fill</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> hazardPlotLookup<span class="op">.</span><span class="at">names</span>[d<span class="op">.</span><span class="at">hazard</span>]<span class="op">,</span></span>
<span id="cb106-3035"><a href="#cb106-3035" aria-hidden="true" tabindex="-1"></a>        <span class="dt">sort</span><span class="op">:</span> { <span class="dt">y</span><span class="op">:</span> <span class="st">"x"</span><span class="op">,</span> <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">limit</span><span class="op">:</span> <span class="dv">10</span> }<span class="op">,</span></span>
<span id="cb106-3036"><a href="#cb106-3036" aria-hidden="true" tabindex="-1"></a>        <span class="dt">channels</span><span class="op">:</span> {</span>
<span id="cb106-3037"><a href="#cb106-3037" aria-hidden="true" tabindex="-1"></a>          <span class="dt">vop</span><span class="op">:</span> {</span>
<span id="cb106-3038"><a href="#cb106-3038" aria-hidden="true" tabindex="-1"></a>            <span class="dt">label</span><span class="op">:</span> vopLabel<span class="op">,</span></span>
<span id="cb106-3039"><a href="#cb106-3039" aria-hidden="true" tabindex="-1"></a>            <span class="dt">value</span><span class="op">:</span> <span class="st">"vop"</span><span class="op">,</span></span>
<span id="cb106-3040"><a href="#cb106-3040" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb106-3041"><a href="#cb106-3041" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb106-3042"><a href="#cb106-3042" aria-hidden="true" tabindex="-1"></a>        <span class="dt">tip</span><span class="op">:</span> {</span>
<span id="cb106-3043"><a href="#cb106-3043" aria-hidden="true" tabindex="-1"></a>          <span class="dt">format</span><span class="op">:</span> {</span>
<span id="cb106-3044"><a href="#cb106-3044" aria-hidden="true" tabindex="-1"></a>            <span class="dt">x</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb106-3045"><a href="#cb106-3045" aria-hidden="true" tabindex="-1"></a>            <span class="dt">y</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb106-3046"><a href="#cb106-3046" aria-hidden="true" tabindex="-1"></a>            <span class="dt">fill</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb106-3047"><a href="#cb106-3047" aria-hidden="true" tabindex="-1"></a>            <span class="dt">vop</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> <span class="fu">formatIntDollar</span>({ <span class="dt">locale</span><span class="op">:</span> language<span class="op">.</span><span class="at">locale</span> })(d)<span class="op">,</span></span>
<span id="cb106-3048"><a href="#cb106-3048" aria-hidden="true" tabindex="-1"></a>          }<span class="op">,</span></span>
<span id="cb106-3049"><a href="#cb106-3049" aria-hidden="true" tabindex="-1"></a>        }<span class="op">,</span></span>
<span id="cb106-3050"><a href="#cb106-3050" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb106-3051"><a href="#cb106-3051" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb106-3052"><a href="#cb106-3052" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb106-3053"><a href="#cb106-3053" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-106" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb107" data-startfrom="3057" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3056"><span id="cb107-3057"><a href="#cb107-3057" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`#### Hazard Data`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-107" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb108" data-startfrom="3061" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3060"><span id="cb108-3061"><a href="#cb108-3061" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`The hazard data includes a 'generic' crop, which is a large value that dwarfs other crop values. We exclude this from the chart.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-108" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb109" data-startfrom="3065" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3064"><span id="cb109-3065"><a href="#cb109-3065" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`Below is a table of the explanations of every hazard component. The 'any' hazard is the combination of all of the below hazards.</span></span>
<span id="cb109-3066"><a href="#cb109-3066" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3067"><a href="#cb109-3067" aria-hidden="true" tabindex="-1"></a><span class="vs">| hazard | description |</span></span>
<span id="cb109-3068"><a href="#cb109-3068" aria-hidden="true" tabindex="-1"></a><span class="vs">| --- | --- |</span></span>
<span id="cb109-3069"><a href="#cb109-3069" aria-hidden="true" tabindex="-1"></a><span class="vs">| dry | risk of dry hazard occurring alone |</span></span>
<span id="cb109-3070"><a href="#cb109-3070" aria-hidden="true" tabindex="-1"></a><span class="vs">| heat | risk of heat hazard occurring alone |</span></span>
<span id="cb109-3071"><a href="#cb109-3071" aria-hidden="true" tabindex="-1"></a><span class="vs">| wet | risk of wet hazard occurring alone |</span></span>
<span id="cb109-3072"><a href="#cb109-3072" aria-hidden="true" tabindex="-1"></a><span class="vs">| dry+heat | risk of dry and heat hazard occurring together |</span></span>
<span id="cb109-3073"><a href="#cb109-3073" aria-hidden="true" tabindex="-1"></a><span class="vs">| dry+wet | risk of dry and wet hazard occurring together |</span></span>
<span id="cb109-3074"><a href="#cb109-3074" aria-hidden="true" tabindex="-1"></a><span class="vs">| heat+wet | risk of heat and wet hazard occurring together |</span></span>
<span id="cb109-3075"><a href="#cb109-3075" aria-hidden="true" tabindex="-1"></a><span class="vs">| dry+heat+wet | risk of dry and heat and wet hazard occurring together |</span></span>
<span id="cb109-3076"><a href="#cb109-3076" aria-hidden="true" tabindex="-1"></a><span class="vs">| No hazard | no hazard applied</span></span>
<span id="cb109-3077"><a href="#cb109-3077" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-3078"><a href="#cb109-3078" aria-hidden="true" tabindex="-1"></a><span class="vs">*If there are zeros for individual hazards then it means it always occurs in combination with another hazard and does not occur alone.*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-109" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb110" data-startfrom="3082" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3081"><span id="cb110-3082"><a href="#cb110-3082" aria-hidden="true" tabindex="-1"></a><span class="co">// data for selected hazard scenario, with total vop</span></span>
<span id="cb110-3083"><a href="#cb110-3083" aria-hidden="true" tabindex="-1"></a>data_hazardVoP <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb110-3084"><a href="#cb110-3084" aria-hidden="true" tabindex="-1"></a>  dataHazardSelected<span class="op">,</span></span>
<span id="cb110-3085"><a href="#cb110-3085" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">leftJoin</span>(dataHazardVoPTotalSelected<span class="op">,</span> {</span>
<span id="cb110-3086"><a href="#cb110-3086" aria-hidden="true" tabindex="-1"></a>    <span class="dt">by</span><span class="op">:</span> [<span class="st">"admin0_name"</span><span class="op">,</span> <span class="st">"admin1_name"</span><span class="op">,</span> <span class="st">"admin2_name"</span><span class="op">,</span> <span class="st">"crop"</span>]<span class="op">,</span></span>
<span id="cb110-3087"><a href="#cb110-3087" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb110-3088"><a href="#cb110-3088" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">crop</span> <span class="op">!==</span> <span class="st">"generic"</span>)<span class="op">,</span> <span class="co">// remove generic</span></span>
<span id="cb110-3089"><a href="#cb110-3089" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-110" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb111" data-startfrom="3093" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3092"><span id="cb111-3093"><a href="#cb111-3093" aria-hidden="true" tabindex="-1"></a>dataHazardVoPTotalSelected <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb111-3094"><a href="#cb111-3094" aria-hidden="true" tabindex="-1"></a>  dataHazardSelected<span class="op">,</span></span>
<span id="cb111-3095"><a href="#cb111-3095" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">!==</span> <span class="st">"any"</span>)<span class="op">,</span></span>
<span id="cb111-3096"><a href="#cb111-3096" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb111-3097"><a href="#cb111-3097" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb111-3098"><a href="#cb111-3098" aria-hidden="true" tabindex="-1"></a>      <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb111-3099"><a href="#cb111-3099" aria-hidden="true" tabindex="-1"></a>      <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb111-3100"><a href="#cb111-3100" aria-hidden="true" tabindex="-1"></a>      <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb111-3101"><a href="#cb111-3101" aria-hidden="true" tabindex="-1"></a>      <span class="st">"severity"</span><span class="op">,</span></span>
<span id="cb111-3102"><a href="#cb111-3102" aria-hidden="true" tabindex="-1"></a>      <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb111-3103"><a href="#cb111-3103" aria-hidden="true" tabindex="-1"></a>      <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb111-3104"><a href="#cb111-3104" aria-hidden="true" tabindex="-1"></a>      <span class="st">"crop"</span><span class="op">,</span></span>
<span id="cb111-3105"><a href="#cb111-3105" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb111-3106"><a href="#cb111-3106" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb111-3107"><a href="#cb111-3107" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb111-3108"><a href="#cb111-3108" aria-hidden="true" tabindex="-1"></a>        <span class="dt">vop_total</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"vop"</span>)<span class="op">,</span></span>
<span id="cb111-3109"><a href="#cb111-3109" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb111-3110"><a href="#cb111-3110" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb111-3111"><a href="#cb111-3111" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb111-3112"><a href="#cb111-3112" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-111" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb112" data-startfrom="3116" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3115"><span id="cb112-3116"><a href="#cb112-3116" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`#### Lookups`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-112" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb113" data-startfrom="3120" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3119"><span id="cb113-3120"><a href="#cb113-3120" aria-hidden="true" tabindex="-1"></a><span class="co">// unique crops in the hazard data</span></span>
<span id="cb113-3121"><a href="#cb113-3121" aria-hidden="true" tabindex="-1"></a>hazardCrops <span class="op">=</span> {</span>
<span id="cb113-3122"><a href="#cb113-3122" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> query <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`select crop</span></span>
<span id="cb113-3123"><a href="#cb113-3123" aria-hidden="true" tabindex="-1"></a><span class="vs">  , count(*) as count</span></span>
<span id="cb113-3124"><a href="#cb113-3124" aria-hidden="true" tabindex="-1"></a><span class="vs">  from haz_risk_vop_int</span></span>
<span id="cb113-3125"><a href="#cb113-3125" aria-hidden="true" tabindex="-1"></a><span class="vs">  group by 1</span></span>
<span id="cb113-3126"><a href="#cb113-3126" aria-hidden="true" tabindex="-1"></a><span class="vs">  order by 1`</span>)<span class="op">;</span></span>
<span id="cb113-3127"><a href="#cb113-3127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3128"><a href="#cb113-3128" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> query</span>
<span id="cb113-3129"><a href="#cb113-3129" aria-hidden="true" tabindex="-1"></a> }</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-113" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb114" data-startfrom="3133" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3132"><span id="cb114-3133"><a href="#cb114-3133" aria-hidden="true" tabindex="-1"></a><span class="co">// formatting crop names</span></span>
<span id="cb114-3134"><a href="#cb114-3134" aria-hidden="true" tabindex="-1"></a>cropNames <span class="op">=</span> {</span>
<span id="cb114-3135"><a href="#cb114-3135" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> raw <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb114-3136"><a href="#cb114-3136" aria-hidden="true" tabindex="-1"></a>    hazardCrops<span class="op">,</span></span>
<span id="cb114-3137"><a href="#cb114-3137" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">distinct</span>(<span class="st">"crop"</span>)<span class="op">,</span></span>
<span id="cb114-3138"><a href="#cb114-3138" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">select</span>(<span class="st">"crop"</span>)<span class="op">,</span></span>
<span id="cb114-3139"><a href="#cb114-3139" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb114-3140"><a href="#cb114-3140" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (<span class="ss">/_/</span><span class="op">.</span><span class="fu">test</span>(d<span class="op">.</span><span class="at">crop</span>) <span class="op">?</span> <span class="st">"livestock"</span> <span class="op">:</span> <span class="st">"crop"</span>)</span>
<span id="cb114-3141"><a href="#cb114-3141" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb114-3142"><a href="#cb114-3142" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">arrange</span>([<span class="st">"type"</span><span class="op">,</span> <span class="st">"cropName"</span>])</span>
<span id="cb114-3143"><a href="#cb114-3143" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb114-3144"><a href="#cb114-3144" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> data <span class="op">=</span> raw<span class="op">;</span></span>
<span id="cb114-3145"><a href="#cb114-3145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3146"><a href="#cb114-3146" aria-hidden="true" tabindex="-1"></a>  <span class="co">// translation</span></span>
<span id="cb114-3147"><a href="#cb114-3147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3148"><a href="#cb114-3148" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> translateCrop <span class="op">=</span> (crop) <span class="kw">=&gt;</span> td<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">values</span><span class="op">?.</span>[crop]<span class="op">;</span></span>
<span id="cb114-3149"><a href="#cb114-3149" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> data<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb114-3150"><a href="#cb114-3150" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> arr <span class="op">=</span> Lang<span class="op">.</span><span class="fu">toSentenceCase</span>(<span class="fu">_lang</span>(<span class="fu">translateCrop</span>(d<span class="op">.</span><span class="at">crop</span>)))<span class="op">.</span><span class="fu">split</span>(<span class="st">"_"</span>)<span class="op">;</span></span>
<span id="cb114-3151"><a href="#cb114-3151" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> mainHalf <span class="op">=</span> arr<span class="op">.</span><span class="fu">slice</span>(<span class="dv">0</span><span class="op">,</span> <span class="dv">1</span>)<span class="op">;</span></span>
<span id="cb114-3152"><a href="#cb114-3152" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> backHalf <span class="op">=</span> arr</span>
<span id="cb114-3153"><a href="#cb114-3153" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb114-3154"><a href="#cb114-3154" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d <span class="op">!==</span> <span class="st">"de"</span>)</span>
<span id="cb114-3155"><a href="#cb114-3155" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb114-3156"><a href="#cb114-3156" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> paren <span class="op">=</span> backHalf<span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="vs">`(</span><span class="sc">${</span>backHalf<span class="sc">}</span><span class="vs">)`</span> <span class="op">:</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb114-3157"><a href="#cb114-3157" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> formatted <span class="op">=</span> [<span class="op">...</span>mainHalf<span class="op">,</span> paren]<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">.</span><span class="fu">trimEnd</span>()<span class="op">;</span></span>
<span id="cb114-3158"><a href="#cb114-3158" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb114-3159"><a href="#cb114-3159" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb114-3160"><a href="#cb114-3160" aria-hidden="true" tabindex="-1"></a>      <span class="dt">cropName</span><span class="op">:</span> formatted</span>
<span id="cb114-3161"><a href="#cb114-3161" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb114-3162"><a href="#cb114-3162" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb114-3163"><a href="#cb114-3163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3164"><a href="#cb114-3164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> data<span class="op">;</span></span>
<span id="cb114-3165"><a href="#cb114-3165" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-114" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb115" data-startfrom="3169" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3168"><span id="cb115-3169"><a href="#cb115-3169" aria-hidden="true" tabindex="-1"></a><span class="co">// lookups for hazard plot</span></span>
<span id="cb115-3170"><a href="#cb115-3170" aria-hidden="true" tabindex="-1"></a>hazardPlotLookup <span class="op">=</span> {</span>
<span id="cb115-3171"><a href="#cb115-3171" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hazards <span class="op">=</span> {</span>
<span id="cb115-3172"><a href="#cb115-3172" aria-hidden="true" tabindex="-1"></a>    <span class="dt">wet</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">hazards</span><span class="op">.</span><span class="at">wet</span>)<span class="op">,</span></span>
<span id="cb115-3173"><a href="#cb115-3173" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dry</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">hazards</span><span class="op">.</span><span class="at">dry</span>)<span class="op">,</span></span>
<span id="cb115-3174"><a href="#cb115-3174" aria-hidden="true" tabindex="-1"></a>    <span class="dt">heat</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">hazards</span><span class="op">.</span><span class="at">heat</span>)<span class="op">,</span></span>
<span id="cb115-3175"><a href="#cb115-3175" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dry_heat</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">hazards</span><span class="op">.</span><span class="at">dry_heat</span>)<span class="op">,</span></span>
<span id="cb115-3176"><a href="#cb115-3176" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dry_wet</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">hazards</span><span class="op">.</span><span class="at">dry_wet</span>)<span class="op">,</span></span>
<span id="cb115-3177"><a href="#cb115-3177" aria-hidden="true" tabindex="-1"></a>    <span class="dt">heat_wet</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">hazards</span><span class="op">.</span><span class="at">heat_wet</span>)<span class="op">,</span></span>
<span id="cb115-3178"><a href="#cb115-3178" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dry_heat_wet</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">hazards</span><span class="op">.</span><span class="at">dry_heat_wet</span>)<span class="op">,</span></span>
<span id="cb115-3179"><a href="#cb115-3179" aria-hidden="true" tabindex="-1"></a>    <span class="dt">no_hazard</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">climateRisks</span><span class="op">.</span><span class="at">hazardImpact</span><span class="op">.</span><span class="at">hazards</span><span class="op">.</span><span class="at">no_hazard</span>)</span>
<span id="cb115-3180"><a href="#cb115-3180" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb115-3181"><a href="#cb115-3181" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb115-3182"><a href="#cb115-3182" aria-hidden="true" tabindex="-1"></a>    <span class="dt">names</span><span class="op">:</span> {</span>
<span id="cb115-3183"><a href="#cb115-3183" aria-hidden="true" tabindex="-1"></a>      <span class="dt">wet</span><span class="op">:</span> hazards<span class="op">.</span><span class="at">wet</span><span class="op">,</span></span>
<span id="cb115-3184"><a href="#cb115-3184" aria-hidden="true" tabindex="-1"></a>      <span class="dt">dry</span><span class="op">:</span> hazards<span class="op">.</span><span class="at">dry</span><span class="op">,</span></span>
<span id="cb115-3185"><a href="#cb115-3185" aria-hidden="true" tabindex="-1"></a>      <span class="dt">heat</span><span class="op">:</span> hazards<span class="op">.</span><span class="at">heat</span><span class="op">,</span></span>
<span id="cb115-3186"><a href="#cb115-3186" aria-hidden="true" tabindex="-1"></a>      <span class="st">"dry+heat"</span><span class="op">:</span> hazards<span class="op">.</span><span class="at">dry_heat</span><span class="op">,</span></span>
<span id="cb115-3187"><a href="#cb115-3187" aria-hidden="true" tabindex="-1"></a>      <span class="st">"dry+wet"</span><span class="op">:</span> hazards<span class="op">.</span><span class="at">dry_wet</span><span class="op">,</span></span>
<span id="cb115-3188"><a href="#cb115-3188" aria-hidden="true" tabindex="-1"></a>      <span class="st">"heat+wet"</span><span class="op">:</span> hazards<span class="op">.</span><span class="at">heat_wet</span><span class="op">,</span></span>
<span id="cb115-3189"><a href="#cb115-3189" aria-hidden="true" tabindex="-1"></a>      <span class="st">"dry+heat+wet"</span><span class="op">:</span> hazards<span class="op">.</span><span class="at">dry_heat_wet</span><span class="op">,</span></span>
<span id="cb115-3190"><a href="#cb115-3190" aria-hidden="true" tabindex="-1"></a>      <span class="st">"no hazard"</span><span class="op">:</span> hazards<span class="op">.</span><span class="at">no_hazard</span></span>
<span id="cb115-3191"><a href="#cb115-3191" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb115-3192"><a href="#cb115-3192" aria-hidden="true" tabindex="-1"></a>    <span class="dt">color</span><span class="op">:</span> {</span>
<span id="cb115-3193"><a href="#cb115-3193" aria-hidden="true" tabindex="-1"></a>      <span class="dt">domain</span><span class="op">:</span> [</span>
<span id="cb115-3194"><a href="#cb115-3194" aria-hidden="true" tabindex="-1"></a>      hazards<span class="op">.</span><span class="at">wet</span><span class="op">,</span></span>
<span id="cb115-3195"><a href="#cb115-3195" aria-hidden="true" tabindex="-1"></a>      hazards<span class="op">.</span><span class="at">dry</span><span class="op">,</span></span>
<span id="cb115-3196"><a href="#cb115-3196" aria-hidden="true" tabindex="-1"></a>      hazards<span class="op">.</span><span class="at">heat</span><span class="op">,</span></span>
<span id="cb115-3197"><a href="#cb115-3197" aria-hidden="true" tabindex="-1"></a>      hazards<span class="op">.</span><span class="at">dry_heat</span><span class="op">,</span></span>
<span id="cb115-3198"><a href="#cb115-3198" aria-hidden="true" tabindex="-1"></a>      hazards<span class="op">.</span><span class="at">dry_wet</span><span class="op">,</span></span>
<span id="cb115-3199"><a href="#cb115-3199" aria-hidden="true" tabindex="-1"></a>      hazards<span class="op">.</span><span class="at">heat_wet</span><span class="op">,</span></span>
<span id="cb115-3200"><a href="#cb115-3200" aria-hidden="true" tabindex="-1"></a>      hazards<span class="op">.</span><span class="at">dry_heat_wet</span><span class="op">,</span></span>
<span id="cb115-3201"><a href="#cb115-3201" aria-hidden="true" tabindex="-1"></a>      hazards<span class="op">.</span><span class="at">no_hazard</span></span>
<span id="cb115-3202"><a href="#cb115-3202" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb115-3203"><a href="#cb115-3203" aria-hidden="true" tabindex="-1"></a>      <span class="dt">range</span><span class="op">:</span> [</span>
<span id="cb115-3204"><a href="#cb115-3204" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#4FB5B7"</span><span class="op">,</span></span>
<span id="cb115-3205"><a href="#cb115-3205" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#FCC42C"</span><span class="op">,</span></span>
<span id="cb115-3206"><a href="#cb115-3206" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#FC8A34"</span><span class="op">,</span></span>
<span id="cb115-3207"><a href="#cb115-3207" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#EE624F"</span><span class="op">,</span></span>
<span id="cb115-3208"><a href="#cb115-3208" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#B34E65"</span><span class="op">,</span></span>
<span id="cb115-3209"><a href="#cb115-3209" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#8C3E5F"</span><span class="op">,</span></span>
<span id="cb115-3210"><a href="#cb115-3210" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#523D4E"</span><span class="op">,</span></span>
<span id="cb115-3211"><a href="#cb115-3211" aria-hidden="true" tabindex="-1"></a>        <span class="st">"#EFEFEF"</span></span>
<span id="cb115-3212"><a href="#cb115-3212" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb115-3213"><a href="#cb115-3213" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb115-3214"><a href="#cb115-3214" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crops</span><span class="op">:</span> cropNames<span class="op">.</span><span class="fu">reduce</span>((acc<span class="op">,</span> obj) <span class="kw">=&gt;</span> {</span>
<span id="cb115-3215"><a href="#cb115-3215" aria-hidden="true" tabindex="-1"></a>      acc[obj<span class="op">.</span><span class="at">crop</span>] <span class="op">=</span> obj<span class="op">.</span><span class="at">cropName</span><span class="op">;</span></span>
<span id="cb115-3216"><a href="#cb115-3216" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> acc<span class="op">;</span></span>
<span id="cb115-3217"><a href="#cb115-3217" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span> {})</span>
<span id="cb115-3218"><a href="#cb115-3218" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb115-3219"><a href="#cb115-3219" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-115" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb116" data-startfrom="3223" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3222"><span id="cb116-3223"><a href="#cb116-3223" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`#### Selecting VoP data by scenario</span></span>
<span id="cb116-3224"><a href="#cb116-3224" aria-hidden="true" tabindex="-1"></a><span class="vs">- The data is queried as separate components for each admin region to reduce query size and allow for dynamic null handling. A table is chosen based on the selected admin region.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-116" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb117" data-startfrom="3228" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3227"><span id="cb117-3228"><a href="#cb117-3228" aria-hidden="true" tabindex="-1"></a><span class="co">// pick the admin dataset based on admin selection</span></span>
<span id="cb117-3229"><a href="#cb117-3229" aria-hidden="true" tabindex="-1"></a>dataHazardSelected <span class="op">=</span> {</span>
<span id="cb117-3230"><a href="#cb117-3230" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> dataHazardAdmin2</span>
<span id="cb117-3231"><a href="#cb117-3231" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> dataHazardAdmin1</span>
<span id="cb117-3232"><a href="#cb117-3232" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">if</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> dataHazardAdmin0</span>
<span id="cb117-3233"><a href="#cb117-3233" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> dataHazardAdminAll</span>
<span id="cb117-3234"><a href="#cb117-3234" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-117" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb118" data-startfrom="3238" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3237"><span id="cb118-3238"><a href="#cb118-3238" aria-hidden="true" tabindex="-1"></a>dataHazardAdminAll <span class="op">=</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb118-3239"><a href="#cb118-3239" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- Admin0 total for Sub-Saharan Africa (SSA) regions</span></span>
<span id="cb118-3240"><a href="#cb118-3240" aria-hidden="true" tabindex="-1"></a><span class="vs">  WITH HazardRiskBase AS (</span></span>
<span id="cb118-3241"><a href="#cb118-3241" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- Filter by chosen scenario and timeframe, focusing on severe hazards</span></span>
<span id="cb118-3242"><a href="#cb118-3242" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT admin0_name,</span></span>
<span id="cb118-3243"><a href="#cb118-3243" aria-hidden="true" tabindex="-1"></a><span class="vs">           admin1_name,</span></span>
<span id="cb118-3244"><a href="#cb118-3244" aria-hidden="true" tabindex="-1"></a><span class="vs">           admin2_name,</span></span>
<span id="cb118-3245"><a href="#cb118-3245" aria-hidden="true" tabindex="-1"></a><span class="vs">           scenario,</span></span>
<span id="cb118-3246"><a href="#cb118-3246" aria-hidden="true" tabindex="-1"></a><span class="vs">           timeframe,</span></span>
<span id="cb118-3247"><a href="#cb118-3247" aria-hidden="true" tabindex="-1"></a><span class="vs">           crop,</span></span>
<span id="cb118-3248"><a href="#cb118-3248" aria-hidden="true" tabindex="-1"></a><span class="vs">           severity,</span></span>
<span id="cb118-3249"><a href="#cb118-3249" aria-hidden="true" tabindex="-1"></a><span class="vs">           hazard,</span></span>
<span id="cb118-3250"><a href="#cb118-3250" aria-hidden="true" tabindex="-1"></a><span class="vs">           value AS vop</span></span>
<span id="cb118-3251"><a href="#cb118-3251" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM haz_risk_vop_int</span></span>
<span id="cb118-3252"><a href="#cb118-3252" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE severity = 'severe'</span></span>
<span id="cb118-3253"><a href="#cb118-3253" aria-hidden="true" tabindex="-1"></a><span class="vs">    and timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb118-3254"><a href="#cb118-3254" aria-hidden="true" tabindex="-1"></a><span class="vs">    and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb118-3255"><a href="#cb118-3255" aria-hidden="true" tabindex="-1"></a><span class="vs">  ),</span></span>
<span id="cb118-3256"><a href="#cb118-3256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3257"><a href="#cb118-3257" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- Data for SSA regions only, where admin1_name is NULL (Admin0 level)</span></span>
<span id="cb118-3258"><a href="#cb118-3258" aria-hidden="true" tabindex="-1"></a><span class="vs">  Admin0SSAData AS (</span></span>
<span id="cb118-3259"><a href="#cb118-3259" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT *</span></span>
<span id="cb118-3260"><a href="#cb118-3260" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM HazardRiskBase</span></span>
<span id="cb118-3261"><a href="#cb118-3261" aria-hidden="true" tabindex="-1"></a><span class="vs">    WHERE admin1_name IS NULL</span></span>
<span id="cb118-3262"><a href="#cb118-3262" aria-hidden="true" tabindex="-1"></a><span class="vs">  ),</span></span>
<span id="cb118-3263"><a href="#cb118-3263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3264"><a href="#cb118-3264" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- Aggregate VoP for each crop by hazard type across Admin0 regions</span></span>
<span id="cb118-3265"><a href="#cb118-3265" aria-hidden="true" tabindex="-1"></a><span class="vs">  AggregatedCropData AS (</span></span>
<span id="cb118-3266"><a href="#cb118-3266" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT severity,</span></span>
<span id="cb118-3267"><a href="#cb118-3267" aria-hidden="true" tabindex="-1"></a><span class="vs">           scenario,</span></span>
<span id="cb118-3268"><a href="#cb118-3268" aria-hidden="true" tabindex="-1"></a><span class="vs">           timeframe,</span></span>
<span id="cb118-3269"><a href="#cb118-3269" aria-hidden="true" tabindex="-1"></a><span class="vs">           hazard,</span></span>
<span id="cb118-3270"><a href="#cb118-3270" aria-hidden="true" tabindex="-1"></a><span class="vs">           crop,</span></span>
<span id="cb118-3271"><a href="#cb118-3271" aria-hidden="true" tabindex="-1"></a><span class="vs">           SUM(vop) AS vop</span></span>
<span id="cb118-3272"><a href="#cb118-3272" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM Admin0SSAData</span></span>
<span id="cb118-3273"><a href="#cb118-3273" aria-hidden="true" tabindex="-1"></a><span class="vs">    GROUP BY severity, scenario, timeframe, hazard, crop</span></span>
<span id="cb118-3274"><a href="#cb118-3274" aria-hidden="true" tabindex="-1"></a><span class="vs">  )</span></span>
<span id="cb118-3275"><a href="#cb118-3275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb118-3276"><a href="#cb118-3276" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- Output: Admin0 level crop data with null admin names for SSA</span></span>
<span id="cb118-3277"><a href="#cb118-3277" aria-hidden="true" tabindex="-1"></a><span class="vs">  SELECT NULL AS admin0_name, </span></span>
<span id="cb118-3278"><a href="#cb118-3278" aria-hidden="true" tabindex="-1"></a><span class="vs">         NULL AS admin1_name, </span></span>
<span id="cb118-3279"><a href="#cb118-3279" aria-hidden="true" tabindex="-1"></a><span class="vs">         NULL AS admin2_name,</span></span>
<span id="cb118-3280"><a href="#cb118-3280" aria-hidden="true" tabindex="-1"></a><span class="vs">         severity, </span></span>
<span id="cb118-3281"><a href="#cb118-3281" aria-hidden="true" tabindex="-1"></a><span class="vs">         scenario, </span></span>
<span id="cb118-3282"><a href="#cb118-3282" aria-hidden="true" tabindex="-1"></a><span class="vs">         timeframe, </span></span>
<span id="cb118-3283"><a href="#cb118-3283" aria-hidden="true" tabindex="-1"></a><span class="vs">         hazard, </span></span>
<span id="cb118-3284"><a href="#cb118-3284" aria-hidden="true" tabindex="-1"></a><span class="vs">         crop, </span></span>
<span id="cb118-3285"><a href="#cb118-3285" aria-hidden="true" tabindex="-1"></a><span class="vs">         vop</span></span>
<span id="cb118-3286"><a href="#cb118-3286" aria-hidden="true" tabindex="-1"></a><span class="vs">  FROM AggregatedCropData</span></span>
<span id="cb118-3287"><a href="#cb118-3287" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-118" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb119" data-startfrom="3291" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3290"><span id="cb119-3291"><a href="#cb119-3291" aria-hidden="true" tabindex="-1"></a>dataHazardAdmin0 <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb119-3292"><a href="#cb119-3292" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb119-3293"><a href="#cb119-3293" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb119-3294"><a href="#cb119-3294" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb119-3295"><a href="#cb119-3295" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb119-3296"><a href="#cb119-3296" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb119-3297"><a href="#cb119-3297" aria-hidden="true" tabindex="-1"></a><span class="vs">    , crop</span></span>
<span id="cb119-3298"><a href="#cb119-3298" aria-hidden="true" tabindex="-1"></a><span class="vs">    , severity</span></span>
<span id="cb119-3299"><a href="#cb119-3299" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb119-3300"><a href="#cb119-3300" aria-hidden="true" tabindex="-1"></a><span class="vs">    , value as vop</span></span>
<span id="cb119-3301"><a href="#cb119-3301" aria-hidden="true" tabindex="-1"></a><span class="vs">    from haz_risk_vop_int</span></span>
<span id="cb119-3302"><a href="#cb119-3302" aria-hidden="true" tabindex="-1"></a><span class="vs">    where severity = 'severe' -- hard-coded</span></span>
<span id="cb119-3303"><a href="#cb119-3303" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- and hazard in ('heat', 'wet', 'dry') -- single hazards alone</span></span>
<span id="cb119-3304"><a href="#cb119-3304" aria-hidden="true" tabindex="-1"></a><span class="vs">    and timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb119-3305"><a href="#cb119-3305" aria-hidden="true" tabindex="-1"></a><span class="vs">    and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb119-3306"><a href="#cb119-3306" aria-hidden="true" tabindex="-1"></a><span class="vs">    and admin1_name is null</span></span>
<span id="cb119-3307"><a href="#cb119-3307" aria-hidden="true" tabindex="-1"></a><span class="vs">  and admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-119" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb120" data-startfrom="3311" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3310"><span id="cb120-3311"><a href="#cb120-3311" aria-hidden="true" tabindex="-1"></a>dataHazardAdmin1 <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`-- admin1 level hazard data</span></span>
<span id="cb120-3312"><a href="#cb120-3312" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- chosen scenario and timeframe VoP</span></span>
<span id="cb120-3313"><a href="#cb120-3313" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb120-3314"><a href="#cb120-3314" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb120-3315"><a href="#cb120-3315" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb120-3316"><a href="#cb120-3316" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb120-3317"><a href="#cb120-3317" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb120-3318"><a href="#cb120-3318" aria-hidden="true" tabindex="-1"></a><span class="vs">    , crop</span></span>
<span id="cb120-3319"><a href="#cb120-3319" aria-hidden="true" tabindex="-1"></a><span class="vs">    , severity</span></span>
<span id="cb120-3320"><a href="#cb120-3320" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb120-3321"><a href="#cb120-3321" aria-hidden="true" tabindex="-1"></a><span class="vs">    , value as vop</span></span>
<span id="cb120-3322"><a href="#cb120-3322" aria-hidden="true" tabindex="-1"></a><span class="vs">    from haz_risk_vop_int</span></span>
<span id="cb120-3323"><a href="#cb120-3323" aria-hidden="true" tabindex="-1"></a><span class="vs">    where severity = 'severe' -- hard-coded</span></span>
<span id="cb120-3324"><a href="#cb120-3324" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- and hazard in ('heat', 'wet', 'dry') -- single hazards alone</span></span>
<span id="cb120-3325"><a href="#cb120-3325" aria-hidden="true" tabindex="-1"></a><span class="vs">    and timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb120-3326"><a href="#cb120-3326" aria-hidden="true" tabindex="-1"></a><span class="vs">    and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb120-3327"><a href="#cb120-3327" aria-hidden="true" tabindex="-1"></a><span class="vs">    and admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb120-3328"><a href="#cb120-3328" aria-hidden="true" tabindex="-1"></a><span class="vs">    and admin1_name = '</span><span class="sc">${</span><span class="fu">cleanAdminInput_SQL</span>(adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">'</span></span>
<span id="cb120-3329"><a href="#cb120-3329" aria-hidden="true" tabindex="-1"></a><span class="vs">    and admin2_name is null</span></span>
<span id="cb120-3330"><a href="#cb120-3330" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-120" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb121" data-startfrom="3334" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3333"><span id="cb121-3334"><a href="#cb121-3334" aria-hidden="true" tabindex="-1"></a>dataHazardAdmin2 <span class="op">=</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`-- admin2 level hazard data</span></span>
<span id="cb121-3335"><a href="#cb121-3335" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- chosen scenario and timeframe VoP</span></span>
<span id="cb121-3336"><a href="#cb121-3336" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb121-3337"><a href="#cb121-3337" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb121-3338"><a href="#cb121-3338" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb121-3339"><a href="#cb121-3339" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb121-3340"><a href="#cb121-3340" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb121-3341"><a href="#cb121-3341" aria-hidden="true" tabindex="-1"></a><span class="vs">    , crop</span></span>
<span id="cb121-3342"><a href="#cb121-3342" aria-hidden="true" tabindex="-1"></a><span class="vs">    , severity</span></span>
<span id="cb121-3343"><a href="#cb121-3343" aria-hidden="true" tabindex="-1"></a><span class="vs">    , hazard</span></span>
<span id="cb121-3344"><a href="#cb121-3344" aria-hidden="true" tabindex="-1"></a><span class="vs">    , value as vop</span></span>
<span id="cb121-3345"><a href="#cb121-3345" aria-hidden="true" tabindex="-1"></a><span class="vs">    from haz_risk_vop_int</span></span>
<span id="cb121-3346"><a href="#cb121-3346" aria-hidden="true" tabindex="-1"></a><span class="vs">    where severity = 'severe' -- hard-coded</span></span>
<span id="cb121-3347"><a href="#cb121-3347" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- and hazard in ('heat', 'wet', 'dry') -- single hazards alone</span></span>
<span id="cb121-3348"><a href="#cb121-3348" aria-hidden="true" tabindex="-1"></a><span class="vs">    and timeframe = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">timeframe</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb121-3349"><a href="#cb121-3349" aria-hidden="true" tabindex="-1"></a><span class="vs">    and scenario = '</span><span class="sc">${</span>selectScenarioAndTimeframe<span class="op">.</span><span class="at">scenario</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb121-3350"><a href="#cb121-3350" aria-hidden="true" tabindex="-1"></a><span class="vs">    and admin0_name = '</span><span class="sc">${</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="sc">}</span><span class="vs">'</span></span>
<span id="cb121-3351"><a href="#cb121-3351" aria-hidden="true" tabindex="-1"></a><span class="vs">    and admin1_name = '</span><span class="sc">${</span><span class="fu">cleanAdminInput_SQL</span>(adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">'</span></span>
<span id="cb121-3352"><a href="#cb121-3352" aria-hidden="true" tabindex="-1"></a><span class="vs">    and admin2_name = '</span><span class="sc">${</span><span class="fu">cleanAdminInput_SQL</span>(adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span>)<span class="sc">}</span><span class="vs">'</span></span>
<span id="cb121-3353"><a href="#cb121-3353" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-121" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb122" data-startfrom="3357" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3356"><span id="cb122-3357"><a href="#cb122-3357" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb122-3358"><a href="#cb122-3358" aria-hidden="true" tabindex="-1"></a><span class="vs">### Dynamic Insights - Hazards and exposures`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-122" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb123" data-startfrom="3362" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3361"><span id="cb123-3362"><a href="#cb123-3362" aria-hidden="true" tabindex="-1"></a><span class="co">// get selected hazard for insights, define crop type</span></span>
<span id="cb123-3363"><a href="#cb123-3363" aria-hidden="true" tabindex="-1"></a>data_selectedHazardCropType <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb123-3364"><a href="#cb123-3364" aria-hidden="true" tabindex="-1"></a>  data_hazardVoP<span class="op">,</span></span>
<span id="cb123-3365"><a href="#cb123-3365" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> selectHazard)<span class="op">,</span></span>
<span id="cb123-3366"><a href="#cb123-3366" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb123-3367"><a href="#cb123-3367" aria-hidden="true" tabindex="-1"></a>    <span class="dt">cropType</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb123-3368"><a href="#cb123-3368" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (riskDataTypes<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">crop</span>)) <span class="cf">return</span> <span class="st">"crop"</span><span class="op">;</span></span>
<span id="cb123-3369"><a href="#cb123-3369" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (riskDataTypes<span class="op">.</span><span class="at">crop</span><span class="op">.</span><span class="at">livestock</span><span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">crop</span>)) <span class="cf">return</span> <span class="st">"livestock"</span><span class="op">;</span></span>
<span id="cb123-3370"><a href="#cb123-3370" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> <span class="st">"other"</span><span class="op">;</span></span>
<span id="cb123-3371"><a href="#cb123-3371" aria-hidden="true" tabindex="-1"></a>    }<span class="op">,</span></span>
<span id="cb123-3372"><a href="#cb123-3372" aria-hidden="true" tabindex="-1"></a>  })<span class="op">,</span></span>
<span id="cb123-3373"><a href="#cb123-3373" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">arrange</span>([<span class="st">"cropType"</span><span class="op">,</span> T<span class="op">.</span><span class="fu">desc</span>(<span class="st">"vop"</span>)])<span class="op">,</span></span>
<span id="cb123-3374"><a href="#cb123-3374" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-123" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb124" data-startfrom="3378" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3377"><span id="cb124-3378"><a href="#cb124-3378" aria-hidden="true" tabindex="-1"></a><span class="co">// combined crop and livestock exposed for selection</span></span>
<span id="cb124-3379"><a href="#cb124-3379" aria-hidden="true" tabindex="-1"></a>insight_totalExposedVop <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb124-3380"><a href="#cb124-3380" aria-hidden="true" tabindex="-1"></a>  data_selectedHazardCropType<span class="op">,</span></span>
<span id="cb124-3381"><a href="#cb124-3381" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb124-3382"><a href="#cb124-3382" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"cropType"</span>]<span class="op">,</span></span>
<span id="cb124-3383"><a href="#cb124-3383" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb124-3384"><a href="#cb124-3384" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb124-3385"><a href="#cb124-3385" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalExposedVop</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"vop"</span>)<span class="op">,</span></span>
<span id="cb124-3386"><a href="#cb124-3386" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb124-3387"><a href="#cb124-3387" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb124-3388"><a href="#cb124-3388" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb124-3389"><a href="#cb124-3389" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-124" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb125" data-startfrom="3393" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3392"><span id="cb125-3393"><a href="#cb125-3393" aria-hidden="true" tabindex="-1"></a><span class="co">// top crop and livestock for selection</span></span>
<span id="cb125-3394"><a href="#cb125-3394" aria-hidden="true" tabindex="-1"></a>insight_topCrops <span class="op">=</span> {</span>
<span id="cb125-3395"><a href="#cb125-3395" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topCrop <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb125-3396"><a href="#cb125-3396" aria-hidden="true" tabindex="-1"></a>    data_selectedHazardCropType<span class="op">,</span></span>
<span id="cb125-3397"><a href="#cb125-3397" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">select</span>([<span class="st">"cropType"</span><span class="op">,</span> <span class="st">"crop"</span><span class="op">,</span> <span class="st">"vop"</span>])<span class="op">,</span></span>
<span id="cb125-3398"><a href="#cb125-3398" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">==</span> <span class="st">"crop"</span>)<span class="op">,</span></span>
<span id="cb125-3399"><a href="#cb125-3399" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">sliceMax</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">"vop"</span>)</span>
<span id="cb125-3400"><a href="#cb125-3400" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb125-3401"><a href="#cb125-3401" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> topLivestock <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb125-3402"><a href="#cb125-3402" aria-hidden="true" tabindex="-1"></a>    data_selectedHazardCropType<span class="op">,</span></span>
<span id="cb125-3403"><a href="#cb125-3403" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">select</span>([<span class="st">"cropType"</span><span class="op">,</span> <span class="st">"crop"</span><span class="op">,</span> <span class="st">"vop"</span>])<span class="op">,</span></span>
<span id="cb125-3404"><a href="#cb125-3404" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">cropType</span> <span class="op">==</span> <span class="st">"livestock"</span>)<span class="op">,</span></span>
<span id="cb125-3405"><a href="#cb125-3405" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">sliceMax</span>(<span class="dv">1</span><span class="op">,</span> <span class="st">"vop"</span>)</span>
<span id="cb125-3406"><a href="#cb125-3406" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb125-3407"><a href="#cb125-3407" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb125-3408"><a href="#cb125-3408" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>topCrop<span class="op">,</span></span>
<span id="cb125-3409"><a href="#cb125-3409" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>topLivestock</span>
<span id="cb125-3410"><a href="#cb125-3410" aria-hidden="true" tabindex="-1"></a>  ]</span>
<span id="cb125-3411"><a href="#cb125-3411" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-125" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb126" data-startfrom="3415" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3414"><span id="cb126-3415"><a href="#cb126-3415" aria-hidden="true" tabindex="-1"></a><span class="co">// total vop exposed by each hazard</span></span>
<span id="cb126-3416"><a href="#cb126-3416" aria-hidden="true" tabindex="-1"></a>insight_rankedHazardVopTotals <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb126-3417"><a href="#cb126-3417" aria-hidden="true" tabindex="-1"></a>  data_hazardVoP<span class="op">,</span></span>
<span id="cb126-3418"><a href="#cb126-3418" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb126-3419"><a href="#cb126-3419" aria-hidden="true" tabindex="-1"></a>    [<span class="st">"hazard"</span>]<span class="op">,</span></span>
<span id="cb126-3420"><a href="#cb126-3420" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb126-3421"><a href="#cb126-3421" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb126-3422"><a href="#cb126-3422" aria-hidden="true" tabindex="-1"></a>        <span class="dt">totalVop</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"vop"</span>)<span class="op">,</span></span>
<span id="cb126-3423"><a href="#cb126-3423" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb126-3424"><a href="#cb126-3424" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb126-3425"><a href="#cb126-3425" aria-hidden="true" tabindex="-1"></a>  )<span class="op">,</span></span>
<span id="cb126-3426"><a href="#cb126-3426" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> <span class="op">!</span>[<span class="st">"any"</span><span class="op">,</span> <span class="st">"no hazard"</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">hazard</span>))<span class="op">,</span> <span class="co">// remove combined and no hazard</span></span>
<span id="cb126-3427"><a href="#cb126-3427" aria-hidden="true" tabindex="-1"></a>  T<span class="op">.</span><span class="fu">arrange</span>(T<span class="op">.</span><span class="fu">desc</span>(<span class="st">"totalVop"</span>))<span class="op">,</span></span>
<span id="cb126-3428"><a href="#cb126-3428" aria-hidden="true" tabindex="-1"></a>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-126" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb127" data-startfrom="3432" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3431"><span id="cb127-3432"><a href="#cb127-3432" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb127-3433"><a href="#cb127-3433" aria-hidden="true" tabindex="-1"></a><span class="vs">### Choropleth map - Adaptive Capacities</span></span>
<span id="cb127-3434"><a href="#cb127-3434" aria-hidden="true" tabindex="-1"></a><span class="vs">*Population affected by admin region*</span></span>
<span id="cb127-3435"><a href="#cb127-3435" aria-hidden="true" tabindex="-1"></a><span class="vs">- Fetch the data separately for the different admin levels and generate map data for each</span></span>
<span id="cb127-3436"><a href="#cb127-3436" aria-hidden="true" tabindex="-1"></a><span class="vs">- Serve different data based on admin selection`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-127" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb128" data-startfrom="3440" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3439"><span id="cb128-3440"><a href="#cb128-3440" aria-hidden="true" tabindex="-1"></a><span class="co">// map layer options</span></span>
<span id="cb128-3441"><a href="#cb128-3441" aria-hidden="true" tabindex="-1"></a>dataLayerOptionsAdaptiveCapacities <span class="op">=</span> [</span>
<span id="cb128-3442"><a href="#cb128-3442" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb128-3443"><a href="#cb128-3443" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">"pov"</span><span class="op">,</span> <span class="co">// lookup id for data option</span></span>
<span id="cb128-3444"><a href="#cb128-3444" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dataColumn</span><span class="op">:</span> <span class="st">"ac_pov"</span><span class="op">,</span> <span class="co">// data column (decimal of AC)</span></span>
<span id="cb128-3445"><a href="#cb128-3445" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">pov</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span> <span class="co">// label</span></span>
<span id="cb128-3446"><a href="#cb128-3446" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelLegend</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb128-3447"><a href="#cb128-3447" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">pov</span><span class="op">.</span><span class="at">labelLegend</span><span class="op">,</span></span>
<span id="cb128-3448"><a href="#cb128-3448" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span> <span class="co">// label for color legend</span></span>
<span id="cb128-3449"><a href="#cb128-3449" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb128-3450"><a href="#cb128-3450" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb128-3451"><a href="#cb128-3451" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">"edu"</span><span class="op">,</span></span>
<span id="cb128-3452"><a href="#cb128-3452" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dataColumn</span><span class="op">:</span> <span class="st">"ac_edu"</span><span class="op">,</span></span>
<span id="cb128-3453"><a href="#cb128-3453" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">edu</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb128-3454"><a href="#cb128-3454" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelLegend</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb128-3455"><a href="#cb128-3455" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">edu</span><span class="op">.</span><span class="at">labelLegend</span><span class="op">,</span></span>
<span id="cb128-3456"><a href="#cb128-3456" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb128-3457"><a href="#cb128-3457" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb128-3458"><a href="#cb128-3458" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb128-3459"><a href="#cb128-3459" aria-hidden="true" tabindex="-1"></a>    <span class="dt">key</span><span class="op">:</span> <span class="st">"fem"</span><span class="op">,</span></span>
<span id="cb128-3460"><a href="#cb128-3460" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dataColumn</span><span class="op">:</span> <span class="st">"ac_fem"</span><span class="op">,</span></span>
<span id="cb128-3461"><a href="#cb128-3461" aria-hidden="true" tabindex="-1"></a>    <span class="dt">label</span><span class="op">:</span> <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">fem</span><span class="op">.</span><span class="at">label</span>)<span class="op">,</span></span>
<span id="cb128-3462"><a href="#cb128-3462" aria-hidden="true" tabindex="-1"></a>    <span class="dt">labelLegend</span><span class="op">:</span> <span class="fu">_lang</span>(</span>
<span id="cb128-3463"><a href="#cb128-3463" aria-hidden="true" tabindex="-1"></a>      nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">inputs</span><span class="op">.</span><span class="at">mapLayer</span><span class="op">.</span><span class="at">options</span><span class="op">.</span><span class="at">fem</span><span class="op">.</span><span class="at">labelLegend</span><span class="op">,</span></span>
<span id="cb128-3464"><a href="#cb128-3464" aria-hidden="true" tabindex="-1"></a>    )<span class="op">,</span></span>
<span id="cb128-3465"><a href="#cb128-3465" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb128-3466"><a href="#cb128-3466" aria-hidden="true" tabindex="-1"></a>]<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> ({</span>
<span id="cb128-3467"><a href="#cb128-3467" aria-hidden="true" tabindex="-1"></a>  <span class="co">// apply common values across all options</span></span>
<span id="cb128-3468"><a href="#cb128-3468" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span>d<span class="op">,</span></span>
<span id="cb128-3469"><a href="#cb128-3469" aria-hidden="true" tabindex="-1"></a>  <span class="dt">labelPop</span><span class="op">:</span> <span class="st">"Population"</span><span class="op">,</span> <span class="co">// tooltip label for population affected</span></span>
<span id="cb128-3470"><a href="#cb128-3470" aria-hidden="true" tabindex="-1"></a>  <span class="dt">popColumn</span><span class="op">:</span> <span class="st">"total_pop"</span><span class="op">,</span> <span class="co">// population column</span></span>
<span id="cb128-3471"><a href="#cb128-3471" aria-hidden="true" tabindex="-1"></a>  <span class="dt">colorDomain</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">range</span><span class="op">.</span><span class="at">orangeRed</span><span class="op">,</span> <span class="co">// color domain</span></span>
<span id="cb128-3472"><a href="#cb128-3472" aria-hidden="true" tabindex="-1"></a>  <span class="dt">colorUnknown</span><span class="op">:</span> colorScales<span class="op">.</span><span class="at">unknown</span><span class="op">,</span> <span class="co">// unknown fill color</span></span>
<span id="cb128-3473"><a href="#cb128-3473" aria-hidden="true" tabindex="-1"></a>}))<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-128" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb129" data-startfrom="3477" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3476"><span id="cb129-3477"><a href="#cb129-3477" aria-hidden="true" tabindex="-1"></a><span class="co">// filter adaptive capacity data, get relevant features</span></span>
<span id="cb129-3478"><a href="#cb129-3478" aria-hidden="true" tabindex="-1"></a>mapFeaturesAdaptiveCapacity <span class="op">=</span> {</span>
<span id="cb129-3479"><a href="#cb129-3479" aria-hidden="true" tabindex="-1"></a>  <span class="co">// if null selection for all admins, return admin0 level</span></span>
<span id="cb129-3480"><a href="#cb129-3480" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span>) <span class="cf">return</span> mapDataAdaptiveCapacityAdmin0<span class="op">.</span><span class="at">features</span></span>
<span id="cb129-3481"><a href="#cb129-3481" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return admin2 level</span></span>
<span id="cb129-3482"><a href="#cb129-3482" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb129-3483"><a href="#cb129-3483" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> mapDataAdaptiveCapacityAdmin2<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb129-3484"><a href="#cb129-3484" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> (</span>
<span id="cb129-3485"><a href="#cb129-3485" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin0_name</span> <span class="op">===</span></span>
<span id="cb129-3486"><a href="#cb129-3486" aria-hidden="true" tabindex="-1"></a>          (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin0_name</span>) <span class="op">&amp;&amp;</span></span>
<span id="cb129-3487"><a href="#cb129-3487" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin1_name</span> <span class="op">===</span></span>
<span id="cb129-3488"><a href="#cb129-3488" aria-hidden="true" tabindex="-1"></a>          (adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> d<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">admin1_name</span>)</span>
<span id="cb129-3489"><a href="#cb129-3489" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb129-3490"><a href="#cb129-3490" aria-hidden="true" tabindex="-1"></a>    })<span class="op">;</span></span>
<span id="cb129-3491"><a href="#cb129-3491" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb129-3492"><a href="#cb129-3492" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-129" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb130" data-startfrom="3496" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3495"><span id="cb130-3496"><a href="#cb130-3496" aria-hidden="true" tabindex="-1"></a>mapDataAdaptiveCapacityAdmin2 <span class="op">=</span> {</span>
<span id="cb130-3497"><a href="#cb130-3497" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb130-3498"><a href="#cb130-3498" aria-hidden="true" tabindex="-1"></a>    dataAdaptiveCapacity<span class="op">,</span></span>
<span id="cb130-3499"><a href="#cb130-3499" aria-hidden="true" tabindex="-1"></a>    <span class="co">// add data join for geo data</span></span>
<span id="cb130-3500"><a href="#cb130-3500" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb130-3501"><a href="#cb130-3501" aria-hidden="true" tabindex="-1"></a>      <span class="dt">a2_a1_a0</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> [d<span class="op">.</span><span class="at">admin2_name</span><span class="op">,</span> d<span class="op">.</span><span class="at">admin1_name</span><span class="op">,</span> d<span class="op">.</span><span class="at">admin0_name</span>]<span class="op">.</span><span class="fu">join</span>(<span class="st">"_"</span>)</span>
<span id="cb130-3502"><a href="#cb130-3502" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb130-3503"><a href="#cb130-3503" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb130-3504"><a href="#cb130-3504" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> geoData <span class="op">=</span> boundaries<span class="op">.</span><span class="at">admin2</span><span class="op">;</span></span>
<span id="cb130-3505"><a href="#cb130-3505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-3506"><a href="#cb130-3506" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">bindTabularToGeo</span>({</span>
<span id="cb130-3507"><a href="#cb130-3507" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb130-3508"><a href="#cb130-3508" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dataBindColumn</span><span class="op">:</span> <span class="st">"a2_a1_a0"</span><span class="op">,</span></span>
<span id="cb130-3509"><a href="#cb130-3509" aria-hidden="true" tabindex="-1"></a>    <span class="dt">geoData</span><span class="op">:</span> geoData<span class="op">,</span></span>
<span id="cb130-3510"><a href="#cb130-3510" aria-hidden="true" tabindex="-1"></a>    <span class="dt">geoDataBindColumn</span><span class="op">:</span> <span class="st">"a2_a1_a0"</span></span>
<span id="cb130-3511"><a href="#cb130-3511" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb130-3512"><a href="#cb130-3512" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-130" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb131" data-startfrom="3516" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3515"><span id="cb131-3516"><a href="#cb131-3516" aria-hidden="true" tabindex="-1"></a>mapDataAdaptiveCapacityAdmin0 <span class="op">=</span> {</span>
<span id="cb131-3517"><a href="#cb131-3517" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> dataAdaptiveCapacity</span>
<span id="cb131-3518"><a href="#cb131-3518" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> geoData <span class="op">=</span> boundaries<span class="op">.</span><span class="at">admin0</span><span class="op">;</span></span>
<span id="cb131-3519"><a href="#cb131-3519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-3520"><a href="#cb131-3520" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">bindTabularToGeo</span>({</span>
<span id="cb131-3521"><a href="#cb131-3521" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb131-3522"><a href="#cb131-3522" aria-hidden="true" tabindex="-1"></a>    <span class="dt">dataBindColumn</span><span class="op">:</span> <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb131-3523"><a href="#cb131-3523" aria-hidden="true" tabindex="-1"></a>    <span class="dt">geoData</span><span class="op">:</span> geoData<span class="op">,</span></span>
<span id="cb131-3524"><a href="#cb131-3524" aria-hidden="true" tabindex="-1"></a>    <span class="dt">geoDataBindColumn</span><span class="op">:</span> <span class="st">"admin0_name"</span></span>
<span id="cb131-3525"><a href="#cb131-3525" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb131-3526"><a href="#cb131-3526" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-131" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb132" data-startfrom="3530" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3529"><span id="cb132-3530"><a href="#cb132-3530" aria-hidden="true" tabindex="-1"></a>dataAdaptiveCapacity <span class="op">=</span> {</span>
<span id="cb132-3531"><a href="#cb132-3531" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> country <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb132-3532"><a href="#cb132-3532" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin1 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb132-3533"><a href="#cb132-3533" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin2 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb132-3534"><a href="#cb132-3534" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3535"><a href="#cb132-3535" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> adminQuery <span class="op">=</span> <span class="vs">`WHERE admin0_name </span><span class="sc">${</span>country <span class="op">?</span> <span class="vs">`= '</span><span class="sc">${</span>country<span class="sc">}</span><span class="vs">'`</span> <span class="op">:</span> <span class="st">'IS NOT NULL'</span><span class="sc">}</span><span class="vs">`</span></span>
<span id="cb132-3536"><a href="#cb132-3536" aria-hidden="true" tabindex="-1"></a>  adminQuery <span class="op">+=</span> <span class="op">!</span>country <span class="op">?</span> <span class="vs">` AND admin1_name IS NULL`</span> <span class="op">:</span>  <span class="vs">`AND admin2_name IS NOT NULL`</span></span>
<span id="cb132-3537"><a href="#cb132-3537" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-3538"><a href="#cb132-3538" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb132-3539"><a href="#cb132-3539" aria-hidden="true" tabindex="-1"></a>  <span class="co">// const adminQuery = `</span></span>
<span id="cb132-3540"><a href="#cb132-3540" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   WHERE admin0_name ${country ? `= '${country}'` : 'IS NOT NULL'}</span></span>
<span id="cb132-3541"><a href="#cb132-3541" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   AND admin1_name ${admin1 ? `= '${admin1}'` : 'IS NULL'}</span></span>
<span id="cb132-3542"><a href="#cb132-3542" aria-hidden="true" tabindex="-1"></a>  <span class="co">//   AND admin2_name ${admin2 ? `= '${admin2}'` : 'IS NULL'}`</span></span>
<span id="cb132-3543"><a href="#cb132-3543" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb132-3544"><a href="#cb132-3544" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb132-3545"><a href="#cb132-3545" aria-hidden="true" tabindex="-1"></a><span class="vs">    WITH filtered_ac AS (</span></span>
<span id="cb132-3546"><a href="#cb132-3546" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT </span></span>
<span id="cb132-3547"><a href="#cb132-3547" aria-hidden="true" tabindex="-1"></a><span class="vs">            admin0_name,</span></span>
<span id="cb132-3548"><a href="#cb132-3548" aria-hidden="true" tabindex="-1"></a><span class="vs">            admin1_name,</span></span>
<span id="cb132-3549"><a href="#cb132-3549" aria-hidden="true" tabindex="-1"></a><span class="vs">            admin2_name,</span></span>
<span id="cb132-3550"><a href="#cb132-3550" aria-hidden="true" tabindex="-1"></a><span class="vs">            "GenderEquity_1995.2015" AS ac_fem,</span></span>
<span id="cb132-3551"><a href="#cb132-3551" aria-hidden="true" tabindex="-1"></a><span class="vs">            "IHME_edu.years_2014" AS ac_edu,</span></span>
<span id="cb132-3552"><a href="#cb132-3552" aria-hidden="true" tabindex="-1"></a><span class="vs">            "GASP_poor365_2017" AS ac_pov</span></span>
<span id="cb132-3553"><a href="#cb132-3553" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM vul_ac2</span></span>
<span id="cb132-3554"><a href="#cb132-3554" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span>adminQuery<span class="sc">}</span></span>
<span id="cb132-3555"><a href="#cb132-3555" aria-hidden="true" tabindex="-1"></a><span class="vs">    ),</span></span>
<span id="cb132-3556"><a href="#cb132-3556" aria-hidden="true" tabindex="-1"></a><span class="vs">    filtered_pop AS (</span></span>
<span id="cb132-3557"><a href="#cb132-3557" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT </span></span>
<span id="cb132-3558"><a href="#cb132-3558" aria-hidden="true" tabindex="-1"></a><span class="vs">            admin0_name,</span></span>
<span id="cb132-3559"><a href="#cb132-3559" aria-hidden="true" tabindex="-1"></a><span class="vs">            admin1_name,</span></span>
<span id="cb132-3560"><a href="#cb132-3560" aria-hidden="true" tabindex="-1"></a><span class="vs">            admin2_name,</span></span>
<span id="cb132-3561"><a href="#cb132-3561" aria-hidden="true" tabindex="-1"></a><span class="vs">            total_pop,</span></span>
<span id="cb132-3562"><a href="#cb132-3562" aria-hidden="true" tabindex="-1"></a><span class="vs">            rural_pop</span></span>
<span id="cb132-3563"><a href="#cb132-3563" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM population</span></span>
<span id="cb132-3564"><a href="#cb132-3564" aria-hidden="true" tabindex="-1"></a><span class="vs">        </span><span class="sc">${</span>adminQuery<span class="sc">}</span></span>
<span id="cb132-3565"><a href="#cb132-3565" aria-hidden="true" tabindex="-1"></a><span class="vs">    )</span></span>
<span id="cb132-3566"><a href="#cb132-3566" aria-hidden="true" tabindex="-1"></a><span class="vs">    </span></span>
<span id="cb132-3567"><a href="#cb132-3567" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT v.*, p.total_pop, p.rural_pop</span></span>
<span id="cb132-3568"><a href="#cb132-3568" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM filtered_ac v</span></span>
<span id="cb132-3569"><a href="#cb132-3569" aria-hidden="true" tabindex="-1"></a><span class="vs">    JOIN filtered_pop p</span></span>
<span id="cb132-3570"><a href="#cb132-3570" aria-hidden="true" tabindex="-1"></a><span class="vs">    ON v.admin0_name = p.admin0_name</span></span>
<span id="cb132-3571"><a href="#cb132-3571" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND (v.admin1_name = p.admin1_name OR (v.admin1_name IS NULL AND p.admin1_name IS NULL))</span></span>
<span id="cb132-3572"><a href="#cb132-3572" aria-hidden="true" tabindex="-1"></a><span class="vs">    AND (v.admin2_name = p.admin2_name OR (v.admin2_name IS NULL AND p.admin2_name IS NULL));</span></span>
<span id="cb132-3573"><a href="#cb132-3573" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)</span>
<span id="cb132-3574"><a href="#cb132-3574" aria-hidden="true" tabindex="-1"></a>      <span class="co">// ${admin1 ? `AND v.admin1_name = p.admin1_name`: ''}</span></span>
<span id="cb132-3575"><a href="#cb132-3575" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ${admin2 ? `AND v.admin2_name = p.admin1_name`: ''}</span></span>
<span id="cb132-3576"><a href="#cb132-3576" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-132" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb133" data-startfrom="3580" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3579"><span id="cb133-3580"><a href="#cb133-3580" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb133-3581"><a href="#cb133-3581" aria-hidden="true" tabindex="-1"></a><span class="vs">### Dynamic Insights - Adapative Capacities</span></span>
<span id="cb133-3582"><a href="#cb133-3582" aria-hidden="true" tabindex="-1"></a><span class="vs">*insights and helpers*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-133" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb134" data-startfrom="3586" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3585"><span id="cb134-3586"><a href="#cb134-3586" aria-hidden="true" tabindex="-1"></a><span class="co">// data and insights for</span></span>
<span id="cb134-3587"><a href="#cb134-3587" aria-hidden="true" tabindex="-1"></a>dynamicInsights_adaptiveCapacity <span class="op">=</span> {</span>
<span id="cb134-3588"><a href="#cb134-3588" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> dataAdaptiveCapacity<span class="op">;</span></span>
<span id="cb134-3589"><a href="#cb134-3589" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3590"><a href="#cb134-3590" aria-hidden="true" tabindex="-1"></a>  <span class="co">// format functions</span></span>
<span id="cb134-3591"><a href="#cb134-3591" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _formatNumber <span class="op">=</span> formatNumCompactLong<span class="op">;</span></span>
<span id="cb134-3592"><a href="#cb134-3592" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3593"><a href="#cb134-3593" aria-hidden="true" tabindex="-1"></a>  <span class="co">// source data -------------------------------</span></span>
<span id="cb134-3594"><a href="#cb134-3594" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3595"><a href="#cb134-3595" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> exportData <span class="op">=</span> {</span>
<span id="cb134-3596"><a href="#cb134-3596" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin0</span><span class="op">:</span> data<span class="op">,</span></span>
<span id="cb134-3597"><a href="#cb134-3597" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin1</span><span class="op">:</span> <span class="kw">undefined</span><span class="op">,</span></span>
<span id="cb134-3598"><a href="#cb134-3598" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin2</span><span class="op">:</span> <span class="kw">undefined</span></span>
<span id="cb134-3599"><a href="#cb134-3599" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb134-3600"><a href="#cb134-3600" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3601"><a href="#cb134-3601" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="bu">Object</span><span class="op">.</span><span class="fu">values</span>(adminSelections)<span class="op">.</span><span class="fu">every</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span> <span class="op">===</span> <span class="kw">null</span>)) {</span>
<span id="cb134-3602"><a href="#cb134-3602" aria-hidden="true" tabindex="-1"></a>    <span class="co">// selected admin0 data</span></span>
<span id="cb134-3603"><a href="#cb134-3603" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> filteredData0 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb134-3604"><a href="#cb134-3604" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb134-3605"><a href="#cb134-3605" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> (</span>
<span id="cb134-3606"><a href="#cb134-3606" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">===</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> d<span class="op">.</span><span class="at">admin0_name</span>)</span>
<span id="cb134-3607"><a href="#cb134-3607" aria-hidden="true" tabindex="-1"></a>          )<span class="op">;</span></span>
<span id="cb134-3608"><a href="#cb134-3608" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb134-3609"><a href="#cb134-3609" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="kw">undefined</span><span class="op">;</span></span>
<span id="cb134-3610"><a href="#cb134-3610" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3611"><a href="#cb134-3611" aria-hidden="true" tabindex="-1"></a>    <span class="co">// selected admin1 data</span></span>
<span id="cb134-3612"><a href="#cb134-3612" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> filteredData1 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb134-3613"><a href="#cb134-3613" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb134-3614"><a href="#cb134-3614" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> (</span>
<span id="cb134-3615"><a href="#cb134-3615" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">===</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> d<span class="op">.</span><span class="at">admin0_name</span>) <span class="op">&amp;&amp;</span></span>
<span id="cb134-3616"><a href="#cb134-3616" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">admin1_name</span> <span class="op">===</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> d<span class="op">.</span><span class="at">admin1_name</span>)</span>
<span id="cb134-3617"><a href="#cb134-3617" aria-hidden="true" tabindex="-1"></a>          )<span class="op">;</span></span>
<span id="cb134-3618"><a href="#cb134-3618" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb134-3619"><a href="#cb134-3619" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="kw">undefined</span><span class="op">;</span></span>
<span id="cb134-3620"><a href="#cb134-3620" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3621"><a href="#cb134-3621" aria-hidden="true" tabindex="-1"></a>    <span class="co">// selected admin2 data</span></span>
<span id="cb134-3622"><a href="#cb134-3622" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> filteredData2 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb134-3623"><a href="#cb134-3623" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb134-3624"><a href="#cb134-3624" aria-hidden="true" tabindex="-1"></a>          <span class="cf">return</span> (</span>
<span id="cb134-3625"><a href="#cb134-3625" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">===</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> d<span class="op">.</span><span class="at">admin0_name</span>) <span class="op">&amp;&amp;</span></span>
<span id="cb134-3626"><a href="#cb134-3626" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">admin1_name</span> <span class="op">===</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> d<span class="op">.</span><span class="at">admin1_name</span>) <span class="op">&amp;&amp;</span></span>
<span id="cb134-3627"><a href="#cb134-3627" aria-hidden="true" tabindex="-1"></a>            d<span class="op">.</span><span class="at">admin2_name</span> <span class="op">===</span> (adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> d<span class="op">.</span><span class="at">admin2_name</span>)</span>
<span id="cb134-3628"><a href="#cb134-3628" aria-hidden="true" tabindex="-1"></a>          )<span class="op">;</span></span>
<span id="cb134-3629"><a href="#cb134-3629" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb134-3630"><a href="#cb134-3630" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> <span class="kw">undefined</span><span class="op">;</span></span>
<span id="cb134-3631"><a href="#cb134-3631" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3632"><a href="#cb134-3632" aria-hidden="true" tabindex="-1"></a>    exportData <span class="op">=</span> {</span>
<span id="cb134-3633"><a href="#cb134-3633" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin0</span><span class="op">:</span> filteredData0<span class="op">,</span></span>
<span id="cb134-3634"><a href="#cb134-3634" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin1</span><span class="op">:</span> filteredData1<span class="op">,</span></span>
<span id="cb134-3635"><a href="#cb134-3635" aria-hidden="true" tabindex="-1"></a>      <span class="dt">admin2</span><span class="op">:</span> filteredData2</span>
<span id="cb134-3636"><a href="#cb134-3636" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb134-3637"><a href="#cb134-3637" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb134-3638"><a href="#cb134-3638" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3639"><a href="#cb134-3639" aria-hidden="true" tabindex="-1"></a>  <span class="co">// insights from source -------------------------------</span></span>
<span id="cb134-3640"><a href="#cb134-3640" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">findAdmin2ACStats</span>(data) {</span>
<span id="cb134-3641"><a href="#cb134-3641" aria-hidden="true" tabindex="-1"></a>    <span class="co">// admin2 stats</span></span>
<span id="cb134-3642"><a href="#cb134-3642" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - find the counts for each AC</span></span>
<span id="cb134-3643"><a href="#cb134-3643" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - find majorities</span></span>
<span id="cb134-3644"><a href="#cb134-3644" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - find regions that have all and none for binary ACs</span></span>
<span id="cb134-3645"><a href="#cb134-3645" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb134-3646"><a href="#cb134-3646" aria-hidden="true" tabindex="-1"></a>      data<span class="op">,</span></span>
<span id="cb134-3647"><a href="#cb134-3647" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb134-3648"><a href="#cb134-3648" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_edu_pop</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (d<span class="op">.</span><span class="at">ac_edu</span> <span class="op">===</span> <span class="kw">null</span> <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> d<span class="op">.</span><span class="at">ac_edu</span> <span class="op">*</span> d<span class="op">.</span><span class="at">total_pop</span>)<span class="op">,</span></span>
<span id="cb134-3649"><a href="#cb134-3649" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_fem_pop</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (d<span class="op">.</span><span class="at">ac_fem</span> <span class="op">===</span> <span class="kw">null</span> <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> d<span class="op">.</span><span class="at">ac_fem</span> <span class="op">*</span> d<span class="op">.</span><span class="at">total_pop</span>)<span class="op">,</span></span>
<span id="cb134-3650"><a href="#cb134-3650" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_pov_pop</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> (d<span class="op">.</span><span class="at">ac_pov</span> <span class="op">===</span> <span class="kw">null</span> <span class="op">?</span> <span class="kw">null</span> <span class="op">:</span> d<span class="op">.</span><span class="at">ac_pov</span> <span class="op">*</span> d<span class="op">.</span><span class="at">total_pop</span>)</span>
<span id="cb134-3651"><a href="#cb134-3651" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb134-3652"><a href="#cb134-3652" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb134-3653"><a href="#cb134-3653" aria-hidden="true" tabindex="-1"></a>        <span class="dt">total_pop</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"total_pop"</span>)<span class="op">,</span></span>
<span id="cb134-3654"><a href="#cb134-3654" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_edu_pop</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"ac_edu_pop"</span>)<span class="op">,</span></span>
<span id="cb134-3655"><a href="#cb134-3655" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_fem_pop</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"ac_fem_pop"</span>)<span class="op">,</span></span>
<span id="cb134-3656"><a href="#cb134-3656" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_pov_pop</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"ac_pov_pop"</span>)</span>
<span id="cb134-3657"><a href="#cb134-3657" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb134-3658"><a href="#cb134-3658" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb134-3659"><a href="#cb134-3659" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_edu_maj</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ac_edu_pop</span> <span class="op">&gt;</span> (<span class="fl">0.5</span> <span class="op">*</span> d<span class="op">.</span><span class="at">total_pop</span>)<span class="op">,</span></span>
<span id="cb134-3660"><a href="#cb134-3660" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_fem_maj</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ac_fem_pop</span> <span class="op">&gt;</span> (<span class="fl">0.5</span> <span class="op">*</span> d<span class="op">.</span><span class="at">total_pop</span>)<span class="op">,</span></span>
<span id="cb134-3661"><a href="#cb134-3661" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_pov_maj</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ac_pov_pop</span> <span class="op">&gt;</span> (<span class="fl">0.5</span> <span class="op">*</span> d<span class="op">.</span><span class="at">total_pop</span>)<span class="op">,</span></span>
<span id="cb134-3662"><a href="#cb134-3662" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb134-3663"><a href="#cb134-3663" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb134-3664"><a href="#cb134-3664" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_edu_perc</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ac_edu_pop</span> <span class="op">/</span> d<span class="op">.</span><span class="at">total_pop</span><span class="op">,</span></span>
<span id="cb134-3665"><a href="#cb134-3665" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_fem_perc</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ac_fem_pop</span> <span class="op">/</span> d<span class="op">.</span><span class="at">total_pop</span><span class="op">,</span></span>
<span id="cb134-3666"><a href="#cb134-3666" aria-hidden="true" tabindex="-1"></a>        <span class="dt">ac_pov_perc</span><span class="op">:</span> (d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">ac_pov_pop</span> <span class="op">/</span> d<span class="op">.</span><span class="at">total_pop</span><span class="op">,</span></span>
<span id="cb134-3667"><a href="#cb134-3667" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb134-3668"><a href="#cb134-3668" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb134-3669"><a href="#cb134-3669" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb134-3670"><a href="#cb134-3670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3671"><a href="#cb134-3671" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insights0 <span class="op">=</span> exportData<span class="op">.</span><span class="at">admin0</span></span>
<span id="cb134-3672"><a href="#cb134-3672" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="fu">findAdmin2ACStats</span>(exportData<span class="op">.</span><span class="at">admin0</span>)</span>
<span id="cb134-3673"><a href="#cb134-3673" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb134-3674"><a href="#cb134-3674" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insights1 <span class="op">=</span> exportData<span class="op">.</span><span class="at">admin1</span></span>
<span id="cb134-3675"><a href="#cb134-3675" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="fu">findAdmin2ACStats</span>(exportData<span class="op">.</span><span class="at">admin1</span>)</span>
<span id="cb134-3676"><a href="#cb134-3676" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb134-3677"><a href="#cb134-3677" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insights2 <span class="op">=</span> exportData<span class="op">.</span><span class="at">admin2</span></span>
<span id="cb134-3678"><a href="#cb134-3678" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="fu">findAdmin2ACStats</span>(exportData<span class="op">.</span><span class="at">admin2</span>)</span>
<span id="cb134-3679"><a href="#cb134-3679" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb134-3680"><a href="#cb134-3680" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3681"><a href="#cb134-3681" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> insights <span class="op">=</span> {</span>
<span id="cb134-3682"><a href="#cb134-3682" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin0</span><span class="op">:</span> insights0<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb134-3683"><a href="#cb134-3683" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin1</span><span class="op">:</span> insights1<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">,</span></span>
<span id="cb134-3684"><a href="#cb134-3684" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin2</span><span class="op">:</span> insights2<span class="op">?.</span>[<span class="dv">0</span>]</span>
<span id="cb134-3685"><a href="#cb134-3685" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb134-3686"><a href="#cb134-3686" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3687"><a href="#cb134-3687" aria-hidden="true" tabindex="-1"></a>  <span class="co">// admin selection total ---------------------------------</span></span>
<span id="cb134-3688"><a href="#cb134-3688" aria-hidden="true" tabindex="-1"></a>  <span class="co">// - sum the admin2 population values for given admin selection</span></span>
<span id="cb134-3689"><a href="#cb134-3689" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">sumPopulations</span>(data) {</span>
<span id="cb134-3690"><a href="#cb134-3690" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb134-3691"><a href="#cb134-3691" aria-hidden="true" tabindex="-1"></a>      data<span class="op">,</span></span>
<span id="cb134-3692"><a href="#cb134-3692" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb134-3693"><a href="#cb134-3693" aria-hidden="true" tabindex="-1"></a>        <span class="dt">total_pop</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"total_pop"</span>)<span class="op">,</span></span>
<span id="cb134-3694"><a href="#cb134-3694" aria-hidden="true" tabindex="-1"></a>        <span class="dt">rural_pop</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"rural_pop"</span>)</span>
<span id="cb134-3695"><a href="#cb134-3695" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb134-3696"><a href="#cb134-3696" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb134-3697"><a href="#cb134-3697" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb134-3698"><a href="#cb134-3698" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3699"><a href="#cb134-3699" aria-hidden="true" tabindex="-1"></a>  <span class="co">// get total based on admin selection</span></span>
<span id="cb134-3700"><a href="#cb134-3700" aria-hidden="true" tabindex="-1"></a>  <span class="co">// overwrite total if more granular data is non-null</span></span>
<span id="cb134-3701"><a href="#cb134-3701" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> totalPopulations<span class="op">;</span></span>
<span id="cb134-3702"><a href="#cb134-3702" aria-hidden="true" tabindex="-1"></a>  totalPopulations <span class="op">=</span> exportData<span class="op">.</span><span class="at">admin0</span></span>
<span id="cb134-3703"><a href="#cb134-3703" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="fu">sumPopulations</span>(exportData<span class="op">.</span><span class="at">admin0</span>)</span>
<span id="cb134-3704"><a href="#cb134-3704" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> totalPopulations<span class="op">;</span></span>
<span id="cb134-3705"><a href="#cb134-3705" aria-hidden="true" tabindex="-1"></a>  totalPopulations <span class="op">=</span> exportData<span class="op">.</span><span class="at">admin1</span></span>
<span id="cb134-3706"><a href="#cb134-3706" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="fu">sumPopulations</span>(exportData<span class="op">.</span><span class="at">admin1</span>)</span>
<span id="cb134-3707"><a href="#cb134-3707" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> totalPopulations<span class="op">;</span></span>
<span id="cb134-3708"><a href="#cb134-3708" aria-hidden="true" tabindex="-1"></a>  totalPopulations <span class="op">=</span> exportData<span class="op">.</span><span class="at">admin2</span></span>
<span id="cb134-3709"><a href="#cb134-3709" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="fu">sumPopulations</span>(exportData<span class="op">.</span><span class="at">admin2</span>)</span>
<span id="cb134-3710"><a href="#cb134-3710" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> totalPopulations<span class="op">;</span></span>
<span id="cb134-3711"><a href="#cb134-3711" aria-hidden="true" tabindex="-1"></a>  totalPopulations <span class="op">=</span> totalPopulations<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb134-3712"><a href="#cb134-3712" aria-hidden="true" tabindex="-1"></a>  totalPopulations[<span class="st">"total_pop_format"</span>] <span class="op">=</span> <span class="fu">_formatNumber</span>(</span>
<span id="cb134-3713"><a href="#cb134-3713" aria-hidden="true" tabindex="-1"></a>    totalPopulations[<span class="st">"total_pop"</span>]</span>
<span id="cb134-3714"><a href="#cb134-3714" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb134-3715"><a href="#cb134-3715" aria-hidden="true" tabindex="-1"></a>  totalPopulations[<span class="st">"rural_pop_format"</span>] <span class="op">=</span> <span class="fu">_formatNumber</span>(</span>
<span id="cb134-3716"><a href="#cb134-3716" aria-hidden="true" tabindex="-1"></a>    totalPopulations[<span class="st">"rural_pop"</span>]</span>
<span id="cb134-3717"><a href="#cb134-3717" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb134-3718"><a href="#cb134-3718" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3719"><a href="#cb134-3719" aria-hidden="true" tabindex="-1"></a>  <span class="co">// all/none admin2's within admin0 ---------------------------------</span></span>
<span id="cb134-3720"><a href="#cb134-3720" aria-hidden="true" tabindex="-1"></a>  <span class="co">// the admin2's within the selected admin0 that are all/none AC</span></span>
<span id="cb134-3721"><a href="#cb134-3721" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">findAdmin2ACStatsAdmin0</span>(data) {</span>
<span id="cb134-3722"><a href="#cb134-3722" aria-hidden="true" tabindex="-1"></a>    <span class="co">// admin2 stats</span></span>
<span id="cb134-3723"><a href="#cb134-3723" aria-hidden="true" tabindex="-1"></a>    <span class="co">// - find regions that have all and none for binary ACs</span></span>
<span id="cb134-3724"><a href="#cb134-3724" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb134-3725"><a href="#cb134-3725" aria-hidden="true" tabindex="-1"></a>      data<span class="op">,</span></span>
<span id="cb134-3726"><a href="#cb134-3726" aria-hidden="true" tabindex="-1"></a>      <span class="co">// all or none of ACs</span></span>
<span id="cb134-3727"><a href="#cb134-3727" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">mutate</span>({</span>
<span id="cb134-3728"><a href="#cb134-3728" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin0_ac_all</span><span class="op">:</span> (d) <span class="kw">=&gt;</span></span>
<span id="cb134-3729"><a href="#cb134-3729" aria-hidden="true" tabindex="-1"></a>          <span class="co">// include all admin2's if showing all regions</span></span>
<span id="cb134-3730"><a href="#cb134-3730" aria-hidden="true" tabindex="-1"></a>          (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb134-3731"><a href="#cb134-3731" aria-hidden="true" tabindex="-1"></a>            <span class="op">?</span> d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb134-3732"><a href="#cb134-3732" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="kw">true</span>) <span class="op">&amp;&amp;</span></span>
<span id="cb134-3733"><a href="#cb134-3733" aria-hidden="true" tabindex="-1"></a>          d<span class="op">.</span><span class="at">ac_edu</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span></span>
<span id="cb134-3734"><a href="#cb134-3734" aria-hidden="true" tabindex="-1"></a>          d<span class="op">.</span><span class="at">ac_fem</span> <span class="op">&gt;</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span></span>
<span id="cb134-3735"><a href="#cb134-3735" aria-hidden="true" tabindex="-1"></a>          d<span class="op">.</span><span class="at">ac_pov</span> <span class="op">&lt;=</span> <span class="fl">0.5</span><span class="op">,</span> <span class="co">// reversed</span></span>
<span id="cb134-3736"><a href="#cb134-3736" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin0_ac_none</span><span class="op">:</span> (d) <span class="kw">=&gt;</span></span>
<span id="cb134-3737"><a href="#cb134-3737" aria-hidden="true" tabindex="-1"></a>          (adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb134-3738"><a href="#cb134-3738" aria-hidden="true" tabindex="-1"></a>            <span class="op">?</span> d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb134-3739"><a href="#cb134-3739" aria-hidden="true" tabindex="-1"></a>            <span class="op">:</span> <span class="kw">true</span>) <span class="op">&amp;&amp;</span></span>
<span id="cb134-3740"><a href="#cb134-3740" aria-hidden="true" tabindex="-1"></a>          d<span class="op">.</span><span class="at">ac_edu</span> <span class="op">&lt;=</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span></span>
<span id="cb134-3741"><a href="#cb134-3741" aria-hidden="true" tabindex="-1"></a>          d<span class="op">.</span><span class="at">ac_fem</span> <span class="op">&lt;=</span> <span class="fl">0.5</span> <span class="op">&amp;&amp;</span></span>
<span id="cb134-3742"><a href="#cb134-3742" aria-hidden="true" tabindex="-1"></a>          d<span class="op">.</span><span class="at">ac_pov</span> <span class="op">&gt;</span> <span class="fl">0.5</span> </span>
<span id="cb134-3743"><a href="#cb134-3743" aria-hidden="true" tabindex="-1"></a>      })<span class="op">,</span></span>
<span id="cb134-3744"><a href="#cb134-3744" aria-hidden="true" tabindex="-1"></a>      T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb134-3745"><a href="#cb134-3745" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin2_count</span><span class="op">:</span> T<span class="op">.</span><span class="fu">n</span>()<span class="op">,</span></span>
<span id="cb134-3746"><a href="#cb134-3746" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin0_ac_all_count</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"admin0_ac_all"</span>)<span class="op">,</span></span>
<span id="cb134-3747"><a href="#cb134-3747" aria-hidden="true" tabindex="-1"></a>        <span class="dt">admin0_ac_none_count</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"admin0_ac_none"</span>)</span>
<span id="cb134-3748"><a href="#cb134-3748" aria-hidden="true" tabindex="-1"></a>      })</span>
<span id="cb134-3749"><a href="#cb134-3749" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb134-3750"><a href="#cb134-3750" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb134-3751"><a href="#cb134-3751" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3752"><a href="#cb134-3752" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> extremeAC2Stats <span class="op">=</span> <span class="fu">findAdmin2ACStatsAdmin0</span>(exportData<span class="op">.</span><span class="at">admin0</span>)<span class="op">?.</span>[<span class="dv">0</span>]<span class="op">;</span></span>
<span id="cb134-3753"><a href="#cb134-3753" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-3754"><a href="#cb134-3754" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb134-3755"><a href="#cb134-3755" aria-hidden="true" tabindex="-1"></a>    <span class="dt">data</span><span class="op">:</span> exportData<span class="op">,</span></span>
<span id="cb134-3756"><a href="#cb134-3756" aria-hidden="true" tabindex="-1"></a>    <span class="dt">insights</span><span class="op">:</span> insights<span class="op">,</span></span>
<span id="cb134-3757"><a href="#cb134-3757" aria-hidden="true" tabindex="-1"></a>    <span class="dt">population_sums</span><span class="op">:</span> totalPopulations<span class="op">,</span></span>
<span id="cb134-3758"><a href="#cb134-3758" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin0LevelA2AllNone</span><span class="op">:</span> extremeAC2Stats</span>
<span id="cb134-3759"><a href="#cb134-3759" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb134-3760"><a href="#cb134-3760" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-134" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb135" data-startfrom="3764" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3763"><span id="cb135-3764"><a href="#cb135-3764" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`#### Helpers`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-135" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb136" data-startfrom="3768" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3767"><span id="cb136-3768"><a href="#cb136-3768" aria-hidden="true" tabindex="-1"></a><span class="co">// define the mad lib for adaptive capacity admin1 and admin 0 levels</span></span>
<span id="cb136-3769"><a href="#cb136-3769" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">adaptiveCapacityInsightMadLib</span>(data<span class="op">,</span> adminName) {</span>
<span id="cb136-3770"><a href="#cb136-3770" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> madLib <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb136-3771"><a href="#cb136-3771" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">madLib</span>)<span class="op">,</span></span>
<span id="cb136-3772"><a href="#cb136-3772" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb136-3773"><a href="#cb136-3773" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> adminName }<span class="op">,</span></span>
<span id="cb136-3774"><a href="#cb136-3774" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb136-3775"><a href="#cb136-3775" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">"index_edu"</span><span class="op">,</span></span>
<span id="cb136-3776"><a href="#cb136-3776" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">formatPercentNoSymbol</span>(<span class="fu">transformPercent</span>(data<span class="op">?.</span><span class="at">ac_edu_perc</span>))<span class="op">,</span></span>
<span id="cb136-3777"><a href="#cb136-3777" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb136-3778"><a href="#cb136-3778" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb136-3779"><a href="#cb136-3779" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">"index_fem"</span><span class="op">,</span></span>
<span id="cb136-3780"><a href="#cb136-3780" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">formatPercentNoSymbol</span>(<span class="fu">transformPercent</span>(data<span class="op">?.</span><span class="at">ac_fem_perc</span>))<span class="op">,</span></span>
<span id="cb136-3781"><a href="#cb136-3781" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb136-3782"><a href="#cb136-3782" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb136-3783"><a href="#cb136-3783" aria-hidden="true" tabindex="-1"></a>        <span class="dt">name</span><span class="op">:</span> <span class="st">"index_pov"</span><span class="op">,</span></span>
<span id="cb136-3784"><a href="#cb136-3784" aria-hidden="true" tabindex="-1"></a>        <span class="dt">value</span><span class="op">:</span> <span class="fu">formatPercentNoSymbol</span>(<span class="fu">transformPercent</span>(data<span class="op">?.</span><span class="at">ac_pov_perc</span>))<span class="op">,</span></span>
<span id="cb136-3785"><a href="#cb136-3785" aria-hidden="true" tabindex="-1"></a>      }<span class="op">,</span></span>
<span id="cb136-3786"><a href="#cb136-3786" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb136-3787"><a href="#cb136-3787" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb136-3788"><a href="#cb136-3788" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3789"><a href="#cb136-3789" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`</span><span class="sc">${</span>madLib<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb136-3790"><a href="#cb136-3790" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb136-3791"><a href="#cb136-3791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3792"><a href="#cb136-3792" aria-hidden="true" tabindex="-1"></a><span class="co">// // define the mad lib for adaptive capacity admin1 and admin 0 levels</span></span>
<span id="cb136-3793"><a href="#cb136-3793" aria-hidden="true" tabindex="-1"></a><span class="co">// function adaptiveCapacityInsightMadLib(data, adminName) {</span></span>
<span id="cb136-3794"><a href="#cb136-3794" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-3795"><a href="#cb136-3795" aria-hidden="true" tabindex="-1"></a><span class="co">//   return `In **${adminName}**, the education index is **${formatPercentNoSymbol(transformPercent(data?.ac_edu_perc))}**, the female empowerment index is **${formatPercentNoSymbol(transformPercent(data?.ac_fem_perc))}**, and the poverty index is **${formatPercentNoSymbol(transformPercent(data?.ac_pov_perc))}**.`</span></span>
<span id="cb136-3796"><a href="#cb136-3796" aria-hidden="true" tabindex="-1"></a><span class="co">// }</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-136" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb137" data-startfrom="3800" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3799"><span id="cb137-3800"><a href="#cb137-3800" aria-hidden="true" tabindex="-1"></a><span class="co">// define the mad lib for adaptive capacity admin1 and admin 0 levels</span></span>
<span id="cb137-3801"><a href="#cb137-3801" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">adaptiveCapacityInsightMadLib2</span>(data<span class="op">,</span> adminName) {</span>
<span id="cb137-3802"><a href="#cb137-3802" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> education_years <span class="op">=</span> data<span class="op">?.</span><span class="at">ac_edu_perc</span><span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb137-3803"><a href="#cb137-3803" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> female_empowerment <span class="op">=</span> (data<span class="op">?.</span><span class="at">ac_fem_perc</span> <span class="op">*</span> <span class="dv">100</span>)<span class="op">.</span><span class="fu">toFixed</span>(<span class="dv">0</span>)<span class="op">;</span> <span class="co">//formatPercentWhole(data?.ac_fem_perc)</span></span>
<span id="cb137-3804"><a href="#cb137-3804" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> poverty_rate <span class="op">=</span> <span class="fu">formatPercentWhole</span>(data<span class="op">?.</span><span class="at">ac_pov_perc</span>)<span class="op">;</span></span>
<span id="cb137-3805"><a href="#cb137-3805" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3806"><a href="#cb137-3806" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="vs">`In **</span><span class="sc">${</span>adminName<span class="sc">}</span><span class="vs">**, the average educational attainment is **</span><span class="sc">${</span>education_years<span class="sc">}</span><span class="vs">** years, the female empowerment index is **</span><span class="sc">${</span>female_empowerment<span class="sc">}</span><span class="vs">**, and **</span><span class="sc">${</span>poverty_rate<span class="sc">}</span><span class="vs">** live in poverty.`</span><span class="op">;</span></span>
<span id="cb137-3807"><a href="#cb137-3807" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-137" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb138" data-startfrom="3811" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3810"><span id="cb138-3811"><a href="#cb138-3811" aria-hidden="true" tabindex="-1"></a>textDynamicInsights_adaptiveCapacities1 <span class="op">=</span> {</span>
<span id="cb138-3812"><a href="#cb138-3812" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return md`TODO: based on icicle data`</span></span>
<span id="cb138-3813"><a href="#cb138-3813" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3814"><a href="#cb138-3814" aria-hidden="true" tabindex="-1"></a>  <span class="co">// dynamic insight based on selected region</span></span>
<span id="cb138-3815"><a href="#cb138-3815" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3816"><a href="#cb138-3816" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin2 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb138-3817"><a href="#cb138-3817" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin2MadLib <span class="op">=</span> <span class="fu">adaptiveCapacityInsightMadLib</span>(</span>
<span id="cb138-3818"><a href="#cb138-3818" aria-hidden="true" tabindex="-1"></a>    dynamicInsights_adaptiveCapacity<span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">admin2</span><span class="op">,</span></span>
<span id="cb138-3819"><a href="#cb138-3819" aria-hidden="true" tabindex="-1"></a>    admin2</span>
<span id="cb138-3820"><a href="#cb138-3820" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb138-3821"><a href="#cb138-3821" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin1 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb138-3822"><a href="#cb138-3822" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin1MadLib <span class="op">=</span> <span class="fu">adaptiveCapacityInsightMadLib</span>(</span>
<span id="cb138-3823"><a href="#cb138-3823" aria-hidden="true" tabindex="-1"></a>    dynamicInsights_adaptiveCapacity<span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">admin1</span><span class="op">,</span></span>
<span id="cb138-3824"><a href="#cb138-3824" aria-hidden="true" tabindex="-1"></a>    admin1</span>
<span id="cb138-3825"><a href="#cb138-3825" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb138-3826"><a href="#cb138-3826" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">label</span> <span class="op">??</span> globalSelection<span class="op">.</span><span class="at">label</span><span class="op">;</span></span>
<span id="cb138-3827"><a href="#cb138-3827" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0Insights <span class="op">=</span> dynamicInsights_adaptiveCapacity<span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">admin0</span><span class="op">;</span></span>
<span id="cb138-3828"><a href="#cb138-3828" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0MadLib <span class="op">=</span> <span class="fu">adaptiveCapacityInsightMadLib</span>(</span>
<span id="cb138-3829"><a href="#cb138-3829" aria-hidden="true" tabindex="-1"></a>    admin0Insights<span class="op">,</span></span>
<span id="cb138-3830"><a href="#cb138-3830" aria-hidden="true" tabindex="-1"></a>    admin0</span>
<span id="cb138-3831"><a href="#cb138-3831" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb138-3832"><a href="#cb138-3832" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3833"><a href="#cb138-3833" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langWithinAdmin1 <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb138-3834"><a href="#cb138-3834" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">nestedLocationBlurb</span>)<span class="op">,</span></span>
<span id="cb138-3835"><a href="#cb138-3835" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb138-3836"><a href="#cb138-3836" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_inner"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> admin2 }<span class="op">,</span></span>
<span id="cb138-3837"><a href="#cb138-3837" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_outer"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> admin1 }</span>
<span id="cb138-3838"><a href="#cb138-3838" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb138-3839"><a href="#cb138-3839" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb138-3840"><a href="#cb138-3840" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> withinAdmin1 <span class="op">=</span> admin2</span>
<span id="cb138-3841"><a href="#cb138-3841" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>langWithinAdmin1<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb138-3842"><a href="#cb138-3842" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="vs">``</span><span class="op">;</span></span>
<span id="cb138-3843"><a href="#cb138-3843" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3844"><a href="#cb138-3844" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> langWithinAdmin0 <span class="op">=</span> Lang<span class="op">.</span><span class="fu">reduceReplaceTemplateItems</span>(</span>
<span id="cb138-3845"><a href="#cb138-3845" aria-hidden="true" tabindex="-1"></a>    <span class="fu">_lang</span>(nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">insights</span><span class="op">.</span><span class="at">nestedLocationBlurb</span>)<span class="op">,</span></span>
<span id="cb138-3846"><a href="#cb138-3846" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb138-3847"><a href="#cb138-3847" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_inner"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> admin1 }<span class="op">,</span></span>
<span id="cb138-3848"><a href="#cb138-3848" aria-hidden="true" tabindex="-1"></a>      { <span class="dt">name</span><span class="op">:</span> <span class="st">"admin_outer"</span><span class="op">,</span> <span class="dt">value</span><span class="op">:</span> admin0 }</span>
<span id="cb138-3849"><a href="#cb138-3849" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb138-3850"><a href="#cb138-3850" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb138-3851"><a href="#cb138-3851" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> withinAdmin0 <span class="op">=</span> admin1</span>
<span id="cb138-3852"><a href="#cb138-3852" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> <span class="vs">`</span><span class="sc">${</span>langWithinAdmin0<span class="sc">}</span><span class="vs">`</span></span>
<span id="cb138-3853"><a href="#cb138-3853" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> <span class="vs">``</span><span class="op">;</span></span>
<span id="cb138-3854"><a href="#cb138-3854" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3855"><a href="#cb138-3855" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Text sections ------------------------------</span></span>
<span id="cb138-3856"><a href="#cb138-3856" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin2Text <span class="op">=</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>admin2MadLib<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb138-3857"><a href="#cb138-3857" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3858"><a href="#cb138-3858" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin1Text <span class="op">=</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>withinAdmin1<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>admin1MadLib<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb138-3859"><a href="#cb138-3859" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3860"><a href="#cb138-3860" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0Text <span class="op">=</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>withinAdmin0<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>admin0MadLib<span class="sc">}</span><span class="vs">`</span><span class="op">;</span></span>
<span id="cb138-3861"><a href="#cb138-3861" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3862"><a href="#cb138-3862" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Final text ------------------------------</span></span>
<span id="cb138-3863"><a href="#cb138-3863" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">md</span><span class="vs">`</span></span>
<span id="cb138-3864"><a href="#cb138-3864" aria-hidden="true" tabindex="-1"></a><span class="vs">#### Old Insight:</span></span>
<span id="cb138-3865"><a href="#cb138-3865" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>admin2 <span class="op">?</span> admin2Text <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb138-3866"><a href="#cb138-3866" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>admin1 <span class="op">?</span> admin1Text <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb138-3867"><a href="#cb138-3867" aria-hidden="true" tabindex="-1"></a><span class="sc">${</span>admin0Insights <span class="op">?</span> admin0Text <span class="op">:</span> <span class="st">""</span><span class="sc">}</span></span>
<span id="cb138-3868"><a href="#cb138-3868" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">;</span></span>
<span id="cb138-3869"><a href="#cb138-3869" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-138" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb139" data-startfrom="3873" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3872"><span id="cb139-3873"><a href="#cb139-3873" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb139-3874"><a href="#cb139-3874" aria-hidden="true" tabindex="-1"></a><span class="vs">### Adaptive Capacity Icicle - Adaptive Capacities</span></span>
<span id="cb139-3875"><a href="#cb139-3875" aria-hidden="true" tabindex="-1"></a><span class="vs">Note: data uses SSA for combined admin region (see icicle_csv)`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-139" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb140" data-startfrom="3879" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3878"><span id="cb140-3879"><a href="#cb140-3879" aria-hidden="true" tabindex="-1"></a>icicle_raw <span class="op">=</span> {</span>
<span id="cb140-3880"><a href="#cb140-3880" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> country <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> <span class="st">"SSA"</span><span class="op">;</span></span>
<span id="cb140-3881"><a href="#cb140-3881" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin1 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb140-3882"><a href="#cb140-3882" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin2 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span> <span class="op">||</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb140-3883"><a href="#cb140-3883" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb140-3884"><a href="#cb140-3884" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> adminQuery <span class="op">=</span> <span class="vs">`WHERE admin0_name = '</span><span class="sc">${</span>country<span class="sc">}</span><span class="vs">' AND admin1_name`</span></span>
<span id="cb140-3885"><a href="#cb140-3885" aria-hidden="true" tabindex="-1"></a>  adminQuery <span class="op">+=</span> <span class="op">!</span>admin1 <span class="op">?</span> <span class="vs">` IS NULL`</span> <span class="op">:</span> <span class="vs">` = '</span><span class="sc">${</span><span class="fu">cleanAdminInput_SQL</span>(admin1)<span class="sc">}</span><span class="vs">'`</span></span>
<span id="cb140-3886"><a href="#cb140-3886" aria-hidden="true" tabindex="-1"></a>  adminQuery <span class="op">+=</span> <span class="vs">` AND admin2_name`</span></span>
<span id="cb140-3887"><a href="#cb140-3887" aria-hidden="true" tabindex="-1"></a>  adminQuery <span class="op">+=</span> <span class="op">!</span>admin2 <span class="op">?</span> <span class="vs">` IS NULL`</span> <span class="op">:</span> <span class="vs">` = '</span><span class="sc">${</span><span class="fu">cleanAdminInput_SQL</span>(admin2)<span class="sc">}</span><span class="vs">'`</span></span>
<span id="cb140-3888"><a href="#cb140-3888" aria-hidden="true" tabindex="-1"></a>  <span class="co">// let adminQuery = `WHERE admin0_name = 'Angola' AND admin1_name IS NULL`</span></span>
<span id="cb140-3889"><a href="#cb140-3889" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return adminQuery</span></span>
<span id="cb140-3890"><a href="#cb140-3890" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`SELECT path, value FROM icicle_data </span><span class="sc">${</span>adminQuery<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb140-3891"><a href="#cb140-3891" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-140" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb141" data-startfrom="3895" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3894"><span id="cb141-3895"><a href="#cb141-3895" aria-hidden="true" tabindex="-1"></a>icicle_data <span class="op">=</span> <span class="fu">buildHierarchy</span>(icicle_raw)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-141" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb142" data-startfrom="3899" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3898"><span id="cb142-3899"><a href="#cb142-3899" aria-hidden="true" tabindex="-1"></a>icicle_keys <span class="op">=</span> <span class="kw">new</span> <span class="bu">Object</span>({</span>
<span id="cb142-3900"><a href="#cb142-3900" aria-hidden="true" tabindex="-1"></a>  <span class="dt">poverty</span><span class="op">:</span> {</span>
<span id="cb142-3901"><a href="#cb142-3901" aria-hidden="true" tabindex="-1"></a>    <span class="dt">poverty0</span><span class="op">:</span> [<span class="st">"Low Poverty"</span>]<span class="op">,</span></span>
<span id="cb142-3902"><a href="#cb142-3902" aria-hidden="true" tabindex="-1"></a>    <span class="dt">poverty1</span><span class="op">:</span> [<span class="st">"Moderate Poverty"</span>]<span class="op">,</span></span>
<span id="cb142-3903"><a href="#cb142-3903" aria-hidden="true" tabindex="-1"></a>    <span class="dt">poverty1</span><span class="op">:</span> [<span class="st">"High Poverty"</span>]<span class="op">,</span></span>
<span id="cb142-3904"><a href="#cb142-3904" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb142-3905"><a href="#cb142-3905" aria-hidden="true" tabindex="-1"></a>  <span class="dt">education</span><span class="op">:</span> {</span>
<span id="cb142-3906"><a href="#cb142-3906" aria-hidden="true" tabindex="-1"></a>    <span class="dt">education0</span><span class="op">:</span> [<span class="st">"0-1 Years of Education"</span>]<span class="op">,</span></span>
<span id="cb142-3907"><a href="#cb142-3907" aria-hidden="true" tabindex="-1"></a>    <span class="dt">education1</span><span class="op">:</span> [<span class="st">"1-5 Years of Education"</span>]<span class="op">,</span></span>
<span id="cb142-3908"><a href="#cb142-3908" aria-hidden="true" tabindex="-1"></a>    <span class="dt">education3</span><span class="op">:</span> [<span class="st">"5+ Years of Education"</span>]<span class="op">,</span></span>
<span id="cb142-3909"><a href="#cb142-3909" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb142-3910"><a href="#cb142-3910" aria-hidden="true" tabindex="-1"></a>  <span class="dt">gender</span><span class="op">:</span> {</span>
<span id="cb142-3911"><a href="#cb142-3911" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gender0</span><span class="op">:</span> [<span class="st">"Low Female Empowerment"</span>]<span class="op">,</span></span>
<span id="cb142-3912"><a href="#cb142-3912" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gender1</span><span class="op">:</span> [<span class="st">"Moderate Female Empowerment"</span>]<span class="op">,</span></span>
<span id="cb142-3913"><a href="#cb142-3913" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gender2</span><span class="op">:</span> [<span class="st">"High Female Empowerment"</span>]<span class="op">,</span></span>
<span id="cb142-3914"><a href="#cb142-3914" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb142-3915"><a href="#cb142-3915" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-142" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb143" data-startfrom="3919" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3918"><span id="cb143-3919"><a href="#cb143-3919" aria-hidden="true" tabindex="-1"></a>icicle_alias <span class="op">=</span> {</span>
<span id="cb143-3920"><a href="#cb143-3920" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> base <span class="op">=</span> nbText<span class="op">.</span><span class="at">adaptiveCapacities</span><span class="op">.</span><span class="at">delvingDeeper</span><span class="op">.</span><span class="at">plot</span><span class="op">.</span><span class="at">nameMap</span></span>
<span id="cb143-3921"><a href="#cb143-3921" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> nameMap <span class="op">=</span> {</span>
<span id="cb143-3922"><a href="#cb143-3922" aria-hidden="true" tabindex="-1"></a>    <span class="dt">population</span><span class="op">:</span> <span class="fu">_lang</span>(base<span class="op">.</span><span class="at">population</span>)<span class="op">,</span></span>
<span id="cb143-3923"><a href="#cb143-3923" aria-hidden="true" tabindex="-1"></a>    <span class="dt">poverty0</span><span class="op">:</span> <span class="fu">_lang</span>(base<span class="op">.</span><span class="at">poverty0</span>)<span class="op">,</span></span>
<span id="cb143-3924"><a href="#cb143-3924" aria-hidden="true" tabindex="-1"></a>    <span class="dt">poverty1</span><span class="op">:</span> <span class="fu">_lang</span>(base<span class="op">.</span><span class="at">poverty1</span>)<span class="op">,</span></span>
<span id="cb143-3925"><a href="#cb143-3925" aria-hidden="true" tabindex="-1"></a>    <span class="dt">poverty2</span><span class="op">:</span> <span class="fu">_lang</span>(base<span class="op">.</span><span class="at">poverty2</span>)<span class="op">,</span></span>
<span id="cb143-3926"><a href="#cb143-3926" aria-hidden="true" tabindex="-1"></a>    <span class="dt">education0</span><span class="op">:</span> <span class="fu">_lang</span>(base<span class="op">.</span><span class="at">education0</span>)<span class="op">,</span></span>
<span id="cb143-3927"><a href="#cb143-3927" aria-hidden="true" tabindex="-1"></a>    <span class="dt">education1</span><span class="op">:</span> <span class="fu">_lang</span>(base<span class="op">.</span><span class="at">education1</span>)<span class="op">,</span></span>
<span id="cb143-3928"><a href="#cb143-3928" aria-hidden="true" tabindex="-1"></a>    <span class="dt">education2</span><span class="op">:</span> <span class="fu">_lang</span>(base<span class="op">.</span><span class="at">education2</span>)<span class="op">,</span></span>
<span id="cb143-3929"><a href="#cb143-3929" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gender0</span><span class="op">:</span> <span class="fu">_lang</span>(base<span class="op">.</span><span class="at">gender0</span>)<span class="op">,</span></span>
<span id="cb143-3930"><a href="#cb143-3930" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gender1</span><span class="op">:</span> <span class="fu">_lang</span>(base<span class="op">.</span><span class="at">gender1</span>)<span class="op">,</span></span>
<span id="cb143-3931"><a href="#cb143-3931" aria-hidden="true" tabindex="-1"></a>    <span class="dt">gender2</span><span class="op">:</span> <span class="fu">_lang</span>(base<span class="op">.</span><span class="at">gender2</span>)</span>
<span id="cb143-3932"><a href="#cb143-3932" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb143-3933"><a href="#cb143-3933" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> nameMap<span class="op">;</span></span>
<span id="cb143-3934"><a href="#cb143-3934" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-143" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb144" data-startfrom="3938" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3937"><span id="cb144-3938"><a href="#cb144-3938" aria-hidden="true" tabindex="-1"></a>partition <span class="op">=</span> (data) <span class="kw">=&gt;</span></span>
<span id="cb144-3939"><a href="#cb144-3939" aria-hidden="true" tabindex="-1"></a>  d3</span>
<span id="cb144-3940"><a href="#cb144-3940" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">partition</span>()</span>
<span id="cb144-3941"><a href="#cb144-3941" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">padding</span>(<span class="dv">1</span>)</span>
<span id="cb144-3942"><a href="#cb144-3942" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">size</span>(narrow <span class="op">?</span> [height<span class="op">,</span> width] <span class="op">:</span> [width<span class="op">,</span> height])(</span>
<span id="cb144-3943"><a href="#cb144-3943" aria-hidden="true" tabindex="-1"></a>    d3</span>
<span id="cb144-3944"><a href="#cb144-3944" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">hierarchy</span>(data)</span>
<span id="cb144-3945"><a href="#cb144-3945" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">sum</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">value</span>)</span>
<span id="cb144-3946"><a href="#cb144-3946" aria-hidden="true" tabindex="-1"></a>      <span class="op">.</span><span class="fu">sort</span>((a<span class="op">,</span> b) <span class="kw">=&gt;</span> b<span class="op">.</span><span class="at">value</span> <span class="op">-</span> a<span class="op">.</span><span class="at">value</span>)<span class="op">,</span></span>
<span id="cb144-3947"><a href="#cb144-3947" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-144" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb145" data-startfrom="3951" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3950"><span id="cb145-3951"><a href="#cb145-3951" aria-hidden="true" tabindex="-1"></a>icicle_color <span class="op">=</span> d3</span>
<span id="cb145-3952"><a href="#cb145-3952" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">scaleOrdinal</span>()</span>
<span id="cb145-3953"><a href="#cb145-3953" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">domain</span>([</span>
<span id="cb145-3954"><a href="#cb145-3954" aria-hidden="true" tabindex="-1"></a>    <span class="st">"population"</span><span class="op">,</span></span>
<span id="cb145-3955"><a href="#cb145-3955" aria-hidden="true" tabindex="-1"></a>    <span class="st">"poverty2"</span><span class="op">,</span></span>
<span id="cb145-3956"><a href="#cb145-3956" aria-hidden="true" tabindex="-1"></a>    <span class="st">"poverty1"</span><span class="op">,</span></span>
<span id="cb145-3957"><a href="#cb145-3957" aria-hidden="true" tabindex="-1"></a>    <span class="st">"poverty0"</span><span class="op">,</span></span>
<span id="cb145-3958"><a href="#cb145-3958" aria-hidden="true" tabindex="-1"></a>    <span class="st">"education2"</span><span class="op">,</span></span>
<span id="cb145-3959"><a href="#cb145-3959" aria-hidden="true" tabindex="-1"></a>    <span class="st">"education1"</span><span class="op">,</span></span>
<span id="cb145-3960"><a href="#cb145-3960" aria-hidden="true" tabindex="-1"></a>    <span class="st">"education0"</span><span class="op">,</span></span>
<span id="cb145-3961"><a href="#cb145-3961" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gender2"</span><span class="op">,</span></span>
<span id="cb145-3962"><a href="#cb145-3962" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gender1"</span><span class="op">,</span></span>
<span id="cb145-3963"><a href="#cb145-3963" aria-hidden="true" tabindex="-1"></a>    <span class="st">"gender0"</span><span class="op">,</span></span>
<span id="cb145-3964"><a href="#cb145-3964" aria-hidden="true" tabindex="-1"></a>  ])</span>
<span id="cb145-3965"><a href="#cb145-3965" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">range</span>([</span>
<span id="cb145-3966"><a href="#cb145-3966" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#a4a4a4"</span><span class="op">,</span></span>
<span id="cb145-3967"><a href="#cb145-3967" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#ec5a47"</span><span class="op">,</span></span>
<span id="cb145-3968"><a href="#cb145-3968" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#fc8a34"</span><span class="op">,</span></span>
<span id="cb145-3969"><a href="#cb145-3969" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#f4bb21"</span><span class="op">,</span></span>
<span id="cb145-3970"><a href="#cb145-3970" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#f4bb21"</span><span class="op">,</span></span>
<span id="cb145-3971"><a href="#cb145-3971" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#fc8a34"</span><span class="op">,</span></span>
<span id="cb145-3972"><a href="#cb145-3972" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#ec5a47"</span><span class="op">,</span></span>
<span id="cb145-3973"><a href="#cb145-3973" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#f4bb21"</span><span class="op">,</span></span>
<span id="cb145-3974"><a href="#cb145-3974" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#fc8a34"</span><span class="op">,</span></span>
<span id="cb145-3975"><a href="#cb145-3975" aria-hidden="true" tabindex="-1"></a>    <span class="st">"#ec5a47"</span><span class="op">,</span></span>
<span id="cb145-3976"><a href="#cb145-3976" aria-hidden="true" tabindex="-1"></a>  ])<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-145" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb146" data-startfrom="3980" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3979"><span id="cb146-3980"><a href="#cb146-3980" aria-hidden="true" tabindex="-1"></a>targetHeight <span class="op">=</span> <span class="dv">350</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-146" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb147" data-startfrom="3984" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3983"><span id="cb147-3984"><a href="#cb147-3984" aria-hidden="true" tabindex="-1"></a>narrowHeight <span class="op">=</span> <span class="dv">600</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-147" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb148" data-startfrom="3988" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3987"><span id="cb148-3988"><a href="#cb148-3988" aria-hidden="true" tabindex="-1"></a>height <span class="op">=</span> narrow <span class="op">?</span> narrowHeight <span class="op">:</span> targetHeight<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-148" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb149" data-startfrom="3992" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3991"><span id="cb149-3992"><a href="#cb149-3992" aria-hidden="true" tabindex="-1"></a>narrow <span class="op">=</span> width <span class="op">&lt;=</span> <span class="dv">0</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-149" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb150" data-startfrom="3996" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3995"><span id="cb150-3996"><a href="#cb150-3996" aria-hidden="true" tabindex="-1"></a>segmentX <span class="op">=</span> (d) <span class="kw">=&gt;</span> (narrow <span class="op">?</span> d<span class="op">.</span><span class="at">y0</span> <span class="op">:</span> d<span class="op">.</span><span class="at">x0</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-150" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb151" data-startfrom="4000" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 3999"><span id="cb151-4000"><a href="#cb151-4000" aria-hidden="true" tabindex="-1"></a>segmentY <span class="op">=</span> (d) <span class="kw">=&gt;</span> (narrow <span class="op">?</span> d<span class="op">.</span><span class="at">x0</span> <span class="op">:</span> d<span class="op">.</span><span class="at">y0</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-151" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb152" data-startfrom="4004" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4003"><span id="cb152-4004"><a href="#cb152-4004" aria-hidden="true" tabindex="-1"></a>segmentWidth <span class="op">=</span> (d) <span class="kw">=&gt;</span> (narrow <span class="op">?</span> d<span class="op">.</span><span class="at">y1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">y0</span> <span class="op">:</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">x0</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-152" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb153" data-startfrom="4008" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4007"><span id="cb153-4008"><a href="#cb153-4008" aria-hidden="true" tabindex="-1"></a>segmentHeight <span class="op">=</span> (d) <span class="kw">=&gt;</span> (narrow <span class="op">?</span> d<span class="op">.</span><span class="at">x1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">x0</span> <span class="op">:</span> d<span class="op">.</span><span class="at">y1</span> <span class="op">-</span> d<span class="op">.</span><span class="at">y0</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-153" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb154" data-startfrom="4012" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4011"><span id="cb154-4012"><a href="#cb154-4012" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">buildHierarchy</span>(csv) {</span>
<span id="cb154-4013"><a href="#cb154-4013" aria-hidden="true" tabindex="-1"></a>  <span class="co">// Helper function that transforms the given CSV into a hierarchical format.</span></span>
<span id="cb154-4014"><a href="#cb154-4014" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> <span class="bu">root</span> <span class="op">=</span> { <span class="dt">name</span><span class="op">:</span> <span class="st">"root"</span><span class="op">,</span> <span class="dt">children</span><span class="op">:</span> [] }<span class="op">;</span></span>
<span id="cb154-4015"><a href="#cb154-4015" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> csv<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb154-4016"><a href="#cb154-4016" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> sequence <span class="op">=</span> csv[i][<span class="st">"path"</span>]<span class="op">;</span></span>
<span id="cb154-4017"><a href="#cb154-4017" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> size <span class="op">=</span> <span class="op">+</span>csv[i][<span class="st">"value"</span>]<span class="op">;</span></span>
<span id="cb154-4018"><a href="#cb154-4018" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="pp">isNaN</span>(size)) {</span>
<span id="cb154-4019"><a href="#cb154-4019" aria-hidden="true" tabindex="-1"></a>      <span class="co">// e.g. if this is a header row</span></span>
<span id="cb154-4020"><a href="#cb154-4020" aria-hidden="true" tabindex="-1"></a>      <span class="cf">continue</span><span class="op">;</span></span>
<span id="cb154-4021"><a href="#cb154-4021" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb154-4022"><a href="#cb154-4022" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> parts <span class="op">=</span> sequence<span class="op">.</span><span class="fu">split</span>(<span class="st">"_"</span>)<span class="op">;</span></span>
<span id="cb154-4023"><a href="#cb154-4023" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> currentNode <span class="op">=</span> <span class="bu">root</span><span class="op">;</span></span>
<span id="cb154-4024"><a href="#cb154-4024" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> parts<span class="op">.</span><span class="at">length</span><span class="op">;</span> j<span class="op">++</span>) {</span>
<span id="cb154-4025"><a href="#cb154-4025" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> children <span class="op">=</span> currentNode[<span class="st">"children"</span>]<span class="op">;</span></span>
<span id="cb154-4026"><a href="#cb154-4026" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> nodeName <span class="op">=</span> parts[j]<span class="op">;</span></span>
<span id="cb154-4027"><a href="#cb154-4027" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> childNode <span class="op">=</span> <span class="kw">null</span><span class="op">;</span></span>
<span id="cb154-4028"><a href="#cb154-4028" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> foundChild <span class="op">=</span> <span class="kw">false</span><span class="op">;</span></span>
<span id="cb154-4029"><a href="#cb154-4029" aria-hidden="true" tabindex="-1"></a>      <span class="co">// Search for existing child with the same name</span></span>
<span id="cb154-4030"><a href="#cb154-4030" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (<span class="kw">let</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> children<span class="op">.</span><span class="at">length</span><span class="op">;</span> k<span class="op">++</span>) {</span>
<span id="cb154-4031"><a href="#cb154-4031" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (children[k][<span class="st">"name"</span>] <span class="op">===</span> nodeName) {</span>
<span id="cb154-4032"><a href="#cb154-4032" aria-hidden="true" tabindex="-1"></a>          childNode <span class="op">=</span> children[k]<span class="op">;</span></span>
<span id="cb154-4033"><a href="#cb154-4033" aria-hidden="true" tabindex="-1"></a>          foundChild <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb154-4034"><a href="#cb154-4034" aria-hidden="true" tabindex="-1"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb154-4035"><a href="#cb154-4035" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb154-4036"><a href="#cb154-4036" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb154-4037"><a href="#cb154-4037" aria-hidden="true" tabindex="-1"></a>      <span class="co">// If not found, create a new child node</span></span>
<span id="cb154-4038"><a href="#cb154-4038" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="op">!</span>foundChild) {</span>
<span id="cb154-4039"><a href="#cb154-4039" aria-hidden="true" tabindex="-1"></a>        childNode <span class="op">=</span> { <span class="dt">name</span><span class="op">:</span> nodeName<span class="op">,</span> <span class="dt">children</span><span class="op">:</span> [] }<span class="op">;</span></span>
<span id="cb154-4040"><a href="#cb154-4040" aria-hidden="true" tabindex="-1"></a>        children<span class="op">.</span><span class="fu">push</span>(childNode)<span class="op">;</span></span>
<span id="cb154-4041"><a href="#cb154-4041" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb154-4042"><a href="#cb154-4042" aria-hidden="true" tabindex="-1"></a>      currentNode <span class="op">=</span> childNode<span class="op">;</span></span>
<span id="cb154-4043"><a href="#cb154-4043" aria-hidden="true" tabindex="-1"></a>      <span class="co">// If it's the last part of the sequence, create a leaf node</span></span>
<span id="cb154-4044"><a href="#cb154-4044" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (j <span class="op">===</span> parts<span class="op">.</span><span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>) {</span>
<span id="cb154-4045"><a href="#cb154-4045" aria-hidden="true" tabindex="-1"></a>        childNode<span class="op">.</span><span class="at">value</span> <span class="op">=</span> size<span class="op">;</span></span>
<span id="cb154-4046"><a href="#cb154-4046" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb154-4047"><a href="#cb154-4047" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb154-4048"><a href="#cb154-4048" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb154-4049"><a href="#cb154-4049" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="bu">root</span><span class="op">;</span></span>
<span id="cb154-4050"><a href="#cb154-4050" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-154" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb155" data-startfrom="4054" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4053"><span id="cb155-4054"><a href="#cb155-4054" aria-hidden="true" tabindex="-1"></a>breadcrumbWidth <span class="op">=</span> <span class="dv">200</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-155" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb156" data-startfrom="4058" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4057"><span id="cb156-4058"><a href="#cb156-4058" aria-hidden="true" tabindex="-1"></a>breadcrumbHeight <span class="op">=</span> <span class="dv">35</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-156" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb157" data-startfrom="4062" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4061"><span id="cb157-4062"><a href="#cb157-4062" aria-hidden="true" tabindex="-1"></a><span class="co">// Generate a string that describes the points of a breadcrumb SVG polygon.</span></span>
<span id="cb157-4063"><a href="#cb157-4063" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">breadcrumbPoints</span>(d<span class="op">,</span> i) {</span>
<span id="cb157-4064"><a href="#cb157-4064" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> tipWidth <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb157-4065"><a href="#cb157-4065" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> points <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb157-4066"><a href="#cb157-4066" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">push</span>(<span class="st">"0,0"</span>)<span class="op">;</span></span>
<span id="cb157-4067"><a href="#cb157-4067" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>breadcrumbWidth<span class="sc">}</span><span class="vs">,0`</span>)<span class="op">;</span></span>
<span id="cb157-4068"><a href="#cb157-4068" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>breadcrumbWidth <span class="op">+</span> tipWidth<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>breadcrumbHeight <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb157-4069"><a href="#cb157-4069" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>breadcrumbWidth<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>breadcrumbHeight<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb157-4070"><a href="#cb157-4070" aria-hidden="true" tabindex="-1"></a>  points<span class="op">.</span><span class="fu">push</span>(<span class="vs">`0,</span><span class="sc">${</span>breadcrumbHeight<span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb157-4071"><a href="#cb157-4071" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (i <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb157-4072"><a href="#cb157-4072" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Leftmost breadcrumb; don't include 6th vertex.</span></span>
<span id="cb157-4073"><a href="#cb157-4073" aria-hidden="true" tabindex="-1"></a>    points<span class="op">.</span><span class="fu">push</span>(<span class="vs">`</span><span class="sc">${</span>tipWidth<span class="sc">}</span><span class="vs">,</span><span class="sc">${</span>breadcrumbHeight <span class="op">/</span> <span class="dv">2</span><span class="sc">}</span><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb157-4074"><a href="#cb157-4074" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb157-4075"><a href="#cb157-4075" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> points<span class="op">.</span><span class="fu">join</span>(<span class="st">" "</span>)<span class="op">;</span></span>
<span id="cb157-4076"><a href="#cb157-4076" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-157" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb158" data-startfrom="4080" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4079"><span id="cb158-4080"><a href="#cb158-4080" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`This notebook reuses much of the 'buildHierarchy' function from the original [Sequences sunburst](https://gist.github.com/kerryrodden/7090426) gist, which was published with the following [license](https://gist.github.com/kerryrodden/7090426#file-license):</span></span>
<span id="cb158-4081"><a href="#cb158-4081" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb158-4082"><a href="#cb158-4082" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; Copyright 2013 Google Inc. All Rights Reserved.</span></span>
<span id="cb158-4083"><a href="#cb158-4083" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; </span></span>
<span id="cb158-4084"><a href="#cb158-4084" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; Licensed under the Apache License, Version 2.0 (the "License");</span></span>
<span id="cb158-4085"><a href="#cb158-4085" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; you may not use this file except in compliance with the License.</span></span>
<span id="cb158-4086"><a href="#cb158-4086" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; You may obtain a copy of the License at</span></span>
<span id="cb158-4087"><a href="#cb158-4087" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; </span></span>
<span id="cb158-4088"><a href="#cb158-4088" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt;    http://www.apache.org/licenses/LICENSE-2.0</span></span>
<span id="cb158-4089"><a href="#cb158-4089" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; </span></span>
<span id="cb158-4090"><a href="#cb158-4090" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; Unless required by applicable law or agreed to in writing, software</span></span>
<span id="cb158-4091"><a href="#cb158-4091" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; distributed under the License is distributed on an "AS IS" BASIS,</span></span>
<span id="cb158-4092"><a href="#cb158-4092" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span>
<span id="cb158-4093"><a href="#cb158-4093" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; See the License for the specific language governing permissions and</span></span>
<span id="cb158-4094"><a href="#cb158-4094" aria-hidden="true" tabindex="-1"></a><span class="vs">&gt; limitations under the License.`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-158" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb159" data-startfrom="4098" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4097"><span id="cb159-4098"><a href="#cb159-4098" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb159-4099"><a href="#cb159-4099" aria-hidden="true" tabindex="-1"></a><span class="vs">## Data</span></span>
<span id="cb159-4100"><a href="#cb159-4100" aria-hidden="true" tabindex="-1"></a><span class="vs">*Data sources*</span></span>
<span id="cb159-4101"><a href="#cb159-4101" aria-hidden="true" tabindex="-1"></a><span class="vs">- Data is from local files downloaded from S3, uploaded as a file attachments</span></span>
<span id="cb159-4102"><a href="#cb159-4102" aria-hidden="true" tabindex="-1"></a><span class="vs">- Data is then wrapped as a duckDB database table (separate tables for each parquet file)</span></span>
<span id="cb159-4103"><a href="#cb159-4103" aria-hidden="true" tabindex="-1"></a><span class="vs">- We are using some simplified data sources, suffixed with reduced.parquet in the S3 bucket`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-159" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb160" data-startfrom="4107" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4106"><span id="cb160-4107"><a href="#cb160-4107" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`### Tabular data</span></span>
<span id="cb160-4108"><a href="#cb160-4108" aria-hidden="true" tabindex="-1"></a><span class="vs">- **haz_risk_vop_int**: risk data showing effect hazards have on crops. Interactions are independent.</span></span>
<span id="cb160-4109"><a href="#cb160-4109" aria-hidden="true" tabindex="-1"></a><span class="vs">  - risk_prototype/data/hazard_risk_vop_ac/annual/haz_risk_vop_int_ac_reduced.parquet  </span></span>
<span id="cb160-4110"><a href="#cb160-4110" aria-hidden="true" tabindex="-1"></a><span class="vs">- **population**: population data by admin levels</span></span>
<span id="cb160-4111"><a href="#cb160-4111" aria-hidden="true" tabindex="-1"></a><span class="vs">  - population/population_long.parquet</span></span>
<span id="cb160-4112"><a href="#cb160-4112" aria-hidden="true" tabindex="-1"></a><span class="vs">- **vop_ha**: Value of Production (VoP) and hectare data (Ha) exposures by admin level. No hazards applied.</span></span>
<span id="cb160-4113"><a href="#cb160-4113" aria-hidden="true" tabindex="-1"></a><span class="vs">  - risk_prototype/data/exposure/exposure_adm_sum.parquet</span></span>
<span id="cb160-4114"><a href="#cb160-4114" aria-hidden="true" tabindex="-1"></a><span class="vs">- **vul_ac**: adaptive capacity data (update)</span></span>
<span id="cb160-4115"><a href="#cb160-4115" aria-hidden="true" tabindex="-1"></a><span class="vs">  - vulnerability/vulnerability_RawIndex_adminALL.parquet`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-160" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb161" data-startfrom="4119" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4118"><span id="cb161-4119"><a href="#cb161-4119" aria-hidden="true" tabindex="-1"></a>db <span class="op">=</span> {</span>
<span id="cb161-4120"><a href="#cb161-4120" aria-hidden="true" tabindex="-1"></a> <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"wait"</span><span class="op">;</span></span>
<span id="cb161-4121"><a href="#cb161-4121" aria-hidden="true" tabindex="-1"></a> <span class="kw">let</span> db <span class="op">=</span> <span class="cf">await</span> DuckDBClient<span class="op">.</span><span class="fu">of</span>({</span>
<span id="cb161-4122"><a href="#cb161-4122" aria-hidden="true" tabindex="-1"></a>    <span class="dt">haz_risk_vop_int</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"haz_risk_vop_int_gzip.parquet"</span>)<span class="op">,</span></span>
<span id="cb161-4123"><a href="#cb161-4123" aria-hidden="true" tabindex="-1"></a>    <span class="dt">population</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"population_long.parquet"</span>)<span class="op">,</span></span>
<span id="cb161-4124"><a href="#cb161-4124" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vop_ha</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"exposure_adm_sum_sorted.parquet"</span>)<span class="op">,</span></span>
<span id="cb161-4125"><a href="#cb161-4125" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vul_ac</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"vulnerability_RawIndex_adminALL.parquet"</span>)<span class="op">,</span></span>
<span id="cb161-4126"><a href="#cb161-4126" aria-hidden="true" tabindex="-1"></a>    <span class="dt">vul_ac2</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"AC_adminALL.parquet"</span>)<span class="op">,</span></span>
<span id="cb161-4127"><a href="#cb161-4127" aria-hidden="true" tabindex="-1"></a>    <span class="dt">icicle_data</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"All-adm_ssa_icicle_data_3class.parquet"</span>)</span>
<span id="cb161-4128"><a href="#cb161-4128" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb161-4129"><a href="#cb161-4129" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`CREATE TABLE vop AS SELECT * FROM vop_ha WHERE "exposure" = 'vop'`</span>)</span>
<span id="cb161-4130"><a href="#cb161-4130" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`CREATE TABLE ha AS SELECT * FROM vop_ha WHERE "exposure" = 'ha'`</span>)</span>
<span id="cb161-4131"><a href="#cb161-4131" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb161-4132"><a href="#cb161-4132" aria-hidden="true" tabindex="-1"></a><span class="vs">        CREATE TABLE vop_crop AS </span></span>
<span id="cb161-4133"><a href="#cb161-4133" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT * </span></span>
<span id="cb161-4134"><a href="#cb161-4134" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM vop_ha </span></span>
<span id="cb161-4135"><a href="#cb161-4135" aria-hidden="true" tabindex="-1"></a><span class="vs">        WHERE NOT (</span></span>
<span id="cb161-4136"><a href="#cb161-4136" aria-hidden="true" tabindex="-1"></a><span class="vs">          crop LIKE 'cattle</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4137"><a href="#cb161-4137" aria-hidden="true" tabindex="-1"></a><span class="vs">          OR crop LIKE 'goats</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4138"><a href="#cb161-4138" aria-hidden="true" tabindex="-1"></a><span class="vs">          OR crop LIKE 'pigs</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4139"><a href="#cb161-4139" aria-hidden="true" tabindex="-1"></a><span class="vs">          OR crop LIKE 'poultry</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4140"><a href="#cb161-4140" aria-hidden="true" tabindex="-1"></a><span class="vs">          OR crop LIKE 'sheep</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4141"><a href="#cb161-4141" aria-hidden="true" tabindex="-1"></a><span class="vs">        )</span></span>
<span id="cb161-4142"><a href="#cb161-4142" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND crop NOT LIKE 'total_%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4143"><a href="#cb161-4143" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND exposure = 'vop'`</span>)</span>
<span id="cb161-4144"><a href="#cb161-4144" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb161-4145"><a href="#cb161-4145" aria-hidden="true" tabindex="-1"></a><span class="vs">        CREATE TABLE vop_animal AS</span></span>
<span id="cb161-4146"><a href="#cb161-4146" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT *</span></span>
<span id="cb161-4147"><a href="#cb161-4147" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM vop_ha</span></span>
<span id="cb161-4148"><a href="#cb161-4148" aria-hidden="true" tabindex="-1"></a><span class="vs">        WHERE (</span></span>
<span id="cb161-4149"><a href="#cb161-4149" aria-hidden="true" tabindex="-1"></a><span class="vs">          crop LIKE 'cattle</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4150"><a href="#cb161-4150" aria-hidden="true" tabindex="-1"></a><span class="vs">          OR crop LIKE 'goats</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4151"><a href="#cb161-4151" aria-hidden="true" tabindex="-1"></a><span class="vs">          OR crop LIKE 'pigs</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4152"><a href="#cb161-4152" aria-hidden="true" tabindex="-1"></a><span class="vs">          OR crop LIKE 'poultry</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4153"><a href="#cb161-4153" aria-hidden="true" tabindex="-1"></a><span class="vs">          OR crop LIKE 'sheep</span><span class="sc">\_</span><span class="vs">%' ESCAPE '</span><span class="sc">\\</span><span class="vs">'</span></span>
<span id="cb161-4154"><a href="#cb161-4154" aria-hidden="true" tabindex="-1"></a><span class="vs">        )</span></span>
<span id="cb161-4155"><a href="#cb161-4155" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND crop NOT LIKE 'total_%' ESCAPE '</span><span class="sc">\\</span><span class="vs">' -- remove total lines</span></span>
<span id="cb161-4156"><a href="#cb161-4156" aria-hidden="true" tabindex="-1"></a><span class="vs">        AND exposure = 'vop'`</span>)</span>
<span id="cb161-4157"><a href="#cb161-4157" aria-hidden="true" tabindex="-1"></a>  <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"default"</span><span class="op">;</span></span>
<span id="cb161-4158"><a href="#cb161-4158" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> db</span>
<span id="cb161-4159"><a href="#cb161-4159" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-161" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb162" data-startfrom="4163" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4162"><span id="cb162-4163"><a href="#cb162-4163" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`### Geographic data</span></span>
<span id="cb162-4164"><a href="#cb162-4164" aria-hidden="true" tabindex="-1"></a><span class="vs">Geo files were converted to TopoJSON and reduced in complexity before uploading to the notebook, see [Simplify large spatial files](https://observablehq.com/d/258c68ee969e8ed5?collection=@periscopic/ab-atlas) notebook for method.</span></span>
<span id="cb162-4165"><a href="#cb162-4165" aria-hidden="true" tabindex="-1"></a><span class="vs">- **admin0**: broadest level, country boundaries</span></span>
<span id="cb162-4166"><a href="#cb162-4166" aria-hidden="true" tabindex="-1"></a><span class="vs">  - boundaries/atlas-region_admin0_harmonized.geojson</span></span>
<span id="cb162-4167"><a href="#cb162-4167" aria-hidden="true" tabindex="-1"></a><span class="vs">- **admin1**: one level down from admin0, regions within each admin0 region</span></span>
<span id="cb162-4168"><a href="#cb162-4168" aria-hidden="true" tabindex="-1"></a><span class="vs">  - boundaries/atlas-region_admin1_harmonized.geojson</span></span>
<span id="cb162-4169"><a href="#cb162-4169" aria-hidden="true" tabindex="-1"></a><span class="vs">- **admin2**: lowest level, subregions of every admin1 region</span></span>
<span id="cb162-4170"><a href="#cb162-4170" aria-hidden="true" tabindex="-1"></a><span class="vs">  - boundaries/atlas-region_admin2_harmonized.geojson`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-162" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb163" data-startfrom="4174" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4173"><span id="cb163-4174"><a href="#cb163-4174" aria-hidden="true" tabindex="-1"></a>boundaries <span class="op">=</span> {</span>
<span id="cb163-4175"><a href="#cb163-4175" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> {</span>
<span id="cb163-4176"><a href="#cb163-4176" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin0</span><span class="op">:</span> admin0<span class="op">,</span></span>
<span id="cb163-4177"><a href="#cb163-4177" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin1</span><span class="op">:</span> <span class="cf">await</span> <span class="fu">get_admin1</span>()<span class="op">,</span></span>
<span id="cb163-4178"><a href="#cb163-4178" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin2</span><span class="op">:</span> <span class="cf">await</span> <span class="fu">get_admin2</span>()</span>
<span id="cb163-4179"><a href="#cb163-4179" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb163-4180"><a href="#cb163-4180" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-163" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb164" data-startfrom="4184" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4183"><span id="cb164-4184"><a href="#cb164-4184" aria-hidden="true" tabindex="-1"></a>geo_db <span class="op">=</span> {</span>
<span id="cb164-4185"><a href="#cb164-4185" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> db <span class="op">=</span> <span class="cf">await</span> DuckDBClient<span class="op">.</span><span class="fu">of</span>({</span>
<span id="cb164-4186"><a href="#cb164-4186" aria-hidden="true" tabindex="-1"></a>    <span class="co">// admin0_geom: FileAttachment("atlas-region_admin0_simplified.parquet"),</span></span>
<span id="cb164-4187"><a href="#cb164-4187" aria-hidden="true" tabindex="-1"></a>    <span class="dt">admin1_geom</span><span class="op">:</span> <span class="fu">FileAttachment</span>(<span class="st">"atlas-region_admin1_simplified.parquet"</span>)</span>
<span id="cb164-4188"><a href="#cb164-4188" aria-hidden="true" tabindex="-1"></a>  })<span class="op">;</span></span>
<span id="cb164-4189"><a href="#cb164-4189" aria-hidden="true" tabindex="-1"></a>  <span class="cf">await</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb164-4190"><a href="#cb164-4190" aria-hidden="true" tabindex="-1"></a><span class="vs">    CREATE VIEW admin2_geom AS</span></span>
<span id="cb164-4191"><a href="#cb164-4191" aria-hidden="true" tabindex="-1"></a><span class="vs">    SELECT *</span></span>
<span id="cb164-4192"><a href="#cb164-4192" aria-hidden="true" tabindex="-1"></a><span class="vs">    FROM read_parquet("</span><span class="sc">${</span><span class="fu">resolveWindowsCacheIssue</span>(</span>
<span id="cb164-4193"><a href="#cb164-4193" aria-hidden="true" tabindex="-1"></a>      <span class="st">"https://digital-atlas.s3.amazonaws.com/boundaries/atlas-region_admin2_simplified.parquet"</span></span>
<span id="cb164-4194"><a href="#cb164-4194" aria-hidden="true" tabindex="-1"></a>    )<span class="sc">}</span><span class="vs">")`</span>)<span class="op">;</span></span>
<span id="cb164-4195"><a href="#cb164-4195" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> db<span class="op">;</span></span>
<span id="cb164-4196"><a href="#cb164-4196" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-164" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb165" data-startfrom="4200" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4199"><span id="cb165-4200"><a href="#cb165-4200" aria-hidden="true" tabindex="-1"></a>partitioned_boundries <span class="op">=</span></span>
<span id="cb165-4201"><a href="#cb165-4201" aria-hidden="true" tabindex="-1"></a>  <span class="st">"https://digital-atlas.s3.amazonaws.com/boundaries/subnational-boundaries_simplified"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-165" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb166" data-startfrom="4205" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4204"><span id="cb166-4205"><a href="#cb166-4205" aria-hidden="true" tabindex="-1"></a>iso3_list <span class="op">=</span> <span class="kw">new</span> <span class="bu">Object</span>({</span>
<span id="cb166-4206"><a href="#cb166-4206" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Nigeria</span><span class="op">:</span> <span class="st">"NGA"</span><span class="op">,</span></span>
<span id="cb166-4207"><a href="#cb166-4207" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Sudan</span><span class="op">:</span> <span class="st">"SDN"</span><span class="op">,</span></span>
<span id="cb166-4208"><a href="#cb166-4208" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Cameroon</span><span class="op">:</span> <span class="st">"CMR"</span><span class="op">,</span></span>
<span id="cb166-4209"><a href="#cb166-4209" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Ethiopia</span><span class="op">:</span> <span class="st">"ETH"</span><span class="op">,</span></span>
<span id="cb166-4210"><a href="#cb166-4210" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Mauritania</span><span class="op">:</span> <span class="st">"MRT"</span><span class="op">,</span></span>
<span id="cb166-4211"><a href="#cb166-4211" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Cte dIvoire"</span><span class="op">:</span> <span class="st">"CIV"</span><span class="op">,</span></span>
<span id="cb166-4212"><a href="#cb166-4212" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Ghana</span><span class="op">:</span> <span class="st">"GHA"</span><span class="op">,</span></span>
<span id="cb166-4213"><a href="#cb166-4213" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Madagascar</span><span class="op">:</span> <span class="st">"MDG"</span><span class="op">,</span></span>
<span id="cb166-4214"><a href="#cb166-4214" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Djibouti</span><span class="op">:</span> <span class="st">"DJI"</span><span class="op">,</span></span>
<span id="cb166-4215"><a href="#cb166-4215" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Benin</span><span class="op">:</span> <span class="st">"BEN"</span><span class="op">,</span></span>
<span id="cb166-4216"><a href="#cb166-4216" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Equatorial Guinea"</span><span class="op">:</span> <span class="st">"GNQ"</span><span class="op">,</span></span>
<span id="cb166-4217"><a href="#cb166-4217" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Eritrea</span><span class="op">:</span> <span class="st">"ERI"</span><span class="op">,</span></span>
<span id="cb166-4218"><a href="#cb166-4218" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Tanzania</span><span class="op">:</span> <span class="st">"TZA"</span><span class="op">,</span></span>
<span id="cb166-4219"><a href="#cb166-4219" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Somalia</span><span class="op">:</span> <span class="st">"SOM"</span><span class="op">,</span></span>
<span id="cb166-4220"><a href="#cb166-4220" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Guinea-Bissau"</span><span class="op">:</span> <span class="st">"GNB"</span><span class="op">,</span></span>
<span id="cb166-4221"><a href="#cb166-4221" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Mali</span><span class="op">:</span> <span class="st">"MLI"</span><span class="op">,</span></span>
<span id="cb166-4222"><a href="#cb166-4222" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Central African Republic"</span><span class="op">:</span> <span class="st">"CAF"</span><span class="op">,</span></span>
<span id="cb166-4223"><a href="#cb166-4223" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Gambia</span><span class="op">:</span> <span class="st">"GMB"</span><span class="op">,</span></span>
<span id="cb166-4224"><a href="#cb166-4224" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Chad</span><span class="op">:</span> <span class="st">"TCD"</span><span class="op">,</span></span>
<span id="cb166-4225"><a href="#cb166-4225" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Kenya</span><span class="op">:</span> <span class="st">"KEN"</span><span class="op">,</span></span>
<span id="cb166-4226"><a href="#cb166-4226" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Congo - Kinshasa"</span><span class="op">:</span> <span class="st">"COD"</span><span class="op">,</span></span>
<span id="cb166-4227"><a href="#cb166-4227" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Angola</span><span class="op">:</span> <span class="st">"AGO"</span><span class="op">,</span></span>
<span id="cb166-4228"><a href="#cb166-4228" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Lesotho</span><span class="op">:</span> <span class="st">"LSO"</span><span class="op">,</span></span>
<span id="cb166-4229"><a href="#cb166-4229" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Guinea</span><span class="op">:</span> <span class="st">"GIN"</span><span class="op">,</span></span>
<span id="cb166-4230"><a href="#cb166-4230" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Liberia</span><span class="op">:</span> <span class="st">"LBR"</span><span class="op">,</span></span>
<span id="cb166-4231"><a href="#cb166-4231" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Burkina Faso"</span><span class="op">:</span> <span class="st">"BFA"</span><span class="op">,</span></span>
<span id="cb166-4232"><a href="#cb166-4232" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Congo - Brazzaville"</span><span class="op">:</span> <span class="st">"COG"</span><span class="op">,</span></span>
<span id="cb166-4233"><a href="#cb166-4233" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Burundi</span><span class="op">:</span> <span class="st">"BDI"</span><span class="op">,</span></span>
<span id="cb166-4234"><a href="#cb166-4234" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Zimbabwe</span><span class="op">:</span> <span class="st">"ZWE"</span><span class="op">,</span></span>
<span id="cb166-4235"><a href="#cb166-4235" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Mozambique</span><span class="op">:</span> <span class="st">"MOZ"</span><span class="op">,</span></span>
<span id="cb166-4236"><a href="#cb166-4236" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Botswana</span><span class="op">:</span> <span class="st">"BWA"</span><span class="op">,</span></span>
<span id="cb166-4237"><a href="#cb166-4237" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Malawi</span><span class="op">:</span> <span class="st">"MWI"</span><span class="op">,</span></span>
<span id="cb166-4238"><a href="#cb166-4238" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Uganda</span><span class="op">:</span> <span class="st">"UGA"</span><span class="op">,</span></span>
<span id="cb166-4239"><a href="#cb166-4239" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Zambia</span><span class="op">:</span> <span class="st">"ZMB"</span><span class="op">,</span></span>
<span id="cb166-4240"><a href="#cb166-4240" aria-hidden="true" tabindex="-1"></a>  <span class="st">"South Sudan"</span><span class="op">:</span> <span class="st">"SSD"</span><span class="op">,</span></span>
<span id="cb166-4241"><a href="#cb166-4241" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Togo</span><span class="op">:</span> <span class="st">"TGO"</span><span class="op">,</span></span>
<span id="cb166-4242"><a href="#cb166-4242" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Senegal</span><span class="op">:</span> <span class="st">"SEN"</span><span class="op">,</span></span>
<span id="cb166-4243"><a href="#cb166-4243" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Niger</span><span class="op">:</span> <span class="st">"NER"</span><span class="op">,</span></span>
<span id="cb166-4244"><a href="#cb166-4244" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Sierra Leone"</span><span class="op">:</span> <span class="st">"SLE"</span><span class="op">,</span></span>
<span id="cb166-4245"><a href="#cb166-4245" aria-hidden="true" tabindex="-1"></a>  <span class="st">"South Africa"</span><span class="op">:</span> <span class="st">"ZAF"</span><span class="op">,</span></span>
<span id="cb166-4246"><a href="#cb166-4246" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Rwanda</span><span class="op">:</span> <span class="st">"RWA"</span><span class="op">,</span></span>
<span id="cb166-4247"><a href="#cb166-4247" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Namibia</span><span class="op">:</span> <span class="st">"NAM"</span><span class="op">,</span></span>
<span id="cb166-4248"><a href="#cb166-4248" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Gabon</span><span class="op">:</span> <span class="st">"GAB"</span><span class="op">,</span></span>
<span id="cb166-4249"><a href="#cb166-4249" aria-hidden="true" tabindex="-1"></a>  <span class="dt">Eswatini</span><span class="op">:</span> <span class="st">"SWZ"</span><span class="op">,</span></span>
<span id="cb166-4250"><a href="#cb166-4250" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-166" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb167" data-startfrom="4254" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4253"><span id="cb167-4254"><a href="#cb167-4254" aria-hidden="true" tabindex="-1"></a>admin_iso <span class="op">=</span> iso3_list[selectAdmin0<span class="op">.</span><span class="at">value</span>]<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-167" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb168" data-startfrom="4258" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4257"><span id="cb168-4258"><a href="#cb168-4258" aria-hidden="true" tabindex="-1"></a>admin0 <span class="op">=</span> {</span>
<span id="cb168-4259"><a href="#cb168-4259" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> admin0 <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"atlas-region_admin0_harmonized.json"</span>)<span class="op">.</span><span class="fu">json</span>()</span>
<span id="cb168-4260"><a href="#cb168-4260" aria-hidden="true" tabindex="-1"></a> <span class="cf">return</span> topojson<span class="op">.</span><span class="fu">feature</span>(admin0<span class="op">,</span> admin0<span class="op">.</span><span class="at">objects</span>[<span class="st">"atlas-region_admin0_harmonized"</span>])</span>
<span id="cb168-4261"><a href="#cb168-4261" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-168" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb169" data-startfrom="4265" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4264"><span id="cb169-4265"><a href="#cb169-4265" aria-hidden="true" tabindex="-1"></a>get_admin1 <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb169-4266"><a href="#cb169-4266" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> country <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb169-4267"><a href="#cb169-4267" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> admin1 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb169-4268"><a href="#cb169-4268" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (country) {</span>
<span id="cb169-4269"><a href="#cb169-4269" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"wait"</span><span class="op">;</span></span>
<span id="cb169-4270"><a href="#cb169-4270" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> admin1_query <span class="op">=</span> <span class="vs">`WHERE admin0_name = '</span><span class="sc">${</span>country<span class="sc">}</span><span class="vs">'`</span><span class="op">;</span></span>
<span id="cb169-4271"><a href="#cb169-4271" aria-hidden="true" tabindex="-1"></a>    <span class="co">// let response = await geo_db.query(`</span></span>
<span id="cb169-4272"><a href="#cb169-4272" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   SELECT *</span></span>
<span id="cb169-4273"><a href="#cb169-4273" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   FROM admin1_geom</span></span>
<span id="cb169-4274"><a href="#cb169-4274" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   ${admin1_query}`)</span></span>
<span id="cb169-4275"><a href="#cb169-4275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4276"><a href="#cb169-4276" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> response <span class="op">=</span> <span class="cf">await</span> geo_db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb169-4277"><a href="#cb169-4277" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT *</span></span>
<span id="cb169-4278"><a href="#cb169-4278" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM "</span><span class="sc">${</span><span class="fu">resolveWindowsCacheIssue</span>(</span>
<span id="cb169-4279"><a href="#cb169-4279" aria-hidden="true" tabindex="-1"></a>          partitioned_boundries <span class="op">+</span></span>
<span id="cb169-4280"><a href="#cb169-4280" aria-hidden="true" tabindex="-1"></a>            <span class="st">"/admin0="</span> <span class="op">+</span></span>
<span id="cb169-4281"><a href="#cb169-4281" aria-hidden="true" tabindex="-1"></a>            admin_iso <span class="op">+</span></span>
<span id="cb169-4282"><a href="#cb169-4282" aria-hidden="true" tabindex="-1"></a>            <span class="st">"/admin_level=1/"</span> <span class="op">+</span></span>
<span id="cb169-4283"><a href="#cb169-4283" aria-hidden="true" tabindex="-1"></a>            admin_iso <span class="op">+</span></span>
<span id="cb169-4284"><a href="#cb169-4284" aria-hidden="true" tabindex="-1"></a>            <span class="st">".parquet"</span><span class="op">,</span></span>
<span id="cb169-4285"><a href="#cb169-4285" aria-hidden="true" tabindex="-1"></a>        )<span class="sc">}</span><span class="vs">"</span></span>
<span id="cb169-4286"><a href="#cb169-4286" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span>)<span class="op">;</span></span>
<span id="cb169-4287"><a href="#cb169-4287" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> wkb_list <span class="op">=</span> response<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">geometry</span>)<span class="op">;</span></span>
<span id="cb169-4288"><a href="#cb169-4288" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">map</span>(({ geometry<span class="op">,</span> <span class="op">...</span>rest }) <span class="kw">=&gt;</span> rest)<span class="op">;</span></span>
<span id="cb169-4289"><a href="#cb169-4289" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> features <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb169-4290"><a href="#cb169-4290" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> wkb_list<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb169-4291"><a href="#cb169-4291" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> pointer <span class="op">=</span> GEOS<span class="op">.</span><span class="fu">geosGeomFromWKB</span>(wkb_list[i])<span class="op">;</span></span>
<span id="cb169-4292"><a href="#cb169-4292" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> geojson <span class="op">=</span> <span class="cf">await</span> GEOS<span class="op">.</span><span class="fu">geosGeomToGeojson</span>(pointer<span class="op">,</span> GEOS<span class="op">.</span><span class="at">geos</span>)<span class="op">;</span></span>
<span id="cb169-4293"><a href="#cb169-4293" aria-hidden="true" tabindex="-1"></a>      geojson <span class="op">=</span> <span class="fu">turfRewind</span>(geojson<span class="op">,</span> { <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb169-4294"><a href="#cb169-4294" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> feature <span class="op">=</span> {</span>
<span id="cb169-4295"><a href="#cb169-4295" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"Feature"</span><span class="op">,</span></span>
<span id="cb169-4296"><a href="#cb169-4296" aria-hidden="true" tabindex="-1"></a>        <span class="dt">geometry</span><span class="op">:</span> geojson<span class="op">,</span></span>
<span id="cb169-4297"><a href="#cb169-4297" aria-hidden="true" tabindex="-1"></a>        <span class="dt">properties</span><span class="op">:</span> data[i]<span class="op">,</span></span>
<span id="cb169-4298"><a href="#cb169-4298" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb169-4299"><a href="#cb169-4299" aria-hidden="true" tabindex="-1"></a>      features<span class="op">.</span><span class="fu">push</span>(feature)<span class="op">;</span></span>
<span id="cb169-4300"><a href="#cb169-4300" aria-hidden="true" tabindex="-1"></a>      GEOS<span class="op">.</span><span class="at">geos</span><span class="op">.</span><span class="fu">GEOSGeom_destroy</span>(pointer)<span class="op">;</span></span>
<span id="cb169-4301"><a href="#cb169-4301" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb169-4302"><a href="#cb169-4302" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> geojson <span class="op">=</span> {</span>
<span id="cb169-4303"><a href="#cb169-4303" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"FeatureCollection"</span><span class="op">,</span></span>
<span id="cb169-4304"><a href="#cb169-4304" aria-hidden="true" tabindex="-1"></a>      <span class="dt">features</span><span class="op">:</span> features<span class="op">,</span></span>
<span id="cb169-4305"><a href="#cb169-4305" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb169-4306"><a href="#cb169-4306" aria-hidden="true" tabindex="-1"></a>    <span class="co">// return { names: ["Full Country"].concat(a1_names), GEOJSON: geojson };</span></span>
<span id="cb169-4307"><a href="#cb169-4307" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"default"</span><span class="op">;</span></span>
<span id="cb169-4308"><a href="#cb169-4308" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> geojson<span class="op">;</span></span>
<span id="cb169-4309"><a href="#cb169-4309" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb169-4310"><a href="#cb169-4310" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-169" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb170" data-startfrom="4314" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4313"><span id="cb170-4314"><a href="#cb170-4314" aria-hidden="true" tabindex="-1"></a>get_admin2 <span class="op">=</span> <span class="kw">async</span> () <span class="kw">=&gt;</span> {</span>
<span id="cb170-4315"><a href="#cb170-4315" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> country <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb170-4316"><a href="#cb170-4316" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> admin1 <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span><span class="op">;</span></span>
<span id="cb170-4317"><a href="#cb170-4317" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (country) {</span>
<span id="cb170-4318"><a href="#cb170-4318" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"wait"</span><span class="op">;</span></span>
<span id="cb170-4319"><a href="#cb170-4319" aria-hidden="true" tabindex="-1"></a>    <span class="co">// let admin2_query = `WHERE admin0_name = '${country}'`</span></span>
<span id="cb170-4320"><a href="#cb170-4320" aria-hidden="true" tabindex="-1"></a>    <span class="co">// admin2_query += !admin1? "":` AND admin1_name = '${cleanAdminInput_SQL(admin1)}'`</span></span>
<span id="cb170-4321"><a href="#cb170-4321" aria-hidden="true" tabindex="-1"></a>    <span class="co">// let response = await geo_db.query(`</span></span>
<span id="cb170-4322"><a href="#cb170-4322" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   SELECT *</span></span>
<span id="cb170-4323"><a href="#cb170-4323" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   FROM admin2_geom</span></span>
<span id="cb170-4324"><a href="#cb170-4324" aria-hidden="true" tabindex="-1"></a>    <span class="co">//   ${admin2_query}`)</span></span>
<span id="cb170-4325"><a href="#cb170-4325" aria-hidden="true" tabindex="-1"></a>    <span class="co">// let response = await geo_db.query(`</span></span>
<span id="cb170-4326"><a href="#cb170-4326" aria-hidden="true" tabindex="-1"></a>    <span class="co">//     SELECT *</span></span>
<span id="cb170-4327"><a href="#cb170-4327" aria-hidden="true" tabindex="-1"></a>    <span class="co">//     FROM "${partitioned_boundries}/admin0=${admin_iso}/admin_level=2/${admin_iso}.parquet"</span></span>
<span id="cb170-4328"><a href="#cb170-4328" aria-hidden="true" tabindex="-1"></a>    <span class="co">// `)</span></span>
<span id="cb170-4329"><a href="#cb170-4329" aria-hidden="true" tabindex="-1"></a>    <span class="bu">console</span><span class="op">.</span><span class="fu">log</span>(</span>
<span id="cb170-4330"><a href="#cb170-4330" aria-hidden="true" tabindex="-1"></a>      <span class="st">"a2_path:"</span><span class="op">,</span></span>
<span id="cb170-4331"><a href="#cb170-4331" aria-hidden="true" tabindex="-1"></a>      <span class="fu">resolveWindowsCacheIssue</span>(</span>
<span id="cb170-4332"><a href="#cb170-4332" aria-hidden="true" tabindex="-1"></a>        partitioned_boundries <span class="op">+</span></span>
<span id="cb170-4333"><a href="#cb170-4333" aria-hidden="true" tabindex="-1"></a>          <span class="st">"/admin0="</span> <span class="op">+</span></span>
<span id="cb170-4334"><a href="#cb170-4334" aria-hidden="true" tabindex="-1"></a>          admin_iso <span class="op">+</span></span>
<span id="cb170-4335"><a href="#cb170-4335" aria-hidden="true" tabindex="-1"></a>          <span class="st">"/admin_level=2/"</span> <span class="op">+</span></span>
<span id="cb170-4336"><a href="#cb170-4336" aria-hidden="true" tabindex="-1"></a>          admin_iso <span class="op">+</span></span>
<span id="cb170-4337"><a href="#cb170-4337" aria-hidden="true" tabindex="-1"></a>          <span class="st">".parquet"</span><span class="op">,</span></span>
<span id="cb170-4338"><a href="#cb170-4338" aria-hidden="true" tabindex="-1"></a>      )<span class="op">,</span></span>
<span id="cb170-4339"><a href="#cb170-4339" aria-hidden="true" tabindex="-1"></a>    )<span class="op">;</span></span>
<span id="cb170-4340"><a href="#cb170-4340" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> response <span class="op">=</span> <span class="cf">await</span> geo_db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb170-4341"><a href="#cb170-4341" aria-hidden="true" tabindex="-1"></a><span class="vs">        SELECT *</span></span>
<span id="cb170-4342"><a href="#cb170-4342" aria-hidden="true" tabindex="-1"></a><span class="vs">        FROM "</span><span class="sc">${</span><span class="fu">resolveWindowsCacheIssue</span>(partitioned_boundries <span class="op">+</span> <span class="st">"/admin0="</span> <span class="op">+</span> admin_iso <span class="op">+</span> <span class="st">"/admin_level=2/"</span> <span class="op">+</span> admin_iso <span class="op">+</span> <span class="st">".parquet"</span>)<span class="sc">}</span><span class="vs">"</span></span>
<span id="cb170-4343"><a href="#cb170-4343" aria-hidden="true" tabindex="-1"></a><span class="vs">    `</span>)<span class="op">;</span></span>
<span id="cb170-4344"><a href="#cb170-4344" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> wkb_list <span class="op">=</span> response<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">geometry</span>)<span class="op">;</span></span>
<span id="cb170-4345"><a href="#cb170-4345" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> data <span class="op">=</span> <span class="cf">await</span> response<span class="op">.</span><span class="fu">map</span>(({ geometry<span class="op">,</span> <span class="op">...</span>rest }) <span class="kw">=&gt;</span> rest)<span class="op">;</span></span>
<span id="cb170-4346"><a href="#cb170-4346" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> features <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb170-4347"><a href="#cb170-4347" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (<span class="kw">let</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> wkb_list<span class="op">.</span><span class="at">length</span><span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb170-4348"><a href="#cb170-4348" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> pointer <span class="op">=</span> GEOS<span class="op">.</span><span class="fu">geosGeomFromWKB</span>(wkb_list[i])<span class="op">;</span></span>
<span id="cb170-4349"><a href="#cb170-4349" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> geojson <span class="op">=</span> <span class="cf">await</span> GEOS<span class="op">.</span><span class="fu">geosGeomToGeojson</span>(pointer<span class="op">,</span> GEOS<span class="op">.</span><span class="at">geos</span>)<span class="op">;</span></span>
<span id="cb170-4350"><a href="#cb170-4350" aria-hidden="true" tabindex="-1"></a>      geojson <span class="op">=</span> <span class="fu">turfRewind</span>(geojson<span class="op">,</span> { <span class="dt">reverse</span><span class="op">:</span> <span class="kw">true</span> })<span class="op">;</span></span>
<span id="cb170-4351"><a href="#cb170-4351" aria-hidden="true" tabindex="-1"></a>      <span class="kw">const</span> feature <span class="op">=</span> {</span>
<span id="cb170-4352"><a href="#cb170-4352" aria-hidden="true" tabindex="-1"></a>        <span class="dt">type</span><span class="op">:</span> <span class="st">"Feature"</span><span class="op">,</span></span>
<span id="cb170-4353"><a href="#cb170-4353" aria-hidden="true" tabindex="-1"></a>        <span class="dt">geometry</span><span class="op">:</span> geojson<span class="op">,</span></span>
<span id="cb170-4354"><a href="#cb170-4354" aria-hidden="true" tabindex="-1"></a>        <span class="dt">properties</span><span class="op">:</span> data[i]<span class="op">,</span></span>
<span id="cb170-4355"><a href="#cb170-4355" aria-hidden="true" tabindex="-1"></a>      }<span class="op">;</span></span>
<span id="cb170-4356"><a href="#cb170-4356" aria-hidden="true" tabindex="-1"></a>      features<span class="op">.</span><span class="fu">push</span>(feature)<span class="op">;</span></span>
<span id="cb170-4357"><a href="#cb170-4357" aria-hidden="true" tabindex="-1"></a>      GEOS<span class="op">.</span><span class="at">geos</span><span class="op">.</span><span class="fu">GEOSGeom_destroy</span>(pointer)<span class="op">;</span></span>
<span id="cb170-4358"><a href="#cb170-4358" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb170-4359"><a href="#cb170-4359" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> geojson <span class="op">=</span> {</span>
<span id="cb170-4360"><a href="#cb170-4360" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"FeatureCollection"</span><span class="op">,</span></span>
<span id="cb170-4361"><a href="#cb170-4361" aria-hidden="true" tabindex="-1"></a>      <span class="dt">features</span><span class="op">:</span> features<span class="op">,</span></span>
<span id="cb170-4362"><a href="#cb170-4362" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb170-4363"><a href="#cb170-4363" aria-hidden="true" tabindex="-1"></a>    <span class="bu">document</span><span class="op">.</span><span class="at">body</span><span class="op">.</span><span class="at">style</span><span class="op">.</span><span class="at">cursor</span> <span class="op">=</span> <span class="st">"default"</span><span class="op">;</span></span>
<span id="cb170-4364"><a href="#cb170-4364" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> geojson<span class="op">;</span></span>
<span id="cb170-4365"><a href="#cb170-4365" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb170-4366"><a href="#cb170-4366" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-170" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb171" data-startfrom="4370" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4369"><span id="cb171-4370"><a href="#cb171-4370" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`### Dynamic summary links</span></span>
<span id="cb171-4371"><a href="#cb171-4371" aria-hidden="true" tabindex="-1"></a><span class="vs">CSV of links to include for different admin0 selections</span></span>
<span id="cb171-4372"><a href="#cb171-4372" aria-hidden="true" tabindex="-1"></a><span class="vs">- Local Drive Google Sheet`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-171" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb172" data-startfrom="4376" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4375"><span id="cb172-4376"><a href="#cb172-4376" aria-hidden="true" tabindex="-1"></a><span class="co">// dynamic bulleted list data</span></span>
<span id="cb172-4377"><a href="#cb172-4377" aria-hidden="true" tabindex="-1"></a>dynamicSummaryData <span class="op">=</span> {</span>
<span id="cb172-4378"><a href="#cb172-4378" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> raw <span class="op">=</span> <span class="cf">await</span> <span class="fu">FileAttachment</span>(<span class="st">"dynamic-summary-links.csv"</span>)<span class="op">.</span><span class="fu">csv</span>()</span>
<span id="cb172-4379"><a href="#cb172-4379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-4380"><a href="#cb172-4380" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> raw<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb172-4381"><a href="#cb172-4381" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-172" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb173" data-startfrom="4385" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4384"><span id="cb173-4385"><a href="#cb173-4385" aria-hidden="true" tabindex="-1"></a>dynamicSummarySelectedLinks <span class="op">=</span> {</span>
<span id="cb173-4386"><a href="#cb173-4386" aria-hidden="true" tabindex="-1"></a>  <span class="co">// filter and check link number</span></span>
<span id="cb173-4387"><a href="#cb173-4387" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> dynamicSummaryData</span>
<span id="cb173-4388"><a href="#cb173-4388" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> admin0Selection <span class="op">=</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span> <span class="op">??</span> <span class="st">"DEFAULT"</span></span>
<span id="cb173-4389"><a href="#cb173-4389" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb173-4390"><a href="#cb173-4390" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> numLinks <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> admin0Selection)<span class="op">.</span><span class="at">length</span></span>
<span id="cb173-4391"><a href="#cb173-4391" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> numLinks <span class="op">==</span> <span class="dv">0</span></span>
<span id="cb173-4392"><a href="#cb173-4392" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> <span class="st">'DEFAULT'</span>)</span>
<span id="cb173-4393"><a href="#cb173-4393" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> data<span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> admin0Selection)</span>
<span id="cb173-4394"><a href="#cb173-4394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb173-4395"><a href="#cb173-4395" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb173-4396"><a href="#cb173-4396" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-173" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb174" data-startfrom="4400" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4399"><span id="cb174-4400"><a href="#cb174-4400" aria-hidden="true" tabindex="-1"></a>dynamicSummaryMarkdown <span class="op">=</span> {</span>
<span id="cb174-4401"><a href="#cb174-4401" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> linkArr <span class="op">=</span> dynamicSummarySelectedLinks<span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> <span class="vs">`- [</span><span class="sc">${</span>d<span class="op">.</span><span class="at">link_text</span><span class="sc">}</span><span class="vs">](</span><span class="sc">${</span>d<span class="op">.</span><span class="at">link_url</span><span class="sc">}</span><span class="vs">)</span><span class="sc">${</span>d<span class="op">.</span><span class="at">description</span><span class="op">.</span><span class="at">length</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">?</span> <span class="vs">`: </span><span class="sc">${</span>d<span class="op">.</span><span class="at">description</span><span class="sc">}</span><span class="vs">`</span><span class="op">:</span> <span class="st">""</span><span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb174-4402"><a href="#cb174-4402" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> linkArr<span class="op">.</span><span class="fu">join</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb174-4403"><a href="#cb174-4403" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-174" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb175" data-startfrom="4407" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4406"><span id="cb175-4407"><a href="#cb175-4407" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`***</span></span>
<span id="cb175-4408"><a href="#cb175-4408" aria-hidden="true" tabindex="-1"></a><span class="vs">## Helpers</span></span>
<span id="cb175-4409"><a href="#cb175-4409" aria-hidden="true" tabindex="-1"></a><span class="vs">*Functions and other good stuff*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-175" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb176" data-startfrom="4413" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4412"><span id="cb176-4413"><a href="#cb176-4413" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb176-4414"><a href="#cb176-4414" aria-hidden="true" tabindex="-1"></a><span class="vs">### Risk data grouping</span></span>
<span id="cb176-4415"><a href="#cb176-4415" aria-hidden="true" tabindex="-1"></a><span class="vs">*Lookups for risk data binning, such as hazards and crop types*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-176" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb177" data-startfrom="4419" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4418"><span id="cb177-4419"><a href="#cb177-4419" aria-hidden="true" tabindex="-1"></a><span class="co">// lookup for risk data type groupings</span></span>
<span id="cb177-4420"><a href="#cb177-4420" aria-hidden="true" tabindex="-1"></a><span class="co">// used by inputs and for grouping up data</span></span>
<span id="cb177-4421"><a href="#cb177-4421" aria-hidden="true" tabindex="-1"></a>riskDataTypes <span class="op">=</span> <span class="kw">new</span> <span class="bu">Object</span>({</span>
<span id="cb177-4422"><a href="#cb177-4422" aria-hidden="true" tabindex="-1"></a>  <span class="dt">crop</span><span class="op">:</span> {</span>
<span id="cb177-4423"><a href="#cb177-4423" aria-hidden="true" tabindex="-1"></a>    <span class="dt">crop</span><span class="op">:</span> [</span>
<span id="cb177-4424"><a href="#cb177-4424" aria-hidden="true" tabindex="-1"></a>      <span class="st">"arabica coffee"</span><span class="op">,</span></span>
<span id="cb177-4425"><a href="#cb177-4425" aria-hidden="true" tabindex="-1"></a>      <span class="st">"banana"</span><span class="op">,</span></span>
<span id="cb177-4426"><a href="#cb177-4426" aria-hidden="true" tabindex="-1"></a>      <span class="st">"barley"</span><span class="op">,</span></span>
<span id="cb177-4427"><a href="#cb177-4427" aria-hidden="true" tabindex="-1"></a>      <span class="st">"bean"</span><span class="op">,</span></span>
<span id="cb177-4428"><a href="#cb177-4428" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cassava"</span><span class="op">,</span></span>
<span id="cb177-4429"><a href="#cb177-4429" aria-hidden="true" tabindex="-1"></a>      <span class="st">"chickpea"</span><span class="op">,</span></span>
<span id="cb177-4430"><a href="#cb177-4430" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cocoa"</span><span class="op">,</span></span>
<span id="cb177-4431"><a href="#cb177-4431" aria-hidden="true" tabindex="-1"></a>      <span class="st">"coconut"</span><span class="op">,</span></span>
<span id="cb177-4432"><a href="#cb177-4432" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cotton"</span><span class="op">,</span></span>
<span id="cb177-4433"><a href="#cb177-4433" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cowpea"</span><span class="op">,</span></span>
<span id="cb177-4434"><a href="#cb177-4434" aria-hidden="true" tabindex="-1"></a>      <span class="st">"generic"</span><span class="op">,</span></span>
<span id="cb177-4435"><a href="#cb177-4435" aria-hidden="true" tabindex="-1"></a>      <span class="st">"groundnut"</span><span class="op">,</span></span>
<span id="cb177-4436"><a href="#cb177-4436" aria-hidden="true" tabindex="-1"></a>      <span class="st">"lentil"</span><span class="op">,</span></span>
<span id="cb177-4437"><a href="#cb177-4437" aria-hidden="true" tabindex="-1"></a>      <span class="st">"maize"</span><span class="op">,</span></span>
<span id="cb177-4438"><a href="#cb177-4438" aria-hidden="true" tabindex="-1"></a>      <span class="st">"oilpalm"</span><span class="op">,</span></span>
<span id="cb177-4439"><a href="#cb177-4439" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pearl millet"</span><span class="op">,</span></span>
<span id="cb177-4440"><a href="#cb177-4440" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pigeonpea"</span><span class="op">,</span></span>
<span id="cb177-4441"><a href="#cb177-4441" aria-hidden="true" tabindex="-1"></a>      <span class="st">"plantain"</span><span class="op">,</span></span>
<span id="cb177-4442"><a href="#cb177-4442" aria-hidden="true" tabindex="-1"></a>      <span class="st">"potato"</span><span class="op">,</span></span>
<span id="cb177-4443"><a href="#cb177-4443" aria-hidden="true" tabindex="-1"></a>      <span class="st">"rice"</span><span class="op">,</span></span>
<span id="cb177-4444"><a href="#cb177-4444" aria-hidden="true" tabindex="-1"></a>      <span class="st">"robusta coffee"</span><span class="op">,</span></span>
<span id="cb177-4445"><a href="#cb177-4445" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sesameseed"</span><span class="op">,</span></span>
<span id="cb177-4446"><a href="#cb177-4446" aria-hidden="true" tabindex="-1"></a>      <span class="st">"small millet"</span><span class="op">,</span></span>
<span id="cb177-4447"><a href="#cb177-4447" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sorghum"</span><span class="op">,</span></span>
<span id="cb177-4448"><a href="#cb177-4448" aria-hidden="true" tabindex="-1"></a>      <span class="st">"soybean"</span><span class="op">,</span></span>
<span id="cb177-4449"><a href="#cb177-4449" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sugarcane"</span><span class="op">,</span></span>
<span id="cb177-4450"><a href="#cb177-4450" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sunflower"</span><span class="op">,</span></span>
<span id="cb177-4451"><a href="#cb177-4451" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sweet potato"</span><span class="op">,</span></span>
<span id="cb177-4452"><a href="#cb177-4452" aria-hidden="true" tabindex="-1"></a>      <span class="st">"tea"</span><span class="op">,</span></span>
<span id="cb177-4453"><a href="#cb177-4453" aria-hidden="true" tabindex="-1"></a>      <span class="st">"tobacco"</span><span class="op">,</span></span>
<span id="cb177-4454"><a href="#cb177-4454" aria-hidden="true" tabindex="-1"></a>      <span class="st">"wheat"</span><span class="op">,</span></span>
<span id="cb177-4455"><a href="#cb177-4455" aria-hidden="true" tabindex="-1"></a>      <span class="st">"yams"</span><span class="op">,</span></span>
<span id="cb177-4456"><a href="#cb177-4456" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb177-4457"><a href="#cb177-4457" aria-hidden="true" tabindex="-1"></a>    <span class="dt">livestock</span><span class="op">:</span> [</span>
<span id="cb177-4458"><a href="#cb177-4458" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cattle_highland"</span><span class="op">,</span></span>
<span id="cb177-4459"><a href="#cb177-4459" aria-hidden="true" tabindex="-1"></a>      <span class="st">"cattle_tropical"</span><span class="op">,</span></span>
<span id="cb177-4460"><a href="#cb177-4460" aria-hidden="true" tabindex="-1"></a>      <span class="st">"goats_highland"</span><span class="op">,</span></span>
<span id="cb177-4461"><a href="#cb177-4461" aria-hidden="true" tabindex="-1"></a>      <span class="st">"goats_tropical"</span><span class="op">,</span></span>
<span id="cb177-4462"><a href="#cb177-4462" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pigs_highland"</span><span class="op">,</span></span>
<span id="cb177-4463"><a href="#cb177-4463" aria-hidden="true" tabindex="-1"></a>      <span class="st">"pigs_tropical"</span><span class="op">,</span></span>
<span id="cb177-4464"><a href="#cb177-4464" aria-hidden="true" tabindex="-1"></a>      <span class="st">"poultry_highland"</span><span class="op">,</span></span>
<span id="cb177-4465"><a href="#cb177-4465" aria-hidden="true" tabindex="-1"></a>      <span class="st">"poultry_tropical"</span><span class="op">,</span></span>
<span id="cb177-4466"><a href="#cb177-4466" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sheep_highland"</span><span class="op">,</span></span>
<span id="cb177-4467"><a href="#cb177-4467" aria-hidden="true" tabindex="-1"></a>      <span class="st">"sheep_tropical"</span><span class="op">,</span></span>
<span id="cb177-4468"><a href="#cb177-4468" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">,</span></span>
<span id="cb177-4469"><a href="#cb177-4469" aria-hidden="true" tabindex="-1"></a>  }<span class="op">,</span></span>
<span id="cb177-4470"><a href="#cb177-4470" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-177" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb178" data-startfrom="4474" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4473"><span id="cb178-4474"><a href="#cb178-4474" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb178-4475"><a href="#cb178-4475" aria-hidden="true" tabindex="-1"></a><span class="vs">### Dynamic insights</span></span>
<span id="cb178-4476"><a href="#cb178-4476" aria-hidden="true" tabindex="-1"></a><span class="vs">*functions for formatting results*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-178" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb179" data-startfrom="4480" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4479"><span id="cb179-4480"><a href="#cb179-4480" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">filterByAdminNames</span>(data) {</span>
<span id="cb179-4481"><a href="#cb179-4481" aria-hidden="true" tabindex="-1"></a>  <span class="co">// filter down data by combined selected admin0/admin1/admin2 Admin Selections</span></span>
<span id="cb179-4482"><a href="#cb179-4482" aria-hidden="true" tabindex="-1"></a>  <span class="co">// pass data from query, use tidyjs to filter by admin selection</span></span>
<span id="cb179-4483"><a href="#cb179-4483" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> result <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb179-4484"><a href="#cb179-4484" aria-hidden="true" tabindex="-1"></a>    data<span class="op">,</span></span>
<span id="cb179-4485"><a href="#cb179-4485" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> {</span>
<span id="cb179-4486"><a href="#cb179-4486" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> (</span>
<span id="cb179-4487"><a href="#cb179-4487" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">admin0_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin0</span><span class="op">.</span><span class="at">value</span> <span class="op">&amp;&amp;</span></span>
<span id="cb179-4488"><a href="#cb179-4488" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">admin1_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin1</span><span class="op">.</span><span class="at">value</span> <span class="op">&amp;&amp;</span></span>
<span id="cb179-4489"><a href="#cb179-4489" aria-hidden="true" tabindex="-1"></a>        d<span class="op">.</span><span class="at">admin2_name</span> <span class="op">==</span> adminSelections<span class="op">.</span><span class="at">selectAdmin2</span><span class="op">.</span><span class="at">value</span></span>
<span id="cb179-4490"><a href="#cb179-4490" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb179-4491"><a href="#cb179-4491" aria-hidden="true" tabindex="-1"></a>    })<span class="op">,</span></span>
<span id="cb179-4492"><a href="#cb179-4492" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb179-4493"><a href="#cb179-4493" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> result<span class="op">;</span></span>
<span id="cb179-4494"><a href="#cb179-4494" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-179" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb180" data-startfrom="4498" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4497"><span id="cb180-4498"><a href="#cb180-4498" aria-hidden="true" tabindex="-1"></a><span class="co">// wrapper for format functions, show chosen default</span></span>
<span id="cb180-4499"><a href="#cb180-4499" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">formatWithDefault</span>({</span>
<span id="cb180-4500"><a href="#cb180-4500" aria-hidden="true" tabindex="-1"></a>  value <span class="op">=</span> <span class="dv">1000</span><span class="op">,</span></span>
<span id="cb180-4501"><a href="#cb180-4501" aria-hidden="true" tabindex="-1"></a>  format <span class="op">=</span> (d) <span class="kw">=&gt;</span> d<span class="op">,</span></span>
<span id="cb180-4502"><a href="#cb180-4502" aria-hidden="true" tabindex="-1"></a>  defaultValue <span class="op">=</span> <span class="st">"---"</span><span class="op">,</span></span>
<span id="cb180-4503"><a href="#cb180-4503" aria-hidden="true" tabindex="-1"></a>  debug <span class="op">=</span> <span class="kw">false</span><span class="op">,</span></span>
<span id="cb180-4504"><a href="#cb180-4504" aria-hidden="true" tabindex="-1"></a>} <span class="op">=</span> {}) {</span>
<span id="cb180-4505"><a href="#cb180-4505" aria-hidden="true" tabindex="-1"></a>  <span class="co">// apply a formatting function to a value</span></span>
<span id="cb180-4506"><a href="#cb180-4506" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return default value if undefined or null</span></span>
<span id="cb180-4507"><a href="#cb180-4507" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>(value <span class="op">===</span> <span class="kw">null</span> <span class="op">||</span> value <span class="op">===</span> <span class="kw">undefined</span>)) {</span>
<span id="cb180-4508"><a href="#cb180-4508" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fu">format</span>(value)<span class="op">;</span></span>
<span id="cb180-4509"><a href="#cb180-4509" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb180-4510"><a href="#cb180-4510" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> defaultValue<span class="op">;</span></span>
<span id="cb180-4511"><a href="#cb180-4511" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb180-4512"><a href="#cb180-4512" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-180" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb181" data-startfrom="4516" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4515"><span id="cb181-4516"><a href="#cb181-4516" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb181-4517"><a href="#cb181-4517" aria-hidden="true" tabindex="-1"></a><span class="vs">### Data functions: format and transform</span></span>
<span id="cb181-4518"><a href="#cb181-4518" aria-hidden="true" tabindex="-1"></a><span class="vs">*apply formatting to/transform a value*</span></span>
<span id="cb181-4519"><a href="#cb181-4519" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb181-4520"><a href="#cb181-4520" aria-hidden="true" tabindex="-1"></a><span class="vs">- Reference: [Intl.NumberFormat()](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat/NumberFormat)`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-181" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb182" data-startfrom="4524" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4523"><span id="cb182-4524"><a href="#cb182-4524" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`**Transforms**`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-182" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb183" data-startfrom="4528" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4527"><span id="cb183-4528"><a href="#cb183-4528" aria-hidden="true" tabindex="-1"></a><span class="co">// transform non-number to percent value</span></span>
<span id="cb183-4529"><a href="#cb183-4529" aria-hidden="true" tabindex="-1"></a>transformPercent <span class="op">=</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb183-4530"><a href="#cb183-4530" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d <span class="op">===</span> <span class="kw">undefined</span> <span class="op">||</span> d <span class="op">===</span> <span class="kw">null</span>) <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb183-4531"><a href="#cb183-4531" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> d <span class="op">*</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb183-4532"><a href="#cb183-4532" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-183" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb184" data-startfrom="4536" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4535"><span id="cb184-4536"><a href="#cb184-4536" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`**Formatting**`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-184" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb185" data-startfrom="4540" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4539"><span id="cb185-4540"><a href="#cb185-4540" aria-hidden="true" tabindex="-1"></a><span class="co">// format non-number as percent</span></span>
<span id="cb185-4541"><a href="#cb185-4541" aria-hidden="true" tabindex="-1"></a>formatPercentTenth <span class="op">=</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb185-4542"><a href="#cb185-4542" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d <span class="op">===</span> <span class="kw">undefined</span> <span class="op">||</span> d <span class="op">===</span> <span class="kw">null</span>) <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb185-4543"><a href="#cb185-4543" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".1%"</span>)(d)<span class="op">;</span></span>
<span id="cb185-4544"><a href="#cb185-4544" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-185" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb186" data-startfrom="4548" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4547"><span id="cb186-4548"><a href="#cb186-4548" aria-hidden="true" tabindex="-1"></a><span class="co">// format non-number as percent</span></span>
<span id="cb186-4549"><a href="#cb186-4549" aria-hidden="true" tabindex="-1"></a>formatPercentWhole <span class="op">=</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb186-4550"><a href="#cb186-4550" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d <span class="op">===</span> <span class="kw">undefined</span> <span class="op">||</span> d <span class="op">===</span> <span class="kw">null</span>) <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb186-4551"><a href="#cb186-4551" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".0%"</span>)(d)<span class="op">;</span></span>
<span id="cb186-4552"><a href="#cb186-4552" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-186" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb187" data-startfrom="4556" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4555"><span id="cb187-4556"><a href="#cb187-4556" aria-hidden="true" tabindex="-1"></a><span class="co">// format non-number with no floating point</span></span>
<span id="cb187-4557"><a href="#cb187-4557" aria-hidden="true" tabindex="-1"></a><span class="co">// for index values</span></span>
<span id="cb187-4558"><a href="#cb187-4558" aria-hidden="true" tabindex="-1"></a>formatPercentNoSymbol <span class="op">=</span> (d) <span class="kw">=&gt;</span> {</span>
<span id="cb187-4559"><a href="#cb187-4559" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (d <span class="op">===</span> <span class="kw">undefined</span> <span class="op">||</span> d <span class="op">===</span> <span class="kw">null</span>) <span class="cf">return</span> d<span class="op">;</span></span>
<span id="cb187-4560"><a href="#cb187-4560" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> <span class="cf">return</span> d3<span class="op">.</span><span class="fu">format</span>(<span class="st">".0f"</span>)(d)<span class="op">;</span></span>
<span id="cb187-4561"><a href="#cb187-4561" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-187" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb188" data-startfrom="4565" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4564"><span id="cb188-4565"><a href="#cb188-4565" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">formatUSD</span>({ locale <span class="op">=</span> <span class="st">"en-US"</span> } <span class="op">=</span> {}) {</span>
<span id="cb188-4566"><a href="#cb188-4566" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> formatter <span class="op">=</span> <span class="fu">formatNumCompactShort</span>({ locale })<span class="op">;</span></span>
<span id="cb188-4567"><a href="#cb188-4567" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-4568"><a href="#cb188-4568" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (number) <span class="kw">=&gt;</span> {</span>
<span id="cb188-4569"><a href="#cb188-4569" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> formattedNum <span class="op">=</span> <span class="fu">formatter</span>(number)<span class="op">;</span></span>
<span id="cb188-4570"><a href="#cb188-4570" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">"$"</span> <span class="op">+</span> formattedNum<span class="op">;</span></span>
<span id="cb188-4571"><a href="#cb188-4571" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb188-4572"><a href="#cb188-4572" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-188" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb189" data-startfrom="4576" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4575"><span id="cb189-4576"><a href="#cb189-4576" aria-hidden="true" tabindex="-1"></a>intDollarYear <span class="op">=</span> <span class="dv">2005</span><span class="op">;</span> <span class="co">// year of international year data</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-189" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb190" data-startfrom="4580" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4579"><span id="cb190-4580"><a href="#cb190-4580" aria-hidden="true" tabindex="-1"></a>intDollarUnit <span class="op">=</span> <span class="vs">`</span><span class="sc">${</span>intDollarYear<span class="sc">}</span><span class="vs"> Int$`</span><span class="op">;</span> <span class="co">// full unit for international dollars</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-190" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb191" data-startfrom="4584" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4583"><span id="cb191-4584"><a href="#cb191-4584" aria-hidden="true" tabindex="-1"></a><span class="co">// format US currency</span></span>
<span id="cb191-4585"><a href="#cb191-4585" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">formatIntDollar</span>({ locale <span class="op">=</span> <span class="st">"en-US"</span> } <span class="op">=</span> {}) {</span>
<span id="cb191-4586"><a href="#cb191-4586" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> (number<span class="op">,</span> unit <span class="op">=</span> intDollarUnit<span class="op">.</span><span class="fu">replace</span>(<span class="st">"$"</span><span class="op">,</span> <span class="st">""</span>)) <span class="kw">=&gt;</span> {</span>
<span id="cb191-4587"><a href="#cb191-4587" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> formattedNumber <span class="op">=</span> <span class="fu">formatUSD</span>({ locale })(number)<span class="op">;</span></span>
<span id="cb191-4588"><a href="#cb191-4588" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> intDollar <span class="op">=</span> unit <span class="op">+</span> formattedNumber<span class="op">;</span></span>
<span id="cb191-4589"><a href="#cb191-4589" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> intDollar<span class="op">;</span></span>
<span id="cb191-4590"><a href="#cb191-4590" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb191-4591"><a href="#cb191-4591" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-191" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb192" data-startfrom="4595" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4594"><span id="cb192-4595"><a href="#cb192-4595" aria-hidden="true" tabindex="-1"></a><span class="co">// format number, long notation</span></span>
<span id="cb192-4596"><a href="#cb192-4596" aria-hidden="true" tabindex="-1"></a>formatNumCompactLong <span class="op">=</span> <span class="kw">function</span> ({ locale <span class="op">=</span> <span class="st">"en-US"</span> } <span class="op">=</span> {}) {</span>
<span id="cb192-4597"><a href="#cb192-4597" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="kw">function</span> (number) {</span>
<span id="cb192-4598"><a href="#cb192-4598" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(locale<span class="op">,</span> {</span>
<span id="cb192-4599"><a href="#cb192-4599" aria-hidden="true" tabindex="-1"></a>      <span class="dt">notation</span><span class="op">:</span> <span class="st">"compact"</span><span class="op">,</span></span>
<span id="cb192-4600"><a href="#cb192-4600" aria-hidden="true" tabindex="-1"></a>      <span class="dt">compactDisplay</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb192-4601"><a href="#cb192-4601" aria-hidden="true" tabindex="-1"></a>      <span class="dt">unitDisplay</span><span class="op">:</span> <span class="st">"long"</span><span class="op">,</span></span>
<span id="cb192-4602"><a href="#cb192-4602" aria-hidden="true" tabindex="-1"></a>    })<span class="op">.</span><span class="fu">format</span>(number)<span class="op">;</span></span>
<span id="cb192-4603"><a href="#cb192-4603" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb192-4604"><a href="#cb192-4604" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-192" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb193" data-startfrom="4608" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4607"><span id="cb193-4608"><a href="#cb193-4608" aria-hidden="true" tabindex="-1"></a><span class="co">// format number, short notation</span></span>
<span id="cb193-4609"><a href="#cb193-4609" aria-hidden="true" tabindex="-1"></a>formatNumCompactShort <span class="op">=</span> ({ locale <span class="op">=</span> <span class="st">"en-US"</span> } <span class="op">=</span> {}) <span class="kw">=&gt;</span></span>
<span id="cb193-4610"><a href="#cb193-4610" aria-hidden="true" tabindex="-1"></a>  <span class="kw">new</span> <span class="bu">Intl</span><span class="op">.</span><span class="fu">NumberFormat</span>(locale<span class="op">,</span> {</span>
<span id="cb193-4611"><a href="#cb193-4611" aria-hidden="true" tabindex="-1"></a>    <span class="dt">notation</span><span class="op">:</span> <span class="st">"compact"</span><span class="op">,</span></span>
<span id="cb193-4612"><a href="#cb193-4612" aria-hidden="true" tabindex="-1"></a>    <span class="dt">compactDisplay</span><span class="op">:</span> <span class="st">"short"</span><span class="op">,</span></span>
<span id="cb193-4613"><a href="#cb193-4613" aria-hidden="true" tabindex="-1"></a>  })<span class="op">.</span><span class="at">format</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-193" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb194" data-startfrom="4617" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4616"><span id="cb194-4617"><a href="#cb194-4617" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb194-4618"><a href="#cb194-4618" aria-hidden="true" tabindex="-1"></a><span class="vs">### Querying data</span></span>
<span id="cb194-4619"><a href="#cb194-4619" aria-hidden="true" tabindex="-1"></a><span class="vs">*functions for querying data*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-194" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb195" data-startfrom="4623" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4622"><span id="cb195-4623"><a href="#cb195-4623" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">getUniqueValues</span>(col<span class="op">,</span> tbl<span class="op">,</span> db) {</span>
<span id="cb195-4624"><a href="#cb195-4624" aria-hidden="true" tabindex="-1"></a>  <span class="co">// return unique values of from db tbl as a list</span></span>
<span id="cb195-4625"><a href="#cb195-4625" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> db</span>
<span id="cb195-4626"><a href="#cb195-4626" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">query</span>(<span class="vs">`select distinct </span><span class="sc">${</span>col<span class="sc">}</span><span class="vs"> from </span><span class="sc">${</span>tbl<span class="sc">}</span><span class="vs">`</span>)</span>
<span id="cb195-4627"><a href="#cb195-4627" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">then</span>((x) <span class="kw">=&gt;</span> x<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> d[col]))<span class="op">;</span></span>
<span id="cb195-4628"><a href="#cb195-4628" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-195" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb196" data-startfrom="4632" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4631"><span id="cb196-4632"><a href="#cb196-4632" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">bindTabularToGeo</span>({</span>
<span id="cb196-4633"><a href="#cb196-4633" aria-hidden="true" tabindex="-1"></a>  data <span class="op">=</span> []<span class="op">,</span></span>
<span id="cb196-4634"><a href="#cb196-4634" aria-hidden="true" tabindex="-1"></a>  dataBindColumn <span class="op">=</span> <span class="st">"dataBindColumn"</span><span class="op">,</span></span>
<span id="cb196-4635"><a href="#cb196-4635" aria-hidden="true" tabindex="-1"></a>  geoData <span class="op">=</span> []<span class="op">,</span></span>
<span id="cb196-4636"><a href="#cb196-4636" aria-hidden="true" tabindex="-1"></a>  geoDataBindColumn <span class="op">=</span> <span class="st">"geoDataBindColumn"</span><span class="op">,</span></span>
<span id="cb196-4637"><a href="#cb196-4637" aria-hidden="true" tabindex="-1"></a>}) {</span>
<span id="cb196-4638"><a href="#cb196-4638" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>data<span class="op">.</span><span class="at">length</span> <span class="op">||</span> <span class="op">!</span>geoData<span class="op">.</span><span class="at">features</span> <span class="op">||</span> <span class="op">!</span>geoData<span class="op">.</span><span class="at">features</span><span class="op">.</span><span class="at">length</span>) {</span>
<span id="cb196-4639"><a href="#cb196-4639" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb196-4640"><a href="#cb196-4640" aria-hidden="true" tabindex="-1"></a>      <span class="dt">type</span><span class="op">:</span> <span class="st">"FeatureCollection"</span><span class="op">,</span></span>
<span id="cb196-4641"><a href="#cb196-4641" aria-hidden="true" tabindex="-1"></a>      <span class="dt">features</span><span class="op">:</span> []<span class="op">,</span></span>
<span id="cb196-4642"><a href="#cb196-4642" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb196-4643"><a href="#cb196-4643" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-4644"><a href="#cb196-4644" aria-hidden="true" tabindex="-1"></a>  <span class="co">// bind data to geojson</span></span>
<span id="cb196-4645"><a href="#cb196-4645" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> index <span class="op">=</span> <span class="kw">new</span> <span class="bu">Map</span>(data<span class="op">.</span><span class="fu">map</span>((d) <span class="kw">=&gt;</span> [d[dataBindColumn]<span class="op">,</span> d]))<span class="op">;</span> <span class="co">// map data by dataBindColumn</span></span>
<span id="cb196-4646"><a href="#cb196-4646" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> geojson <span class="op">=</span> <span class="bu">JSON</span><span class="op">.</span><span class="fu">parse</span>(<span class="bu">JSON</span><span class="op">.</span><span class="fu">stringify</span>(geoData))<span class="op">;</span> <span class="co">// do a copy, rather than mutate</span></span>
<span id="cb196-4647"><a href="#cb196-4647" aria-hidden="true" tabindex="-1"></a>  <span class="co">// join up data to geojson</span></span>
<span id="cb196-4648"><a href="#cb196-4648" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (<span class="kw">const</span> f <span class="kw">of</span> geojson<span class="op">.</span><span class="at">features</span>) {</span>
<span id="cb196-4649"><a href="#cb196-4649" aria-hidden="true" tabindex="-1"></a>    f<span class="op">.</span><span class="at">properties</span><span class="op">.</span><span class="at">data</span> <span class="op">=</span> index<span class="op">.</span><span class="fu">get</span>(f<span class="op">.</span><span class="at">properties</span>[geoDataBindColumn])<span class="op">;</span></span>
<span id="cb196-4650"><a href="#cb196-4650" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb196-4651"><a href="#cb196-4651" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> geojson<span class="op">;</span></span>
<span id="cb196-4652"><a href="#cb196-4652" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-196" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb197" data-startfrom="4656" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4655"><span id="cb197-4656"><a href="#cb197-4656" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`***</span></span>
<span id="cb197-4657"><a href="#cb197-4657" aria-hidden="true" tabindex="-1"></a><span class="vs">## Testing Queries</span></span>
<span id="cb197-4658"><a href="#cb197-4658" aria-hidden="true" tabindex="-1"></a><span class="vs">*Test queries of the tabular data*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-197" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb198" data-startfrom="4662" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4661"><span id="cb198-4662"><a href="#cb198-4662" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb198-4663"><a href="#cb198-4663" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> debugString <span class="op">=</span> <span class="fu">md</span><span class="vs">`**Query hidden: Debug: non-zero hazard data counts**</span></span>
<span id="cb198-4664"><a href="#cb198-4664" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4665"><a href="#cb198-4665" aria-hidden="true" tabindex="-1"></a><span class="vs">_(update boolean within this cell to run)_ </span></span>
<span id="cb198-4666"><a href="#cb198-4666" aria-hidden="true" tabindex="-1"></a><span class="vs">  - this checks the number of results for every combination of hazard data </span></span>
<span id="cb198-4667"><a href="#cb198-4667" aria-hidden="true" tabindex="-1"></a><span class="vs">  - ~3% of choices have no data across all crops`</span></span>
<span id="cb198-4668"><a href="#cb198-4668" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb198-4669"><a href="#cb198-4669" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> hideQuery <span class="op">=</span> <span class="kw">true</span><span class="op">;</span></span>
<span id="cb198-4670"><a href="#cb198-4670" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4671"><a href="#cb198-4671" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> hideQuery</span>
<span id="cb198-4672"><a href="#cb198-4672" aria-hidden="true" tabindex="-1"></a>    <span class="op">?</span> debugString</span>
<span id="cb198-4673"><a href="#cb198-4673" aria-hidden="true" tabindex="-1"></a>    <span class="op">:</span> db<span class="op">.</span><span class="fu">query</span>(<span class="vs">`</span></span>
<span id="cb198-4674"><a href="#cb198-4674" aria-hidden="true" tabindex="-1"></a><span class="vs">with tbl as (</span></span>
<span id="cb198-4675"><a href="#cb198-4675" aria-hidden="true" tabindex="-1"></a><span class="vs">  select admin0_name</span></span>
<span id="cb198-4676"><a href="#cb198-4676" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb198-4677"><a href="#cb198-4677" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb198-4678"><a href="#cb198-4678" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb198-4679"><a href="#cb198-4679" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb198-4680"><a href="#cb198-4680" aria-hidden="true" tabindex="-1"></a><span class="vs">    , count(*) as total_count</span></span>
<span id="cb198-4681"><a href="#cb198-4681" aria-hidden="true" tabindex="-1"></a><span class="vs">    , count(case when value &lt;&gt; 0 then 1 end) as non_zero_count</span></span>
<span id="cb198-4682"><a href="#cb198-4682" aria-hidden="true" tabindex="-1"></a><span class="vs">    from haz_risk_vop_int</span></span>
<span id="cb198-4683"><a href="#cb198-4683" aria-hidden="true" tabindex="-1"></a><span class="vs">    -- where admin0_name = 'Angola'</span></span>
<span id="cb198-4684"><a href="#cb198-4684" aria-hidden="true" tabindex="-1"></a><span class="vs">    where severity = 'moderate' -- hard-coded</span></span>
<span id="cb198-4685"><a href="#cb198-4685" aria-hidden="true" tabindex="-1"></a><span class="vs">    and hazard != 'any'</span></span>
<span id="cb198-4686"><a href="#cb198-4686" aria-hidden="true" tabindex="-1"></a><span class="vs">    group by admin0_name</span></span>
<span id="cb198-4687"><a href="#cb198-4687" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin1_name</span></span>
<span id="cb198-4688"><a href="#cb198-4688" aria-hidden="true" tabindex="-1"></a><span class="vs">    , admin2_name</span></span>
<span id="cb198-4689"><a href="#cb198-4689" aria-hidden="true" tabindex="-1"></a><span class="vs">    , scenario</span></span>
<span id="cb198-4690"><a href="#cb198-4690" aria-hidden="true" tabindex="-1"></a><span class="vs">    , timeframe</span></span>
<span id="cb198-4691"><a href="#cb198-4691" aria-hidden="true" tabindex="-1"></a><span class="vs">    order by non_zero_count</span></span>
<span id="cb198-4692"><a href="#cb198-4692" aria-hidden="true" tabindex="-1"></a><span class="vs">)</span></span>
<span id="cb198-4693"><a href="#cb198-4693" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-4694"><a href="#cb198-4694" aria-hidden="true" tabindex="-1"></a><span class="vs">select * </span></span>
<span id="cb198-4695"><a href="#cb198-4695" aria-hidden="true" tabindex="-1"></a><span class="vs">  from tbl</span></span>
<span id="cb198-4696"><a href="#cb198-4696" aria-hidden="true" tabindex="-1"></a><span class="vs">  -- where non_zero_count = 0</span></span>
<span id="cb198-4697"><a href="#cb198-4697" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span>)<span class="op">;</span></span>
<span id="cb198-4698"><a href="#cb198-4698" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-198" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb199" data-startfrom="4702" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4701"><span id="cb199-4702"><a href="#cb199-4702" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`***</span></span>
<span id="cb199-4703"><a href="#cb199-4703" aria-hidden="true" tabindex="-1"></a><span class="vs">## Imports</span></span>
<span id="cb199-4704"><a href="#cb199-4704" aria-hidden="true" tabindex="-1"></a><span class="vs">*External imports*`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-199" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb200" data-startfrom="4708" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4707"><span id="cb200-4708"><a href="#cb200-4708" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { toc } <span class="im">from</span> <span class="st">"@nebrius/indented-toc"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-200" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb201" data-startfrom="4712" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4711"><span id="cb201-4712"><a href="#cb201-4712" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { T } <span class="im">from</span> <span class="st">"@pbeshai/tidyjs"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-201" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb202" data-startfrom="4716" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4715"><span id="cb202-4716"><a href="#cb202-4716" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> {</span>
<span id="cb202-4717"><a href="#cb202-4717" aria-hidden="true" tabindex="-1"></a>  cleanAdminInput_SQL<span class="op">,</span></span>
<span id="cb202-4718"><a href="#cb202-4718" aria-hidden="true" tabindex="-1"></a>  resolveWindowsCacheIssue<span class="op">,</span></span>
<span id="cb202-4719"><a href="#cb202-4719" aria-hidden="true" tabindex="-1"></a>} <span class="im">from</span> <span class="st">"cbd32f92c155bf5b"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-202" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb203" data-startfrom="4723" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4722"><span id="cb203-4723"><a href="#cb203-4723" aria-hidden="true" tabindex="-1"></a>GEOS <span class="op">=</span> {</span>
<span id="cb203-4724"><a href="#cb203-4724" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> initgeosJs <span class="op">=</span> (<span class="cf">await</span> <span class="im">import</span>(<span class="st">"https://cdn.skypack.dev/geos-wasm@2.0.0"</span>))</span>
<span id="cb203-4725"><a href="#cb203-4725" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="at">default</span><span class="op">;</span></span>
<span id="cb203-4726"><a href="#cb203-4726" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> geos <span class="op">=</span> <span class="cf">await</span> <span class="fu">initgeosJs</span>()<span class="op">;</span></span>
<span id="cb203-4727"><a href="#cb203-4727" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-4728"><a href="#cb203-4728" aria-hidden="true" tabindex="-1"></a>  <span class="kw">function</span> <span class="fu">geosGeomFromWKB</span>(wkb) {</span>
<span id="cb203-4729"><a href="#cb203-4729" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> wkbPtr <span class="op">=</span> geos<span class="op">.</span><span class="at">Module</span><span class="op">.</span><span class="fu">_malloc</span>(wkb<span class="op">.</span><span class="at">length</span>)<span class="op">;</span> <span class="co">//Allocate memory for the geom</span></span>
<span id="cb203-4730"><a href="#cb203-4730" aria-hidden="true" tabindex="-1"></a>    geos<span class="op">.</span><span class="at">Module</span><span class="op">.</span><span class="at">HEAPU8</span><span class="op">.</span><span class="fu">set</span>(wkb<span class="op">,</span> wkbPtr)<span class="op">;</span></span>
<span id="cb203-4731"><a href="#cb203-4731" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> geomPtr <span class="op">=</span> geos<span class="op">.</span><span class="fu">GEOSGeomFromWKB_buf</span>(wkbPtr<span class="op">,</span> wkb<span class="op">.</span><span class="at">length</span>)<span class="op">;</span></span>
<span id="cb203-4732"><a href="#cb203-4732" aria-hidden="true" tabindex="-1"></a>    geos<span class="op">.</span><span class="at">Module</span><span class="op">.</span><span class="fu">_free</span>(wkbPtr)<span class="op">;</span></span>
<span id="cb203-4733"><a href="#cb203-4733" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> geomPtr<span class="op">;</span></span>
<span id="cb203-4734"><a href="#cb203-4734" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb203-4735"><a href="#cb203-4735" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb203-4736"><a href="#cb203-4736" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> geosGeomToGeojson <span class="op">=</span> (</span>
<span id="cb203-4737"><a href="#cb203-4737" aria-hidden="true" tabindex="-1"></a>    <span class="cf">await</span> <span class="im">import</span>(<span class="st">"https://cdn.skypack.dev/geos-wasm/helpers"</span>)</span>
<span id="cb203-4738"><a href="#cb203-4738" aria-hidden="true" tabindex="-1"></a>  )<span class="op">.</span><span class="at">geosGeomToGeojson</span><span class="op">;</span></span>
<span id="cb203-4739"><a href="#cb203-4739" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-4740"><a href="#cb203-4740" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> { geosGeomToGeojson<span class="op">,</span> geosGeomFromWKB<span class="op">,</span> geos }<span class="op">;</span></span>
<span id="cb203-4741"><a href="#cb203-4741" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-203" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb204" data-startfrom="4745" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4744"><span id="cb204-4745"><a href="#cb204-4745" aria-hidden="true" tabindex="-1"></a>turfRewind <span class="op">=</span> <span class="pp">require</span>(<span class="st">"@turf/turf"</span>)<span class="op">.</span><span class="fu">then</span>((t) <span class="kw">=&gt;</span> t<span class="op">.</span><span class="at">rewind</span>)<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-204" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb205" data-startfrom="4749" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4748"><span id="cb205-4749"><a href="#cb205-4749" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { buildInlineDownloadButton } <span class="im">from</span> <span class="st">"1bda5f9b60c64223"</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-205" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb206" data-startfrom="4753" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4752"><span id="cb206-4753"><a href="#cb206-4753" aria-hidden="true" tabindex="-1"></a>download_translation <span class="op">=</span> <span class="kw">new</span> <span class="bu">Object</span>({</span>
<span id="cb206-4754"><a href="#cb206-4754" aria-hidden="true" tabindex="-1"></a>  <span class="dt">en</span><span class="op">:</span> <span class="st">"Download Data"</span><span class="op">,</span></span>
<span id="cb206-4755"><a href="#cb206-4755" aria-hidden="true" tabindex="-1"></a>  <span class="dt">fr</span><span class="op">:</span> <span class="st">"Tlcharger les Donnes"</span><span class="op">,</span></span>
<span id="cb206-4756"><a href="#cb206-4756" aria-hidden="true" tabindex="-1"></a>})<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-206" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb207" data-startfrom="4760" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4759"><span id="cb207-4760"><a href="#cb207-4760" aria-hidden="true" tabindex="-1"></a><span class="fu">md</span><span class="vs">`---</span></span>
<span id="cb207-4761"><a href="#cb207-4761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-4762"><a href="#cb207-4762" aria-hidden="true" tabindex="-1"></a><span class="vs">## Other`</span><span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-207" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb208" data-startfrom="4766" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4765"><span id="cb208-4766"><a href="#cb208-4766" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> <span class="fu">makeDevNotes</span>({</span>
<span id="cb208-4767"><a href="#cb208-4767" aria-hidden="true" tabindex="-1"></a>  <span class="co">// adding dev notes as a html summary (collapsible)</span></span>
<span id="cb208-4768"><a href="#cb208-4768" aria-hidden="true" tabindex="-1"></a>  title <span class="op">=</span> <span class="st">"Plot dev notes"</span><span class="op">,</span></span>
<span id="cb208-4769"><a href="#cb208-4769" aria-hidden="true" tabindex="-1"></a>  emojis <span class="op">=</span> <span class="st">""</span><span class="op">,</span></span>
<span id="cb208-4770"><a href="#cb208-4770" aria-hidden="true" tabindex="-1"></a>  text <span class="op">=</span> <span class="fu">md</span><span class="vs">`Update this text using the </span><span class="sc">\`</span><span class="vs">text</span><span class="sc">\`</span><span class="vs"> field.`</span><span class="op">,</span></span>
<span id="cb208-4771"><a href="#cb208-4771" aria-hidden="true" tabindex="-1"></a>} <span class="op">=</span> {}) {</span>
<span id="cb208-4772"><a href="#cb208-4772" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> htl<span class="op">.</span><span class="fu">html</span><span class="vs">`&lt;details&gt;</span></span>
<span id="cb208-4773"><a href="#cb208-4773" aria-hidden="true" tabindex="-1"></a><span class="vs">&lt;summary&gt;</span><span class="sc">${</span>title<span class="sc">}</span><span class="vs"> </span><span class="sc">${</span>emojis<span class="sc">}</span><span class="vs">&lt;/summary&gt;</span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">&lt;/details&gt;`</span><span class="op">;</span></span>
<span id="cb208-4774"><a href="#cb208-4774" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-208" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb209" data-startfrom="4778" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4777"><span id="cb209-4778"><a href="#cb209-4778" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb209-4779"><a href="#cb209-4779" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> text <span class="op">=</span> <span class="vs">`### v1.2.0: adding language conversion</span></span>
<span id="cb209-4780"><a href="#cb209-4780" aria-hidden="true" tabindex="-1"></a><span class="vs">- language toggle </span></span>
<span id="cb209-4781"><a href="#cb209-4781" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4782"><a href="#cb209-4782" aria-hidden="true" tabindex="-1"></a><span class="vs">### v1.1.2: Adaptive capacity formatting</span></span>
<span id="cb209-4783"><a href="#cb209-4783" aria-hidden="true" tabindex="-1"></a><span class="vs">- Update adaptive capacity data</span></span>
<span id="cb209-4784"><a href="#cb209-4784" aria-hidden="true" tabindex="-1"></a><span class="vs">  - AC data for map are indices and should be describes as such, not as rates</span></span>
<span id="cb209-4785"><a href="#cb209-4785" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Update insights to be about selected indexes rather than population affected</span></span>
<span id="cb209-4786"><a href="#cb209-4786" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4787"><a href="#cb209-4787" aria-hidden="true" tabindex="-1"></a><span class="vs">### v1.1.1 Map fix (2024-03-26)</span></span>
<span id="cb209-4788"><a href="#cb209-4788" aria-hidden="true" tabindex="-1"></a><span class="vs">Looking at map with multiple regions shown for choropleth</span></span>
<span id="cb209-4789"><a href="#cb209-4789" aria-hidden="true" tabindex="-1"></a><span class="vs">- Fix binding when you've selected admin1:</span></span>
<span id="cb209-4790"><a href="#cb209-4790" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Bind data by BOTH admin1 and admin0, not just admin1</span></span>
<span id="cb209-4791"><a href="#cb209-4791" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4792"><a href="#cb209-4792" aria-hidden="true" tabindex="-1"></a><span class="vs">### v1.1 Data Update (2024-03-19)</span></span>
<span id="cb209-4793"><a href="#cb209-4793" aria-hidden="true" tabindex="-1"></a><span class="vs">- Hazard field is now 'no hazard' (all lowercase)</span></span>
<span id="cb209-4794"><a href="#cb209-4794" aria-hidden="true" tabindex="-1"></a><span class="vs">- VoP values are the total across all severities, not just hard-coded to 'moderate'</span></span>
<span id="cb209-4795"><a href="#cb209-4795" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4796"><a href="#cb209-4796" aria-hidden="true" tabindex="-1"></a><span class="vs">### v1.0.1 (2024-03-15)</span></span>
<span id="cb209-4797"><a href="#cb209-4797" aria-hidden="true" tabindex="-1"></a><span class="vs">- Adding cover image</span></span>
<span id="cb209-4798"><a href="#cb209-4798" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4799"><a href="#cb209-4799" aria-hidden="true" tabindex="-1"></a><span class="vs">### v1.0 (2024-03-15)</span></span>
<span id="cb209-4800"><a href="#cb209-4800" aria-hidden="true" tabindex="-1"></a><span class="vs">- Updating hazard data</span></span>
<span id="cb209-4801"><a href="#cb209-4801" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Included 'No hazard' as option, so updated how data is extracted (no longer joining up totals)</span></span>
<span id="cb209-4802"><a href="#cb209-4802" aria-hidden="true" tabindex="-1"></a><span class="vs">    - Using new option as definition of distribution</span></span>
<span id="cb209-4803"><a href="#cb209-4803" aria-hidden="true" tabindex="-1"></a><span class="vs">    - Update removal from component bar charts</span></span>
<span id="cb209-4804"><a href="#cb209-4804" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Not using the explicit 'any' column, instead defining using sum of component values (to avoid any rounding errors)</span></span>
<span id="cb209-4805"><a href="#cb209-4805" aria-hidden="true" tabindex="-1"></a><span class="vs">- Cleanup</span></span>
<span id="cb209-4806"><a href="#cb209-4806" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Remove unused hazard helpers</span></span>
<span id="cb209-4807"><a href="#cb209-4807" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Clean up documentation for data sources</span></span>
<span id="cb209-4808"><a href="#cb209-4808" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4809"><a href="#cb209-4809" aria-hidden="true" tabindex="-1"></a><span class="vs">### v0.6 (2024-03-11)</span></span>
<span id="cb209-4810"><a href="#cb209-4810" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4811"><a href="#cb209-4811" aria-hidden="true" tabindex="-1"></a><span class="vs">- Collapse y-axis for percent chart when crop hazards are zero (preserve order for crops and livestock)</span></span>
<span id="cb209-4812"><a href="#cb209-4812" aria-hidden="true" tabindex="-1"></a><span class="vs">- Remove 'no hazard' from hazard bar chart dropdown</span></span>
<span id="cb209-4813"><a href="#cb209-4813" aria-hidden="true" tabindex="-1"></a><span class="vs">- Update perc chart tooltip</span></span>
<span id="cb209-4814"><a href="#cb209-4814" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Total VoP at risk is now in terms of colored bars only (using any hazard data)</span></span>
<span id="cb209-4815"><a href="#cb209-4815" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Format to match percent and money with hazard exposure</span></span>
<span id="cb209-4816"><a href="#cb209-4816" aria-hidden="true" tabindex="-1"></a><span class="vs">  - Fix bar ordering</span></span>
<span id="cb209-4817"><a href="#cb209-4817" aria-hidden="true" tabindex="-1"></a><span class="vs">- Update adaptive capacity icicle</span></span>
<span id="cb209-4818"><a href="#cb209-4818" aria-hidden="true" tabindex="-1"></a><span class="vs">  - includes SSA and updated colors</span></span>
<span id="cb209-4819"><a href="#cb209-4819" aria-hidden="true" tabindex="-1"></a><span class="vs">- Update adaptive capacity map data</span></span>
<span id="cb209-4820"><a href="#cb209-4820" aria-hidden="true" tabindex="-1"></a><span class="vs">`</span><span class="op">;</span></span>
<span id="cb209-4821"><a href="#cb209-4821" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4822"><a href="#cb209-4822" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> newestVersion <span class="op">=</span> text<span class="op">.</span><span class="fu">split</span>(<span class="st">'###'</span>)</span>
<span id="cb209-4823"><a href="#cb209-4823" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">filter</span>(d <span class="kw">=&gt;</span> d)</span>
<span id="cb209-4824"><a href="#cb209-4824" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">map</span>(d <span class="kw">=&gt;</span> d<span class="op">.</span><span class="fu">trim</span>())</span>
<span id="cb209-4825"><a href="#cb209-4825" aria-hidden="true" tabindex="-1"></a>    <span class="op">?.</span>[<span class="dv">0</span>]</span>
<span id="cb209-4826"><a href="#cb209-4826" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">split</span>(<span class="st">'</span><span class="sc">\n</span><span class="st">'</span>)</span>
<span id="cb209-4827"><a href="#cb209-4827" aria-hidden="true" tabindex="-1"></a>    <span class="op">?.</span>[<span class="dv">0</span>]</span>
<span id="cb209-4828"><a href="#cb209-4828" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb209-4829"><a href="#cb209-4829" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="fu">makeDevNotes</span>({</span>
<span id="cb209-4830"><a href="#cb209-4830" aria-hidden="true" tabindex="-1"></a>    <span class="dt">text</span><span class="op">:</span> <span class="fu">md</span><span class="vs">`</span><span class="sc">${</span>text<span class="sc">}</span><span class="vs">`</span><span class="op">,</span></span>
<span id="cb209-4831"><a href="#cb209-4831" aria-hidden="true" tabindex="-1"></a>    <span class="dt">title</span><span class="op">:</span> newestVersion <span class="op">??</span> <span class="st">"Dev notes"</span><span class="op">,</span></span>
<span id="cb209-4832"><a href="#cb209-4832" aria-hidden="true" tabindex="-1"></a>    <span class="dt">emojis</span><span class="op">:</span> <span class="st">""</span></span>
<span id="cb209-4833"><a href="#cb209-4833" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb209-4834"><a href="#cb209-4834" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-209" data-nodetype="expression"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb210" data-startfrom="4838" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4837"><span id="cb210-4838"><a href="#cb210-4838" aria-hidden="true" tabindex="-1"></a>convertToCSV <span class="op">=</span> (data) <span class="kw">=&gt;</span> {</span>
<span id="cb210-4839"><a href="#cb210-4839" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>data<span class="op">?.</span><span class="at">length</span>) <span class="cf">return</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb210-4840"><a href="#cb210-4840" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-4841"><a href="#cb210-4841" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> headers <span class="op">=</span> <span class="bu">Object</span><span class="op">.</span><span class="fu">keys</span>(data[<span class="dv">0</span>])<span class="op">;</span></span>
<span id="cb210-4842"><a href="#cb210-4842" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> escapeValue <span class="op">=</span> (val) <span class="kw">=&gt;</span> {</span>
<span id="cb210-4843"><a href="#cb210-4843" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (val <span class="op">==</span> <span class="kw">null</span>) <span class="cf">return</span> <span class="st">""</span><span class="op">;</span></span>
<span id="cb210-4844"><a href="#cb210-4844" aria-hidden="true" tabindex="-1"></a>    <span class="kw">const</span> str <span class="op">=</span> <span class="bu">String</span>(val)<span class="op">;</span></span>
<span id="cb210-4845"><a href="#cb210-4845" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> str<span class="op">.</span><span class="fu">includes</span>(<span class="st">","</span>) <span class="op">||</span> str<span class="op">.</span><span class="fu">includes</span>(<span class="st">'"'</span>) <span class="op">||</span> str<span class="op">.</span><span class="fu">includes</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb210-4846"><a href="#cb210-4846" aria-hidden="true" tabindex="-1"></a>      <span class="op">?</span> <span class="vs">`"</span><span class="sc">${</span>str<span class="op">.</span><span class="fu">replace</span>(<span class="ss">/"/g</span><span class="op">,</span> <span class="st">'""'</span>)<span class="sc">}</span><span class="vs">"`</span></span>
<span id="cb210-4847"><a href="#cb210-4847" aria-hidden="true" tabindex="-1"></a>      <span class="op">:</span> str<span class="op">;</span></span>
<span id="cb210-4848"><a href="#cb210-4848" aria-hidden="true" tabindex="-1"></a>  }<span class="op">;</span></span>
<span id="cb210-4849"><a href="#cb210-4849" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb210-4850"><a href="#cb210-4850" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> [</span>
<span id="cb210-4851"><a href="#cb210-4851" aria-hidden="true" tabindex="-1"></a>    headers<span class="op">.</span><span class="fu">map</span>(escapeValue)<span class="op">.</span><span class="fu">join</span>(<span class="st">","</span>)<span class="op">,</span></span>
<span id="cb210-4852"><a href="#cb210-4852" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>data<span class="op">.</span><span class="fu">map</span>((row) <span class="kw">=&gt;</span> headers<span class="op">.</span><span class="fu">map</span>((key) <span class="kw">=&gt;</span> <span class="fu">escapeValue</span>(row[key]))<span class="op">.</span><span class="fu">join</span>(<span class="st">","</span>))<span class="op">,</span></span>
<span id="cb210-4853"><a href="#cb210-4853" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">.</span><span class="fu">join</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)<span class="op">;</span></span>
<span id="cb210-4854"><a href="#cb210-4854" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-210" data-nodetype="declaration"></div></div></div><div class="cell"><div class="code-copy-outer-scaffold"><div class="sourceCode cell-code hidden" id="cb211" data-startfrom="4858" data-source-offset="0"><pre class="sourceCode js code-with-copy"><code class="sourceCode javascript" style="counter-reset:source-line 4857"><span id="cb211-4858"><a href="#cb211-4858" aria-hidden="true" tabindex="-1"></a>{ <span class="kw">const</span> _anyData <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb211-4859"><a href="#cb211-4859" aria-hidden="true" tabindex="-1"></a>    data_hazardVoP<span class="op">,</span></span>
<span id="cb211-4860"><a href="#cb211-4860" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> <span class="op">!</span>[<span class="st">"any"</span><span class="op">,</span> <span class="st">"no hazard"</span>]<span class="op">.</span><span class="fu">includes</span>(d<span class="op">.</span><span class="at">hazard</span>))<span class="op">,</span> <span class="co">// only hazard components</span></span>
<span id="cb211-4861"><a href="#cb211-4861" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">groupBy</span>(</span>
<span id="cb211-4862"><a href="#cb211-4862" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb211-4863"><a href="#cb211-4863" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb211-4864"><a href="#cb211-4864" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb211-4865"><a href="#cb211-4865" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb211-4866"><a href="#cb211-4866" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb211-4867"><a href="#cb211-4867" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb211-4868"><a href="#cb211-4868" aria-hidden="true" tabindex="-1"></a>        <span class="st">"severity"</span><span class="op">,</span></span>
<span id="cb211-4869"><a href="#cb211-4869" aria-hidden="true" tabindex="-1"></a>        <span class="st">"crop"</span></span>
<span id="cb211-4870"><a href="#cb211-4870" aria-hidden="true" tabindex="-1"></a>      ]<span class="op">,</span></span>
<span id="cb211-4871"><a href="#cb211-4871" aria-hidden="true" tabindex="-1"></a>      [</span>
<span id="cb211-4872"><a href="#cb211-4872" aria-hidden="true" tabindex="-1"></a>        T<span class="op">.</span><span class="fu">summarize</span>({</span>
<span id="cb211-4873"><a href="#cb211-4873" aria-hidden="true" tabindex="-1"></a>          <span class="dt">vop_any</span><span class="op">:</span> T<span class="op">.</span><span class="fu">sum</span>(<span class="st">"vop"</span>)</span>
<span id="cb211-4874"><a href="#cb211-4874" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb211-4875"><a href="#cb211-4875" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb211-4876"><a href="#cb211-4876" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb211-4877"><a href="#cb211-4877" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb211-4878"><a href="#cb211-4878" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-4879"><a href="#cb211-4879" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> _dataWithAnyColumn <span class="op">=</span> T<span class="op">.</span><span class="fu">tidy</span>(</span>
<span id="cb211-4880"><a href="#cb211-4880" aria-hidden="true" tabindex="-1"></a>    data_hazardVoP<span class="op">,</span></span>
<span id="cb211-4881"><a href="#cb211-4881" aria-hidden="true" tabindex="-1"></a>    T<span class="op">.</span><span class="fu">leftJoin</span>(_anyData<span class="op">,</span> {</span>
<span id="cb211-4882"><a href="#cb211-4882" aria-hidden="true" tabindex="-1"></a>      <span class="dt">by</span><span class="op">:</span> [</span>
<span id="cb211-4883"><a href="#cb211-4883" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin0_name"</span><span class="op">,</span></span>
<span id="cb211-4884"><a href="#cb211-4884" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin1_name"</span><span class="op">,</span></span>
<span id="cb211-4885"><a href="#cb211-4885" aria-hidden="true" tabindex="-1"></a>        <span class="st">"admin2_name"</span><span class="op">,</span></span>
<span id="cb211-4886"><a href="#cb211-4886" aria-hidden="true" tabindex="-1"></a>        <span class="st">"scenario"</span><span class="op">,</span></span>
<span id="cb211-4887"><a href="#cb211-4887" aria-hidden="true" tabindex="-1"></a>        <span class="st">"timeframe"</span><span class="op">,</span></span>
<span id="cb211-4888"><a href="#cb211-4888" aria-hidden="true" tabindex="-1"></a>        <span class="st">"crop"</span><span class="op">,</span></span>
<span id="cb211-4889"><a href="#cb211-4889" aria-hidden="true" tabindex="-1"></a>        <span class="st">"severity"</span></span>
<span id="cb211-4890"><a href="#cb211-4890" aria-hidden="true" tabindex="-1"></a>      ]</span>
<span id="cb211-4891"><a href="#cb211-4891" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb211-4892"><a href="#cb211-4892" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb211-4893"><a href="#cb211-4893" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-4894"><a href="#cb211-4894" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> data <span class="op">=</span> _dataWithAnyColumn<span class="op">;</span></span>
<span id="cb211-4895"><a href="#cb211-4895" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataAny <span class="op">=</span> data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">==</span> <span class="st">"any"</span>)<span class="op">;</span> <span class="co">// combined</span></span>
<span id="cb211-4896"><a href="#cb211-4896" aria-hidden="true" tabindex="-1"></a>  <span class="kw">const</span> dataBars <span class="op">=</span> [</span>
<span id="cb211-4897"><a href="#cb211-4897" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span>data<span class="op">.</span><span class="fu">filter</span>((d) <span class="kw">=&gt;</span> d<span class="op">.</span><span class="at">hazard</span> <span class="op">!==</span> <span class="st">"any"</span> <span class="op">&amp;&amp;</span> d<span class="op">.</span><span class="at">vop</span> <span class="op">!==</span> <span class="dv">0</span>) <span class="co">// remove the combined hazard</span></span>
<span id="cb211-4898"><a href="#cb211-4898" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb211-4899"><a href="#cb211-4899" aria-hidden="true" tabindex="-1"></a> <span class="cf">return</span> dataBars</span>
<span id="cb211-4900"><a href="#cb211-4900" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div><div class="cell-output cell-output-display"><div id="ojs-cell-211" data-nodetype="expression"></div></div></div></section></main><script type="ojs-module-contents">eyJjb250ZW50cyI6W3sibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7IGhlcm9JbWFnZSB9IGZyb20gXCIvaGVscGVycy9oZXJvLmpzXCI7XG5oZXJvX3VybCA9IFwiLi8uLi8uLi9pbWFnZXMvYXRSaXNrLndlYnBcIjtcblxuaGVybyA9IGhlcm9JbWFnZShub3RlYm9va1RpdGxlLCBoZXJvX3VybCk7XG5odG1sYCR7aGVyb31gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW1wb3J0IHsgYXRsYXNUT0MgfSBmcm9tICcvaGVscGVycy90b2Mub2pzJyBcbntcbiAgYXdhaXQgbmJUZXh0IC8vIGZvcmNlIHdhaXQvcmVsb2FkIHdpdGggbmJUZXh0IHRvIGxvYWQgc28gaGVhZGluZ3MgaGF2ZSBjb3JyZWN0IGxhYmVscy9sYW5ndWFnZXNcbiAgcmV0dXJuIGF0bGFzVE9DKHtcbiAgICAgIGhlYWRpbmc6IGA8Yj4ke19sYW5nKHtlbjpcIkluIHRoaXMgbm90ZWJvb2tcIiwgZnI6XCJEYW5zIGNlIG5vdGVib29rXCJ9KX08L2I+YCxcbiAgICAgIHNraXA6IFtub3RlYm9va1RpdGxlLCBcIm5vdGVib29rLXRpdGxlXCIsIFwiQXBwZW5kaXhcIiwgXCJzb3VyY2UtY29kZVwiXVxuICAgICAgfSlcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHByZXR0eSB2aWV3IG9mIGxhbmd1YWdlIHRvZ2dsZVxudmlld29mIHByZXR0eUxhbmd1YWdlVmlldyA9IHtcbiAgcmV0dXJuIElucHV0cy5iaW5kKFxuICAgIElucHV0cy5yYWRpbyhsYW5ndWFnZXMsIHtcbiAgICAgIGxhYmVsOiBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC5sYWJlbHMubGFuZ3VhZ2UpLFxuICAgICAgZm9ybWF0OiAoZCkgPT4gZC5sYWJlbFxuICAgIH0pLFxuICAgIHZpZXdvZiBsYW5ndWFnZVxuICApO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCB0aXRsZSA9IF9sYW5nKG5iVGV4dC5vdmVydmlldy5oZWFkZXIpXG4gIHJldHVybiBtZGAjICR7dGl0bGV9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCB0ZXh0ID0gX2xhbmcobmJUZXh0Lm92ZXJ2aWV3LmJsb2Nrcy5vcGVuZXIpXG4gIHJldHVybiBtZGAke3RleHR9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCB0ZXh0ID0gX2xhbmcobmJUZXh0LmFmcmljYU1hcC5ibG9ja3MuaDEpXG4gIHJldHVybiBtZGAjICR7dGV4dH1gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRlbXBsYXRlID0gX2xhbmcobmJUZXh0LmFmcmljYU1hcC5ibG9ja3Mub3BlbmVyKVxuICBjb25zdCBpdGVtcyA9IFtcbiAgICB7bmFtZTogJ3ZvcF9ibHVyYicsIHZhbHVlOiBfbGFuZyhuYlRleHQudm9wTm90ZU1kLmJsdXJiKX1cbiAgXVxuICBjb25zdCBmb3JtYXQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKHRlbXBsYXRlLCBpdGVtcylcbiAgcmV0dXJuIG1kYCR7Zm9ybWF0fWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGZvcm1hdCBhZG1pbiBzZWxlY3Rpb25zXG4vLyBiaW5kIHRvIGFwcGVuZGl4IGlucHV0cywgYWRkIHRlbXBsYXRlIHRvIGZvcm1hdFxuZ2VvSW1wYWN0QWRtaW5TZWxlY3RvcnMgPSB7XG4gIGNvbnN0IGxhYmVsQ291bnRyeSA9IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLmNvdW50cnkuc2luZ3VsYXIpXG4gIGNvbnN0IGxhYmVsUmVnaW9uID0gX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMucmVnaW9uLnNpbmd1bGFyKVxuICBjb25zdCBsYWJlbFN1YnJlZ2lvbiA9IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLnN1YnJlZ2lvbi5zaW5ndWxhcilcbiAgXG4gIHJldHVybiBJbnB1dHMuZm9ybShcbiAgICBbXG4gICAgICBJbnB1dHMuYmluZChcbiAgICAgICAgSW5wdXRzLnNlbGVjdChkYXRhQWRtaW4wLCB7XG4gICAgICAgICAgbGFiZWw6IGxhYmVsQ291bnRyeSxcbiAgICAgICAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsXG4gICAgICAgIH0pLFxuICAgICAgICB2aWV3b2Ygc2VsZWN0QWRtaW4wXG4gICAgICApLFxuICAgICAgSW5wdXRzLmJpbmQoXG4gICAgICAgIElucHV0cy5zZWxlY3QoZGF0YUFkbWluMSwge1xuICAgICAgICAgIGxhYmVsOiBsYWJlbFJlZ2lvbixcbiAgICAgICAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsXG4gICAgICAgIH0pLFxuICAgICAgICB2aWV3b2Ygc2VsZWN0QWRtaW4xXG4gICAgICApLFxuICAgICAgSW5wdXRzLmJpbmQoXG4gICAgICAgIElucHV0cy5zZWxlY3QoZGF0YUFkbWluMiwge1xuICAgICAgICAgIGxhYmVsOiBsYWJlbFN1YnJlZ2lvbixcbiAgICAgICAgICBmb3JtYXQ6ICh4KSA9PiB4LmxhYmVsXG4gICAgICAgIH0pLFxuICAgICAgICB2aWV3b2Ygc2VsZWN0QWRtaW4yXG4gICAgICApXG4gICAgXSxcbiAgICB7XG4gICAgICB0ZW1wbGF0ZTogYWRtaW5Gb3JtVGVtcGxhdGVcbiAgICB9XG4gICk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBkZWZpbmUgY2hvaWNlcyBmb3IgdGhlIGRhdGEgdmFsdWVcbnZpZXdvZiBzZWxlY3RHZW9EYXRhVHlwZSA9IHtcbiAgY29uc3Qgb3B0aW9ucyA9IFtcbiAgICB7XG4gICAgICBrZXk6IFwicG9wdWxhdGlvblwiLCAvLyBsb29rdXAgaWQgZm9yIGRhdGEgb3B0aW9uXG4gICAgICBkYXRhQ29sdW1uOiBcInJ1cmFsX3BvcFwiLCAvLyBkYXRhIGNvbHVtblxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5hZnJpY2FNYXAuaW5wdXRzLm1hcExheWVyLm9wdGlvbnMucnVyYWxQb3AubGFiZWwpLCAvLyBsYWJlbFxuICAgICAgbGFiZWxUaXA6IF9sYW5nKFxuICAgICAgICBuYlRleHQuYWZyaWNhTWFwLmlucHV0cy5tYXBMYXllci5vcHRpb25zLnJ1cmFsUG9wLmxhYmVsVGlwXG4gICAgICApLCAvLyBsYWJlbCBmb3IgdG9vbHRpcFxuICAgICAgbGFiZWxMZWdlbmQ6IF9sYW5nKFxuICAgICAgICBuYlRleHQuYWZyaWNhTWFwLmlucHV0cy5tYXBMYXllci5vcHRpb25zLnJ1cmFsUG9wLmxhYmVsTGVnZW5kXG4gICAgICApLCAvLyBsYWJlbCBmb3IgbGVnZW5kXG4gICAgICBmb3JtYXRGdW5jOiBmb3JtYXROdW1Db21wYWN0U2hvcnQoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSksIC8vIGZvcm1hdHRpbmcgZnVuY3Rpb24gZm9yIHJhdyBkYXRhIHZhbHVlXG4gICAgICBmb3JtYXRGdW5jTGVnZW5kOiBmb3JtYXROdW1Db21wYWN0U2hvcnQoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSksIC8vIGZvcm1hdHRpbmcgZnVuY3Rpb24gZm9yIGxlZ2VuZFxuICAgICAgY29sb3JSYW5nZTogY29sb3JTY2FsZXMucmFuZ2UueWVsbG93R3JlZW4sIC8vIGNvbG9yIHJhbmdlXG4gICAgICBjb2xvclVua25vd246IGNvbG9yU2NhbGVzLnVua25vd24gLy8gdW5rbm93biBmaWxsIGNvbG9yXG4gICAgfSxcbiAgICB7XG4gICAgICBrZXk6IFwidm9wXCIsXG4gICAgICBkYXRhQ29sdW1uOiBcInZvcF90b3RhbFwiLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5hZnJpY2FNYXAuaW5wdXRzLm1hcExheWVyLm9wdGlvbnMudm9wLmxhYmVsKSxcbiAgICAgIGxhYmVsVGlwOiBfbGFuZyhuYlRleHQuYWZyaWNhTWFwLmlucHV0cy5tYXBMYXllci5vcHRpb25zLnZvcC5sYWJlbFRpcCksXG4gICAgICBsYWJlbExlZ2VuZDogTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICAgICAgX2xhbmcobmJUZXh0LmFmcmljYU1hcC5pbnB1dHMubWFwTGF5ZXIub3B0aW9ucy52b3AubGFiZWxMZWdlbmQpLFxuICAgICAgICBbeyBuYW1lOiBcInVuaXRcIiwgdmFsdWU6IGludERvbGxhclVuaXQgfV1cbiAgICAgICksXG4gICAgICBmb3JtYXRGdW5jOiBmb3JtYXRJbnREb2xsYXIoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSksXG4gICAgICBmb3JtYXRGdW5jTGVnZW5kOiBmb3JtYXRVU0Qoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSksXG4gICAgICBjb2xvclJhbmdlOiBjb2xvclNjYWxlcy5yYW5nZS55ZWxsb3dHcmVlbixcbiAgICAgIGNvbG9yVW5rbm93bjogY29sb3JTY2FsZXMudW5rbm93blxuICAgIH1cbiAgXTtcbiAgcmV0dXJuIElucHV0cy5yYWRpbyhcbiAgICBvcHRpb25zLnNvcnQoKGEsIGIpID0+IGIua2V5LmxvY2FsZUNvbXBhcmUoYS5rZXkpKSxcbiAgICB7XG4gICAgICB3aWR0aDogMzAwLFxuICAgICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5hZnJpY2FNYXAuaW5wdXRzLm1hcExheWVyLmxhYmVsKSxcbiAgICAgIGZvcm1hdDogKHgpID0+IHgubGFiZWwsXG4gICAgICB2YWx1ZTogb3B0aW9ucy5maW5kKCh0KSA9PiB0LmtleSA9PT0gXCJ2b3BcIilcbiAgICB9XG4gICk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGxvdENob3JvcGxldGhHZW9JbXBhY3QgPSB7XG4gIGNvbnN0IGRhdGEgPSBtYXBEYXRhR2VvSW1wYWN0XG4gIGNvbnN0IHNlbGVjdG9yID0gc2VsZWN0R2VvRGF0YVR5cGVcbiAgY29uc3Qgdm9wQ2FwdGlvbiA9IF9sYW5nKG5iVGV4dC52b3BOb3RlTWQuY2FwdGlvbik7XG4gIGNvbnN0IG1pc3NpbmdEYXRhTGFiZWwgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5taXNzaW5nTWFwRGF0YUJsdXJiKSxcbiAgICBbe25hbWU6IFwiZGF0YV9sYWJlbFwiLCB2YWx1ZTogc2VsZWN0b3IubGFiZWx9XVxuICApXG4gIFxuICBjb25zdCBwbG90ID0gUGxvdC5wbG90KHtcbiAgICB3aWR0aDogbWFwV2lkdGgsXG4gICAgaGVpZ2h0OiA1NTAsXG4gICAgY2FwdGlvbjogYCR7bWlzc2luZ0RhdGFMYWJlbH0gJHt2b3BDYXB0aW9ufWAsXG4gICAgcHJvamVjdGlvbjoge1xuICAgICAgdHlwZTogXCJhemltdXRoYWwtZXF1YWwtYXJlYVwiLFxuICAgICAgZG9tYWluOiBkYXRhXG4gICAgfSxcbiAgICBjb2xvcjoge1xuICAgICAgbGVnZW5kOiB0cnVlLFxuICAgICAgbGFiZWw6IHNlbGVjdG9yLmxhYmVsTGVnZW5kLFxuICAgICAgcmFuZ2U6IHNlbGVjdG9yLmNvbG9yUmFuZ2UsXG4gICAgICB1bmtub3duOiBzZWxlY3Rvci5jb2xvclVua25vd24sXG4gICAgICB0aWNrRm9ybWF0OiBzZWxlY3Rvci5mb3JtYXRGdW5jTGVnZW5kLFxuICAgIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIC8vIGdlbyBkYXRhXG4gICAgICBQbG90LmdlbyhkYXRhLmZlYXR1cmVzLCB7XG4gICAgICAgIGZpbGw6IChkKSA9PiB7XG4gICAgICAgICAgY29uc3QgZGF0YUNvbHVtbiA9IHNlbGVjdG9yLmRhdGFDb2x1bW5cbiAgICAgICAgICBjb25zdCBmaWxsVmFsdWUgPSBkLnByb3BlcnRpZXMuZGF0YSA/IGQucHJvcGVydGllcy5kYXRhW2RhdGFDb2x1bW5dIDogbnVsbDsgLy8gaGFuZGxlIG1pc3NpbmcgZGF0YVxuICAgICAgICAgIHJldHVybiBmaWxsVmFsdWVcbiAgICAgICAgfSxcbiAgICAgICAgc3Ryb2tlOiBcIiNmZmZcIixcbiAgICAgICAgc3Ryb2tlV2lkdGg6IDAuNVxuICAgICAgfSksXG4gICAgICAvLyBhZG1pbjIgaGlnaGxpZ2h0IFxuICAgICAgLy8gaWYgQWRtaW4gc2VsZWN0aW9uIGluY2x1ZGVzIGFkbWluMiwgaGlnaGxpZ2h0IHNlY3Rpb25cbiAgICAgIFBsb3QuZ2VvKGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjIudmFsdWUgXG4gICAgICAgICAgICAgICA/IGRhdGEuZmVhdHVyZXMuZmlsdGVyKGQgPT4gZC5wcm9wZXJ0aWVzLmFkbWluMl9uYW1lID09IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjIudmFsdWUpXG4gICAgICAgICAgICAgICA6IFtdLCB7XG4gICAgICAgIGZpbGw6IG51bGwsXG4gICAgICAgIHN0cm9rZTogXCIjMzMzXCIsXG4gICAgICAgIHN0cm9rZVdpZHRoOiAxLjVcbiAgICAgIH0pLFxuICAgICAgLy8gZ2VvIHBvaW50ZXJcbiAgICAgIFBsb3QuZ2VvKGRhdGEsIFBsb3QucG9pbnRlcihcbiAgICAgICAgUGxvdC5jZW50cm9pZCh7XG4gICAgICAgIHN0cm9rZTogXCIjMzMzXCIsXG4gICAgICAgIHN0cm9rZVdpZHRoOiAxLjUsXG4gICAgICB9KSkpLFxuICAgICAgLy8gdG9vbHRpcFxuICAgICAgUGxvdC50aXAoXG4gICAgICAgIGRhdGEuZmVhdHVyZXMsXG4gICAgICAgIFBsb3QucG9pbnRlcihcbiAgICAgICAgICBQbG90LmNlbnRyb2lkKHtcbiAgICAgICAgICAgIGNoYW5uZWxzOiB7XG4gICAgICAgICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgICAgICAvLyByZWdpb24gbGFiZWwsIGJhc2VkIG9uIHNlbGVjdGlvblxuICAgICAgICAgICAgICAgIGxhYmVsOiBnZXRMb3dlckxldmVsQWRtaW5MYWJlbCgpLCAvLyBwbG90LWxldmVsIHNvIGlucHV0cyBkb24ndCByZWxvYWRcbiAgICAgICAgICAgICAgICB2YWx1ZTogKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IHRyYW5zbGF0ZWQgPSBfbGFuZyh0ZC5hZG1pbjBfbmFtZS52YWx1ZXM/LltkLnByb3BlcnRpZXMuYWRtaW5fbmFtZV0pO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHRyYW5zbGF0ZWQgPz8gZC5wcm9wZXJ0aWVzLmFkbWluX25hbWVcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgICAgICBsYWJlbDogc2VsZWN0b3IubGFiZWxUaXAsXG4gICAgICAgICAgICAgICAgdmFsdWU6IChkKSA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZGF0YUNvbHVtbiA9IHNlbGVjdG9yLmRhdGFDb2x1bW5cbiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gZC5wcm9wZXJ0aWVzLmRhdGEgPyBkLnByb3BlcnRpZXMuZGF0YVtkYXRhQ29sdW1uXSA6IHVuZGVmaW5lZFxuICAgICAgICAgICAgICAgIHJldHVybiBkYXRhXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb3JtYXQ6IHtcbiAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgZGF0YTogKGQpID0+IHNlbGVjdG9yLmZvcm1hdEZ1bmMoZClcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApXG4gICAgXVxuICB9KTtcblxuICByZXR1cm4gcGxvdFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImJ1aWxkSW5saW5lRG93bmxvYWRCdXR0b24oXG4gIG1hcERhdGFHZW9JbXBhY3QuZmVhdHVyZXMubWFwKChkKSA9PiBkLnByb3BlcnRpZXMpLFxuICBfbGFuZyhkb3dubG9hZF90cmFuc2xhdGlvbiksXG4gIGAke3NlbGVjdEdlb0RhdGFUeXBlLmtleX1gLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJoZWFkZXJRdWlja0luc2lnaHRzR2VvSW1wYWN0ID0ge1xuICBjb25zdCB0ZW1wbGF0ZSA9IF9sYW5nKG5iVGV4dC5hZnJpY2FNYXAuaW5zaWdodHMudGl0bGUpXG4gIGNvbnN0IGl0ZW1zID0gW1xuICAgIHtuYW1lOiBcImluc2lnaHRfc3RyaW5nXCIsIHZhbHVlOiBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC5sYWJlbHMucXVpY2tJbnNpZ2h0cyl9LFxuICAgIHtuYW1lOiBcImFkbWluX3NlbGVjdGlvblwiLCB2YWx1ZTogZ2V0QWRtaW5TZWxlY3Rpb24oKS5sYWJlbH0sXG4gIF1cbiAgY29uc3QgZm9ybWF0ID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyh0ZW1wbGF0ZSwgaXRlbXMpXG4gIHJldHVybiBtZGAjIyMgJHtmb3JtYXR9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHRleHQgaW5zaWdodHMgZm9yIGdlbyBpbXBhY3RcbnRleHREeW5hbWljSW5zaWdodHNfZ2VvSW1wYWN0ID0ge1xuICBjb25zdCBhZG1pblNlbGVjdGlvbiA9IGdldEFkbWluU2VsZWN0aW9uTGFiZWxXaXRoUGFyZW4oe1xuICAgIGFkbWluMExhYmVsOiBfbGFuZyhcbiAgICAgIHRkLmFkbWluMF9uYW1lLnZhbHVlcz8uW2dldEFkbWluU2VsZWN0aW9uQWRtaW4wKCkudmFsdWUgPz8gXCJTU0FcIl1bXCJhcnRpY2xlM1wiXVxuICAgICksXG4gICAgYWRtaW5TdWJsYWJlbDogZ2V0QWRtaW5TZWxlY3Rpb24oKS5sYWJlbFxuICB9KTtcbiAgY29uc3QgaSA9IGR5bmFtaWNJbnNpZ2h0c19nZW9JbXBhY3QuaW5zaWdodDtcblxuICBjb25zdCB0cmFuc2xhdGVDcm9wID0gKGNyb3ApID0+IF9sYW5nKHRkLmNyb3AudmFsdWVzPy5bY3JvcF0pO1xuICBjb25zdCB0b3BDb21tb2RpdGllc0ZpbHRlcmVkID0gaS50b3BDb21tb2RpdGllcy5maWx0ZXIoKGQpID0+IGQuZGF0YSAhPT0gMCk7XG4gIGNvbnN0IHRvcENvbW1vZGl0aWVzTGlzdCA9IHRvcENvbW1vZGl0aWVzRmlsdGVyZWQubWFwKFxuICAgIChkLCBpKSA9PlxuICAgICAgYCR7XG4gICAgICAgIGkgPT0gdG9wQ29tbW9kaXRpZXNGaWx0ZXJlZC5sZW5ndGggLSAxXG4gICAgICAgICAgPyBgJHtfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC53b3Jkcy5hbmQpfSBgXG4gICAgICAgICAgOiBcIlwiXG4gICAgICB9Kioke3RyYW5zbGF0ZUNyb3AoZC5sYWJlbCl9KiogKCoqJHtkLnZhbHVlfSoqKWBcbiAgKTtcbiAgY29uc3QgdG9wTGl2ZXN0b2NrRmlsdGVyZWQgPSBpLnRvcExpdmVzdG9jay5maWx0ZXIoKGQpID0+IGQuZGF0YSAhPT0gMCk7XG4gIGNvbnN0IHRvcExpdmVzdG9ja0xpc3QgPSB0b3BMaXZlc3RvY2tGaWx0ZXJlZC5tYXAoXG4gICAgKGQsIGkpID0+XG4gICAgICBgJHtcbiAgICAgICAgaSA9PSB0b3BMaXZlc3RvY2tGaWx0ZXJlZC5sZW5ndGggLSAxXG4gICAgICAgICAgPyBgJHtfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC53b3Jkcy5hbmQpfSBgXG4gICAgICAgICAgOiBcIlwiXG4gICAgICB9Kioke3RyYW5zbGF0ZUNyb3AoZC5sYWJlbCl9KiogKCoqJHtkLnZhbHVlfSoqKWBcbiAgKTtcblxuICAvLyBuZXcgY29kZVxuICBjb25zdCBsYW5nQmFzZVBhdGggPSBuYlRleHQuYWZyaWNhTWFwLmluc2lnaHRzO1xuICBjb25zdCBsYW5nT3ZlcnZpZXcgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKGxhbmdCYXNlUGF0aC5pbnNpZ2h0T3ZlcnZpZXcpLFxuICAgIFtcbiAgICAgIHsgbmFtZTogXCJhZG1pbl9zZWxlY3Rpb25cIiwgdmFsdWU6IGFkbWluU2VsZWN0aW9uIH0sXG4gICAgICB7IG5hbWU6IFwidG90YWxfdm9wXCIsIHZhbHVlOiBpLnRvdGFsVm9wIH1cbiAgICBdXG4gICk7XG5cbiAgY29uc3QgbGFuZ0FyZWFBbmRQb3AgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKGxhbmdCYXNlUGF0aC5pbnNpZ2h0QXJlYUFuZFBvcCksXG4gICAgW1xuICAgICAgeyBuYW1lOiBcImFyZWFcIiwgdmFsdWU6IGkudG90YWxIYSB9LFxuICAgICAgeyBuYW1lOiBcInBvcHVsYXRpb25cIiwgdmFsdWU6IGkudG90YWxQb3AgfVxuICAgIF1cbiAgKTtcblxuICBjb25zdCBsYW5nVG9wQ29tbW9kaXR5ID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICBfbGFuZyhsYW5nQmFzZVBhdGguaW5zaWdodFRvcENvbW1vZGl0eSksXG4gICAgW1xuICAgICAgeyBuYW1lOiBcImNvbW1vZGl0eV93b3JkXCIsIHZhbHVlOiBcImNvbW1vZGl0aWVzXCIgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogXCJ2ZXJiXCIsXG4gICAgICAgIHZhbHVlOlxuICAgICAgICAgIHRvcENvbW1vZGl0aWVzRmlsdGVyZWQubGVuZ3RoID09IDFcbiAgICAgICAgICAgID8gX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMudG9CZS5zaW5ndWxhcilcbiAgICAgICAgICAgIDogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQud29yZHMudG9CZS5wbHVyYWwpXG4gICAgICB9LFxuICAgICAgeyBuYW1lOiBcImxpc3Rfc3RyaW5nXCIsIHZhbHVlOiB0b3BDb21tb2RpdGllc0xpc3Quam9pbihcIiwgXCIpIH1cbiAgICBdXG4gICk7XG5cbiAgY29uc3QgbGFuZ1RvcExpdmVzdG9jayA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXMoXG4gICAgX2xhbmcobGFuZ0Jhc2VQYXRoLmluc2lnaHRUb3BMaXZlc3RvY2spLFxuICAgIFtcbiAgICAgIHtcbiAgICAgICAgbmFtZTogXCJ2ZXJiXCIsXG4gICAgICAgIHZhbHVlOlxuICAgICAgICAgIHRvcExpdmVzdG9ja0ZpbHRlcmVkLmxlbmd0aCA9PSAxXG4gICAgICAgICAgICA/IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLnRvQmUuc2luZ3VsYXIpXG4gICAgICAgICAgICA6IF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLnRvQmUucGx1cmFsKVxuICAgICAgfSxcbiAgICAgIHsgbmFtZTogXCJsaXN0X3N0cmluZ1wiLCB2YWx1ZTogdG9wTGl2ZXN0b2NrTGlzdC5qb2luKFwiLCBcIikgfVxuICAgIF1cbiAgKTtcblxuICByZXR1cm4gbWRgJHtsYW5nT3ZlcnZpZXd9XG5cbiR7bGFuZ0FyZWFBbmRQb3B9XG5cbiR7bGFuZ1RvcENvbW1vZGl0eX1cblxuJHtsYW5nVG9wTGl2ZXN0b2NrfWA7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCB0ZXh0ID0gX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5pbnRyby5oMSlcbiAgcmV0dXJuIG1kYCMgJHt0ZXh0fWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IGFkbWluU2VsZWN0aW9uID0gZ2V0QWRtaW5TZWxlY3Rpb25MYWJlbFdpdGhQYXJlbih7XG4gICAgYWRtaW4wTGFiZWw6IExhbmcudG9TZW50ZW5jZUNhc2UoXG4gICAgICBfbGFuZyhcbiAgICAgICAgdGQuYWRtaW4wX25hbWUudmFsdWVzPy5bZ2V0QWRtaW5TZWxlY3Rpb25BZG1pbjAoKS52YWx1ZSA/PyBcIlNTQVwiXVtcImFydGljbGUyXCJdXG4gICAgICApXG4gICAgKSxcbiAgICBhZG1pblN1YmxhYmVsOiBnZXRBZG1pblNlbGVjdGlvbigpLmxhYmVsXG4gIH0pO1xuICBjb25zdCBmb3JtYXQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5jbGltYXRlUmlza3MuaW50cm8ub3BlbmVyKSxcbiAgICBbeyBuYW1lOiBcImFkbWluX3NlbGVjdGlvblwiLCB2YWx1ZTogYWRtaW5TZWxlY3Rpb24gfV1cbiAgKTtcbiAgcmV0dXJuIG1kYCR7Zm9ybWF0fWA7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCB0ZXh0ID0gX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5jb21wb3VuZEhhemFyZHMuaDIpXG4gIHJldHVybiBtZGAjIyAke3RleHR9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgdGV4dCA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXMoXG4gICAgX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5jb21wb3VuZEhhemFyZHMub3BlbmVyKSxcbiAgICBbXG4gICAgICB7bmFtZTogXCJ2b3Bfbm90ZVwiLCB2YWx1ZTogX2xhbmcobmJUZXh0LnZvcE5vdGVNZC5ibHVyYil9LFxuICAgICAge25hbWU6IFwiYWRtaW5fc2VsZWN0aW9uXCIsIHZhbHVlOiBnZXRBZG1pblNlbGVjdGlvbigpLmxhYmVsfVxuICAgIF1cbiAgKVxuICByZXR1cm4gbWRgJHt0ZXh0fWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBmb3JtYXQgYWRtaW4gc2VsZWN0aW9uc1xuLy8gYmluZCB0byBhcHBlbmRpeCBpbnB1dHMsIGFkZCB0ZW1wbGF0ZSB0byBmb3JtYXRcbklucHV0cy5mb3JtKFxuICBbXG4gICAgSW5wdXRzLmJpbmQoXG4gICAgICBJbnB1dHMuc2VsZWN0KGRhdGFBZG1pbjAsIHsgbGFiZWw6IGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4wLCBmb3JtYXQ6IHggPT4geC5sYWJlbCB9KSxcbiAgICAgIHZpZXdvZiBzZWxlY3RBZG1pbjBcbiAgICApLFxuICAgIElucHV0cy5iaW5kKFxuICAgICAgSW5wdXRzLnNlbGVjdChkYXRhQWRtaW4xLCB7IGxhYmVsOiBhZG1pblJlZ2lvbnMubGFiZWxzLmFkbWluMSwgZm9ybWF0OiB4ID0+IHgubGFiZWwgfSksXG4gICAgICB2aWV3b2Ygc2VsZWN0QWRtaW4xXG4gICAgKSxcbiAgICBJbnB1dHMuYmluZChcbiAgICAgIElucHV0cy5zZWxlY3QoZGF0YUFkbWluMiwgeyBsYWJlbDogYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjIsIGZvcm1hdDogeCA9PiB4LmxhYmVsIH0pLFxuICAgICAgdmlld29mIHNlbGVjdEFkbWluMlxuICAgIClcbiAgXSxcbiAge1xuICAgIHRlbXBsYXRlOiBhZG1pbkZvcm1UZW1wbGF0ZVxuICB9XG4pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIHNlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lID0ge1xuICAvLyBzY2VuYXJpbyBhbmQgdGltZWZyYW1lXG5cbiAgY29uc3QgaGlzdG9yaWNMYWJlbCA9IGAke19sYW5nKG5iVGV4dC5jbGltYXRlUmlza3MuY29tcG91bmRIYXphcmRzLmlucHV0cy5kcm9wZG93blNjZW5hcmlvLmhpc3RvcmljKX06IDE5OTUtMjAxNGBcblxuICBjb25zdCBkYXRhID0gW1xuICAgIHtsYWJlbDogaGlzdG9yaWNMYWJlbCwgc2NlbmFyaW86ICdoaXN0b3JpYycsIHRpbWVmcmFtZTogJ2hpc3RvcmljJ30sXG4gICAge2xhYmVsOiAnU1NQMjQ1OiAyMDIxLTIwNDAnLCBzY2VuYXJpbzogJ3NzcDI0NScsIHRpbWVmcmFtZTogJzIwMjFfMjA0MCd9LFxuICAgIHtsYWJlbDogJ1NTUDI0NTogMjA0MS0yMDYwJywgc2NlbmFyaW86ICdzc3AyNDUnLCB0aW1lZnJhbWU6ICcyMDQxXzIwNjAnfSxcbiAgICB7bGFiZWw6ICdTU1A1ODU6IDIwMjEtMjA0MCcsIHNjZW5hcmlvOiAnc3NwNTg1JywgdGltZWZyYW1lOiAnMjAyMV8yMDQwJ30sXG4gICAge2xhYmVsOiAnU1NQNTg1OiAyMDQxLTIwNjAnLCBzY2VuYXJpbzogJ3NzcDU4NScsIHRpbWVmcmFtZTogJzIwNDFfMjA2MCd9LFxuICBdXG4gIFxuICByZXR1cm4gSW5wdXRzLnNlbGVjdChkYXRhLCB7XG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5jbGltYXRlUmlza3MuY29tcG91bmRIYXphcmRzLmlucHV0cy5kcm9wZG93blNjZW5hcmlvLmxhYmVsKSxcbiAgICBmb3JtYXQ6IHggPT4geC5sYWJlbCxcbiAgICB2YWx1ZTogZGF0YS5maW5kKGQgPT4gZC50aW1lZnJhbWUgPT09ICdoaXN0b3JpYycpXG4gIH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgbGFiZWxQZXJjID0gX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5jb21wb3VuZEhhemFyZHMuc3RhY2tlZEJhci50b29sdGlwTGFiZWxzLnRvdGFsVm9wKVxuICBjb25zdCBsYWJlbEhhemFyZCA9IF9sYW5nKG5iVGV4dC5jbGltYXRlUmlza3MuY29tcG91bmRIYXphcmRzLnN0YWNrZWRCYXIudG9vbHRpcExhYmVscy5oYXphcmQpXG4gIGNvbnN0IGxhYmVsVm9wID0gX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5jb21wb3VuZEhhemFyZHMuc3RhY2tlZEJhci50b29sdGlwTGFiZWxzLnZvcFJpc2spXG4gIGNvbnN0IHhMYWJlbCA9IF9sYW5nKG5iVGV4dC5jbGltYXRlUmlza3MuY29tcG91bmRIYXphcmRzLnN0YWNrZWRCYXIueExhYmVsKVxuICBjb25zdCBtYXJnaW5MZWZ0ID0gX2xhbmcoe2VuOiAxMTAsIGZyOiAxNTB9KTtcbiAgXG4gIGNvbnN0IF9hbnlEYXRhID0gVC50aWR5KFxuICAgIGRhdGFfaGF6YXJkVm9QLFxuICAgIFQuZmlsdGVyKChkKSA9PiAhW1wiYW55XCIsIFwibm8gaGF6YXJkXCJdLmluY2x1ZGVzKGQuaGF6YXJkKSksIC8vIG9ubHkgaGF6YXJkIGNvbXBvbmVudHNcbiAgICBULmdyb3VwQnkoXG4gICAgICBbXG4gICAgICAgIFwiYWRtaW4wX25hbWVcIixcbiAgICAgICAgXCJhZG1pbjFfbmFtZVwiLFxuICAgICAgICBcImFkbWluMl9uYW1lXCIsXG4gICAgICAgIFwic2NlbmFyaW9cIixcbiAgICAgICAgXCJ0aW1lZnJhbWVcIixcbiAgICAgICAgXCJzZXZlcml0eVwiLFxuICAgICAgICBcImNyb3BcIlxuICAgICAgXSxcbiAgICAgIFtcbiAgICAgICAgVC5zdW1tYXJpemUoe1xuICAgICAgICAgIHZvcF9hbnk6IFQuc3VtKFwidm9wXCIpXG4gICAgICAgIH0pXG4gICAgICBdXG4gICAgKVxuICApO1xuXG4gIGNvbnN0IF9kYXRhV2l0aEFueUNvbHVtbiA9IFQudGlkeShcbiAgICBkYXRhX2hhemFyZFZvUCxcbiAgICBULmxlZnRKb2luKF9hbnlEYXRhLCB7XG4gICAgICBieTogW1xuICAgICAgICBcImFkbWluMF9uYW1lXCIsXG4gICAgICAgIFwiYWRtaW4xX25hbWVcIixcbiAgICAgICAgXCJhZG1pbjJfbmFtZVwiLFxuICAgICAgICBcInNjZW5hcmlvXCIsXG4gICAgICAgIFwidGltZWZyYW1lXCIsXG4gICAgICAgIFwiY3JvcFwiLFxuICAgICAgICBcInNldmVyaXR5XCJcbiAgICAgIF1cbiAgICB9KVxuICApO1xuXG4gIGNvbnN0IGRhdGEgPSBfZGF0YVdpdGhBbnlDb2x1bW47XG4gIGNvbnN0IGRhdGFBbnkgPSBkYXRhLmZpbHRlcigoZCkgPT4gZC5oYXphcmQgPT0gXCJhbnlcIik7IC8vIGNvbWJpbmVkXG4gIGNvbnN0IGRhdGFCYXJzID0gW1xuICAgIC4uLmRhdGEuZmlsdGVyKChkKSA9PiBkLmhhemFyZCAhPT0gXCJhbnlcIiAmJiBkLnZvcCAhPT0gMCkgLy8gcmVtb3ZlIHRoZSBjb21iaW5lZCBoYXphcmRcbiAgXTtcbiAgY29uc3QgeURvbWFpbiA9IGNyb3BOYW1lc1xuICAgIC5maWx0ZXIoKGQpID0+IHtcbiAgICAgIGNvbnN0IGF2YWlsYWJsZUNyb3BzID0gXy51bmlxKGRhdGFCYXJzLm1hcCgoZCkgPT4gZC5jcm9wKSk7XG4gICAgICByZXR1cm4gYXZhaWxhYmxlQ3JvcHMuaW5jbHVkZXMoZC5jcm9wKTtcbiAgICB9KVxuICAgIC5zb3J0KChhLGIpID0+IHtcbiAgICAgIC8vIHNvcnQgYnkgdHlwZSwgdGhlbiBuYW1lXG4gICAgICBpZiAoYS50eXBlIDwgYi50eXBlKSByZXR1cm4gLTFcbiAgICAgIGlmIChhLnR5cGUgPiBiLnR5cGUpIHJldHVybiAxXG5cbiAgICAgIGlmIChhLmNyb3BOYW1lIDwgYi5jcm9wTmFtZSkgcmV0dXJuIC0xXG4gICAgICBpZiAoYS5jcm9wTmFtZSA+IGIuY3JvcE5hbWUpIHJldHVybiAxXG5cbiAgICAgIHJldHVybiAwXG4gICAgfSlcbiAgICAubWFwKChkKSA9PiBkLmNyb3BOYW1lKTtcbiAgY29uc3Qgdm9wQ2FwdGlvbiA9IF9sYW5nKG5iVGV4dC52b3BOb3RlTWQuY2FwdGlvbik7XG5cbiAgcmV0dXJuIFBsb3QucGxvdCh7XG4gICAgd2lkdGg6IDEyMDAsXG4gICAgaGVpZ2h0OiA4NTAsXG4gICAgbWFyZ2luTGVmdCxcbiAgICBtYXJnaW5SaWdodDogODUsXG4gICAgY2FwdGlvbjogdm9wQ2FwdGlvbixcbiAgICBjb2xvcjoge1xuICAgICAgZG9tYWluOiBoYXphcmRQbG90TG9va3VwLmNvbG9yLmRvbWFpbixcbiAgICAgIHJhbmdlOiBoYXphcmRQbG90TG9va3VwLmNvbG9yLnJhbmdlLFxuICAgICAgbGVnZW5kOiB0cnVlXG4gICAgfSxcbiAgICB4OiB7XG4gICAgICB0aWNrczogMSxcbiAgICAgIGF4aXM6IFwidG9wXCIsXG4gICAgICBkb21haW46IFswLCAxMDBdLFxuICAgICAgZ3JpZDogdHJ1ZSxcbiAgICAgIGxhYmVsOiB4TGFiZWxcbiAgICB9LFxuICAgIHk6IHtcbiAgICAgIGRvbWFpbjogeURvbWFpbixcbiAgICAgIGxhYmVsOiBudWxsXG4gICAgfSxcbiAgICBtYXJrczogW1xuICAgICAgLy8gbWFpbiB5LWF4aXNcbiAgICAgIFBsb3QuYXhpc1koe1xuICAgICAgICB0aWNrU2l6ZTogMFxuICAgICAgfSksXG4gICAgICAvLyBwb2ludGVyIHdoaXRlLW91dFxuICAgICAgUGxvdC5heGlzWShcbiAgICAgICAgUGxvdC5wb2ludGVyWSh7XG4gICAgICAgICAgZmlsbDogXCJ3aGl0ZVwiLFxuICAgICAgICAgIHRleHRTdHJva2U6IFwid2hpdGVcIixcbiAgICAgICAgICB0ZXh0U3Ryb2tlV2lkdGg6IDIsXG4gICAgICAgICAgdGlja1NpemU6IDBcbiAgICAgICAgfSlcbiAgICAgICksXG4gICAgICAvLyBib2xkIHBvaW50ZXJcbiAgICAgIFBsb3QuYXhpc1koXG4gICAgICAgIFBsb3QucG9pbnRlclkoe1xuICAgICAgICAgIGZvbnRXZWlnaHQ6IFwiYm9sZFwiLFxuICAgICAgICAgIHRpY2tTaXplOiAwXG4gICAgICAgIH0pXG4gICAgICApLFxuICAgICAgLy8gaGF6YXJkIGNvbXBvbmVudCBiYXJzXG4gICAgICBQbG90LmJhclgoXG4gICAgICAgIGRhdGFCYXJzLFxuICAgICAgICBQbG90LnN0YWNrWChcbiAgICAgICAgICB7IG9yZGVyOiBoYXphcmRQbG90TG9va3VwLmNvbG9yLmRvbWFpbiB9LFxuICAgICAgICAgIHtcbiAgICAgICAgICAgIHg6IChkKSA9PiAoZC52b3AgLyBkLnZvcF90b3RhbCkgKiAxMDAsXG4gICAgICAgICAgICB5OiAoZCkgPT4gaGF6YXJkUGxvdExvb2t1cC5jcm9wc1tkLmNyb3BdLFxuICAgICAgICAgICAgZmlsbDogKGQpID0+IGhhemFyZFBsb3RMb29rdXAubmFtZXNbZC5oYXphcmRdLFxuICAgICAgICAgICAgc3Ryb2tlOiBcIiNmZmZcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAwLjI1XG4gICAgICAgICAgfVxuICAgICAgICApXG4gICAgICApLFxuICAgICAgLy8gdG9vbHRpcFxuICAgICAgUGxvdC50aXAoXG4gICAgICAgIGRhdGFCYXJzLFxuICAgICAgICBQbG90LnBvaW50ZXJZKFxuICAgICAgICAgIFBsb3Quc3RhY2tYKFxuICAgICAgICAgICAgeyBvcmRlcjogaGF6YXJkUGxvdExvb2t1cC5jb2xvci5kb21haW4gfSxcbiAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgeDogKGQpID0+IChkLnZvcCAvIGQudm9wX3RvdGFsKSAqIDEwMCxcbiAgICAgICAgICAgICAgeTogKGQpID0+IGhhemFyZFBsb3RMb29rdXAuY3JvcHNbZC5jcm9wXSxcbiAgICAgICAgICAgICAgZmlsbDogKGQpID0+IGhhemFyZFBsb3RMb29rdXAubmFtZXNbZC5oYXphcmRdLFxuICAgICAgICAgICAgICBjaGFubmVsczoge1xuICAgICAgICAgICAgICAgIHBlcmM6IHtcbiAgICAgICAgICAgICAgICAgIGxhYmVsOiBsYWJlbFBlcmMsXG4gICAgICAgICAgICAgICAgICB2YWx1ZTogKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcGVyY2VudCA9IGZvcm1hdFBlcmNlbnRXaG9sZShkLnZvcF9hbnkgLyBkLnZvcF90b3RhbCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZvcCA9IGZvcm1hdEludERvbGxhcih7bG9jYWxlOiBsYW5ndWFnZS5sb2NhbGV9KShkLnZvcF9hbnkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7cGVyY2VudH0gKCR7dm9wfSlgO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgLy8gdmFsdWU6IChkKSA9PiBmb3JtYXRVU0QoZC52b3BfYW55KVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgaGF6YXJkOiB7XG4gICAgICAgICAgICAgICAgICBsYWJlbDogbGFiZWxIYXphcmQsXG4gICAgICAgICAgICAgICAgICB2YWx1ZTogKGQpID0+IGhhemFyZFBsb3RMb29rdXAubmFtZXNbZC5oYXphcmRdXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB2b3A6IHtcbiAgICAgICAgICAgICAgICAgIGxhYmVsOiBsYWJlbFZvcCxcbiAgICAgICAgICAgICAgICAgIHZhbHVlOiAoZCkgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBwZXJjZW50ID0gZm9ybWF0UGVyY2VudFdob2xlKGQudm9wIC8gZC52b3BfdG90YWwpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB2b3AgPSBmb3JtYXRJbnREb2xsYXIoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSkoZC52b3ApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gYCR7cGVyY2VudH0gKCR7dm9wfSlgO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgZm9ybWF0OiB7XG4gICAgICAgICAgICAgICAgeDogZmFsc2UsXG4gICAgICAgICAgICAgICAgeTogZmFsc2UsXG4gICAgICAgICAgICAgICAgZmlsbDogZmFsc2UsXG4gICAgICAgICAgICAgICAgdm9wOiB0cnVlLFxuICAgICAgICAgICAgICAgIGhhemFyZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICBwZXJjOiB0cnVlXG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIGxpbmVXaWR0aDogNTBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICApXG4gICAgICAgIClcbiAgICAgICksXG4gICAgICAvLyB0b3RhbCBWb1AsIHNpZGViYXIgaGlnaGxpZ2h0XG4gICAgICBQbG90LnRleHRYKFxuICAgICAgICBkYXRhQW55LFxuICAgICAgICBQbG90LnBvaW50ZXJZKHtcbiAgICAgICAgICB4OiAxMDAsXG4gICAgICAgICAgeTogKGQpID0+IGhhemFyZFBsb3RMb29rdXAuY3JvcHNbZC5jcm9wXSxcbiAgICAgICAgICB0ZXh0OiAoZCkgPT4ge1xuICAgICAgICAgICAgY29uc3QgdmFsdWUgPSBmb3JtYXRJbnREb2xsYXIoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSkoZC52b3BfdG90YWwpO1xuICAgICAgICAgICAgcmV0dXJuIGAke3ZhbHVlfWA7XG4gICAgICAgICAgfSxcbiAgICAgICAgICB0ZXh0QW5jaG9yOiBcInN0YXJ0XCIsXG4gICAgICAgICAgZHg6IDVcbiAgICAgICAgfSlcbiAgICAgIClcbiAgICBdXG4gIH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImJ1aWxkSW5saW5lRG93bmxvYWRCdXR0b24oXG4gIGRhdGFfaGF6YXJkVm9QLFxuICBfbGFuZyhkb3dubG9hZF90cmFuc2xhdGlvbiksXG4gIGBDcm9wQ2xpbWF0ZUV4cG9zdXJlXyR7c2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUubGFiZWwucmVwbGFjZSgvXFxzL2csIFwiXCIpfWAsXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgdGV4dCA9IF9sYW5nKG5iVGV4dC5jbGltYXRlUmlza3MuaGF6YXJkSW1wYWN0LmgxKVxuICByZXR1cm4gbWRgIyMgJHt0ZXh0fWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRleHQgPSBfbGFuZyhuYlRleHQuY2xpbWF0ZVJpc2tzLmhhemFyZEltcGFjdC5pbnRybylcbiAgcmV0dXJuIG1kYCR7dGV4dH1gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gcGlja2luZyBoYXphcmRcbnZpZXdvZiBzZWxlY3RIYXphcmQgPSB7XG4gIGNvbnN0IGRhdGEgPSBuZXcgTWFwKFxuICAgIE9iamVjdC5rZXlzKGhhemFyZFBsb3RMb29rdXAubmFtZXMpXG4gICAgLmZpbHRlcihkID0+IGQgIT09ICdubyBoYXphcmQnKSAvLyByZW1vdmUgbm8gaGF6YXJkIG9wdGlvblxuICAgIC5tYXAoZCA9PiBbaGF6YXJkUGxvdExvb2t1cC5uYW1lc1tkXSwgZF0pXG4gICk7XG4gIHJldHVybiBJbnB1dHMuc2VsZWN0KGRhdGEsIHtcbiAgICB2YWx1ZTogJ2RyeScsXG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5jbGltYXRlUmlza3MuaGF6YXJkSW1wYWN0LmlucHV0cy5kcm9wZG93bkhhemFyZC5sYWJlbClcbiAgfSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCB0ZW1wbGF0ZSA9IF9sYW5nKG5iVGV4dC5jbGltYXRlUmlza3MuaGF6YXJkSW1wYWN0LnBsb3RzLmNyb3BzLmhlYWRlcilcbiAgY29uc3QgaXRlbXMgPSBbe25hbWU6IFwiaGF6YXJkX3N0cmluZ1wiLCB2YWx1ZTogaGF6YXJkUGxvdExvb2t1cC5uYW1lc1tzZWxlY3RIYXphcmRdLnRvTG93ZXJDYXNlKCl9XVxuICBjb25zdCBmb3JtYXQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKHRlbXBsYXRlLCBpdGVtcylcbiAgcmV0dXJuIG1kYCMjIyAke2Zvcm1hdH1gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBkYXRhID0gZGF0YV9oYXphcmRWb1AuZmlsdGVyKChkKSA9PiB7XG4gICAgcmV0dXJuIChcbiAgICAgIGQuaGF6YXJkID09IHNlbGVjdEhhemFyZCAmJlxuICAgICAgZC52b3AgIT09IDAgJiZcbiAgICAgIHJpc2tEYXRhVHlwZXMuY3JvcC5jcm9wLmluY2x1ZGVzKGQuY3JvcClcbiAgICApOyAvLyBsb29rdXAgY3JvcCB0eXBlXG4gIH0pO1xuICBjb25zdCBtYXJnaW5MZWZ0ID0gX2xhbmcoe2VuOiAxMTAsIGZyOiAxMjB9KTtcbiAgcmV0dXJuIG1ha2VUb3BDcm9wQmFyQ2hhcnQoZGF0YSwge21hcmdpbkxlZnR9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJidWlsZElubGluZURvd25sb2FkQnV0dG9uKFxuICBkYXRhX2hhemFyZFZvUC5maWx0ZXIoKGQpID0+IHtcbiAgICByZXR1cm4gKFxuICAgICAgZC5oYXphcmQgPT0gc2VsZWN0SGF6YXJkICYmXG4gICAgICBkLnZvcCAhPT0gMCAmJlxuICAgICAgcmlza0RhdGFUeXBlcy5jcm9wLmNyb3AuaW5jbHVkZXMoZC5jcm9wKVxuICAgICk7XG4gIH0pLFxuICBfbGFuZyhkb3dubG9hZF90cmFuc2xhdGlvbiksXG4gIGBDcm9wUmlza18ke3NlbGVjdEhhemFyZH1gLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRlbXBsYXRlID0gX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QucGxvdHMubGl2ZXN0b2NrLmhlYWRlcilcbiAgY29uc3QgaXRlbXMgPSBbe25hbWU6IFwiaGF6YXJkX3N0cmluZ1wiLCB2YWx1ZTogaGF6YXJkUGxvdExvb2t1cC5uYW1lc1tzZWxlY3RIYXphcmRdLnRvTG93ZXJDYXNlKCl9XVxuICBjb25zdCBmb3JtYXQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKHRlbXBsYXRlLCBpdGVtcylcbiAgcmV0dXJuIG1kYCMjIyAke2Zvcm1hdH1gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTI5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBkYXRhID0gZGF0YV9oYXphcmRWb1AuZmlsdGVyKChkKSA9PiB7XG4gICAgcmV0dXJuIChcbiAgICAgIGQuaGF6YXJkID09IHNlbGVjdEhhemFyZCAmJlxuICAgICAgZC52b3AgIT09IDAgJiZcbiAgICAgIHJpc2tEYXRhVHlwZXMuY3JvcC5saXZlc3RvY2suaW5jbHVkZXMoZC5jcm9wKVxuICAgICk7IC8vIGxvb2t1cCBjcm9wIHR5cGVcbiAgfSk7XG4gIGNvbnN0IG1hcmdpbkxlZnQgPSBfbGFuZyh7ZW46IDExMCwgZnI6IDE1MH0pO1xuICByZXR1cm4gbWFrZVRvcENyb3BCYXJDaGFydChkYXRhLCB7bWFyZ2luTGVmdH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImJ1aWxkSW5saW5lRG93bmxvYWRCdXR0b24oXG4gIGRhdGFfaGF6YXJkVm9QLmZpbHRlcigoZCkgPT4ge1xuICAgIHJldHVybiAoXG4gICAgICBkLmhhemFyZCA9PSBzZWxlY3RIYXphcmQgJiZcbiAgICAgIGQudm9wICE9PSAwICYmXG4gICAgICByaXNrRGF0YVR5cGVzLmNyb3AubGl2ZXN0b2NrLmluY2x1ZGVzKGQuY3JvcClcbiAgICApO1xuICB9KSxcbiAgX2xhbmcoZG93bmxvYWRfdHJhbnNsYXRpb24pLFxuICBgTGl2ZXN0b2NrUmlza18ke3NlbGVjdEhhemFyZH1gLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IGZvcm1hdCA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXMoXG4gICAgX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaW5zaWdodHMudGl0bGUpLFxuICAgIFtcbiAgICAgIHsgbmFtZTogXCJpbnNpZ2h0X3N0cmluZ1wiLCB2YWx1ZTogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQubGFiZWxzLnF1aWNrSW5zaWdodHMpIH0sXG4gICAgICB7IG5hbWU6IFwiYWRtaW5fc2VsZWN0aW9uXCIsIHZhbHVlOiBnZXRBZG1pblNlbGVjdGlvbigpLmxhYmVsIH0sXG4gICAgICB7IG5hbWU6IFwic2NlbmFyaW9cIiwgdmFsdWU6IHNlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lLmxhYmVsIH1cbiAgICBdXG4gICk7XG4gIHJldHVybiBtZGAjIyMgJHtmb3JtYXR9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3Qgc2VsZWN0ZWRIYXphcmQgPSBoYXphcmRQbG90TG9va3VwLm5hbWVzW3NlbGVjdEhhemFyZF1cbiAgY29uc3QgbGFuZ0xvb2t1cCA9IHtcbiAgICBoYXphcmQ6IHNlbGVjdGVkSGF6YXJkLFxuICAgIGhhemFyZEJsdXJiOiBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgICAgX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaW5zaWdodHMuaGF6YXJkQmx1cmIpLFxuICAgICAgW3tuYW1lOiBcImhhemFyZF9zdHJpbmdcIiwgdmFsdWU6IHNlbGVjdGVkSGF6YXJkfV1cbiAgICApLFxuICAgIGxhYmVsczoge1xuICAgICAgdG90YWxWb3BDcm9wOiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaW5zaWdodHMubGFiZWxzLnRvdGFsVm9wQ3JvcFxuICAgICAgKSxcbiAgICAgIHRvdGFsVm9wTGl2ZXN0b2NrOiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaW5zaWdodHMubGFiZWxzLnRvdGFsVm9wTGl2ZXN0b2NrXG4gICAgICApLFxuICAgICAgZXhwb3N1cmVDcm9wOiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaW5zaWdodHMubGFiZWxzLmV4cG9zdXJlQ3JvcFxuICAgICAgKSxcbiAgICAgIGV4cG9zdXJlTGl2ZXN0b2NrOiBfbGFuZyhcbiAgICAgICAgbmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaW5zaWdodHMubGFiZWxzLmV4cG9zdXJlTGl2ZXN0b2NrXG4gICAgICApXG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGNyb3AgPSBpbnNpZ2h0X3RvdGFsRXhwb3NlZFZvcC5maWx0ZXIoXG4gICAgKGQpID0+IGQudG90YWxFeHBvc2VkVm9wICE9PSAwICYmIGQuY3JvcFR5cGUgPT0gXCJjcm9wXCJcbiAgKT8uWzBdPy5bXCJ0b3RhbEV4cG9zZWRWb3BcIl07XG4gIGNvbnN0IGxpdmVzdG9jayA9IGluc2lnaHRfdG90YWxFeHBvc2VkVm9wLmZpbHRlcihcbiAgICAoZCkgPT4gZC50b3RhbEV4cG9zZWRWb3AgIT09IDAgJiYgZC5jcm9wVHlwZSA9PSBcImxpdmVzdG9ja1wiXG4gICk/LlswXT8uW1widG90YWxFeHBvc2VkVm9wXCJdO1xuXG4gIGNvbnN0IHRvcENyb3AgPSBpbnNpZ2h0X3RvcENyb3BzLmZpbHRlcihcbiAgICAoZCkgPT4gZC52b3AgIT09IDAgJiYgZC5jcm9wVHlwZSA9PSBcImNyb3BcIlxuICApPy5bMF07XG4gIGNvbnN0IHRvcExpdmVzdG9jayA9IGluc2lnaHRfdG9wQ3JvcHMuZmlsdGVyKFxuICAgIChkKSA9PiBkLnZvcCAhPT0gMCAmJiBkLmNyb3BUeXBlID09IFwibGl2ZXN0b2NrXCJcbiAgKT8uWzBdO1xuXG4gIGNvbnN0IG1pc3NpbmdWYWx1ZSA9IFwiLS0tXCI7XG5cbiAgZnVuY3Rpb24gc2hvd1Jlc3VsdCh2YWx1ZSwgZm9ybWF0KSB7XG4gICAgaWYgKHZhbHVlID09PSBudWxsIHx8IHZhbHVlID09PSB1bmRlZmluZWQpIHJldHVybiBtaXNzaW5nVmFsdWU7XG4gICAgcmV0dXJuIGZvcm1hdCh2YWx1ZSk7XG4gIH1cblxuICBjb25zdCB0b3BDcm9wU3RyaW5nID1cbiAgICB0b3BDcm9wICE9PSB1bmRlZmluZWRcbiAgICAgID8gYCoqJHtoYXphcmRQbG90TG9va3VwLmNyb3BzW3RvcENyb3A/LltcImNyb3BcIl1dfSoqICgqKiR7Zm9ybWF0SW50RG9sbGFyKHtsb2NhbGU6IGxhbmd1YWdlLmxvY2FsZX0pKFxuICAgICAgICAgIHRvcENyb3A/LltcInZvcFwiXVxuICAgICAgICApfSoqKWBcbiAgICAgIDogYCoqJHttaXNzaW5nVmFsdWV9KipgO1xuICBjb25zdCB0b3BMaXZlc3RvY2tTdHJpbmcgPVxuICAgIHRvcExpdmVzdG9jayAhPT0gdW5kZWZpbmVkXG4gICAgICA/IGAqKiR7XG4gICAgICAgICAgaGF6YXJkUGxvdExvb2t1cC5jcm9wc1t0b3BMaXZlc3RvY2s/LltcImNyb3BcIl1dXG4gICAgICAgIH0qKiAoKioke2Zvcm1hdEludERvbGxhcih7bG9jYWxlOiBsYW5ndWFnZS5sb2NhbGV9KSh0b3BMaXZlc3RvY2s/LltcInZvcFwiXSl9KiopYFxuICAgICAgOiBgKioke21pc3NpbmdWYWx1ZX0qKmA7XG5cbiAgcmV0dXJuIG1kYCR7bGFuZ0xvb2t1cC5oYXphcmRCbHVyYn1cblxuLSAke2xhbmdMb29rdXAubGFiZWxzLnRvdGFsVm9wQ3JvcH06ICoqJHtzaG93UmVzdWx0KGNyb3AsIGZvcm1hdEludERvbGxhcih7bG9jYWxlOiBsYW5ndWFnZS5sb2NhbGV9KSl9Kipcbi0gJHtsYW5nTG9va3VwLmxhYmVscy50b3RhbFZvcExpdmVzdG9ja306ICoqJHtzaG93UmVzdWx0KFxuICAgIGxpdmVzdG9jayxcbiAgICBmb3JtYXRJbnREb2xsYXIoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSlcbiAgKX0qKlxuLSAke2xhbmdMb29rdXAubGFiZWxzLmV4cG9zdXJlQ3JvcH06ICR7dG9wQ3JvcFN0cmluZ31cbi0gJHtsYW5nTG9va3VwLmxhYmVscy5leHBvc3VyZUxpdmVzdG9ja306ICR7dG9wTGl2ZXN0b2NrU3RyaW5nfVxuYDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IGludHJvID0gX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaW5zaWdodHMuYmx1cmJCaWdnZXN0SGF6YXJkKVxuICByZXR1cm4gbWRgJHtpbnRyb31cbi0gKioke2hhemFyZFBsb3RMb29rdXAubmFtZXNbaW5zaWdodF9yYW5rZWRIYXphcmRWb3BUb3RhbHM/LlswXT8uWydoYXphcmQnXV19Kio6ICoqJHtmb3JtYXRJbnREb2xsYXIoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSkoaW5zaWdodF9yYW5rZWRIYXphcmRWb3BUb3RhbHM/LlswXT8uWyd0b3RhbFZvcCddKX0qKlxuLSAqKiR7aGF6YXJkUGxvdExvb2t1cC5uYW1lc1tpbnNpZ2h0X3JhbmtlZEhhemFyZFZvcFRvdGFscz8uWzFdPy5bJ2hhemFyZCddXX0qKjogKioke2Zvcm1hdEludERvbGxhcih7bG9jYWxlOiBsYW5ndWFnZS5sb2NhbGV9KShpbnNpZ2h0X3JhbmtlZEhhemFyZFZvcFRvdGFscz8uWzFdPy5bJ3RvdGFsVm9wJ10pfSoqYFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0zNCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgdGV4dCA9IF9sYW5nKG5iVGV4dC5hZGFwdGl2ZUNhcGFjaXRpZXMuaDEpXG4gIHJldHVybiBtZGAjICR7dGV4dH1gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBhZG1pblNlbGVjdGlvbiA9IGdldEFkbWluU2VsZWN0aW9uTGFiZWxXaXRoUGFyZW4oe1xuICAgIGFkbWluMExhYmVsOiBfbGFuZyhcbiAgICAgIHRkLmFkbWluMF9uYW1lLnZhbHVlcz8uW2dldEFkbWluU2VsZWN0aW9uQWRtaW4wKCkudmFsdWUgPz8gXCJTU0FcIl1bXCJhcnRpY2xlM1wiXVxuICAgICksXG4gICAgYWRtaW5TdWJsYWJlbDogZ2V0QWRtaW5TZWxlY3Rpb24oKS5sYWJlbFxuICB9KTtcbiAgY29uc3QgZm9ybWF0ID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICBfbGFuZyhuYlRleHQuYWRhcHRpdmVDYXBhY2l0aWVzLmludHJvKSxcbiAgICBbe25hbWU6IFwiYWRtaW5fc2VsZWN0aW9uXCIsIHZhbHVlOiBhZG1pblNlbGVjdGlvbn1dXG4gIClcbiAgcmV0dXJuIG1kYCR7Zm9ybWF0fWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBmb3JtYXQgYWRtaW4gc2VsZWN0aW9uc1xuLy8gYmluZCB0byBhcHBlbmRpeCBpbnB1dHMsIGFkZCB0ZW1wbGF0ZSB0byBmb3JtYXRcbklucHV0cy5mb3JtKFxuICBbXG4gICAgSW5wdXRzLmJpbmQoXG4gICAgICBJbnB1dHMuc2VsZWN0KGRhdGFBZG1pbjAsIHsgbGFiZWw6IGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4wLCBmb3JtYXQ6IHggPT4geC5sYWJlbCB9KSxcbiAgICAgIHZpZXdvZiBzZWxlY3RBZG1pbjBcbiAgICApLFxuICAgIElucHV0cy5iaW5kKFxuICAgICAgSW5wdXRzLnNlbGVjdChkYXRhQWRtaW4xLCB7IGxhYmVsOiBhZG1pblJlZ2lvbnMubGFiZWxzLmFkbWluMSwgZm9ybWF0OiB4ID0+IHgubGFiZWwgfSksXG4gICAgICB2aWV3b2Ygc2VsZWN0QWRtaW4xXG4gICAgKSxcbiAgICBJbnB1dHMuYmluZChcbiAgICAgIElucHV0cy5zZWxlY3QoZGF0YUFkbWluMiwgeyBsYWJlbDogYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjIsIGZvcm1hdDogeCA9PiB4LmxhYmVsIH0pLFxuICAgICAgdmlld29mIHNlbGVjdEFkbWluMlxuICAgIClcbiAgXSxcbiAge1xuICAgIHRlbXBsYXRlOiBhZG1pbkZvcm1UZW1wbGF0ZVxuICB9XG4pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTM3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZGVmaW5lIGNob2ljZXMgZm9yIHRoZSBkYXRhIHZhbHVlXG52aWV3b2Ygc2VsZWN0QWNEYXRhVHlwZU5ldyA9IHtcbiAgY29uc3Qgb3B0aW9ucyA9IGRhdGFMYXllck9wdGlvbnNBZGFwdGl2ZUNhcGFjaXRpZXM7XG4gIFxuICByZXR1cm4gSW5wdXRzLnJhZGlvKG9wdGlvbnMsIHtcbiAgICB3aWR0aDogMzAwLFxuICAgIGxhYmVsOiBfbGFuZyhuYlRleHQuYWRhcHRpdmVDYXBhY2l0aWVzLmlucHV0cy5tYXBMYXllci5sYWJlbCksXG4gICAgZm9ybWF0OiAoeCkgPT4geC5sYWJlbCxcbiAgICB2YWx1ZTogb3B0aW9ucy5maW5kKCh0KSA9PiB0LmtleSA9PT0gXCJwb3ZcIiksXG4gICAgc29ydDogdHJ1ZVxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJwbG90Q2hvcm9wbGV0aEFkYXB0aXZlQ2FwYWNpdHkxID0ge1xuICBjb25zdCBkYXRhID0gbWFwRmVhdHVyZXNBZGFwdGl2ZUNhcGFjaXR5OyAvLyBnZW8sIHdpdGggYm91bmQgZGF0YVxuICBjb25zdCBzZWxlY3RvciA9IHNlbGVjdEFjRGF0YVR5cGVOZXc7XG4gIGNvbnN0IG9wdGlvbnMgPSBkYXRhTGF5ZXJPcHRpb25zQWRhcHRpdmVDYXBhY2l0aWVzO1xuXG4gIGNvbnN0IGZpbGxlciA9IHNlbGVjdEFjRGF0YVR5cGVOZXcua2V5ID09PSBcImVkdVwiID8gKGMpID0+IGMgOiB0cmFuc2Zvcm1QZXJjZW50XG5cbiAgZnVuY3Rpb24gX2dldE9wdGlvbihrZXksIGRhdGEgPSBvcHRpb25zKSB7XG4gICAgcmV0dXJuIGRhdGEuZmluZCgoeCkgPT4geC5rZXkgPT0ga2V5KTtcbiAgfVxuXG4gIGNvbnN0IG1pc3NpbmdEYXRhTGFiZWwgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5taXNzaW5nTWFwRGF0YUJsdXJiKSxcbiAgICBbeyBuYW1lOiBcImRhdGFfbGFiZWxcIiwgdmFsdWU6IHNlbGVjdG9yLmxhYmVsIH1dXG4gICk7XG5cbiAgcmV0dXJuIFBsb3QucGxvdCh7XG4gICAgY2FwdGlvbjogbWlzc2luZ0RhdGFMYWJlbCxcbiAgICBtYXJnaW5Cb3R0b206IDIwLFxuICAgIHdpZHRoOiBtYXBXaWR0aCxcbiAgICBoZWlnaHQ6IDU1MCxcbiAgICBwcm9qZWN0aW9uOiB7XG4gICAgICB0eXBlOiBcImF6aW11dGhhbC1lcXVhbC1hcmVhXCIsXG4gICAgICBkb21haW46IHtcbiAgICAgICAgdHlwZTogXCJGZWF0dXJlQ29sbGVjdGlvblwiLFxuICAgICAgICBmZWF0dXJlczogZGF0YVxuICAgICAgfVxuICAgIH0sXG4gICAgY29sb3I6IHtcbiAgICAgIC8vIHNjaGVtZTogJ0NpdmlkaXMnLFxuICAgICAgbGVnZW5kOiB0cnVlLFxuICAgICAgLy8gZG9tYWluOiBbMCwgMTAwXSxcbiAgICAgIHJhbmdlOlxuICAgICAgICBzZWxlY3Rvci5rZXkgPT09IFwicG92XCJcbiAgICAgICAgICA/IHNlbGVjdG9yLmNvbG9yRG9tYWluXG4gICAgICAgICAgOiBzZWxlY3Rvci5jb2xvckRvbWFpbi5zbGljZSgpLnJldmVyc2UoKSxcbiAgICAgIHVua25vd246IHNlbGVjdG9yLmNvbG9yVW5rbm93bixcbiAgICAgIGxhYmVsOiBzZWxlY3Rvci5sYWJlbExlZ2VuZFxuICAgIH0sXG4gICAgbWFya3M6IFtcbiAgICAgIC8vIGdlbyBkYXRhXG4gICAgICBQbG90LmdlbyhkYXRhLCB7XG4gICAgICAgIC8vIGNvbnZlcnQgbm9uLW51bGwgdG8gcGVyY2VudFxuICAgICAgICBmaWxsOiAoZCkgPT4gZmlsbGVyKGQucHJvcGVydGllcy5kYXRhW3NlbGVjdG9yLmRhdGFDb2x1bW5dKSxcbiAgICAgICAgc3Ryb2tlOiBcIiNmZmZcIixcbiAgICAgICAgc3Ryb2tlV2lkdGg6IDAuNVxuICAgICAgfSksXG4gICAgICAvLyBhZG1pbjIgaGlnaGxpZ2h0XG4gICAgICAvLyBpZiBBZG1pbiBzZWxlY3Rpb24gaW5jbHVkZXMgYWRtaW4yLCBoaWdobGlnaHQgc2VjdGlvblxuICAgICAgUGxvdC5nZW8oXG4gICAgICAgIGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjIudmFsdWVcbiAgICAgICAgICA/IGRhdGEuZmlsdGVyKFxuICAgICAgICAgICAgICAoZCkgPT4gZC5wcm9wZXJ0aWVzLmFkbWluMl9uYW1lID09IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjIudmFsdWVcbiAgICAgICAgICAgIClcbiAgICAgICAgICA6IFtdLFxuICAgICAgICB7XG4gICAgICAgICAgZmlsbDogbnVsbCxcbiAgICAgICAgICBzdHJva2U6IFwiIzMzM1wiLFxuICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLjVcbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIC8vIGdlbyBwb2ludGVyXG4gICAgICBQbG90LmdlbyhcbiAgICAgICAgZGF0YSxcbiAgICAgICAgUGxvdC5wb2ludGVyKFxuICAgICAgICAgIFBsb3QuY2VudHJvaWQoe1xuICAgICAgICAgICAgc3Ryb2tlOiBcIiMzMzNcIixcbiAgICAgICAgICAgIHN0cm9rZVdpZHRoOiAxLjVcbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApLFxuICAgICAgLy8gdG9vbHRpcFxuICAgICAgUGxvdC50aXAoXG4gICAgICAgIGRhdGEsXG4gICAgICAgIFBsb3QucG9pbnRlcihcbiAgICAgICAgICBQbG90LmNlbnRyb2lkKHtcbiAgICAgICAgICAgIGxpbmVXaWR0aDogSW5maW5pdHksXG4gICAgICAgICAgICBjaGFubmVsczoge1xuICAgICAgICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICAgICAgbGFiZWw6XG4gICAgICAgICAgICAgICAgICAvLyBsYWJlbCBmb3IgcmVnaW9uLCBieSBhZG1pbiBzZWxlY3Rpb25cbiAgICAgICAgICAgICAgICAgIC8vIHBsb3QtbGV2ZWwgc28gaW5wdXRzIGRvbid0IHJlbG9hZFxuICAgICAgICAgICAgICAgICAgYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZVxuICAgICAgICAgICAgICAgICAgICA/IGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4yXG4gICAgICAgICAgICAgICAgICAgIDogYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjAsXG4gICAgICAgICAgICAgICAgdmFsdWU6IChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCB0cmFuc2xhdGVkID0gX2xhbmcodGQuYWRtaW4wX25hbWUudmFsdWVzPy5bZC5wcm9wZXJ0aWVzLmFkbWluX25hbWVdKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB0cmFuc2xhdGVkID8/IGQucHJvcGVydGllcy5hZG1pbl9uYW1lXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBwZXJjZW50OiB7XG4gICAgICAgICAgICAgICAgLy8gc3BlY2lmaWMgc2VsZWN0ZWQgdmFsdWVcbiAgICAgICAgICAgICAgICBsYWJlbDogc2VsZWN0b3IubGFiZWwsXG4gICAgICAgICAgICAgICAgdmFsdWU6IChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBkYXRhQ29sdW1uID0gc2VsZWN0b3IuZGF0YUNvbHVtbjtcbiAgICAgICAgICAgICAgICAgIC8vIGNvbnN0IGRhdGEgPSBkLnByb3BlcnRpZXMuZGF0YVtkYXRhQ29sdW1uXVxuICAgICAgICAgICAgICAgICAgY29uc3QgZGF0YSA9IGZvcm1hdFBlcmNlbnROb1N5bWJvbChcbiAgICAgICAgICAgICAgICAgICAgdHJhbnNmb3JtUGVyY2VudChkLnByb3BlcnRpZXMuZGF0YVtkYXRhQ29sdW1uXSlcbiAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgIHRvdGFsUG9wdWxhdGlvbjoge1xuICAgICAgICAgICAgICAgIGxhYmVsOiBzZWxlY3Rvci5sYWJlbFBvcCxcbiAgICAgICAgICAgICAgICB2YWx1ZTogKGQpID0+XG4gICAgICAgICAgICAgICAgICBmb3JtYXROdW1Db21wYWN0U2hvcnQoe2xvY2FsZTogbGFuZ3VhZ2UubG9jYWxlfSkoZC5wcm9wZXJ0aWVzLmRhdGFbc2VsZWN0b3IucG9wQ29sdW1uXSlcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgYWNfcG92OiB7XG4gICAgICAgICAgICAgICAgbGFiZWw6IF9nZXRPcHRpb24oXCJwb3ZcIikubGFiZWwsXG4gICAgICAgICAgICAgICAgdmFsdWU6IChkKSA9PiB7XG4gICAgICAgICAgICAgICAgICBjb25zdCBkYXRhQ29sdW1uID0gX2dldE9wdGlvbihcInBvdlwiKS5kYXRhQ29sdW1uO1xuICAgICAgICAgICAgICAgICAgY29uc3QgcG92X3JhdGUgPSBmb3JtYXRQZXJjZW50Tm9TeW1ib2woXG4gICAgICAgICAgICAgICAgICAgIHRyYW5zZm9ybVBlcmNlbnQoZC5wcm9wZXJ0aWVzLmRhdGFbZGF0YUNvbHVtbl0pXG4gICAgICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGAke3Bvdl9yYXRlfSVgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBhY19lZHU6IHtcbiAgICAgICAgICAgICAgICBsYWJlbDogX2dldE9wdGlvbihcImVkdVwiKS5sYWJlbCxcbiAgICAgICAgICAgICAgICB2YWx1ZTogKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFDb2x1bW4gPSBfZ2V0T3B0aW9uKFwiZWR1XCIpLmRhdGFDb2x1bW47XG4gICAgICAgICAgICAgICAgICByZXR1cm4gYCR7ZC5wcm9wZXJ0aWVzLmRhdGFbZGF0YUNvbHVtbl0udG9GaXhlZCgyKX0gWXJzYFxuICAgICAgICAgICAgICAgICAgLy8gcmV0dXJuIGZvcm1hdFBlcmNlbnROb1N5bWJvbChcbiAgICAgICAgICAgICAgICAgIC8vICAgdHJhbnNmb3JtUGVyY2VudChkLnByb3BlcnRpZXMuZGF0YVtkYXRhQ29sdW1uXSlcbiAgICAgICAgICAgICAgICAgIC8vICk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBhY19mZW06IHtcbiAgICAgICAgICAgICAgICBsYWJlbDogX2dldE9wdGlvbihcImZlbVwiKS5sYWJlbCxcbiAgICAgICAgICAgICAgICB2YWx1ZTogKGQpID0+IHtcbiAgICAgICAgICAgICAgICAgIGNvbnN0IGRhdGFDb2x1bW4gPSBfZ2V0T3B0aW9uKFwiZmVtXCIpLmRhdGFDb2x1bW47XG4gICAgICAgICAgICAgICAgICByZXR1cm4gZm9ybWF0UGVyY2VudE5vU3ltYm9sKFxuICAgICAgICAgICAgICAgICAgICB0cmFuc2Zvcm1QZXJjZW50KGQucHJvcGVydGllcy5kYXRhW2RhdGFDb2x1bW5dKVxuICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmb3JtYXQ6IHtcbiAgICAgICAgICAgICAgbmFtZTogdHJ1ZSxcbiAgICAgICAgICAgICAgdG90YWxQb3B1bGF0aW9uOiB0cnVlLFxuICAgICAgICAgICAgICBhY19wb3Y6IHRydWUsXG4gICAgICAgICAgICAgIGFjX2VkdTogdHJ1ZSxcbiAgICAgICAgICAgICAgYWNfZmVtOiB0cnVlXG4gICAgICAgICAgICAgIC8vIHBlcmNlbnQ6IHRydWVcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KVxuICAgICAgICApXG4gICAgICApXG4gICAgXVxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMzkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJidWlsZElubGluZURvd25sb2FkQnV0dG9uKFxuICBkYXRhQWRhcHRpdmVDYXBhY2l0eSxcbiAgX2xhbmcoZG93bmxvYWRfdHJhbnNsYXRpb24pLFxuICBcIkFkYXB0aXZlQ2FwYWNpdHlNYXBcIixcbik7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCBmb3JtYXQgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5hZGFwdGl2ZUNhcGFjaXRpZXMuaW5zaWdodHMudGl0bGUpLFxuICAgIFtcbiAgICAgIHsgbmFtZTogXCJpbnNpZ2h0X3N0cmluZ1wiLCB2YWx1ZTogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQubGFiZWxzLnF1aWNrSW5zaWdodHMpIH0sXG4gICAgICB7IG5hbWU6IFwiYWRtaW5fc2VsZWN0aW9uXCIsIHZhbHVlOiBnZXRBZG1pblNlbGVjdGlvbigpLmxhYmVsIH0sXG4gICAgXVxuICApO1xuICByZXR1cm4gbWRgIyMgJHtmb3JtYXR9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InRleHREeW5hbWljSW5zaWdodHNfYWRhcHRpdmVDYXBhY2l0aWVzMiA9IHtcbiAgLy8gcmV0dXJuIG1kYFRPRE86IGJhc2VkIG9uIGljaWNsZSBkYXRhYFxuXG4gIC8vIGR5bmFtaWMgaW5zaWdodCBiYXNlZCBvbiBzZWxlY3RlZCByZWdpb25cblxuICBjb25zdCBhZG1pbjIgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlO1xuICBjb25zdCBhZG1pbjJNYWRMaWIgPSBhZGFwdGl2ZUNhcGFjaXR5SW5zaWdodE1hZExpYjIoXG4gICAgZHluYW1pY0luc2lnaHRzX2FkYXB0aXZlQ2FwYWNpdHkuaW5zaWdodHMuYWRtaW4yLFxuICAgIGFkbWluMlxuICApO1xuICBjb25zdCBhZG1pbjEgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlO1xuICBjb25zdCBhZG1pbjFNYWRMaWIgPSBhZGFwdGl2ZUNhcGFjaXR5SW5zaWdodE1hZExpYjIoXG4gICAgZHluYW1pY0luc2lnaHRzX2FkYXB0aXZlQ2FwYWNpdHkuaW5zaWdodHMuYWRtaW4xLFxuICAgIGFkbWluMVxuICApO1xuICBjb25zdCBhZG1pbjAgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLmxhYmVsID8/IGdsb2JhbFNlbGVjdGlvbi5sYWJlbDtcbiAgY29uc3QgYWRtaW4wSW5zaWdodHMgPSBkeW5hbWljSW5zaWdodHNfYWRhcHRpdmVDYXBhY2l0eS5pbnNpZ2h0cy5hZG1pbjA7XG4gIGNvbnN0IGFkbWluME1hZExpYiA9IGFkYXB0aXZlQ2FwYWNpdHlJbnNpZ2h0TWFkTGliMihcbiAgICBhZG1pbjBJbnNpZ2h0cyxcbiAgICBhZG1pbjBcbiAgKTtcblxuICBjb25zdCBsYW5nV2l0aGluQWRtaW4xID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICBfbGFuZyhuYlRleHQuYWRhcHRpdmVDYXBhY2l0aWVzLmluc2lnaHRzLm5lc3RlZExvY2F0aW9uQmx1cmIpLFxuICAgIFtcbiAgICAgIHsgbmFtZTogXCJhZG1pbl9pbm5lclwiLCB2YWx1ZTogYWRtaW4yIH0sXG4gICAgICB7IG5hbWU6IFwiYWRtaW5fb3V0ZXJcIiwgdmFsdWU6IGFkbWluMSB9XG4gICAgXVxuICApO1xuICBjb25zdCB3aXRoaW5BZG1pbjEgPSBhZG1pbjJcbiAgICA/IGAke2xhbmdXaXRoaW5BZG1pbjF9YFxuICAgIDogYGA7XG5cbiAgY29uc3QgbGFuZ1dpdGhpbkFkbWluMCA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXMoXG4gICAgX2xhbmcobmJUZXh0LmFkYXB0aXZlQ2FwYWNpdGllcy5pbnNpZ2h0cy5uZXN0ZWRMb2NhdGlvbkJsdXJiKSxcbiAgICBbXG4gICAgICB7IG5hbWU6IFwiYWRtaW5faW5uZXJcIiwgdmFsdWU6IGFkbWluMSB9LFxuICAgICAgeyBuYW1lOiBcImFkbWluX291dGVyXCIsIHZhbHVlOiBhZG1pbjAgfVxuICAgIF1cbiAgKTtcbiAgY29uc3Qgd2l0aGluQWRtaW4wID0gYWRtaW4xXG4gICAgPyBgJHtsYW5nV2l0aGluQWRtaW4wfWBcbiAgICA6IGBgO1xuXG4gIC8vIFRleHQgc2VjdGlvbnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGNvbnN0IGFkbWluMlRleHQgPSBtZGAke2FkbWluMk1hZExpYn1gO1xuXG4gIGNvbnN0IGFkbWluMVRleHQgPSBtZGAke3dpdGhpbkFkbWluMX0gJHthZG1pbjFNYWRMaWJ9YDtcblxuICBjb25zdCBhZG1pbjBUZXh0ID0gbWRgJHt3aXRoaW5BZG1pbjB9ICR7YWRtaW4wTWFkTGlifWA7XG5cbiAgLy8gRmluYWwgdGV4dCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmV0dXJuIG1kYCR7YWRtaW4yID8gYWRtaW4yVGV4dCA6IFwiXCJ9XG4ke2FkbWluMSA/IGFkbWluMVRleHQgOiBcIlwifVxuJHthZG1pbjBJbnNpZ2h0cyA/IGFkbWluMFRleHQgOiBcIlwifVxuYDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRleHQgPSBfbGFuZyhuYlRleHQuYWRhcHRpdmVDYXBhY2l0aWVzLmRlbHZpbmdEZWVwZXIuaDIpXG4gIHJldHVybiBtZGAjIyAke3RleHR9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgdGV4dCA9IF9sYW5nKG5iVGV4dC5hZGFwdGl2ZUNhcGFjaXRpZXMuZGVsdmluZ0RlZXBlci5pbnRybylcbiAgcmV0dXJuIG1kYCR7dGV4dH1gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTQ0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZm9ybWF0IGFkbWluIHNlbGVjdGlvbnNcbi8vIGJpbmQgdG8gYXBwZW5kaXggaW5wdXRzLCBhZGQgdGVtcGxhdGUgdG8gZm9ybWF0XG5JbnB1dHMuZm9ybShcbiAgW1xuICAgIElucHV0cy5iaW5kKFxuICAgICAgSW5wdXRzLnNlbGVjdChkYXRhQWRtaW4wLCB7IGxhYmVsOiBhZG1pblJlZ2lvbnMubGFiZWxzLmFkbWluMCwgZm9ybWF0OiB4ID0+IHgubGFiZWwgfSksXG4gICAgICB2aWV3b2Ygc2VsZWN0QWRtaW4wXG4gICAgKSxcbiAgICBJbnB1dHMuYmluZChcbiAgICAgIElucHV0cy5zZWxlY3QoZGF0YUFkbWluMSwgeyBsYWJlbDogYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjEsIGZvcm1hdDogeCA9PiB4LmxhYmVsIH0pLFxuICAgICAgdmlld29mIHNlbGVjdEFkbWluMVxuICAgICksXG4gICAgSW5wdXRzLmJpbmQoXG4gICAgICBJbnB1dHMuc2VsZWN0KGRhdGFBZG1pbjIsIHsgbGFiZWw6IGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4yLCBmb3JtYXQ6IHggPT4geC5sYWJlbCB9KSxcbiAgICAgIHZpZXdvZiBzZWxlY3RBZG1pbjJcbiAgICApXG4gIF0sXG4gIHtcbiAgICB0ZW1wbGF0ZTogYWRtaW5Gb3JtVGVtcGxhdGVcbiAgfVxuKVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImJyZWFkY3J1bWIgPSB7XG4gIGNvbnN0IHN2ZyA9IGQzXG4gICAgLmNyZWF0ZShcInN2Z1wiKVxuICAgIC5hdHRyKFwidmlld0JveFwiLCBgMCAwICR7YnJlYWRjcnVtYldpZHRoICogNC43NX0gJHticmVhZGNydW1iSGVpZ2h0fWApXG4gICAgLnN0eWxlKFwiZm9udFwiLCBcIjExcHggc2Fucy1zZXJpZlwiKVxuICAgIC5zdHlsZShcIm1hcmdpblwiLCBcIjJweFwiKTtcblxuICBjb25zdCBnID0gc3ZnXG4gICAgLnNlbGVjdEFsbChcImdcIilcbiAgICAuZGF0YShpY2ljbGUuc2VxdWVuY2UpXG4gICAgLmpvaW4oXCJnXCIpXG4gICAgLmF0dHIoXCJ0cmFuc2Zvcm1cIiwgKGQsIGkpID0+IGB0cmFuc2xhdGUoJHtpICogYnJlYWRjcnVtYldpZHRofSwgMClgKTtcblxuICBnLmFwcGVuZChcInBvbHlnb25cIilcbiAgICAuYXR0cihcInBvaW50c1wiLCBicmVhZGNydW1iUG9pbnRzKVxuICAgIC5hdHRyKFwiZmlsbFwiLCAoZCkgPT4gaWNpY2xlX2NvbG9yKGQuZGF0YS5uYW1lKSlcbiAgICAuYXR0cihcInN0cm9rZVwiLCBcIndoaXRlXCIpO1xuXG4gIGcuYXBwZW5kKFwidGV4dFwiKVxuICAgIC5hdHRyKFwieFwiLCAoYnJlYWRjcnVtYldpZHRoICsgMTApIC8gMilcbiAgICAuYXR0cihcInlcIiwgMTUpXG4gICAgLmF0dHIoXCJkeVwiLCBcIjAuMzVlbVwiKVxuICAgIC5hdHRyKFwidGV4dC1hbmNob3JcIiwgXCJtaWRkbGVcIilcbiAgICAuYXR0cihcImZpbGxcIiwgXCJ3aGl0ZVwiKVxuICAgIC50ZXh0KChkKSA9PiBpY2ljbGVfYWxpYXNbZC5kYXRhLm5hbWVdKTtcblxuICBpZiAoaWNpY2xlLnNlcXVlbmNlLmxlbmd0aCA+IDEpIHtcbiAgICBzdmdcbiAgICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgICAudGV4dChpY2ljbGUucGVyY2VudGFnZSA+IDAgPyBpY2ljbGUucGVyY2VudGFnZSArIFwiJVwiIDogXCJcIilcbiAgICAgIC5hdHRyKFwieFwiLCAoaWNpY2xlLnNlcXVlbmNlLmxlbmd0aCArIDAuMjUpICogYnJlYWRjcnVtYldpZHRoKVxuICAgICAgLmF0dHIoXCJ5XCIsIGJyZWFkY3J1bWJIZWlnaHQgLyAyKVxuICAgICAgLmF0dHIoXCJkeVwiLCBcIjAuMzVlbVwiKVxuICAgICAgLmF0dHIoXCJ0ZXh0LWFuY2hvclwiLCBcIm1pZGRsZVwiKTtcbiAgfVxuXG4gIHJldHVybiBzdmcubm9kZSgpO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC00NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBpY2ljbGUgPSB7XG4gIGNvbnN0IHJvb3QgPSBwYXJ0aXRpb24oaWNpY2xlX2RhdGEpO1xuICBsZXQgZnJvemVuID0gZmFsc2U7XG4gIGxldCBmcm96ZW5TZXF1ZW5jZSA9IFtdO1xuICAvLyBjb25zdCBwYWRkaW5nID0gMTA7XG4gIGNvbnN0IHN2ZyA9IGQzLmNyZWF0ZShcInN2Z1wiKTtcbiAgLy8gTWFrZSB0aGlzIGludG8gYSB2aWV3LCBzbyB0aGF0IHRoZSBjdXJyZW50bHkgaG92ZXJlZCBzZXF1ZW5jZSBpcyBhdmFpbGFibGUgdG8gdGhlIGJyZWFkY3J1bWJcbiAgY29uc3QgZWxlbWVudCA9IHN2Zy5ub2RlKCk7XG4gIGVsZW1lbnQudmFsdWUgPSB7IHNlcXVlbmNlOiBbXSwgcGVyY2VudGFnZTogMC4wIH07XG5cbiAgc3ZnXG4gICAgLmF0dHIoXCJ2aWV3Qm94XCIsIGAwIDAgJHt3aWR0aH0gJHtoZWlnaHR9YClcbiAgICAuc3R5bGUoXCJmb250XCIsIFwiMTJweCBzYW5zLXNlcmlmXCIpO1xuXG4gIHN2Z1xuICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCB3aWR0aClcbiAgICAuYXR0cihcImhlaWdodFwiLCBoZWlnaHQpXG4gICAgLmF0dHIoXCJmaWxsXCIsIFwibm9uZVwiKTtcblxuICBjb25zdCBzZWdtZW50ID0gc3ZnXG4gICAgLmFwcGVuZChcImdcIilcbiAgICAuYXR0cihcInRyYW5zZm9ybVwiLCAoZCkgPT5cbiAgICAgIG5hcnJvdyA/IGB0cmFuc2xhdGUoJHstcm9vdC55MX0sIDQwKWAgOiBgdHJhbnNsYXRlKDAsICR7LXJvb3QueTEgKyA0MH0pYFxuICAgIClcbiAgICAuc2VsZWN0QWxsKFwicmVjdFwiKVxuICAgIC5kYXRhKFxuICAgICAgcm9vdC5kZXNjZW5kYW50cygpLmZpbHRlcigoZCkgPT4ge1xuICAgICAgICByZXR1cm4gZC5kZXB0aDtcbiAgICAgIH0pXG4gICAgKVxuICAgIC5qb2luKFwicmVjdFwiKVxuICAgIC5hdHRyKFwiZmlsbFwiLCAoZCkgPT4gaWNpY2xlX2NvbG9yKGQuZGF0YS5uYW1lKSlcbiAgICAuYXR0cihcInhcIiwgc2VnbWVudFgpXG4gICAgLmF0dHIoXCJ5XCIsIHNlZ21lbnRZKVxuICAgIC5hdHRyKFwid2lkdGhcIiwgc2VnbWVudFdpZHRoKVxuICAgIC5hdHRyKFwiaGVpZ2h0XCIsIHNlZ21lbnRIZWlnaHQpXG4gICAgLm9uKFwibW91c2VlbnRlclwiLCAoZXZlbnQsIGQpID0+IHtcbiAgICAgIGlmIChmcm96ZW4pIHJldHVybjtcbiAgICAgIC8vIEdldCB0aGUgYW5jZXN0b3JzIG9mIHRoZSBjdXJyZW50IHNlZ21lbnQsIG1pbnVzIHRoZSByb290XG4gICAgICBjb25zdCBzZXF1ZW5jZSA9IGQuYW5jZXN0b3JzKCkucmV2ZXJzZSgpLnNsaWNlKDEpO1xuICAgICAgLy8gSGlnaGxpZ2h0IHRoZSBhbmNlc3RvcnNcbiAgICAgIHNlZ21lbnQuYXR0cihcImZpbGwtb3BhY2l0eVwiLCAobm9kZSkgPT5cbiAgICAgICAgc2VxdWVuY2UuaW5kZXhPZihub2RlKSA+PSAwID8gMS4wIDogMC4zXG4gICAgICApO1xuICAgICAgY29uc3QgcGVyY2VudGFnZSA9ICgxMDAgKiAoZC52YWx1ZSAvIHJvb3QudmFsdWUpKS50b1ByZWNpc2lvbigzKTtcbiAgICAgIGVsZW1lbnQudmFsdWUgPSB7IHNlcXVlbmNlLCBwZXJjZW50YWdlIH07XG4gICAgICBlbGVtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIikpO1xuICAgIH0pXG4gICAgLm9uKFwiY2xpY2tcIiwgKGV2ZW50LCBkKSA9PiB7XG4gICAgICBpZiAoZnJvemVuKSB7XG4gICAgICAgIGZyb3plbiA9IGZhbHNlO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBmcm96ZW4gPSB0cnVlO1xuICAgICAgICBmcm96ZW5TZXF1ZW5jZSA9IGQuYW5jZXN0b3JzKCkucmV2ZXJzZSgpLnNsaWNlKDEpO1xuICAgICAgICBzZWdtZW50LmF0dHIoXCJmaWxsLW9wYWNpdHlcIiwgKG5vZGUpID0+XG4gICAgICAgICAgZnJvemVuU2VxdWVuY2UuaW5kZXhPZihub2RlKSA+PSAwID8gMS4wIDogMC4zXG4gICAgICAgICk7XG4gICAgICAgIGNvbnN0IHBlcmNlbnRhZ2UgPSAoMTAwICogKGQudmFsdWUgLyByb290LnZhbHVlKSkudG9QcmVjaXNpb24oMyk7XG4gICAgICAgIGVsZW1lbnQudmFsdWUgPSB7IHNlcXVlbmNlOiBmcm96ZW5TZXF1ZW5jZSwgcGVyY2VudGFnZSB9O1xuICAgICAgICBlbGVtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIikpO1xuICAgICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsgLy8gcHJldmVudCBzdmcgY2xpY2sgZnJvbSBmaXJpbmdcbiAgICAgIH1cbiAgICB9KTtcblxuICBzdmcub24oXCJtb3VzZWxlYXZlXCIsICgpID0+IHtcbiAgICBpZiAoZnJvemVuKSByZXR1cm47XG4gICAgc2VnbWVudC5hdHRyKFwiZmlsbC1vcGFjaXR5XCIsIDEpO1xuICAgIC8vIFVwZGF0ZSB0aGUgdmFsdWUgb2YgdGhpcyB2aWV3XG4gICAgZWxlbWVudC52YWx1ZSA9IHsgc2VxdWVuY2U6IFtdLCBwZXJjZW50YWdlOiAwLjAgfTtcbiAgICBlbGVtZW50LmRpc3BhdGNoRXZlbnQobmV3IEN1c3RvbUV2ZW50KFwiaW5wdXRcIikpO1xuICB9KTtcblxuICBzdmcub24oXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaWYgKGZyb3plbikge1xuICAgICAgZnJvemVuID0gZmFsc2U7XG4gICAgICBmcm96ZW5TZXF1ZW5jZSA9IFtdO1xuICAgICAgc2VnbWVudC5hdHRyKFwiZmlsbC1vcGFjaXR5XCIsIDEpO1xuICAgICAgZWxlbWVudC52YWx1ZSA9IHsgc2VxdWVuY2U6IFtdLCBwZXJjZW50YWdlOiAwLjAgfTtcbiAgICAgIGVsZW1lbnQuZGlzcGF0Y2hFdmVudChuZXcgQ3VzdG9tRXZlbnQoXCJpbnB1dFwiKSk7XG4gICAgfVxuICB9KTtcblxuICAvLyBhZGQgbGVnZW5kXG4gIGNvbnN0IGNvbG9yU2NhbGUgPSBkM1xuICAgIC5zY2FsZU9yZGluYWwoKVxuICAgIC5kb21haW4oW1wiQmV0dGVyXCIsIFwiTW9kZXJhdGVcIiwgXCJXb3JzZVwiXSlcbiAgICAucmFuZ2UoW1wiI0Y0QkIyMVwiLCBcIiNGQzhBMzRcIiwgXCIjRUM1QTQ3XCJdKTtcblxuICBzdmdcbiAgICAuYXBwZW5kKFwicmVjdFwiKVxuICAgIC5hdHRyKFwieFwiLCAxKVxuICAgIC5hdHRyKFwieVwiLCA1KVxuICAgIC5hdHRyKFwicnhcIiwgMTApIC8vIEFkZCByb3VuZGVkIGNvcm5lcnNcbiAgICAuYXR0cihcInJ5XCIsIDEwKSAvLyBBZGQgcm91bmRlZCBjb3JuZXJzXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCAzMDApIC8vIEFkanVzdCB0aGUgd2lkdGggdG8gZml0IHRoZSBsZWdlbmRcbiAgICAuYXR0cihcImhlaWdodFwiLCAzMCkgLy8gQWRqdXN0IHRoZSBoZWlnaHQgdG8gZml0IHRoZSBsZWdlbmRcbiAgICAuYXR0cihcImZpbGxcIiwgXCIjZmZmXCIpO1xuICAvLyAuYXR0cihcInN0cm9rZVwiLCBcImJsYWNrXCIpO1xuXG4gIGNvbnN0IGxlZ2VuZCA9IHN2Z1xuICAgIC5zZWxlY3RBbGwoXCIubGVnZW5kXCIpXG4gICAgLmRhdGEoY29sb3JTY2FsZS5kb21haW4oKSlcbiAgICAuZW50ZXIoKVxuICAgIC5hcHBlbmQoXCJnXCIpXG4gICAgLmF0dHIoXCJjbGFzc1wiLCBcImxlZ2VuZFwiKVxuICAgIC5hdHRyKFwidHJhbnNmb3JtXCIsIGZ1bmN0aW9uIChkLCBpKSB7XG4gICAgICByZXR1cm4gXCJ0cmFuc2xhdGUoXCIgKyAoaSAqIDEwMCArIDI1KSArIFwiLDExKVwiO1xuICAgIH0pO1xuXG4gIGxlZ2VuZFxuICAgIC5hcHBlbmQoXCJyZWN0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDApXG4gICAgLmF0dHIoXCJ3aWR0aFwiLCAxOClcbiAgICAuYXR0cihcImhlaWdodFwiLCAxOClcbiAgICAuc3R5bGUoXCJmaWxsXCIsIGNvbG9yU2NhbGUpO1xuXG4gIGxlZ2VuZFxuICAgIC5hcHBlbmQoXCJ0ZXh0XCIpXG4gICAgLmF0dHIoXCJ4XCIsIDI0KVxuICAgIC5hdHRyKFwieVwiLCA5KVxuICAgIC5hdHRyKFwiZHlcIiwgXCIuMzVlbVwiKVxuICAgIC50ZXh0KGZ1bmN0aW9uIChkKSB7XG4gICAgICByZXR1cm4gZDtcbiAgICB9KTtcblxuICByZXR1cm4gZWxlbWVudDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpY2ljbGVfcGN0X3RhYmxlID0ge1xuICAvLyBBIGxpdHRsZSBmdW5jdGlvbiB0byBiYXNpY2FsbHkgY2FsY3VhbHRlIHRoZSBzYW1lIHRoaW5nIGFzIHRoZSBicmVhZGNydW1iIGJ1dCBmb3IgYWxsIHRoZSBhZG1pbiByZWdpb24uXG4gIC8vIFRoaXMgaXMgd2hhdCB1c2VycyBzaG91bGQgc2VlIGlmIGdvaW5nIHRvIGEgdGFidWxhciB2aWV3IGFuZCBhbHNvIHdoYXQgdGhleSBzaG91bGQgZG93bmxvYWQuIEl0IGlzIG11Y2ggZWFzaWVyIHRvIHVuZGVyc3RhbmQgYW5kIHdvcmsgd2l0aC5cbiAgY29uc3Qgc3VtbWFyaXplX2ljaWNsZSA9IChjc3YsIGljaWNsZV9rZXlzID0gbnVsbCkgPT4ge1xuICAgIGNvbnN0IHJvd3MgPSBjc3YubWFwKHJvdyA9PiAoe1xuICAgICAgcGFydHM6IHJvdy5wYXRoLnNwbGl0KFwiX1wiKS5zbGljZSgxKSxcbiAgICAgIHZhbHVlOiArcm93LnZhbHVlXG4gICAgfSkpO1xuICAgIGNvbnN0IHRvdGFsID0gZDMuc3VtKHJvd3MsIChkKSA9PiBkLnZhbHVlKTtcblxuICAgIGNvbnN0IG1heERlcHRoID0gTWF0aC5tYXgoLi4ucm93cy5tYXAoKHIpID0+IHIucGFydHMubGVuZ3RoKSk7XG4gICAgY29uc3QgbGV2ZWxOYW1lcyA9IGljaWNsZV9rZXlzXG4gICAgICA/IE9iamVjdC5rZXlzKGljaWNsZV9rZXlzKVxuICAgICAgOiBbLi4uQXJyYXkobWF4RGVwdGgpLmtleXMoKV0ubWFwKChpKSA9PiBgbGV2ZWwke2kgKyAxfWApO1xuXG4gICAgY29uc3QgbG9va3VwTmFtZSA9IChkaW0sIGtleSkgPT4ge1xuICAgICAgaWYgKCFpY2ljbGVfa2V5cykgcmV0dXJuIGtleTtcbiAgICAgIHJldHVybiBpY2ljbGVfa2V5c1tkaW1dPy5ba2V5XT8uWzBdID8/IGtleTtcbiAgICB9O1xuXG4gICAgY29uc3QgZ2VuZGVyVG90YWxzID0ge307XG4gICAgcm93cy5mb3JFYWNoKChyKSA9PiB7XG4gICAgICBjb25zdCBnZW5kZXIgPSByLnBhcnRzWzBdO1xuICAgICAgZ2VuZGVyVG90YWxzW2dlbmRlcl0gPSAoZ2VuZGVyVG90YWxzW2dlbmRlcl0gfHwgMCkgKyByLnZhbHVlO1xuICAgIH0pO1xuXG4gICAgLy8gUmVjdXJzaXZlIGhlbHBlclxuICAgIGNvbnN0IHJlY3Vyc2UgPSAocm93cywgZGVwdGggPSAwLCBwcmVmaXggPSBbXSkgPT4ge1xuICAgICAgaWYgKCFyb3dzLmxlbmd0aCkgcmV0dXJuIFtdO1xuICAgICAgaWYgKGRlcHRoID49IG1heERlcHRoKSByZXR1cm4gW107XG5cbiAgICAgIHJldHVybiBkM1xuICAgICAgICAucm9sbHVwcyhcbiAgICAgICAgICByb3dzLFxuICAgICAgICAgICh2KSA9PiBkMy5zdW0odiwgKGQpID0+IGQudmFsdWUpLFxuICAgICAgICAgIChkKSA9PiBkLnBhcnRzW2RlcHRoXVxuICAgICAgICApXG4gICAgICAgIC5mbGF0TWFwKChbaywgc3VtXSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnQgPSBbLi4ucHJlZml4LCBrXTtcbiAgICAgICAgICBjb25zdCByb3dPYmogPSB7fTtcbiAgICAgICAgICBsZXZlbE5hbWVzLmZvckVhY2goKGNvbCwgaSkgPT4ge1xuICAgICAgICAgICAgcm93T2JqW2NvbF0gPSBjdXJyZW50W2ldID8gbG9va3VwTmFtZShjb2wsIGN1cnJlbnRbaV0pIDogbnVsbDtcbiAgICAgICAgICB9KTtcbiAgICAgICAgICByb3dPYmoucGN0X3RvdGFsID0gKDEwMCAqIHN1bSkgLyB0b3RhbDtcbiAgICAgICAgICAvLyBwY3QgcmVsYXRpdmUgdG8gZ2VuZGVyXG4gICAgICAgICAgY29uc3QgZ2VuZGVyS2V5ID0gcHJlZml4WzBdO1xuICAgICAgICAgIGlmIChnZW5kZXJLZXkgJiYgZ2VuZGVyVG90YWxzW2dlbmRlcktleV0pIHtcbiAgICAgICAgICAgIHJvd09iai5wY3Rfb2ZfZ2VuZGVyID0gKDEwMCAqIHN1bSkgLyBnZW5kZXJUb3RhbHNbZ2VuZGVyS2V5XTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuIFtcbiAgICAgICAgICAgIHJvd09iaixcbiAgICAgICAgICAgIC4uLnJlY3Vyc2UoXG4gICAgICAgICAgICAgIHJvd3MuZmlsdGVyKChyKSA9PiByLnBhcnRzW2RlcHRoXSA9PT0gayksXG4gICAgICAgICAgICAgIGRlcHRoICsgMSxcbiAgICAgICAgICAgICAgY3VycmVudFxuICAgICAgICAgICAgKVxuICAgICAgICAgIF07XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4gcmVjdXJzZShyb3dzKTtcbiAgfTtcblxuICByZXR1cm4gYnVpbGRJbmxpbmVEb3dubG9hZEJ1dHRvbihcbiAgICBzdW1tYXJpemVfaWNpY2xlKGljaWNsZV9yYXcsIGljaWNsZV9rZXlzKSxcbiAgICBfbGFuZyhkb3dubG9hZF90cmFuc2xhdGlvbiksXG4gICAgYEFkYXB0aXZlQ2FwYWNpdHlJY2ljbGVfJHtzZWxlY3RBZG1pbjAubGFiZWwucmVwbGFjZSgvXFxzL2csIFwiXCIpfWBcbiAgKVxuICBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRleHQgPSBfbGFuZyhuYlRleHQuc3VtbWFyeS5oMSlcbiAgcmV0dXJuIG1kYCMgJHt0ZXh0fWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNDkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkeW5hbWljU3VtbWFyeUNlbGwgPSB7XG4gIGxldCBkeW5hbWljU3VtbWFyeSA9IFwiXCI7XG4gIC8vIGFkZCBmaWx0ZXIgdG8gZG8gbm90aGluZyBpbiBjYXNlIHdoZXJlIG5vIGFkbWluMCBpcyBzZWxlY3RlZFxuICBpZiAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZSAhPT0gbnVsbCkge1xuICAgIGR5bmFtaWNTdW1tYXJ5ID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICAgIF9sYW5nKG5iVGV4dC5zdW1tYXJ5LmR5bmFtaWNTdW1tYXJ5bGlzdCksXG4gICAgICBbeyBuYW1lOiBcIm1hcmtkb3duTGlzdFwiLCB2YWx1ZTogZHluYW1pY1N1bW1hcnlNYXJrZG93biB9XVxuICAgICk7XG4gIH1cbiAgY29uc3QgYWRtaW4wID0gX2xhbmcoXG4gICAgdGQuYWRtaW4wX25hbWUudmFsdWVzPy5bZ2V0QWRtaW5TZWxlY3Rpb25BZG1pbjAoKS52YWx1ZSA/PyAnU1NBJ11bXCJhcnRpY2xlM1wiXVxuICApO1xuICBjb25zdCBpbnRybyA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXMoXG4gICAgX2xhbmcobmJUZXh0LnN1bW1hcnkuYmxvY2tzLmR5bmFtaWNTdW1tYXJ5LmludHJvKSxcbiAgICBbeyBuYW1lOiBcImFkbWluMFwiLCB2YWx1ZTogYWRtaW4wIH1dXG4gICk7XG5cbiAgcmV0dXJuIG1kYCR7aW50cm99ICR7ZHluYW1pY1N1bW1hcnl9YDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRleHQgPSBfbGFuZyhuYlRleHQuc3VtbWFyeS5ibG9ja3MuY2xvc2VyKVxuICByZXR1cm4gbWRgJHt0ZXh0fWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRleHQgPSBfbGFuZyhuYlRleHQubWV0aG9kcy5oMSlcbiAgcmV0dXJuIG1kYCMgJHt0ZXh0fWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRleHQgPSBfbGFuZyhuYlRleHQubWV0aG9kcy5zZWN0aW9uMSlcbiAgcmV0dXJuIG1kYCMjICR7dGV4dH1gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTUzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCB0ZXh0ID0gX2xhbmcobmJUZXh0Lm1ldGhvZHMuc2VjdGlvbjEuc3Vic2VjdGlvbnMpO1xuICByZXR1cm4gbWRgJHt0ZXh0fWBcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRleHQgPSBfbGFuZyhuYlRleHQubWV0aG9kcy5zZWN0aW9uMilcbiAgcmV0dXJuIG1kYCMjICR7dGV4dH1gXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTU1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoie1xuICBjb25zdCB0ZXh0ID0gX2xhbmcobmJUZXh0Lm1ldGhvZHMuc2VjdGlvbjIuc3Vic2VjdGlvbnMpXG4gIHJldHVybiBtZGAke3RleHR9YFxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC01NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYC0tLVxuIyMgV29yayBieSBUb3BpY1xuKkNlbGxzIHRoYXQgcG93ZXIgZGlmZmVyZW50IHNlY3Rpb25zKmA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTU3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgU3VwcG9ydCBub3RlYm9va1xuW1N1cHBvcnQgTm90ZWJvb2tdKGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9AcGVyaXNjb3BpYy9hYi1hdGxhcy1zcG90bGlnaHQtc3VwcG9ydCk6IHVzZWQgZm9yIGltcG9ydHMgYWNyb3NzIHNwb3RsaWdodHMuYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBOb3RlYm9vayBWYXJpYWJsZXNcbl9NYWluIHZhcmlhYmxlcyBhY3Jvc3Mgbm90ZWJvb2tfYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNTkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBtYWluIHRpdGxlIG9mIHRoZSBub3RlYm9va1xubm90ZWJvb2tUaXRsZSA9IF9sYW5nKHtcbiAgZW46IFwiRXZhbHVhdGUgQ2xpbWF0ZSBSaXNrc1wiLFxuICBmcjogXCJFdmFsdWVyIGxlcyByaXNxdWVzIGNsaW1hdGlxdWVzXCIsXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBpbmZvIGZvciB0aGUgYWRtaW4gc2VsZWN0b3JzXG5hZG1pblJlZ2lvbnMgPSB7XG4gIHJldHVybiB7XG4gICAgbGFiZWxzOiB7XG4gICAgICBhZG1pbjA6IExhbmcudG9TZW50ZW5jZUNhc2UoXG4gICAgICAgIF9sYW5nKG5iVGV4dC5zdXBwb3J0TmJUZXh0LndvcmRzLmNvdW50cnkuc2luZ3VsYXIpXG4gICAgICApLFxuICAgICAgYWRtaW4xOiBMYW5nLnRvU2VudGVuY2VDYXNlKFxuICAgICAgICBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC53b3Jkcy5yZWdpb24uc2luZ3VsYXIpXG4gICAgICApLFxuICAgICAgYWRtaW4yOiBMYW5nLnRvU2VudGVuY2VDYXNlKFxuICAgICAgICBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC53b3Jkcy5zdWJyZWdpb24uc2luZ3VsYXIpXG4gICAgICApXG4gICAgfSxcbiAgICBhbGxMYWJlbHM6IHtcbiAgICAgIGFkbWluMTogX2xhbmcobmJUZXh0LnN1cHBvcnROYlRleHQubGFiZWxzLmFsbFJlZ2lvbnMpLFxuICAgICAgYWRtaW4yOiBfbGFuZyhuYlRleHQuc3VwcG9ydE5iVGV4dC5sYWJlbHMuYWxsU3VicmVnaW9ucyksXG4gICAgfVxuICB9O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGdldExvd2VyTGV2ZWxBZG1pbkxhYmVsKHNlbGVjdGlvbnMgPSBhZG1pblNlbGVjdGlvbnMpIHtcbiAgLy8gYmFzZWQgb24gYWRtaW4gc2VsZWN0aW9uLCBnZXQgdGhlIGxvd2VyIGxldmVsIGxhYmVsXG4gIGlmIChzZWxlY3Rpb25zLnNlbGVjdEFkbWluMi52YWx1ZSkgcmV0dXJuIGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4yO1xuICBpZiAoc2VsZWN0aW9ucy5zZWxlY3RBZG1pbjEudmFsdWUpIHJldHVybiBhZG1pblJlZ2lvbnMubGFiZWxzLmFkbWluMjtcbiAgaWYgKHNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlKSByZXR1cm4gYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjE7XG4gIGVsc2UgcmV0dXJuIGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4wO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHdpZHRoIG9mIHRoZSBtYXBzXG5tYXBXaWR0aCA9IDYyNTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAqKkxhbmd1YWdlIGFuZCBub3RlYm9vayB0ZXh0KipgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7IExhbmcgfSBmcm9tIFwiN2Q0NjY3OWY3ZDBkOTE3ZVwiO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Imxhbmd1YWdlcyA9IFtcbiAgeyBrZXk6IFwiZW5cIiwgbGFiZWw6IFwiRW5nbGlzaFwiLCBsb2NhbGU6IFwiZW4tVVNcIiB9LFxuICB7IGtleTogXCJmclwiLCBsYWJlbDogXCJGcmFuw6dhaXNcIiwgbG9jYWxlOiBcImZyLUZSXCIgfSxcbl07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZ2V0IHRoZSBkZWZhdWx0IGxhbmd1YWdlIGtleSBmcm9tIHBhcmFtZXRlciwgb3IgdXNlIGRlZmF1bHRcbmRlZmF1bHRMYW5nS2V5ID0ge1xuICBjb25zdCBuYW1lID0gXCJsYW5nXCI7XG4gIGNvbnN0IGxpc3QgPSBsYW5ndWFnZXMubWFwKChkKSA9PiBkLmtleSk7XG4gIGNvbnN0IGRlZmF1bHRLZXkgPSBcImVuXCI7XG5cbiAgY29uc3QgcXVlcnlQYXJhbSA9IGF3YWl0IExhbmcuZ2V0UGFyYW1Gcm9tTGlzdCh7IG5hbWUsIGxpc3QgfSk7XG5cbiAgcmV0dXJuIHF1ZXJ5UGFyYW0gPz8gZGVmYXVsdEtleTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNjciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBoZWxwZXIgc2hvcnRoYW5kIGZvciBMYW5nIHRleHQtZ2V0dGluZ1xuX2xhbmcgPSBMYW5nLmxnKGxhbmd1YWdlLmtleSk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTY4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gbWFpbiB0b2dnbGUgb2YgbGFuZ3VhZ2Uga2V5XG52aWV3b2YgbGFuZ3VhZ2UgPSBJbnB1dHMucmFkaW8obGFuZ3VhZ2VzLCB7XG4gIGxhYmVsOiBcIk1haW4gbGFuZ3VhZ2UgdG9nZ2xlXCIsXG4gIGZvcm1hdDogKGQpID0+IGQua2V5LFxuICB2YWx1ZTogbGFuZ3VhZ2VzLmZpbmQoKHgpID0+IHgua2V5ID09PSBkZWZhdWx0TGFuZ0tleSksXG59KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC02OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im5iVGV4dCA9IHtcbiAgLy8gdGV4dCBpbiB0aGUgbm90ZWJvb2tcbiAgLy8gcmVjb21tZW5kYXRpb246IG9ubHkgdXNlIG9iamVjdHMgZm9yIGJldHRlciB0YWItY29tcGxldGlvblxuICByZXR1cm4ge1xuICAgIHN1cHBvcnROYlRleHQ6IHtcbiAgICAgIGxhYmVsczoge1xuICAgICAgICBhbGxSZWdpb25zOiB7XG4gICAgICAgICAgZW46IFwiQWxsIHJlZ2lvbnNcIixcbiAgICAgICAgICBmcjogXCJUb3V0ZXMgbGVzIHLDqWdpb25zXCJcbiAgICAgICAgfSxcbiAgICAgICAgYWxsU3VicmVnaW9uczoge1xuICAgICAgICAgIGVuOiBcIkFsbCBzdWJyZWdpb25zXCIsXG4gICAgICAgICAgZnI6IFwiVG91dGVzIGxlcyBzb3VzLXLDqWdpb25zXCJcbiAgICAgICAgfSxcbiAgICAgICAgcXVpY2tJbnNpZ2h0czoge1xuICAgICAgICAgIGVuOiBcIlF1aWNrIEluc2lnaHRzXCIsXG4gICAgICAgICAgZnI6IFwiQXBlcsOndSBSYXBpZGVcIlxuICAgICAgICB9LFxuICAgICAgICBsYW5ndWFnZToge1xuICAgICAgICAgIGVuOiBcIkxhbmd1YWdlXCIsXG4gICAgICAgICAgZnI6IFwiTGFuZ3VlXCJcbiAgICAgICAgfSxcbiAgICAgICAgdG9jVGl0bGU6IHtcbiAgICAgICAgICBlbjogXCJJbiB0aGlzIG5vdGVib29rXCIsXG4gICAgICAgICAgZnI6IFwiRGFucyBjZSBub3RlYm9va1wiXG4gICAgICAgIH0sXG4gICAgICAgIGNyb3A6IHtcbiAgICAgICAgICBlbjogXCJDcm9wXCIsXG4gICAgICAgICAgZnI6IFwiUsOpY29sdGVcIlxuICAgICAgICB9LFxuICAgICAgICBzb3J0OiB7XG4gICAgICAgICAgZW46IFwiU29ydFwiLFxuICAgICAgICAgIGZyOiBcIlRyaWVyXCJcbiAgICAgICAgfSxcbiAgICAgICAgc29ydFRvdGFsczoge1xuICAgICAgICAgIGVuOiBcIlNvcnQgdG90YWxzXCIsXG4gICAgICAgICAgZnI6IFwiVHJpZXIgbGVzIHRvdGF1eFwiXG4gICAgICAgIH0sXG4gICAgICAgIHNvcnRCYXJzOiB7XG4gICAgICAgICAgZW46IFwiU29ydCBiYXJzXCIsXG4gICAgICAgICAgZnI6IFwiVHJpZXIgbGVzIGJhcnJlc1wiXG4gICAgICAgIH0sXG4gICAgICAgIGNvbmZpZGVuY2VJbnRlcnZhbHM6IHtcbiAgICAgICAgICBlbjogXCJDb25maWRlbmNlIGludGVydmFsc1wiLFxuICAgICAgICAgIGZyOiBcIkludGVydmFsbGVzIGRlIGNvbmZpYW5jZVwiXG4gICAgICAgIH0sXG4gICAgICAgIGhpZ2hsaWdodEFlejoge1xuICAgICAgICAgIGVuOiBcIkhpZ2hsaWdodCBBRVpcIixcbiAgICAgICAgICBmcjogXCJTdXJsaWduZXIgQUVaXCJcbiAgICAgICAgfSxcbiAgICAgICAgaGlnaGxpZ2h0UHJhY3RpY2U6IHtcbiAgICAgICAgICBlbjogXCJIaWdobGlnaHQgYSBwcmFjdGljZVwiLFxuICAgICAgICAgIGZyOiBcIlN1cmxpZ25lciB1bmUgcHJhdGlxdWVcIlxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgcGhyYXNlczoge1xuICAgICAgICBpblRvdGFsOiB7XG4gICAgICAgICAgZW46IFwiSW4gdG90YWwsIHRoZXJlIGFyZVwiLFxuICAgICAgICAgIGZyOiBcIkF1IHRvdGFsLCBpbCB5IGFcIlxuICAgICAgICB9LFxuICAgICAgICBzcGVjaWZpY0hhczoge1xuICAgICAgICAgIGVuOiBgKio6OjppdGVtOjo6KiogaGFzYCxcbiAgICAgICAgICBmcjogYCoqOjo6aXRlbTo6OioqIGFgXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICB3b3Jkczoge1xuICAgICAgICB0b0JlOiB7XG4gICAgICAgICAgc2luZ3VsYXI6IHtcbiAgICAgICAgICAgIGVuOiBcImlzXCIsXG4gICAgICAgICAgICBmcjogXCJlc3RcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGx1cmFsOiB7XG4gICAgICAgICAgICBlbjogXCJhcmVcIixcbiAgICAgICAgICAgIGZyOiBcInNvbnRcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYW5kOiB7XG4gICAgICAgICAgZW46IFwiYW5kXCIsXG4gICAgICAgICAgZnI6IFwiZXRcIlxuICAgICAgICB9LFxuICAgICAgICBwZXJjZW50YWdlOiB7XG4gICAgICAgICAgc2luZ3VsYXI6IHtcbiAgICAgICAgICAgIGVuOiBcInBlcmNlbnRhZ2VcIixcbiAgICAgICAgICAgIGZyOiBcInBvdXJjZW50YWdlXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBsdXJhbDoge1xuICAgICAgICAgICAgZW46IFwicGVyY2VudGFnZXNcIixcbiAgICAgICAgICAgIGZyOiBcInBvdXJjZW50YWdlc1wiXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBjcm9wOiB7XG4gICAgICAgICAgc2luZ3VsYXI6IHtcbiAgICAgICAgICAgIGVuOiBcImNyb3BcIixcbiAgICAgICAgICAgIGZyOiBcInLDqWNvbHRlXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIHBsdXJhbDoge1xuICAgICAgICAgICAgZW46IFwiY3JvcHNcIixcbiAgICAgICAgICAgIGZyOiBcInLDqWNvbHRlc1wiXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBjb3VudHJ5OiB7XG4gICAgICAgICAgc2luZ3VsYXI6IHtcbiAgICAgICAgICAgIGVuOiBcImNvdW50cnlcIixcbiAgICAgICAgICAgIGZyOiBcInBheXNcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGx1cmFsOiB7XG4gICAgICAgICAgICBlbjogXCJjb3VudHJpZXNcIixcbiAgICAgICAgICAgIGZyOiBcImRlcyBwYXlzXCJcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJlZ2lvbjoge1xuICAgICAgICAgIHNpbmd1bGFyOiB7XG4gICAgICAgICAgICBlbjogXCJyZWdpb25cIixcbiAgICAgICAgICAgIGZyOiBcInLDqWdpb25cIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGx1cmFsOiB7XG4gICAgICAgICAgICBlbjogXCJyZWdpb25zXCIsXG4gICAgICAgICAgICBmcjogXCJyw6lnaW9uc1wiXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzdWJyZWdpb246IHtcbiAgICAgICAgICBzaW5ndWxhcjoge1xuICAgICAgICAgICAgZW46IFwic3VicmVnaW9uXCIsXG4gICAgICAgICAgICBmcjogXCJzb3VzLXLDqWdpb25cIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGx1cmFsOiB7XG4gICAgICAgICAgICBlbjogXCJzdWJyZWdpb25zXCIsXG4gICAgICAgICAgICBmcjogXCJzb3VzLXLDqWdpb25zXCJcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGNvbW1vZGl0eToge1xuICAgICAgICAgIHNpbmd1bGFyOiB7XG4gICAgICAgICAgICBlbjogXCJjb21tb2RpdHlcIixcbiAgICAgICAgICAgIGZyOiBcInByb2R1aXRzIGRlIGJhc2VcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGx1cmFsOiB7XG4gICAgICAgICAgICBlbjogXCJjb21tb2RpdGllc1wiLFxuICAgICAgICAgICAgZnI6IFwicHJvZHVpdHNcIlxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgb3ZlcnZpZXc6IHtcbiAgICAgICAgICBlbjogXCJvdmVydmlld1wiLFxuICAgICAgICAgIGZyOiBcInZ1ZSBk4oCZZW5zZW1ibGVcIlxuICAgICAgICB9LFxuICAgICAgICBwcmFjdGljZToge1xuICAgICAgICAgIHNpbmd1bGFyOiB7XG4gICAgICAgICAgICBlbjogXCJwcmFjdGljZVwiLFxuICAgICAgICAgICAgZnI6IFwicHJhdGlxdWVcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGx1cmFsOiB7XG4gICAgICAgICAgICBlbjogXCJwcmFjdGljZXNcIixcbiAgICAgICAgICAgIGZyOiBcInByYXRpcXVlc1wiXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBvYnNlcnZhdGlvbjoge1xuICAgICAgICAgIHNpbmd1bGFyOiB7XG4gICAgICAgICAgICBlbjogXCJvYnNlcnZhdGlvblwiLFxuICAgICAgICAgICAgZnI6IFwib2JzZXJ2YXRpb25cIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgcGx1cmFsOiB7XG4gICAgICAgICAgICBlbjogXCJvYnNlcnZhdGlvbnNcIixcbiAgICAgICAgICAgIGZyOiBcIm9ic2VydmF0aW9uc1wiXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbmNyZWFzZToge1xuICAgICAgICAgIGVuOiBcImluY3JlYXNlXCIsXG4gICAgICAgICAgZnI6IFwiYXVnbWVudGF0aW9uXCJcbiAgICAgICAgfSxcbiAgICAgICAgZGVjcmVhc2U6IHtcbiAgICAgICAgICBlbjogXCJkZWNyZWFzZVwiLFxuICAgICAgICAgIGZyOiBcImRpbWludXRpb25cIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBmcm9udE1hdHRlcjoge1xuICAgICAgaGVyb0ltYWdlOiB7XG4gICAgICAgIHVybDoge1xuICAgICAgICAgIGVuOiBhd2FpdCBGaWxlQXR0YWNobWVudChcbiAgICAgICAgICAgIFwiRXZhbHVhdGUtY2xpbWF0ZS1yaXNrcy53ZWJwXCJcbiAgICAgICAgICApLnVybCgpLFxuICAgICAgICAgIGZyOiBhd2FpdCBGaWxlQXR0YWNobWVudChcbiAgICAgICAgICAgIFwiRXZhbHVhdGUtY2xpbWF0ZS1yaXNrcy1mci53ZWJwXCJcbiAgICAgICAgICApLnVybCgpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9LFxuICAgIG1pc3NpbmdNYXBEYXRhQmx1cmI6IHtcbiAgICAgIGVuOiBgR3JleSByZWdpb25zIHNpZ25hbCBsYWNrIG9mIDo6OmRhdGFfbGFiZWw6OjogZGF0YS5gLFxuICAgICAgZnI6IGBMZXMgem9uZXMgZ3Jpc8OpZXMgZMOpc2lnbmVudCB1biBtYW5xdWUgZGUgZG9ubsOpZXMgcmVsacOpZXMgw6AgOjo6ZGF0YV9sYWJlbDo6Oi5gXG4gICAgfSxcbiAgICB2b3BOb3RlTWQ6IHtcbiAgICAgIC8vIG5vdGUgYWJvdXQgVm9QIHNvdXJjZSBmb3IgY2FwdGlvbnNcbiAgICAgIGNhcHRpb246IHtcbiAgICAgICAgZW46IGBNb25ldGFyeSBWb1AgdmFsdWVzIGFyZSByZXByZXNlbnRlZCBpbiAyMDA1IGludGVybmF0aW9uYWwgZG9sbGFycy5gLFxuICAgICAgICBmcjogYExlcyB2YWxldXJzIG1vbsOpdGFpcmVzIGRlIGxhIFZEUCBzb250IHJlcHLDqXNlbnTDqWVzIGVuIGRvbGxhcnMgaW50ZXJuYXRpb25hdXggZGUgMjAwNS5gXG4gICAgICB9LFxuICAgICAgLy8gbmFycmF0aXZlIGluZm8sIHdpdGggbGluayB0byB3aWtpXG4gICAgICBibHVyYjoge1xuICAgICAgICBlbjogYFZvUCwgMjAwNSBbaW50ZXJuYXRpb25hbCBkb2xsYXJzXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnRlcm5hdGlvbmFsX2RvbGxhcilgLFxuICAgICAgICBmcjogYFZEUCwgZW4gW2RvbGxhcnMgaW50ZXJuYXRpb25hdXhdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludGVybmF0aW9uYWxfZG9sbGFyKSBkZSAyMDA1YFxuICAgICAgfVxuICAgIH0sXG4gICAgb3ZlcnZpZXc6IHtcbiAgICAgIGhlYWRlcjoge1xuICAgICAgICBlbjogXCJPdmVydmlld1wiLFxuICAgICAgICBmcjogXCJWdWUgZOKAmUVuc2VtYmxlXCJcbiAgICAgIH0sXG4gICAgICBibG9ja3M6IHtcbiAgICAgICAgb3BlbmVyOiB7XG4gICAgICAgICAgZW46IFwiQWZyaWNhbiBhZ3JpY3VsdHVyZSB3aWxsIGJlIHRlc3RlZCBieSBjbGltYXRlIGNoYW5nZS4gUmlzaW5nIHRlbXBlcmF0dXJlcywgdW5wcmVkaWN0YWJsZSByYWluZmFsbCwgYW5kIGZsb29kaW5nIHdpbGwgZGlzcnVwdCB0aGUgZ3Jvd3RoIGFuZCBwcm9kdWN0aW9uIG9mIGNyb3BzIGFuZCBsaXZlc3RvY2ssIGplb3BhcmRpemluZyBmb29kIHNlY3VyaXR5IGFuZCBsaXZlbGlob29kcyBmb3IgbWlsbGlvbnMuIFRoaXMgbm90ZWJvb2sgYWltcyB0byBlbXBvd2VyIHVzZXJzIHRvIHVuZGVyc3RhbmQgdGhlIGNsaW1hdGUgcmlza3MgZmFjaW5nIEFmcmljYW4gYWdyaWN1bHR1cmUsIGFzIHdlbGwgYXMgaWRlbnRpZnkgdGhlIGFkYXB0YXRpb24gYmFycmllcnMgaW4gdGVybXMgb2YgZWR1Y2F0aW9uLCB3b21lbidzIGVtcG93ZXJtZW50LCBhbmQgcG92ZXJ0eS4gWW91IGNhbiBmb2xsb3cgdGhlIG5hcnJhdGl2ZSBmb3IgdGhlIGNvbnRpbmVudCBhcyBhIHdob2xlLCBvciBzZWxlY3QgaW5kaXZpZHVhbCBjb3VudHJpZXMgZm9yIGdlb2dyYXBoeS1zcGVjaWZpYyBzdGF0aXN0aWNzLlwiLFxuICAgICAgICAgIGZyOiBcIkwnYWdyaWN1bHR1cmUgYWZyaWNhaW5lIHNlcmEgbWlzZSDDoCBsJ8OpcHJldXZlIHBhciBsZSBjaGFuZ2VtZW50IGNsaW1hdGlxdWUuIExhIGhhdXNzZSBkZXMgdGVtcMOpcmF0dXJlcywgbCdpbXByw6l2aXNpYmlsaXTDqSBkZXMgcHLDqWNpcGl0YXRpb25zIGV0IGxlcyBpbm9uZGF0aW9ucyBwZXJ0dXJiZXJvbnQgbGEgY3JvaXNzYW5jZSBldCBsYSBwcm9kdWN0aW9uIGRlcyBjdWx0dXJlcyBldCBkdSBiw6l0YWlsLCBtZXR0YW50IGVuIHDDqXJpbCBsYSBzw6ljdXJpdMOpIGFsaW1lbnRhaXJlIGV0IGxlcyBtb3llbnMgZGUgc3Vic2lzdGFuY2UgZGUgbWlsbGlvbnMgZGUgcGVyc29ubmVzLiBDZSBub3RlYm9vayB2aXNlIMOgIHBlcm1ldHRyZSBhdXggdXRpbGlzYXRldXJzIGRlIGNvbXByZW5kcmUgbGVzIHJpc3F1ZXMgY2xpbWF0aXF1ZXMgYXV4cXVlbHMgZXN0IGNvbmZyb250w6llIGwnYWdyaWN1bHR1cmUgYWZyaWNhaW5lLCBhaW5zaSBxdWUgZCdpZGVudGlmaWVyIGxlcyBvYnN0YWNsZXMgw6AgbCdhZGFwdGF0aW9uIGVuIHRlcm1lcyBkJ8OpZHVjYXRpb24sIGQnYXV0b25vbWlzYXRpb24gZGVzIGZlbW1lcyBldCBkZSBwYXV2cmV0w6kuIFZvdXMgcG91dmV6IHN1aXZyZSBsZSByw6ljaXQgcG91ciBsJ2Vuc2VtYmxlIGR1IGNvbnRpbmVudCBvdSBzw6lsZWN0aW9ubmVyIGRlcyBwYXlzIGluZGl2aWR1ZWxzIHBvdXIgb2J0ZW5pciBkZXMgc3RhdGlzdGlxdWVzIHNww6ljaWZpcXVlcyDDoCBsYSBnw6lvZ3JhcGhpZS5cIlxuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgICBhZnJpY2FNYXA6IHtcbiAgICAgIGJsb2Nrczoge1xuICAgICAgICBoMToge1xuICAgICAgICAgIGVuOiBcIldoYXQgRG9lcyBBZnJpY2EgSGF2ZSB0byBMb3NlP1wiLFxuICAgICAgICAgIGZyOiBcIlF1J2VzdC1jZSBxdWUgbCdBZnJpcXVlIGEgw6AgcGVyZHJlP1wiXG4gICAgICAgIH0sXG4gICAgICAgIG9wZW5lcjoge1xuICAgICAgICAgIGVuOiBgQWZyaWNhbiBhZ3JpY3VsdHVyZSBpcyB2YWx1YWJsZSwgYm90aCBpbiB0ZXJtcyBvZiBmb29kIHByb2R1Y3Rpb24gYW5kIGZhcm1lcnMuIEhlcmUgeW91IGNhbiBleHBsb3JlIGhvdyB0aGUgdmFsdWUgb2YgcHJvZHVjdGlvbiAoOjo6dm9wX2JsdXJiOjo6KSBhbmQgc2l6ZSBvZiB0aGUgcnVyYWwgcG9wdWxhdGlvbiBkaWZmZXIgYmV0d2VlbiBzcGVjaWZpYyBjb3VudHJpZXMgYW5kIHJlZ2lvbnMuIFRoaXMgY29udGV4dCBpcyBpbXBvcnRhbnQgZm9yIHVuZGVyc3RhbmRpbmcgdGhlIHVuaXF1ZSB2dWxuZXJhYmlsaXRpZXMgZmFjaW5nIHRoZSBhZ3JpY3VsdHVyYWwgc2VjdG9yIG9uIHRoZSBjb250aW5lbnQsIG9yIGZvciBzcGVjaWZpYyBnZW9ncmFwaGllcyBvZiBpbnRlcmVzdC5gLFxuICAgICAgICAgIGZyOiBgTCdhZ3JpY3VsdHVyZSBhZnJpY2FpbmUgZXN0IGRlIHZhbGV1ciwgdGFudCBlbiB0ZXJtZXMgZGUgcHJvZHVjdGlvbiBhbGltZW50YWlyZSBxdWUgZCdhZ3JpY3VsdGV1cnMuIEljaSwgdm91cyBwb3V2ZXogZXhwbG9yZXIgY29tbWVudCBsYSB2YWxldXIgZGUgbGEgcHJvZHVjdGlvbiAoOjo6dm9wX2JsdXJiOjo6KSBldCBsYSB0YWlsbGUgZGUgbGEgcG9wdWxhdGlvbiBydXJhbGUgZGlmZsOocmVudCBlbnRyZSBkZXMgcGF5cyBldCBkZXMgcsOpZ2lvbnMgc3DDqWNpZmlxdWVzLiBDZSBjb250ZXh0ZSBlc3QgaW1wb3J0YW50IHBvdXIgY29tcHJlbmRyZSBsZXMgdnVsbsOpcmFiaWxpdMOpcyB1bmlxdWVzIGF1eHF1ZWxsZXMgZXN0IGNvbmZyb250w6kgbGUgc2VjdGV1ciBhZ3JpY29sZSBzdXIgbGUgY29udGluZW50LCBvdSBwb3VyIGRlcyB6b25lcyBnw6lvZ3JhcGhpcXVlcyBzcMOpY2lmaXF1ZXMuYFxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW5wdXRzOiB7XG4gICAgICAgIG1hcExheWVyOiB7XG4gICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgIGVuOiBcIk1hcCBsYXllclwiLFxuICAgICAgICAgICAgZnI6IFwiQ291Y2hlIGNhcnRvZ3JhcGhpcXVlXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIG9wdGlvbnM6IHtcbiAgICAgICAgICAgIHJ1cmFsUG9wOiB7XG4gICAgICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICAgICAgZW46IFwiUnVyYWwgcG9wdWxhdGlvblwiLFxuICAgICAgICAgICAgICAgIGZyOiBcIlBvcHVsYXRpb24gcnVyYWxlXCJcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbGFiZWxUaXA6IHtcbiAgICAgICAgICAgICAgICBlbjogXCJSdXJhbCBwb3B1bGF0aW9uXCIsXG4gICAgICAgICAgICAgICAgZnI6IFwiUG9wdWxhdGlvbiBydXJhbGVcIlxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBsYWJlbExlZ2VuZDoge1xuICAgICAgICAgICAgICAgIGVuOiBcIlJ1cmFsIHBvcHVsYXRpb25cIixcbiAgICAgICAgICAgICAgICBmcjogXCJQb3B1bGF0aW9uIHJ1cmFsZVwiXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB2b3A6IHtcbiAgICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICBlbjogXCJUb3RhbCBWYWx1ZSBvZiBQcm9kdWN0aW9uIChWb1ApXCIsXG4gICAgICAgICAgICAgICAgZnI6IFwiVmFsZXVyIHRvdGFsZSBkZSBsYSBwcm9kdWN0aW9uIChWRFApXCJcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbGFiZWxUaXA6IHtcbiAgICAgICAgICAgICAgICBlbjogXCJWb1BcIixcbiAgICAgICAgICAgICAgICBmcjogXCJWRFBcIlxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBsYWJlbExlZ2VuZDoge1xuICAgICAgICAgICAgICAgIGVuOiBgVmFsdWUgb2YgUHJvZHVjdGlvbiAoOjo6dW5pdDo6OilgLFxuICAgICAgICAgICAgICAgIGZyOiBgVmFsZXVyIGRlIGxhIHByb2R1Y3Rpb24gKDo6OnVuaXQ6OjopYFxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9LFxuICAgICAgaW5zaWdodHM6IHtcbiAgICAgICAgdGl0bGU6IHtcbiAgICAgICAgICBlbjogYDo6Omluc2lnaHRfc3RyaW5nOjo6IGZvciA6OjphZG1pbl9zZWxlY3Rpb246OjpgLFxuICAgICAgICAgIGZyOiBgOjo6aW5zaWdodF9zdHJpbmc6OjogcG91ciA6OjphZG1pbl9zZWxlY3Rpb246OjpgXG4gICAgICAgIH0sXG4gICAgICAgIGluc2lnaHRPdmVydmlldzoge1xuICAgICAgICAgIGVuOiBgKio6OjphZG1pbl9zZWxlY3Rpb246OjoqKidzIHRvdGFsIHZhbHVlIG9mIGNyb3AgYW5kIGxpdmVzdG9jayBwcm9kdWN0aW9uIGlzICoqOjo6dG90YWxfdm9wOjo6KiouYCxcbiAgICAgICAgICBmcjogYExhIHZhbGV1ciB0b3RhbGUgZGUgcHJvZHVjdGlvbiB2w6lnw6l0YWxlIGV0IGFuaW1hbGUgKio6OjphZG1pbl9zZWxlY3Rpb246OjoqKiBlc3QgZGUgKio6Ojp0b3RhbF92b3A6OjoqKi5gXG4gICAgICAgIH0sXG4gICAgICAgIGluc2lnaHRBcmVhQW5kUG9wOiB7XG4gICAgICAgICAgZW46IGBJdHMgY3JvcHMgYXJlIHByb2R1Y2VkIG92ZXIgYW4gYXJlYSBvZiAqKjo6OmFyZWE6OjoqKiBoZWN0YXJlcywgd2l0aCBydXJhbCBhcmVhcyBlbmNvbXBhc3NpbmcgYSBwb3B1bGF0aW9uIG9mICoqOjo6cG9wdWxhdGlvbjo6OioqIHBlb3BsZS5gLFxuICAgICAgICAgIGZyOiBgU2VzIGN1bHR1cmVzIHNvbnQgcHJvZHVpdGVzIHN1ciB1bmUgc3VwZXJmaWNpZSBkZSAqKjo6OmFyZWE6OjoqKiBoZWN0YXJlcywgYXZlYyBzZXMgem9uZXMgcnVyYWxlcyBhYnJpdGFudCB1bmUgcG9wdWxhdGlvbiBkZSAqKjo6OnBvcHVsYXRpb246OjoqKiBwZXJzb25uZXMuYFxuICAgICAgICB9LFxuICAgICAgICBpbnNpZ2h0VG9wQ29tbW9kaXR5OiB7XG4gICAgICAgICAgZW46IGBUaGUgdG9wIDo6OmNvbW1vZGl0eV93b3JkOjo6IGJ5IHZhbHVlOiA6OjpsaXN0X3N0cmluZzo6Oi5gLFxuICAgICAgICAgIGZyOiBgTGVzIHByaW5jaXBhdXggcHJvZHVpdHMgZGUgYmFzZSwgZW4gdGVybWVzIGRlIHZhbGV1cjogOjo6bGlzdF9zdHJpbmc6OjouYFxuICAgICAgICB9LFxuICAgICAgICBpbnNpZ2h0VG9wTGl2ZXN0b2NrOiB7XG4gICAgICAgICAgZW46IGBUaGUgdG9wIGxpdmVzdG9jayBzcGVjaWVzIGluIHRlcm1zIG9mIHBvcHVsYXRpb246IDo6Omxpc3Rfc3RyaW5nOjo6LmAsXG4gICAgICAgICAgZnI6IGBMZXMgcHJpbmNpcGFsZXMgZXNww6hjZXMgYW5pbWFsZXMgZW4gdGVybWVzIGRlIHBvcHVsYXRpb246IDo6Omxpc3Rfc3RyaW5nOjo6LmBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgY2xpbWF0ZVJpc2tzOiB7XG4gICAgICBpbnRybzoge1xuICAgICAgICBoMToge1xuICAgICAgICAgIGVuOiBcIkNsaW1hdGUgUmlza3NcIixcbiAgICAgICAgICBmcjogXCJSaXNxdWVzIENsaW1hdGlxdWVzXCJcbiAgICAgICAgfSxcbiAgICAgICAgb3BlbmVyOiB7XG4gICAgICAgICAgZW46IGBJbiAqKjo6OmFkbWluX3NlbGVjdGlvbjo6OioqLCBjbGltYXRlIGNoYW5nZSBjYW4gaW1wYWN0IGNyb3BzIGFuZCBsaXZlc3RvY2sgaW4gZGl2ZXJzZSB3YXlzLiBUaGUgc3BlY2lmaWMgcmlza3MgY2FuIHZhcnkgbm90IG9ubHkgYnkgcmVnaW9uIGJ1dCBhbHNvIGJ5IHRoZSB0eXBlIG9mIGNyb3Agb3IgbGl2ZXN0b2NrLiBVc2UgdGhlIGludGVyYWN0aXZlIGZlYXR1cmVzIGJlbG93IHRvIHNlbGVjdCBzcGVjaWZpYyBsb2NhdGlvbnMgYW5kIGNsaW1hdGUgY2hhbmdlIHNjZW5hcmlvcy4gVGhpcyB3aWxsIGhlbHAgeW91IHVuZGVyc3RhbmQgdGhlIHVuaXF1ZSBoYXphcmRzIGVhY2ggZmFjZXMgYW5kIGlkZW50aWZ5IHRoZSBtb3N0IGVjb25vbWljYWxseSBpbXBvcnRhbnQgY3JvcHMgYW5kIGxpdmVzdG9jayB0aGF0IGFyZSBleHBvc2VkIHRvIGhhemFyZHMuYCxcbiAgICAgICAgICBmcjogYCoqOjo6YWRtaW5fc2VsZWN0aW9uOjo6KiosIGxlIGNoYW5nZW1lbnQgY2xpbWF0aXF1ZSBwZXV0IGF2b2lyIGRlcyByw6lwZXJjdXNzaW9ucyBkaXZlcnNlcyBzdXIgbGVzIGN1bHR1cmVzIGV0IGxlIGLDqXRhaWwuIExlcyByaXNxdWVzIHNww6ljaWZpcXVlcyBwZXV2ZW50IHZhcmllciBub24gc2V1bGVtZW50IGVuIGZvbmN0aW9uIGRlIGxhIHLDqWdpb24sIG1haXMgYXVzc2kgZHUgdHlwZSBkZSBjdWx0dXJlIG91IGQnw6lsZXZhZ2UuIFV0aWxpc2V6IGxlcyBmb25jdGlvbnMgaW50ZXJhY3RpdmVzIGNpLWRlc3NvdXMgcG91ciBzw6lsZWN0aW9ubmVyIGRlcyBsaWV1eCBzcMOpY2lmaXF1ZXMgZXQgZGVzIHNjw6luYXJpb3MgZGUgY2hhbmdlbWVudCBjbGltYXRpcXVlLiBDZWxhIHZvdXMgYWlkZXJhIMOgIGNvbXByZW5kcmUgbGVzIGFsw6lhcyBzcMOpY2lmaXF1ZXMgYXV4cXVlbHMgY2hhY3VuIGVzdCBjb25mcm9udMOpIGV0IMOgIGlkZW50aWZpZXIgbGVzIGN1bHR1cmVzIGV0IGxlcyDDqWxldmFnZXMgbGVzIHBsdXMgaW1wb3J0YW50cyBzdXIgbGUgcGxhbiDDqWNvbm9taXF1ZSBxdWkgc29udCBleHBvc8OpcyDDoCBjZXMgYWzDqWFzLmBcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGNvbXBvdW5kSGF6YXJkczoge1xuICAgICAgICBoMjoge1xuICAgICAgICAgIGVuOiBcIkNvbXBvdW5kIEhhemFyZHNcIixcbiAgICAgICAgICBmcjogXCJSaXNxdWVzIEV4YWNlcmLDqXNcIlxuICAgICAgICB9LFxuICAgICAgICBvcGVuZXI6IHtcbiAgICAgICAgICBlbjogYFVuZGVyc3RhbmQgdGhlIHZhbHVlIG9mIHByb2R1Y3Rpb24gKDo6OnZvcF9ub3RlOjo6KSBhdCByaXNrIGZyb20gYWNyb3NzIGRpZmZlcmVudCBoYXphcmRzIGFsb25lIGFuZCBpbiBjb21iaW5hdGlvbi4gSG92ZXIgb3ZlciB0aGUgYmFycyBpbiB0aGUgY2hhcnQgYmVsb3cgdG8gZXhwbG9yZSB0aGUgcHJvcG9ydGlvbnMgb2YgYWdyaWN1bHR1cmFsIHZhbHVlIGluICoqOjo6YWRtaW5fc2VsZWN0aW9uOjo6KiogdGhhdCB3aWxsIGJlIGV4cG9zZWQgdG8gZGlmZmVyZW50IGhhemFyZCBjb21iaW5hdGlvbnMuYCxcbiAgICAgICAgICBmcjogYENvbXByZW5leiBsYSB2YWxldXIgZGUgbGEgcHJvZHVjdGlvbiAoOjo6dm9wX25vdGU6OjopIG1lbmFjw6llIHBhciBsZXMgZGlmZsOpcmVudHMgYWzDqWFzLCBzZXVscyBvdSBjb21iaW7DqXMuIFN1cnZvbGV6IGxlcyBiYXJyZXMgZHUgZ3JhcGhpcXVlIGNpLWRlc3NvdXMgcG91ciBkw6ljb3V2cmlyIGxhIHByb3BvcnRpb24gZGUgbGEgdmFsZXVyIGFncmljb2xlIGVuICoqOjo6YWRtaW5fc2VsZWN0aW9uOjo6KiogcXVpIHNlcmEgZXhwb3PDqWUgw6AgZGlmZsOpcmVudGVzIGNvbWJpbmFpc29ucyBkZSByaXNxdWVzLmBcbiAgICAgICAgfSxcbiAgICAgICAgaW5wdXRzOiB7XG4gICAgICAgICAgZHJvcGRvd25TY2VuYXJpbzoge1xuICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgZW46IFwiU2NlbmFyaW9cIixcbiAgICAgICAgICAgICAgZnI6IFwiU2PDqW5hcmlvXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBoaXN0b3JpYzoge1xuICAgICAgICAgICAgICBlbjogXCJIaXN0b3JpY1wiLFxuICAgICAgICAgICAgICBmcjogXCJIaXN0b3JpcXVlXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHN0YWNrZWRCYXI6IHtcbiAgICAgICAgICB4TGFiZWw6IHtcbiAgICAgICAgICAgIGVuOiBcIlRvdGFsIFZvUCAoJSlcIixcbiAgICAgICAgICAgIGZyOiBcIlZEUCBUb3RhbCAoJSlcIlxuICAgICAgICAgIH0sXG4gICAgICAgICAgdG9vbHRpcExhYmVsczoge1xuICAgICAgICAgICAgdm9wUmlzazoge1xuICAgICAgICAgICAgICBlbjogXCJWb1AgYXQgcmlzayBmcm9tIGhhemFyZFwiLFxuICAgICAgICAgICAgICBmcjogXCJWRFAgZW4gZGFuZ2VyIMOgIGNhdXNlIGTigJl1biByaXNxdWVcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGhhemFyZDoge1xuICAgICAgICAgICAgICBlbjogXCJIYXphcmRcIixcbiAgICAgICAgICAgICAgZnI6IFwiRGFuZ2VyXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB0b3RhbFZvcDoge1xuICAgICAgICAgICAgICBlbjogXCJUb3RhbCBWb1AgYXQgcmlza1wiLFxuICAgICAgICAgICAgICBmcjogXCJWRFAgVG90YWwgZW4gZGFuZ2VyXCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBoYXphcmRJbXBhY3Q6IHtcbiAgICAgICAgLy8gZGVmaW5lIGJ5IGRhdGEgZmllbGQgdmFsdWVzXG4gICAgICAgIGhhemFyZHM6IHtcbiAgICAgICAgICB3ZXQ6IHsgZW46IFwiV2V0IGFsb25lXCIsIGZyOiBcIkh1bWlkZVwiIH0sXG4gICAgICAgICAgZHJ5OiB7IGVuOiBcIkRyeSBhbG9uZVwiLCBmcjogXCJTZWNcIiB9LFxuICAgICAgICAgIGhlYXQ6IHsgZW46IFwiSGVhdCBhbG9uZVwiLCBmcjogXCJDaGF1ZFwiIH0sXG4gICAgICAgICAgZHJ5X2hlYXQ6IHsgZW46IFwiRHJ5IGFuZCBoZWF0XCIsIGZyOiBcIlNlYyBldCBDaGF1ZFwiIH0sXG4gICAgICAgICAgZHJ5X3dldDogeyBlbjogXCJEcnkgYW5kIHdldFwiLCBmcjogXCJTZWMgZXQgSHVtaWRlXCIgfSxcbiAgICAgICAgICBoZWF0X3dldDogeyBlbjogXCJIZWF0IGFuZCB3ZXRcIiwgZnI6IFwiQ2hhdWQgZXQgSHVtaWRlXCIgfSxcbiAgICAgICAgICBkcnlfaGVhdF93ZXQ6IHtcbiAgICAgICAgICAgIGVuOiBcIkhlYXQsIHdldCwgYW5kIGRyeVwiLFxuICAgICAgICAgICAgZnI6IFwiQ2hhdWQsIEh1bWlkZSwgZXQgU2VjXCJcbiAgICAgICAgICB9LFxuICAgICAgICAgIG5vX2hhemFyZDogeyBlbjogXCJObyBoYXphcmRcIiwgZnI6IFwiQXVjdW4gZGFuZ2VyXCIgfVxuICAgICAgICB9LFxuICAgICAgICBoMToge1xuICAgICAgICAgIGVuOiBcIkhhemFyZHMgd2l0aCB0aGUgTW9zdCBFeHBvc3VyZVwiLFxuICAgICAgICAgIGZyOiBcIkFsw6lhcyBwcsOpc2VudGFudCBsYSBwbHVzIGZvcnRlIGV4cG9zaXRpb25cIlxuICAgICAgICB9LFxuICAgICAgICBpbnRybzoge1xuICAgICAgICAgIGVuOiBcIlNlbGVjdCBkaWZmZXJlbnQgaGF6YXJkIGNvbWJpbmF0aW9ucyBhbmQgc2VlIHdoaWNoIGNyb3BzIGFuZCBsaXZlc3RvY2sgaGF2ZSB0aGUgbW9zdCBWb1AgYXQgcmlzay5cIixcbiAgICAgICAgICBmcjogXCJTw6lsZWN0aW9ubmV6IGRpZmbDqXJlbnRlcyBjb21iaW5haXNvbnMgZGUgcmlzcXVlcyBldCB2b3lleiBxdWVsbGVzIGN1bHR1cmVzIGV0IHF1ZWxzIGFuaW1hdXggc29udCBsZXMgcGx1cyBtZW5hY8Opcy5cIlxuICAgICAgICB9LFxuICAgICAgICBpbnB1dHM6IHtcbiAgICAgICAgICBkcm9wZG93bkhhemFyZDoge1xuICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgZW46IFwiSGF6YXJkXCIsXG4gICAgICAgICAgICAgIGZyOiBcIkRhbmdlclwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBwbG90czoge1xuICAgICAgICAgIGdlbmVyYWw6IHtcbiAgICAgICAgICAgIG5vUGxvdE1lc3NhZ2U6IHtcbiAgICAgICAgICAgICAgZW46IFwiTm8gVm9QIGV4cG9zdXJlXCIsXG4gICAgICAgICAgICAgIGZyOiBcIkF1Y3VuZSBleHBvc2l0aW9uIFZvUFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgdm9wTGFiZWw6IHtcbiAgICAgICAgICAgICAgZW46IFwiVm9QIGF0IHJpc2tcIixcbiAgICAgICAgICAgICAgZnI6IFwiVkRQIMOgIHJpc3F1ZVwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBjcm9wczoge1xuICAgICAgICAgICAgaGVhZGVyOiB7XG4gICAgICAgICAgICAgIGVuOiBgQ3JvcHMgbW9zdCBhdCBleHBvc2VkIHVuZGVyIDo6OmhhemFyZF9zdHJpbmc6OjpgLFxuICAgICAgICAgICAgICBmcjogYExlcyBjdWx0dXJlcyBsZXMgcGx1cyBleHBvc8OpcyDDoCA6OjpoYXphcmRfc3RyaW5nOjo6YFxuICAgICAgICAgICAgfVxuICAgICAgICAgIH0sXG4gICAgICAgICAgbGl2ZXN0b2NrOiB7XG4gICAgICAgICAgICBoZWFkZXI6IHtcbiAgICAgICAgICAgICAgZW46IGBMaXZlc3RvY2sgbW9zdCBhdCBleHBvc2VkIHVuZGVyIDo6OmhhemFyZF9zdHJpbmc6OjpgLFxuICAgICAgICAgICAgICBmcjogYExlcyBiw6l0YWlscyBsZSBwbHVzIGV4cG9zw6lzIMOgIDo6OmhhemFyZF9zdHJpbmc6OjpgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBpbnNpZ2h0czoge1xuICAgICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgICBlbjogYDo6Omluc2lnaHRfc3RyaW5nOjo6IGZvciA6OjphZG1pbl9zZWxlY3Rpb246OjogKDo6OnNjZW5hcmlvOjo6KWAsXG4gICAgICAgICAgICBmcjogYDo6Omluc2lnaHRfc3RyaW5nOjo6IHBvdXIgOjo6YWRtaW5fc2VsZWN0aW9uOjo6ICg6OjpzY2VuYXJpbzo6OilgXG4gICAgICAgICAgfSxcbiAgICAgICAgICBoYXphcmRCbHVyYjoge1xuICAgICAgICAgICAgZW46IGBGb3IgaGF6YXJkOiAqKjo6OmhhemFyZF9zdHJpbmc6OjoqKmAsXG4gICAgICAgICAgICBmcjogYFBvdXIgbGUgcmlzcXVlOiAqKjo6OmhhemFyZF9zdHJpbmc6OjoqKmBcbiAgICAgICAgICB9LFxuICAgICAgICAgIGxhYmVsczoge1xuICAgICAgICAgICAgdG90YWxWb3BDcm9wOiB7XG4gICAgICAgICAgICAgIGVuOiBcIlRvdGFsIEV4cG9zZWQgVm9QLCBDcm9wXCIsXG4gICAgICAgICAgICAgIGZyOiBcIlZhbGV1ciBUb3RhbGUgZGUgbGEgUHJvZHVjdGlvbiDDgCBSaXNxdWUsIEN1bHR1cmVcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHRvdGFsVm9wTGl2ZXN0b2NrOiB7XG4gICAgICAgICAgICAgIGVuOiBcIlRvdGFsIEV4cG9zZWQgVm9QLCBMaXZlc3RvY2tcIixcbiAgICAgICAgICAgICAgZnI6IFwiVmFsZXVyIFRvdGFsZSBkZSBsYSBQcm9kdWN0aW9uIMOAIFJpc3F1ZSwgQsOpdGFpbFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZXhwb3N1cmVDcm9wOiB7XG4gICAgICAgICAgICAgIGVuOiBcIkNyb3AsIGdyZWF0ZXN0IGV4cG9zdXJlXCIsXG4gICAgICAgICAgICAgIGZyOiBcIkN1bHR1cmUsIHBsdXMgw6AgcmlzcXVlXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBleHBvc3VyZUxpdmVzdG9jazoge1xuICAgICAgICAgICAgICBlbjogXCJMaXZlc3RvY2ssIGdyZWF0ZXN0IGV4cG9zdXJlXCIsXG4gICAgICAgICAgICAgIGZyOiBcIkLDqXRhaWwsIHBsdXMgw6AgcmlzcXVlOlwiXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSxcbiAgICAgICAgICBibHVyYkJpZ2dlc3RIYXphcmQ6IHtcbiAgICAgICAgICAgIGVuOiBcIlRoZSBiaWdnZXN0IGhhemFyZHMgZm9yIHNlbGVjdGlvbiBhbmQgc2NlbmFyaW8vdGltZWZyYW1lIGFyZTpcIixcbiAgICAgICAgICAgIGZyOiBcIkxlcyByaXNxdWVzIGxlcyBwbHVzIGltcG9ydGFudHMgcG91ciBsYSBzw6lsZWN0aW9uIGV0IHNjw6luYXJpby9ww6lyaW9kZSBzb250IGxlcyBzdWl2YW50czpcIlxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgYWRhcHRpdmVDYXBhY2l0aWVzOiB7XG4gICAgICBoMToge1xuICAgICAgICBlbjogXCJBZGFwdGl2ZSBDYXBhY2l0aWVzXCIsXG4gICAgICAgIGZyOiBcIkNhcGFjaXTDqXMgQWRhcHRhdGl2ZXNcIlxuICAgICAgfSxcbiAgICAgIGludHJvOiB7XG4gICAgICAgIGVuOiBgRmFybWVycyBhYmlsaXR5IHRvIGFkYXB0IHRvIGNsaW1hdGUgY2hhbmdlIGluICoqOjo6YWRtaW5fc2VsZWN0aW9uOjo6KiogaGluZ2VzIG9uIHNldmVyYWwga2V5IHNvY2lvLWVjb25vbWljIGZhY3RvcnMuIFRoZXNlIGluY2x1ZGUgcG92ZXJ0eSwgZWR1Y2F0aW9uLCBhbmQgZ2VuZGVyIGluZXF1YWxpdHksIHdoaWNoIHNpZ25pZmljYW50bHkgaW5mbHVlbmNlIHRoZWlyIHZ1bG5lcmFiaWxpdHkgYW5kIHRoZWlyIGNhcGFjaXR5IHRvIHJlc3BvbmQgZWZmZWN0aXZlbHkuIEV4cGxvcmUgdGhlIG1hcCBhbmQgaW5kZXhlcyBiZWxvdyB0byBnYWluIGEgZGVlcGVyIHVuZGVyc3RhbmRpbmcgb2YgdGhlIGdlb2dyYXBoaWMgZGlzdHJpYnV0aW9uIG9mIHRoZXNlIHZhcmlhYmxlcyBhY3Jvc3MgdGhlIHJlZ2lvbi4gRWFjaCBvZiB0aGUgdGhyZWUgaW5kZXhlcyBhcmUgc2NvcmVkIGJldHdlZW4gMCBhbmQgMTAwLiBGb3IgdGhlIHBvdmVydHkgaW5kZXgsIGxvd2VyIHZhbHVlcyBpbmRpY2F0ZSBsb3dlciBsZXZlbHMgb2YgcG92ZXJ0eS4gRm9yIEVkdWNhdGlvbiBhbmQgRmVtYWxlIEVtcG93ZXJtZW50LCBhIGhpZ2hlciBzY29yZSBpbmRpY2F0ZXMgaW5jcmVhc2VkIGxldmVscyBvZiBlZHVjYXRpb25hbCBhdHRhaW5tZW50IGFuZCBmZW1hbGUgZGVjaXNpb24gbWFraW5nIHBvd2VyLmAsXG4gICAgICAgIGZyOiBgTGEgY2FwYWNpdMOpIGRlcyBhZ3JpY3VsdGV1cnMgKio6OjphZG1pbl9zZWxlY3Rpb246OjoqKiDDoCBzJ2FkYXB0ZXIgYXUgY2hhbmdlbWVudCBjbGltYXRpcXVlIGTDqXBlbmQgZGUgcGx1c2lldXJzIGZhY3RldXJzIHNvY2lvLcOpY29ub21pcXVlcyBjbMOpcy4gSWwgcydhZ2l0IG5vdGFtbWVudCBkZSBsYSBwYXV2cmV0w6ksIGRlIGwnw6lkdWNhdGlvbiBldCBkZSBsJ2luw6lnYWxpdMOpIGVudHJlIGxlcyBnZW5yZXMsIHF1aSBpbmZsdWVuY2VudCBjb25zaWTDqXJhYmxlbWVudCBsZXVyIHZ1bG7DqXJhYmlsaXTDqSBldCBsZXVyIGNhcGFjaXTDqSDDoCByw6lhZ2lyIGVmZmljYWNlbWVudC4gTGEgY2FydGUgZXQgbGVzIGluZGljZXMgY2ktZGVzc291cyBwZXJtZXR0ZW50IGRlIG1pZXV4IGNvbXByZW5kcmUgbGEgcsOpcGFydGl0aW9uIGfDqW9ncmFwaGlxdWUgZGUgY2VzIHZhcmlhYmxlcyBkYW5zIGxhIHLDqWdpb24uIENoYWN1biBkZXMgdHJvaXMgaW5kaWNlcyBlc3Qgbm90w6kgZW50cmUgMCBldCAxMDAuIFBvdXIgbCdpbmRpY2UgZGUgcGF1dnJldMOpLCBkZXMgdmFsZXVycyBwbHVzIGZhaWJsZXMgaW5kaXF1ZW50IGRlcyBuaXZlYXV4IGRlIHBhdXZyZXTDqSBtb2lucyDDqWxldsOpcy4gUG91ciBsJ2luZGljZSBkJ8OpZHVjYXRpb24gZXQgZCdhdXRvbm9taXNhdGlvbiBkZXMgZmVtbWVzLCB1biBzY29yZSBwbHVzIMOpbGV2w6kgaW5kaXF1ZSBkZXMgbml2ZWF1eCBkJ8OpZHVjYXRpb24gcGx1cyDDqWxldsOpcyBldCB1biBwb3V2b2lyIGRlIGTDqWNpc2lvbiBwbHVzIGltcG9ydGFudCBwb3VyIGxlcyBmZW1tZXMuYFxuICAgICAgfSxcbiAgICAgIGlucHV0czoge1xuICAgICAgICBtYXBMYXllcjoge1xuICAgICAgICAgIGxhYmVsOiB7XG4gICAgICAgICAgICBlbjogXCJNYXAgbGF5ZXJcIixcbiAgICAgICAgICAgIGZyOiBcIkNvdWNoZSBkZSBjYXJ0ZVwiXG4gICAgICAgICAgfSxcbiAgICAgICAgICBvcHRpb25zOiB7XG4gICAgICAgICAgICBnZW5lcmFsOiB7XG4gICAgICAgICAgICAgIGxhYmVsczoge1xuICAgICAgICAgICAgICAgIHBvcHVsYXRpb246IHtcbiAgICAgICAgICAgICAgICAgIGVuOiBcIlBvcHVsYXRpb25cIixcbiAgICAgICAgICAgICAgICAgIGZyOiBcIlBvcHVsYXRpb25cIlxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvdjoge1xuICAgICAgICAgICAgICBsYWJlbDoge1xuICAgICAgICAgICAgICAgIGVuOiBcIlBvdmVydHkgUmF0ZVwiLFxuICAgICAgICAgICAgICAgIGZyOiBcIlRhdXggZGUgcGF1dnJldMOpXCJcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbGFiZWxMZWdlbmQ6IHtcbiAgICAgICAgICAgICAgICBlbjogXCJQb3ZlcnR5IFJhdGUgKCUgb2YgcG9wdWxhdGlvbiB1bmRlciAkMy42NSBwZXIgZGF5KVwiLFxuICAgICAgICAgICAgICAgIGZyOiBcIlRhdXggZGUgcGF1dnJldMOpICglIGRlIGxhIHBvcHVsYXRpb24gdml2YW50IGF2ZWMgbW9pbnMgZGUgMyw2NSAkIHBhciBqb3VyKVwiXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlZHU6IHtcbiAgICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICBlbjogXCJFZHVjYXRpb24gQXR0YWlubWVudFwiLFxuICAgICAgICAgICAgICAgIGZyOiBcIk5pdmVhdSBkJ8OpZHVjYXRpb25cIlxuICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICBsYWJlbExlZ2VuZDoge1xuICAgICAgICAgICAgICAgIGVuOiBcIkVkdWNhdGlvbiBBdHRhaW5tZW50IChZZWFycyBvZiBzY2hvb2xpbmcpXCIsXG4gICAgICAgICAgICAgICAgZnI6IFwiTml2ZWF1IGQnw6lkdWNhdGlvbiAoYW5uw6llcyBkZSBzY29sYXJpdMOpKVwiXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBmZW06IHtcbiAgICAgICAgICAgICAgbGFiZWw6IHtcbiAgICAgICAgICAgICAgICBlbjogXCJGZW1hbGUgZW1wb3dlcm1lbnQgaW5kZXhcIixcbiAgICAgICAgICAgICAgICBmcjogXCJJbmRpY2F0ZXVyIGTigJlhdXRvbm9taXNhdGlvbiBkZXMgZmVtbWVzXCJcbiAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgbGFiZWxMZWdlbmQ6IHtcbiAgICAgICAgICAgICAgICBlbjogXCJGZW1hbGUgZW1wb3dlcm1lbnQgaW5kZXggKGhpZ2hlciBpcyBiZXR0ZXIpXCIsXG4gICAgICAgICAgICAgICAgZnI6IFwiSW5kaWNhdGV1ciBk4oCZYXV0b25vbWlzYXRpb24gZGVzIGZlbW1lcyAocGx1cyBj4oCZZXN0IMOpbGV2w6ksIG1pZXV4IGPigJllc3QpXCJcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGluc2lnaHRzOiB7XG4gICAgICAgIHRpdGxlOiB7XG4gICAgICAgICAgZW46IGA6OjppbnNpZ2h0X3N0cmluZzo6OiBmb3IgOjo6YWRtaW5fc2VsZWN0aW9uOjo6YCxcbiAgICAgICAgICBmcjogYDo6Omluc2lnaHRfc3RyaW5nOjo6IHBvdXIgOjo6YWRtaW5fc2VsZWN0aW9uOjo6YFxuICAgICAgICB9LFxuICAgICAgICBtYWRMaWI6IHtcbiAgICAgICAgICBlbjogYCoqOjo6YWRtaW46OjoqKjogdGhlIGVkdWNhdGlvbiBpbmRleCBpcyAqKjo6OmluZGV4X2VkdTo6OioqLCB0aGUgZmVtYWxlIGVtcG93ZXJtZW50IGluZGV4IGlzICoqOjo6aW5kZXhfZmVtOjo6KiosIGFuZCB0aGUgcG92ZXJ0eSBpbmRleCBpcyAqKjo6OmluZGV4X3Bvdjo6OioqLmAsXG4gICAgICAgICAgZnI6IGAqKjo6OmFkbWluOjo6Kio6IGzigJlpbmRpY2UgZCfDqWR1Y2F0aW9uIGVzdCBkZSAqKjo6OmluZGV4X2VkdTo6OioqLCAgbOKAmWluZGV4IGTigJlhdXRvbm9taXNhdGlvbiBkZXMgZmVtbWVzIGV0IGRlICoqOjo6aW5kZXhfZmVtOjo6KiogZXQgbOKAmWluZGljZSBkZSBwYXV2cmV0w6kgZXN0IGRlICoqOjo6aW5kZXhfcG92Ojo6KiouYFxuICAgICAgICB9LFxuICAgICAgICBuZXN0ZWRMb2NhdGlvbkJsdXJiOiB7XG4gICAgICAgICAgZW46IGAqKjo6OmFkbWluX2lubmVyOjo6KiogaXMgbG9jYXRlZCB3aXRoaW4gKio6OjphZG1pbl9vdXRlcjo6OioqLmAsXG4gICAgICAgICAgZnI6IGAqKjo6OmFkbWluX2lubmVyOjo6KiogZXN0IHNpdHXDqSBkYW5zICoqOjo6YWRtaW5fb3V0ZXI6OjoqKi5gXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBkZWx2aW5nRGVlcGVyOiB7XG4gICAgICAgIGgyOiB7XG4gICAgICAgICAgZW46IFwiRGVsdmluZyBEZWVwZXJcIixcbiAgICAgICAgICBmcjogXCJBcHByb2ZvbmRpclwiXG4gICAgICAgIH0sXG4gICAgICAgIGludHJvOiB7XG4gICAgICAgICAgZW46IFwiQnkgYW5hbHl6aW5nIG92ZXJsYXlzIG9mIHBvdmVydHkgbGV2ZWxzLCBlZHVjYXRpb24gYXR0YWlubWVudCwgYW5kIGZlbWFsZSBlbXBvd2VybWVudCwgeW91IGNhbiBnYWluIGFkZGl0aW9uYWwgaW5zaWdodHMgaW50byB0aGUgZGl2ZXJzZSBjaGFsbGVuZ2VzIGFuZCBvcHBvcnR1bml0aWVzIGZhY2VkIGJ5IGNvbW11bml0aWVzLiBUaGlzIGRlZXBlciB1bmRlcnN0YW5kaW5nIG9mIGJhcnJpZXJzIHRvIGFkYXB0YXRpb24gY2FuIGhlbHAgeW91IHRvIGlkZW50aWZ5IHRoZSBsb2NhbGl6ZWQgY29udGV4dCBpbiB3aGljaCBjbGltYXRlIHJpc2sgbmVlZHMgdG8gYmUgYWRkcmVzc2VkLlwiLFxuICAgICAgICAgIGZyOiBcIkVuIGFuYWx5c2FudCBsZXMgc3VwZXJwb3NpdGlvbnMgZGVzIG5pdmVhdXggZGUgcGF1dnJldMOpLCBkdSBuaXZlYXUgZCfDqWR1Y2F0aW9uIGV0IGRlIGwnYXV0b25vbWlzYXRpb24gZGVzIGZlbW1lcywgdm91cyBwb3V2ZXogb2J0ZW5pciBkZXMgaW5mb3JtYXRpb25zIHN1cHBsw6ltZW50YWlyZXMgc3VyIGxlcyBkaXZlcnMgZMOpZmlzIGV0IG9wcG9ydHVuaXTDqXMgYXV4cXVlbHMgc29udCBjb25mcm9udMOpZXMgbGVzIGNvbW11bmF1dMOpcy4gQ2V0dGUgbWVpbGxldXJlIGNvbXByw6loZW5zaW9uIGRlcyBvYnN0YWNsZXMgw6AgbCdhZGFwdGF0aW9uIHBldXQgdm91cyBhaWRlciDDoCBpZGVudGlmaWVyIGxlIGNvbnRleHRlIGxvY2FsIGRhbnMgbGVxdWVsIGxlcyByaXNxdWVzIGNsaW1hdGlxdWVzIGRvaXZlbnQgw6p0cmUgYWJvcmTDqXMuXCJcbiAgICAgICAgfSxcbiAgICAgICAgcGxvdDoge1xuICAgICAgICAgIGxlZ2VuZDoge1xuICAgICAgICAgICAgZG9tYWluOiB7XG4gICAgICAgICAgICAgIGVuOiBbXCJCZXR0ZXJcIiwgXCJNb2RlcmF0ZVwiLCBcIldvcnNlXCJdLFxuICAgICAgICAgICAgICBmcjogW1wiTWVpbGxldXJcIiwgXCJNb3llblwiLCBcIlBpcmVcIl1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9LFxuICAgICAgICAgIG5hbWVNYXA6IHtcbiAgICAgICAgICAgIHBvcHVsYXRpb246IHtcbiAgICAgICAgICAgICAgZW46IFwiVG90YWwgUG9wdWxhdGlvblwiLFxuICAgICAgICAgICAgICBmcjogXCJQb3B1bGF0aW9uIFRvdGFsZVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcG92ZXJ0eTA6IHtcbiAgICAgICAgICAgICAgZW46IFwiTG93IFBvdmVydHlcIixcbiAgICAgICAgICAgICAgZnI6IFwiRmFpYmxlIE5pdmVhdSBkZSBQYXV2cmV0w6lcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIHBvdmVydHkxOiB7XG4gICAgICAgICAgICAgIGVuOiBcIk1vZGVyYXRlIFBvdmVydHlcIixcbiAgICAgICAgICAgICAgZnI6IFwiTW95ZW4gTml2ZWF1IGRlIFBhdXZyZXTDqVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcG92ZXJ0eTI6IHtcbiAgICAgICAgICAgICAgZW46IFwiSGlnaCBQb3ZlcnR5XCIsXG4gICAgICAgICAgICAgIGZyOiBcIkhhdXQgTml2ZWF1IGRlIFBhdXZyZXTDqVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZWR1Y2F0aW9uMDoge1xuICAgICAgICAgICAgICBlbjogXCIwLTEgWWVhcnMgb2YgRWR1Y2F0aW9uXCIsXG4gICAgICAgICAgICAgIGZyOiBcIjAtMSBhbnMgZCfDqWR1Y2F0aW9uXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBlZHVjYXRpb24xOiB7XG4gICAgICAgICAgICAgIGVuOiBcIjEtNSBZZWFycyBvZiBFZHVjYXRpb25cIixcbiAgICAgICAgICAgICAgZnI6IFwiMS01IGFucyBkJ8OpZHVjYXRpb25cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGVkdWNhdGlvbjI6IHtcbiAgICAgICAgICAgICAgZW46IFwiNSsgWWVhcnMgb2YgRWR1Y2F0aW9uXCIsXG4gICAgICAgICAgICAgIGZyOiBcIjUrIGFucyBkJ8OpZHVjYXRpb25cIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGdlbmRlcjA6IHtcbiAgICAgICAgICAgICAgZW46IFwiTG93IEZlbWFsZSBFbXBvd2VybWVudFwiLFxuICAgICAgICAgICAgICBmcjogXCJGYWlibGUgQXV0b25vbWlzYXRpb24gZGVzIEZlbW1lc1wiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgZ2VuZGVyMToge1xuICAgICAgICAgICAgICBlbjogXCJNb2RlcmF0ZSBGZW1hbGUgRW1wb3dlcm1lbnRcIixcbiAgICAgICAgICAgICAgZnI6IFwiTW95ZW5uZSBBdXRvbm9taXNhdGlvbiBkZXMgRmVtbWVzXCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBnZW5kZXIyOiB7XG4gICAgICAgICAgICAgIGVuOiBcIkhpZ2ggRmVtYWxlIEVtcG93ZXJtZW50XCIsXG4gICAgICAgICAgICAgIGZyOiBcIkhhdXRlIEF1dG9ub21pc2F0aW9uIGRlcyBGZW1tZXNcIlxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gICAgc3VtbWFyeToge1xuICAgICAgaDE6IHtcbiAgICAgICAgZW46IFwiU3VtbWFyeVwiLFxuICAgICAgICBmcjogXCJSw6lzdW3DqVwiXG4gICAgICB9LFxuICAgICAgYmxvY2tzOiB7XG4gICAgICAgIGR5bmFtaWNTdW1tYXJ5OiB7XG4gICAgICAgICAgaW50cm86IHtcbiAgICAgICAgICAgIGVuOiBgVGhlIHBlb3BsZSBvZiAqKjo6OmFkbWluMDo6OioqIG5lZWQgdG8gYmUgcmVhZHkgd2l0aCBzdHJhdGVnaWVzIHRvIG1ha2UgY3JvcHMgYW5kIGxpdmVzdG9jayBtb3JlIHJlc2lsaWVudCB0byBjb21iYXQgdGhlIGNoYW5naW5nIGNsaW1hdGUuYCxcbiAgICAgICAgICAgIGZyOiBgTGVzIGhhYml0YW50cyAqKjo6OmFkbWluMDo6OioqIGRvaXZlbnQgw6p0cmUgcHLDqnRzIMOgIG1ldHRyZSBlbiBwbGFjZSBkZXMgc3RyYXTDqWdpZXMgdmlzYW50IMOgIHJlbmRyZSBsZXMgY3VsdHVyZXMgZXQgbGUgYsOpdGFpbCBwbHVzIHLDqXNpc3RhbnRzIHBvdXIgbHV0dGVyIGNvbnRyZSBsZSBjaGFuZ2VtZW50IGNsaW1hdGlxdWUuYFxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgY2xvc2VyOiB7XG4gICAgICAgICAgZW46IFwiVGhpcyB3b3JrIGFpbXMgdG8gZW5oYW5jZSBjcm9wIHZhcmlldHkgYW5kIGxpdmVzdG9ja3MgYnJlZWQsIHJlZHVjZSBlbWlzc2lvbnMsIHByb21vdGUgc3VzdGFpbmFibGUgbGFuZCBtYW5hZ2VtZW50LCBhbmQgZWR1Y2F0ZSBhbmQgdHJhaW4gcG9wdWxhdGlvbnMgb24gY2xpbWF0ZS1zbWFydCBhZ3JpY3VsdHVyZSBwcmFjdGljZXMuXCIsXG4gICAgICAgICAgZnI6IFwiQ2VzIHRyYXZhdXggdmlzZW50IMOgIGFtw6lsaW9yZXIgbGEgdmFyacOpdMOpIGRlcyBjdWx0dXJlcyBldCBsYSByYWNlIGRlcyBhbmltYXV4LCDDoCByw6lkdWlyZSBsZXMgw6ltaXNzaW9ucywgw6AgcHJvbW91dm9pciBsYSBnZXN0aW9uIGR1cmFibGUgZGVzIHRlcnJlcyBldCDDoCDDqWR1cXVlciBldCBmb3JtZXIgbGVzIHBvcHVsYXRpb25zIGF1eCBwcmF0aXF1ZXMgYWdyaWNvbGVzIGludGVsbGlnZW50ZXMgZmFjZSBhdSBjbGltYXQuXCJcbiAgICAgICAgfVxuICAgICAgfSxcbiAgICAgIGR5bmFtaWNTdW1tYXJ5bGlzdDoge1xuICAgICAgICBlbjogYEEgcmFuZ2Ugb2Ygc3RyYXRlZ2llcyBhbmQgcG9saWNpZXMgY2FuIGJlIGltcGxlbWVudGVkIGluIHN1cHBvcnQgb2YgcmVzZWFyY2hpbmcgYW5kIGFkZHJlc3NpbmcgdGhlIGltcGFjdCBvZiBjbGltYXRlIGNoYW5nZSBvbiBhZ3JpY3VsdHVyZSwgaW5jbHVkaW5nOlxuXG46OjptYXJrZG93bkxpc3Q6OjpgLFxuICAgICAgICBmcjogYFVuZSBzw6lyaWUgZGUgc3RyYXTDqWdpZXMgZXQgZGUgcG9saXRpcXVlcyBwZXV2ZW50IMOqdHJlIG1pc2VzIGVuIMWTdXZyZSBwb3VyIHNvdXRlbmlyIGxhIHJlY2hlcmNoZSBldCBsYSBwcmlzZSBlbiBjb21wdGUgZGUgbCdpbXBhY3QgZHUgY2hhbmdlbWVudCBjbGltYXRpcXVlIHN1ciBsJ2FncmljdWx0dXJlOlxuXG46OjptYXJrZG93bkxpc3Q6OjpgXG4gICAgICB9XG4gICAgfSxcbiAgICBtZXRob2RzOiB7XG4gICAgICBoMToge1xuICAgICAgICBlbjogXCJNZXRob2RzICYgU291cmNlc1wiLFxuICAgICAgICBmcjogXCJNw6l0aG9kZXMgJiBTb3VyY2VzXCJcbiAgICAgIH0sXG4gICAgICBzZWN0aW9uMToge1xuICAgICAgICBlbjogXCJEYXRhc2V0c1wiLFxuICAgICAgICBmcjogXCJFbnNlbWJsZXMgZGUgRG9ubsOpZXNcIixcbiAgICAgICAgc3Vic2VjdGlvbnM6IHtcbiAgICAgICAgICBlbjogYCMjIyBFeHBvc3VyZSAoVmFsdWUgb2YgUHJvZHVjdGlvbilcbi0gKipbQ3JvcCB2YWx1ZSBvZiBwcm9kdWN0aW9uXShodHRwczovL3JhZGlhbnRlYXJ0aC5naXRodWIuaW8vc3RhYy1icm93c2VyLyMvZXh0ZXJuYWwvZGlnaXRhbC1hdGxhcy5zMy5hbWF6b25hd3MuY29tL3N0YWMvcHVibGljX3N0YWMvZXhwb3N1cmVfY2F0YWxvZy9tYXBzcGFtMjAxNy9tYXBzcGFtMjAxN192b3BfcGFycXVldC9tYXBzcGFtMjAxN192b3BfcGFycXVldC5qc29uKSoqIGRhdGEgY29tZXMgZnJvbSAgTWFwU1BBTSAyMDE3IFYycjMgKFNwYXRpYWwgUHJvZHVjdGlvbiBBbGxvY2F0aW9uIE1vZGVsKSB3aGVyZSBwcm9kdWN0aW9uIHZhbHVlcyBhcmUgbXVsdGlwbGllZCBieSBjb3VudHJ5IHNwZWNpZmljIEZBT3N0YXQgaW50ZXJuYXRpb25hbCBjcm9wIHByaWNlcyBpbiAoMjAwNSBJbnRlcm5hdGlvbmFsIERvbGxhcnMpLlxuQW4gW2ludGVybmF0aW9uYWwgZG9sbGFyXShodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9JbnRlcm5hdGlvbmFsX2RvbGxhcikgKDIwMDUpIGlzIGEgaHlwb3RoZXRpY2FsIHVuaXQgb2YgY3VycmVuY3kgdGhhdCBoYXMgdGhlIHNhbWUgcHVyY2hhc2luZyBwb3dlciBwYXJpdHkgYXMgdGhlIFUuUy4gZG9sbGFyIGhhZCBpbiB0aGUgVW5pdGVkIFN0YXRlcyBpbiAyMDA1LCBhbGxvd2luZyBmb3IgY29tcGFyaXNvbiBvZiB3aGF0IGNvbnN1bWVycyBjYW4gYnV5IGluIGRpZmZlcmVudCBjb3VudHJpZXMgd2l0aCB0aGUgc2FtZSBhbW91bnQgb2YgbW9uZXkuXG5UaGlzIGRhdGFzZXQgaXMgYW4gdXBkYXRlZCB2ZXJzaW9uIG9mIE1hcFNQQU0gc3BlY2lmaWNhbGx5IHRhaWxvcmVkIGZvciB0aGlzIHByb2plY3QuIEl0IGluY2x1ZGVzIGJ1ZyBmaXhlcyBhbmQgaW5jb3Jwb3JhdGVzIGNvdW50cnktc3BlY2lmaWMgdmFsdWVzIG9mIHByb2R1Y3Rpb24gaW5zdGVhZCBvZiBnbG9iYWwgYXZlcmFnZXMuXG4tICoqW0xpdmVzdG9jayB2YWx1ZSBvZiBwcm9kdWN0aW9uXShodHRwczovL3JhZGlhbnRlYXJ0aC5naXRodWIuaW8vc3RhYy1icm93c2VyLyMvZXh0ZXJuYWwvZGlnaXRhbC1hdGxhcy5zMy5hbWF6b25hd3MuY29tL3N0YWMvcHVibGljX3N0YWMvZXhwb3N1cmVfY2F0YWxvZy9HTFczX2xpdmVzdG9jay9HTFczX2xpdmVzdG9ja192b3BQUS9HTFczX2xpdmVzdG9ja192b3BQUS5qc29uKSoqIGluIDIwMDUgSW50ZXJuYXRpb25hbCBEb2xsYXJzIHdlcmUgcHJvdmlkZWQgYnkgdGhlIGF1dGhvcnMgb2YgW0hlcnJlcm8gZXQgYWwuICgyMDEzKV0oaHR0cHM6Ly93d3cucG5hcy5vcmcvZG9pL2Z1bGwvMTAuMTA3My9wbmFzLjEzMDgxNDkxMTAvKS5cblxuIyMjIEFkYXB0aXZlIENhcGFjaXRpZXNcbi0gKipbUG9wdWxhdGlvbl0oaHR0cHM6Ly9yYWRpYW50ZWFydGguZ2l0aHViLmlvL3N0YWMtYnJvd3Nlci8jL2V4dGVybmFsL2RpZ2l0YWwtYXRsYXMuczMuYW1hem9uYXdzLmNvbS9zdGFjL3B1YmxpY19zdGFjL3BvcHVsYXRpb24vd29ybGRwb3BfMjAyMC9wb3BfMjAyMF9wYXJxdWV0L3BvcF8yMDIwX3BhcnF1ZXQuanNvbikqKiBkYXRhIGlzIGZyb20gdGhlIFtXb3JsZFBvcCBVbmNvbnN0cmFpbmVkIEdsb2JhbCBNb3NhaWNdKGh0dHBzOi8vaHViLndvcmxkcG9wLm9yZy9nZW9kYXRhL2xpc3Rpbmc/aWQ9NjQpIGZvciAyMDIwLlxuLSAqKltQb3ZlcnR5XShodHRwczovL3JhZGlhbnRlYXJ0aC5naXRodWIuaW8vc3RhYy1icm93c2VyLyMvZXh0ZXJuYWwvZGlnaXRhbC1hdGxhcy5zMy5hbWF6b25hd3MuY29tL3N0YWMvcHVibGljX3N0YWMvYWRhcHRpdmUtY2FwYWNpdHkvcG92ZXJ0eS9ncmRpL2dyZGlfaGlzdG9yaWNhbF8yMDEwLTIwMjAvZ3JkaV9oaXN0b3JpY2FsXzIwMTAtMjAyMC5qc29uKSoqIGRhdGEgaXMgZnJvbSB0aGUgW0dsb2JhbCBHcmlkZGVkIERlcHJpdmF0aW9uIEluZGV4XShodHRwczovL3NlZGFjLmNpZXNpbi5jb2x1bWJpYS5lZHUvZGF0YS9zZXQvcG92bWFwLWdyZGktdjEpLlxuLSAgKipbRWR1Y2F0aW9uXShodHRwczovL3JhZGlhbnRlYXJ0aC5naXRodWIuaW8vc3RhYy1icm93c2VyLyMvZXh0ZXJuYWwvZGlnaXRhbC1hdGxhcy5zMy5hbWF6b25hd3MuY29tL3N0YWMvcHVibGljX3N0YWMvYWRhcHRpdmUtY2FwYWNpdHkvZWR1Y2F0aW9uX2NhdGFsb2cvY2F0YWxvZy5qc29uKSoqIGRhdGEgZm9yIHRoZSBpY2ljbGUgcGxvdCBpcyB0aGUgbWVhbiBtYWxlIGFuZCBmZW1hbGUgZWR1Y2F0aW9uYWwgYXR0YWlubWVudCBmcm9tIHRoZSBbMjAwNS0yMDE1IElITUUgRXN0aW1hdGVzIGZvciBhZ2VzIDE1LTQ5XShodHRwczovL2doZHguaGVhbHRoZGF0YS5vcmcvcmVjb3JkL2lobWUtZGF0YS9hZnJpY2EtZWR1Y2F0aW9uYWwtYXR0YWlubWVudC1nZW9zcGF0aWFsLWVzdGltYXRlcy0yMDAwLTIwMTUpLiBUaGUgZWR1Y2F0aW9uIHJhdGUgY29tYmluZXMgZWR1Y2F0aW9uYWwgYXR0YWlubWVudCB3aXRoIGV4cGVjdGVkIHllYXJzIG9mIHNjaG9vbGluZyBpbiBhIFtjb21wb3NpdGUgaW5kZXggYXMgcGFydCBvZiB0aGUgU3ViLW5hdGlvbmFsIEhESV0oaHR0cHM6Ly9nbG9iYWxkYXRhbGFiLm9yZy9zaGRpL21ldGFkYXRhL2VkaW5kZXgvKS5cbi0gKipbRmVtYWxlIEVtcG93ZXJtZW50XShodHRwczovL3JhZGlhbnRlYXJ0aC5naXRodWIuaW8vc3RhYy1icm93c2VyLyMvZXh0ZXJuYWwvZGlnaXRhbC1hdGxhcy5zMy5hbWF6b25hd3MuY29tL3N0YWMvcHVibGljX3N0YWMvYWRhcHRpdmUtY2FwYWNpdHkvd29tZW4tYW5kLWdlbmRlci9mZW1hbGUtZW1wb3dlcm1lbnQvR2VuZGVyRXF1aXR5XzE5OTUtMjAxNS9HZW5kZXJFcXVpdHlfMTk5NS0yMDE1Lmpzb24pKiogaXMgYSBjb21wb3NpdGUgaW5kZXggb2YgIGRvbWVzdGljIHZpb2xlbmNlLCBlbXBsb3ltZW50LCByZXByb2R1Y3RpdmUgaGVhbHRoY2FyZSwgZGVjaXNpb24gbWFraW5nIHBvd2VyLCBhbmQgZmFtaWx5IHBsYW5uaW5nLiBUaGUgaW5kZXggaXMgZnJvbSBbUmV0dGlnLCBFcmljYSAoMjAyMildKGh0dHBzOi8vZGF0YXZlcnNlLmhhcnZhcmQuZWR1L2RhdGFzZXQueGh0bWw/cGVyc2lzdGVudElkPWRvaToxMC43OTEwL0RWTi84R0pLWVcpIGFuZCBiYXNlZCBvbiBpbnB1dCBkYXRhIGZyb20gdGhlIFtESFMgUHJvZ3JhbV0oaHR0cHM6Ly9kaHNwcm9ncmFtLmNvbSkuXG5cbiMjIyBCb3VuZGFyaWVzXG5bQWRtaW5pc3RyYXRpdmUgYXJlYXNdKGh0dHBzOi8vcmFkaWFudGVhcnRoLmdpdGh1Yi5pby9zdGFjLWJyb3dzZXIvIy9leHRlcm5hbC9kaWdpdGFsLWF0bGFzLnMzLmFtYXpvbmF3cy5jb20vc3RhYy9wdWJsaWNfc3RhYy9ib3VuZGFyeV9jYXRhbG9nL2dlb0JvdW5kYXJpZXNfU1NBL2NvbGxlY3Rpb24uanNvbikgdXNlZCBpbiB0aGlzIG5vdGVib29rIGNvbWUgZnJvbSBbZ2VvQm91bmRhcmllcyA2LjAuMF0oaHR0cHM6Ly9naXRodWIuY29tL3dtZ2VvbGFiL2dlb0JvdW5kYXJpZXMpLiBUaGUgZ2JIdW1hbml0YXJpYW4gYm91bmRhcmllcyBhcmUgdXNlZCBhbmQgaWYgbm90IGF2YWlsYWJsZSB0aGVuIHRoZSBnYk9wZW4gYm91bmRhcmllcyBhcmUgc3Vic3RpdHV0ZWQuXG5cbiMjIyBDbGltYXRlIEhhemFyZHMgJiBSaXNrXG5bQ2xpbWF0ZSBoYXphcmRzXShodHRwczovL3JhZGlhbnRlYXJ0aC5naXRodWIuaW8vc3RhYy1icm93c2VyLyMvZXh0ZXJuYWwvZGlnaXRhbC1hdGxhcy5zMy5hbWF6b25hd3MuY29tL3N0YWMvcHVibGljX3N0YWMvaGF6YXJkX2NhdGFsb2cvY2F0YWxvZy5qc29uKSB3ZXJlIGNhbGN1bGF0ZWQgdXNpbmcgZml2ZSBkYXRhc2V0cyBbQ0hJUlBTXShodHRwczovL3d3dy5jaGMudWNzYi5lZHUvZGF0YS9jaGlycHMpL1tDSElSVFNdKGh0dHBzOi8vd3d3LmNoYy51Y3NiLmVkdS9kYXRhL2NoaXJ0c2RhaWx5KSwgW0FnRVJBNV0oaHR0cHM6Ly9kb2kub3JnLzEwLjI0MzgxL2Nkcy42YzY4YzliYiksIFtDTUlQNiBwcm9qZWN0aW9uc10oaHR0cHM6Ly9naXRodWIuY29tL1NhbnRhbmRlck1ldEdyb3VwL0FUTEFTKSwgYW5kIFtjcm9wIGNhbGVuZGFyc10oaHR0cHM6Ly96ZW5vZG8ub3JnL3JlY29yZHMvNTA2MjUxMykuIFVzaW5nIHRoZSBSIHdvcmtmbG93cyBtZW50aW9uZWQgYmVsb3csIHJhdyBoYXphcmQgZGF0YSB3ZXJlIGNvbnZlcnRlZCB0byByaXNrLCBpbnRlcnNlY3RlZCB3aXRoIGV4cG9zdXJlIGFuZCBleHRyYWN0ZWQgYnkgYWRtaW5pc3RyYXRpdmUgYm91bmRhcmllcyB0byBnZW5lcmF0ZSB0YWJ1bGFyIGRhdGEgaW4gcGFycXVldCBmb3JtLCBmb3IgZXhhbXBsZSBbc2V2ZXJlX2FkbV9pbnQucGFycXVldF0oaHR0cHM6Ly9yYWRpYW50ZWFydGguZ2l0aHViLmlvL3N0YWMtYnJvd3Nlci8jL2V4dGVybmFsL2RpZ2l0YWwtYXRsYXMuczMuYW1hem9uYXdzLmNvbS9zdGFjL3B1YmxpY19zdGFjL2hhemFyZF9jYXRhbG9nL2hhemFyZF9yaXNrX3ZvcF9hbm51YWwvYW5udWFsX2RpZ2l0YWwtYXRsYXMvaGF6YXJkcy9oYXphcmRfcmlza192b3AvYW5udWFsL3NldmVyZV9hZG1faW50LnBhcnF1ZXQvYW5udWFsX2RpZ2l0YWwtYXRsYXMvaGF6YXJkcy9oYXphcmRfcmlza192b3AvYW5udWFsL3NldmVyZV9hZG1faW50LnBhcnF1ZXQuanNvbikuYCxcblxuICAgICAgICAgIGZyOiBgIyMjIEV4cG9zaXRpb24gYXUgUmlzcXVlcyAoVmFsZXVyIGRlIFByb2R1Y3Rpb24pXG4tICoqW0xlcyBkb25uw6llcyBzdXIgbGEgdmFsZXVyIGRlIGxhIHByb2R1Y3Rpb24gZGVzIGN1bHR1cmVzXShodHRwczovL3JhZGlhbnRlYXJ0aC5naXRodWIuaW8vc3RhYy1icm93c2VyLyMvZXh0ZXJuYWwvZGlnaXRhbC1hdGxhcy5zMy5hbWF6b25hd3MuY29tL3N0YWMvcHVibGljX3N0YWMvZXhwb3N1cmVfY2F0YWxvZy9tYXBzcGFtMjAxNy9tYXBzcGFtMjAxN192b3BfcGFycXVldC9tYXBzcGFtMjAxN192b3BfcGFycXVldC5qc29uKSoqIHByb3ZpZW5uZW50IGRlIE1hcFNQQU0gMjAxNyBWMnIzIChNb2TDqGxlIGQnQWxsb2NhdGlvbiBkZSBQcm9kdWN0aW9uIFNwYXRpYWxlKSBvw7kgbGVzIHZhbGV1cnMgZGUgcHJvZHVjdGlvbiBzb250IG11bHRpcGxpw6llcyBwYXIgbGVzIHByaXggaW50ZXJuYXRpb25hdXggZGVzIGN1bHR1cmVzIGRlIGxhIEZBT3N0YXQgc3DDqWNpZmlxdWVzIMOgIGNoYXF1ZSBwYXlzIGVuIChkb2xsYXJzIGludGVybmF0aW9uYXV4IGRlIDIwMDUpLiBVbiBbZG9sbGFyIGludGVybmF0aW9uYWxdKGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0ludGVybmF0aW9uYWxfZG9sbGFyKSAoMjAwNSkgZXN0IHVuZSB1bml0w6kgbW9uw6l0YWlyZSBoeXBvdGjDqXRpcXVlIHF1aSBhIGxhIG3Dqm1lIHBhcml0w6kgZGUgcG91dm9pciBkJ2FjaGF0IHF1ZSBsZSBkb2xsYXIgYW3DqXJpY2FpbiBhdXggw4l0YXRzLVVuaXMgZW4gMjAwNSwgY2UgcXVpIHBlcm1ldCBkZSBjb21wYXJlciBjZSBxdWUgbGVzIGNvbnNvbW1hdGV1cnMgcGV1dmVudCBhY2hldGVyIGRhbnMgZGlmZsOpcmVudHMgcGF5cyBhdmVjIGxhIG3Dqm1lIHNvbW1lIGQnYXJnZW50LiBDZXQgZW5zZW1ibGUgZGUgZG9ubsOpZXMgZXN0IHVuZSB2ZXJzaW9uIG1pc2Ugw6Agam91ciBkZSBNYXBTUEFNIHNww6ljaWFsZW1lbnQgY29uw6d1ZSBwb3VyIGNlIHByb2pldC4gSWwgY29tcHJlbmQgZGVzIGNvcnJlY3Rpb25zIGRlIGJvZ3VlcyBldCBpbmNvcnBvcmUgZGVzIHZhbGV1cnMgZGUgcHJvZHVjdGlvbiBzcMOpY2lmaXF1ZXMgw6AgY2hhcXVlIHBheXMgYXUgbGlldSBkZSBtb3llbm5lcyBtb25kaWFsZXMuXG4tICoqW0xhIHZhbGV1ciBkZSBsYSBwcm9kdWN0aW9uIGFuaW1hbGVdKGh0dHBzOi8vcmFkaWFudGVhcnRoLmdpdGh1Yi5pby9zdGFjLWJyb3dzZXIvIy9leHRlcm5hbC9kaWdpdGFsLWF0bGFzLnMzLmFtYXpvbmF3cy5jb20vc3RhYy9wdWJsaWNfc3RhYy9leHBvc3VyZV9jYXRhbG9nL0dMVzNfbGl2ZXN0b2NrL0dMVzNfbGl2ZXN0b2NrX3ZvcFBRL0dMVzNfbGl2ZXN0b2NrX3ZvcFBRLmpzb24pKiogZW4gZG9sbGFycyBpbnRlcm5hdGlvbmF1eCBkZSAyMDA1IGEgw6l0w6kgZm91cm5pZSBwYXIgbGVzIGF1dGV1cnMgZGUgW0hlcnJlcm8gZXQgYWwuICgyMDEzKV0oaHR0cHM6Ly93d3cucG5hcy5vcmcvZG9pL2Z1bGwvMTAuMTA3My9wbmFzLjEzMDgxNDkxMTAvKS5cblxuIyMjIENhcGFjaXTDqXMgQWRhcHRhdGl2ZXNcbi0gKipbTGVzIGRvbm7DqWVzIGTDqW1vZ3JhcGhpcXVlcyBwcm92aWVubmVudF0oaHR0cHM6Ly9yYWRpYW50ZWFydGguZ2l0aHViLmlvL3N0YWMtYnJvd3Nlci8jL2V4dGVybmFsL2RpZ2l0YWwtYXRsYXMuczMuYW1hem9uYXdzLmNvbS9zdGFjL3B1YmxpY19zdGFjL3BvcHVsYXRpb24vd29ybGRwb3BfMjAyMC9wb3BfMjAyMF9wYXJxdWV0L3BvcF8yMDIwX3BhcnF1ZXQuanNvbikqKiBbV29ybGRQb3AgVW5jb25zdHJhaW5lZCBHbG9iYWwgTW9zYWljXShodHRwczovL2h1Yi53b3JsZHBvcC5vcmcvZ2VvZGF0YS9saXN0aW5nP2lkPTY0KSBwb3VyIDIwMjAuXG4tICoqW0xlcyBkb25uw6llcyBkZSBwYXV2cmV0w6ldKGh0dHBzOi8vcmFkaWFudGVhcnRoLmdpdGh1Yi5pby9zdGFjLWJyb3dzZXIvIy9leHRlcm5hbC9kaWdpdGFsLWF0bGFzLnMzLmFtYXpvbmF3cy5jb20vc3RhYy9wdWJsaWNfc3RhYy9hZGFwdGl2ZS1jYXBhY2l0eS9wb3ZlcnR5L2dyZGkvZ3JkaV9oaXN0b3JpY2FsXzIwMTAtMjAyMC9ncmRpX2hpc3RvcmljYWxfMjAxMC0yMDIwLmpzb24pKiogcHJvdmllbm5lbnQgZHUgW0dsb2JhbCBHcmlkZGVkIERlcHJpdmF0aW9uIEluZGV4XShodHRwczovL3NlZGFjLmNpZXNpbi5jb2x1bWJpYS5lZHUvZGF0YS9zZXQvcG92bWFwLWdyZGktdjEpLlxuLSAqKltMZXMgZG9ubsOpZXMgc3VyIGwnw6lkdWNhdGlvbl0oaHR0cHM6Ly9yYWRpYW50ZWFydGguZ2l0aHViLmlvL3N0YWMtYnJvd3Nlci8jL2V4dGVybmFsL2RpZ2l0YWwtYXRsYXMuczMuYW1hem9uYXdzLmNvbS9zdGFjL3B1YmxpY19zdGFjL2FkYXB0aXZlLWNhcGFjaXR5L2VkdWNhdGlvbl9jYXRhbG9nL2NhdGFsb2cuanNvbikqKiBwb3VyIGxlIGRlbmRyb2dyYW1tZSBzb250IGxlIG5pdmVhdSBkJ8OpZHVjYXRpb24gbW95ZW4gZGVzIGhvbW1lcyBldCBkZXMgZmVtbWVzIHNlbG9uIGxlcyBbZXN0aW1hdGlvbnMgZGUgbCdJSE1FIDIwMDUtMjAxNSBwb3VyIGxlcyAxNS00OSBhbnNdKGh0dHBzOi8vZ2hkeC5oZWFsdGhkYXRhLm9yZy9yZWNvcmQvaWhtZS1kYXRhL2FmcmljYS1lZHVjYXRpb25hbC1hdHRhaW5tZW50LWdlb3NwYXRpYWwtZXN0aW1hdGVzLTIwMDAtMjAxNSkuIExlIHRhdXggZCfDqWR1Y2F0aW9uIGNvbWJpbmUgbGUgbml2ZWF1IGQnw6lkdWNhdGlvbiBldCBsZSBub21icmUgZCdhbm7DqWVzIGRlIHNjb2xhcmlzYXRpb24gcHLDqXZ1ZXMgZGFucyBbdW4gaW5kaWNlIGNvbXBvc2l0ZSBkYW5zIGxlIGNhZHJlIGRlIGwnSURIIHNvdXMtbmF0aW9uYWwuXShodHRwczovL2dsb2JhbGRhdGFsYWIub3JnL3NoZGkvbWV0YWRhdGEvZWRpbmRleC8pLlxuLSAqKltMJ2F1dG9ub21pc2F0aW9uIGRlcyBmZW1tZXNdKGh0dHBzOi8vcmFkaWFudGVhcnRoLmdpdGh1Yi5pby9zdGFjLWJyb3dzZXIvIy9leHRlcm5hbC9kaWdpdGFsLWF0bGFzLnMzLmFtYXpvbmF3cy5jb20vc3RhYy9wdWJsaWNfc3RhYy9hZGFwdGl2ZS1jYXBhY2l0eS93b21lbi1hbmQtZ2VuZGVyL2ZlbWFsZS1lbXBvd2VybWVudC9HZW5kZXJFcXVpdHlfMTk5NS0yMDE1L0dlbmRlckVxdWl0eV8xOTk1LTIwMTUuanNvbikqKiBlc3QgdW4gaW5kaWNlIGNvbXBvc2l0ZSBkZSBsYSB2aW9sZW5jZSBkb21lc3RpcXVlLCBkZSBsJ2VtcGxvaSwgZGVzIHNvaW5zIGRlIHNhbnTDqSByZXByb2R1Y3RpdmUsIGR1IHBvdXZvaXIgZGUgZMOpY2lzaW9uIGV0IGRlIGxhIHBsYW5pZmljYXRpb24gZmFtaWxpYWxlLiBMJ2luZGljZSBlc3QgdGlyw6kgZGUgW1JldHRpZywgRXJpY2EgKDIwMjIpXShodHRwczovL2RhdGF2ZXJzZS5oYXJ2YXJkLmVkdS9kYXRhc2V0LnhodG1sP3BlcnNpc3RlbnRJZD1kb2k6MTAuNzkxMC9EVk4vOEdKS1lXKSBldCBiYXPDqSBzdXIgbGVzIGRvbm7DqWVzIGR1IFtwcm9ncmFtbWUgREhTXShodHRwczovL2Roc3Byb2dyYW0uY29tKS5cblxuIyMjIETDqWxpbWl0YXRpb25zXG5MZXMgW3pvbmVzIGFkbWluaXN0cmF0aXZlc10oaHR0cHM6Ly9yYWRpYW50ZWFydGguZ2l0aHViLmlvL3N0YWMtYnJvd3Nlci8jL2V4dGVybmFsL2RpZ2l0YWwtYXRsYXMuczMuYW1hem9uYXdzLmNvbS9zdGFjL3B1YmxpY19zdGFjL2JvdW5kYXJ5X2NhdGFsb2cvZ2VvQm91bmRhcmllc19TU0EvY29sbGVjdGlvbi5qc29uKSB1dGlsaXPDqWVzIGRhbnMgY2Ugbm90ZWJvb2sgcHJvdmllbm5lbnQgZGUgW2dlb0JvdW5kYXJpZXMgNi4wLjBdKGh0dHBzOi8vZ2l0aHViLmNvbS93bWdlb2xhYi9nZW9Cb3VuZGFyaWVzKS4gTGVzIGZyb250acOocmVzIGdiSHVtYW5pdGFyaWFuIHNvbnQgdXRpbGlzw6llcyBldCwgc2kgZWxsZXMgbmUgc29udCBwYXMgZGlzcG9uaWJsZXMsIGxlcyBmcm9udGnDqHJlcyBnYk9wZW4gc29udCBzdWJzdGl0dcOpZXMuXG5cbiMjIyBSaXNxdWVzICYgRGFuZ2VycyBDbGltYXRpcXVlc1xuTGVzIFtyaXNxdWVzIGNsaW1hdGlxdWVzXShodHRwczovL3JhZGlhbnRlYXJ0aC5naXRodWIuaW8vc3RhYy1icm93c2VyLyMvZXh0ZXJuYWwvZGlnaXRhbC1hdGxhcy5zMy5hbWF6b25hd3MuY29tL3N0YWMvcHVibGljX3N0YWMvaGF6YXJkX2NhdGFsb2cvY2F0YWxvZy5qc29uKSBvbnQgw6l0w6kgY2FsY3Vsw6lzIMOgIGwnYWlkZSBkZSBjaW5xIGVuc2VtYmxlcyBkZSBkb25uw6llczogW0NISVJQU10oaHR0cHM6Ly93d3cuY2hjLnVjc2IuZWR1L2RhdGEvY2hpcnBzKS9bQ0hJUlRTXShodHRwczovL3d3dy5jaGMudWNzYi5lZHUvZGF0YS9jaGlydHNkYWlseSksIFtBZ0VSQTVdKGh0dHBzOi8vZG9pLm9yZy8xMC4yNDM4MS9jZHMuNmM2OGM5YmIpLCBbcHJvamVjdGlvbnMgQ01JUDZdKGh0dHBzOi8vZ2l0aHViLmNvbS9TYW50YW5kZXJNZXRHcm91cC9BVExBUyksIGV0IFtjYWxlbmRyaWVycyBkZXMgY3VsdHVyZXNdKGh0dHBzOi8vemVub2RvLm9yZy9yZWNvcmRzLzUwNjI1MTMpLiDDgCBsJ2FpZGUgZGVzIGZsdXggZGUgdHJhdmFpbCBSIG1lbnRpb25uw6lzIGNpLWRlc3NvdXMsIGxlcyBkb25uw6llcyBicnV0ZXMgc3VyIGxlcyBhbMOpYXMgb250IMOpdMOpIGNvbnZlcnRpZXMgZW4gcmlzcXVlcywgcmVjb3Vww6llcyBhdmVjIGwnZXhwb3NpdGlvbiBldCBleHRyYWl0ZXMgcGFyIGxlcyBsaW1pdGVzIGFkbWluaXN0cmF0aXZlcyBwb3VyIGfDqW7DqXJlciBkZXMgZG9ubsOpZXMgdGFidWxhaXJlcyBzb3VzIGZvcm1lIGRlIHBhcnF1ZXQsIHBhciBleGVtcGxlIFtzZXZlcmVfYWRtX2ludC5wYXJxdWV0XShodHRwczovL3JhZGlhbnRlYXJ0aC5naXRodWIuaW8vc3RhYy1icm93c2VyLyMvZXh0ZXJuYWwvZGlnaXRhbC1hdGxhcy5zMy5hbWF6b25hd3MuY29tL3N0YWMvcHVibGljX3N0YWMvaGF6YXJkX2NhdGFsb2cvaGF6YXJkX3Jpc2tfdm9wX2FubnVhbC9hbm51YWxfZGlnaXRhbC1hdGxhcy9oYXphcmRzL2hhemFyZF9yaXNrX3ZvcC9hbm51YWwvc2V2ZXJlX2FkbV9pbnQucGFycXVldC9hbm51YWxfZGlnaXRhbC1hdGxhcy9oYXphcmRzL2hhemFyZF9yaXNrX3ZvcC9hbm51YWwvc2V2ZXJlX2FkbV9pbnQucGFycXVldC5qc29uKS5gXG4gICAgICAgIH1cbiAgICAgIH0sXG4gICAgICBzZWN0aW9uMjoge1xuICAgICAgICBlbjogXCJNZXRob2RzXCIsXG4gICAgICAgIGZyOiBcIk3DqXRob2RvbG9naWVcIixcbiAgICAgICAgc3Vic2VjdGlvbnM6IHtcbiAgICAgICAgICBlbjogYCMjIyBDbGltYXRlIEhhemFyZCBSaXNrXG5cbkEgZGV0YWlsZWQgYW5kIHJlcGxpY2FibGUgUiB3b3JrZmxvdyBmb3IgZ2VuZXJhdGluZyByYXcgY2xpbWF0ZSBoYXphcmRzIGRhdGEgaXMgYXZhaWxhYmxlIGF0IHRoZSBbQWRhcHRhdGlvbkF0bGFzL0hhemFyZHNdKGh0dHBzOi8vZ2l0aHViLmNvbS9BZGFwdGF0aW9uQXRsYXMvaGF6YXJkcykuXG5cblRoZSB0cmFuc2Zvcm1hdGlvbiBvZiByYXcgY2xpbWF0ZSBoYXphcmRzIGludG8gZ2VuZXJpYyBhbmQgY3JvcC1zcGVjaWZpYyBoYXphcmQgcmlza3Mgd2FzIGFjaGlldmVkIHVzaW5nIGEgc2VwYXJhdGUsIGJ1dCBlcXVhbGx5IHJlcGxpY2FibGUsIFIgd29ya2Zsb3csIHdoaWNoIGNhbiBiZSBmb3VuZCBpbiB0aGUgR2l0SHViIHByb2plY3QgW2F0bGFzL2hhemFyZHNfcHJvdG90eXBlXShodHRwczovL2dpdGh1Yi5jb20vQWRhcHRhdGlvbkF0bGFzL2hhemFyZHNfcHJvdG90eXBlKS4gXG5cblRoZSBwcm9jZXNzIGZvciBjYWxjdWxhdGluZyByaXNrIGNvbXByaXNlcyBzZXZlcmFsIGNyaXRpY2FsIHN0ZXBzOlxuXG4xLiAqKkFubnVhbCBvciBTZWFzb25hbCBTdW1tYXJpemF0aW9uKio6IFJhdyBoYXphcmQgZGF0YSBpcyBhbGlnbmVkIHdpdGggdGhlIFtHR0NNSSBQaGFzZSAzIGNyb3AgY2FsZW5kYXIgZm9yIG1haXplXShodHRwczovL3plbm9kby5vcmcvcmVjb3Jkcy81MDYyNTEzKSwgdGhlbiBjbGltYXRlIGhhemFyZHMgYXJlIHN1bW1hcml6ZWQgYXQgZWl0aGVyIGFubnVhbCBvciBzZWFzb25hbCB0aW1lc2NhbGVzLiBGdXR1cmUgdXBkYXRlcyBvZiB0aGUgQXRsYXMgd2lsbCBpbmNvcnBvcmF0ZSBjcm9wLXNwZWNpZmljIGNhbGVuZGFycy5cblxuMi4gKipPY2N1cnJlbmNlKio6IEZvciBlYWNoIHNlYXNvbiBvciB5ZWFyIGluIGEgdGltZSBzZXJpZXMsIHdlIGNsYXNzaWZ5IHRoZSByaXNrIG9mIGhhemFyZCBvY2N1cnJlbmNlIChwcmVzZW50L2Fic2VudCkgYWNyb3NzIHRocmVlIHNldmVyaXR5IGxldmVscyAobW9kZXJhdGUsIHNldmVyZSwgZXh0cmVtZSkuIE5vdGUsIGhhemFyZCBzZXZlcml0eSBpcyBmaXhlZCB0byDigJxzZXZlcmXigJ0gaW4gdGhpcyBub3RlYm9vay5cbiAgIFxuICBUaGUgc3BlY2lmaWMgaGF6YXJkcyB1c2VkIGluIHRoaXMgYW5hbHlzaXMgYXJlOiBcbiAgXG4gIC0gKipEcnkqKiA9IG51bWJlciBvZiBzb2lsIHdhdGVyIHN0cmVzcyBkYXlzIFtORFdTXShodHRwczovL2dpdGh1Yi5jb20vQWRhcHRhdGlvbkF0bGFzL2hhemFyZHMvd2lraS9IYXphcmRzLWRlZmluaXRpb25zKS4gU2V2ZXJlIHJpc2sgPSBORFdTID4gMjAgZGF5cyAoc2FtZSBhY3Jvc3MgYWxsIGNyb3BzIGFuZCBsaXZlc3RvY2spLlxuICAtICoqSGVhdCAoY3JvcHMpKiogPSBkYXlzIHdoZXJlIG1heGltdW0gdGVtcGVyYXR1cmUgPiAzNcK6QyBbTlR4MzVdKGh0dHBzOi8vZ2l0aHViLmNvbS9BZGFwdGF0aW9uQXRsYXMvaGF6YXJkcy93aWtpL0hhemFyZHMtZGVmaW5pdGlvbnMpLiBTZXZlcmUgcmlzayA9IE5UeDM1ID4gMjAgZGF5cyAoc2FtZSBhY3Jvc3MgYWxsIGNyb3BzKS5cbiAgLSAqKkhlYXQgKGxpdmVzdG9jaykqKiA9IHRoZXJtYWwgaHVtaWRpdHkgaW5kZXggW1RISV0oaHR0cHM6Ly9naXRodWIuY29tL0FkYXB0YXRpb25BdGxhcy9oYXphcmRzL3dpa2kvSGF6YXJkcy1kZWZpbml0aW9ucykuIFNldmVyZSByaXNrIGlzIGxpdmVzdG9jayBjbGFzcyBzcGVjaWZpYywgc2VlIFRhYmxlIDIgb2YgW1Rob3J0b24gZXQgYWwuIDIwMjFdKGh0dHBzOi8vZG9pLm9yZy8xMC4xMTExL2djYi4xNTgyNSkuXG4gIC0gKipXZXQqKiA9IG51bWJlciBvZiB3YXRlcmxvZ2dpbmcgZGF5cyBbTkRXTDBdKGh0dHBzOi8vZ2l0aHViLmNvbS9BZGFwdGF0aW9uQXRsYXMvaGF6YXJkcy93aWtpL0hhemFyZHMtZGVmaW5pdGlvbnMpLiAgU2V2ZXJlIHJpc2sgPSBORFdMMCA+IDUgZGF5cyAoc2FtZSBhY3Jvc3MgYWxsIGNyb3BzIGFuZCBsaXZlc3RvY2spLlxuICAgIFxuICBNb3JlIGRldGFpbHMgb24gaGF6YXJkIGRlZmluaXRpb25zIGFuZCB0aHJlc2hvbGRzIGZvciBzZXZlcml0eSBjbGFzc2VzIGNhbiBmb3VuZCBpbiB0aGUgYXRsYXMvaGF6YXJkcyB3aWtpLiBGdXR1cmUgMjAyNCB1cGRhdGVzIG9mIHRoZSBBdGxhcyB3aWxsIGFkZCBjcm9wIHNwZWNpZmljIG1heGltdW0gdGVtcGVyYXR1cmUgdGhyZXNob2xkcyBhbmQgYSBub3RlYm9vayB3aWxsIGJlIGNyZWF0ZWQgdG8gYWxsb3cgdXNlcnMgdG8gZXhwbG9yZSBoYXphcmQgcmlza3MgaW4gbW9yZSBkZXRhaWwuXG5cbjMuICoqUmlzayoqOiBXZSBhdmVyYWdlIHRoZSBjbGFzc2lmaWVkIGhhemFyZHMgb3ZlciB0aGUgeWVhcnMgb3Igc2Vhc29ucyBlbmNvbXBhc3NlZCBieSB0aGUgdGltZS1zZXJpZXMgdG8gb2J0YWluIGFuIGVzdGltYXRpb24gb2Ygb2NjdXJyZW5jZSByaXNrLiBcblxuNC4gKipDb21wb3VuZCBSaXNrcyoqOiBUbyBhc3Nlc3MgdGhlIHJpc2sgb2YgY29tcG91bmQgaGF6YXJkcywgd2UgbXVsdGlwbHkgdGhlIHJpc2tzIGFzc29jaWF0ZWQgd2l0aCBkcnksIGhlYXQsIGFuZCB3ZXQgY29uZGl0aW9ucy4gVGhpcyBtdWx0aXBsaWNhdGlvbiBoaWdobGlnaHRzIGFyZWFzIHdoZXJlIG11bHRpcGxlIGhhemFyZHMgbWF5IGNvaW5jaWRlLCBwb3NpbmcgZ3JlYXRlciByaXNrIHRvIGFncmljdWx0dXJhbCBvdXRwdXRzLlxuXG41LiAqKkludGVncmF0aW9uIHdpdGggRWNvbm9taWMgRGF0YSoqOiBGaW5hbGx5LCB3ZSBtdWx0aXBseSB0aGUgY29tcG91bmQgY3JvcCBoYXphcmQgcmlzayBkYXRhIHdpdGggY3JvcCB2YWx1ZSBvZiBwcm9kdWN0aW9uIGRhdGEuIEZvciBleGFtcGxlLCBpZiBhIGNyb3AgaXMgZXhwb3NlZCB0byBhIGhhemFyZCBpbiA1MCUgb2YgZ3Jvd2luZyBzZWFzb25zIGFuZCB0aGUgdmFsdWUgb2YgcHJvZHVjdGlvbiBpcyAkMk0veWVhciB0aGVuLCBvbiBhdmVyYWdlLCAkMU0gb2YgcHJvZHVjdGlvbiBpcyBleHBvc2VkIHRvIHRoZSBoYXphcmQuICBUaGUgZXhwb3NlZCB2YWx1ZSBvZiBwcm9kdWN0aW9uIGlzIHRoZW4gZXh0cmFjdGVkIGJ5IGFkbWluaXN0cmF0aXZlIGFyZWFzIHRvIGluZGljYXRlIHBvdGVudGlhbCBlY29ub21pYyBpbXBhY3RzIG9uIGNyb3AgcHJvZHVjdGlvbi5cblxuIyMjIEFkYXB0aXZlIENhcGFjaXR5XG5UbyBjYWxjdWxhdGUgdGhlIHBvcHVsYXRpb24gZGlzdHJpYnV0aW9uIGFjY29yZGluZyB0byBhZGFwdGl2ZSBjYXBhY2l0eSB2YXJpYWJsZXMsIHdlIGZvbGxvd2VkIHRoZXNlIHN0ZXBzOlxuXG4xLiAqKkRhdGEgQ2xhc3NpZmljYXRpb24qKjogV2UgY2F0ZWdvcml6ZWQgdGhlIHZhcmlhYmxlc+KAlHBvdmVydHkgcmF0ZXMsIEZlbWFsZSBFbXBvd2VybWVudCBJbmRleCwgYW5kIGVkdWNhdGlvbmFsIGF0dGFpbm1lbnTigJRpbnRvIHRocmVlIGNsYXNzZXMgZWFjaC4gVGhlIGNsYXNzaWZpY2F0aW9uIG9mIHRoZSBGZW1hbGUgRW1wb3dlcm1lbnQgSW5kZXggYW5kIHBvdmVydHkgd2FzIGJhc2VkIG9uIHRoZSB0ZXJ0aWxlIGRpc3RyaWJ1dGlvbiBvZiB0aGUgZGF0YXNldC4gRm9yIGVkdWNhdGlvbmFsIGF0dGFpbm1lbnQsIHdlIGdyb3VwZWQgdGhlIGRhdGEgaW50byB0aHJlZSBjYXRlZ29yaWVzOiAwLTEgeWVhcnMgb2YgZWR1Y2F0aW9uLCAxLTUgeWVhcnMgb2YgZWR1Y2F0aW9uLCBhbmQgb3ZlciA1IHllYXJzIG9mIGVkdWNhdGlvbi5cblxuMi4gKipTcGF0aWFsIEludGVyc2VjdGlvbioqOiBOZXh0LCB3ZSBzcGF0aWFsbHkgb3ZlcmxhaWQgdGhlc2UgY2xhc3NpZmllZCB2YXJpYWJsZXMgd2l0aCBwb3B1bGF0aW9uIGRhdGEuIFRoaXMgc3RlcCBpZGVudGlmaWVkIHRoZSBzcGVjaWZpYyBjb21iaW5hdGlvbiBvZiB2YXJpYWJsZSBjbGFzc2VzIGZvciBlYWNoIHBvcHVsYXRpb24gc2VnbWVudC5cblxuMy4gKipTcGF0aWFsIEV4dHJhY3Rpb24qKjogV2UgdGhlbiBleHRyYWN0ZWQgdGhpcyBvdmVybGFpZCBkYXRhIGJ5IGFkbWluaXN0cmF0aXZlIGJvdW5kYXJpZXMuIFRoaXMgYWxsb3dlZCB1cyB0byBxdWFudGlmeSB0aGUgcG9wdWxhdGlvbiB3aXRoaW4gZWFjaCBhcmVhLCBmYWxsaW5nIGludG8gZWFjaCBhZGFwdGl2ZSBjYXBhY2l0eSBjYXRlZ29yeS5cblxuVGhyb3VnaCB0aGlzIG1ldGhvZG9sb2d5LCB3ZSBnZW5lcmF0ZWQgYSBjb21wcmVoZW5zaXZlIGRhdGFzZXQgaWxsdXN0cmF0aW5nIHRoZSBkaXN0cmlidXRpb24gb2YgdGhlIHBvcHVsYXRpb24gYnkgdGhlIHRocmVlIGVsZW1lbnRzLCBlbmNvbXBhc3NpbmcgZXZlcnkgY29tYmluYXRpb24gd2l0aGluIGVhY2ggYWRtaW5pc3RyYXRpdmUgcmVnaW9uLmAsXG5cbiAgICAgICAgICBmcjogYCMjIyBSaXNxdWVzIENsaW1hdGlxdWVzXG5cblVuIGZsdXggZGUgdHJhdmFpbCBSIGTDqXRhaWxsw6kgZXQgcmVwcm9kdWN0aWJsZSBwb3VyIGfDqW7DqXJlciBkZXMgZG9ubsOpZXMgYnJ1dGVzIHN1ciBsZXMgYWzDqWFzIGNsaW1hdGlxdWVzIGVzdCBkaXNwb25pYmxlIHN1ciBbQWRhcHRhdGlvbkF0bGFzL0hhemFyZHNdKGh0dHBzOi8vZ2l0aHViLmNvbS9BZGFwdGF0aW9uQXRsYXMvaGF6YXJkcykuXG5cbkxhIHRyYW5zZm9ybWF0aW9uIGRlcyBhbMOpYXMgY2xpbWF0aXF1ZXMgYnJ1dHMgZW4gcmlzcXVlcyBnw6luw6lyaXF1ZXMgZXQgc3DDqWNpZmlxdWVzIGF1eCBjdWx0dXJlcyBhIMOpdMOpIHLDqWFsaXPDqWUgw6AgbCdhaWRlIGQndW4gZmx1eCBkZSB0cmF2YWlsIFIgZGlzdGluY3QsIG1haXMgw6lnYWxlbWVudCByZXByb2R1Y3RpYmxlLCBxdWkgcGV1dCDDqnRyZSB0cm91dsOpIGRhbnMgbGUgcHJvamV0IEdpdEh1YiBbYXRsYXMvaGF6YXJkc19wcm90b3R5cGVdKGh0dHBzOi8vZ2l0aHViLmNvbS9BZGFwdGF0aW9uQXRsYXMvaGF6YXJkc19wcm90b3R5cGUpLiBcblxuTGUgcHJvY2Vzc3VzIGRlIGNhbGN1bCBkZXMgcmlzcXVlcyBjb21wcmVuZCBwbHVzaWV1cnMgw6l0YXBlcyBjcml0aXF1ZXM6XG5cbjEuICoqU3ludGjDqHNlIGFubnVlbGxlIG91IHNhaXNvbm5pw6hyZSoqOiBMZXMgZG9ubsOpZXMgYnJ1dGVzIHN1ciBsZXMgcmlzcXVlcyBzb250IGFsaWduw6llcyBzdXIgbGUgW2NhbGVuZHJpZXIgZGVzIGN1bHR1cmVzIGRlIGxhIHBoYXNlIDMgZGUgR0dDTUkgcG91ciBsZSBtYcOvc10oaHR0cHM6Ly96ZW5vZG8ub3JnL3JlY29yZHMvNTA2MjUxMyksIHB1aXMgbGVzIHJpc3F1ZXMgY2xpbWF0aXF1ZXMgc29udCByw6lzdW3DqXMgw6AgbCfDqWNoZWxsZSBhbm51ZWxsZSBvdSBzYWlzb25uacOocmUuIExlcyBmdXR1cmVzIG1pc2VzIMOgIGpvdXIgZGUgbCdhdGxhcyBpbnTDqWdyZXJvbnQgZGVzIGNhbGVuZHJpZXJzIHNww6ljaWZpcXVlcyBhdXggY3VsdHVyZXMuXG5cbjIuICoqT2NjdXJyZW5jZSoqOiBQb3VyIGNoYXF1ZSBzYWlzb24gb3UgYW5uw6llIGQndW5lIHPDqXJpZSB0ZW1wb3JlbGxlLCBub3VzIGNsYXNzb25zIGxlIHJpc3F1ZSBkJ29jY3VycmVuY2UgZGUgbCdhbMOpYSAocHLDqXNlbnQvYWJzZW50KSBzZWxvbiB0cm9pcyBuaXZlYXV4IGRlIGdyYXZpdMOpIChtb2TDqXLDqSwgZ3JhdmUsIGV4dHLDqm1lKS4gRGFucyBjZSAqbm90ZWJvb2sqLCBsYSBncmF2aXTDqSBkZXMgYWzDqWFzIGVzdCBmaXjDqWUgw6AgXCJncmF2ZVwiLlxuICAgXG4gIExlcyByaXNxdWVzIHNww6ljaWZpcXVlcyB1dGlsaXPDqXMgZGFucyBjZXR0ZSBhbmFseXNlIHNvbnQgbGVzIHN1aXZhbnRzOiBcbiAgXG4gIC0gKipTZWMqKiA9IG5vbWJyZSBkZSBqb3VycyBkZSBzdHJlc3MgaHlkcmlxdWUgZHUgc29sIFtORFdTXShodHRwczovL2dpdGh1Yi5jb20vQWRhcHRhdGlvbkF0bGFzL2hhemFyZHMvd2lraS9IYXphcmRzLWRlZmluaXRpb25zKS4gUmlzcXVlIGdyYXZlID0gTkRXUyA+IDIwIGpvdXJzIChpZGVudGlxdWUgcG91ciB0b3V0ZXMgbGVzIGN1bHR1cmVzIGV0IGxlIGLDqXRhaWwpLlxuICAtICoqQ2hhbGV1ciAoY3VsdHVyZXMpKiogPSBqb3VycyBvw7kgbGEgdGVtcMOpcmF0dXJlIG1heGltYWxlIGVzdCA+IDM1wrpDIFtOVHgzNV0oaHR0cHM6Ly9naXRodWIuY29tL0FkYXB0YXRpb25BdGxhcy9oYXphcmRzL3dpa2kvSGF6YXJkcy1kZWZpbml0aW9ucykuIFJpc3F1ZSBncmF2ZSA9IE5UeDM1ID4gMjAgam91cnMgKGlkZW50aXF1ZSBwb3VyIHRvdXRlcyBsZXMgY3VsdHVyZXMpLlxuICAtICoqQ2hhbGV1ciAoYsOpdGFpbCkqKiA9IGluZGljZSBkJ2h1bWlkaXTDqSB0aGVybWlxdWUgW1RISV0oaHR0cHM6Ly9naXRodWIuY29tL0FkYXB0YXRpb25BdGxhcy9oYXphcmRzL3dpa2kvSGF6YXJkcy1kZWZpbml0aW9ucykuIExlIHJpc3F1ZSBncmF2ZSBlc3Qgc3DDqWNpZmlxdWUgw6AgbGEgY2xhc3NlIGRlIGLDqXRhaWwsIHZvaXIgbGUgdGFibGVhdSAyIGRlIFtUaG9ydG9uIGV0IGFsLiAyMDIxXShodHRwczovL2RvaS5vcmcvMTAuMTExMS9nY2IuMTU4MjUpLlxuICAtICoqSHVtaWRpdMOpKiogPSBub21icmUgZGUgam91cnMgZCdlbmdvcmdlbWVudCBbTkRXTDBdKGh0dHBzOi8vZ2l0aHViLmNvbS9BZGFwdGF0aW9uQXRsYXMvaGF6YXJkcy93aWtpL0hhemFyZHMtZGVmaW5pdGlvbnMpLiAgUmlzcXVlIGdyYXZlID0gTkRXTDAgPiA1IGpvdXJzIChpZGVudGlxdWUgcG91ciB0b3V0ZXMgbGVzIGN1bHR1cmVzIGV0IGxlIGLDqXRhaWwpLlxuICAgIFxuICBQb3VyIHBsdXMgZGUgZMOpdGFpbHMgc3VyIGxlcyBkw6lmaW5pdGlvbnMgZGVzIHJpc3F1ZXMgZXQgbGVzIHNldWlscyBkZXMgY2xhc3NlcyBkZSBncmF2aXTDqSwgdm9pciBsZSB3aWtpIGF0bGFzL3Jpc3F1ZXMuIExlcyBmdXR1cmVzIG1pc2VzIMOgIGpvdXIgZGUgbCdhdGxhcyBlbiAyMDI0IGFqb3V0ZXJvbnQgZGVzIHNldWlscyBkZSB0ZW1ww6lyYXR1cmUgbWF4aW1hbGUgc3DDqWNpZmlxdWVzIGF1eCBjdWx0dXJlcyBldCB1biAqbm90ZWJvb2sqIHNlcmEgY3LDqcOpIHBvdXIgcGVybWV0dHJlIGF1eCB1dGlsaXNhdGV1cnMgZCdleHBsb3JlciBsZXMgcmlzcXVlcyBkZSBtYW5pw6hyZSBwbHVzIGTDqXRhaWxsw6llLlxuXG4zLiAqKlJpc3F1ZSoqOiBOb3VzIGZhaXNvbnMgbGEgbW95ZW5uZSBkZXMgYWzDqWFzIGNsYXNzw6lzIHN1ciBsZXMgYW5uw6llcyBvdSBsZXMgc2Fpc29ucyBjb25jZXJuw6llcyBwYXIgbGEgc8OpcmllIGNocm9ub2xvZ2lxdWUgYWZpbiBkJ29idGVuaXIgdW5lIGVzdGltYXRpb24gZHUgcmlzcXVlIGQnb2NjdXJyZW5jZS4gXG5cbjQuICoqUmlzcXVlcyBDb21wb3PDqXMqKjogUG91ciDDqXZhbHVlciBsZXMgcmlzcXVlcyBjb21wb3PDqXMsIG5vdXMgbXVsdGlwbGlvbnMgbGVzIHJpc3F1ZXMgYXNzb2Npw6lzIGF1eCBjb25kaXRpb25zIGRlIHPDqWNoZXJlc3NlLCBkZSBjaGFsZXVyIGV0IGQnaHVtaWRpdMOpLiBDZXR0ZSBtdWx0aXBsaWNhdGlvbiBtZXQgZW4gw6l2aWRlbmNlIGxlcyB6b25lcyBvw7kgZGVzIHJpc3F1ZXMgbXVsdGlwbGVzIHBldXZlbnQgY2/Dr25jaWRlciwgY2UgcXVpIHJlcHLDqXNlbnRlIHVuIHJpc3F1ZSBwbHVzIGltcG9ydGFudCBwb3VyIGxhIHByb2R1Y3Rpb24gYWdyaWNvbGUuXG5cbjUuICoqSW50w6lncmF0aW9uIGF2ZWMgbGVzIERvbm7DqWVzIMOJY29ub21pcXVlcyoqOiBFbmZpbiwgbm91cyBtdWx0aXBsaW9ucyBsZXMgZG9ubsOpZXMgc3VyIGxlcyByaXNxdWVzIGNvbXBvc8OpcyBwb3VyIGxlcyBjdWx0dXJlcyBwYXIgbGVzIGRvbm7DqWVzIHN1ciBsYSB2YWxldXIgZGUgbGEgcHJvZHVjdGlvbiBkZXMgY3VsdHVyZXMuIFBhciBleGVtcGxlLCBzaSB1bmUgY3VsdHVyZSBlc3QgZXhwb3PDqWUgw6AgdW4gZGFuZ2VyIHBlbmRhbnQgNTAgJSBkZXMgc2Fpc29ucyBkZSBjcm9pc3NhbmNlIGV0IHF1ZSBsYSB2YWxldXIgZGUgbGEgcHJvZHVjdGlvbiBlc3QgZGUgMiBtaWxsaW9ucyBkZSBkb2xsYXJzIHBhciBhbiwgYWxvcnMsIGVuIG1veWVubmUsIDEgbWlsbGlvbiBkZSBkb2xsYXJzIGRlIGxhIHByb2R1Y3Rpb24gZXN0IGV4cG9zw6llIGF1IGRhbmdlci4gTGEgdmFsZXVyIGRlIGxhIHByb2R1Y3Rpb24gZXhwb3PDqWUgZXN0IGVuc3VpdGUgZXh0cmFpdGUgcGFyIHpvbmUgYWRtaW5pc3RyYXRpdmUgcG91ciBpbmRpcXVlciBsZXMgaW1wYWN0cyDDqWNvbm9taXF1ZXMgcG90ZW50aWVscyBzdXIgbGEgcHJvZHVjdGlvbiBhZ3JpY29sZS5cblxuIyMjIENhcGFjaXTDqSBk4oCZQWRhcHRhdGlvblxuUG91ciBjYWxjdWxlciBsYSByw6lwYXJ0aXRpb24gZGUgbGEgcG9wdWxhdGlvbiBlbiBmb25jdGlvbiBkZXMgdmFyaWFibGVzIGRlIGxhIGNhcGFjaXTDqSBkJ2FkYXB0YXRpb24sIG5vdXMgYXZvbnMgc3VpdmkgbGVzIMOpdGFwZXMgc3VpdmFudGVzOlxuXG4xLiAqKkNsYXNzaWZpY2F0aW9uIGRlcyBEb25uw6llcyoqOiBOb3VzIGF2b25zIGNsYXNzw6kgbGVzIHZhcmlhYmxlcyAtIHRhdXggZGUgcGF1dnJldMOpLCBpbmRpY2UgZCdhdXRvbm9taXNhdGlvbiBkZXMgZmVtbWVzIGV0IG5pdmVhdSBkJ2luc3RydWN0aW9uIC0gZW4gdHJvaXMgY2xhc3NlcyBjaGFjdW5lLiBMYSBjbGFzc2lmaWNhdGlvbiBkZSBsJ2luZGljZSBkJ8OpbWFuY2lwYXRpb24gZGVzIGZlbW1lcyBldCBkZSBsYSBwYXV2cmV0w6kgw6l0YWl0IGJhc8OpZSBzdXIgbGEgZGlzdHJpYnV0aW9uIHBhciB0ZXJ0aWxlIGRlIGwnZW5zZW1ibGUgZGVzIGRvbm7DqWVzLiBQb3VyIGxlIG5pdmVhdSBkJ8OpZHVjYXRpb24sIG5vdXMgYXZvbnMgcmVncm91cMOpIGxlcyBkb25uw6llcyBlbiB0cm9pcyBjYXTDqWdvcmllcyA6IDAtMSBhbm7DqWUgZCfDqWR1Y2F0aW9uLCAxLTUgYW5uw6llcyBkJ8OpZHVjYXRpb24gZXQgcGx1cyBkZSA1IGFubsOpZXMgZCfDqWR1Y2F0aW9uLlxuXG4yLiAqKkludGVyc2VjdGlvbiBTcGF0aWFsZSoqOiBFbnN1aXRlLCBub3VzIGF2b25zIHN1cGVycG9zw6kgZGFucyBsJ2VzcGFjZSBjZXMgdmFyaWFibGVzIGNsYXNzw6llcyBhdmVjIGxlcyBkb25uw6llcyBkw6ltb2dyYXBoaXF1ZXMuIENldHRlIMOpdGFwZSBhIHBlcm1pcyBkJ2lkZW50aWZpZXIgbGEgY29tYmluYWlzb24gc3DDqWNpZmlxdWUgZGUgY2xhc3NlcyBkZSB2YXJpYWJsZXMgcG91ciBjaGFxdWUgc2VnbWVudCBkZSBwb3B1bGF0aW9uLlxuXG4zLiAqKkV4dHJhY3Rpb24gU3BhdGlhbGUqKjogTm91cyBhdm9ucyBlbnN1aXRlIGV4dHJhaXQgY2VzIGRvbm7DqWVzIHN1cGVycG9zw6llcyBlbiBmb25jdGlvbiBkZXMgbGltaXRlcyBhZG1pbmlzdHJhdGl2ZXMuIENlbGEgbm91cyBhIHBlcm1pcyBkZSBxdWFudGlmaWVyIGxhIHBvcHVsYXRpb24gZGFucyBjaGFxdWUgem9uZSwgdG9tYmFudCBkYW5zIGNoYXF1ZSBjYXTDqWdvcmllIGRlIGNhcGFjaXTDqSBkJ2FkYXB0YXRpb24uXG5cbkdyw6JjZSDDoCBjZXR0ZSBtw6l0aG9kb2xvZ2llLCBub3VzIGF2b25zIGfDqW7DqXLDqSB1biBlbnNlbWJsZSBkZSBkb25uw6llcyBjb21wbGV0IGlsbHVzdHJhbnQgbGEgcsOpcGFydGl0aW9uIGRlIGxhIHBvcHVsYXRpb24gZW4gZm9uY3Rpb24gZGVzIHRyb2lzIMOpbMOpbWVudHMsIGVuZ2xvYmFudCB0b3V0ZXMgbGVzIGNvbWJpbmFpc29ucyBhdSBzZWluIGRlIGNoYXF1ZSByw6lnaW9uIGFkbWluaXN0cmF0aXZlLmBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBkYXRhIHRyYW5zbGF0aW9uIHZhbHVlc1xudGQgPSB7XG4gIGxldCBkYXRhID0gYXdhaXQgRmlsZUF0dGFjaG1lbnQoXCJhYkF0bGFzLXRkLXRyYW5zbGF0aW9uLWRhdGEtdjMuanNvblwiKS5qc29uKClcblxuICAvLyAvLyB1cGRhdGUgU1NBIGRlZmF1bHRcbiAgLy8gZGF0YS5hZG1pbjBfbmFtZS52YWx1ZXMuU1NBLmVuID0gXCJTdWItU2FoYXJhbiBBZnJpY2FcIlxuICAvLyAvLyBjb3RlIGQnaXZvaXJlLCBjb21tYSB2ZXJzaW9uIGR1cGxpY2F0ZVxuICAvLyBkYXRhLmFkbWluMF9uYW1lLnZhbHVlc1tcIkPDtHRlIGTigJlJdm9pcmVcIl0gPSBkYXRhLmFkbWluMF9uYW1lLnZhbHVlc1tcIkPDtHRlIGQnSXZvaXJlXCJdXG4gIFxuICByZXR1cm4gZGF0YVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYC0tLVxuIyMjIE5vdGVib29rIFN0eWxpbmdcbipzdHlsaW5nIGhlbHBlcnMqXG5TdHlsZXNoZWV0IGlzIGEgbmFtZWQgY2VsbCwgd2hpY2ggaXMgbmVjZXNzYXJ5IHRvIGluY2x1ZGUgZm9yIGVtYmVkcy5gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYCoqQ29sb3IgU2NhbGVzKipgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGNvbG9yIHNjYWxlIGluZm9cbmNvbG9yU2NhbGVzID0ge1xuICByZXR1cm4ge1xuICAgIHJhbmdlOiB7XG4gICAgICBncmVlbjogWycjRTRGNUQwJywgJyMwMTUwMjMnXSxcbiAgICAgIGJsdWU6IFsnI0U4RjJGRicsICcjMDAzRTZCJ10sXG4gICAgICBicm93bjogWycjRkZGREU1JywgJyNBODdCMDAnXSxcbiAgICAgIHllbGxvd0dyZWVuOiBbJyNGN0Q3MzInLCAnIzIxNjcyOSddLFxuICAgICAgb3JhbmdlUmVkOiBbJyNGNEJCMjEnLCAnI0VDNUE0NyddLFxuICAgIH0sXG4gICAgdW5rbm93bjogXCIjY2NjXCJcbiAgfVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYC0tLVxuIyMjIEFkbWluIFNlbGVjdGlvblxuKkdsb2JhbCBhZG1pbiBzZWxlY3RvciB1c2luZyBkcm9wZG93bnMqXG5cblRoaXMgaXMgdGhlIGdsb2JhbCBzZWxlY3RvciBmb3IgdGhlIHNlbGVjdGVkIHJlZ2lvblxuLSBUaGUgY29tcGxldGVkIGRhdGEgaXMgY29udGFpbmVkIHdpdGhpbiBhZG1pblNlbGVjdGlvbnMgdG8gYmUgdXNlZCBpbiBxdWVyaWVzXG4tIERyb3Bkb3ducyBhcmUgZGVmaW5lZCBiZWxvdyB0aGVuIGJvdW5kIGZvciBlYWNoIHNlY3Rpb25cbiAgLSBEZWZpbmVkIGFzIHNlcGFyYXRlIGNlbGxzIHNpbmNlIHRoZXkgZHluYW1pY2FsbHkgcmVzcG9uZCB0byBkaWZmZXJlbnQgdmFsdWVzXG4gICAgLSBJbiBuYXJyYXRpdmUsIHRoZXkgYXJlIHNpbXBseSB2aWV3cyBvZiB0aGUgZGF0YSAgXG4gIC0gRHJvcGRvd25zIGFyZSBkeW5hbWljIGJhc2VkIG9uIGhpZ2hlci1sZXZlbCBjaG9pY2VzXG4gIC0gT3B0aW9ucyBhcmUgZGVmaW5lZCBmcm9tIHRoZSBnZW9ncmFwaGljIGRhdGFcbiAgLSBudWxsIHZhbHVlIG1lYW5zIHVuc2VsZWN0ZWQgcmVnaW9uXG4tIERyb3Bkb3ducyBhcmUgYWRkZWQgdG8gZWFjaCBzZWN0aW9uLCB1c2luZyBJbnB1dHMuYmluZCB0byBjcmVhdGUgc3luY2hyb25pemVkIGlucHV0cyAoc2VlIHZpZXdvZiBmb3IgaW5wdXQgZGVmaW5pdGlvbnMpLiBBIGZvcm0gaW5wdXQgaXMgdXNlZCB0byBjb25zb2xpZGF0ZSBhbmQgYXBwbHkgYSB0ZW1wbGF0ZSB0byBmb3JtYXQuYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBnZXQgYWRtaW4wIG9wdGlvbnMgZnJvbSBnZW9cbmRhdGFBZG1pbjAgPSB7XG4gIGNvbnN0IGRhdGEgPSBhZG1pbjAuZmVhdHVyZXMubWFwKChkKSA9PiBkLnByb3BlcnRpZXMpO1xuICAvLyBhZGQgYSBibGFuayB2YWx1ZVxuICByZXR1cm4gW251bGwsIC4uLmRhdGEubWFwKChkKSA9PiBkLmFkbWluX25hbWUpXS5tYXAoKGQpID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgbGFiZWw6XG4gICAgICAgIGQgPT0gbnVsbCA/IGdsb2JhbFNlbGVjdGlvbi5sYWJlbCA6IF9sYW5nKHRkLmFkbWluMF9uYW1lLnZhbHVlcz8uW2RdLmdlbmVyYWwpLFxuICAgICAgdmFsdWU6IGRcbiAgICB9O1xuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtNzYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBnZXQgYWRtaW4xIG9wdGlvbnMgYmFzZWQgb24gYWRtaW4wIHNlbGVjdGlvblxuLy8gKHRoZSBhZG1pbjEgcmVnaW9ucyB3aXRoaW4gc2VsZWN0ZWQgYWRtaW4wKVxuZGF0YUFkbWluMSA9IHtcbiAgLy8gYWRtaW4gMSwgZmlsdGVyIGJ5IDAgXG4gIC8vIGNvbnN0IGRhdGEgPSBib3VuZGFyaWVzLmFkbWluMS5mZWF0dXJlcy5tYXAoZCA9PiBkLnByb3BlcnRpZXMpXG4gIC8vIC5maWx0ZXIoZCA9PiBkLmFkbWluMF9uYW1lID09IHNlbGVjdEFkbWluMC52YWx1ZSlcbiAgY29uc3QgZGF0YSA9IGF3YWl0IGdlb19kYi5xdWVyeShgU0VMRUNUIERJU1RJTkNUIGFkbWluMV9uYW1lIEZST00gYWRtaW4xX2dlb20gV0hFUkUgYWRtaW4wX25hbWUgPSAnJHtzZWxlY3RBZG1pbjAudmFsdWV9J2ApXG4gIC8vIGFkZCBibGFuayB2YWx1ZVxuICBjb25zdCBhbGxMYWJlbCA9IHtcbiAgICBsYWJlbDogYWRtaW5SZWdpb25zLmFsbExhYmVscy5hZG1pbjEsXG4gICAgdmFsdWU6IG51bGxcbiAgfVxuICByZXR1cm4gW2FsbExhYmVsLCAuLi5kYXRhLm1hcChkID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgbGFiZWw6IGQuYWRtaW4xX25hbWUsXG4gICAgICB2YWx1ZTogZC5hZG1pbjFfbmFtZSxcbiAgICB9XG4gIH0pXS5tYXAoZCA9PiB7XG4gICAgcmV0dXJuIHtsYWJlbDogZC5sYWJlbCwgdmFsdWU6IGQudmFsdWV9XG4gIH0pXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTc3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZ2V0IGFkbWluMiBvcHRpb25zIGJhc2VkIG9uIGFkbWluMSBzZWxlY3Rpb25cbi8vICh0aGUgYWRtaW4yIHJlZ2lvbnMgd2l0aGluIHNlbGVjdGVkIGFkbWluMSlcbmRhdGFBZG1pbjIgPSB7XG4gIC8vIGNvbnN0IGRhdGEgPSBib3VuZGFyaWVzLmFkbWluMi5mZWF0dXJlcy5tYXAoZCA9PiBkLnByb3BlcnRpZXMpXG4gIC8vIC5maWx0ZXIoZCA9PiBkLmFkbWluMF9uYW1lID09IHNlbGVjdEFkbWluMC52YWx1ZSAmJiBkLmFkbWluMV9uYW1lID09IHNlbGVjdEFkbWluMS52YWx1ZSlcbiAgY29uc3QgZGF0YSA9IGF3YWl0IGdlb19kYi5xdWVyeShgU0VMRUNUIERJU1RJTkNUIGFkbWluMl9uYW1lIEZST00gYWRtaW4yX2dlb20gV0hFUkUgYWRtaW4wX25hbWUgPSAnJHtzZWxlY3RBZG1pbjAudmFsdWV9JyBBTkQgYWRtaW4xX25hbWUgPSAnJHtjbGVhbkFkbWluSW5wdXRfU1FMKHNlbGVjdEFkbWluMS52YWx1ZSl9J2ApXG4gIC8vIGFkZCBibGFuayB2YWx1ZVxuICBjb25zdCBhbGxMYWJlbCA9IHtcbiAgICBsYWJlbDogYWRtaW5SZWdpb25zLmFsbExhYmVscy5hZG1pbjIsXG4gICAgdmFsdWU6IG51bGxcbiAgfVxuICByZXR1cm4gW2FsbExhYmVsLCAuLi5kYXRhLm1hcChkID0+IHtcbiAgICByZXR1cm4ge1xuICAgICAgbGFiZWw6IGQuYWRtaW4yX25hbWUsXG4gICAgICB2YWx1ZTogZC5hZG1pbjJfbmFtZSxcbiAgICB9XG4gIH0pXS5tYXAoZCA9PiB7XG4gICAgcmV0dXJuIHtsYWJlbDogZC5sYWJlbCwgdmFsdWU6IGQudmFsdWV9XG4gIH0pXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTc4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidmlld29mIHNlbGVjdEFkbWluMCA9IElucHV0cy5zZWxlY3QoZGF0YUFkbWluMCwge2xhYmVsOiBhZG1pblJlZ2lvbnMubGFiZWxzLmFkbWluMCwgZm9ybWF0OiB4ID0+IHgubGFiZWx9KVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC03OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InZpZXdvZiBzZWxlY3RBZG1pbjEgPSBJbnB1dHMuc2VsZWN0KGRhdGFBZG1pbjEsIHtsYWJlbDogYWRtaW5SZWdpb25zLmxhYmVscy5hZG1pbjEsIGZvcm1hdDogeCA9PiB4LmxhYmVsfSlcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ2aWV3b2Ygc2VsZWN0QWRtaW4yID0gSW5wdXRzLnNlbGVjdChkYXRhQWRtaW4yLCB7bGFiZWw6IGFkbWluUmVnaW9ucy5sYWJlbHMuYWRtaW4yLCBmb3JtYXQ6IHggPT4geC5sYWJlbH0pXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTgxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gc2VsZWN0ZWQgYWRtaW4gcmVnaW9ucyBmcm9tIGRyb3Bkb3duc1xuYWRtaW5TZWxlY3Rpb25zID0gbmV3IE9iamVjdCh7XG4gIHNlbGVjdEFkbWluMDogc2VsZWN0QWRtaW4wLFxuICBzZWxlY3RBZG1pbjE6IHNlbGVjdEFkbWluMSxcbiAgc2VsZWN0QWRtaW4yOiBzZWxlY3RBZG1pbjIsXG59KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyB0ZW1wbGF0ZSB0byBmb3JtYXQgYWRtaW4gc2VsZWN0aW9uIGZvcm1cbmFkbWluRm9ybVRlbXBsYXRlID0gKGlucHV0cykgPT5cbiAgaHRsLmh0bWxgPGRpdiBzdHlsZT1cImRpc3BsYXk6IGZsZXg7IGdhcDogM2VtXCI+JHtpbnB1dHN9PC9kaXY+YDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtODMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJnZXRBZG1pblNlbGVjdGlvbkxhYmVsV2l0aFBhcmVuID0gKHtcbiAgc2VsZWN0aW9ucyA9IGFkbWluU2VsZWN0aW9ucyxcbiAgYWRtaW4wTGFiZWwsXG4gIGFkbWluU3VibGFiZWwsXG59ID0ge30pID0+IHtcbiAgLy8gcmV0dXJuIGFkbWluMCBzZWxlY3Rpb24gYW5kIGFkbWluMS9hZG1pbjIgc2VsZWN0aW9uIGlmIGNob3NlbiAoaW4gcGFyZW50aGVzZXMpXG4gIGlmIChzZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZSA9PT0gbnVsbCkge1xuICAgIHJldHVybiBhZG1pbjBMYWJlbDtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gYCR7YWRtaW4wTGFiZWx9ICgke2FkbWluU3VibGFiZWx9KWA7XG4gIH1cbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTg0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgQWRtaW4gU2VsZWN0aW9uIC0gRGlzcGxheVxuKlNob3dpbmcgYWRtaW4gc2VsZWN0aW9ucypgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIG9wdGlvbnMgZm9yIHRoZSBnbG9iYWwgYWRtaW4gc2VsZWN0aW9uXG4vLyB1c2VkIHdoZW4gbm8gYWRtaW4gc2VsZWN0aW9uIGlzIG1hZGVcbmdsb2JhbFNlbGVjdGlvbiA9IHtcbiAgcmV0dXJuIHtcbiAgICBsYWJlbDogX2xhbmcodGQuYWRtaW4wX25hbWUudmFsdWVzLlNTQS5nZW5lcmFsKSxcbiAgICB2YWx1ZTogbnVsbFxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTg2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gZ2V0QWRtaW5TZWxlY3Rpb24oc2VsZWN0aW9ucyA9IGFkbWluU2VsZWN0aW9ucykge1xuICAvLyBnZXQgdGhlIG1vc3QgZ3JhbnVsYXIgYWRtaW4gc2VsZWN0aW9uIG1hZGVcbiAgY29uc3QgYTAgPSBzZWxlY3Rpb25zLnNlbGVjdEFkbWluMDtcbiAgY29uc3QgYTEgPSBzZWxlY3Rpb25zLnNlbGVjdEFkbWluMTtcbiAgY29uc3QgYTIgPSBzZWxlY3Rpb25zLnNlbGVjdEFkbWluMjtcbiAgY29uc3QgZ2xvYmFsID0gZ2xvYmFsU2VsZWN0aW9uO1xuXG4gIHJldHVybiBhMi52YWx1ZSA/IGEyIDogYTEudmFsdWUgPyBhMSA6IGEwLnZhbHVlID8gYTAgOiBnbG9iYWw7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTg3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gZ2V0QWRtaW5TZWxlY3Rpb25BZG1pbjAoc2VsZWN0aW9ucyA9IGFkbWluU2VsZWN0aW9ucykge1xuICAvLyBnZXQgdGhlIHNlbGVjdGVkIGFkbWluMCBvciBnbG9iYWwgdmFsdWVcbiAgY29uc3QgYTAgPSBzZWxlY3Rpb25zLnNlbGVjdEFkbWluMDtcbiAgY29uc3QgZ2xvYmFsID0gZ2xvYmFsU2VsZWN0aW9uLmxhYmVsO1xuXG4gIHJldHVybiBhMCA/IGEwIDogZ2xvYmFsO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC04OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGdldEFkbWluU2VsZWN0aW9uTWFya2Rvd25QYXRoKHNlbGVjdGlvbnMgPSBhZG1pblNlbGVjdGlvbnMpIHtcbiAgLy8gZnVuY3Rpb24gdG8gc2hvdyBzZWxlY3RlZCBhZG1pbiByZWdpb25cbiAgLy8gcmV0dXJuIHBhdGggc2hvd2luZyBuZXN0ZWQgYWRtaW4gc2VsZWN0aW9uXG5cbiAgY29uc3QgZGVsaW0gPSBcIiDihpIgXCI7XG4gIGNvbnN0IHBhdGggPSBbXG4gICAgc2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAsXG4gICAgc2VsZWN0aW9ucy5zZWxlY3RBZG1pbjEsXG4gICAgc2VsZWN0aW9ucy5zZWxlY3RBZG1pbjIsXG4gIF0uZmlsdGVyKChkKSA9PiBkKTtcblxuICBjb25zdCBmb3JtYXR0ZWQgPSBwYXRoXG4gICAgLmZpbHRlcigoZCkgPT4gZClcbiAgICAubWFwKChkLCBpKSA9PiB7XG4gICAgICByZXR1cm4gaSA9PSBwYXRoLmxlbmd0aCAtIDEgPyBgKioke2R9KipgIDogYCoke2R9KmA7XG4gICAgfSk7XG5cbiAgcmV0dXJuIGZvcm1hdHRlZC5sZW5ndGggPT0gMFxuICAgID8gYCoqJHtnbG9iYWxTZWxlY3Rpb24ubGFiZWx9KipgIC8vIG5vIHNlbGVjdGlvbiwgYWxsIG9mIEFmcmljYVxuICAgIDogYCR7Zm9ybWF0dGVkLmpvaW4oZGVsaW0pfWA7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTg5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgQ2hvcm9wbGV0aCBtYXAgLSBHZW9ncmFwaGljIEltcGFjdFxuKlNob3dpbmcgY29udGV4dCBmb3IgYWRtaW4gc2VsZWN0aW9uKlxuXG5UaGVyZSBpcyBzb21lIGhvb3AtanVtcGluZyB0byBnZXQgdGhlIHJpZ2h0IGRhdGEgYmFzZWQgb24gdGhlIEFkbWluIFNlbGVjdGlvbi4gVGhlIHRhYnVsYXIgZGF0YSBpcyB0aGVuIGJvdW5kIHRvIHRoZSBhcHBsaWNhYmxlIGdlb2pzb24sIGFuZCB2aXN1YWxpemVkIHdpdGggUGxvdC5gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05MCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFQb3B1bGF0aW9uID0gYXN5bmMgKGFkbWluX3F1ZXJ5KSA9PiB7XG4gIHJldHVybiBhd2FpdCBkYi5xdWVyeShgXG5zZWxlY3QgKiBcbmZyb20gcG9wdWxhdGlvblxuJHthZG1pbl9xdWVyeX1cbmApO1xufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyAvLyB0b3RhbCBWb1AgZGF0YVxuZGF0YVRvdGFsVm9QID0gYXN5bmMgKGFkbWluX3F1ZXJ5KSA9PiB7XG4gIHJldHVybiBhd2FpdCBkYi5xdWVyeShgXG5zZWxlY3QgYWRtaW4wX25hbWVcbiAgLCBhZG1pbjFfbmFtZVxuICAsIGFkbWluMl9uYW1lXG4gICwgU1VNKHZhbHVlKSBhcyB2b3BfdG90YWxcbiAgZnJvbSB2b3BcbiAgJHthZG1pbl9xdWVyeX1cbiAgZ3JvdXAgYnkgYWRtaW4wX25hbWUsIGFkbWluMV9uYW1lLCBhZG1pbjJfbmFtZVxuICBvcmRlciBieSBhZG1pbjBfbmFtZSwgYWRtaW4xX25hbWUsIGFkbWluMl9uYW1lXG5gKTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZ3JhYiB0YWJ1bGFyIGRhdGEgZm9yIGNob3JvcGxldGhcbmRhdGFHZW9JbXBhY3QgPSB7XG4gbGV0IGFkbWluX3F1ZXJ5XG4gIGlmIChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlKSB7XG4gICAgYWRtaW5fcXVlcnkgPSBgV0hFUkUgYWRtaW4wX25hbWUgPSAnJHthZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlfScgQU5EIGFkbWluMV9uYW1lID0gJyR7Y2xlYW5BZG1pbklucHV0X1NRTChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlKX0nIEFORCBhZG1pbjJfbmFtZSBJUyBOT1QgTlVMTGBcbiAgfSBlbHNlIGlmIChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlKSB7XG4gICAgYWRtaW5fcXVlcnkgPSBgV0hFUkUgYWRtaW4wX25hbWUgPSAnJHthZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlfScgQU5EIGFkbWluMV9uYW1lIElTIE5PVCBOVUxMIEFORCBhZG1pbjJfbmFtZSBJUyBOVUxMYFxuICB9IGVsc2Uge1xuICAgIGFkbWluX3F1ZXJ5ID0gYFdIRVJFIGFkbWluMV9uYW1lIElTIE5VTExgXG4gIH1cbiAgLy8gZ2V0IGRhdGEgZm9yIGNob3JvcGxldGggbWFwIGJhc2VkIG9uIGNob2ljZVxuICBjb25zdCBkYXRhU291cmNlID0gc2VsZWN0R2VvRGF0YVR5cGUua2V5ID09IFwicG9wdWxhdGlvblwiXG4gICAgPyBhd2FpdCBkYXRhUG9wdWxhdGlvbihhZG1pbl9xdWVyeSlcbiAgICA6IGF3YWl0IGRhdGFUb3RhbFZvUChhZG1pbl9xdWVyeSlcbiAgcmV0dXJuIGRhdGFTb3VyY2UgXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTkzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gYmluZCBnZW9qc29uIHRvIHRhYnVsYXIgZGF0YVxubWFwRGF0YUdlb0ltcGFjdCA9IHtcbiAgLy8gbm8gc2VsZWN0aW9uc1xuICBpZiAoIWFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWUpIHtcbiAgICByZXR1cm4gYmluZFRhYnVsYXJUb0dlbyh7XG4gICAgICBkYXRhOiBkYXRhR2VvSW1wYWN0LFxuICAgICAgZGF0YUJpbmRDb2x1bW46IFwiYWRtaW4wX25hbWVcIixcbiAgICAgIGdlb0RhdGE6IGJvdW5kYXJpZXMuYWRtaW4wLFxuICAgICAgZ2VvRGF0YUJpbmRDb2x1bW46IFwiYWRtaW4wX25hbWVcIlxuICAgIH0pO1xuICB9XG4gIC8vIGFkbWluMCBzZWxlY3RlZCBvbmx5XG4gIGVsc2UgaWYgKCFhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlKSB7XG4gICAgY29uc3QgZGF0YSA9IFQudGlkeShcbiAgICAgIGRhdGFHZW9JbXBhY3QsXG4gICAgICBULm11dGF0ZSh7IGExX2EwOiAoZCkgPT4gW2QuYWRtaW4xX25hbWUsIGQuYWRtaW4wX25hbWVdLmpvaW4oXCJfXCIpIH0pXG4gICAgKTtcbiAgICBjb25zdCBnZW9EYXRhID0ge1xuICAgICAgLi4uYm91bmRhcmllcy5hZG1pbjEsXG4gICAgICBmZWF0dXJlczogYm91bmRhcmllcy5hZG1pbjEuZmVhdHVyZXMuZmlsdGVyKFxuICAgICAgICAoZCkgPT4gZC5wcm9wZXJ0aWVzLmFkbWluMF9uYW1lID09IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWVcbiAgICAgIClcbiAgICB9O1xuXG4gICAgcmV0dXJuIGJpbmRUYWJ1bGFyVG9HZW8oe1xuICAgICAgZGF0YTogZGF0YSxcbiAgICAgIGRhdGFCaW5kQ29sdW1uOiBcImExX2EwXCIsXG4gICAgICBnZW9EYXRhOiBnZW9EYXRhLFxuICAgICAgZ2VvRGF0YUJpbmRDb2x1bW46IFwiYTFfYTBcIlxuICAgIH0pO1xuICB9XG5cbiAgLy8gYWRtaW4xIGlzIHNlbGVjdGVkXG4gIC8vIHNob3cgYWxsIGFkbWluMiByZWdpb25zIHdpdGhpbiBhZG1pbjFcbiAgZWxzZSB7XG4gICAgY29uc3QgZGF0YSA9IFQudGlkeShcbiAgICAgIGRhdGFHZW9JbXBhY3QsXG4gICAgICBULm11dGF0ZSh7XG4gICAgICAgIGEyX2ExX2EwOiAoZCkgPT4gW2QuYWRtaW4yX25hbWUsIGQuYWRtaW4xX25hbWUsIGQuYWRtaW4wX25hbWVdLmpvaW4oXCJfXCIpXG4gICAgICB9KVxuICAgICk7XG4gICAgY29uc3QgZ2VvRGF0YSA9IHtcbiAgICAgIC4uLmJvdW5kYXJpZXMuYWRtaW4yLFxuICAgICAgZmVhdHVyZXM6IGJvdW5kYXJpZXMuYWRtaW4yLmZlYXR1cmVzLmZpbHRlcigoZCkgPT4ge1xuICAgICAgICByZXR1cm4gZC5wcm9wZXJ0aWVzLmFkbWluMV9uYW1lID09IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjEudmFsdWVcbiAgICAgICAgICAmJiBkLnByb3BlcnRpZXMuYWRtaW4wX25hbWUgPT0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZVxuICAgICAgfSlcbiAgICB9O1xuXG4gICAgcmV0dXJuIGJpbmRUYWJ1bGFyVG9HZW8oe1xuICAgICAgZGF0YTogZGF0YSxcbiAgICAgIGRhdGFCaW5kQ29sdW1uOiBcImEyX2ExX2EwXCIsXG4gICAgICBnZW9EYXRhOiBnZW9EYXRhLFxuICAgICAgZ2VvRGF0YUJpbmRDb2x1bW46IFwiYTJfYTFfYTBcIlxuICAgIH0pO1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTk0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgRHluYW1pYyBJbnNpZ2h0cyAtIEdlb2dyYXBoaWMgSW1wYWN0XG4qcXVpY2sgaW5zaWdodHMgZm9yIGdpdmVuIGFkbWluIHNlbGVjdGlvbipcblxuLSBTcWwgY2VsbHMgYWRkIGEgcm93IHRoYXQgaXMgdGhlIGNvbWJpbmVkIHZhbHVlIGZvciBhbGwgYWRtaW4gcmVnaW9ucywgd2hlcmUgYWxsIGFkbWluIG5hbWVzIGFyZSBudWxsLmA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTk1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgSGVyZSBhcmUgdGhlIGNvbWJpbmVkIGRhdGEgYW5kIGluc2lnaHRzIGZvciBjcmVhdGluZyB0aGUgZHluYW1pYyBuYXJyYXRpdmUuIERhdGEgdGFibGVzIGFyZSBiZWxvdy5gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGR5bmFtaWMgaW5zaWdodHMgZm9yIGFuIEFkbWluIFNlbGVjdGlvblxuZHluYW1pY0luc2lnaHRzX2dlb0ltcGFjdCA9IHtcbiAgbGV0IGFkbWluMl9udWxsID0gIXNlbGVjdEFkbWluMi52YWx1ZVxuICAvLyBkZWZpbmUgZGF0YVxuICBjb25zdCB0b3RhbFZvcCA9IGFkbWluMl9udWxsID8gZHluSW5zaWdodEdlb192b3BUb3RhbHMgOiBmaWx0ZXJCeUFkbWluTmFtZXMoZHluSW5zaWdodEdlb192b3BUb3RhbHMpO1xuICBjb25zdCB0b3RhbEhhID0gYWRtaW4yX251bGwgPyBkeW5JbnNpZ2h0R2VvX2hhVG90YWxzOiBmaWx0ZXJCeUFkbWluTmFtZXMoZHluSW5zaWdodEdlb19oYVRvdGFscyk7IFxuICBjb25zdCBwb3B1bGF0aW9uID0gYWRtaW4yX251bGwgPyBkeW5JbnNpZ2h0R2VvX3BvcHVsYXRpb24gOiBmaWx0ZXJCeUFkbWluTmFtZXMoZHluSW5zaWdodEdlb19wb3B1bGF0aW9uKTtcbiAgY29uc3QgdG9wQ29tbW9kaXRpZXMgPSBhZG1pbjJfbnVsbCA/IGR5bkluc2lnaHRHZW9fcmFua2VkTm9uQW5pbWFsczogZmlsdGVyQnlBZG1pbk5hbWVzKGR5bkluc2lnaHRHZW9fcmFua2VkTm9uQW5pbWFscyk7XG4gIGNvbnN0IHRvcExpdmVzdG9jayA9IGFkbWluMl9udWxsID8gZHluSW5zaWdodEdlb19yYW5rZWRBbmltYWxzIDogZmlsdGVyQnlBZG1pbk5hbWVzKGR5bkluc2lnaHRHZW9fcmFua2VkQW5pbWFscyk7XG5cbiAgLy8gZm9ybWF0IGZ1bmN0aW9uc1xuICBjb25zdCBsb2NhbGUgPSBsYW5ndWFnZS5sb2NhbGU7XG4gIGNvbnN0IF9mb3JtYXRUb3BOVm9wID0gZm9ybWF0SW50RG9sbGFyKHtsb2NhbGU6IGxvY2FsZX0pO1xuICBjb25zdCBfZm9ybWF0TnVtYmVyID0gZm9ybWF0TnVtQ29tcGFjdExvbmcoe2xvY2FsZTogbG9jYWxlfSk7XG5cbiAgZnVuY3Rpb24gZ2V0VG9wVmFsdWUoeyBkLCBpIH0gPSB7fSkge1xuICAgIHJldHVybiB7XG4gICAgICBkYXRhOiBkPy5baV0/LnZvcF90b3RhbCxcbiAgICAgIHZhbHVlOiBmb3JtYXRXaXRoRGVmYXVsdCh7XG4gICAgICAgIHZhbHVlOiBkPy5baV0/LnZvcF90b3RhbCxcbiAgICAgICAgZm9ybWF0OiBfZm9ybWF0VG9wTlZvcFxuICAgICAgfSksXG4gICAgICBsYWJlbDogZm9ybWF0V2l0aERlZmF1bHQoe1xuICAgICAgICB2YWx1ZTogZD8uW2ldPy5jcm9wXG4gICAgICB9KVxuICAgIH07XG4gIH1cblxuICAvLyBtYWtlIGluc2lnaHRzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICByZXR1cm4ge1xuICAgIGRhdGE6IHtcbiAgICAgIHRvdGFsVm9wLFxuICAgICAgdG90YWxIYSxcbiAgICAgIHBvcHVsYXRpb24sXG4gICAgICB0b3BDb21tb2RpdGllcyxcbiAgICAgIHRvcExpdmVzdG9ja1xuICAgIH0sXG4gICAgaW5zaWdodDoge1xuICAgICAgdG90YWxWb3A6IGZvcm1hdFdpdGhEZWZhdWx0KHtcbiAgICAgICAgdmFsdWU6IHRvdGFsVm9wPy5bMF0/LnZvcF90b3RhbCxcbiAgICAgICAgZm9ybWF0OiBfZm9ybWF0VG9wTlZvcFxuICAgICAgfSksXG4gICAgICB0b3RhbEhhOiBmb3JtYXRXaXRoRGVmYXVsdCh7XG4gICAgICAgIHZhbHVlOiB0b3RhbEhhPy5bMF0/LmhhX3RvdGFsLFxuICAgICAgICBmb3JtYXQ6IF9mb3JtYXROdW1iZXJcbiAgICAgIH0pLFxuICAgICAgdG90YWxQb3A6IGZvcm1hdFdpdGhEZWZhdWx0KHtcbiAgICAgICAgdmFsdWU6IHBvcHVsYXRpb24/LlswXT8ucnVyYWxfcG9wLFxuICAgICAgICBmb3JtYXQ6IF9mb3JtYXROdW1iZXJcbiAgICAgIH0pLFxuICAgICAgdG9wQ29tbW9kaXRpZXM6IFswLCAxLCAyXS5tYXAoKHgpID0+XG4gICAgICAgIGdldFRvcFZhbHVlKHsgZDogdG9wQ29tbW9kaXRpZXMsIGk6IHggfSlcbiAgICAgICksXG4gICAgICB0b3BMaXZlc3RvY2s6IFswLCAxLCAyXS5tYXAoKHgpID0+XG4gICAgICAgIGdldFRvcFZhbHVlKHsgZDogdG9wTGl2ZXN0b2NrLCBpOiB4IH0pXG4gICAgICApLFxuICAgIH1cbiAgfTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtOTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyMgRGF0YSBjZWxscyBmb3IgaW5zaWdodHNgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Imluc2lnaHRfYWRtaW5RdWVyeSA9IHtcbiAgbGV0IGFkbWluX3F1ZXJ5XG5pZiAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZSkge1xuICBhZG1pbl9xdWVyeSA9IGBXSEVSRSBhZG1pbjBfbmFtZSA9ICcke2FkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWV9JyBBTkQgYWRtaW4xX25hbWUgPSAnJHtjbGVhbkFkbWluSW5wdXRfU1FMKGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjEudmFsdWUpfScgQU5EIGFkbWluMl9uYW1lIElTIE5PVCBOVUxMYFxufSBlbHNlIGlmIChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlKSB7XG4gIGFkbWluX3F1ZXJ5ID0gYFdIRVJFIGFkbWluMF9uYW1lID0gJyR7YWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZX0nIEFORCBhZG1pbjFfbmFtZSBJUyBOT1QgTlVMTCBBTkQgYWRtaW4yX25hbWUgSVMgTlVMTGBcbn0gZWxzZSB7XG4gIGFkbWluX3F1ZXJ5ID0gYFdIRVJFIGFkbWluMV9uYW1lIElTIE5VTExgXG59XG4gIHJldHVybiBhZG1pbl9xdWVyeVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC05OSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHRvdGFsIGhhcnZlc3RlZCBhcmVhXG5keW5JbnNpZ2h0R2VvX2hhVG90YWxzID0ge1xuICBsZXQgYWRtaW5fcXVlcnkgPSBpbnNpZ2h0X2FkbWluUXVlcnlcbiAgXG4gIHJldHVybiBhd2FpdCBkYi5xdWVyeShgXG53aXRoIHRibEhBIGFzIChcbiAgLS0gdG90YWwgVm9QIGFuZCBoYXJ2ZXN0ZWQgYXJlYVxuICBTRUxFQ1QgYWRtaW4wX25hbWUsIGFkbWluMV9uYW1lLCBhZG1pbjJfbmFtZSwgU1VNKHZhbHVlKSBBUyBoYV90b3RhbFxuICAgIEZST00gaGFcbiAgICAke2FkbWluX3F1ZXJ5fVxuICAgIEFORCBleHBvc3VyZSA9ICdoYSdcbiAgICBHUk9VUCBCWSAxLCAyLCAzXG4pXG5cbi0tIFFVRVJZIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuKFxuICAtLSB0b3RhbCBmb3IgYWxsIHJlZ2lvbnNcbiAgc2VsZWN0IG51bGwgYXMgYWRtaW4wX25hbWVcbiAgICAsIG51bGwgYXMgYWRtaW4xX25hbWVcbiAgICAsIG51bGwgYXMgYWRtaW4yX25hbWVcbiAgICAsIGhhX3RvdGFsXG4gICAgZnJvbSAoXG4gICAgICBzZWxlY3Qgc3VtKGhhX3RvdGFsKSBhcyBoYV90b3RhbFxuICAgICAgICBmcm9tIHRibEhBXG4gICAgKVxuICBcbiAgdW5pb25cbiAgXG4gIHNlbGVjdCAqIFxuICAgIGZyb20gdGJsSEFcbiAgXG4gIG9yZGVyIGJ5IDEsIDIsIDNcbilcbmApXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImR5bkluc2lnaHRHZW9fdm9wVG90YWxzID0ge1xuICBsZXQgYWRtaW5fcXVlcnkgPSBpbnNpZ2h0X2FkbWluUXVlcnlcblxuICBcbiAgcmV0dXJuIGRiLnF1ZXJ5KGBcbi0tIHRvdGFsIHZhbHVlIG9mIHByb2R1Y3Rpb25cbndpdGggdGJsIGFzIChcbiAgLS0gdG90YWwgVm9QIGFuZCBoYXJ2ZXN0ZWQgYXJlYVxuICBTRUxFQ1QgYWRtaW4wX25hbWUsIGFkbWluMV9uYW1lLCBhZG1pbjJfbmFtZSwgU1VNKHZhbHVlKSBBUyB2b3BfdG90YWxcbiAgICBGUk9NIHZvcFxuICAgICR7YWRtaW5fcXVlcnl9XG4gICAgR1JPVVAgQlkgMSwgMiwgM1xuICAgIE9SREVSIEJZIDEsIDIsIDNcbilcblxuLS0gUVVFUlkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4oXG4gIC0tIHRvdGFsIGZvciBhbGwgcmVnaW9uc1xuICBzZWxlY3QgbnVsbCBhcyBhZG1pbjBfbmFtZVxuICAgICwgbnVsbCBhcyBhZG1pbjFfbmFtZVxuICAgICwgbnVsbCBhcyBhZG1pbjJfbmFtZVxuICAgICwgdm9wX3RvdGFsXG4gICAgZnJvbSAoXG4gICAgICBzZWxlY3Qgc3VtKHZvcF90b3RhbCkgYXMgdm9wX3RvdGFsXG4gICAgICAgIGZyb20gdGJsXG4gICAgKVxuICBcbiAgdW5pb25cbiAgXG4gIHNlbGVjdCAqIFxuICAgIGZyb20gdGJsXG4gIFxuICBvcmRlciBieSAxLCAyLCAzXG4pXG5gKVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDEiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkeW5JbnNpZ2h0R2VvX3BvcHVsYXRpb24gPSB7XG4gICAgICBsZXQgYWRtaW5fcXVlcnkgPSBpbnNpZ2h0X2FkbWluUXVlcnlcbnJldHVybiBhd2FpdCBkYi5xdWVyeShgXG53aXRoIHRibCBhcyAoXG4gIC0tIHBvcHVsYXRpb24gZGF0YVxuICBzZWxlY3QgYWRtaW4wX25hbWVcbiAgICAsIGFkbWluMV9uYW1lXG4gICAgLCBhZG1pbjJfbmFtZVxuICAgICwgdG90YWxfcG9wXG4gICAgLCBydXJhbF9wb3BcbiAgICBmcm9tIHBvcHVsYXRpb25cbiAgICAke2FkbWluX3F1ZXJ5fVxuICAgIG9yZGVyIGJ5IGFkbWluMF9uYW1lXG4gICAgLCBhZG1pbjFfbmFtZVxuICAgICwgYWRtaW4yX25hbWVcbilcblxuLS0gUVVFUlkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4oXG4gIC0tIHRvdGFsIGZvciBhbGwgcmVnaW9uc1xuICBzZWxlY3QgbnVsbCBhcyBhZG1pbjBfbmFtZVxuICAgICwgbnVsbCBhcyBhZG1pbjFfbmFtZVxuICAgICwgbnVsbCBhcyBhZG1pbjJfbmFtZVxuICAgICwgKlxuICAgIGZyb20gKFxuICAgICAgc2VsZWN0IHN1bSh0b3RhbF9wb3ApIGFzIHRvdGFsX3BvcFxuICAgICAgICAsIHN1bShydXJhbF9wb3ApIGFzIHJ1cmFsX3BvcFxuICAgICAgICBmcm9tIHRibFxuICAgIClcbiAgXG4gIHVuaW9uXG4gIFxuICBzZWxlY3QgKlxuICAgIGZyb20gdGJsXG4gIFxuICBvcmRlciBieSAxLCAyLCAzXG4pXG5gKVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkeW5JbnNpZ2h0R2VvX3JhbmtlZE5vbkFuaW1hbHMgPSB7XG5sZXQgYWRtaW5fcXVlcnkgPSBpbnNpZ2h0X2FkbWluUXVlcnlcblxuICBsZXQgZGF0YSA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgLS0gQ29tYmluZSBnbG9iYWwgdG90YWxzIHdpdGggcmVnaW9uYWwgZGF0YVxuICBXSVRIIHRibF92b3AgQVMgKFxuICAgIC0tIEZldGNoIHRoZSBiYXNlIGRhdGEgZm9yIE5PTi1hbmltYWxzXG4gICAgU0VMRUNUIGFkbWluMF9uYW1lLFxuICAgICAgICAgICBhZG1pbjFfbmFtZSxcbiAgICAgICAgICAgYWRtaW4yX25hbWUsXG4gICAgICAgICAgIGNyb3AsXG4gICAgICAgICAgIHZhbHVlIEFTIHZvcF90b3RhbFxuICAgIEZST00gdm9wX2Nyb3BcbiAgICAke2FkbWluX3F1ZXJ5fVxuICApLFxuICBcbiAgLS0gQ2FsY3VsYXRlIGdsb2JhbCB0b3RhbHMgKHdoZXJlIGFkbWluIG5hbWVzIGFyZSBudWxsKVxuICBnbG9iYWxfdG90YWxfY3JvcCBBUyAoXG4gICAgU0VMRUNUIE5VTEwgQVMgYWRtaW4wX25hbWUsXG4gICAgICAgICAgIE5VTEwgQVMgYWRtaW4xX25hbWUsXG4gICAgICAgICAgIE5VTEwgQVMgYWRtaW4yX25hbWUsXG4gICAgICAgICAgIGNyb3AsXG4gICAgICAgICAgIFNVTSh2b3BfdG90YWwpIEFTIHZvcF90b3RhbFxuICAgIEZST00gdGJsX3ZvcFxuICAgIEdST1VQIEJZIGNyb3BcbiAgKVxuICBcbiAgLS0gQ29tYmluZSBnbG9iYWwgdG90YWxzIHdpdGggcmVnaW9uYWwgZGF0YVxuICBTRUxFQ1QgKiBGUk9NIGdsb2JhbF90b3RhbF9jcm9wXG4gIFVOSU9OIEFMTFxuICBTRUxFQ1QgKiBGUk9NIHRibF92b3BcbiAgT1JERVIgQlkgYWRtaW4wX25hbWUsIGFkbWluMV9uYW1lLCBhZG1pbjJfbmFtZSwgdm9wX3RvdGFsIERFU0NcbmApXG4gIFxuICBjb25zdCBncm91cGVkRGF0YSA9IGRhdGEucmVkdWNlKChhY2MsIGl0ZW0pID0+IHtcbiAgY29uc3Qga2V5ID0gYCR7aXRlbS5hZG1pbjBfbmFtZX0tJHtpdGVtLmFkbWluMV9uYW1lfS0ke2l0ZW0uYWRtaW4yX25hbWV9YDtcbiAgaWYgKCFhY2Nba2V5XSkgYWNjW2tleV0gPSBbXTtcbiAgYWNjW2tleV0ucHVzaChpdGVtKTtcbiAgcmV0dXJuIGFjYztcbn0sIHt9KTtcblxuLy8gUmFuayB3aXRoaW4gZWFjaCBncm91cFxuY29uc3QgcmFua2VkRGF0YSA9IE9iamVjdC52YWx1ZXMoZ3JvdXBlZERhdGEpLmZsYXRNYXAoZ3JvdXAgPT4ge1xuICByZXR1cm4gZ3JvdXAuc29ydCgoYSwgYikgPT4gYi52b3BfdG90YWwgLSBhLnZvcF90b3RhbCkuc2xpY2UoMCwgMykubWFwKChpdGVtLCBpbmRleCkgPT4gKHtcbiAgICAuLi5pdGVtLFxuICAgIHJhbms6IGluZGV4ICsgMVxuICB9KSk7XG59KTtcbiAgcmV0dXJuIHJhbmtlZERhdGFcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTAzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZHluSW5zaWdodEdlb19yYW5rZWRBbmltYWxzID0ge1xuICBsZXQgYWRtaW5fcXVlcnkgPSBpbnNpZ2h0X2FkbWluUXVlcnlcbiAgXG4gIGxldCBkYXRhID0gYXdhaXQgZGIucXVlcnkoYFxuICAtLSBTaW1wbGlmaWVkIFNRTCBxdWVyeSB0byBmZXRjaCBhbmltYWwgZGF0YSwgaW5jbHVkaW5nIGdsb2JhbCB0b3RhbHNcbiAgV0lUSCB0YmxfYmFzZSBBUyAoXG4gICAgLS0gQmFzZSBhbmltYWwgZGF0YSBncm91cGVkIGJ5IGNyb3AgdHlwZVxuICAgIFNFTEVDVCBhZG1pbjBfbmFtZSxcbiAgICAgICAgICAgYWRtaW4xX25hbWUsXG4gICAgICAgICAgIGFkbWluMl9uYW1lLFxuICAgICAgICAgICBDQVNFIFxuICAgICAgICAgICAgIFdIRU4gY3JvcCBMSUtFICdjYXR0bGVcXF8lJyBFU0NBUEUgJ1xcXFwnIFRIRU4gJ2NhdHRsZSdcbiAgICAgICAgICAgICBXSEVOIGNyb3AgTElLRSAnZ29hdHNcXF8lJyBFU0NBUEUgJ1xcXFwnIFRIRU4gJ2dvYXRzJ1xuICAgICAgICAgICAgIFdIRU4gY3JvcCBMSUtFICdwaWdzXFxfJScgRVNDQVBFICdcXFxcJyBUSEVOICdwaWdzJ1xuICAgICAgICAgICAgIFdIRU4gY3JvcCBMSUtFICdwb3VsdHJ5XFxfJScgRVNDQVBFICdcXFxcJyBUSEVOICdwb3VsdHJ5J1xuICAgICAgICAgICAgIFdIRU4gY3JvcCBMSUtFICdzaGVlcFxcXyUnIEVTQ0FQRSAnXFxcXCcgVEhFTiAnc2hlZXAnXG4gICAgICAgICAgICAgRUxTRSAnb3RoZXInXG4gICAgICAgICAgIEVORCBBUyBjcm9wLFxuICAgICAgICAgICBTVU0odmFsdWUpIEFTIHZvcF90b3RhbFxuICAgIEZST00gdm9wX2FuaW1hbFxuICAgICR7YWRtaW5fcXVlcnl9XG4gICAgR1JPVVAgQlkgYWRtaW4wX25hbWUsIGFkbWluMV9uYW1lLCBhZG1pbjJfbmFtZSwgY3JvcFxuICApLFxuICBcbiAgLS0gR2xvYmFsIHRvdGFscyB3aGVyZSBhZG1pbiBuYW1lcyBhcmUgbnVsbFxuICBnbG9iYWxfdG90YWxfYW5pbWFsIEFTIChcbiAgICBTRUxFQ1QgTlVMTCBBUyBhZG1pbjBfbmFtZSxcbiAgICAgICAgICAgTlVMTCBBUyBhZG1pbjFfbmFtZSxcbiAgICAgICAgICAgTlVMTCBBUyBhZG1pbjJfbmFtZSxcbiAgICAgICAgICAgY3JvcCxcbiAgICAgICAgICAgU1VNKHZvcF90b3RhbCkgQVMgdm9wX3RvdGFsXG4gICAgRlJPTSB0YmxfYmFzZVxuICAgIEdST1VQIEJZIGNyb3BcbiAgKVxuICBcbiAgLS0gQ29tYmluZSBnbG9iYWwgdG90YWxzIHdpdGggdGhlIGJhc2UgZGF0YVxuICBTRUxFQ1QgKiBGUk9NIGdsb2JhbF90b3RhbF9hbmltYWxcbiAgVU5JT04gQUxMXG4gIFNFTEVDVCAqIEZST00gdGJsX2Jhc2VcbiAgT1JERVIgQlkgYWRtaW4wX25hbWUsIGFkbWluMV9uYW1lLCBhZG1pbjJfbmFtZSwgdm9wX3RvdGFsIERFU0NcbmApO1xuICBjb25zdCBncm91cGVkRGF0YSA9IGRhdGEucmVkdWNlKChhY2MsIGl0ZW0pID0+IHtcbiAgY29uc3Qga2V5ID0gYCR7aXRlbS5hZG1pbjBfbmFtZSB8fCAnVE9UQUwnfS0ke2l0ZW0uYWRtaW4xX25hbWUgfHwgJ1RPVEFMJ30tJHtpdGVtLmFkbWluMl9uYW1lIHx8ICdUT1RBTCd9YDtcbiAgaWYgKCFhY2Nba2V5XSkgYWNjW2tleV0gPSBbXTtcbiAgYWNjW2tleV0ucHVzaChpdGVtKTtcbiAgcmV0dXJuIGFjYztcbn0sIHt9KTtcblxuLy8gUmFuayB3aXRoaW4gZWFjaCBncm91cFxuY29uc3QgcmFua2VkRGF0YSA9IE9iamVjdC5lbnRyaWVzKGdyb3VwZWREYXRhKS5mbGF0TWFwKChba2V5LCBncm91cF0pID0+IHtcbiAgLy8gU29ydCBieSB2YWx1ZSB3aXRoaW4gdGhlIGdyb3VwXG4gIGNvbnN0IHNvcnRlZEdyb3VwID0gZ3JvdXAuc29ydCgoYSwgYikgPT4gYi52YWx1ZSAtIGEudmFsdWUpO1xuICBcbiAgLy8gVGFrZSB0aGUgdG9wIDMgY3JvcHMgZm9yIGVhY2ggcmVnaW9uXG4gIGNvbnN0IHRvcDMgPSBzb3J0ZWRHcm91cC5zbGljZSgwLCAzKS5tYXAoKGl0ZW0sIGluZGV4KSA9PiAoe1xuICAgIC4uLml0ZW0sXG4gICAgcmFuazogaW5kZXggKyAxXG4gIH0pKTtcblxuICByZXR1cm4gdG9wMztcbn0pO1xuICByZXR1cm4gcmFua2VkRGF0YVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBCYXIgQ2hhcnRzIC0gSGF6YXJkcyBhbmQgRXhwb3N1cmVzXG4qZ2V0dGluZyBkYXRhIGJhc2VkIG9uIGFkbWluIHNlbGVjdGlvbiBhbmQgaGF6YXJkIG9wdGlvbnMqYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTA1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgIyMjIyBQbG90IEZ1bmN0aW9uXG5NYWtpbmcgdGhlIHRvcCBWb1AgYmFyIGNoYXJ0c2A7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEwNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIG1ha2UgdGhlIGJhciBjaGFydCBmb3IgdG9wIGNyb3BzXG4vLyBhcHByb2FjaCBpcyBwYXNzaW5nIGluIGRhdGEgZm9yIHNlbGVjdGVkIGhhemFyZCBhbmQgY3JvcCB0eXBlXG5mdW5jdGlvbiBtYWtlVG9wQ3JvcEJhckNoYXJ0KGRhdGEsIHsgbWFyZ2luTGVmdCA9IDEwMCB9ID0ge30pIHtcbiAgY29uc3Qgdm9wQ2FwdGlvbiA9IF9sYW5nKG5iVGV4dC52b3BOb3RlTWQuY2FwdGlvbik7XG4gIGNvbnN0IHZvcExhYmVsID0gX2xhbmcoXG4gICAgbmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QucGxvdHMuZ2VuZXJhbC52b3BMYWJlbCxcbiAgKTtcbiAgY29uc3Qgbm9EYXRhTWVzc2FnZSA9IF9sYW5nKFxuICAgIG5iVGV4dC5jbGltYXRlUmlza3MuaGF6YXJkSW1wYWN0LnBsb3RzLmdlbmVyYWwubm9QbG90TWVzc2FnZSxcbiAgKTtcblxuICAvLyBpZiBubyBkYXRhIGlzIGF2YWlsYWJsZSBmb3Igc2VsZWN0ZWQgaGF6YXJkLCBzaG93IGEgbWVzc2FnZVxuICBpZiAoZGF0YS5sZW5ndGggPT0gMCkge1xuICAgIHJldHVybiBtZGAqJHtub0RhdGFNZXNzYWdlfSpgO1xuICB9XG4gIGNvbnN0IHRvcE4gPSAxMDtcblxuICByZXR1cm4gUGxvdC5wbG90KHtcbiAgICB3aWR0aDogMTIwMCxcbiAgICBoZWlnaHQ6IDM1MCxcbiAgICBtYXJnaW5MZWZ0LFxuICAgIGNhcHRpb246IHZvcENhcHRpb24sXG4gICAgeDoge1xuICAgICAgdGlja0Zvcm1hdDogZm9ybWF0VVNEKHsgbG9jYWxlOiBsYW5ndWFnZS5sb2NhbGUgfSksXG4gICAgICBsYWJlbDogYCR7dm9wTGFiZWx9ICgke2ludERvbGxhclVuaXR9KWAsXG4gICAgICBncmlkOiB0cnVlLFxuICAgIH0sXG4gICAgeToge1xuICAgICAgbGFiZWw6IG51bGwsXG4gICAgICB0aWNrU2l6ZTogMCxcbiAgICB9LFxuICAgIGNvbG9yOiB7XG4gICAgICBkb21haW46IGhhemFyZFBsb3RMb29rdXAuY29sb3IuZG9tYWluLFxuICAgICAgcmFuZ2U6IGhhemFyZFBsb3RMb29rdXAuY29sb3IucmFuZ2UsXG4gICAgfSxcbiAgICBtYXJrczogW1xuICAgICAgUGxvdC5iYXJYKGRhdGEsIHtcbiAgICAgICAgeDogXCJ2b3BcIixcbiAgICAgICAgeTogKGQpID0+IGhhemFyZFBsb3RMb29rdXAuY3JvcHNbZC5jcm9wXSxcbiAgICAgICAgZmlsbDogKGQpID0+IGhhemFyZFBsb3RMb29rdXAubmFtZXNbZC5oYXphcmRdLFxuICAgICAgICBzb3J0OiB7IHk6IFwieFwiLCByZXZlcnNlOiB0cnVlLCBsaW1pdDogMTAgfSxcbiAgICAgICAgY2hhbm5lbHM6IHtcbiAgICAgICAgICB2b3A6IHtcbiAgICAgICAgICAgIGxhYmVsOiB2b3BMYWJlbCxcbiAgICAgICAgICAgIHZhbHVlOiBcInZvcFwiLFxuICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIHRpcDoge1xuICAgICAgICAgIGZvcm1hdDoge1xuICAgICAgICAgICAgeDogZmFsc2UsXG4gICAgICAgICAgICB5OiBmYWxzZSxcbiAgICAgICAgICAgIGZpbGw6IGZhbHNlLFxuICAgICAgICAgICAgdm9wOiAoZCkgPT4gZm9ybWF0SW50RG9sbGFyKHsgbG9jYWxlOiBsYW5ndWFnZS5sb2NhbGUgfSkoZCksXG4gICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgIH0pLFxuICAgIF0sXG4gIH0pO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAjIyMjIEhhemFyZCBEYXRhYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTA4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgVGhlIGhhemFyZCBkYXRhIGluY2x1ZGVzIGEgJ2dlbmVyaWMnIGNyb3AsIHdoaWNoIGlzIGEgbGFyZ2UgdmFsdWUgdGhhdCBkd2FyZnMgb3RoZXIgY3JvcCB2YWx1ZXMuIFdlIGV4Y2x1ZGUgdGhpcyBmcm9tIHRoZSBjaGFydC5gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMDkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGBCZWxvdyBpcyBhIHRhYmxlIG9mIHRoZSBleHBsYW5hdGlvbnMgb2YgZXZlcnkgaGF6YXJkIGNvbXBvbmVudC4gVGhlICdhbnknIGhhemFyZCBpcyB0aGUgY29tYmluYXRpb24gb2YgYWxsIG9mIHRoZSBiZWxvdyBoYXphcmRzLlxuXG58IGhhemFyZCB8IGRlc2NyaXB0aW9uIHxcbnwgLS0tIHwgLS0tIHxcbnwgZHJ5IHwgcmlzayBvZiBkcnkgaGF6YXJkIG9jY3VycmluZyBhbG9uZSB8XG58IGhlYXQgfCByaXNrIG9mIGhlYXQgaGF6YXJkIG9jY3VycmluZyBhbG9uZSB8XG58IHdldCB8IHJpc2sgb2Ygd2V0IGhhemFyZCBvY2N1cnJpbmcgYWxvbmUgfFxufCBkcnkraGVhdCB8IHJpc2sgb2YgZHJ5IGFuZCBoZWF0IGhhemFyZCBvY2N1cnJpbmcgdG9nZXRoZXIgfFxufCBkcnkrd2V0IHwgcmlzayBvZiBkcnkgYW5kIHdldCBoYXphcmQgb2NjdXJyaW5nIHRvZ2V0aGVyIHxcbnwgaGVhdCt3ZXQgfCByaXNrIG9mIGhlYXQgYW5kIHdldCBoYXphcmQgb2NjdXJyaW5nIHRvZ2V0aGVyIHxcbnwgZHJ5K2hlYXQrd2V0IHwgcmlzayBvZiBkcnkgYW5kIGhlYXQgYW5kIHdldCBoYXphcmQgb2NjdXJyaW5nIHRvZ2V0aGVyIHxcbnwgTm8gaGF6YXJkIHwgbm8gaGF6YXJkIGFwcGxpZWRcblxuKklmIHRoZXJlIGFyZSB6ZXJvcyBmb3IgaW5kaXZpZHVhbCBoYXphcmRzIHRoZW4gaXQgbWVhbnMgaXQgYWx3YXlzIG9jY3VycyBpbiBjb21iaW5hdGlvbiB3aXRoIGFub3RoZXIgaGF6YXJkIGFuZCBkb2VzIG5vdCBvY2N1ciBhbG9uZS4qYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTEwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZGF0YSBmb3Igc2VsZWN0ZWQgaGF6YXJkIHNjZW5hcmlvLCB3aXRoIHRvdGFsIHZvcFxuZGF0YV9oYXphcmRWb1AgPSBULnRpZHkoXG4gIGRhdGFIYXphcmRTZWxlY3RlZCxcbiAgVC5sZWZ0Sm9pbihkYXRhSGF6YXJkVm9QVG90YWxTZWxlY3RlZCwge1xuICAgIGJ5OiBbXCJhZG1pbjBfbmFtZVwiLCBcImFkbWluMV9uYW1lXCIsIFwiYWRtaW4yX25hbWVcIiwgXCJjcm9wXCJdLFxuICB9KSxcbiAgVC5maWx0ZXIoKGQpID0+IGQuY3JvcCAhPT0gXCJnZW5lcmljXCIpLCAvLyByZW1vdmUgZ2VuZXJpY1xuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTExIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGF0YUhhemFyZFZvUFRvdGFsU2VsZWN0ZWQgPSBULnRpZHkoXG4gIGRhdGFIYXphcmRTZWxlY3RlZCxcbiAgVC5maWx0ZXIoKGQpID0+IGQuaGF6YXJkICE9PSBcImFueVwiKSxcbiAgVC5ncm91cEJ5KFxuICAgIFtcbiAgICAgIFwiYWRtaW4wX25hbWVcIixcbiAgICAgIFwiYWRtaW4xX25hbWVcIixcbiAgICAgIFwiYWRtaW4yX25hbWVcIixcbiAgICAgIFwic2V2ZXJpdHlcIixcbiAgICAgIFwic2NlbmFyaW9cIixcbiAgICAgIFwidGltZWZyYW1lXCIsXG4gICAgICBcImNyb3BcIixcbiAgICBdLFxuICAgIFtcbiAgICAgIFQuc3VtbWFyaXplKHtcbiAgICAgICAgdm9wX3RvdGFsOiBULnN1bShcInZvcFwiKSxcbiAgICAgIH0pLFxuICAgIF0sXG4gICksXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMTIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAjIyMjIExvb2t1cHNgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMTMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyB1bmlxdWUgY3JvcHMgaW4gdGhlIGhhemFyZCBkYXRhXG5oYXphcmRDcm9wcyA9IHtcbiAgY29uc3QgcXVlcnkgPSBhd2FpdCBkYi5xdWVyeShgc2VsZWN0IGNyb3BcbiAgLCBjb3VudCgqKSBhcyBjb3VudFxuICBmcm9tIGhhel9yaXNrX3ZvcF9pbnRcbiAgZ3JvdXAgYnkgMVxuICBvcmRlciBieSAxYCk7XG5cbiAgcmV0dXJuIHF1ZXJ5XG4gfVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMTQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBmb3JtYXR0aW5nIGNyb3AgbmFtZXNcbmNyb3BOYW1lcyA9IHtcbiAgY29uc3QgcmF3ID0gVC50aWR5KFxuICAgIGhhemFyZENyb3BzLFxuICAgIFQuZGlzdGluY3QoXCJjcm9wXCIpLFxuICAgIFQuc2VsZWN0KFwiY3JvcFwiKSxcbiAgICBULm11dGF0ZSh7XG4gICAgICB0eXBlOiAoZCkgPT4gKC9fLy50ZXN0KGQuY3JvcCkgPyBcImxpdmVzdG9ja1wiIDogXCJjcm9wXCIpXG4gICAgfSksXG4gICAgVC5hcnJhbmdlKFtcInR5cGVcIiwgXCJjcm9wTmFtZVwiXSlcbiAgKTtcbiAgbGV0IGRhdGEgPSByYXc7XG5cbiAgLy8gdHJhbnNsYXRpb25cblxuICBjb25zdCB0cmFuc2xhdGVDcm9wID0gKGNyb3ApID0+IHRkLmNyb3AudmFsdWVzPy5bY3JvcF07XG4gIGRhdGEgPSBkYXRhLm1hcCgoZCkgPT4ge1xuICAgIGNvbnN0IGFyciA9IExhbmcudG9TZW50ZW5jZUNhc2UoX2xhbmcodHJhbnNsYXRlQ3JvcChkLmNyb3ApKSkuc3BsaXQoXCJfXCIpO1xuICAgIGNvbnN0IG1haW5IYWxmID0gYXJyLnNsaWNlKDAsIDEpO1xuICAgIGNvbnN0IGJhY2tIYWxmID0gYXJyXG4gICAgICAuc2xpY2UoMSlcbiAgICAgIC5maWx0ZXIoKGQpID0+IGQgIT09IFwiZGVcIilcbiAgICAgIC5qb2luKFwiIFwiKTtcbiAgICBjb25zdCBwYXJlbiA9IGJhY2tIYWxmLmxlbmd0aCA+IDAgPyBgKCR7YmFja0hhbGZ9KWAgOiBcIlwiO1xuICAgIGNvbnN0IGZvcm1hdHRlZCA9IFsuLi5tYWluSGFsZiwgcGFyZW5dLmpvaW4oXCIgXCIpLnRyaW1FbmQoKTtcbiAgICByZXR1cm4ge1xuICAgICAgLi4uZCxcbiAgICAgIGNyb3BOYW1lOiBmb3JtYXR0ZWRcbiAgICB9O1xuICB9KTtcblxuICByZXR1cm4gZGF0YTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTE1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gbG9va3VwcyBmb3IgaGF6YXJkIHBsb3RcbmhhemFyZFBsb3RMb29rdXAgPSB7XG4gIGNvbnN0IGhhemFyZHMgPSB7XG4gICAgd2V0OiBfbGFuZyhuYlRleHQuY2xpbWF0ZVJpc2tzLmhhemFyZEltcGFjdC5oYXphcmRzLndldCksXG4gICAgZHJ5OiBfbGFuZyhuYlRleHQuY2xpbWF0ZVJpc2tzLmhhemFyZEltcGFjdC5oYXphcmRzLmRyeSksXG4gICAgaGVhdDogX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaGF6YXJkcy5oZWF0KSxcbiAgICBkcnlfaGVhdDogX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaGF6YXJkcy5kcnlfaGVhdCksXG4gICAgZHJ5X3dldDogX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaGF6YXJkcy5kcnlfd2V0KSxcbiAgICBoZWF0X3dldDogX2xhbmcobmJUZXh0LmNsaW1hdGVSaXNrcy5oYXphcmRJbXBhY3QuaGF6YXJkcy5oZWF0X3dldCksXG4gICAgZHJ5X2hlYXRfd2V0OiBfbGFuZyhuYlRleHQuY2xpbWF0ZVJpc2tzLmhhemFyZEltcGFjdC5oYXphcmRzLmRyeV9oZWF0X3dldCksXG4gICAgbm9faGF6YXJkOiBfbGFuZyhuYlRleHQuY2xpbWF0ZVJpc2tzLmhhemFyZEltcGFjdC5oYXphcmRzLm5vX2hhemFyZClcbiAgfTtcbiAgcmV0dXJuIHtcbiAgICBuYW1lczoge1xuICAgICAgd2V0OiBoYXphcmRzLndldCxcbiAgICAgIGRyeTogaGF6YXJkcy5kcnksXG4gICAgICBoZWF0OiBoYXphcmRzLmhlYXQsXG4gICAgICBcImRyeStoZWF0XCI6IGhhemFyZHMuZHJ5X2hlYXQsXG4gICAgICBcImRyeSt3ZXRcIjogaGF6YXJkcy5kcnlfd2V0LFxuICAgICAgXCJoZWF0K3dldFwiOiBoYXphcmRzLmhlYXRfd2V0LFxuICAgICAgXCJkcnkraGVhdCt3ZXRcIjogaGF6YXJkcy5kcnlfaGVhdF93ZXQsXG4gICAgICBcIm5vIGhhemFyZFwiOiBoYXphcmRzLm5vX2hhemFyZFxuICAgIH0sXG4gICAgY29sb3I6IHtcbiAgICAgIGRvbWFpbjogW1xuICAgICAgaGF6YXJkcy53ZXQsXG4gICAgICBoYXphcmRzLmRyeSxcbiAgICAgIGhhemFyZHMuaGVhdCxcbiAgICAgIGhhemFyZHMuZHJ5X2hlYXQsXG4gICAgICBoYXphcmRzLmRyeV93ZXQsXG4gICAgICBoYXphcmRzLmhlYXRfd2V0LFxuICAgICAgaGF6YXJkcy5kcnlfaGVhdF93ZXQsXG4gICAgICBoYXphcmRzLm5vX2hhemFyZFxuICAgICAgXSxcbiAgICAgIHJhbmdlOiBbXG4gICAgICAgIFwiIzRGQjVCN1wiLFxuICAgICAgICBcIiNGQ0M0MkNcIixcbiAgICAgICAgXCIjRkM4QTM0XCIsXG4gICAgICAgIFwiI0VFNjI0RlwiLFxuICAgICAgICBcIiNCMzRFNjVcIixcbiAgICAgICAgXCIjOEMzRTVGXCIsXG4gICAgICAgIFwiIzUyM0Q0RVwiLFxuICAgICAgICBcIiNFRkVGRUZcIlxuICAgICAgXVxuICAgIH0sXG4gICAgY3JvcHM6IGNyb3BOYW1lcy5yZWR1Y2UoKGFjYywgb2JqKSA9PiB7XG4gICAgICBhY2Nbb2JqLmNyb3BdID0gb2JqLmNyb3BOYW1lO1xuICAgICAgcmV0dXJuIGFjYztcbiAgICB9LCB7fSlcbiAgfTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTE2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgIyMjIyBTZWxlY3RpbmcgVm9QIGRhdGEgYnkgc2NlbmFyaW9cbi0gVGhlIGRhdGEgaXMgcXVlcmllZCBhcyBzZXBhcmF0ZSBjb21wb25lbnRzIGZvciBlYWNoIGFkbWluIHJlZ2lvbiB0byByZWR1Y2UgcXVlcnkgc2l6ZSBhbmQgYWxsb3cgZm9yIGR5bmFtaWMgbnVsbCBoYW5kbGluZy4gQSB0YWJsZSBpcyBjaG9zZW4gYmFzZWQgb24gdGhlIHNlbGVjdGVkIGFkbWluIHJlZ2lvbi5gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBwaWNrIHRoZSBhZG1pbiBkYXRhc2V0IGJhc2VkIG9uIGFkbWluIHNlbGVjdGlvblxuZGF0YUhhemFyZFNlbGVjdGVkID0ge1xuICBpZiAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMi52YWx1ZSkgcmV0dXJuIGRhdGFIYXphcmRBZG1pbjJcbiAgZWxzZSBpZiAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZSkgcmV0dXJuIGRhdGFIYXphcmRBZG1pbjFcbiAgZWxzZSBpZiAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZSkgcmV0dXJuIGRhdGFIYXphcmRBZG1pbjBcbiAgZWxzZSByZXR1cm4gZGF0YUhhemFyZEFkbWluQWxsXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFIYXphcmRBZG1pbkFsbCA9IGF3YWl0IGRiLnF1ZXJ5KGBcbiAgLS0gQWRtaW4wIHRvdGFsIGZvciBTdWItU2FoYXJhbiBBZnJpY2EgKFNTQSkgcmVnaW9uc1xuICBXSVRIIEhhemFyZFJpc2tCYXNlIEFTIChcbiAgICAtLSBGaWx0ZXIgYnkgY2hvc2VuIHNjZW5hcmlvIGFuZCB0aW1lZnJhbWUsIGZvY3VzaW5nIG9uIHNldmVyZSBoYXphcmRzXG4gICAgU0VMRUNUIGFkbWluMF9uYW1lLFxuICAgICAgICAgICBhZG1pbjFfbmFtZSxcbiAgICAgICAgICAgYWRtaW4yX25hbWUsXG4gICAgICAgICAgIHNjZW5hcmlvLFxuICAgICAgICAgICB0aW1lZnJhbWUsXG4gICAgICAgICAgIGNyb3AsXG4gICAgICAgICAgIHNldmVyaXR5LFxuICAgICAgICAgICBoYXphcmQsXG4gICAgICAgICAgIHZhbHVlIEFTIHZvcFxuICAgIEZST00gaGF6X3Jpc2tfdm9wX2ludFxuICAgIFdIRVJFIHNldmVyaXR5ID0gJ3NldmVyZSdcbiAgICBhbmQgdGltZWZyYW1lID0gJyR7c2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUudGltZWZyYW1lfSdcbiAgICBhbmQgc2NlbmFyaW8gPSAnJHtzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZS5zY2VuYXJpb30nXG4gICksXG5cbiAgLS0gRGF0YSBmb3IgU1NBIHJlZ2lvbnMgb25seSwgd2hlcmUgYWRtaW4xX25hbWUgaXMgTlVMTCAoQWRtaW4wIGxldmVsKVxuICBBZG1pbjBTU0FEYXRhIEFTIChcbiAgICBTRUxFQ1QgKlxuICAgIEZST00gSGF6YXJkUmlza0Jhc2VcbiAgICBXSEVSRSBhZG1pbjFfbmFtZSBJUyBOVUxMXG4gICksXG5cbiAgLS0gQWdncmVnYXRlIFZvUCBmb3IgZWFjaCBjcm9wIGJ5IGhhemFyZCB0eXBlIGFjcm9zcyBBZG1pbjAgcmVnaW9uc1xuICBBZ2dyZWdhdGVkQ3JvcERhdGEgQVMgKFxuICAgIFNFTEVDVCBzZXZlcml0eSxcbiAgICAgICAgICAgc2NlbmFyaW8sXG4gICAgICAgICAgIHRpbWVmcmFtZSxcbiAgICAgICAgICAgaGF6YXJkLFxuICAgICAgICAgICBjcm9wLFxuICAgICAgICAgICBTVU0odm9wKSBBUyB2b3BcbiAgICBGUk9NIEFkbWluMFNTQURhdGFcbiAgICBHUk9VUCBCWSBzZXZlcml0eSwgc2NlbmFyaW8sIHRpbWVmcmFtZSwgaGF6YXJkLCBjcm9wXG4gIClcblxuICAtLSBPdXRwdXQ6IEFkbWluMCBsZXZlbCBjcm9wIGRhdGEgd2l0aCBudWxsIGFkbWluIG5hbWVzIGZvciBTU0FcbiAgU0VMRUNUIE5VTEwgQVMgYWRtaW4wX25hbWUsIFxuICAgICAgICAgTlVMTCBBUyBhZG1pbjFfbmFtZSwgXG4gICAgICAgICBOVUxMIEFTIGFkbWluMl9uYW1lLFxuICAgICAgICAgc2V2ZXJpdHksIFxuICAgICAgICAgc2NlbmFyaW8sIFxuICAgICAgICAgdGltZWZyYW1lLCBcbiAgICAgICAgIGhhemFyZCwgXG4gICAgICAgICBjcm9wLCBcbiAgICAgICAgIHZvcFxuICBGUk9NIEFnZ3JlZ2F0ZWRDcm9wRGF0YVxuYCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTExOSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFIYXphcmRBZG1pbjAgPSBkYi5xdWVyeShgXG4gIHNlbGVjdCBhZG1pbjBfbmFtZVxuICAgICwgYWRtaW4xX25hbWVcbiAgICAsIGFkbWluMl9uYW1lXG4gICAgLCBzY2VuYXJpb1xuICAgICwgdGltZWZyYW1lXG4gICAgLCBjcm9wXG4gICAgLCBzZXZlcml0eVxuICAgICwgaGF6YXJkXG4gICAgLCB2YWx1ZSBhcyB2b3BcbiAgICBmcm9tIGhhel9yaXNrX3ZvcF9pbnRcbiAgICB3aGVyZSBzZXZlcml0eSA9ICdzZXZlcmUnIC0tIGhhcmQtY29kZWRcbiAgICAtLSBhbmQgaGF6YXJkIGluICgnaGVhdCcsICd3ZXQnLCAnZHJ5JykgLS0gc2luZ2xlIGhhemFyZHMgYWxvbmVcbiAgICBhbmQgdGltZWZyYW1lID0gJyR7c2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUudGltZWZyYW1lfSdcbiAgICBhbmQgc2NlbmFyaW8gPSAnJHtzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZS5zY2VuYXJpb30nXG4gICAgYW5kIGFkbWluMV9uYW1lIGlzIG51bGxcbiAgYW5kIGFkbWluMF9uYW1lID0gJyR7YWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZX0nYCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFIYXphcmRBZG1pbjEgPSBkYi5xdWVyeShgLS0gYWRtaW4xIGxldmVsIGhhemFyZCBkYXRhXG4gIC0tIGNob3NlbiBzY2VuYXJpbyBhbmQgdGltZWZyYW1lIFZvUFxuICBzZWxlY3QgYWRtaW4wX25hbWVcbiAgICAsIGFkbWluMV9uYW1lXG4gICAgLCBhZG1pbjJfbmFtZVxuICAgICwgc2NlbmFyaW9cbiAgICAsIHRpbWVmcmFtZVxuICAgICwgY3JvcFxuICAgICwgc2V2ZXJpdHlcbiAgICAsIGhhemFyZFxuICAgICwgdmFsdWUgYXMgdm9wXG4gICAgZnJvbSBoYXpfcmlza192b3BfaW50XG4gICAgd2hlcmUgc2V2ZXJpdHkgPSAnc2V2ZXJlJyAtLSBoYXJkLWNvZGVkXG4gICAgLS0gYW5kIGhhemFyZCBpbiAoJ2hlYXQnLCAnd2V0JywgJ2RyeScpIC0tIHNpbmdsZSBoYXphcmRzIGFsb25lXG4gICAgYW5kIHRpbWVmcmFtZSA9ICcke3NlbGVjdFNjZW5hcmlvQW5kVGltZWZyYW1lLnRpbWVmcmFtZX0nXG4gICAgYW5kIHNjZW5hcmlvID0gJyR7c2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUuc2NlbmFyaW99J1xuICAgIGFuZCBhZG1pbjBfbmFtZSA9ICcke2FkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWV9J1xuICAgIGFuZCBhZG1pbjFfbmFtZSA9ICcke2NsZWFuQWRtaW5JbnB1dF9TUUwoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZSl9J1xuICAgIGFuZCBhZG1pbjJfbmFtZSBpcyBudWxsXG5gKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGF0YUhhemFyZEFkbWluMiA9IGRiLnF1ZXJ5KGAtLSBhZG1pbjIgbGV2ZWwgaGF6YXJkIGRhdGFcbiAgLS0gY2hvc2VuIHNjZW5hcmlvIGFuZCB0aW1lZnJhbWUgVm9QXG4gIHNlbGVjdCBhZG1pbjBfbmFtZVxuICAgICwgYWRtaW4xX25hbWVcbiAgICAsIGFkbWluMl9uYW1lXG4gICAgLCBzY2VuYXJpb1xuICAgICwgdGltZWZyYW1lXG4gICAgLCBjcm9wXG4gICAgLCBzZXZlcml0eVxuICAgICwgaGF6YXJkXG4gICAgLCB2YWx1ZSBhcyB2b3BcbiAgICBmcm9tIGhhel9yaXNrX3ZvcF9pbnRcbiAgICB3aGVyZSBzZXZlcml0eSA9ICdzZXZlcmUnIC0tIGhhcmQtY29kZWRcbiAgICAtLSBhbmQgaGF6YXJkIGluICgnaGVhdCcsICd3ZXQnLCAnZHJ5JykgLS0gc2luZ2xlIGhhemFyZHMgYWxvbmVcbiAgICBhbmQgdGltZWZyYW1lID0gJyR7c2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUudGltZWZyYW1lfSdcbiAgICBhbmQgc2NlbmFyaW8gPSAnJHtzZWxlY3RTY2VuYXJpb0FuZFRpbWVmcmFtZS5zY2VuYXJpb30nXG4gICAgYW5kIGFkbWluMF9uYW1lID0gJyR7YWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZX0nXG4gICAgYW5kIGFkbWluMV9uYW1lID0gJyR7Y2xlYW5BZG1pbklucHV0X1NRTChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlKX0nXG4gICAgYW5kIGFkbWluMl9uYW1lID0gJyR7Y2xlYW5BZG1pbklucHV0X1NRTChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlKX0nXG5gKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTIyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgRHluYW1pYyBJbnNpZ2h0cyAtIEhhemFyZHMgYW5kIGV4cG9zdXJlc2A7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyMyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGdldCBzZWxlY3RlZCBoYXphcmQgZm9yIGluc2lnaHRzLCBkZWZpbmUgY3JvcCB0eXBlXG5kYXRhX3NlbGVjdGVkSGF6YXJkQ3JvcFR5cGUgPSBULnRpZHkoXG4gIGRhdGFfaGF6YXJkVm9QLFxuICBULmZpbHRlcigoZCkgPT4gZC5oYXphcmQgPT0gc2VsZWN0SGF6YXJkKSxcbiAgVC5tdXRhdGUoe1xuICAgIGNyb3BUeXBlOiAoZCkgPT4ge1xuICAgICAgaWYgKHJpc2tEYXRhVHlwZXMuY3JvcC5jcm9wLmluY2x1ZGVzKGQuY3JvcCkpIHJldHVybiBcImNyb3BcIjtcbiAgICAgIGlmIChyaXNrRGF0YVR5cGVzLmNyb3AubGl2ZXN0b2NrLmluY2x1ZGVzKGQuY3JvcCkpIHJldHVybiBcImxpdmVzdG9ja1wiO1xuICAgICAgcmV0dXJuIFwib3RoZXJcIjtcbiAgICB9LFxuICB9KSxcbiAgVC5hcnJhbmdlKFtcImNyb3BUeXBlXCIsIFQuZGVzYyhcInZvcFwiKV0pLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTI0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gY29tYmluZWQgY3JvcCBhbmQgbGl2ZXN0b2NrIGV4cG9zZWQgZm9yIHNlbGVjdGlvblxuaW5zaWdodF90b3RhbEV4cG9zZWRWb3AgPSBULnRpZHkoXG4gIGRhdGFfc2VsZWN0ZWRIYXphcmRDcm9wVHlwZSxcbiAgVC5ncm91cEJ5KFxuICAgIFtcImNyb3BUeXBlXCJdLFxuICAgIFtcbiAgICAgIFQuc3VtbWFyaXplKHtcbiAgICAgICAgdG90YWxFeHBvc2VkVm9wOiBULnN1bShcInZvcFwiKSxcbiAgICAgIH0pLFxuICAgIF0sXG4gICksXG4pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMjUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyB0b3AgY3JvcCBhbmQgbGl2ZXN0b2NrIGZvciBzZWxlY3Rpb25cbmluc2lnaHRfdG9wQ3JvcHMgPSB7XG4gIGNvbnN0IHRvcENyb3AgPSBULnRpZHkoXG4gICAgZGF0YV9zZWxlY3RlZEhhemFyZENyb3BUeXBlLFxuICAgIFQuc2VsZWN0KFtcImNyb3BUeXBlXCIsIFwiY3JvcFwiLCBcInZvcFwiXSksXG4gICAgVC5maWx0ZXIoKGQpID0+IGQuY3JvcFR5cGUgPT0gXCJjcm9wXCIpLFxuICAgIFQuc2xpY2VNYXgoMSwgXCJ2b3BcIilcbiAgKTtcbiAgY29uc3QgdG9wTGl2ZXN0b2NrID0gVC50aWR5KFxuICAgIGRhdGFfc2VsZWN0ZWRIYXphcmRDcm9wVHlwZSxcbiAgICBULnNlbGVjdChbXCJjcm9wVHlwZVwiLCBcImNyb3BcIiwgXCJ2b3BcIl0pLFxuICAgIFQuZmlsdGVyKChkKSA9PiBkLmNyb3BUeXBlID09IFwibGl2ZXN0b2NrXCIpLFxuICAgIFQuc2xpY2VNYXgoMSwgXCJ2b3BcIilcbiAgKTtcbiAgcmV0dXJuIFtcbiAgICAuLi50b3BDcm9wLFxuICAgIC4uLnRvcExpdmVzdG9ja1xuICBdXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEyNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIHRvdGFsIHZvcCBleHBvc2VkIGJ5IGVhY2ggaGF6YXJkXG5pbnNpZ2h0X3JhbmtlZEhhemFyZFZvcFRvdGFscyA9IFQudGlkeShcbiAgZGF0YV9oYXphcmRWb1AsXG4gIFQuZ3JvdXBCeShcbiAgICBbXCJoYXphcmRcIl0sXG4gICAgW1xuICAgICAgVC5zdW1tYXJpemUoe1xuICAgICAgICB0b3RhbFZvcDogVC5zdW0oXCJ2b3BcIiksXG4gICAgICB9KSxcbiAgICBdLFxuICApLFxuICBULmZpbHRlcigoZCkgPT4gIVtcImFueVwiLCBcIm5vIGhhemFyZFwiXS5pbmNsdWRlcyhkLmhhemFyZCkpLCAvLyByZW1vdmUgY29tYmluZWQgYW5kIG5vIGhhemFyZFxuICBULmFycmFuZ2UoVC5kZXNjKFwidG90YWxWb3BcIikpLFxuKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTI3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgQ2hvcm9wbGV0aCBtYXAgLSBBZGFwdGl2ZSBDYXBhY2l0aWVzXG4qUG9wdWxhdGlvbiBhZmZlY3RlZCBieSBhZG1pbiByZWdpb24qXG4tIEZldGNoIHRoZSBkYXRhIHNlcGFyYXRlbHkgZm9yIHRoZSBkaWZmZXJlbnQgYWRtaW4gbGV2ZWxzIGFuZCBnZW5lcmF0ZSBtYXAgZGF0YSBmb3IgZWFjaFxuLSBTZXJ2ZSBkaWZmZXJlbnQgZGF0YSBiYXNlZCBvbiBhZG1pbiBzZWxlY3Rpb25gO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMjgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBtYXAgbGF5ZXIgb3B0aW9uc1xuZGF0YUxheWVyT3B0aW9uc0FkYXB0aXZlQ2FwYWNpdGllcyA9IFtcbiAge1xuICAgIGtleTogXCJwb3ZcIiwgLy8gbG9va3VwIGlkIGZvciBkYXRhIG9wdGlvblxuICAgIGRhdGFDb2x1bW46IFwiYWNfcG92XCIsIC8vIGRhdGEgY29sdW1uIChkZWNpbWFsIG9mIEFDKVxuICAgIGxhYmVsOiBfbGFuZyhuYlRleHQuYWRhcHRpdmVDYXBhY2l0aWVzLmlucHV0cy5tYXBMYXllci5vcHRpb25zLnBvdi5sYWJlbCksIC8vIGxhYmVsXG4gICAgbGFiZWxMZWdlbmQ6IF9sYW5nKFxuICAgICAgbmJUZXh0LmFkYXB0aXZlQ2FwYWNpdGllcy5pbnB1dHMubWFwTGF5ZXIub3B0aW9ucy5wb3YubGFiZWxMZWdlbmQsXG4gICAgKSwgLy8gbGFiZWwgZm9yIGNvbG9yIGxlZ2VuZFxuICB9LFxuICB7XG4gICAga2V5OiBcImVkdVwiLFxuICAgIGRhdGFDb2x1bW46IFwiYWNfZWR1XCIsXG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5hZGFwdGl2ZUNhcGFjaXRpZXMuaW5wdXRzLm1hcExheWVyLm9wdGlvbnMuZWR1LmxhYmVsKSxcbiAgICBsYWJlbExlZ2VuZDogX2xhbmcoXG4gICAgICBuYlRleHQuYWRhcHRpdmVDYXBhY2l0aWVzLmlucHV0cy5tYXBMYXllci5vcHRpb25zLmVkdS5sYWJlbExlZ2VuZCxcbiAgICApLFxuICB9LFxuICB7XG4gICAga2V5OiBcImZlbVwiLFxuICAgIGRhdGFDb2x1bW46IFwiYWNfZmVtXCIsXG4gICAgbGFiZWw6IF9sYW5nKG5iVGV4dC5hZGFwdGl2ZUNhcGFjaXRpZXMuaW5wdXRzLm1hcExheWVyLm9wdGlvbnMuZmVtLmxhYmVsKSxcbiAgICBsYWJlbExlZ2VuZDogX2xhbmcoXG4gICAgICBuYlRleHQuYWRhcHRpdmVDYXBhY2l0aWVzLmlucHV0cy5tYXBMYXllci5vcHRpb25zLmZlbS5sYWJlbExlZ2VuZCxcbiAgICApLFxuICB9LFxuXS5tYXAoKGQpID0+ICh7XG4gIC8vIGFwcGx5IGNvbW1vbiB2YWx1ZXMgYWNyb3NzIGFsbCBvcHRpb25zXG4gIC4uLmQsXG4gIGxhYmVsUG9wOiBcIlBvcHVsYXRpb25cIiwgLy8gdG9vbHRpcCBsYWJlbCBmb3IgcG9wdWxhdGlvbiBhZmZlY3RlZFxuICBwb3BDb2x1bW46IFwidG90YWxfcG9wXCIsIC8vIHBvcHVsYXRpb24gY29sdW1uXG4gIGNvbG9yRG9tYWluOiBjb2xvclNjYWxlcy5yYW5nZS5vcmFuZ2VSZWQsIC8vIGNvbG9yIGRvbWFpblxuICBjb2xvclVua25vd246IGNvbG9yU2NhbGVzLnVua25vd24sIC8vIHVua25vd24gZmlsbCBjb2xvclxufSkpO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMjkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBmaWx0ZXIgYWRhcHRpdmUgY2FwYWNpdHkgZGF0YSwgZ2V0IHJlbGV2YW50IGZlYXR1cmVzXG5tYXBGZWF0dXJlc0FkYXB0aXZlQ2FwYWNpdHkgPSB7XG4gIC8vIGlmIG51bGwgc2VsZWN0aW9uIGZvciBhbGwgYWRtaW5zLCByZXR1cm4gYWRtaW4wIGxldmVsXG4gIGlmICghYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZSkgcmV0dXJuIG1hcERhdGFBZGFwdGl2ZUNhcGFjaXR5QWRtaW4wLmZlYXR1cmVzXG4gIC8vIHJldHVybiBhZG1pbjIgbGV2ZWxcbiAgZWxzZSB7XG4gICAgcmV0dXJuIG1hcERhdGFBZGFwdGl2ZUNhcGFjaXR5QWRtaW4yLmZlYXR1cmVzLmZpbHRlcigoZCkgPT4ge1xuICAgICAgcmV0dXJuIChcbiAgICAgICAgZC5wcm9wZXJ0aWVzLmFkbWluMF9uYW1lID09PVxuICAgICAgICAgIChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlIHx8IGQucHJvcGVydGllcy5hZG1pbjBfbmFtZSkgJiZcbiAgICAgICAgZC5wcm9wZXJ0aWVzLmFkbWluMV9uYW1lID09PVxuICAgICAgICAgIChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlIHx8IGQucHJvcGVydGllcy5hZG1pbjFfbmFtZSlcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTMwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWFwRGF0YUFkYXB0aXZlQ2FwYWNpdHlBZG1pbjIgPSB7XG4gIGNvbnN0IGRhdGEgPSBULnRpZHkoXG4gICAgZGF0YUFkYXB0aXZlQ2FwYWNpdHksXG4gICAgLy8gYWRkIGRhdGEgam9pbiBmb3IgZ2VvIGRhdGFcbiAgICBULm11dGF0ZSh7XG4gICAgICBhMl9hMV9hMDogKGQpID0+IFtkLmFkbWluMl9uYW1lLCBkLmFkbWluMV9uYW1lLCBkLmFkbWluMF9uYW1lXS5qb2luKFwiX1wiKVxuICAgIH0pXG4gICk7XG4gIGNvbnN0IGdlb0RhdGEgPSBib3VuZGFyaWVzLmFkbWluMjtcblxuICByZXR1cm4gYmluZFRhYnVsYXJUb0dlbyh7XG4gICAgZGF0YTogZGF0YSxcbiAgICBkYXRhQmluZENvbHVtbjogXCJhMl9hMV9hMFwiLFxuICAgIGdlb0RhdGE6IGdlb0RhdGEsXG4gICAgZ2VvRGF0YUJpbmRDb2x1bW46IFwiYTJfYTFfYTBcIlxuICB9KTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTMxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWFwRGF0YUFkYXB0aXZlQ2FwYWNpdHlBZG1pbjAgPSB7XG4gIGNvbnN0IGRhdGEgPSBkYXRhQWRhcHRpdmVDYXBhY2l0eVxuICBjb25zdCBnZW9EYXRhID0gYm91bmRhcmllcy5hZG1pbjA7XG5cbiAgcmV0dXJuIGJpbmRUYWJ1bGFyVG9HZW8oe1xuICAgIGRhdGE6IGRhdGEsXG4gICAgZGF0YUJpbmRDb2x1bW46IFwiYWRtaW4wX25hbWVcIixcbiAgICBnZW9EYXRhOiBnZW9EYXRhLFxuICAgIGdlb0RhdGFCaW5kQ29sdW1uOiBcImFkbWluMF9uYW1lXCJcbiAgfSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRhdGFBZGFwdGl2ZUNhcGFjaXR5ID0ge1xuICBjb25zdCBjb3VudHJ5ID0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZTtcbiAgY29uc3QgYWRtaW4xID0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZSB8fCBudWxsO1xuICBjb25zdCBhZG1pbjIgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlIHx8IG51bGw7XG5cbiAgbGV0IGFkbWluUXVlcnkgPSBgV0hFUkUgYWRtaW4wX25hbWUgJHtjb3VudHJ5ID8gYD0gJyR7Y291bnRyeX0nYCA6ICdJUyBOT1QgTlVMTCd9YFxuICBhZG1pblF1ZXJ5ICs9ICFjb3VudHJ5ID8gYCBBTkQgYWRtaW4xX25hbWUgSVMgTlVMTGAgOiAgYEFORCBhZG1pbjJfbmFtZSBJUyBOT1QgTlVMTGBcblxuICBcbiAgLy8gY29uc3QgYWRtaW5RdWVyeSA9IGBcbiAgLy8gICBXSEVSRSBhZG1pbjBfbmFtZSAke2NvdW50cnkgPyBgPSAnJHtjb3VudHJ5fSdgIDogJ0lTIE5PVCBOVUxMJ31cbiAgLy8gICBBTkQgYWRtaW4xX25hbWUgJHthZG1pbjEgPyBgPSAnJHthZG1pbjF9J2AgOiAnSVMgTlVMTCd9XG4gIC8vICAgQU5EIGFkbWluMl9uYW1lICR7YWRtaW4yID8gYD0gJyR7YWRtaW4yfSdgIDogJ0lTIE5VTEwnfWBcbiAgXG4gIHJldHVybiBhd2FpdCBkYi5xdWVyeShgXG4gICAgV0lUSCBmaWx0ZXJlZF9hYyBBUyAoXG4gICAgICAgIFNFTEVDVCBcbiAgICAgICAgICAgIGFkbWluMF9uYW1lLFxuICAgICAgICAgICAgYWRtaW4xX25hbWUsXG4gICAgICAgICAgICBhZG1pbjJfbmFtZSxcbiAgICAgICAgICAgIFwiR2VuZGVyRXF1aXR5XzE5OTUuMjAxNVwiIEFTIGFjX2ZlbSxcbiAgICAgICAgICAgIFwiSUhNRV9lZHUueWVhcnNfMjAxNFwiIEFTIGFjX2VkdSxcbiAgICAgICAgICAgIFwiR0FTUF9wb29yMzY1XzIwMTdcIiBBUyBhY19wb3ZcbiAgICAgICAgRlJPTSB2dWxfYWMyXG4gICAgICAgICR7YWRtaW5RdWVyeX1cbiAgICApLFxuICAgIGZpbHRlcmVkX3BvcCBBUyAoXG4gICAgICAgIFNFTEVDVCBcbiAgICAgICAgICAgIGFkbWluMF9uYW1lLFxuICAgICAgICAgICAgYWRtaW4xX25hbWUsXG4gICAgICAgICAgICBhZG1pbjJfbmFtZSxcbiAgICAgICAgICAgIHRvdGFsX3BvcCxcbiAgICAgICAgICAgIHJ1cmFsX3BvcFxuICAgICAgICBGUk9NIHBvcHVsYXRpb25cbiAgICAgICAgJHthZG1pblF1ZXJ5fVxuICAgIClcbiAgICBcbiAgICBTRUxFQ1Qgdi4qLCBwLnRvdGFsX3BvcCwgcC5ydXJhbF9wb3BcbiAgICBGUk9NIGZpbHRlcmVkX2FjIHZcbiAgICBKT0lOIGZpbHRlcmVkX3BvcCBwXG4gICAgT04gdi5hZG1pbjBfbmFtZSA9IHAuYWRtaW4wX25hbWVcbiAgICBBTkQgKHYuYWRtaW4xX25hbWUgPSBwLmFkbWluMV9uYW1lIE9SICh2LmFkbWluMV9uYW1lIElTIE5VTEwgQU5EIHAuYWRtaW4xX25hbWUgSVMgTlVMTCkpXG4gICAgQU5EICh2LmFkbWluMl9uYW1lID0gcC5hZG1pbjJfbmFtZSBPUiAodi5hZG1pbjJfbmFtZSBJUyBOVUxMIEFORCBwLmFkbWluMl9uYW1lIElTIE5VTEwpKTtcbmApXG4gICAgICAvLyAke2FkbWluMSA/IGBBTkQgdi5hZG1pbjFfbmFtZSA9IHAuYWRtaW4xX25hbWVgOiAnJ31cbiAgICAvLyAke2FkbWluMiA/IGBBTkQgdi5hZG1pbjJfbmFtZSA9IHAuYWRtaW4xX25hbWVgOiAnJ31cbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTMzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgRHluYW1pYyBJbnNpZ2h0cyAtIEFkYXBhdGl2ZSBDYXBhY2l0aWVzXG4qaW5zaWdodHMgYW5kIGhlbHBlcnMqYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTM0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZGF0YSBhbmQgaW5zaWdodHMgZm9yXG5keW5hbWljSW5zaWdodHNfYWRhcHRpdmVDYXBhY2l0eSA9IHtcbiAgY29uc3QgZGF0YSA9IGRhdGFBZGFwdGl2ZUNhcGFjaXR5O1xuXG4gIC8vIGZvcm1hdCBmdW5jdGlvbnNcbiAgY29uc3QgX2Zvcm1hdE51bWJlciA9IGZvcm1hdE51bUNvbXBhY3RMb25nO1xuXG4gIC8vIHNvdXJjZSBkYXRhIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cblxuICBsZXQgZXhwb3J0RGF0YSA9IHtcbiAgICBhZG1pbjA6IGRhdGEsXG4gICAgYWRtaW4xOiB1bmRlZmluZWQsXG4gICAgYWRtaW4yOiB1bmRlZmluZWRcbiAgfTtcblxuICBpZiAoIU9iamVjdC52YWx1ZXMoYWRtaW5TZWxlY3Rpb25zKS5ldmVyeSgoZCkgPT4gZC52YWx1ZSA9PT0gbnVsbCkpIHtcbiAgICAvLyBzZWxlY3RlZCBhZG1pbjAgZGF0YVxuICAgIGNvbnN0IGZpbHRlcmVkRGF0YTAgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlXG4gICAgICA/IGRhdGEuZmlsdGVyKChkKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIGQuYWRtaW4wX25hbWUgPT09IChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlIHx8IGQuYWRtaW4wX25hbWUpXG4gICAgICAgICAgKTtcbiAgICAgICAgfSlcbiAgICAgIDogdW5kZWZpbmVkO1xuXG4gICAgLy8gc2VsZWN0ZWQgYWRtaW4xIGRhdGFcbiAgICBjb25zdCBmaWx0ZXJlZERhdGExID0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZVxuICAgICAgPyBkYXRhLmZpbHRlcigoZCkgPT4ge1xuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICBkLmFkbWluMF9uYW1lID09PSAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZSB8fCBkLmFkbWluMF9uYW1lKSAmJlxuICAgICAgICAgICAgZC5hZG1pbjFfbmFtZSA9PT0gKGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjEudmFsdWUgfHwgZC5hZG1pbjFfbmFtZSlcbiAgICAgICAgICApO1xuICAgICAgICB9KVxuICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICAvLyBzZWxlY3RlZCBhZG1pbjIgZGF0YVxuICAgIGNvbnN0IGZpbHRlcmVkRGF0YTIgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlXG4gICAgICA/IGRhdGEuZmlsdGVyKChkKSA9PiB7XG4gICAgICAgICAgcmV0dXJuIChcbiAgICAgICAgICAgIGQuYWRtaW4wX25hbWUgPT09IChhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlIHx8IGQuYWRtaW4wX25hbWUpICYmXG4gICAgICAgICAgICBkLmFkbWluMV9uYW1lID09PSAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZSB8fCBkLmFkbWluMV9uYW1lKSAmJlxuICAgICAgICAgICAgZC5hZG1pbjJfbmFtZSA9PT0gKGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjIudmFsdWUgfHwgZC5hZG1pbjJfbmFtZSlcbiAgICAgICAgICApO1xuICAgICAgICB9KVxuICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgICBleHBvcnREYXRhID0ge1xuICAgICAgYWRtaW4wOiBmaWx0ZXJlZERhdGEwLFxuICAgICAgYWRtaW4xOiBmaWx0ZXJlZERhdGExLFxuICAgICAgYWRtaW4yOiBmaWx0ZXJlZERhdGEyXG4gICAgfTtcbiAgfVxuXG4gIC8vIGluc2lnaHRzIGZyb20gc291cmNlIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgZnVuY3Rpb24gZmluZEFkbWluMkFDU3RhdHMoZGF0YSkge1xuICAgIC8vIGFkbWluMiBzdGF0c1xuICAgIC8vIC0gZmluZCB0aGUgY291bnRzIGZvciBlYWNoIEFDXG4gICAgLy8gLSBmaW5kIG1ham9yaXRpZXNcbiAgICAvLyAtIGZpbmQgcmVnaW9ucyB0aGF0IGhhdmUgYWxsIGFuZCBub25lIGZvciBiaW5hcnkgQUNzXG4gICAgcmV0dXJuIFQudGlkeShcbiAgICAgIGRhdGEsXG4gICAgICBULm11dGF0ZSh7XG4gICAgICAgIGFjX2VkdV9wb3A6IChkKSA9PiAoZC5hY19lZHUgPT09IG51bGwgPyBudWxsIDogZC5hY19lZHUgKiBkLnRvdGFsX3BvcCksXG4gICAgICAgIGFjX2ZlbV9wb3A6IChkKSA9PiAoZC5hY19mZW0gPT09IG51bGwgPyBudWxsIDogZC5hY19mZW0gKiBkLnRvdGFsX3BvcCksXG4gICAgICAgIGFjX3Bvdl9wb3A6IChkKSA9PiAoZC5hY19wb3YgPT09IG51bGwgPyBudWxsIDogZC5hY19wb3YgKiBkLnRvdGFsX3BvcClcbiAgICAgIH0pLFxuICAgICAgVC5zdW1tYXJpemUoe1xuICAgICAgICB0b3RhbF9wb3A6IFQuc3VtKFwidG90YWxfcG9wXCIpLFxuICAgICAgICBhY19lZHVfcG9wOiBULnN1bShcImFjX2VkdV9wb3BcIiksXG4gICAgICAgIGFjX2ZlbV9wb3A6IFQuc3VtKFwiYWNfZmVtX3BvcFwiKSxcbiAgICAgICAgYWNfcG92X3BvcDogVC5zdW0oXCJhY19wb3ZfcG9wXCIpXG4gICAgICB9KSxcbiAgICAgIFQubXV0YXRlKHtcbiAgICAgICAgYWNfZWR1X21hajogKGQpID0+IGQuYWNfZWR1X3BvcCA+ICgwLjUgKiBkLnRvdGFsX3BvcCksXG4gICAgICAgIGFjX2ZlbV9tYWo6IChkKSA9PiBkLmFjX2ZlbV9wb3AgPiAoMC41ICogZC50b3RhbF9wb3ApLFxuICAgICAgICBhY19wb3ZfbWFqOiAoZCkgPT4gZC5hY19wb3ZfcG9wID4gKDAuNSAqIGQudG90YWxfcG9wKSxcbiAgICAgIH0pLFxuICAgICAgVC5tdXRhdGUoe1xuICAgICAgICBhY19lZHVfcGVyYzogKGQpID0+IGQuYWNfZWR1X3BvcCAvIGQudG90YWxfcG9wLFxuICAgICAgICBhY19mZW1fcGVyYzogKGQpID0+IGQuYWNfZmVtX3BvcCAvIGQudG90YWxfcG9wLFxuICAgICAgICBhY19wb3ZfcGVyYzogKGQpID0+IGQuYWNfcG92X3BvcCAvIGQudG90YWxfcG9wLFxuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgY29uc3QgaW5zaWdodHMwID0gZXhwb3J0RGF0YS5hZG1pbjBcbiAgICA/IGZpbmRBZG1pbjJBQ1N0YXRzKGV4cG9ydERhdGEuYWRtaW4wKVxuICAgIDogbnVsbDtcbiAgY29uc3QgaW5zaWdodHMxID0gZXhwb3J0RGF0YS5hZG1pbjFcbiAgICA/IGZpbmRBZG1pbjJBQ1N0YXRzKGV4cG9ydERhdGEuYWRtaW4xKVxuICAgIDogbnVsbDtcbiAgY29uc3QgaW5zaWdodHMyID0gZXhwb3J0RGF0YS5hZG1pbjJcbiAgICA/IGZpbmRBZG1pbjJBQ1N0YXRzKGV4cG9ydERhdGEuYWRtaW4yKVxuICAgIDogbnVsbDtcblxuICBjb25zdCBpbnNpZ2h0cyA9IHtcbiAgICBhZG1pbjA6IGluc2lnaHRzMD8uWzBdLFxuICAgIGFkbWluMTogaW5zaWdodHMxPy5bMF0sXG4gICAgYWRtaW4yOiBpbnNpZ2h0czI/LlswXVxuICB9O1xuXG4gIC8vIGFkbWluIHNlbGVjdGlvbiB0b3RhbCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgLy8gLSBzdW0gdGhlIGFkbWluMiBwb3B1bGF0aW9uIHZhbHVlcyBmb3IgZ2l2ZW4gYWRtaW4gc2VsZWN0aW9uXG4gIGZ1bmN0aW9uIHN1bVBvcHVsYXRpb25zKGRhdGEpIHtcbiAgICByZXR1cm4gVC50aWR5KFxuICAgICAgZGF0YSxcbiAgICAgIFQuc3VtbWFyaXplKHtcbiAgICAgICAgdG90YWxfcG9wOiBULnN1bShcInRvdGFsX3BvcFwiKSxcbiAgICAgICAgcnVyYWxfcG9wOiBULnN1bShcInJ1cmFsX3BvcFwiKVxuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgLy8gZ2V0IHRvdGFsIGJhc2VkIG9uIGFkbWluIHNlbGVjdGlvblxuICAvLyBvdmVyd3JpdGUgdG90YWwgaWYgbW9yZSBncmFudWxhciBkYXRhIGlzIG5vbi1udWxsXG4gIGxldCB0b3RhbFBvcHVsYXRpb25zO1xuICB0b3RhbFBvcHVsYXRpb25zID0gZXhwb3J0RGF0YS5hZG1pbjBcbiAgICA/IHN1bVBvcHVsYXRpb25zKGV4cG9ydERhdGEuYWRtaW4wKVxuICAgIDogdG90YWxQb3B1bGF0aW9ucztcbiAgdG90YWxQb3B1bGF0aW9ucyA9IGV4cG9ydERhdGEuYWRtaW4xXG4gICAgPyBzdW1Qb3B1bGF0aW9ucyhleHBvcnREYXRhLmFkbWluMSlcbiAgICA6IHRvdGFsUG9wdWxhdGlvbnM7XG4gIHRvdGFsUG9wdWxhdGlvbnMgPSBleHBvcnREYXRhLmFkbWluMlxuICAgID8gc3VtUG9wdWxhdGlvbnMoZXhwb3J0RGF0YS5hZG1pbjIpXG4gICAgOiB0b3RhbFBvcHVsYXRpb25zO1xuICB0b3RhbFBvcHVsYXRpb25zID0gdG90YWxQb3B1bGF0aW9ucz8uWzBdO1xuICB0b3RhbFBvcHVsYXRpb25zW1widG90YWxfcG9wX2Zvcm1hdFwiXSA9IF9mb3JtYXROdW1iZXIoXG4gICAgdG90YWxQb3B1bGF0aW9uc1tcInRvdGFsX3BvcFwiXVxuICApO1xuICB0b3RhbFBvcHVsYXRpb25zW1wicnVyYWxfcG9wX2Zvcm1hdFwiXSA9IF9mb3JtYXROdW1iZXIoXG4gICAgdG90YWxQb3B1bGF0aW9uc1tcInJ1cmFsX3BvcFwiXVxuICApO1xuXG4gIC8vIGFsbC9ub25lIGFkbWluMidzIHdpdGhpbiBhZG1pbjAgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIC8vIHRoZSBhZG1pbjIncyB3aXRoaW4gdGhlIHNlbGVjdGVkIGFkbWluMCB0aGF0IGFyZSBhbGwvbm9uZSBBQ1xuICBmdW5jdGlvbiBmaW5kQWRtaW4yQUNTdGF0c0FkbWluMChkYXRhKSB7XG4gICAgLy8gYWRtaW4yIHN0YXRzXG4gICAgLy8gLSBmaW5kIHJlZ2lvbnMgdGhhdCBoYXZlIGFsbCBhbmQgbm9uZSBmb3IgYmluYXJ5IEFDc1xuICAgIHJldHVybiBULnRpZHkoXG4gICAgICBkYXRhLFxuICAgICAgLy8gYWxsIG9yIG5vbmUgb2YgQUNzXG4gICAgICBULm11dGF0ZSh7XG4gICAgICAgIGFkbWluMF9hY19hbGw6IChkKSA9PlxuICAgICAgICAgIC8vIGluY2x1ZGUgYWxsIGFkbWluMidzIGlmIHNob3dpbmcgYWxsIHJlZ2lvbnNcbiAgICAgICAgICAoYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZVxuICAgICAgICAgICAgPyBkLmFkbWluMF9uYW1lID09IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWVcbiAgICAgICAgICAgIDogdHJ1ZSkgJiZcbiAgICAgICAgICBkLmFjX2VkdSA+IDAuNSAmJlxuICAgICAgICAgIGQuYWNfZmVtID4gMC41ICYmXG4gICAgICAgICAgZC5hY19wb3YgPD0gMC41LCAvLyByZXZlcnNlZFxuICAgICAgICBhZG1pbjBfYWNfbm9uZTogKGQpID0+XG4gICAgICAgICAgKGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWVcbiAgICAgICAgICAgID8gZC5hZG1pbjBfbmFtZSA9PSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlXG4gICAgICAgICAgICA6IHRydWUpICYmXG4gICAgICAgICAgZC5hY19lZHUgPD0gMC41ICYmXG4gICAgICAgICAgZC5hY19mZW0gPD0gMC41ICYmXG4gICAgICAgICAgZC5hY19wb3YgPiAwLjUgXG4gICAgICB9KSxcbiAgICAgIFQuc3VtbWFyaXplKHtcbiAgICAgICAgYWRtaW4yX2NvdW50OiBULm4oKSxcbiAgICAgICAgYWRtaW4wX2FjX2FsbF9jb3VudDogVC5zdW0oXCJhZG1pbjBfYWNfYWxsXCIpLFxuICAgICAgICBhZG1pbjBfYWNfbm9uZV9jb3VudDogVC5zdW0oXCJhZG1pbjBfYWNfbm9uZVwiKVxuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgY29uc3QgZXh0cmVtZUFDMlN0YXRzID0gZmluZEFkbWluMkFDU3RhdHNBZG1pbjAoZXhwb3J0RGF0YS5hZG1pbjApPy5bMF07XG5cbiAgcmV0dXJuIHtcbiAgICBkYXRhOiBleHBvcnREYXRhLFxuICAgIGluc2lnaHRzOiBpbnNpZ2h0cyxcbiAgICBwb3B1bGF0aW9uX3N1bXM6IHRvdGFsUG9wdWxhdGlvbnMsXG4gICAgYWRtaW4wTGV2ZWxBMkFsbE5vbmU6IGV4dHJlbWVBQzJTdGF0c1xuICB9O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMzUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAjIyMjIEhlbHBlcnNgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xMzYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBkZWZpbmUgdGhlIG1hZCBsaWIgZm9yIGFkYXB0aXZlIGNhcGFjaXR5IGFkbWluMSBhbmQgYWRtaW4gMCBsZXZlbHNcbmZ1bmN0aW9uIGFkYXB0aXZlQ2FwYWNpdHlJbnNpZ2h0TWFkTGliKGRhdGEsIGFkbWluTmFtZSkge1xuICBjb25zdCBtYWRMaWIgPSBMYW5nLnJlZHVjZVJlcGxhY2VUZW1wbGF0ZUl0ZW1zKFxuICAgIF9sYW5nKG5iVGV4dC5hZGFwdGl2ZUNhcGFjaXRpZXMuaW5zaWdodHMubWFkTGliKSxcbiAgICBbXG4gICAgICB7IG5hbWU6IFwiYWRtaW5cIiwgdmFsdWU6IGFkbWluTmFtZSB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiBcImluZGV4X2VkdVwiLFxuICAgICAgICB2YWx1ZTogZm9ybWF0UGVyY2VudE5vU3ltYm9sKHRyYW5zZm9ybVBlcmNlbnQoZGF0YT8uYWNfZWR1X3BlcmMpKSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6IFwiaW5kZXhfZmVtXCIsXG4gICAgICAgIHZhbHVlOiBmb3JtYXRQZXJjZW50Tm9TeW1ib2wodHJhbnNmb3JtUGVyY2VudChkYXRhPy5hY19mZW1fcGVyYykpLFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogXCJpbmRleF9wb3ZcIixcbiAgICAgICAgdmFsdWU6IGZvcm1hdFBlcmNlbnROb1N5bWJvbCh0cmFuc2Zvcm1QZXJjZW50KGRhdGE/LmFjX3Bvdl9wZXJjKSksXG4gICAgICB9LFxuICAgIF0sXG4gICk7XG5cbiAgcmV0dXJuIGAke21hZExpYn1gO1xufVxuXG4vLyAvLyBkZWZpbmUgdGhlIG1hZCBsaWIgZm9yIGFkYXB0aXZlIGNhcGFjaXR5IGFkbWluMSBhbmQgYWRtaW4gMCBsZXZlbHNcbi8vIGZ1bmN0aW9uIGFkYXB0aXZlQ2FwYWNpdHlJbnNpZ2h0TWFkTGliKGRhdGEsIGFkbWluTmFtZSkge1xuXG4vLyAgIHJldHVybiBgSW4gKioke2FkbWluTmFtZX0qKiwgdGhlIGVkdWNhdGlvbiBpbmRleCBpcyAqKiR7Zm9ybWF0UGVyY2VudE5vU3ltYm9sKHRyYW5zZm9ybVBlcmNlbnQoZGF0YT8uYWNfZWR1X3BlcmMpKX0qKiwgdGhlIGZlbWFsZSBlbXBvd2VybWVudCBpbmRleCBpcyAqKiR7Zm9ybWF0UGVyY2VudE5vU3ltYm9sKHRyYW5zZm9ybVBlcmNlbnQoZGF0YT8uYWNfZmVtX3BlcmMpKX0qKiwgYW5kIHRoZSBwb3ZlcnR5IGluZGV4IGlzICoqJHtmb3JtYXRQZXJjZW50Tm9TeW1ib2wodHJhbnNmb3JtUGVyY2VudChkYXRhPy5hY19wb3ZfcGVyYykpfSoqLmBcbi8vIH1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTM3IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZGVmaW5lIHRoZSBtYWQgbGliIGZvciBhZGFwdGl2ZSBjYXBhY2l0eSBhZG1pbjEgYW5kIGFkbWluIDAgbGV2ZWxzXG5mdW5jdGlvbiBhZGFwdGl2ZUNhcGFjaXR5SW5zaWdodE1hZExpYjIoZGF0YSwgYWRtaW5OYW1lKSB7XG4gIGNvbnN0IGVkdWNhdGlvbl95ZWFycyA9IGRhdGE/LmFjX2VkdV9wZXJjLnRvRml4ZWQoMik7XG4gIGNvbnN0IGZlbWFsZV9lbXBvd2VybWVudCA9IChkYXRhPy5hY19mZW1fcGVyYyAqIDEwMCkudG9GaXhlZCgwKTsgLy9mb3JtYXRQZXJjZW50V2hvbGUoZGF0YT8uYWNfZmVtX3BlcmMpXG4gIGNvbnN0IHBvdmVydHlfcmF0ZSA9IGZvcm1hdFBlcmNlbnRXaG9sZShkYXRhPy5hY19wb3ZfcGVyYyk7XG5cbiAgcmV0dXJuIGBJbiAqKiR7YWRtaW5OYW1lfSoqLCB0aGUgYXZlcmFnZSBlZHVjYXRpb25hbCBhdHRhaW5tZW50IGlzICoqJHtlZHVjYXRpb25feWVhcnN9KiogeWVhcnMsIHRoZSBmZW1hbGUgZW1wb3dlcm1lbnQgaW5kZXggaXMgKioke2ZlbWFsZV9lbXBvd2VybWVudH0qKiwgYW5kICoqJHtwb3ZlcnR5X3JhdGV9KiogbGl2ZSBpbiBwb3ZlcnR5LmA7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTEzOCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InRleHREeW5hbWljSW5zaWdodHNfYWRhcHRpdmVDYXBhY2l0aWVzMSA9IHtcbiAgLy8gcmV0dXJuIG1kYFRPRE86IGJhc2VkIG9uIGljaWNsZSBkYXRhYFxuXG4gIC8vIGR5bmFtaWMgaW5zaWdodCBiYXNlZCBvbiBzZWxlY3RlZCByZWdpb25cblxuICBjb25zdCBhZG1pbjIgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlO1xuICBjb25zdCBhZG1pbjJNYWRMaWIgPSBhZGFwdGl2ZUNhcGFjaXR5SW5zaWdodE1hZExpYihcbiAgICBkeW5hbWljSW5zaWdodHNfYWRhcHRpdmVDYXBhY2l0eS5pbnNpZ2h0cy5hZG1pbjIsXG4gICAgYWRtaW4yXG4gICk7XG4gIGNvbnN0IGFkbWluMSA9IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjEudmFsdWU7XG4gIGNvbnN0IGFkbWluMU1hZExpYiA9IGFkYXB0aXZlQ2FwYWNpdHlJbnNpZ2h0TWFkTGliKFxuICAgIGR5bmFtaWNJbnNpZ2h0c19hZGFwdGl2ZUNhcGFjaXR5Lmluc2lnaHRzLmFkbWluMSxcbiAgICBhZG1pbjFcbiAgKTtcbiAgY29uc3QgYWRtaW4wID0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC5sYWJlbCA/PyBnbG9iYWxTZWxlY3Rpb24ubGFiZWw7XG4gIGNvbnN0IGFkbWluMEluc2lnaHRzID0gZHluYW1pY0luc2lnaHRzX2FkYXB0aXZlQ2FwYWNpdHkuaW5zaWdodHMuYWRtaW4wO1xuICBjb25zdCBhZG1pbjBNYWRMaWIgPSBhZGFwdGl2ZUNhcGFjaXR5SW5zaWdodE1hZExpYihcbiAgICBhZG1pbjBJbnNpZ2h0cyxcbiAgICBhZG1pbjBcbiAgKTtcblxuICBjb25zdCBsYW5nV2l0aGluQWRtaW4xID0gTGFuZy5yZWR1Y2VSZXBsYWNlVGVtcGxhdGVJdGVtcyhcbiAgICBfbGFuZyhuYlRleHQuYWRhcHRpdmVDYXBhY2l0aWVzLmluc2lnaHRzLm5lc3RlZExvY2F0aW9uQmx1cmIpLFxuICAgIFtcbiAgICAgIHsgbmFtZTogXCJhZG1pbl9pbm5lclwiLCB2YWx1ZTogYWRtaW4yIH0sXG4gICAgICB7IG5hbWU6IFwiYWRtaW5fb3V0ZXJcIiwgdmFsdWU6IGFkbWluMSB9XG4gICAgXVxuICApO1xuICBjb25zdCB3aXRoaW5BZG1pbjEgPSBhZG1pbjJcbiAgICA/IGAke2xhbmdXaXRoaW5BZG1pbjF9YFxuICAgIDogYGA7XG5cbiAgY29uc3QgbGFuZ1dpdGhpbkFkbWluMCA9IExhbmcucmVkdWNlUmVwbGFjZVRlbXBsYXRlSXRlbXMoXG4gICAgX2xhbmcobmJUZXh0LmFkYXB0aXZlQ2FwYWNpdGllcy5pbnNpZ2h0cy5uZXN0ZWRMb2NhdGlvbkJsdXJiKSxcbiAgICBbXG4gICAgICB7IG5hbWU6IFwiYWRtaW5faW5uZXJcIiwgdmFsdWU6IGFkbWluMSB9LFxuICAgICAgeyBuYW1lOiBcImFkbWluX291dGVyXCIsIHZhbHVlOiBhZG1pbjAgfVxuICAgIF1cbiAgKTtcbiAgY29uc3Qgd2l0aGluQWRtaW4wID0gYWRtaW4xXG4gICAgPyBgJHtsYW5nV2l0aGluQWRtaW4wfWBcbiAgICA6IGBgO1xuXG4gIC8vIFRleHQgc2VjdGlvbnMgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIGNvbnN0IGFkbWluMlRleHQgPSBtZGAke2FkbWluMk1hZExpYn1gO1xuXG4gIGNvbnN0IGFkbWluMVRleHQgPSBtZGAke3dpdGhpbkFkbWluMX0gJHthZG1pbjFNYWRMaWJ9YDtcblxuICBjb25zdCBhZG1pbjBUZXh0ID0gbWRgJHt3aXRoaW5BZG1pbjB9ICR7YWRtaW4wTWFkTGlifWA7XG5cbiAgLy8gRmluYWwgdGV4dCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgcmV0dXJuIG1kYFxuIyMjIyBPbGQgSW5zaWdodDpcbiR7YWRtaW4yID8gYWRtaW4yVGV4dCA6IFwiXCJ9XG4ke2FkbWluMSA/IGFkbWluMVRleHQgOiBcIlwifVxuJHthZG1pbjBJbnNpZ2h0cyA/IGFkbWluMFRleHQgOiBcIlwifVxuYDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTM5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgQWRhcHRpdmUgQ2FwYWNpdHkgSWNpY2xlIC0gQWRhcHRpdmUgQ2FwYWNpdGllc1xuTm90ZTogZGF0YSB1c2VzIFNTQSBmb3IgY29tYmluZWQgYWRtaW4gcmVnaW9uIChzZWUgaWNpY2xlX2NzdilgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNDAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpY2ljbGVfcmF3ID0ge1xuICBjb25zdCBjb3VudHJ5ID0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZSB8fCBcIlNTQVwiO1xuICBjb25zdCBhZG1pbjEgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlIHx8IG51bGw7XG4gIGNvbnN0IGFkbWluMiA9IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjIudmFsdWUgfHwgbnVsbDtcbiAgXG4gIGxldCBhZG1pblF1ZXJ5ID0gYFdIRVJFIGFkbWluMF9uYW1lID0gJyR7Y291bnRyeX0nIEFORCBhZG1pbjFfbmFtZWBcbiAgYWRtaW5RdWVyeSArPSAhYWRtaW4xID8gYCBJUyBOVUxMYCA6IGAgPSAnJHtjbGVhbkFkbWluSW5wdXRfU1FMKGFkbWluMSl9J2BcbiAgYWRtaW5RdWVyeSArPSBgIEFORCBhZG1pbjJfbmFtZWBcbiAgYWRtaW5RdWVyeSArPSAhYWRtaW4yID8gYCBJUyBOVUxMYCA6IGAgPSAnJHtjbGVhbkFkbWluSW5wdXRfU1FMKGFkbWluMil9J2BcbiAgLy8gbGV0IGFkbWluUXVlcnkgPSBgV0hFUkUgYWRtaW4wX25hbWUgPSAnQW5nb2xhJyBBTkQgYWRtaW4xX25hbWUgSVMgTlVMTGBcbiAgLy8gcmV0dXJuIGFkbWluUXVlcnlcbiAgcmV0dXJuIGRiLnF1ZXJ5KGBTRUxFQ1QgcGF0aCwgdmFsdWUgRlJPTSBpY2ljbGVfZGF0YSAke2FkbWluUXVlcnl9YClcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaWNpY2xlX2RhdGEgPSBidWlsZEhpZXJhcmNoeShpY2ljbGVfcmF3KTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaWNpY2xlX2tleXMgPSBuZXcgT2JqZWN0KHtcbiAgcG92ZXJ0eToge1xuICAgIHBvdmVydHkwOiBbXCJMb3cgUG92ZXJ0eVwiXSxcbiAgICBwb3ZlcnR5MTogW1wiTW9kZXJhdGUgUG92ZXJ0eVwiXSxcbiAgICBwb3ZlcnR5MTogW1wiSGlnaCBQb3ZlcnR5XCJdLFxuICB9LFxuICBlZHVjYXRpb246IHtcbiAgICBlZHVjYXRpb24wOiBbXCIwLTEgWWVhcnMgb2YgRWR1Y2F0aW9uXCJdLFxuICAgIGVkdWNhdGlvbjE6IFtcIjEtNSBZZWFycyBvZiBFZHVjYXRpb25cIl0sXG4gICAgZWR1Y2F0aW9uMzogW1wiNSsgWWVhcnMgb2YgRWR1Y2F0aW9uXCJdLFxuICB9LFxuICBnZW5kZXI6IHtcbiAgICBnZW5kZXIwOiBbXCJMb3cgRmVtYWxlIEVtcG93ZXJtZW50XCJdLFxuICAgIGdlbmRlcjE6IFtcIk1vZGVyYXRlIEZlbWFsZSBFbXBvd2VybWVudFwiXSxcbiAgICBnZW5kZXIyOiBbXCJIaWdoIEZlbWFsZSBFbXBvd2VybWVudFwiXSxcbiAgfSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNDMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpY2ljbGVfYWxpYXMgPSB7XG4gIGNvbnN0IGJhc2UgPSBuYlRleHQuYWRhcHRpdmVDYXBhY2l0aWVzLmRlbHZpbmdEZWVwZXIucGxvdC5uYW1lTWFwXG4gIGNvbnN0IG5hbWVNYXAgPSB7XG4gICAgcG9wdWxhdGlvbjogX2xhbmcoYmFzZS5wb3B1bGF0aW9uKSxcbiAgICBwb3ZlcnR5MDogX2xhbmcoYmFzZS5wb3ZlcnR5MCksXG4gICAgcG92ZXJ0eTE6IF9sYW5nKGJhc2UucG92ZXJ0eTEpLFxuICAgIHBvdmVydHkyOiBfbGFuZyhiYXNlLnBvdmVydHkyKSxcbiAgICBlZHVjYXRpb24wOiBfbGFuZyhiYXNlLmVkdWNhdGlvbjApLFxuICAgIGVkdWNhdGlvbjE6IF9sYW5nKGJhc2UuZWR1Y2F0aW9uMSksXG4gICAgZWR1Y2F0aW9uMjogX2xhbmcoYmFzZS5lZHVjYXRpb24yKSxcbiAgICBnZW5kZXIwOiBfbGFuZyhiYXNlLmdlbmRlcjApLFxuICAgIGdlbmRlcjE6IF9sYW5nKGJhc2UuZ2VuZGVyMSksXG4gICAgZ2VuZGVyMjogX2xhbmcoYmFzZS5nZW5kZXIyKVxuICB9O1xuICByZXR1cm4gbmFtZU1hcDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQ0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoicGFydGl0aW9uID0gKGRhdGEpID0+XG4gIGQzXG4gICAgLnBhcnRpdGlvbigpXG4gICAgLnBhZGRpbmcoMSlcbiAgICAuc2l6ZShuYXJyb3cgPyBbaGVpZ2h0LCB3aWR0aF0gOiBbd2lkdGgsIGhlaWdodF0pKFxuICAgIGQzXG4gICAgICAuaGllcmFyY2h5KGRhdGEpXG4gICAgICAuc3VtKChkKSA9PiBkLnZhbHVlKVxuICAgICAgLnNvcnQoKGEsIGIpID0+IGIudmFsdWUgLSBhLnZhbHVlKSxcbiAgKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQ1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaWNpY2xlX2NvbG9yID0gZDNcbiAgLnNjYWxlT3JkaW5hbCgpXG4gIC5kb21haW4oW1xuICAgIFwicG9wdWxhdGlvblwiLFxuICAgIFwicG92ZXJ0eTJcIixcbiAgICBcInBvdmVydHkxXCIsXG4gICAgXCJwb3ZlcnR5MFwiLFxuICAgIFwiZWR1Y2F0aW9uMlwiLFxuICAgIFwiZWR1Y2F0aW9uMVwiLFxuICAgIFwiZWR1Y2F0aW9uMFwiLFxuICAgIFwiZ2VuZGVyMlwiLFxuICAgIFwiZ2VuZGVyMVwiLFxuICAgIFwiZ2VuZGVyMFwiLFxuICBdKVxuICAucmFuZ2UoW1xuICAgIFwiI2E0YTRhNFwiLFxuICAgIFwiI2VjNWE0N1wiLFxuICAgIFwiI2ZjOGEzNFwiLFxuICAgIFwiI2Y0YmIyMVwiLFxuICAgIFwiI2Y0YmIyMVwiLFxuICAgIFwiI2ZjOGEzNFwiLFxuICAgIFwiI2VjNWE0N1wiLFxuICAgIFwiI2Y0YmIyMVwiLFxuICAgIFwiI2ZjOGEzNFwiLFxuICAgIFwiI2VjNWE0N1wiLFxuICBdKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQ2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidGFyZ2V0SGVpZ2h0ID0gMzUwO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNDciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJuYXJyb3dIZWlnaHQgPSA2MDA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE0OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImhlaWdodCA9IG5hcnJvdyA/IG5hcnJvd0hlaWdodCA6IHRhcmdldEhlaWdodDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTQ5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibmFycm93ID0gd2lkdGggPD0gMDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic2VnbWVudFggPSAoZCkgPT4gKG5hcnJvdyA/IGQueTAgOiBkLngwKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic2VnbWVudFkgPSAoZCkgPT4gKG5hcnJvdyA/IGQueDAgOiBkLnkwKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic2VnbWVudFdpZHRoID0gKGQpID0+IChuYXJyb3cgPyBkLnkxIC0gZC55MCA6IGQueDEgLSBkLngwKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTUzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoic2VnbWVudEhlaWdodCA9IChkKSA9PiAobmFycm93ID8gZC54MSAtIGQueDAgOiBkLnkxIC0gZC55MCk7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE1NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGJ1aWxkSGllcmFyY2h5KGNzdikge1xuICAvLyBIZWxwZXIgZnVuY3Rpb24gdGhhdCB0cmFuc2Zvcm1zIHRoZSBnaXZlbiBDU1YgaW50byBhIGhpZXJhcmNoaWNhbCBmb3JtYXQuXG4gIGNvbnN0IHJvb3QgPSB7IG5hbWU6IFwicm9vdFwiLCBjaGlsZHJlbjogW10gfTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBjc3YubGVuZ3RoOyBpKyspIHtcbiAgICBjb25zdCBzZXF1ZW5jZSA9IGNzdltpXVtcInBhdGhcIl07XG4gICAgY29uc3Qgc2l6ZSA9ICtjc3ZbaV1bXCJ2YWx1ZVwiXTtcbiAgICBpZiAoaXNOYU4oc2l6ZSkpIHtcbiAgICAgIC8vIGUuZy4gaWYgdGhpcyBpcyBhIGhlYWRlciByb3dcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBjb25zdCBwYXJ0cyA9IHNlcXVlbmNlLnNwbGl0KFwiX1wiKTtcbiAgICBsZXQgY3VycmVudE5vZGUgPSByb290O1xuICAgIGZvciAobGV0IGogPSAwOyBqIDwgcGFydHMubGVuZ3RoOyBqKyspIHtcbiAgICAgIGNvbnN0IGNoaWxkcmVuID0gY3VycmVudE5vZGVbXCJjaGlsZHJlblwiXTtcbiAgICAgIGNvbnN0IG5vZGVOYW1lID0gcGFydHNbal07XG4gICAgICBsZXQgY2hpbGROb2RlID0gbnVsbDtcbiAgICAgIGxldCBmb3VuZENoaWxkID0gZmFsc2U7XG4gICAgICAvLyBTZWFyY2ggZm9yIGV4aXN0aW5nIGNoaWxkIHdpdGggdGhlIHNhbWUgbmFtZVxuICAgICAgZm9yIChsZXQgayA9IDA7IGsgPCBjaGlsZHJlbi5sZW5ndGg7IGsrKykge1xuICAgICAgICBpZiAoY2hpbGRyZW5ba11bXCJuYW1lXCJdID09PSBub2RlTmFtZSkge1xuICAgICAgICAgIGNoaWxkTm9kZSA9IGNoaWxkcmVuW2tdO1xuICAgICAgICAgIGZvdW5kQ2hpbGQgPSB0cnVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICAvLyBJZiBub3QgZm91bmQsIGNyZWF0ZSBhIG5ldyBjaGlsZCBub2RlXG4gICAgICBpZiAoIWZvdW5kQ2hpbGQpIHtcbiAgICAgICAgY2hpbGROb2RlID0geyBuYW1lOiBub2RlTmFtZSwgY2hpbGRyZW46IFtdIH07XG4gICAgICAgIGNoaWxkcmVuLnB1c2goY2hpbGROb2RlKTtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnROb2RlID0gY2hpbGROb2RlO1xuICAgICAgLy8gSWYgaXQncyB0aGUgbGFzdCBwYXJ0IG9mIHRoZSBzZXF1ZW5jZSwgY3JlYXRlIGEgbGVhZiBub2RlXG4gICAgICBpZiAoaiA9PT0gcGFydHMubGVuZ3RoIC0gMSkge1xuICAgICAgICBjaGlsZE5vZGUudmFsdWUgPSBzaXplO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gcm9vdDtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTU1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYnJlYWRjcnVtYldpZHRoID0gMjAwO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNTYiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJicmVhZGNydW1iSGVpZ2h0ID0gMzU7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE1NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIEdlbmVyYXRlIGEgc3RyaW5nIHRoYXQgZGVzY3JpYmVzIHRoZSBwb2ludHMgb2YgYSBicmVhZGNydW1iIFNWRyBwb2x5Z29uLlxuZnVuY3Rpb24gYnJlYWRjcnVtYlBvaW50cyhkLCBpKSB7XG4gIGNvbnN0IHRpcFdpZHRoID0gMTA7XG4gIGNvbnN0IHBvaW50cyA9IFtdO1xuICBwb2ludHMucHVzaChcIjAsMFwiKTtcbiAgcG9pbnRzLnB1c2goYCR7YnJlYWRjcnVtYldpZHRofSwwYCk7XG4gIHBvaW50cy5wdXNoKGAke2JyZWFkY3J1bWJXaWR0aCArIHRpcFdpZHRofSwke2JyZWFkY3J1bWJIZWlnaHQgLyAyfWApO1xuICBwb2ludHMucHVzaChgJHticmVhZGNydW1iV2lkdGh9LCR7YnJlYWRjcnVtYkhlaWdodH1gKTtcbiAgcG9pbnRzLnB1c2goYDAsJHticmVhZGNydW1iSGVpZ2h0fWApO1xuICBpZiAoaSA+IDApIHtcbiAgICAvLyBMZWZ0bW9zdCBicmVhZGNydW1iOyBkb24ndCBpbmNsdWRlIDZ0aCB2ZXJ0ZXguXG4gICAgcG9pbnRzLnB1c2goYCR7dGlwV2lkdGh9LCR7YnJlYWRjcnVtYkhlaWdodCAvIDJ9YCk7XG4gIH1cbiAgcmV0dXJuIHBvaW50cy5qb2luKFwiIFwiKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTU4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgVGhpcyBub3RlYm9vayByZXVzZXMgbXVjaCBvZiB0aGUgJ2J1aWxkSGllcmFyY2h5JyBmdW5jdGlvbiBmcm9tIHRoZSBvcmlnaW5hbCBbU2VxdWVuY2VzIHN1bmJ1cnN0XShodHRwczovL2dpc3QuZ2l0aHViLmNvbS9rZXJyeXJvZGRlbi83MDkwNDI2KSBnaXN0LCB3aGljaCB3YXMgcHVibGlzaGVkIHdpdGggdGhlIGZvbGxvd2luZyBbbGljZW5zZV0oaHR0cHM6Ly9naXN0LmdpdGh1Yi5jb20va2Vycnlyb2RkZW4vNzA5MDQyNiNmaWxlLWxpY2Vuc2UpOlxuXG4+IENvcHlyaWdodCAyMDEzIEdvb2dsZSBJbmMuIEFsbCBSaWdodHMgUmVzZXJ2ZWQuXG4+IFxuPiBMaWNlbnNlZCB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGUgXCJMaWNlbnNlXCIpO1xuPiB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlIHdpdGggdGhlIExpY2Vuc2UuXG4+IFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuPiBcbj4gICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4+IFxuPiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsIHNvZnR3YXJlXG4+IGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuIFwiQVMgSVNcIiBCQVNJUyxcbj4gV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuXG4+IFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmRcbj4gbGltaXRhdGlvbnMgdW5kZXIgdGhlIExpY2Vuc2UuYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTU5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyBEYXRhXG4qRGF0YSBzb3VyY2VzKlxuLSBEYXRhIGlzIGZyb20gbG9jYWwgZmlsZXMgZG93bmxvYWRlZCBmcm9tIFMzLCB1cGxvYWRlZCBhcyBhIGZpbGUgYXR0YWNobWVudHNcbi0gRGF0YSBpcyB0aGVuIHdyYXBwZWQgYXMgYSBkdWNrREIgZGF0YWJhc2UgdGFibGUgKHNlcGFyYXRlIHRhYmxlcyBmb3IgZWFjaCBwYXJxdWV0IGZpbGUpXG4tIFdlIGFyZSB1c2luZyBzb21lIHNpbXBsaWZpZWQgZGF0YSBzb3VyY2VzLCBzdWZmaXhlZCB3aXRoIHJlZHVjZWQucGFycXVldCBpbiB0aGUgUzMgYnVja2V0YDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTYwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgIyMjIFRhYnVsYXIgZGF0YVxuLSAqKmhhel9yaXNrX3ZvcF9pbnQqKjogcmlzayBkYXRhIHNob3dpbmcgZWZmZWN0IGhhemFyZHMgaGF2ZSBvbiBjcm9wcy4gSW50ZXJhY3Rpb25zIGFyZSBpbmRlcGVuZGVudC5cbiAgLSByaXNrX3Byb3RvdHlwZS9kYXRhL2hhemFyZF9yaXNrX3ZvcF9hYy9hbm51YWwvaGF6X3Jpc2tfdm9wX2ludF9hY19yZWR1Y2VkLnBhcnF1ZXQgIFxuLSAqKnBvcHVsYXRpb24qKjogcG9wdWxhdGlvbiBkYXRhIGJ5IGFkbWluIGxldmVsc1xuICAtIHBvcHVsYXRpb24vcG9wdWxhdGlvbl9sb25nLnBhcnF1ZXRcbi0gKip2b3BfaGEqKjogVmFsdWUgb2YgUHJvZHVjdGlvbiAoVm9QKSBhbmQgaGVjdGFyZSBkYXRhIChIYSkgZXhwb3N1cmVzIGJ5IGFkbWluIGxldmVsLiBObyBoYXphcmRzIGFwcGxpZWQuXG4gIC0gcmlza19wcm90b3R5cGUvZGF0YS9leHBvc3VyZS9leHBvc3VyZV9hZG1fc3VtLnBhcnF1ZXRcbi0gKip2dWxfYWMqKjogYWRhcHRpdmUgY2FwYWNpdHkgZGF0YSAodXBkYXRlKVxuICAtIHZ1bG5lcmFiaWxpdHkvdnVsbmVyYWJpbGl0eV9SYXdJbmRleF9hZG1pbkFMTC5wYXJxdWV0YDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTYxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZGIgPSB7XG4gZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSBcIndhaXRcIjtcbiBsZXQgZGIgPSBhd2FpdCBEdWNrREJDbGllbnQub2Yoe1xuICAgIGhhel9yaXNrX3ZvcF9pbnQ6IEZpbGVBdHRhY2htZW50KFwiaGF6X3Jpc2tfdm9wX2ludF9nemlwLnBhcnF1ZXRcIiksXG4gICAgcG9wdWxhdGlvbjogRmlsZUF0dGFjaG1lbnQoXCJwb3B1bGF0aW9uX2xvbmcucGFycXVldFwiKSxcbiAgICB2b3BfaGE6IEZpbGVBdHRhY2htZW50KFwiZXhwb3N1cmVfYWRtX3N1bV9zb3J0ZWQucGFycXVldFwiKSxcbiAgICB2dWxfYWM6IEZpbGVBdHRhY2htZW50KFwidnVsbmVyYWJpbGl0eV9SYXdJbmRleF9hZG1pbkFMTC5wYXJxdWV0XCIpLFxuICAgIHZ1bF9hYzI6IEZpbGVBdHRhY2htZW50KFwiQUNfYWRtaW5BTEwucGFycXVldFwiKSxcbiAgICBpY2ljbGVfZGF0YTogRmlsZUF0dGFjaG1lbnQoXCJBbGwtYWRtX3NzYV9pY2ljbGVfZGF0YV8zY2xhc3MucGFycXVldFwiKVxuICB9KTtcbiAgYXdhaXQgZGIucXVlcnkoYENSRUFURSBUQUJMRSB2b3AgQVMgU0VMRUNUICogRlJPTSB2b3BfaGEgV0hFUkUgXCJleHBvc3VyZVwiID0gJ3ZvcCdgKVxuICBhd2FpdCBkYi5xdWVyeShgQ1JFQVRFIFRBQkxFIGhhIEFTIFNFTEVDVCAqIEZST00gdm9wX2hhIFdIRVJFIFwiZXhwb3N1cmVcIiA9ICdoYSdgKVxuICBhd2FpdCBkYi5xdWVyeShgXG4gICAgICAgIENSRUFURSBUQUJMRSB2b3BfY3JvcCBBUyBcbiAgICAgICAgU0VMRUNUICogXG4gICAgICAgIEZST00gdm9wX2hhIFxuICAgICAgICBXSEVSRSBOT1QgKFxuICAgICAgICAgIGNyb3AgTElLRSAnY2F0dGxlXFxfJScgRVNDQVBFICdcXFxcJ1xuICAgICAgICAgIE9SIGNyb3AgTElLRSAnZ29hdHNcXF8lJyBFU0NBUEUgJ1xcXFwnXG4gICAgICAgICAgT1IgY3JvcCBMSUtFICdwaWdzXFxfJScgRVNDQVBFICdcXFxcJ1xuICAgICAgICAgIE9SIGNyb3AgTElLRSAncG91bHRyeVxcXyUnIEVTQ0FQRSAnXFxcXCdcbiAgICAgICAgICBPUiBjcm9wIExJS0UgJ3NoZWVwXFxfJScgRVNDQVBFICdcXFxcJ1xuICAgICAgICApXG4gICAgICAgIEFORCBjcm9wIE5PVCBMSUtFICd0b3RhbF8lJyBFU0NBUEUgJ1xcXFwnXG4gICAgICAgIEFORCBleHBvc3VyZSA9ICd2b3AnYClcbiAgYXdhaXQgZGIucXVlcnkoYFxuICAgICAgICBDUkVBVEUgVEFCTEUgdm9wX2FuaW1hbCBBU1xuICAgICAgICBTRUxFQ1QgKlxuICAgICAgICBGUk9NIHZvcF9oYVxuICAgICAgICBXSEVSRSAoXG4gICAgICAgICAgY3JvcCBMSUtFICdjYXR0bGVcXF8lJyBFU0NBUEUgJ1xcXFwnXG4gICAgICAgICAgT1IgY3JvcCBMSUtFICdnb2F0c1xcXyUnIEVTQ0FQRSAnXFxcXCdcbiAgICAgICAgICBPUiBjcm9wIExJS0UgJ3BpZ3NcXF8lJyBFU0NBUEUgJ1xcXFwnXG4gICAgICAgICAgT1IgY3JvcCBMSUtFICdwb3VsdHJ5XFxfJScgRVNDQVBFICdcXFxcJ1xuICAgICAgICAgIE9SIGNyb3AgTElLRSAnc2hlZXBcXF8lJyBFU0NBUEUgJ1xcXFwnXG4gICAgICAgIClcbiAgICAgICAgQU5EIGNyb3AgTk9UIExJS0UgJ3RvdGFsXyUnIEVTQ0FQRSAnXFxcXCcgLS0gcmVtb3ZlIHRvdGFsIGxpbmVzXG4gICAgICAgIEFORCBleHBvc3VyZSA9ICd2b3AnYClcbiAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSBcImRlZmF1bHRcIjtcbiAgcmV0dXJuIGRiXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYCMjIyBHZW9ncmFwaGljIGRhdGFcbkdlbyBmaWxlcyB3ZXJlIGNvbnZlcnRlZCB0byBUb3BvSlNPTiBhbmQgcmVkdWNlZCBpbiBjb21wbGV4aXR5IGJlZm9yZSB1cGxvYWRpbmcgdG8gdGhlIG5vdGVib29rLCBzZWUgW1NpbXBsaWZ5IGxhcmdlIHNwYXRpYWwgZmlsZXNdKGh0dHBzOi8vb2JzZXJ2YWJsZWhxLmNvbS9kLzI1OGM2OGVlOTY5ZThlZDU/Y29sbGVjdGlvbj1AcGVyaXNjb3BpYy9hYi1hdGxhcykgbm90ZWJvb2sgZm9yIG1ldGhvZC5cbi0gKiphZG1pbjAqKjogYnJvYWRlc3QgbGV2ZWwsIGNvdW50cnkgYm91bmRhcmllc1xuICAtIGJvdW5kYXJpZXMvYXRsYXMtcmVnaW9uX2FkbWluMF9oYXJtb25pemVkLmdlb2pzb25cbi0gKiphZG1pbjEqKjogb25lIGxldmVsIGRvd24gZnJvbSBhZG1pbjAsIHJlZ2lvbnMgd2l0aGluIGVhY2ggYWRtaW4wIHJlZ2lvblxuICAtIGJvdW5kYXJpZXMvYXRsYXMtcmVnaW9uX2FkbWluMV9oYXJtb25pemVkLmdlb2pzb25cbi0gKiphZG1pbjIqKjogbG93ZXN0IGxldmVsLCBzdWJyZWdpb25zIG9mIGV2ZXJ5IGFkbWluMSByZWdpb25cbiAgLSBib3VuZGFyaWVzL2F0bGFzLXJlZ2lvbl9hZG1pbjJfaGFybW9uaXplZC5nZW9qc29uYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTYzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYm91bmRhcmllcyA9IHtcbiAgcmV0dXJuIHtcbiAgICBhZG1pbjA6IGFkbWluMCxcbiAgICBhZG1pbjE6IGF3YWl0IGdldF9hZG1pbjEoKSxcbiAgICBhZG1pbjI6IGF3YWl0IGdldF9hZG1pbjIoKVxuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Imdlb19kYiA9IHtcbiAgbGV0IGRiID0gYXdhaXQgRHVja0RCQ2xpZW50Lm9mKHtcbiAgICAvLyBhZG1pbjBfZ2VvbTogRmlsZUF0dGFjaG1lbnQoXCJhdGxhcy1yZWdpb25fYWRtaW4wX3NpbXBsaWZpZWQucGFycXVldFwiKSxcbiAgICBhZG1pbjFfZ2VvbTogRmlsZUF0dGFjaG1lbnQoXCJhdGxhcy1yZWdpb25fYWRtaW4xX3NpbXBsaWZpZWQucGFycXVldFwiKVxuICB9KTtcbiAgYXdhaXQgZGIucXVlcnkoYFxuICAgIENSRUFURSBWSUVXIGFkbWluMl9nZW9tIEFTXG4gICAgU0VMRUNUICpcbiAgICBGUk9NIHJlYWRfcGFycXVldChcIiR7cmVzb2x2ZVdpbmRvd3NDYWNoZUlzc3VlKFxuICAgICAgXCJodHRwczovL2RpZ2l0YWwtYXRsYXMuczMuYW1hem9uYXdzLmNvbS9ib3VuZGFyaWVzL2F0bGFzLXJlZ2lvbl9hZG1pbjJfc2ltcGxpZmllZC5wYXJxdWV0XCJcbiAgICApfVwiKWApO1xuICByZXR1cm4gZGI7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE2NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InBhcnRpdGlvbmVkX2JvdW5kcmllcyA9XG4gIFwiaHR0cHM6Ly9kaWdpdGFsLWF0bGFzLnMzLmFtYXpvbmF3cy5jb20vYm91bmRhcmllcy9zdWJuYXRpb25hbC1ib3VuZGFyaWVzX3NpbXBsaWZpZWRcIjtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTY2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaXNvM19saXN0ID0gbmV3IE9iamVjdCh7XG4gIE5pZ2VyaWE6IFwiTkdBXCIsXG4gIFN1ZGFuOiBcIlNETlwiLFxuICBDYW1lcm9vbjogXCJDTVJcIixcbiAgRXRoaW9waWE6IFwiRVRIXCIsXG4gIE1hdXJpdGFuaWE6IFwiTVJUXCIsXG4gIFwiQ8O0dGUgZOKAmUl2b2lyZVwiOiBcIkNJVlwiLFxuICBHaGFuYTogXCJHSEFcIixcbiAgTWFkYWdhc2NhcjogXCJNREdcIixcbiAgRGppYm91dGk6IFwiREpJXCIsXG4gIEJlbmluOiBcIkJFTlwiLFxuICBcIkVxdWF0b3JpYWwgR3VpbmVhXCI6IFwiR05RXCIsXG4gIEVyaXRyZWE6IFwiRVJJXCIsXG4gIFRhbnphbmlhOiBcIlRaQVwiLFxuICBTb21hbGlhOiBcIlNPTVwiLFxuICBcIkd1aW5lYS1CaXNzYXVcIjogXCJHTkJcIixcbiAgTWFsaTogXCJNTElcIixcbiAgXCJDZW50cmFsIEFmcmljYW4gUmVwdWJsaWNcIjogXCJDQUZcIixcbiAgR2FtYmlhOiBcIkdNQlwiLFxuICBDaGFkOiBcIlRDRFwiLFxuICBLZW55YTogXCJLRU5cIixcbiAgXCJDb25nbyAtIEtpbnNoYXNhXCI6IFwiQ09EXCIsXG4gIEFuZ29sYTogXCJBR09cIixcbiAgTGVzb3RobzogXCJMU09cIixcbiAgR3VpbmVhOiBcIkdJTlwiLFxuICBMaWJlcmlhOiBcIkxCUlwiLFxuICBcIkJ1cmtpbmEgRmFzb1wiOiBcIkJGQVwiLFxuICBcIkNvbmdvIC0gQnJhenphdmlsbGVcIjogXCJDT0dcIixcbiAgQnVydW5kaTogXCJCRElcIixcbiAgWmltYmFid2U6IFwiWldFXCIsXG4gIE1vemFtYmlxdWU6IFwiTU9aXCIsXG4gIEJvdHN3YW5hOiBcIkJXQVwiLFxuICBNYWxhd2k6IFwiTVdJXCIsXG4gIFVnYW5kYTogXCJVR0FcIixcbiAgWmFtYmlhOiBcIlpNQlwiLFxuICBcIlNvdXRoIFN1ZGFuXCI6IFwiU1NEXCIsXG4gIFRvZ286IFwiVEdPXCIsXG4gIFNlbmVnYWw6IFwiU0VOXCIsXG4gIE5pZ2VyOiBcIk5FUlwiLFxuICBcIlNpZXJyYSBMZW9uZVwiOiBcIlNMRVwiLFxuICBcIlNvdXRoIEFmcmljYVwiOiBcIlpBRlwiLFxuICBSd2FuZGE6IFwiUldBXCIsXG4gIE5hbWliaWE6IFwiTkFNXCIsXG4gIEdhYm9uOiBcIkdBQlwiLFxuICBFc3dhdGluaTogXCJTV1pcIixcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNjciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJhZG1pbl9pc28gPSBpc28zX2xpc3Rbc2VsZWN0QWRtaW4wLnZhbHVlXTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTY4IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiYWRtaW4wID0ge1xuICBsZXQgYWRtaW4wID0gYXdhaXQgRmlsZUF0dGFjaG1lbnQoXCJhdGxhcy1yZWdpb25fYWRtaW4wX2hhcm1vbml6ZWQuanNvblwiKS5qc29uKClcbiByZXR1cm4gdG9wb2pzb24uZmVhdHVyZShhZG1pbjAsIGFkbWluMC5vYmplY3RzW1wiYXRsYXMtcmVnaW9uX2FkbWluMF9oYXJtb25pemVkXCJdKVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNjkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJnZXRfYWRtaW4xID0gYXN5bmMgKCkgPT4ge1xuICBsZXQgY291bnRyeSA9IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjAudmFsdWU7XG4gIGxldCBhZG1pbjEgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4xLnZhbHVlO1xuICBpZiAoY291bnRyeSkge1xuICAgIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gXCJ3YWl0XCI7XG4gICAgbGV0IGFkbWluMV9xdWVyeSA9IGBXSEVSRSBhZG1pbjBfbmFtZSA9ICcke2NvdW50cnl9J2A7XG4gICAgLy8gbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2VvX2RiLnF1ZXJ5KGBcbiAgICAvLyAgIFNFTEVDVCAqXG4gICAgLy8gICBGUk9NIGFkbWluMV9nZW9tXG4gICAgLy8gICAke2FkbWluMV9xdWVyeX1gKVxuXG4gICAgbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2VvX2RiLnF1ZXJ5KGBcbiAgICAgICAgU0VMRUNUICpcbiAgICAgICAgRlJPTSBcIiR7cmVzb2x2ZVdpbmRvd3NDYWNoZUlzc3VlKFxuICAgICAgICAgIHBhcnRpdGlvbmVkX2JvdW5kcmllcyArXG4gICAgICAgICAgICBcIi9hZG1pbjA9XCIgK1xuICAgICAgICAgICAgYWRtaW5faXNvICtcbiAgICAgICAgICAgIFwiL2FkbWluX2xldmVsPTEvXCIgK1xuICAgICAgICAgICAgYWRtaW5faXNvICtcbiAgICAgICAgICAgIFwiLnBhcnF1ZXRcIixcbiAgICAgICAgKX1cIlxuICAgIGApO1xuICAgIGxldCB3a2JfbGlzdCA9IHJlc3BvbnNlLm1hcCgoZCkgPT4gZC5nZW9tZXRyeSk7XG4gICAgbGV0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5tYXAoKHsgZ2VvbWV0cnksIC4uLnJlc3QgfSkgPT4gcmVzdCk7XG4gICAgY29uc3QgZmVhdHVyZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdrYl9saXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBwb2ludGVyID0gR0VPUy5nZW9zR2VvbUZyb21XS0Iod2tiX2xpc3RbaV0pO1xuICAgICAgbGV0IGdlb2pzb24gPSBhd2FpdCBHRU9TLmdlb3NHZW9tVG9HZW9qc29uKHBvaW50ZXIsIEdFT1MuZ2Vvcyk7XG4gICAgICBnZW9qc29uID0gdHVyZlJld2luZChnZW9qc29uLCB7IHJldmVyc2U6IHRydWUgfSk7XG4gICAgICBjb25zdCBmZWF0dXJlID0ge1xuICAgICAgICB0eXBlOiBcIkZlYXR1cmVcIixcbiAgICAgICAgZ2VvbWV0cnk6IGdlb2pzb24sXG4gICAgICAgIHByb3BlcnRpZXM6IGRhdGFbaV0sXG4gICAgICB9O1xuICAgICAgZmVhdHVyZXMucHVzaChmZWF0dXJlKTtcbiAgICAgIEdFT1MuZ2Vvcy5HRU9TR2VvbV9kZXN0cm95KHBvaW50ZXIpO1xuICAgIH1cbiAgICBjb25zdCBnZW9qc29uID0ge1xuICAgICAgdHlwZTogXCJGZWF0dXJlQ29sbGVjdGlvblwiLFxuICAgICAgZmVhdHVyZXM6IGZlYXR1cmVzLFxuICAgIH07XG4gICAgLy8gcmV0dXJuIHsgbmFtZXM6IFtcIkZ1bGwgQ291bnRyeVwiXS5jb25jYXQoYTFfbmFtZXMpLCBHRU9KU09OOiBnZW9qc29uIH07XG4gICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSBcImRlZmF1bHRcIjtcbiAgICByZXR1cm4gZ2VvanNvbjtcbiAgfVxufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTcwIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZ2V0X2FkbWluMiA9IGFzeW5jICgpID0+IHtcbiAgbGV0IGNvdW50cnkgPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlO1xuICBsZXQgYWRtaW4xID0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMS52YWx1ZTtcbiAgaWYgKGNvdW50cnkpIHtcbiAgICBkb2N1bWVudC5ib2R5LnN0eWxlLmN1cnNvciA9IFwid2FpdFwiO1xuICAgIC8vIGxldCBhZG1pbjJfcXVlcnkgPSBgV0hFUkUgYWRtaW4wX25hbWUgPSAnJHtjb3VudHJ5fSdgXG4gICAgLy8gYWRtaW4yX3F1ZXJ5ICs9ICFhZG1pbjE/IFwiXCI6YCBBTkQgYWRtaW4xX25hbWUgPSAnJHtjbGVhbkFkbWluSW5wdXRfU1FMKGFkbWluMSl9J2BcbiAgICAvLyBsZXQgcmVzcG9uc2UgPSBhd2FpdCBnZW9fZGIucXVlcnkoYFxuICAgIC8vICAgU0VMRUNUICpcbiAgICAvLyAgIEZST00gYWRtaW4yX2dlb21cbiAgICAvLyAgICR7YWRtaW4yX3F1ZXJ5fWApXG4gICAgLy8gbGV0IHJlc3BvbnNlID0gYXdhaXQgZ2VvX2RiLnF1ZXJ5KGBcbiAgICAvLyAgICAgU0VMRUNUICpcbiAgICAvLyAgICAgRlJPTSBcIiR7cGFydGl0aW9uZWRfYm91bmRyaWVzfS9hZG1pbjA9JHthZG1pbl9pc299L2FkbWluX2xldmVsPTIvJHthZG1pbl9pc299LnBhcnF1ZXRcIlxuICAgIC8vIGApXG4gICAgY29uc29sZS5sb2coXG4gICAgICBcImEyX3BhdGg6XCIsXG4gICAgICByZXNvbHZlV2luZG93c0NhY2hlSXNzdWUoXG4gICAgICAgIHBhcnRpdGlvbmVkX2JvdW5kcmllcyArXG4gICAgICAgICAgXCIvYWRtaW4wPVwiICtcbiAgICAgICAgICBhZG1pbl9pc28gK1xuICAgICAgICAgIFwiL2FkbWluX2xldmVsPTIvXCIgK1xuICAgICAgICAgIGFkbWluX2lzbyArXG4gICAgICAgICAgXCIucGFycXVldFwiLFxuICAgICAgKSxcbiAgICApO1xuICAgIGxldCByZXNwb25zZSA9IGF3YWl0IGdlb19kYi5xdWVyeShgXG4gICAgICAgIFNFTEVDVCAqXG4gICAgICAgIEZST00gXCIke3Jlc29sdmVXaW5kb3dzQ2FjaGVJc3N1ZShwYXJ0aXRpb25lZF9ib3VuZHJpZXMgKyBcIi9hZG1pbjA9XCIgKyBhZG1pbl9pc28gKyBcIi9hZG1pbl9sZXZlbD0yL1wiICsgYWRtaW5faXNvICsgXCIucGFycXVldFwiKX1cIlxuICAgIGApO1xuICAgIGxldCB3a2JfbGlzdCA9IHJlc3BvbnNlLm1hcCgoZCkgPT4gZC5nZW9tZXRyeSk7XG4gICAgbGV0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5tYXAoKHsgZ2VvbWV0cnksIC4uLnJlc3QgfSkgPT4gcmVzdCk7XG4gICAgY29uc3QgZmVhdHVyZXMgPSBbXTtcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdrYl9saXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICBjb25zdCBwb2ludGVyID0gR0VPUy5nZW9zR2VvbUZyb21XS0Iod2tiX2xpc3RbaV0pO1xuICAgICAgbGV0IGdlb2pzb24gPSBhd2FpdCBHRU9TLmdlb3NHZW9tVG9HZW9qc29uKHBvaW50ZXIsIEdFT1MuZ2Vvcyk7XG4gICAgICBnZW9qc29uID0gdHVyZlJld2luZChnZW9qc29uLCB7IHJldmVyc2U6IHRydWUgfSk7XG4gICAgICBjb25zdCBmZWF0dXJlID0ge1xuICAgICAgICB0eXBlOiBcIkZlYXR1cmVcIixcbiAgICAgICAgZ2VvbWV0cnk6IGdlb2pzb24sXG4gICAgICAgIHByb3BlcnRpZXM6IGRhdGFbaV0sXG4gICAgICB9O1xuICAgICAgZmVhdHVyZXMucHVzaChmZWF0dXJlKTtcbiAgICAgIEdFT1MuZ2Vvcy5HRU9TR2VvbV9kZXN0cm95KHBvaW50ZXIpO1xuICAgIH1cbiAgICBjb25zdCBnZW9qc29uID0ge1xuICAgICAgdHlwZTogXCJGZWF0dXJlQ29sbGVjdGlvblwiLFxuICAgICAgZmVhdHVyZXM6IGZlYXR1cmVzLFxuICAgIH07XG4gICAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSBcImRlZmF1bHRcIjtcbiAgICByZXR1cm4gZ2VvanNvbjtcbiAgfVxufTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTcxIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgIyMjIER5bmFtaWMgc3VtbWFyeSBsaW5rc1xuQ1NWIG9mIGxpbmtzIHRvIGluY2x1ZGUgZm9yIGRpZmZlcmVudCBhZG1pbjAgc2VsZWN0aW9uc1xuLSBMb2NhbCBEcml2ZSBHb29nbGUgU2hlZXRgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNzIiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBkeW5hbWljIGJ1bGxldGVkIGxpc3QgZGF0YVxuZHluYW1pY1N1bW1hcnlEYXRhID0ge1xuICBjb25zdCByYXcgPSBhd2FpdCBGaWxlQXR0YWNobWVudChcImR5bmFtaWMtc3VtbWFyeS1saW5rcy5jc3ZcIikuY3N2KClcblxuICByZXR1cm4gcmF3LmZpbHRlcigoZCkgPT4gZC5hZG1pbjBfbmFtZS5sZW5ndGggPiAwKVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNzMiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJkeW5hbWljU3VtbWFyeVNlbGVjdGVkTGlua3MgPSB7XG4gIC8vIGZpbHRlciBhbmQgY2hlY2sgbGluayBudW1iZXJcbiAgY29uc3QgZGF0YSA9IGR5bmFtaWNTdW1tYXJ5RGF0YVxuICBjb25zdCBhZG1pbjBTZWxlY3Rpb24gPSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4wLnZhbHVlID8/IFwiREVGQVVMVFwiXG4gIFxuICBjb25zdCBudW1MaW5rcyA9IGRhdGEuZmlsdGVyKGQgPT4gZC5hZG1pbjBfbmFtZSA9PSBhZG1pbjBTZWxlY3Rpb24pLmxlbmd0aFxuICByZXR1cm4gbnVtTGlua3MgPT0gMFxuICAgID8gZGF0YS5maWx0ZXIoZCA9PiBkLmFkbWluMF9uYW1lID09ICdERUZBVUxUJylcbiAgICA6IGRhdGEuZmlsdGVyKGQgPT4gZC5hZG1pbjBfbmFtZSA9PSBhZG1pbjBTZWxlY3Rpb24pXG5cbiAgXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE3NCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImR5bmFtaWNTdW1tYXJ5TWFya2Rvd24gPSB7XG4gIGNvbnN0IGxpbmtBcnIgPSBkeW5hbWljU3VtbWFyeVNlbGVjdGVkTGlua3MubWFwKGQgPT4gYC0gWyR7ZC5saW5rX3RleHR9XSgke2QubGlua191cmx9KSR7ZC5kZXNjcmlwdGlvbi5sZW5ndGggPiAwID8gYDogJHtkLmRlc2NyaXB0aW9ufWA6IFwiXCJ9YClcbiAgcmV0dXJuIGxpbmtBcnIuam9pbihcIlxcblwiKVxufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNzUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAqKipcbiMjIEhlbHBlcnNcbipGdW5jdGlvbnMgYW5kIG90aGVyIGdvb2Qgc3R1ZmYqYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTc2IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgUmlzayBkYXRhIGdyb3VwaW5nXG4qTG9va3VwcyBmb3IgcmlzayBkYXRhIGJpbm5pbmcsIHN1Y2ggYXMgaGF6YXJkcyBhbmQgY3JvcCB0eXBlcypgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNzciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyBsb29rdXAgZm9yIHJpc2sgZGF0YSB0eXBlIGdyb3VwaW5nc1xuLy8gdXNlZCBieSBpbnB1dHMgYW5kIGZvciBncm91cGluZyB1cCBkYXRhXG5yaXNrRGF0YVR5cGVzID0gbmV3IE9iamVjdCh7XG4gIGNyb3A6IHtcbiAgICBjcm9wOiBbXG4gICAgICBcImFyYWJpY2EgY29mZmVlXCIsXG4gICAgICBcImJhbmFuYVwiLFxuICAgICAgXCJiYXJsZXlcIixcbiAgICAgIFwiYmVhblwiLFxuICAgICAgXCJjYXNzYXZhXCIsXG4gICAgICBcImNoaWNrcGVhXCIsXG4gICAgICBcImNvY29hXCIsXG4gICAgICBcImNvY29udXRcIixcbiAgICAgIFwiY290dG9uXCIsXG4gICAgICBcImNvd3BlYVwiLFxuICAgICAgXCJnZW5lcmljXCIsXG4gICAgICBcImdyb3VuZG51dFwiLFxuICAgICAgXCJsZW50aWxcIixcbiAgICAgIFwibWFpemVcIixcbiAgICAgIFwib2lscGFsbVwiLFxuICAgICAgXCJwZWFybCBtaWxsZXRcIixcbiAgICAgIFwicGlnZW9ucGVhXCIsXG4gICAgICBcInBsYW50YWluXCIsXG4gICAgICBcInBvdGF0b1wiLFxuICAgICAgXCJyaWNlXCIsXG4gICAgICBcInJvYnVzdGEgY29mZmVlXCIsXG4gICAgICBcInNlc2FtZXNlZWRcIixcbiAgICAgIFwic21hbGwgbWlsbGV0XCIsXG4gICAgICBcInNvcmdodW1cIixcbiAgICAgIFwic295YmVhblwiLFxuICAgICAgXCJzdWdhcmNhbmVcIixcbiAgICAgIFwic3VuZmxvd2VyXCIsXG4gICAgICBcInN3ZWV0IHBvdGF0b1wiLFxuICAgICAgXCJ0ZWFcIixcbiAgICAgIFwidG9iYWNjb1wiLFxuICAgICAgXCJ3aGVhdFwiLFxuICAgICAgXCJ5YW1zXCIsXG4gICAgXSxcbiAgICBsaXZlc3RvY2s6IFtcbiAgICAgIFwiY2F0dGxlX2hpZ2hsYW5kXCIsXG4gICAgICBcImNhdHRsZV90cm9waWNhbFwiLFxuICAgICAgXCJnb2F0c19oaWdobGFuZFwiLFxuICAgICAgXCJnb2F0c190cm9waWNhbFwiLFxuICAgICAgXCJwaWdzX2hpZ2hsYW5kXCIsXG4gICAgICBcInBpZ3NfdHJvcGljYWxcIixcbiAgICAgIFwicG91bHRyeV9oaWdobGFuZFwiLFxuICAgICAgXCJwb3VsdHJ5X3Ryb3BpY2FsXCIsXG4gICAgICBcInNoZWVwX2hpZ2hsYW5kXCIsXG4gICAgICBcInNoZWVwX3Ryb3BpY2FsXCIsXG4gICAgXSxcbiAgfSxcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xNzgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cbiMjIyBEeW5hbWljIGluc2lnaHRzXG4qZnVuY3Rpb25zIGZvciBmb3JtYXR0aW5nIHJlc3VsdHMqYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTc5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiZnVuY3Rpb24gZmlsdGVyQnlBZG1pbk5hbWVzKGRhdGEpIHtcbiAgLy8gZmlsdGVyIGRvd24gZGF0YSBieSBjb21iaW5lZCBzZWxlY3RlZCBhZG1pbjAvYWRtaW4xL2FkbWluMiBBZG1pbiBTZWxlY3Rpb25zXG4gIC8vIHBhc3MgZGF0YSBmcm9tIHF1ZXJ5LCB1c2UgdGlkeWpzIHRvIGZpbHRlciBieSBhZG1pbiBzZWxlY3Rpb25cbiAgY29uc3QgcmVzdWx0ID0gVC50aWR5KFxuICAgIGRhdGEsXG4gICAgVC5maWx0ZXIoKGQpID0+IHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIGQuYWRtaW4wX25hbWUgPT0gYWRtaW5TZWxlY3Rpb25zLnNlbGVjdEFkbWluMC52YWx1ZSAmJlxuICAgICAgICBkLmFkbWluMV9uYW1lID09IGFkbWluU2VsZWN0aW9ucy5zZWxlY3RBZG1pbjEudmFsdWUgJiZcbiAgICAgICAgZC5hZG1pbjJfbmFtZSA9PSBhZG1pblNlbGVjdGlvbnMuc2VsZWN0QWRtaW4yLnZhbHVlXG4gICAgICApO1xuICAgIH0pLFxuICApO1xuICByZXR1cm4gcmVzdWx0O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xODAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiIvLyB3cmFwcGVyIGZvciBmb3JtYXQgZnVuY3Rpb25zLCBzaG93IGNob3NlbiBkZWZhdWx0XG5mdW5jdGlvbiBmb3JtYXRXaXRoRGVmYXVsdCh7XG4gIHZhbHVlID0gMTAwMCxcbiAgZm9ybWF0ID0gKGQpID0+IGQsXG4gIGRlZmF1bHRWYWx1ZSA9IFwiLS0tXCIsXG4gIGRlYnVnID0gZmFsc2UsXG59ID0ge30pIHtcbiAgLy8gYXBwbHkgYSBmb3JtYXR0aW5nIGZ1bmN0aW9uIHRvIGEgdmFsdWVcbiAgLy8gcmV0dXJuIGRlZmF1bHQgdmFsdWUgaWYgdW5kZWZpbmVkIG9yIG51bGxcbiAgaWYgKCEodmFsdWUgPT09IG51bGwgfHwgdmFsdWUgPT09IHVuZGVmaW5lZCkpIHtcbiAgICByZXR1cm4gZm9ybWF0KHZhbHVlKTtcbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gZGVmYXVsdFZhbHVlO1xuICB9XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYC0tLVxuIyMjIERhdGEgZnVuY3Rpb25zOiBmb3JtYXQgYW5kIHRyYW5zZm9ybVxuKmFwcGx5IGZvcm1hdHRpbmcgdG8vdHJhbnNmb3JtIGEgdmFsdWUqXG5cbi0gUmVmZXJlbmNlOiBbSW50bC5OdW1iZXJGb3JtYXQoKV0oaHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvZW4tVVMvZG9jcy9XZWIvSmF2YVNjcmlwdC9SZWZlcmVuY2UvR2xvYmFsX09iamVjdHMvSW50bC9OdW1iZXJGb3JtYXQvTnVtYmVyRm9ybWF0KWA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4MiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Im1kYCoqVHJhbnNmb3JtcyoqYDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTgzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gdHJhbnNmb3JtIG5vbi1udW1iZXIgdG8gcGVyY2VudCB2YWx1ZVxudHJhbnNmb3JtUGVyY2VudCA9IChkKSA9PiB7XG4gIGlmIChkID09PSB1bmRlZmluZWQgfHwgZCA9PT0gbnVsbCkgcmV0dXJuIGQ7XG4gIGVsc2UgcmV0dXJuIGQgKiAxMDA7XG59O1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xODQiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAqKkZvcm1hdHRpbmcqKmA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4NSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGZvcm1hdCBub24tbnVtYmVyIGFzIHBlcmNlbnRcbmZvcm1hdFBlcmNlbnRUZW50aCA9IChkKSA9PiB7XG4gIGlmIChkID09PSB1bmRlZmluZWQgfHwgZCA9PT0gbnVsbCkgcmV0dXJuIGQ7XG4gIGVsc2UgcmV0dXJuIGQzLmZvcm1hdChcIi4xJVwiKShkKTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGZvcm1hdCBub24tbnVtYmVyIGFzIHBlcmNlbnRcbmZvcm1hdFBlcmNlbnRXaG9sZSA9IChkKSA9PiB7XG4gIGlmIChkID09PSB1bmRlZmluZWQgfHwgZCA9PT0gbnVsbCkgcmV0dXJuIGQ7XG4gIGVsc2UgcmV0dXJuIGQzLmZvcm1hdChcIi4wJVwiKShkKTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4NyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGZvcm1hdCBub24tbnVtYmVyIHdpdGggbm8gZmxvYXRpbmcgcG9pbnRcbi8vIGZvciBpbmRleCB2YWx1ZXNcbmZvcm1hdFBlcmNlbnROb1N5bWJvbCA9IChkKSA9PiB7XG4gIGlmIChkID09PSB1bmRlZmluZWQgfHwgZCA9PT0gbnVsbCkgcmV0dXJuIGQ7XG4gIGVsc2UgcmV0dXJuIGQzLmZvcm1hdChcIi4wZlwiKShkKTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE4OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGZvcm1hdFVTRCh7IGxvY2FsZSA9IFwiZW4tVVNcIiB9ID0ge30pIHtcbiAgY29uc3QgZm9ybWF0dGVyID0gZm9ybWF0TnVtQ29tcGFjdFNob3J0KHsgbG9jYWxlIH0pO1xuXG4gIHJldHVybiAobnVtYmVyKSA9PiB7XG4gICAgY29uc3QgZm9ybWF0dGVkTnVtID0gZm9ybWF0dGVyKG51bWJlcik7XG4gICAgcmV0dXJuIFwiJFwiICsgZm9ybWF0dGVkTnVtO1xuICB9O1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xODkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpbnREb2xsYXJZZWFyID0gMjAwNTsgLy8geWVhciBvZiBpbnRlcm5hdGlvbmFsIHllYXIgZGF0YVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOTAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpbnREb2xsYXJVbml0ID0gYCR7aW50RG9sbGFyWWVhcn0gSW50JGA7IC8vIGZ1bGwgdW5pdCBmb3IgaW50ZXJuYXRpb25hbCBkb2xsYXJzXG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE5MSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGZvcm1hdCBVUyBjdXJyZW5jeVxuZnVuY3Rpb24gZm9ybWF0SW50RG9sbGFyKHsgbG9jYWxlID0gXCJlbi1VU1wiIH0gPSB7fSkge1xuICByZXR1cm4gKG51bWJlciwgdW5pdCA9IGludERvbGxhclVuaXQucmVwbGFjZShcIiRcIiwgXCJcIikpID0+IHtcbiAgICBsZXQgZm9ybWF0dGVkTnVtYmVyID0gZm9ybWF0VVNEKHsgbG9jYWxlIH0pKG51bWJlcik7XG4gICAgbGV0IGludERvbGxhciA9IHVuaXQgKyBmb3JtYXR0ZWROdW1iZXI7XG4gICAgcmV0dXJuIGludERvbGxhcjtcbiAgfTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTkyIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiLy8gZm9ybWF0IG51bWJlciwgbG9uZyBub3RhdGlvblxuZm9ybWF0TnVtQ29tcGFjdExvbmcgPSBmdW5jdGlvbiAoeyBsb2NhbGUgPSBcImVuLVVTXCIgfSA9IHt9KSB7XG4gIHJldHVybiBmdW5jdGlvbiAobnVtYmVyKSB7XG4gICAgcmV0dXJuIG5ldyBJbnRsLk51bWJlckZvcm1hdChsb2NhbGUsIHtcbiAgICAgIG5vdGF0aW9uOiBcImNvbXBhY3RcIixcbiAgICAgIGNvbXBhY3REaXNwbGF5OiBcImxvbmdcIixcbiAgICAgIHVuaXREaXNwbGF5OiBcImxvbmdcIixcbiAgICB9KS5mb3JtYXQobnVtYmVyKTtcbiAgfTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE5MyIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6Ii8vIGZvcm1hdCBudW1iZXIsIHNob3J0IG5vdGF0aW9uXG5mb3JtYXROdW1Db21wYWN0U2hvcnQgPSAoeyBsb2NhbGUgPSBcImVuLVVTXCIgfSA9IHt9KSA9PlxuICBuZXcgSW50bC5OdW1iZXJGb3JtYXQobG9jYWxlLCB7XG4gICAgbm90YXRpb246IFwiY29tcGFjdFwiLFxuICAgIGNvbXBhY3REaXNwbGF5OiBcInNob3J0XCIsXG4gIH0pLmZvcm1hdDtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTk0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgLS0tXG4jIyMgUXVlcnlpbmcgZGF0YVxuKmZ1bmN0aW9ucyBmb3IgcXVlcnlpbmcgZGF0YSpgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOTUiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBnZXRVbmlxdWVWYWx1ZXMoY29sLCB0YmwsIGRiKSB7XG4gIC8vIHJldHVybiB1bmlxdWUgdmFsdWVzIG9mIGZyb20gZGIgdGJsIGFzIGEgbGlzdFxuICByZXR1cm4gZGJcbiAgICAucXVlcnkoYHNlbGVjdCBkaXN0aW5jdCAke2NvbH0gZnJvbSAke3RibH1gKVxuICAgIC50aGVuKCh4KSA9PiB4Lm1hcCgoZCkgPT4gZFtjb2xdKSk7XG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE5NiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImZ1bmN0aW9uIGJpbmRUYWJ1bGFyVG9HZW8oe1xuICBkYXRhID0gW10sXG4gIGRhdGFCaW5kQ29sdW1uID0gXCJkYXRhQmluZENvbHVtblwiLFxuICBnZW9EYXRhID0gW10sXG4gIGdlb0RhdGFCaW5kQ29sdW1uID0gXCJnZW9EYXRhQmluZENvbHVtblwiLFxufSkge1xuICBpZiAoIWRhdGEubGVuZ3RoIHx8ICFnZW9EYXRhLmZlYXR1cmVzIHx8ICFnZW9EYXRhLmZlYXR1cmVzLmxlbmd0aCkge1xuICAgIHJldHVybiB7XG4gICAgICB0eXBlOiBcIkZlYXR1cmVDb2xsZWN0aW9uXCIsXG4gICAgICBmZWF0dXJlczogW10sXG4gICAgfTtcbiAgfVxuICAvLyBiaW5kIGRhdGEgdG8gZ2VvanNvblxuICBjb25zdCBpbmRleCA9IG5ldyBNYXAoZGF0YS5tYXAoKGQpID0+IFtkW2RhdGFCaW5kQ29sdW1uXSwgZF0pKTsgLy8gbWFwIGRhdGEgYnkgZGF0YUJpbmRDb2x1bW5cbiAgY29uc3QgZ2VvanNvbiA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZ2VvRGF0YSkpOyAvLyBkbyBhIGNvcHksIHJhdGhlciB0aGFuIG11dGF0ZVxuICAvLyBqb2luIHVwIGRhdGEgdG8gZ2VvanNvblxuICBmb3IgKGNvbnN0IGYgb2YgZ2VvanNvbi5mZWF0dXJlcykge1xuICAgIGYucHJvcGVydGllcy5kYXRhID0gaW5kZXguZ2V0KGYucHJvcGVydGllc1tnZW9EYXRhQmluZENvbHVtbl0pO1xuICB9XG4gIHJldHVybiBnZW9qc29uO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0xOTciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAqKipcbiMjIFRlc3RpbmcgUXVlcmllc1xuKlRlc3QgcXVlcmllcyBvZiB0aGUgdGFidWxhciBkYXRhKmA7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTE5OCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6IntcbiAgY29uc3QgZGVidWdTdHJpbmcgPSBtZGAqKlF1ZXJ5IGhpZGRlbjogRGVidWc6IG5vbi16ZXJvIGhhemFyZCBkYXRhIGNvdW50cyoqXG5cbl8odXBkYXRlIGJvb2xlYW4gd2l0aGluIHRoaXMgY2VsbCB0byBydW4pXyBcbiAgLSB0aGlzIGNoZWNrcyB0aGUgbnVtYmVyIG9mIHJlc3VsdHMgZm9yIGV2ZXJ5IGNvbWJpbmF0aW9uIG9mIGhhemFyZCBkYXRhIFxuICAtIH4zJSBvZiBjaG9pY2VzIGhhdmUgbm8gZGF0YSBhY3Jvc3MgYWxsIGNyb3BzYFxuICBcbiAgY29uc3QgaGlkZVF1ZXJ5ID0gdHJ1ZTtcblxuICByZXR1cm4gaGlkZVF1ZXJ5XG4gICAgPyBkZWJ1Z1N0cmluZ1xuICAgIDogZGIucXVlcnkoYFxud2l0aCB0YmwgYXMgKFxuICBzZWxlY3QgYWRtaW4wX25hbWVcbiAgICAsIGFkbWluMV9uYW1lXG4gICAgLCBhZG1pbjJfbmFtZVxuICAgICwgc2NlbmFyaW9cbiAgICAsIHRpbWVmcmFtZVxuICAgICwgY291bnQoKikgYXMgdG90YWxfY291bnRcbiAgICAsIGNvdW50KGNhc2Ugd2hlbiB2YWx1ZSA8PiAwIHRoZW4gMSBlbmQpIGFzIG5vbl96ZXJvX2NvdW50XG4gICAgZnJvbSBoYXpfcmlza192b3BfaW50XG4gICAgLS0gd2hlcmUgYWRtaW4wX25hbWUgPSAnQW5nb2xhJ1xuICAgIHdoZXJlIHNldmVyaXR5ID0gJ21vZGVyYXRlJyAtLSBoYXJkLWNvZGVkXG4gICAgYW5kIGhhemFyZCAhPSAnYW55J1xuICAgIGdyb3VwIGJ5IGFkbWluMF9uYW1lXG4gICAgLCBhZG1pbjFfbmFtZVxuICAgICwgYWRtaW4yX25hbWVcbiAgICAsIHNjZW5hcmlvXG4gICAgLCB0aW1lZnJhbWVcbiAgICBvcmRlciBieSBub25femVyb19jb3VudFxuKVxuXG5zZWxlY3QgKiBcbiAgZnJvbSB0YmxcbiAgLS0gd2hlcmUgbm9uX3plcm9fY291bnQgPSAwXG5gKTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMTk5IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoibWRgKioqXG4jIyBJbXBvcnRzXG4qRXh0ZXJuYWwgaW1wb3J0cypgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMDAiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJpbXBvcnQgeyB0b2MgfSBmcm9tIFwiQG5lYnJpdXMvaW5kZW50ZWQtdG9jXCI7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIwMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7IFQgfSBmcm9tIFwiQHBiZXNoYWkvdGlkeWpzXCI7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIwMiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImltcG9ydCB7XG4gIGNsZWFuQWRtaW5JbnB1dF9TUUwsXG4gIHJlc29sdmVXaW5kb3dzQ2FjaGVJc3N1ZSxcbn0gZnJvbSBcImNiZDMyZjkyYzE1NWJmNWJcIjtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjAzIiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiR0VPUyA9IHtcbiAgY29uc3QgaW5pdGdlb3NKcyA9IChhd2FpdCBpbXBvcnQoXCJodHRwczovL2Nkbi5za3lwYWNrLmRldi9nZW9zLXdhc21AMi4wLjBcIikpXG4gICAgLmRlZmF1bHQ7XG4gIGNvbnN0IGdlb3MgPSBhd2FpdCBpbml0Z2Vvc0pzKCk7XG5cbiAgZnVuY3Rpb24gZ2Vvc0dlb21Gcm9tV0tCKHdrYikge1xuICAgIGNvbnN0IHdrYlB0ciA9IGdlb3MuTW9kdWxlLl9tYWxsb2Mod2tiLmxlbmd0aCk7IC8vQWxsb2NhdGUgbWVtb3J5IGZvciB0aGUgZ2VvbVxuICAgIGdlb3MuTW9kdWxlLkhFQVBVOC5zZXQod2tiLCB3a2JQdHIpO1xuICAgIGNvbnN0IGdlb21QdHIgPSBnZW9zLkdFT1NHZW9tRnJvbVdLQl9idWYod2tiUHRyLCB3a2IubGVuZ3RoKTtcbiAgICBnZW9zLk1vZHVsZS5fZnJlZSh3a2JQdHIpO1xuICAgIHJldHVybiBnZW9tUHRyO1xuICB9XG4gIFxuICBjb25zdCBnZW9zR2VvbVRvR2VvanNvbiA9IChcbiAgICBhd2FpdCBpbXBvcnQoXCJodHRwczovL2Nkbi5za3lwYWNrLmRldi9nZW9zLXdhc20vaGVscGVyc1wiKVxuICApLmdlb3NHZW9tVG9HZW9qc29uO1xuXG4gIHJldHVybiB7IGdlb3NHZW9tVG9HZW9qc29uLCBnZW9zR2VvbUZyb21XS0IsIGdlb3MgfTtcbn1cbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjA0IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoidHVyZlJld2luZCA9IHJlcXVpcmUoXCJAdHVyZi90dXJmXCIpLnRoZW4oKHQpID0+IHQucmV3aW5kKTtcbiJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldCIsImNlbGxOYW1lIjoib2pzLWNlbGwtMjA1IiwiaW5saW5lIjpmYWxzZSwic291cmNlIjoiaW1wb3J0IHsgYnVpbGRJbmxpbmVEb3dubG9hZEJ1dHRvbiB9IGZyb20gXCIxYmRhNWY5YjYwYzY0MjIzXCI7XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIwNiIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImRvd25sb2FkX3RyYW5zbGF0aW9uID0gbmV3IE9iamVjdCh7XG4gIGVuOiBcIkRvd25sb2FkIERhdGFcIixcbiAgZnI6IFwiVMOpbMOpY2hhcmdlciBsZXMgRG9ubsOpZXNcIixcbn0pO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMDciLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJtZGAtLS1cblxuIyMgT3RoZXJgO1xuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMDgiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJmdW5jdGlvbiBtYWtlRGV2Tm90ZXMoe1xuICAvLyBhZGRpbmcgZGV2IG5vdGVzIGFzIGEgaHRtbCBzdW1tYXJ5IChjb2xsYXBzaWJsZSlcbiAgdGl0bGUgPSBcIlBsb3QgZGV2IG5vdGVzXCIsXG4gIGVtb2ppcyA9IFwi8J+RhvCfm6BcIixcbiAgdGV4dCA9IG1kYFVwZGF0ZSB0aGlzIHRleHQgdXNpbmcgdGhlIFxcYHRleHRcXGAgZmllbGQuYCxcbn0gPSB7fSkge1xuICByZXR1cm4gaHRsLmh0bWxgPGRldGFpbHM+XG48c3VtbWFyeT4ke3RpdGxlfSAke2Vtb2ppc308L3N1bW1hcnk+JHt0ZXh0fTwvZGV0YWlscz5gO1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0IiwiY2VsbE5hbWUiOiJvanMtY2VsbC0yMDkiLCJpbmxpbmUiOmZhbHNlLCJzb3VyY2UiOiJ7XG4gIGNvbnN0IHRleHQgPSBgIyMjIHYxLjIuMDogYWRkaW5nIGxhbmd1YWdlIGNvbnZlcnNpb25cbi0gbGFuZ3VhZ2UgdG9nZ2xlIFxuXG4jIyMgdjEuMS4yOiBBZGFwdGl2ZSBjYXBhY2l0eSBmb3JtYXR0aW5nXG4tIFVwZGF0ZSBhZGFwdGl2ZSBjYXBhY2l0eSBkYXRhXG4gIC0gQUMgZGF0YSBmb3IgbWFwIGFyZSBpbmRpY2VzIGFuZCBzaG91bGQgYmUgZGVzY3JpYmVzIGFzIHN1Y2gsIG5vdCBhcyByYXRlc1xuICAtIFVwZGF0ZSBpbnNpZ2h0cyB0byBiZSBhYm91dCBzZWxlY3RlZCBpbmRleGVzIHJhdGhlciB0aGFuIHBvcHVsYXRpb24gYWZmZWN0ZWRcblxuIyMjIHYxLjEuMSBNYXAgZml4ICgyMDI0LTAzLTI2KVxuTG9va2luZyBhdCBtYXAgd2l0aCBtdWx0aXBsZSByZWdpb25zIHNob3duIGZvciBjaG9yb3BsZXRoXG4tIEZpeCBiaW5kaW5nIHdoZW4geW91J3ZlIHNlbGVjdGVkIGFkbWluMTpcbiAgLSBCaW5kIGRhdGEgYnkgQk9USCBhZG1pbjEgYW5kIGFkbWluMCwgbm90IGp1c3QgYWRtaW4xXG5cbiMjIyB2MS4xIERhdGEgVXBkYXRlICgyMDI0LTAzLTE5KVxuLSBIYXphcmQgZmllbGQgaXMgbm93ICdubyBoYXphcmQnIChhbGwgbG93ZXJjYXNlKVxuLSBWb1AgdmFsdWVzIGFyZSB0aGUgdG90YWwgYWNyb3NzIGFsbCBzZXZlcml0aWVzLCBub3QganVzdCBoYXJkLWNvZGVkIHRvICdtb2RlcmF0ZSdcblxuIyMjIHYxLjAuMSAoMjAyNC0wMy0xNSlcbi0gQWRkaW5nIGNvdmVyIGltYWdlXG5cbiMjIyB2MS4wICgyMDI0LTAzLTE1KVxuLSBVcGRhdGluZyBoYXphcmQgZGF0YVxuICAtIEluY2x1ZGVkICdObyBoYXphcmQnIGFzIG9wdGlvbiwgc28gdXBkYXRlZCBob3cgZGF0YSBpcyBleHRyYWN0ZWQgKG5vIGxvbmdlciBqb2luaW5nIHVwIHRvdGFscylcbiAgICAtIFVzaW5nIG5ldyBvcHRpb24gYXMgZGVmaW5pdGlvbiBvZiBkaXN0cmlidXRpb25cbiAgICAtIFVwZGF0ZSByZW1vdmFsIGZyb20gY29tcG9uZW50IGJhciBjaGFydHNcbiAgLSBOb3QgdXNpbmcgdGhlIGV4cGxpY2l0ICdhbnknIGNvbHVtbiwgaW5zdGVhZCBkZWZpbmluZyB1c2luZyBzdW0gb2YgY29tcG9uZW50IHZhbHVlcyAodG8gYXZvaWQgYW55IHJvdW5kaW5nIGVycm9ycylcbi0gQ2xlYW51cFxuICAtIFJlbW92ZSB1bnVzZWQgaGF6YXJkIGhlbHBlcnNcbiAgLSBDbGVhbiB1cCBkb2N1bWVudGF0aW9uIGZvciBkYXRhIHNvdXJjZXNcblxuIyMjIHYwLjYgKDIwMjQtMDMtMTEpXG5cbi0gQ29sbGFwc2UgeS1heGlzIGZvciBwZXJjZW50IGNoYXJ0IHdoZW4gY3JvcCBoYXphcmRzIGFyZSB6ZXJvIChwcmVzZXJ2ZSBvcmRlciBmb3IgY3JvcHMgYW5kIGxpdmVzdG9jaylcbi0gUmVtb3ZlICdubyBoYXphcmQnIGZyb20gaGF6YXJkIGJhciBjaGFydCBkcm9wZG93blxuLSBVcGRhdGUgcGVyYyBjaGFydCB0b29sdGlwXG4gIC0gVG90YWwgVm9QIGF0IHJpc2sgaXMgbm93IGluIHRlcm1zIG9mIGNvbG9yZWQgYmFycyBvbmx5ICh1c2luZyBhbnkgaGF6YXJkIGRhdGEpXG4gIC0gRm9ybWF0IHRvIG1hdGNoIHBlcmNlbnQgYW5kIG1vbmV5IHdpdGggaGF6YXJkIGV4cG9zdXJlXG4gIC0gRml4IGJhciBvcmRlcmluZ1xuLSBVcGRhdGUgYWRhcHRpdmUgY2FwYWNpdHkgaWNpY2xlXG4gIC0gaW5jbHVkZXMgU1NBIGFuZCB1cGRhdGVkIGNvbG9yc1xuLSBVcGRhdGUgYWRhcHRpdmUgY2FwYWNpdHkgbWFwIGRhdGFcbmA7XG5cbiAgY29uc3QgbmV3ZXN0VmVyc2lvbiA9IHRleHQuc3BsaXQoJyMjIycpXG4gICAgLmZpbHRlcihkID0+IGQpXG4gICAgLm1hcChkID0+IGQudHJpbSgpKVxuICAgID8uWzBdXG4gICAgLnNwbGl0KCdcXG4nKVxuICAgID8uWzBdXG5cbiAgcmV0dXJuIG1ha2VEZXZOb3Rlcyh7XG4gICAgdGV4dDogbWRgJHt0ZXh0fWAsXG4gICAgdGl0bGU6IG5ld2VzdFZlcnNpb24gPz8gXCJEZXYgbm90ZXNcIixcbiAgICBlbW9qaXM6IFwi8J+qteKcj++4j1wiXG4gIH0pXG59XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIxMCIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6ImNvbnZlcnRUb0NTViA9IChkYXRhKSA9PiB7XG4gIGlmICghZGF0YT8ubGVuZ3RoKSByZXR1cm4gXCJcIjtcblxuICBjb25zdCBoZWFkZXJzID0gT2JqZWN0LmtleXMoZGF0YVswXSk7XG4gIGNvbnN0IGVzY2FwZVZhbHVlID0gKHZhbCkgPT4ge1xuICAgIGlmICh2YWwgPT0gbnVsbCkgcmV0dXJuIFwiXCI7XG4gICAgY29uc3Qgc3RyID0gU3RyaW5nKHZhbCk7XG4gICAgcmV0dXJuIHN0ci5pbmNsdWRlcyhcIixcIikgfHwgc3RyLmluY2x1ZGVzKCdcIicpIHx8IHN0ci5pbmNsdWRlcyhcIlxcblwiKVxuICAgICAgPyBgXCIke3N0ci5yZXBsYWNlKC9cIi9nLCAnXCJcIicpfVwiYFxuICAgICAgOiBzdHI7XG4gIH07XG5cbiAgcmV0dXJuIFtcbiAgICBoZWFkZXJzLm1hcChlc2NhcGVWYWx1ZSkuam9pbihcIixcIiksXG4gICAgLi4uZGF0YS5tYXAoKHJvdykgPT4gaGVhZGVycy5tYXAoKGtleSkgPT4gZXNjYXBlVmFsdWUocm93W2tleV0pKS5qb2luKFwiLFwiKSksXG4gIF0uam9pbihcIlxcblwiKTtcbn07XG4ifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXQiLCJjZWxsTmFtZSI6Im9qcy1jZWxsLTIxMSIsImlubGluZSI6ZmFsc2UsInNvdXJjZSI6InsgY29uc3QgX2FueURhdGEgPSBULnRpZHkoXG4gICAgZGF0YV9oYXphcmRWb1AsXG4gICAgVC5maWx0ZXIoKGQpID0+ICFbXCJhbnlcIiwgXCJubyBoYXphcmRcIl0uaW5jbHVkZXMoZC5oYXphcmQpKSwgLy8gb25seSBoYXphcmQgY29tcG9uZW50c1xuICAgIFQuZ3JvdXBCeShcbiAgICAgIFtcbiAgICAgICAgXCJhZG1pbjBfbmFtZVwiLFxuICAgICAgICBcImFkbWluMV9uYW1lXCIsXG4gICAgICAgIFwiYWRtaW4yX25hbWVcIixcbiAgICAgICAgXCJzY2VuYXJpb1wiLFxuICAgICAgICBcInRpbWVmcmFtZVwiLFxuICAgICAgICBcInNldmVyaXR5XCIsXG4gICAgICAgIFwiY3JvcFwiXG4gICAgICBdLFxuICAgICAgW1xuICAgICAgICBULnN1bW1hcml6ZSh7XG4gICAgICAgICAgdm9wX2FueTogVC5zdW0oXCJ2b3BcIilcbiAgICAgICAgfSlcbiAgICAgIF1cbiAgICApXG4gICk7XG5cbiAgY29uc3QgX2RhdGFXaXRoQW55Q29sdW1uID0gVC50aWR5KFxuICAgIGRhdGFfaGF6YXJkVm9QLFxuICAgIFQubGVmdEpvaW4oX2FueURhdGEsIHtcbiAgICAgIGJ5OiBbXG4gICAgICAgIFwiYWRtaW4wX25hbWVcIixcbiAgICAgICAgXCJhZG1pbjFfbmFtZVwiLFxuICAgICAgICBcImFkbWluMl9uYW1lXCIsXG4gICAgICAgIFwic2NlbmFyaW9cIixcbiAgICAgICAgXCJ0aW1lZnJhbWVcIixcbiAgICAgICAgXCJjcm9wXCIsXG4gICAgICAgIFwic2V2ZXJpdHlcIlxuICAgICAgXVxuICAgIH0pXG4gICk7XG5cbiAgY29uc3QgZGF0YSA9IF9kYXRhV2l0aEFueUNvbHVtbjtcbiAgY29uc3QgZGF0YUFueSA9IGRhdGEuZmlsdGVyKChkKSA9PiBkLmhhemFyZCA9PSBcImFueVwiKTsgLy8gY29tYmluZWRcbiAgY29uc3QgZGF0YUJhcnMgPSBbXG4gICAgLi4uZGF0YS5maWx0ZXIoKGQpID0+IGQuaGF6YXJkICE9PSBcImFueVwiICYmIGQudm9wICE9PSAwKSAvLyByZW1vdmUgdGhlIGNvbWJpbmVkIGhhemFyZFxuICBdO1xuIHJldHVybiBkYXRhQmFyc1xufVxuIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdwcmV0dHlMYW5ndWFnZVZpZXcnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0R2VvRGF0YVR5cGUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0U2NlbmFyaW9BbmRUaW1lZnJhbWUnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0SGF6YXJkJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdEFjRGF0YVR5cGVOZXcnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnaWNpY2xlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ2xhbmd1YWdlJykifSx7Im1ldGhvZE5hbWUiOiJpbnRlcnByZXRRdWlldCIsInNvdXJjZSI6InNoaW55SW5wdXQoJ3NlbGVjdEFkbWluMCcpIn0seyJtZXRob2ROYW1lIjoiaW50ZXJwcmV0UXVpZXQiLCJzb3VyY2UiOiJzaGlueUlucHV0KCdzZWxlY3RBZG1pbjEnKSJ9LHsibWV0aG9kTmFtZSI6ImludGVycHJldFF1aWV0Iiwic291cmNlIjoic2hpbnlJbnB1dCgnc2VsZWN0QWRtaW4yJykifV19</script><script type="module">"file:"===window.location.protocol&&alert("The OJS runtime does not work with file:// URLs. Please use a web server to view this document."),window._ojs.paths.runtimeToDoc="../../notebooks/whatsAtRisk",window._ojs.paths.runtimeToRoot="../..",window._ojs.paths.docToRoot="../..",window._ojs.selfContained=!1,window._ojs.runtime.interpretFromScriptTags()</script><script id="quarto-html-after-body" type="application/javascript">window.document.addEventListener("DOMContentLoaded",function(t){const e=t=>{for(const e of t.classList)if(e.startsWith("code-annotation-"))return!0;return!1},n=function(t){const e=t.trigger;e.blur(),e.classList.add("code-copy-button-checked");var n=e.getAttribute("title");let o;e.setAttribute("title","Copied!"),window.bootstrap&&(e.setAttribute("data-bs-toggle","tooltip"),e.setAttribute("data-bs-placement","left"),e.setAttribute("data-bs-title","Copied!"),o=new bootstrap.Tooltip(e,{trigger:"manual",customClass:"code-copy-button-tooltip",offset:[0,-8]}),o.show()),setTimeout(function(){o&&(o.hide(),e.removeAttribute("data-bs-title"),e.removeAttribute("data-bs-toggle"),e.removeAttribute("data-bs-placement")),e.setAttribute("title",n),e.classList.remove("code-copy-button-checked")},1e3),t.clearSelection()},o=function(t){const n=t.parentElement.cloneNode(!0).querySelector("code");for(const t of n.children)e(t)&&t.remove();return n.innerText};if(new window.ClipboardJS(".code-copy-button:not([data-in-quarto-modal])",{text:o}).on("success",n),window.document.getElementById("quarto-embedded-source-code-modal")){new window.ClipboardJS(".code-copy-button[data-in-quarto-modal]",{text:o,container:window.document.getElementById("quarto-embedded-source-code-modal")}).on("success",n)}for(var i=new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//),a=new RegExp(/^mailto:/),l=new RegExp("https://adaptationatlas.github.io/atlas_notebooks/"),r=t=>l.test(t)||i.test(t)||a.test(t),d=window.document.querySelectorAll("a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)"),c=0;c<d.length;c++){const t=d[c];r(t.href)||void 0!==t.dataset.originalHref&&(t.href=t.dataset.originalHref)}function s(t,e,n,o){const i={allowHTML:!0,maxWidth:500,delay:100,arrow:!1,appendTo:function(t){return t.parentElement},interactive:!0,interactiveBorder:10,theme:"quarto",placement:"bottom-start"};e&&(i.content=e),n&&(i.onTrigger=n),o&&(i.onUntrigger=o),window.tippy(t,i)}const u=window.document.querySelectorAll('a[role="doc-noteref"]');for(c=0;c<u.length;c++){const t=u[c];s(t,function(){let e=t.getAttribute("data-footnote-href")||t.getAttribute("href");try{e=new URL(e).hash}catch{}const n=e.replace(/^#\/?/,""),o=window.document.getElementById(n);return o?o.innerHTML:""})}const h=window.document.querySelectorAll("a.quarto-xref"),m=(t,e)=>{const n=t=>{if(t.classList.remove("page-full","page-columns"),t.children)for(const e of t.children)n(e)};if(n(e),null===t||t.startsWith("sec-")){const t=document.createElement("div");if(e.children&&e.children.length>2){t.appendChild(e.children[0].cloneNode(!0));for(let n=1;n<e.children.length;n++){const o=e.children[n];if("P"!==o.tagName||""!==o.innerText){t.appendChild(o.cloneNode(!0));break}}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(t),t.innerHTML}return window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.innerHTML}{const t=e.querySelector("a.anchorjs-link");return t&&t.remove(),window.Quarto?.typesetMath&&window.Quarto.typesetMath(e),e.classList.contains("callout")?e.outerHTML:e.innerHTML}};for(c=0;c<h.length;c++){const t=h[c];s(t,void 0,function(e){e.disable();let n,o=t.getAttribute("href");if(o.startsWith("#"))n=o;else try{n=new URL(o).hash}catch{}if(n){const t=n.replace(/^#\/?/,""),i=window.document.getElementById(t);if(null!==i)try{const n=m(t,i.cloneNode(!0));e.setContent(n)}finally{e.enable(),e.show()}else fetch(o.split("#")[0]).then(t=>t.text()).then(n=>{const o=(new DOMParser).parseFromString(n,"text/html").getElementById(t);if(null!==o){const n=m(t,o);e.setContent(n)}}).finally(()=>{e.enable(),e.show()})}else fetch(o).then(t=>t.text()).then(t=>{const n=(new DOMParser).parseFromString(t,"text/html").querySelector("main.content");if(null!==n){n.children.length>0&&"HEADER"===n.children[0].tagName&&n.children[0].remove();const t=m(null,n);e.setContent(t)}}).finally(()=>{e.enable(),e.show()})},function(t){})}let w;const g=t=>{window.document;const e=t.getAttribute("data-target-cell"),n=t.getAttribute("data-target-annotation");const o=window.document.querySelector('span[data-code-cell="'+e+'"][data-code-annotation="'+n+'"]').getAttribute("data-code-lines").split(",").map(t=>e+"-"+t);let i=null,a=null,l=null;if(o.length>0){const n=window.document.getElementById(o[0]);if(i=n.offsetTop,a=n.offsetHeight,l=n.parentElement.parentElement,o.length>1){const t=window.document.getElementById(o[o.length-1]);a=t.offsetTop+t.offsetHeight-i}if(null!==i&&null!==a&&null!==l){let t=window.document.getElementById("code-annotation-line-highlight");null===t&&(t=window.document.createElement("div"),t.setAttribute("id","code-annotation-line-highlight"),t.style.position="absolute",l.appendChild(t)),t.style.top=i-2+"px",t.style.height=a+4+"px",t.style.left=0;let n=window.document.getElementById("code-annotation-line-highlight-gutter");if(null===n){n=window.document.createElement("div"),n.setAttribute("id","code-annotation-line-highlight-gutter"),n.style.position="absolute";window.document.getElementById(e).querySelector(".code-annotation-gutter").appendChild(n)}n.style.top=i-2+"px",n.style.height=a+4+"px"}w=t}},p=()=>{["code-annotation-line-highlight","code-annotation-line-highlight-gutter"].forEach(t=>{const e=window.document.getElementById(t);e&&e.remove()}),w=void 0};window.addEventListener("resize",function(t,e){let n,o=!1;return(...i)=>{o?(n&&clearTimeout(n),n=setTimeout(()=>{t.apply(this,i),n=o=!1},e)):(t.apply(this,i),o=!0)}}(()=>{elRect=void 0,w&&g(w)},10));const f=window.document.querySelectorAll("dt[data-target-cell]");for(const t of f)t.addEventListener("click",t=>{const e=t.target;if(e!==w){p();const t=window.document.querySelector("dt[data-target-cell].code-annotation-active");t&&t.classList.remove("code-annotation-active"),g(e),e.classList.add("code-annotation-active")}else p(),e.classList.remove("code-annotation-active")});const b=t=>{const e=t.parentElement;if(e){const n=e.dataset.cites;return n?{el:t,cites:n.split(" ")}:b(t.parentElement)}};var y=window.document.querySelectorAll('a[role="doc-biblioref"]');for(c=0;c<y.length;c++){const t=y[c],e=b(t);e&&s(e.el,function(){var t=window.document.createElement("div");return e.cites.forEach(function(e){var n=window.document.createElement("div");n.classList.add("hanging-indent"),n.classList.add("csl-entry");var o=window.document.getElementById("ref-"+e);o&&(n.innerHTML=o.innerHTML),t.appendChild(n)}),t.innerHTML})}})</script></div></body></html>